@&#MAIN-TITLE@&#Adaptive Kalman snake for semi-autonomous 3D vessel tracking

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           We propose 3D vessel segmentation and tracking algorithm based on an active contour model and a Kalman filter.


                        
                        
                           
                           To obtain refined segmentation results, we model an adaptive control spacing algorithm for the active contour model.


                        
                        
                           
                           To obtain refined tracking results, we model an initial contour estimation algorithm for the Kalman filter.


                        
                        
                           
                           ROC analyses demonstrated the time efficiency and tracking robustness of the proposed model.


                        
                        
                           
                           Processing time can be effectively reduced by approximately 20%.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Vessel tracking

Active contour

Snake

Kalman filter

Initial contour estimation

Adaptive control points spacing

@&#ABSTRACT@&#


               
               
                  In this paper, we propose a robust semi-autonomous algorithm for 3D vessel segmentation and tracking based on an active contour model and a Kalman filter. For each computed tomography angiography (CTA) slice, we use the active contour model to segment the vessel boundary and the Kalman filter to track position and shape variations of the vessel boundary between slices. For successful segmentation via active contour, we select an adequate number of initial points from the contour of the first slice. The points are set manually by user input for the first slice. For the remaining slices, the initial contour position is estimated autonomously based on segmentation results of the previous slice. To obtain refined segmentation results, an adaptive control spacing algorithm is introduced into the active contour model. Moreover, a block search-based initial contour estimation procedure is proposed to ensure that the initial contour of each slice can be near the vessel boundary. Experiments were performed on synthetic and real chest CTA images. Compared with the well-known Chan-Vese (CV) model, the proposed algorithm exhibited better performance in segmentation and tracking. In particular, receiver operating characteristic analysis on the synthetic and real CTA images demonstrated the time efficiency and tracking robustness of the proposed model. In terms of computational time redundancy, processing time can be effectively reduced by approximately 20%.
               
            

@&#INTRODUCTION@&#

Rapid developments in image processing technologies, including image segmentation, tissue characterization, and image registration, are facilitating a common platform for medical image processing. Several vessel tracking methods for different human organs based on image processing algorithms have been proposed for this common platform. However, the amount of data that needs to be manipulated is growing exponentially as a result of advances in image acquisition technologies as well as clinical requirements. In addition, the expectations for diagnostic accuracy are higher, in line with the large number of applications that utilize processed images. Robust, precise, and reproducible image processing algorithms are therefore essential [1]. To overcome these challenges, many image processing techniques have been developed. However, no single image processing technique works for all applications, and thus different approaches with varying accuracy, speed, and degrees of complexity have been explored for each practical problem [2].

In this paper we present a semi-autonomous blood vessel tracking algorithm. Given a medical volume data set composed of computed tomography angiography (CTA) slices, the algorithm requires the user's initial input (positioning of control points) for the first slice and then autonomously tracks blood vessels slice by slice (SBS). As shown in Fig. 1
                     (a), a user inputs several control points surrounding the target vessel on the first CTA slice. The points are then moved to segment the vessel boundary using an active contour model, termed ‘snake’. These successive control points become seed points to estimate the initial control points of the next slice. In this way, the initial control points for subsequent slices are autonomously found, and segmentation and tracking (SNT) are performed. For this semi-autonomous temporal tracing, it is necessary to resolve two predictions, termed inter- and intra-predictions, which are illustrated in Fig. 1(b). The former determines the initial control points of the vessel in each slice for segmentation by considering the translation and size variation. Once the boundary has been determined in the previous slice, inter-slice prediction temporally tracks the vessel boundary on a slice-by-slice basis. For intra-slice prediction, it is important to segment irregular vessel boundary shapes correctly within the slice.

Various SNT methods have been developed to resolve the two slice predictions described above. In conventional research, two types of vessel segmentation approaches are used: a model-based approach ([3–5]) and a tracking-based approach ([6,7]). In the model-based approach, segmentation is achieved using prior information regarding elongation, hyper-intensity, or statistical distribution to extract blood vessels [8]. In [9] a gray level distribution for magnetic resonance angiography was approximated to extract the 3D cerebrovascular system. An automated septum thickness measurement method based on a deformable model of the septum and mitral valve was proposed by Snare et al. [10]. Delibasis et al. [11] presented an automatic model-based tracing algorithm for vessel segmentation and diameter estimation. The algorithm utilizes a parametric model of a vessel composed of a stripe, which exploits geometric properties for parameter definitions.

The model-based approach is very effective at tracking an object even if there are slight deformations or variations in translation, rotation, or magnification, as opposed to radical structural deformations. One of the most representative model-based approaches is an active contour algorithm that creates a contour from the initial contour input by the user while deforming the shape. This algorithm has demonstrated good performance in two-dimensional (2D) object segmentation. However, this algorithm has limited applicability to vessel segmentation in three dimensions due to ambiguity of the depth information. In other words, if snake is applied solely to track the vessel boundary, it is difficult to predict drastic changes in the shape of the boundary between slices. Moreover, it is challenging to set an initial contour manually for each slice over three-dimensional (3D) space, and it is not easy to calculate concavity in the process of contour evolution.

The tracking-based approach segments and tracks each vessel by applying a local operator around the vessel. It detects the centerline or boundary of the vessel in the first computed tomography/magnetic resonance imaging (CT/MRI) slice and tracking is then performed consecutively for subsequent slices based on initial detection in the first slice. In [12] authors used Hessian-based and particle filter to determine seed points and track coronary arteries. To improve the robustness of the algorithm, the authors devised a local geometric feature based on the similarity of consecutive cross-sections perpendicular to the vessel direction.

The tracking-based approach makes it possible to reduce user intervention and consequently leads to a considerable decrease in computation cost after the initial segmentation. The most common algorithm used in the tracking-based approach is the Kalman filter algorithm. This algorithm consists of a series of tracking states defined by a linear state-space model. It can also track the structure of a vessel in a 3D environment because the state-space model can be applied to track shape variations of the vessel boundary between slices. However, it is easy to fail to segment the vessel boundary when the vessel is adjacent to bone because of ambiguous vessel boundaries, which in turn leads to failure to trace the vessel in subsequent slices due to error propagation. Moreover, if the shape varies non-linearly between slices, the Kalman filter does not yield accurate results.

In this paper, we present a SNT scheme for vessel boundary that we refer to as an adaptive Kalman snake that takes advantage of both model-based and tracking-based approaches, and is therefore resilient to shape deformation and requires minimal user intervention. As first introduced in [13], the Kalman snake employs the equations of motion of a physical snake model. Our algorithm incorporates the Kalman snake scheme, but several modifications are made to segment and track the vessel boundaries, as follows: First, we employ a snake to initialize the vessel boundary. Next, to design a state transition matrix of the Kalman filter, which determines inter-slice vessel position translation and shape deformation, we use an initial contour estimation algorithm. Finally, we propose an adaptive control point spacing algorithm to resolve potential errors introduced by the simple combination of snake and Kalman filter. Experiments were performed on synthetic and real CTA images, and the proposed algorithm is compared with the well-known Chan-Vese (CV) [14] model. Computation time analysis is also performed.

The layout of the paper is as follows: In Section 2, we provide a brief introduction of the active contour model and Kalman filter. Motivation for our proposed model is presented in Section 3, and a detailed explanation of the proposed model is described in Section 4. The simulation environment is given in Section 5. In Section 6, we apply our model to synthetic and real medical images, and analyze the results. Finally, we draw our conclusions in Section 7.

@&#MATERIAL AND METHODS@&#

Two types of vessel segmentation approaches are conventionally used: model-based and tracking-based approaches. The model-based approach is classified into four types [15]: the (1) deformable, (2) parametric, (3) template matching, and (4) generalized cylinder models. All of these models use prior information regarding elongation or hyper-intensity to detect vessels [8]. To determine the contour of an object, the deformable model deforms a contour based on the intrinsic characteristics of the contour itself (such as circularity) and its image variations (such as edges or differences in pixel intensity) from the background image.

The other major vessel extraction approach, the tracking-based approach, tracks vessels by applying a local operator near to the vessel boundary region. Based on initial points, this approach detects the center line or contour of each vessel by analyzing pixels on a plane constructed in parallel to the tracking direction [15]. Various approaches can be used to detect the center lines and contours of a vessel. As a simple example, initial points can be found through edge detection, and then the edge can be revised to obtain a contour using connectivity information between slices. An example of a more complex method is a detector that uses graph representation [16].

The most representative model-based and tracking-based approaches are the snake and Kalman filter approaches, respectively. Brief summaries of these approaches are provided in Sections 2.2 and 2.3, respectively.

The active contour model [17,18] is widely used in computer visioning and image processing fields to find the boundary of an object. The snake scheme accepts user input, called control points, that are used as the initial points for the snake iteration. The initial points are then interpolated to form an initial contour. Through snake, the initial contour around the object moves elastically toward the boundary of the target object, and it shrinks to fit the shape of the target object by minimizing its own energy function. It has been demonstrated that in a semi-autonomous vessel segmentation environment, the snake algorithm segments the vessel boundary successfully if the initial contour is correctly set.

The energy function, E
                        
                           snake
                        , can be formulated as the summation of two energy terms: internal energy (E
                        
                           int
                        ) for the intrinsic property of the curve itself and external energy (E
                        
                           ext
                        ) for the image difference between the curve and the background image:


                        
                           
                              (1)
                              
                                 
                                    E
                                    snake
                                 
                                 =
                                 
                                    E
                                    int
                                 
                                 +
                                 
                                    E
                                    ext
                                 
                                 .
                              
                           
                        
                     

For example, the intrinsic property may be the length or curvature of the curve, while the image difference represents the structural difference between the curve and the background image, such as edges or additional constraints added by an external user.

The internal energy of snake corresponds to the intrinsic energy of the curve itself. For realization of snake, an arbitrary curve is used to determine the contour of the vessel by changing the shape of the curve into that of the contour of the vessel. To make the curve more elastic, like a rubber band, an additional term can be added so that the internal energy also relies on the length of the curve. In addition, to control the smoothness of the shape, another energy term can be added to the internal energy.

Mathematically, the elasticity and smoothness can be controlled by using the magnitudes of the first-order and second-order derivatives, respectively. Assume that a closed curve v(s) is represented as v(s)=(x(s), y(s)) for 0 ≤ s ≤ 1. The internal energy of snake then becomes


                           
                              
                                 (2)
                                 
                                    
                                       E
                                       int
                                    
                                    =
                                    
                                       ∫
                                       0
                                       1
                                    
                                    
                                       
                                          
                                             α
                                             (
                                             s
                                             )
                                          
                                          2
                                       
                                       |
                                       
                                          
                                             
                                                v
                                             
                                          
                                          s
                                       
                                       (
                                       s
                                       )
                                       
                                          |
                                          2
                                       
                                       +
                                       
                                          
                                             
                                                β
                                                (
                                                s
                                                )
                                             
                                             2
                                          
                                       
                                       
                                          |
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                      
                                                   
                                                   ss
                                                
                                             
                                             (
                                             s
                                             )
                                          
                                          
                                             |
                                             2
                                          
                                       
                                       ds
                                       ,
                                    
                                 
                              
                           where α(s) and β(s) are control parameters that account for the contribution of each variable obtained from the first- and second-order derivatives to the internal energy, and v
                           
                              s
                           (s) and v
                           
                              ss
                           (s) are the first and second derivatives of v(s), respectively.

A greater α(s) influences the elasticity of the contour between consecutive iterations, and increases or decreases its circumference. Similarly, a higher β(s) forces the contour to have a smoother shape. Numerically, the continuous integral of (2) can be approximated to a discrete sum utilizing L control points as


                           
                              
                                 (3)
                                 
                                    
                                       E
                                       int
                                    
                                    =
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       L
                                    
                                    
                                       
                                          
                                             
                                                α
                                                i
                                             
                                          
                                          2
                                       
                                       |
                                       
                                          
                                             
                                                v
                                             
                                          
                                          i
                                       
                                       −
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             i
                                             −
                                             1
                                          
                                       
                                       
                                          |
                                          2
                                       
                                       +
                                       
                                          
                                             
                                                β
                                                i
                                             
                                          
                                          2
                                       
                                       |
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             i
                                             −
                                             1
                                          
                                       
                                       −
                                       2
                                       
                                          
                                             
                                                v
                                             
                                          
                                          i
                                       
                                       +
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       
                                          |
                                          2
                                       
                                       ,
                                    
                                 
                              
                           where v
                           
                              i
                           , α
                           
                              i
                            and β
                           
                              i
                            are discretized or sampled version of v(s), α(s) and β(s) respectively, and v
                           0 = v
                           
                              L
                           .

In the snake energy function, external energy indicates the energy between the snake and the background image. To extend the contour into the brighter boundary of an object, the external energy function needs to be designed based on the image's gray values I(x
                           
                              i
                           , y
                           
                              i
                           ) for a control point (x
                           
                              i
                           , y
                           
                              i
                           ). Moreover, to fit the contour to the edge of the image, an energy term for the image gradient ∇I(x
                           
                              i
                           , y
                           
                              i
                           ) needs to be added.

Based on the two aforementioned energy terms, the external energy of the contour including the two energy terms becomes


                           
                              
                                 (4)
                                 
                                    
                                       E
                                       ext
                                    
                                    =
                                    −
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       L
                                    
                                    [
                                    
                                       
                                          w
                                          gray
                                       
                                       I
                                       (
                                       
                                          x
                                          i
                                       
                                       ,
                                       
                                          y
                                          i
                                       
                                       )
                                       +
                                       
                                          w
                                          edge
                                       
                                       ∇
                                       I
                                       (
                                       
                                          x
                                          i
                                       
                                       ,
                                       
                                          y
                                          i
                                       
                                       )
                                    
                                    ]
                                    ,
                                 
                              
                           where 
                              
                                 w
                                 gray
                              
                            and 
                              
                                 w
                                 edge
                              
                            are adjustable constants that control the contribution of energies of the gray and edge. The reason for negation is to obtain a lower energy level as the gray level and edge strength increase.

The Kalman filter [19], used in tracking-based approaches, is a state-tracking recursive filter designed for linear dynamic systems in a noisy environment. Thus, it is commonly used in the fields of computer vision and robotics and provides efficient solutions for most cases. Moreover, it is applicable to systems being measured with probabilistic errors that have linear relationships between previous and current states.

A segmentation algorithm such as snake can be applied to track vessel boundaries between slices. In such cases, the segmentation may be disturbed by image noise, and/or may fail because of neighboring organs. In these situations, the Kalman filter can be used to track the position of the vessel boundary based on the predicted state and measurements.

A state x
                           
                              k
                            and measurement z
                           
                              k
                            ∈ 
                              
                                 
                                    
                                       ℝ
                                    
                                 
                                 m
                              
                            follow the state-space equation as follows:


                           
                              
                                 (5)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                k
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         A
                                                         k
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                
                                                   k
                                                   −
                                                   1
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      w
                                                   
                                                
                                                
                                                   k
                                                   −
                                                   1
                                                
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      z
                                                   
                                                
                                                k
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         H
                                                         k
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                k
                                             
                                             +
                                             
                                                
                                                   
                                                      v
                                                   
                                                
                                                k
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        

The notations in (5), dimensions and meanings of the parameters are summarized in Table 1
                           . The two parameters w
                           
                              k
                            and v
                           
                              k
                            follow white Gaussian processes and are independent of each other. Therefore, their probability density functions can be expressed as p(w
                           
                              k
                           ) ∼ N(0, Q
                           
                              k
                           ) and p(v
                           
                              k
                           ) ∼ N(0, R
                           
                              k
                           ), where Q
                           
                              k
                            and R
                           
                              k
                            represent the process and measurement noise covariances, respectively.

Kalman filter estimates a current state based on the state-space equation in (5). This process is conducted through a series of steps called Kalman updates and consists of two update stages (time and measurement) as shown below:
                              
                                 •
                                 Time update:
                                       
                                          (6)
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                         
                                                      
                                                      ˆ
                                                   
                                                
                                                t
                                                −
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         A
                                                         k
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  x
                                                               
                                                            
                                                         
                                                         ˆ
                                                      
                                                   
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          (7)
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                
                                                k
                                                −
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         A
                                                         k
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               A
                                                               k
                                                            
                                                         
                                                      
                                                   
                                                   T
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      Q
                                                   
                                                
                                                k
                                             
                                             .
                                          
                                       
                                    
                                 

Measurement update:
                                       
                                          (8)
                                          
                                             
                                                
                                                   
                                                      
                                                         K
                                                      
                                                   
                                                   k
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      P
                                                   
                                                
                                                k
                                                −
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               H
                                                               k
                                                            
                                                         
                                                      
                                                   
                                                   T
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        H
                                                                        k
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     P
                                                                  
                                                               
                                                               k
                                                               −
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              H
                                                                              k
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  T
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  
                                                                     R
                                                                  
                                                               
                                                               k
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      −
                                                      1
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          (9)
                                          
                                             
                                                
                                                   
                                                      
                                                         P
                                                      
                                                   
                                                   k
                                                
                                             
                                             =
                                             (
                                             
                                                
                                                   
                                                      I
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            K
                                                         
                                                      
                                                      k
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            H
                                                            k
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                             
                                                
                                                   
                                                      P
                                                   
                                                
                                                k
                                                −
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          (10)
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  x
                                                               
                                                            
                                                         
                                                         ˆ
                                                      
                                                   
                                                   k
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                         
                                                      
                                                      ˆ
                                                   
                                                
                                                k
                                                −
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         K
                                                      
                                                   
                                                   k
                                                
                                             
                                             (
                                             
                                                
                                                   
                                                      
                                                         
                                                            z
                                                         
                                                      
                                                      k
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            H
                                                            k
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  x
                                                               
                                                            
                                                         
                                                         ˆ
                                                      
                                                   
                                                   k
                                                   −
                                                
                                             
                                             )
                                             .
                                          
                                       
                                    
                                 

Descriptions of the parameters in (6)–(10) are provided in Table 2
                           , and 
                              
                                 
                                    
                                       P
                                    
                                 
                                 k
                                 −
                              
                            and P
                           
                              k
                            are the covariance matrices for the estimation errors of 
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                       
                                       ˆ
                                    
                                 
                                 k
                                 −
                              
                            and 
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                       
                                       ˆ
                                    
                                 
                                 k
                              
                           , respectively. For each update process, the state vector 
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                       
                                       ˆ
                                    
                                 
                                 k
                              
                            and covariance matrix P
                           
                              k
                            are updated. In the time (measurement) update, an a priori (a posteriori) estimation is conducted to update the state vector 
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                       
                                       ˆ
                                    
                                 
                                 k
                                 −
                              
                            (
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                       
                                       ˆ
                                    
                                 
                                 k
                              
                           ), and the associated error covariance matrix 
                              
                                 
                                    
                                       P
                                    
                                 
                                 k
                                 −
                              
                            (P
                           
                              k
                           ) is updated. It can be seen that the a priori estimates of 
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                       
                                       ˆ
                                    
                                 
                                 k
                                 −
                              
                            and 
                              
                                 
                                    
                                       P
                                    
                                 
                                 k
                                 −
                              
                            are driven by the estimation results until the previous time step, which do not include any effects of the measurement at the current time step z
                           
                              k
                           . However, the a posteriori estimates of 
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                       
                                       ˆ
                                    
                                 
                                 k
                              
                            and P
                           
                              k
                            reflect both the current measurement z
                           
                              k
                            and the a priori estimate.

In this paper, we present a vessel tracking algorithm that utilizes snake to find the contours of a vessel in each intra-slice and the Kalman filter to track the 3D blood vessel along inter-slices. In particular, we take advantage of combining these two algorithms to overcome the drawbacks of each method. Snake can segment irregular boundary shapes more accurately than the Kalman filter. However, if these two algorithms are simply combined, the following problems may occur.

The snake algorithm can segment a boundary by minimizing a contour's image-based energy in each slice. However, when the snake is solely applied to SNT, the contour might not evolve correctly in consecutive slices because the algorithm does not consider the coherency of the vessel segment between two slices. Fig. 2
                            illustrates a case of loss of tracking due to movement of the target vessel. In Fig. 2, the initial contour of the kth contour is determined by the segmentation result of the previous (k
                           −1)th slice. However, because the vessel boundary of the kth slice moved a considerable distance from the previous (k
                           −1)th slice, segmentation failure occurs at the kth slice.

The Kalman filter represents an object to be tracked as a finite dimensional vector. However, because of the finitude of dimensions, there may be limits to the degrees of freedom available to express the shape of an object, which is required to parameterize the state vector. If the topology of an object changes considerably it is difficult to track the object appropriately without changing the vector's dimension on a slice-by-slice basis. For example, suppose each object is represented by employing an ellipse model in terms of center position, and major and minor axes. If the shape is highly correlated with an ellipse as in Fig. 3
                           (a), it could be segmented almost successfully. However, if the shape is far from the ellipse, as shown in Fig. 3(b), it would be difficult to model the shape appropriately using an ellipse, resulting in tracking failure.

The snake algorithm and the Kalman filter complement each other with respect to (wrt) SNT. The drawbacks of snake wrt global motion tracking could potentially be complemented by the Kalman filter. In addition, snake can provide a solution for segmentation of a locally deformed object, which is not easily achieved by the Kalman filter. However, another problem arises when the two algorithms are simply combined. To realize snake, it is necessary to create a contour consisting of a set of discretized points. In the snake algorithm, these points, called control points, can be used to segment the vessel boundary. In detail, if the shape of an object is deformed from the previous to the current slice, the control points move from their initial position to the place where the magnitude of gradient is the highest. For example, as shown in Fig. 4
                           (a), if neighboring vessel boundaries are close to the vessel boundary to be tracked, the control points migrate to the place where neighboring vessels do not exist. This behavior comes from the fact that the edge magnitude is high at the boundaries where other objects do not exist. In this case, the vessel boundary could be severely deformed, which may lead to failure of segmentation in the next slice even though segmentation of the current slice is successful. An example of segmentation failure in the next slice is illustrated in Fig. 4(b).

@&#MOTIVATION@&#

To resolve the three intrinsic problems described above, it is necessary to develop a more robust algorithm that takes into account changes in position of the vessel to a different place in the next slice, or changes in shape due to the existence of neighboring organs. We propose the following solutions.

To resolve problem 1, we propose an initial contour estimation method. As shown in Fig. 5
                           , the displacement of the vessel boundary between two consecutive slices is estimated to determine the correct initial position of the control points in the next slice. The initial contour of the kth slice in Fig. 5(b) is predicted by utilizing the segmentation result of the (k
                           −1)th slice in a search range by measuring estimation errors. This makes it possible to achieve accurate segmentation without losing the target vessel of the kth slice, as shown in Fig. 5(c).

To resolve both problems 2 and 3, we designed an adaptive spacing algorithm to place control points taking into account the irregularity of the shape and its distance from neighboring organs and blood vessels. As shown in Fig 6
                           (a), after snake segmentation, control points tend to gather in specific regions depending on the shape of the vessel and neighboring objects. To avoid loss of tracing, several control points, represented as ‘x’ in Fig. 6(c), are inserted in the empty region to prevent segmentation failure in the next slice. Initial contour of the (k
                           +1)th slice predicted using the results of the kth slice is described in Fig. 6(d). Although the vessel boundary is severely deformed relative to the previous slice, segmentation is successfully completed because of the newly added control points denoted as ‘x’ in Fig. 6(e). Moreover, Fig. 6(e) shows that several control points cluster in a specific region, and not all of these are required to segment the vessel correctly. We therefore remove the redundant points using a deletion algorithm, as shown in Fig. 6(f), which also decreases the computational complexity of snake iterations.


                        Fig. 7
                         shows a schematic diagram of the proposed vessel tracking algorithm. The adaptive Kalman snake is composed of initialization and iteration processes. The initialization is conducted by using a series of processes:
                           
                              (a)
                              
                                 Figs. 7(a)–(c) depict the procedure used to initialize the first slice. Through the user interface, N input points of P={p
                                 
                                    i
                                 |i
                                 =1, 2, …, N}, where p
                                 
                                    i
                                 
                                 =[x
                                 
                                    i
                                 , y
                                 
                                    i
                                 ]
                                    T
                                 , are entered to construct a point set constrained to be located around the vessel boundary.

Let us define a initial control point set of the kth slice as X
                                 
                                    k
                                 
                                 ={x
                                 
                                    i,k
                                 |i
                                 =1, 2, …
                                 L
                                 
                                    k
                                 }, where 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                             
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                    
                                    =
                                    
                                       
                                          [
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                         
                                                      
                                                      
                                                         i
                                                         ,
                                                         k
                                                      
                                                   
                                                
                                                T
                                             
                                             ,
                                             1
                                          
                                          ]
                                       
                                       T
                                    
                                    =
                                    
                                       
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                               
                                                                  i
                                                                  ,
                                                                  k
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               y
                                                               
                                                                  i
                                                                  ,
                                                                  k
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          T
                                       
                                    
                                  and v
                                 
                                    i,k
                                  is the ith control point of the kth slice. Then, in Fig. 7(b), the points are interpolated to produce L
                                 0 points of the initial control point set, X
                                 0. If the sampling rate of the interpolation is r
                                 
                                    s
                                 , then 
                                    
                                       
                                          
                                             
                                                L
                                                0
                                             
                                          
                                          =
                                          N
                                          ·
                                          
                                             
                                                r
                                                s
                                             
                                          
                                       
                                    
                                 . To translate the control points using linear transformation, we use a homogeneous coordinate system which makes the third element of x
                                 
                                    i,k
                                  equal to 1.

In Fig. 7(c), the first vessel boundary estimated by using the point set is obtained by using snake for the first slice. When the initialization process is complete, the iteration process, which is the major process used in the tracking procedure, continues.

In Fig. 7(d), the prior initial contour of the kth slice, 
                                    
                                       
                                          
                                             
                                                
                                                   X
                                                   ˆ
                                                
                                             
                                          
                                       
                                       k
                                       −
                                    
                                    =
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      x
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                          −
                                       
                                       |
                                       i
                                       =
                                       1
                                       ,
                                       2
                                       ,
                                       .
                                       .
                                       .
                                       
                                          
                                             L
                                             k
                                          
                                       
                                    
                                    }
                                 , is set by estimating position and shape variations of the object based on the segmentation results of the previous slice, 
                                    
                                       
                                          
                                             
                                                
                                                   X
                                                   ˆ
                                                
                                             
                                          
                                       
                                       
                                          k
                                          −
                                          1
                                       
                                       *
                                    
                                    =
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      x
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          
                                             i
                                             ,
                                             k
                                             −
                                             1
                                          
                                          *
                                       
                                       |
                                       i
                                       =
                                       1
                                       ,
                                       2
                                       ,
                                       …
                                       
                                          
                                             L
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                       
                                    
                                    }
                                 .


                                 
                                    
                                       (11)
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      i
                                                      ,
                                                      k
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   
                                                      
                                                         
                                                            X
                                                            ˆ
                                                         
                                                      
                                                   
                                                
                                                k
                                                −
                                             
                                          
                                          )
                                          ←
                                          
                                             
                                                f
                                                est
                                             
                                          
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                      
                                                   
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   
                                                      
                                                         
                                                            X
                                                            ˆ
                                                         
                                                      
                                                   
                                                
                                                
                                                   k
                                                   −
                                                   1
                                                
                                                *
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       (12)
                                       
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                
                                             
                                             
                                                i
                                                ,
                                                k
                                             
                                             −
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         P
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                   −
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                
                                                   A
                                                
                                             
                                             
                                                i
                                                ,
                                                k
                                             
                                             T
                                          
                                          +
                                          
                                             
                                                
                                                   
                                                      
                                                         Q
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                
                                             
                                          
                                       
                                    
                                 where I
                                 
                                    k
                                  is the kth CTA slice, A
                                 
                                    i,k
                                  is a state transition model of the ith control point at the kth slice as described in Table 2, and f
                                 est(·) is the function to estimate the initial control points, which will be described in detail in Section 4.2.

In Fig. 7(e), the measurement Z
                                 
                                    k
                                 
                                 ={z
                                 
                                    i,k
                                 |i
                                 =1, 2, …
                                 L
                                 
                                    k
                                 } is obtained using the snake algorithm based on the initial control points set obtained by 
                                    
                                       
                                          
                                             
                                                
                                                   X
                                                   ˆ
                                                
                                             
                                          
                                       
                                       k
                                       −
                                    
                                  in (11)
                                 
                                    
                                       (13)
                                       
                                          
                                             
                                                
                                                   
                                                      Z
                                                   
                                                
                                                k
                                             
                                          
                                          ←
                                          
                                             
                                                h
                                                snake
                                             
                                          
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                      
                                                   
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   
                                                      
                                                         
                                                            X
                                                            ˆ
                                                         
                                                      
                                                   
                                                
                                                k
                                                −
                                             
                                          
                                          )
                                       
                                    
                                 where h
                                 snake is the snake function.

Next, in Fig. 7(f), for given L
                                 
                                    k
                                  control points, the set of control points after segmentation in the current slice, 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          k
                                       
                                    
                                    =
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             
                                                i
                                                ,
                                                k
                                             
                                          
                                       
                                       |
                                       i
                                       =
                                       1
                                       ,
                                       2
                                       ,
                                       …
                                       
                                          
                                             L
                                             k
                                          
                                       
                                    
                                    }
                                 , is determined by the measurement update process of (8)-(10):


                                 
                                    
                                       (14)
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         K
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                
                                             
                                             
                                                i
                                                ,
                                                k
                                             
                                             −
                                          
                                          
                                             
                                                
                                                   
                                                      H
                                                   
                                                
                                             
                                             
                                                i
                                                ,
                                                k
                                             
                                             T
                                          
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     H
                                                                  
                                                               
                                                            
                                                            
                                                               i
                                                               ,
                                                               k
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  P
                                                               
                                                            
                                                         
                                                         
                                                            i
                                                            ,
                                                            k
                                                         
                                                         −
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  H
                                                               
                                                            
                                                         
                                                         
                                                            i
                                                            ,
                                                            k
                                                         
                                                         T
                                                      
                                                      +
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     R
                                                                  
                                                               
                                                            
                                                            
                                                               i
                                                               ,
                                                               k
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       (15)
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         P
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                
                                             
                                          
                                          =
                                          (
                                          
                                             
                                                
                                                   
                                                      I
                                                   
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      
                                                         
                                                            K
                                                         
                                                      
                                                   
                                                   
                                                      i
                                                      ,
                                                      k
                                                   
                                                
                                             
                                          
                                          )
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                
                                             
                                             
                                                i
                                                ,
                                                k
                                             
                                             −
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       (16)
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                            ˆ
                                                         
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             
                                                i
                                                ,
                                                k
                                             
                                             −
                                          
                                          +
                                          
                                             
                                                
                                                   
                                                      
                                                         K
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                
                                             
                                          
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            z
                                                         
                                                      
                                                   
                                                   
                                                      i
                                                      ,
                                                      k
                                                   
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                            ˆ
                                                         
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                
                                                −
                                             
                                          
                                          )
                                          ,
                                       
                                    
                                 where i is the index of the control point, and H
                                 
                                    i,k
                                 , R
                                 
                                    i,k
                                 , 
                                    
                                       
                                          
                                             
                                                P
                                             
                                          
                                       
                                       
                                          i
                                          ,
                                          k
                                       
                                       −
                                    
                                 , K
                                 
                                    i,k
                                 , and z
                                 
                                    i,k
                                  are the observation model, the measurement noise covariance, a priori error covariance matrix, Kalman gain and measurement of the ith control point of the kth slice respectively.

Finally, in Fig. 7(g), the interval of control points is adjusted, and the estimate of the vessel boundary in the current slice, 
                                    
                                       
                                          
                                             
                                                
                                                   X
                                                   ˆ
                                                
                                             
                                          
                                       
                                       k
                                       *
                                    
                                    =
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      x
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                          *
                                       
                                       |
                                       i
                                       =
                                       1
                                       ,
                                       2
                                       ,
                                       …
                                       
                                          
                                             L
                                             k
                                          
                                       
                                    
                                    }
                                 , is obtained using the adaptive control points spacing algorithm, 
                                    
                                       g
                                       CP
                                    
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          k
                                       
                                    
                                    )
                                  which will be explained in detail in Section 4.4.

To design the state-transition matrix A
                        
                           i,k
                        , it is necessary to estimate the displacement wrt the x and y axes and the scale variation of the vessel boundary between two subsequent slices. Suppose that the vessel boundary moves with displacements of d
                        
                           x
                         and d
                        
                           y
                        , and varies with scales of s
                        
                           x
                         and s
                        
                           y
                         with respect to each axis, from the (k
                        −1)th slice to the kth slice. The state-transition matrix, A
                        
                           i,k
                        , is then driven using the homogeneous coordinate system as follows:


                        
                           
                              (17)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                T
                                             
                                          
                                          (
                                          
                                             
                                                c
                                                k
                                                x
                                             
                                             ,
                                             
                                                c
                                                k
                                                y
                                             
                                          
                                          )
                                          
                                             
                                                S
                                             
                                          
                                          (
                                          
                                             
                                                s
                                                k
                                                x
                                             
                                             ,
                                             
                                                s
                                                k
                                                y
                                             
                                          
                                          )
                                          
                                             
                                                T
                                             
                                          
                                          (
                                          
                                             −
                                             
                                                c
                                                
                                                   k
                                                   −
                                                   1
                                                
                                                x
                                             
                                             ,
                                             −
                                             
                                                c
                                                
                                                   k
                                                   −
                                                   1
                                                
                                                y
                                             
                                          
                                          )
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ,
                                                   k
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 T
                              
                           
                           
                              
                                 
                                    ·
                                    ,
                                    ·
                                 
                              
                           
                        , and 
                           
                              
                                 S
                              
                           
                           
                              
                                 
                                    ·
                                    ,
                                    ·
                                 
                              
                           
                         are the translation and scaling matrices, respectively. 
                           
                              s
                              k
                              x
                           
                         and 
                           
                              s
                              k
                              y
                           
                         are parameters for the scaling matrix, and 
                           
                              c
                              
                                 k
                                 −
                                 1
                              
                              x
                           
                           ,
                           
                              c
                              
                                 k
                                 −
                                 1
                              
                              y
                           
                           ,
                           
                              c
                              k
                              x
                           
                         and 
                           
                              c
                              k
                              y
                           
                         are the centers of the bounding blocks B
                        
                           k−1 and B
                        
                           k−1, respectively, and are related to displacements 
                           
                              d
                              k
                              x
                           
                         and 
                           
                              d
                              k
                              y
                           
                        , respectively. To determine each parameter, we use a block-based motion search.

If an object moves from the (k
                           −1)th to kth slice via rigid translation, the position of the object at the kth slice can be estimated using a block-based search method. For a detailed explanation, let the kth slice be the target slice where an object needs to be tracked based on the (k
                           −1)th slice as the reference slice. When the position of control points, obtained by the segmentation results of the reference slice, are placed as shown in Fig. 8
                           (a), we can define a minimal block containing all control points, which we refer to as B
                           
                              k−1. Fig. 8(a) shows the position of control points of the (k
                           −1)th slice blocked by a rectangle window after segmentation. B
                           
                              k−1 is characterized by the upper-left most coordinates, the width and the height, which are x
                           
                              B,k−1, y
                           
                              B,k−1, W
                           
                              B,k−1, and H
                           
                              B,k−1 respectively. Based on B
                           
                              k−1, we estimate a block B
                           
                              k
                            to track the target object at the kth slice using a block-based search algorithm. First, for the target slice, a block the same size as B
                           
                              k−1 is created and slides on the target slice while shifting it over the search window. For each position, a mean absolute error (MAE), which is the mean difference in pixel intensity between the current block and B
                           
                              k−1, is calculated. With reference to the MAE, the optimal displacement of 
                              
                                 d
                                 k
                                 
                                    x
                                    *
                                 
                              
                            and 
                              
                                 d
                                 k
                                 
                                    y
                                    *
                                 
                              
                            can be found at the upper-left-most pixel of the block where the MAE is minimized. This block becomes the estimated block B
                           
                              k
                            for the kth slice. MAE(d
                           
                              x
                           , d
                           
                              y
                           ) becomes


                           
                              
                                 (18)
                                 
                                    MAE
                                    (
                                    
                                       
                                          d
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          d
                                          y
                                       
                                    
                                    )
                                    =
                                    
                                       1
                                       
                                          
                                             
                                                W
                                                
                                                   B
                                                   ,
                                                   k
                                                   −
                                                   1
                                                
                                             
                                          
                                          ·
                                          
                                             
                                                H
                                                
                                                   B
                                                   ,
                                                   k
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    ·
                                    
                                       ∑
                                       
                                          j
                                          =
                                          0
                                       
                                       
                                          
                                             
                                                H
                                                
                                                   B
                                                   ,
                                                   k
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                          
                                             i
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   W
                                                   
                                                      B
                                                      ,
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       
                                          |
                                          
                                             
                                                
                                                   I
                                                   T
                                                
                                             
                                             (
                                             
                                                
                                                   τ
                                                   x
                                                
                                             
                                             ,
                                             
                                                
                                                   τ
                                                   y
                                                
                                             
                                             )
                                             −
                                             
                                                
                                                   I
                                                   R
                                                
                                             
                                             (
                                             
                                                
                                                   γ
                                                   x
                                                
                                             
                                             ,
                                             
                                                
                                                   γ
                                                   y
                                                
                                             
                                             )
                                          
                                          |
                                       
                                    
                                 
                              
                           where τ
                           
                              x
                           
                           =
                           x
                           
                              B,k
                           
                           +
                           d
                           
                              x
                           
                           +
                           i, τ
                           
                              y
                           
                           =
                           y
                           
                              B,k
                           
                           +
                           d
                           
                              y
                           
                           +
                           j, γ
                           
                              x
                           
                           =
                           x
                           
                              B,k−1
                           +
                           i, γ
                           
                              y
                           
                           =
                           y
                           
                              B,k−1
                           +
                           j, and I
                           
                              T
                           (x, y) and I
                           
                              R
                           (x, y) are the pixel intensities at (x, y) on the target and reference slices respectively. In this case, 
                              (
                              
                                 
                                    d
                                    k
                                    
                                       x
                                       *
                                    
                                 
                                 ,
                                 
                                    d
                                    k
                                    
                                       y
                                       *
                                    
                                 
                              
                              )
                            can be obtained as follows:


                           
                              
                                 (19)
                                 
                                    
                                       
                                          
                                             
                                                d
                                                k
                                                
                                                   x
                                                   *
                                                
                                             
                                             ,
                                             
                                                d
                                                k
                                                
                                                   y
                                                   *
                                                
                                             
                                          
                                       
                                    
                                    =
                                    arg
                                    
                                       min
                                       
                                          (
                                          
                                             d
                                             k
                                             x
                                          
                                          ,
                                          
                                             d
                                             k
                                             y
                                          
                                          )
                                       
                                    
                                    MAE
                                    (
                                    
                                       d
                                       k
                                       x
                                    
                                    ,
                                    
                                       d
                                       k
                                       y
                                    
                                    )
                                    .
                                 
                              
                           
                        

After finding 
                              (
                              
                                 
                                    d
                                    k
                                    
                                       x
                                       *
                                    
                                 
                                 ,
                                 
                                    d
                                    k
                                    
                                       y
                                       *
                                    
                                 
                              
                              )
                           , the optimal scaling parameter 
                              (
                              
                                 
                                    
                                       s
                                       k
                                       
                                          x
                                          *
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                       k
                                       
                                          y
                                          *
                                       
                                    
                                 
                              
                              )
                            for scale variation of the object is determined. Let the center of the bounding block be 
                              (
                              
                                 
                                    
                                       c
                                       k
                                       x
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                       k
                                       y
                                    
                                 
                              
                              )
                           . The scaling parameter can then express the rate of scale variation wrt the x and y axe, respectively.

In detail, once the central position is obtained, the block is scaled up or down according to the scaling parameters 
                              (
                              
                                 
                                    
                                       s
                                       k
                                       x
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                       k
                                       y
                                    
                                 
                              
                              )
                            along the x and y axes, respectively. Namely, the width and height of the previous block is scaled from (W
                           
                              B,k−1, H
                           
                              B,k−1) to 
                              (
                              
                                 
                                    s
                                    k
                                    x
                                 
                                 
                                    
                                       W
                                       
                                          B
                                          ,
                                          k
                                          −
                                          1
                                       
                                    
                                 
                                 ,
                                 
                                    s
                                    k
                                    y
                                 
                                 
                                    
                                       H
                                       
                                          B
                                          ,
                                          k
                                          −
                                          1
                                       
                                    
                                 
                              
                              )
                           . Finally, 
                              (
                              
                                 
                                    
                                       s
                                       k
                                       
                                          x
                                          *
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                       k
                                       
                                          y
                                          *
                                       
                                    
                                 
                              
                              )
                            is determined by comparing the mean value of pixel intensities between the bounding block of the previous slice and the scaled version of the bounding block of the current slice. Let 
                              
                                 
                                    I
                                    ¯
                                 
                                 
                                    x
                                    ,
                                    y
                                 
                              
                              (
                              W
                              ,
                              H
                              )
                            be the mean pixel intensity of the bounding block, centered at (x, y), whose width and height are W and H respectively. The mean pixel intensity 
                              
                                 
                                    
                                       I
                                       ¯
                                    
                                    
                                       (
                                       
                                          
                                             
                                                c
                                                
                                                   k
                                                   −
                                                   1
                                                
                                                x
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                                
                                                   k
                                                   −
                                                   1
                                                
                                                y
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                              (
                              
                                 
                                    W
                                    
                                       B
                                       ,
                                       k
                                       −
                                       1
                                    
                                 
                              
                              ,
                              
                                 
                                    H
                                    
                                       B
                                       ,
                                       k
                                       −
                                       1
                                    
                                 
                              
                              )
                            in the bounding block B
                           
                              k−1 is then compared with the mean pixel intensity 
                              
                                 
                                    
                                       I
                                       ¯
                                    
                                    
                                       (
                                       
                                          
                                             
                                                c
                                                k
                                                x
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                                k
                                                y
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                              (
                              
                                 
                                    s
                                    k
                                    x
                                 
                              
                              
                                 
                                    W
                                    
                                       B
                                       ,
                                       k
                                       −
                                       1
                                    
                                 
                              
                              ,
                              
                                 
                                    s
                                    k
                                    y
                                 
                              
                              
                                 
                                    H
                                    
                                       B
                                       ,
                                       k
                                       −
                                       1
                                    
                                 
                              
                              )
                            in the scaled bounding block. The optimal scaling parameter 
                              (
                              
                                 
                                    s
                                    k
                                    
                                       x
                                       *
                                    
                                 
                                 ,
                                 
                                    s
                                    k
                                    
                                       y
                                       *
                                    
                                 
                              
                              )
                            to minimize the difference is obtained by


                           
                              
                                 (20)
                                 
                                    (
                                    
                                       
                                          s
                                          k
                                          
                                             x
                                             *
                                          
                                       
                                       ,
                                       
                                          s
                                          k
                                          
                                             y
                                             *
                                          
                                       
                                    
                                    )
                                    =
                                    arg
                                    
                                       min
                                       
                                          (
                                          
                                             ω
                                             k
                                          
                                          ,
                                          
                                             η
                                             k
                                          
                                          )
                                       
                                    
                                    |
                                    
                                       
                                          
                                             
                                                
                                                   I
                                                
                                             
                                          
                                          k
                                       
                                    
                                    |
                                 
                              
                           where 
                              
                                 
                                    
                                       
                                          
                                             I
                                          
                                       
                                    
                                    k
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          I
                                          ¯
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   c
                                                   k
                                                   x
                                                
                                             
                                             ,
                                             
                                                
                                                   c
                                                   k
                                                   y
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              (
                              
                                 
                                    s
                                    k
                                    
                                       x
                                       *
                                    
                                 
                              
                              
                                 
                                    W
                                    
                                       B
                                       ,
                                       k
                                       −
                                       1
                                    
                                 
                              
                              ,
                              
                                 
                                    s
                                    k
                                    
                                       y
                                       *
                                    
                                 
                              
                              
                                 
                                    H
                                    
                                       B
                                       ,
                                       k
                                       −
                                       1
                                    
                                 
                              
                              )
                              −
                              
                                 
                                    
                                       
                                          I
                                          ¯
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   c
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                   x
                                                
                                             
                                             ,
                                             
                                                
                                                   c
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                   y
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              (
                              
                                 
                                    W
                                    
                                       B
                                       ,
                                       k
                                       −
                                       1
                                    
                                 
                              
                              ,
                              
                                 
                                    H
                                    
                                       B
                                       ,
                                       k
                                       −
                                       1
                                    
                                 
                              
                              )
                           . Finally, the parameters for characterizing the new estimated bounding block – (x
                           
                              B,k
                           , y
                           
                              B,k
                           ) and (W
                           
                              B,k−1, H
                           
                              B,k−1) – are updated by


                           
                              
                                 (21)
                                 
                                    (
                                    
                                       
                                          W
                                          
                                             B
                                             ,
                                             k
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          H
                                          
                                             B
                                             ,
                                             k
                                          
                                       
                                    
                                    )
                                    ←
                                    (
                                    
                                       
                                          s
                                          k
                                          
                                             x
                                             *
                                          
                                       
                                       ·
                                       
                                          
                                             W
                                             
                                                B
                                                ,
                                                k
                                                −
                                                1
                                             
                                          
                                       
                                       ,
                                       
                                          s
                                          k
                                          
                                             y
                                             *
                                          
                                       
                                       ·
                                       
                                          
                                             H
                                             
                                                B
                                                ,
                                                k
                                                −
                                                1
                                             
                                          
                                       
                                    
                                    )
                                    ,
                                 
                              
                           
                           
                              
                                 (22)
                                 
                                    (
                                    
                                       
                                          x
                                          
                                             B
                                             ,
                                             k
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                          
                                             B
                                             ,
                                             k
                                          
                                       
                                    
                                    )
                                    ←
                                    (
                                    
                                       
                                          
                                             c
                                             
                                                x
                                                ,
                                                k
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             c
                                             
                                                y
                                                ,
                                                k
                                             
                                          
                                       
                                    
                                    )
                                    −
                                    
                                       
                                          (
                                          
                                             
                                                W
                                                
                                                   B
                                                   ,
                                                   k
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                H
                                                
                                                   B
                                                   ,
                                                   k
                                                
                                             
                                          
                                          )
                                       
                                       2
                                    
                                    .
                                 
                              
                           where 
                              (
                              
                                 
                                    c
                                    k
                                    x
                                 
                                 ,
                                 
                                    c
                                    k
                                    y
                                 
                              
                              )
                              =
                              (
                              
                                 
                                    c
                                    
                                       k
                                       −
                                       1
                                    
                                    x
                                 
                                 ,
                                 
                                    c
                                    
                                       k
                                       −
                                       1
                                    
                                    y
                                 
                              
                              )
                              +
                              (
                              
                                 
                                    d
                                    k
                                    
                                       x
                                       *
                                    
                                 
                                 ,
                                 
                                    d
                                    k
                                    
                                       y
                                       *
                                    
                                 
                              
                              )
                           . Once the block-based search has been performed for the kth slice, the bounding block B
                           
                              k
                            in (21) and (22) is determined as illustrated in Fig. 8(c) and (d).

The initial control points of the kth slice, X
                        
                           k
                         are obtained as follows. First, distances between each control point and the central position, 
                           (
                           
                              
                                 r
                                 
                                    i
                                    ,
                                    k
                                    −
                                    1
                                 
                                 x
                              
                              ,
                              
                                 r
                                 
                                    i
                                    ,
                                    k
                                    −
                                    1
                                 
                                 y
                              
                           
                           )
                         of the (k
                        −1)th slice are calculated as
                           
                              (23)
                              
                                 
                                    
                                       
                                          (
                                          
                                             r
                                             
                                                i
                                                ,
                                                k
                                                −
                                                1
                                             
                                             x
                                          
                                          ,
                                          
                                             r
                                             
                                                i
                                                ,
                                                k
                                                −
                                                1
                                             
                                             y
                                          
                                          )
                                          =
                                          (
                                          
                                             
                                                
                                                   x
                                                   
                                                      i
                                                      ,
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   y
                                                   
                                                      i
                                                      ,
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                             
                                          
                                          )
                                          −
                                          (
                                          
                                             
                                                
                                                   c
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                   x
                                                
                                             
                                             ,
                                             
                                                
                                                   c
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                   y
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          
                                          
                                          
                                          for
                                          
                                          i
                                          =
                                          1
                                          ,
                                          2
                                          ,
                                          ⋯
                                          ,
                                          
                                             
                                                L
                                                
                                                   k
                                                   −
                                                   1
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        Next, distances between each control point and the central position, 
                           (
                           
                              
                                 r
                                 
                                    i
                                    ,
                                    k
                                 
                                 x
                              
                              ,
                              
                                 r
                                 
                                    i
                                    ,
                                    k
                                 
                                 y
                              
                           
                           )
                        , of the kth slice are calculated by scaling (23) by the amount 
                           (
                           
                              
                                 s
                                 k
                                 
                                    x
                                    *
                                 
                              
                              ,
                              
                                 s
                                 k
                                 
                                    y
                                    *
                                 
                              
                           
                           )
                        :


                        
                           
                              (24)
                              
                                 
                                    (
                                    
                                       
                                          r
                                          
                                             i
                                             ,
                                             k
                                          
                                          x
                                       
                                       ,
                                       
                                          r
                                          
                                             i
                                             ,
                                             k
                                          
                                          y
                                       
                                    
                                    )
                                 
                                 =
                                 (
                                 
                                    
                                       s
                                       k
                                       
                                          x
                                          *
                                       
                                    
                                    ·
                                    
                                       r
                                       
                                          i
                                          ,
                                          k
                                          −
                                          1
                                       
                                       x
                                    
                                    ,
                                    
                                       s
                                       k
                                       
                                          y
                                          *
                                       
                                    
                                    ·
                                    
                                       r
                                       
                                          i
                                          ,
                                          k
                                          −
                                          1
                                       
                                       y
                                    
                                 
                                 )
                                 
                                 for
                                 
                                 i
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 ⋯
                                 ,
                                 
                                    
                                       L
                                       
                                          k
                                          −
                                          1
                                       
                                    
                                 
                                 .
                              
                           
                        Finally, the initial control points of the kth slice, X
                        
                           k
                        , are decided by


                        
                           
                              (25)
                              
                                 (
                                 
                                    
                                       
                                          x
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                    
                                 
                                 )
                                 =
                                 (
                                 
                                    
                                       
                                          c
                                          k
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          c
                                          k
                                          y
                                       
                                    
                                 
                                 )
                                 +
                                 
                                    (
                                    
                                       
                                          r
                                          
                                             i
                                             ,
                                             k
                                          
                                          x
                                       
                                       ,
                                       
                                          r
                                          
                                             i
                                             ,
                                             k
                                          
                                          y
                                       
                                    
                                    )
                                 
                                 
                                 for
                                 
                                 i
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 ⋯
                                 ,
                                 
                                    
                                       L
                                       
                                          k
                                          −
                                          1
                                       
                                    
                                 
                              
                           
                        where the number of initial control points is L
                        
                           k−1, and is updated to L
                        
                           k
                         in Section 4.4.

For appropriate boundary segmentation the more irregular the shape of an object becomes, the greater the number of control points required. However, as the number of control points increases, so does the processing time for snake, which leads to a decrease in the agility of the algorithm when faced with a sudden shape change of the object. Furthermore, when the border is ambiguous between the target and neighboring objects, the magnitude of the gradient becomes smaller, resulting in condensation of control points toward a lower energy part of the contour due to the intrinsic properties of the snake algorithm. In this case, it is easy to fail to track the target object due to the influence of sudden variations of the object's boundary shape. Therefore, it is important to maintain a certain number of control points while placing initial positions appropriately to decrease processing time and maintain accuracy. In [20], a structure-adaptive strategy in a B-spline environment was developed to insert and delete knot points adaptively associated with the space and size of each object. In particular, knot points were added to parts greatly affected by external forces. In contrast, knot points influenced below a certain level of external force were deleted. Similarly, we propose an adaptive control point spacing algorithm that adaptively regulates the number of control points depending on the shape of the object while maintaining a certain distance between control points. In this way, rapid adaptation to shape variation between slices can be achieved.


                        
                           Algorithm 1
                           Adaptive control point spacing algorithm


                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                             
                                                Input:
                                             
                                          
                                          
                                             
                                             - Control points of the kth slice: x
                                                
                                                   i,k
                                                , (i
                                                =1, 2, …, L
                                                
                                                   k
                                                )
                                          
                                          
                                             
                                             - Control point insertion interval: l
                                                interval,
                                          
                                          
                                             
                                             - Insertion/deletion criterion: l
                                                MAX and l
                                                MIN.
                                          
                                          
                                             
                                             
                                                Output:
                                             
                                          
                                          
                                             
                                             - New control points: χ
                                                
                                                   i
                                                , (i
                                                =1, 2, …, L
                                                new).
                                          
                                          
                                             1:
                                             
                                                χ
                                                1
                                                ←
                                                x
                                                1,k
                                                , γ
                                                ←0, m
                                                ←1, L
                                                new
                                                ←
                                                L
                                                
                                                   k
                                                
                                             
                                          
                                          
                                             2:
                                             
                                                for
                                                 
                                                i
                                                =2:
                                                L
                                                
                                                   k
                                                
                                                 
                                                do
                                             
                                          
                                          
                                             3:
                                             
                                                Calculate the distance d
                                                
                                                   i
                                                 between two adjacent control points
                                          
                                          
                                             4:
                                             
                                                
                                                if
                                                 
                                                d
                                                
                                                   i
                                                 is larger than l
                                                MAX
                                                 
                                                then
                                             
                                          
                                          
                                             5:
                                             
                                                  Insert control points with an interval unit of l
                                                interval
                                             
                                          
                                          
                                             6:
                                             
                                                
                                                else if
                                                 
                                                d
                                                
                                                   i
                                                 is smaller than l
                                                MIN
                                                 
                                                then
                                             
                                          
                                          
                                             7:
                                             
                                                  Delete control points one-by-one to maintain an interval greater than l
                                                MIN
                                             
                                          
                                          
                                             8:
                                             
                                                
                                                else
                                             
                                          
                                          
                                             9:
                                             
                                                  Continue
                                          
                                          
                                             10:
                                             
                                                
                                                end if
                                             
                                          
                                          
                                             11:
                                             
                                                end for
                                             
                                          
                                       
                                    
                                 
                              
                           

A detailed description of the algorithm in pseudo code is presented in Algorithm 1. First, for all control points, the distance between two neighboring points is calculated counterclockwise (line 3). Next, for the ith control point, x
                        
                           i,k
                        , if the distance to an adjacent control point, d
                        
                           i
                        , in Fig. 9
                        (a), is longer than a pre-defined threshold, l
                        MAX, new control points are added between the two control points at unit intervals of l
                        interval, as illustrated in Fig. 9(b). Because the probability of tracking failure increases as the distance between two control points increases, Algorithm 1 contains lines 4–5, which are effective at preventing such tracking failure.

In contrast, if the distance between two control points is shorter than a pre-defined threshold, l
                        MIN, one of the control points is deleted as shown in Fig. 9(c) and (d). This deletion is performed until the distance is greater than l
                        MIN in a counterclockwise manner as described in lines 6–7 in Algorithm 1. After one point is deleted, the distance between the two control points is re-calculated and repeatedly compared to l
                        MIN. As shown in Fig. 9(e), if the distance is still shorter than l
                        MIN, another control point is deleted. When the distance l
                        
                           k
                         becomes larger than l
                        MIN, the deletion process is terminated and the aforementioned spacing process is resumed for the next (k
                        +1)th control point, as shown in lines 8–9 of Algorithm 1. Through the process of adjusting control points, the mean length (
                           
                              l
                              ¯
                           
                        ) between two control points converges statistically to 
                           
                              l
                              ¯
                           
                           =
                           
                              
                                 
                                    
                                       l
                                       MAX
                                    
                                 
                                 +
                                 
                                    
                                       l
                                       MIN
                                    
                                 
                              
                              2
                           
                        . Therefore, once l
                        interval is set to 
                           
                              l
                              ¯
                           
                        , each user can choose the threshold values (l
                        MAX and l
                        MIN) with satisfying 2·
                        l
                        interval
                        =
                        l
                        MAX
                        +
                        l
                        MIN. For example, if l
                        MAX
                        =1.5·
                        l
                        interval, then l
                        MIN
                        =0.5·
                        l
                        interval.

@&#EXPERIMENTS@&#

In this section, we present the data sets and performance evaluation methods of the experiment. We measured the SNT performance compared to the CV model [14], which is the most popular region-based level-set method. Table 3
                      shows the parameters used for the benchmarking between the proposed and CV models.

In detail, for snake, the meaning of each parameter is explained in Section 2.2, and for level-set, μ, ν, λ
                     1 and λ
                     2 represent energy contributions of length, area and pixel intensities of inside and outside the segmentation contour, respectively.

The proposed method was validated on both a synthetic vessel model and real chest CTA images.

The synthetic vessel model was generated using the tubular spiral structure formula in [21] with modifications as follows:
                              
                                 •
                                 Central position (x, y, z) of the skeletal structure
                                       
                                          –
                                          for 0<
                                             θ
                                             <3π
                                          


                                             
                                                x
                                                =
                                                
                                                   
                                                      
                                                         
                                                            
                                                               40
                                                               z
                                                            
                                                            150
                                                         
                                                         +
                                                         40
                                                      
                                                   
                                                
                                                cos
                                                θ
                                                ,
                                                y
                                                =
                                                
                                                   
                                                      
                                                         
                                                            
                                                               40
                                                               z
                                                            
                                                            150
                                                         
                                                         +
                                                         40
                                                      
                                                   
                                                
                                                sin
                                                θ
                                                ,
                                                z
                                                =
                                                
                                                   
                                                      300
                                                      θ
                                                   
                                                   
                                                      6
                                                      π
                                                   
                                                
                                             
                                          

Cross-section geometry
                                       
                                          –
                                          for 0<
                                             θ
                                             <3π circle of radius (r), 
                                                r
                                                =
                                                3.2
                                                
                                                   
                                                      
                                                         1
                                                         +
                                                         
                                                            θ
                                                            
                                                               2
                                                               π
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          

otherwise elongate ellipse with semimajor (a) and semiminor (b) axes gradually


                                             a
                                             =8, 
                                                b
                                                =
                                                10
                                                +
                                                
                                                   
                                                      
                                                         
                                                            θ
                                                            −
                                                            3
                                                            π
                                                         
                                                      
                                                   
                                                   π
                                                
                                             .

A total of 300 synthetic slices were generated along the z-axis of the synthetic model for every inter z in [10, 309]. To measure the performances of the proposed and CV models in a noisy environment, Gaussian noises, ranging from 0 to 20db with 5db offset, were added to the synthetic slices.

Chest CTA images were obtained with a Discovery CT750HD (General Electric Company, United States). The CTA image dimensions were 512×512×467 pixel3 with a voxel resolution of 0.2638×0.3411×0.434mm, and we resampled the image with isotropic voxel resolution of 0.5mm. Given the CTA images shown in Fig. 10
                           , the descending aorta (DA), abdominal aorta (AA), and superior mesenteric artery (SMA) were chosen to evaluate the performance of SNT.

These three subject vessels had following characteristics: the DA was straight and had a large diameter; the AA was also straight and its diameter was large, but it had many small branch vessels; the SMA had a small diameter and was somewhat curly.

To quantify the quality of segmentation and tracking, we used the corresponding standard Receiver Operating Characteristic (ROC) curve [22]. The ROC curve is a plot of True Positive Rate (TPR) wrt False Positive Rate (FPR) of the segmentation result for a discrimination threshold (T). For the quality measure using the ROC curve we used the Area Under the Curve (AUC), which represents an average discrimination performance.

For calculation of TPR and FPR, a bounding block including the ground truth and the segmentation result was created, as shown in Fig. 11
                        . The pixels in the block were then classified according to the confusion matrix [23] in Table 4
                        , and the occurrence of each entry was counted.

The count variables are denoted as N
                        
                           TP
                        , N
                        
                           FP
                        , N
                        
                           FN
                         and N
                        
                           TN
                        , which refer to the number of pixels of true positive (TP), false positive (FP), false negative (FN), and true negative (TN), respectively. Then, based on the four count variables listed above, TPR and FPR are determined as


                        
                           
                              (26)
                              
                                 TPR
                                 =
                                 
                                    
                                       
                                          N
                                          TP
                                       
                                    
                                    
                                       
                                          
                                             N
                                             TP
                                          
                                       
                                       +
                                       
                                          
                                             N
                                             FN
                                          
                                       
                                    
                                 
                                 
                                 
                                    
                                    and
                                    
                                 
                                 
                                 FPR
                                 =
                                 
                                    
                                       
                                          N
                                          FP
                                       
                                    
                                    
                                       
                                          
                                             N
                                             TN
                                          
                                       
                                       +
                                       
                                          
                                             N
                                             FP
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        For the bounding block, its center position and size (width and height) are determined as follows: The center position of the bounding block is same as that of the minimum bounding block in Fig. 11, which contains the ground truth and segmentation result. The size of the bounding block is decided using predefined prevalence (
                           
                              π
                              ˆ
                           
                        ), in other words, the prevalence (π) of the bounding block must be 
                           
                              π
                              ˆ
                           
                        . The definition of prevalence is as follows:


                        
                           
                              (27)
                              
                                 π
                                 =
                                 
                                    
                                       
                                          
                                             N
                                             TP
                                          
                                       
                                       +
                                       
                                          
                                             N
                                             FN
                                          
                                       
                                    
                                    
                                       
                                          
                                             N
                                             TP
                                          
                                       
                                       +
                                       
                                          
                                             N
                                             FN
                                          
                                       
                                       +
                                       
                                          
                                             N
                                             FP
                                          
                                       
                                       +
                                       
                                          
                                             N
                                             TN
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        Because TPR and FPR are uncalibrated measures [24], to calibrate the measures for every slice, we had to adjust the size of the bounding block. This could be achieved using the predefined prevalence criterion, i.e., the prevalence of every slice was set to 
                           
                              π
                              ˆ
                           
                        .

On the other hand, to obtain the ROC curve, the threshold T should be controlled. It can be seen from Fig. 12
                         that once the segmentation is performed, the thresholding operation can be conducted using the erosion and dilation operations, respectively. In detail, because the erosion operation decreases the value of N
                        
                           FP
                        , it decreases FPR and results in a high threshold value on the ROC space. In contrast, for the dilation operation, the value of N
                        
                           FN
                         is reduced, resulting in an increase in TPR and a low threshold on the ROC space.

The ground truth images for the synthetic model can be easily obtained using the equations in Section 5.1. For CTA slices, we used an image editing tool for manual segmentation of each vessel to obtain the ground truth images.

Segmentation of the first slice is performed by determining an initial contour that is provided by users. For fair comparison, however, in this paper randomly generated initial contours produced by the Monte–Carlo method were used to obtain average performance metrics of SNT.

If we define TPR
                           i
                         and FPR
                           i
                         as TPR and FPR of the ith slice respectively, success or failure of the segmentation of the ith slice is decided by comparing their values with the predefined threshold, T
                        
                           eval
                        . Namely, if TPR
                           i
                        
                        >
                        T
                        
                           eval
                         and FPR
                           i
                        
                        <
                        T
                        
                           eval
                        , the segmentation of the ith slice is considered successful. Otherwise, the segmentation is regarded as failure, and the tracking procedure ends at the ith slice. After the SNT procedure ends, the number of successfully segmented slices, denoted as N
                        
                           seg
                        , was counted and used as the performance index for tracking.

To evaluate the segmentation performance, the average TPR and FPR over N
                        
                           seg
                         slices were calculated as follows:


                        
                           
                              (28)
                              
                                 
                                    TPR
                                    ¯
                                 
                                 =
                                 
                                    1
                                    
                                       
                                          N
                                          seg
                                       
                                    
                                 
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          N
                                          seg
                                       
                                    
                                 
                                 
                                    TPR
                                    i
                                 
                                 ,
                                 
                                 
                                    
                                    and
                                    
                                 
                                 
                                 
                                    FPR
                                    ¯
                                 
                                 =
                                 
                                    1
                                    
                                       
                                          N
                                          seg
                                       
                                    
                                 
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          N
                                          seg
                                       
                                    
                                 
                                 
                                    FPR
                                    i
                                 
                                 .
                              
                           
                        
                     

The SNT performance of the proposed algorithm relies heavily on the position of the initial control points. Therefore, a sensitivity analysis for the initial control points is required. In addition, the number of control points on the contour affects its computation time and SNT performance. In other words, as the number of control points grows, the SNT performance increases, but the computation time also increases. Thus, we performed sensitivity analysis in terms of the two parameters mentioned above (the position of initial control points and the number of control points). Based on this trade-off, the parameters of the proposed algorithm could be determined.

Based on Algorithm 1, the number of control points can be increased or decreased adaptive to the length of the contour. In order to determine the number of control points more consistently, the length between the two consecutive control points, l
                           interval, should be specified. Depending on the value of l
                           interval, the number of control points can vary for a given contour. Therefore, we measure the sensitivity of the proposed algorithm according to the number of control points while changing l
                           interval.


                           Table 5
                            shows the value of N
                           
                              seg
                            according to l
                           interval for synthetic and real vessels, where T
                           
                              eval
                           , l
                           MAX, and l
                           MIN values are set to 0.9, 1.5·
                           l
                           interval, and 0.5·
                           l
                           interval, respectively. As shown in Table 5, larger l
                           interval is associated with a smaller N
                           
                              seg
                            value when l
                           interval is in the range of 0.9–1.5. In contrast, when l
                           interval is 0.5 or 0.7, the value of N
                           
                              seg
                            shows little change. Consequently, it can be concluded that the optimal value of l
                           interval is around 0.7 in terms of SNT performance and time consumption.

The segmentation of the first slice is performed based on the initial contour constructed by using initial points input by users, and the accuracy of this initial segmentation is one dominant factor for vessel tracking. Therefore for fair comparison with conventional algorithms, it is necessary to conduct sensitivity analysis wrt the position of initial control points. Therefore, as shown in Fig. 13
                           , random initial control points are generated by adding Gaussian random noise to the initial control points for various pixel standard deviations (σ
                           
                              p
                           ). For the synthetic vessel, the initial control points are determined using the ground truth model described in Section 5.1.1. Also, for the real vessel, manually assigned points are utilized as the initial control points. Then, the sensitivity analyses are conducted by measuring N
                           
                              seg
                            wrt σ
                           
                              p
                           .


                           Table 6
                            shows the value of N
                           
                              seg
                            for the synthetic and real vessels when various random control points are input differently according to noise. For each vessel, 100 random control points are generated using σ
                           
                              p
                           . It can be seen from Table 6 that for larger σ
                           
                              p
                           , N
                           
                              seg
                            is the smaller. Also, if σ
                           
                              p
                            is less than or equal to 0.4, N
                           
                              seg
                            is decreased slightly, but above that value, N
                           
                              seg
                            is reduced considerably.

@&#RESULTS AND DISCUSSION@&#

In this section, we present the experimental results of the proposed method on the synthetic model and the real CTA images described in Section 5.1. In Fig. 14
                     , some example images are shown for the SNT procedure on DA. As shown in Fig. 14(a)–(c), in the initialization procedure user input points are determined and interpolated, and the initial vessel boundary is segmented. In the iteration procedure (Fig. 14(d)–(g)), the initial contour for the current slice is estimated from the contour of the previous slice using the state-transition matrix. After that, the snake algorithm is performed to obtain the measurement for the current slice. However, as can be seen in Fig. 14(e), an improper segmentation occurs in a part of the contour. To compensate for this, a measurement update process of the Kalman filter is applied to obtain a more accurate result, as shown in (f). However, some intervals between control points can be too wide or narrow along the contour. To adjust inappropriate intervals, the adaptive control points spacing algorithm is exploited to obtain more uniform control points, as shown in (g).

To compare the results with the CV model, in the following subsections we measured the three aforementioned performance metrics (
                        
                           N
                           seg
                        
                        ,
                        
                           TPR
                           ¯
                        
                     , and 
                        
                           FPR
                           ¯
                        
                     ) according to the elapsed time (t
                     
                        elap
                     ) by changing the iteration number per each slice (K).

In this section, the SNT results are demonstrated in noisy synthetic images. The performance is compared using the values of N
                        
                           seg
                        , 
                           
                              TPR
                              ¯
                           
                        , and 
                           1
                           −
                           
                              FPR
                              ¯
                           
                        . For clarity of expression, let 
                           
                              TPR
                              ¯
                           
                        
                         be sensitivity (SEN) and 
                           1
                           −
                           
                              FPR
                              ¯
                           
                         be specificity (SPC). For each algorithm, the three metrics for several noise levels are presented in Table 7
                        , and the differences between the two models for each metric are also shown. The iteration number for the CV and proposed model was increased from 5 to 37 and from 15 to 137, respectively.


                           Fig. 15
                            demonstrates the performance of the proposed method relative to the CV model. The figures in the first, second, and third columns represent N
                           
                              seg
                           , SEN, and SPC wrt t
                           
                              elap
                           , respectively. It can be seen from the first to third columns that N
                           
                              seg
                           , SEN, and SPC of the CV model are lower than those of the proposed model for all noise levels. In detail, for the first column in Fig. 15, the difference in SEN between the two models is large at low t
                           
                              elap
                           . However, at high t
                           
                              elap
                           , N
                           
                              seg
                            of the CV model converges to that of the proposed model. As shown in the second column of Fig. 15, this tendency is also seen in the value of SEN. However, for SPC, the difference between SPC values of each model is very small compared with SEN values and is not diminished wrt t
                           
                              elap
                           . For each metric value, the value itself, not difference, is converged wrt t
                           
                              elap
                           , and specifically, the values for the proposed model are saturated earlier wrt t
                           
                              elap
                           .

It can be seen that, on average, the proposed algorithm outperforms the CV model. For limited elapsed time (low t
                           
                              elap
                           ), the performance difference between the two models will increase. Conversely, it can be seen that, on average, to meet a certain level of segmentation quality, the execution time for the proposed algorithm will be small compared with the CV model. This result demonstrates the time efficiency of segmentation using our model.

We also provided the average noise performance of both methods in Table 7. The metric values for each noise level were obtained by averaging the metrics over all of the iterations. It should be noted that the metric values at high noise level are small compared with those at low noise level. Moreover, it can be seen that if the noise level is the same, the proposed algorithm outperforms the CV model, and the difference between the values increases gradually from low to high noise level. For the image with high density noise, it can be expected that the proposed method will show better SNT performance than the CV model.


                           Fig. 16
                            shows the ROC curves and their corresponding AUC values, but the curves cannot be easily distinguished. However, as shown in the values of AUC, the proposed model is proved to have better segmentation performance than the CV model.

To show SNT performance in a more difficult situation, we skipped every even slice of the synthetic model, i.e., we used only the odd slices for SNT. In this environment, the position and shape of the vessel segment change more rapidly between slices than in Simulation 1.

It can be seen from Fig. 17
                            that for all three metrics, the overall performance of the proposed model is better than that of the CV model. In the case of N
                           
                              seg
                            and TPR, the differences of each performance metric value between Simulations 1 and 2 are as follows: for Simulation 1 each metric value of the CV model converges to that of the proposed method, whereas for Simulation 2 the differences between the metric values are not diminished wrt t
                           
                              elap
                            and the value is higher than that of Simulation 1. This performance gap is due to the inherent disadvantage of the CV model, which does not use inter-slice information. In the next experiment, we focus on ROC analysis and the AUC value for evaluating the overall tracking performance.


                           Fig. 18
                            shows the ROC curves and their corresponding AUC values. It can be seen that the ROC curves of the proposed method are slightly above those of the CV model, and their corresponding AUC values are also higher than those of the CV model. Thus, like Simulation 1, the overall performance of the proposed model is proved to be better than the CV model.

In this section, we present the SNT results for three vessels (DA, AA, and SMA) on chest CTA in Section 5.1. The iteration number for the CV and proposed models was increased from 10 to 50 and from 100 to 200, respectively.


                           Fig. 19
                            demonstrates the performance of the proposed model relative to the CV model. In Fig. 19, the figures in the first, second, and third columns represent N
                           
                              seg
                           , SEN, and SPC wrt t
                           
                              elap
                           , respectively. Similar to Simulation 1, the values of N
                           
                              seg
                           , SEN, and SPC for the CV model are lower than those of the proposed model for all three vessels. In detail, for the proposed algorithm, there are no significant changes wrt t
                           
                              elap
                            in the values of each metric. However, for the CV model, the metric values are saturated wrt t
                           
                              elap
                           . The average values of each performance metric for those three vessels are provided in Table 8
                           .

As shown in Table 8, in terms of N
                           
                              seg
                           , both algorithms can successfully segment all images of each vessel, but there are differences in SEN and SPC. In general, the values in SEN are higher than those in SPC. In terms of the type of vessel, the difference in values are increases in the order of DA, AA, and SMA. On average, the proposed model is superior to the CV model in terms of the SNT performance. In addition, the performance difference gradually increases as t
                           
                              elap
                            moves to a low value. Moreover, the proposed method is also superior if the diameter of a vessel is small or the vessel has small branches.


                           Fig. 20
                            shows the ROC curves and their corresponding AUC values. It can be seen that, like Simulation 2, the ROC curves of the proposed model are slightly above the curves of the CV model, and their AUC values are also higher than those of the CV model. Therefore, it can be concluded that the overall performance of the proposed method is proved to be better than the CV model.

To show the SNT performance in a more difficult situation, we skipped every even slice of the chest CTA as in Simulation 2.

It can be seen from Fig. 21
                            that for all three metrics, the overall performance of the proposed model is better than that of the CV model. In the next experiment, we also focus on the ROC analysis and AUC values.


                           Fig. 22
                            shows the ROC curves and their corresponding AUC values. Those ROC curves and AUC values obviously show that the overall performance of the proposed model is better than that of the CV model. Also, it should be noted that the differences in AUC increase in the order of SMA, AA, and DA.

The computing time of the models was also measured. The models were implemented by MATLAB 2012b with 8GB memory and Intel® Core™2 Quad CPU Q9400 at 2.66GHz. Table 9
                         shows the result of the time consumption analysis. For both the synthetic model and chest CTA, there was an improvement of approximately 20% in performance wrt time consumption.

@&#CONCLUSIONS@&#

In this study we developed a 3D vessel tracking model called the adaptive Kalman snake by jointly employing an active contour model and the Kalman filter, both of which have been widely used in automatic control algorithms in the field of computer vision. The arbitrarily-shaped blood vessel boundary was segmented on each slice using the active contour model, whereas the Kalman filter was used to track translation and shape deformation between CTA slices. To obtain refined segmentation results, an adaptive control point spacing algorithm is introduced into the active contour model. Moreover, a block search-based initial contour estimation procedure is proposed to ensure that the initial contour of every slice can be placed near the vessel boundary. Experiments were performed on synthetic and in vivo chest CTA images. For the performance evaluation, SEN and SPC were calculated using a binary classification test. Based on such statistical measures, the number of successfully segmented slices (N
                     
                        seg
                     ), ROC curves, and corresponding AUC values can be obtained. The performance comparison showed that the proposed algorithms have better SNT performance than the CV model. In particularly, as the elapsed time for each algorithm decreases, the performance difference between the two algorithms increases. This demonstrates the time efficiency for segmentation using our model. In addition, we found that if a vessel boundary varies rapidly between slices, the proposed model will have a greater advantage in SNT performance, i.e., our model is more robust in tracking than the CV model. In the synthetic model, the proposed model also shows better performance over the CV model in a noisy environment, i.e., as the noise level is increased, the proposed method shows better performance than the CV model. Also, in a real CTA model, the proposed method has strong SNT performance in curly, short-diametered, or branched vessels. In future work we will extend the current model to track not only parallel to the slice, but also in arbitrary vessel directions.

@&#ACKNOWLEDGEMENTS@&#

This work was supported (in part) by the Yonsei University Future-leading Research Initiative of 2014 (2014-22-0162).

@&#REFERENCES@&#

