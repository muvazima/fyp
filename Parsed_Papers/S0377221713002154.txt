@&#MAIN-TITLE@&#Speciality oils supply chain optimization: From a decoupled to an integrated planning approach

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose linear models for the supply chain of a speciality oils’ company.


                        
                        
                           
                           We consider operation and sales decisions in decoupled and integrated approaches.


                        
                        
                           
                           The integrated outperforms the decoupled planning for the company.


                        
                        
                           
                           The sellers may get worse premiums in the integrated solution.


                        
                        
                           
                           Company and sellers are better off by reallocating the integrated contribution.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Supply chain management

Integrated planning

Decoupled planning

Linear programming

Contribution sharing

OR in the oil industry

@&#ABSTRACT@&#


               
               
                  We study a problem of tactical planning in a divergent supply chain. It involves decisions regarding production, inventory, internal transportation, sales and distribution to customers. The problem is motivated by the context of a company in the speciality oils industry. The overall objective at tactical level is to maximize contribution and, in order to achieve this, the planning has been divided into two separate problems. The first problem concerns sales where the final sales and distribution planning is decentralized to individual sellers. The second problem concerns production, transportation and inventory planning through refineries, hubs and depots and is managed centrally with the aim of minimizing costs. Due to this decoupling, the solution of the two problems needs to be coordinated in order to achieve the overall objective. In the company, this is pursued through an internal price system aiming at giving the sellers the incentives needed to align their decisions with the overall objective. We propose and discuss linear programming models for the decoupled and integrated planning problems. We present numerical examples to illustrate potential effects of integration and coordination and discuss the advantages and disadvantages of the integrated over the decoupled approach. While the total contribution is higher in the integrated approach, it has also been found that the sellers’ contribution can be considerably lower. Therefore, we also suggest contribution sharing rules to achieve a solution where both the company and the sellers attain a better outcome under the integrated planning.
               
            

@&#INTRODUCTION@&#

Integrating decisions about production with other functions in the supply chain, such as inventory and distribution, has proved to be of significant relevance in organizations. An important body of Operations Research literature has been devoted to this issue, as reviewed by Erengüç et al. [10]. The basic idea of an integrated model is to simultaneously optimize decision variables of different functions that have traditionally been optimized in a sequence where the output of one stage was used as the input to other stage [27]. Aligning decisions under the same goal can be challenging when the objectives of the different functions are in conflict or not fully aligned with each other. Successful implementations in practice, such as King and Love [16] in the tyre industry and Martin et al. [20] in the flat glass industry, have reported significant benefits through the use of linear programming models under an integrative perspective.

In this paper, we address a problem of tactical planning in a divergent supply chain. Our motivation comes from working in a project with a company in the speciality oils industry. The logistics network is composed of refineries, hubs, depots and sales offices. Refineries and hubs act as production units. Hubs and depots serve as storage of saleable products. Sales offices are the channel for fulfilling demand from customers (but the products are never handled at the offices). Although owned by the company, the sales offices are managed independently and the decision on how to ship to customers is decentralized. According to the demand they observe, the sellers make decisions on type and amount of products to order, and from which storage location to order from. This decision is mainly driven by an internal price set by the company and the distribution cost calculated by the seller. The internal price aims at reflecting all variable costs caused by a product until it is ready to be shipped to the market. This price is set for each product and each location where it is stored. After a sale is realized, the seller receives a percentage of the contribution margin (revenue minus the internal price and minus the cost of distribution to customers), and the rest of the revenue is received by the company itself.

The production is conditioned by fixed proportions between the output of different products, while the demand for different products does not necessarily have the same proportions as the output from production. The supply chain planning of the company thereby faces conflicts when aligning operations activities with sales requirements.

We formulate linear programming models to represent this supply chain, considering decisions on production, inventory, internal transportation, sales and distribution to customers. In an initial approach we propose decoupled models to represent the situation where sales and distribution to customers are decided separately from the rest of the functions in the supply chain. Then, we integrate all the decisions into one model and analyze its potential to improve the performance in comparison to the decoupled models.

Integrating planning has been one of the main topics studied by recent literature in the oil supply chain. From earlier simple representations, as in the logistic planning model by Sear [28], more complex works have been reported recently. Pinto et al. [23] work on planning and scheduling applications for refinery operations. Neiro and Pinto [21] propose a model for a petroleum supply chain in the context of the Brazilian company Petrobras, integrating sources, terminals, refineries, distribution centres and consumers. Bengtsson et al. [3] integrate production and logistics decisions under uncertainty in ship arrivals. Guyonnet et al. [14] explore the potential benefits of an integrated model involving three parts of the crude oil supply chain: unloading, oil processing, and distribution. To build the unloading model, they use the scheduling model in Reddy et al. [26] as a base, while their production planning model is based on the model by Pinto and Moro [24]. For the distribution part, they develop a third model. Then, the three models are linked assuming the unloading section, the refinery, and the distribution centre are connected by pipelines. In these works, one of the main challenges is given by the numerous non-linear constraints originating from computing the properties of the products after being processed. When the planning horizon consists of various time periods, it becomes quite hard to solve real-world instances. In fact, a recent overview of refinery planning and scheduling by Bengtsson and Nona˚s [4] have identified the handling of non-linearities as one of the main issues in the agenda for future work.

A distinction of the problem we deal with is that fixed and unique recipes are used to mix each final product from semifinished products. These recipes are found through test runs at the refinery or solving short term operational planning problems to ensure detailed product quality requirements. This characteristic allows us to approach the problem by linear programming, in both the decoupled and the integrated approaches. A second distinction of our problem is the sales mechanism involved in the supply chain. Normally, in the oil planning literature it has been assumed that the objectives of the sales units are aligned with the objectives of the whole company. This assumption is reflected in the use of a revenue term in the objective function without discussion on how the revenue is shared among the different actors in the supply chain. The agreement among the actors has been identified by Erengüç et al. [10] as a particularly important issue on the integration of production and distribution planning in supply chains, because these agreements will determine to a large extent whether each component of the chain will be motivated to achieve the cost reductions by integrating decisions across the chain. In the decoupled version of the problem approached in this article, we give insights in the case where the interests of different decision makers in the oil supply chain are not aligned. This has been a research topic in other industrial contexts (see, for example, the problem of a furniture company by Ouhimmou et al. [22], and the problem of an oriented strand board manufacturing company by Feng et al. [11,12]).

Our contribution is threefold. First, we formulate a series of linear programming models to approach a real-world problem in the speciality oils supply chain where the current planning is based on a decoupled decision making mechanism. These models are critical to model the behavior of the coordination between sales and production. Earlier the planning did not take into account the behavior of the sellers. These models also include an important part with coordination prices at the depots. Second, we propose an integrated planning model which maximizes the contribution of this supply chain. Although the integrated planning outperforms the decoupled planning from the whole company’s perspective, the sellers echelon may be left with a worse outcome. As third contribution, we identify this issue as a shortcoming of the integrated planning and discuss allocation rules to overcome it, leading to a solution where both the sellers and the company are better off in the integrated case.

The remainder of this article is organized as follows. In Section 2, we present the production process and supply chain involved in our problem. In Section 3, we describe planning and management issues in this supply chain. In Section 4, we formulate linear programming models to represent sales and operations as decoupled problems. In Section 5, we propose a linear model that integrates sales and operations decisions. In Section 6, we provide numerical results of the models, compare their outcomes and discuss premium allocations. Our concluding remarks are presented in Section 7.

The oil industry faces a number of problems that have caught the attention of the Operations Research field. Bodington and Baker [5], Cooper [8] and Iachan [15] document that during several years the oil industry and OR have been linked in a number of applications. The oil industry has also been identified as a typical example of a divergent supply chain [29,17]. This is the case of the supply chain for speciality oils that we face in our problem, which is characterized by a divergent product structure as well as a divergent physical structure. A representation of the supply chain is presented in Fig. 1
                     . Next, we describe its main parts.

The refineries are supplied with crude oil from external suppliers. There are different types of crude oil, some of them containing more percentage of one or another component. This determines if a type of oil is more suitable to produce one or another final product. In the refineries, the crude oils are exposed to a series of processes, in order to generate saleable products. There are two product segments, that we call basic oil products and speciality oil products (or simply basic oils and speciality oils). The processes in the refineries and hubs differ somewhat for different products, but they can be simplified to the following three steps: distillation, hydrotreatment and blending.

During the distillation process the crude oil is divided into several fractions. The characteristics of the fractions depend on which crude oil and run-mode are used and the run-mode defines the division between the fractions contained within the crude oil. This determines the characteristics of the different distillates, for instance, in terms of the hydrocarbons that will be contained within them, viscosity and point of ignition. There are several run-mode alternatives. Given a run-mode and a type of crude oil, the proportions between the distillates obtained from the process are fixed and hence, if generation of more of a certain distillate is desired, then more of the other distillates obtained in this run-mode will also be generated.

During the hydrotreatment process, the distillates obtained from the distillation receive desired properties with respect to density, volatility flashpoint, pour point and color. Impurities, such as sulfur, are also removed in this process. The products resulting from this stage are the basic oil products. Some of them are already saleable products, but they can also be used for blending, in order to generate the more sophisticated speciality oil products.

Blending is the last part of the production process. This part does not take place at the refineries, as the distillation and hydrotreatment processes do, but in the hubs later in the supply chain. During the blending process, the basic oils are mixed with each other and sometimes with additional components to create desired properties for the speciality oil products, which are saleable products of higher value in the market.

When the saleable products have completed processing, they are transported to depots that serve as storage locations. In addition, the hubs where the blending process takes place, also act as storage locations of saleable products. The refineries also serve as storage locations for crude oils and basic oils.

From the refineries, some few products will be sent directly to the depots, while most will go through one of the hubs. Normally, the storage locations will be supplied from the closest processing unit (refinery or hub), but note that not all products are generated in each of these units.

Sellers perform the product transactions with customers in a number of local markets. The customers for basic and speciality oil products include firms in construction, road building, pipe coating and automotive industries.

We distinguish between primary and secondary transportation or distribution. Primary distribution corresponds to the transportation of oils within the facilities (refineries, hubs and depots), while secondary distribution corresponds to the transportation of products to the customers.

The transportation of crude oil from supply sources to refineries is carried out by ships, which is also the dominating mode of transport from refineries to hubs and depots.

From hubs to depots and from these locations to the customers, the means of transport varies more, since the volumes are smaller and variable. When ships are used, the oil is usually transported in tanks or specially equipped containers that can be transported by any container ship. For the transportation of products to the customers, tank trucks are used more often. On occasion, a combination of ship and truck is used and less often, train and tank trucks are also used.

Current planning and management of the supply chain are performed in three main stages, one involving strategic decisions and two involving tactical decisions.

The strategic planning considers decision on how much crude oil will be used in a year and performs aggregated estimations in order to check that there will be a reasonable balance between production and demand of different products. The agreements with the crude oil suppliers are usually based on long-term contracts, revised a couple of times per year only, so we will assume the amounts of crude oils incoming to the refineries are fixed parameters.

Our research focuses on the tactical level, which includes two stages. One stage is performed by the supply chain planners and the planners at refineries and hubs. Monthly forecasts together with current inventory levels are used to generate weekly production plans, normally considering a horizon of 3months divided in 12weekly periods. Decisions involved in the plan are amount of each product to produce in each location, primary distribution of basic oil products between refineries and hubs or depots, primary distribution of speciality oils between hubs and depots, and storage of all types of oils at the facilities. This plan is continuously revised as the sales orders are realized and production plans can normally be changed with one week’s notice.

A second stage involves planning of the secondary distribution, from hubs and depots to the customers. This planning is based on a mechanism with internal pricing. For each depot, each product is given an internal price. This internal price plus the distribution cost from storage location to the customer results in a figure that we call the value chain cost. The sellers’ premiums to a great deal depend on the margin they can achieve between the sales price and the value chain cost. Hence the value chain cost plays a major role in the sellers decision making. We describe the computation of the value chain cost in detail below.

An internal pricing mechanism considers the assignment of premiums to the sellers, depending on their sales results. One significant part of the premiums is the difference between the sales price and the value chain cost. In consequence, for each sale, a main goal of the sellers is to maximize this difference so as to maximize their own premiums.

The value chain cost is intended to reflect the variable costs of production, distribution and storage of the product within the supply chain over a 5–10-year perspective. Some of the variable costs are actual costs, while some are estimated. In addition to the variable costs, the value chain cost also includes a distributed fixed cost for all the depots where the products have been stored, based on the volumes that flowed through each depot the previous year. It is a challenge to set accurate value chain cost values per product, because of the difficulty in distributing some of the production cost among them. Some of the costs involved in the value chain cost are updated every month while others may remain the same over a whole year.

The idea from the company is that this mechanism should be self regulatory and make the sellers act in such a way that, while acting in their own interests, they minimize the total long term cost of distribution for the company. In practice, however, this control mechanism is not exempt from imperfections and this will be evident from our numerical experiments.

The value chain cost is calculated as follows:


                        Value
                        
                        chain
                        
                        cost
                        =
                        Cost
                        
                        of
                        
                        goods
                        
                        sold
                        +
                        Primary
                        
                        distribution
                        
                        cost
                        +
                        Secondary
                        
                        distribution
                        
                        cost.

The Cost of goods sold (COGS) includes raw material cost, cost for externally procured products, exchange rates and processing costs in refining and blending.

The Primary distribution cost is related to the distribution to storage facilities, including depot freight and associated costs of running depots and hubs.

The Secondary distribution cost includes the transport cost to the customer, a cost for filling the product in drums and other variable costs (such as import taxes).

In practice, the company centralizes the calculation of COGS and the Primary distribution cost, resulting in what is called the internal price. Hence,


                        Value
                        
                        chain
                        
                        cost
                        =
                        Internal
                        
                        price
                        +
                        Secondary
                        
                        distribution
                        
                        cost.

For each sale opportunity the secondary distribution cost is calculated by the seller for different supply options and added to the internal price, thus completing the total value chain cost. The sale price is based on a negotiation between the seller and the customer. Of course, the sales price normally exceeds the value chain cost. When the sale is realized, the seller receives a premium, the main share of which is proportional to the gross result of the sale (revenue minus total value chain cost).

For each sale, the seller has a choice from which depot to supply the customer from (assuming availability). Both the internal price and the secondary distribution cost depend on which depot the product will be shipped from. Hence, it is not necessarily convenient for the seller to order the product from the closest depot (or the one with cheapest transportation cost), because the same product can have different internal prices in different depots. It is also not always best for the seller to order from the depot with the lowest internal price, because the transportation cost from the depot to the customer might be too high. Normally, the seller will choose to supply from the depot with the lowest sum of these two. In practice, there might be other factors affecting the choice, such as a particular preference requested by the customer or a lead time limitation based on the terms the sale has been agreed on, but our research interest focuses on the value chain cost factor. An illustrative situation is described in Fig. 2
                        .

In this example, the value chain cost from the first depot is 520; from the second depot, 530; and from the third depot, 540. Assuming a given sale price agreed with the customer, the seller will choose to ship from Depot 1, since it has the lowest value chain cost and therefore awards the highest premium. However, this is not necessarily the most cost efficient way to distribute for the company as a whole. As we will show later, integrating distribution decisions with the production planning decisions in the supply chain can in fact outperform the current decoupled system where the sellers make distribution decisions in a decentralized way.

Each seller forecasts monthly sales in his area. The forecast is normally based on a 1-year horizon. Each month, the sellers update the forecast information into a central system of the company. The sellers base their forecast mainly on their judgement and perceptions of last sales periods.

Depending on the type of product, different patterns of sales demand are observed; some present high seasonality in demand, with peaks during the northern hemisphere summer, while the demand for other products is more stable.

As described earlier, the refineries utilize different types of crude oil, each with different component properties. Depending on the type of crude oil and the run-mode used, the yields of basic and speciality oils are different. The high seasonality of some products impacts the production and inventories of other products even if the seasonality of these other products is not as big. In practice, there is little flexibility to cope with the seasonal variations. The inflow of crude oils is more or less continuous during the year, resulting in large seasonal inventories of crude oil while trying to cope with seasonal variations of the sold products by refining different crude oils during the year. High levels of inventory throughout the entire product range is hence the consequence as a result of trying to counteract the seasonality.

At the geographical level, recall that independent of the seller’s regional location, he or she can order products from each of the depots within the company’s network. Balancing inventories in different depots, while at the same time satisfying demand, leads to a challenging problem for the planners.

In this section, we develop models to represent the tactical planning including the refineries and echelons downstream. The information to formulate the model has been gathered through repeated interviews of people in supply chain and production planning in a main company in the speciality oils industry, as well as from data files containing information on sales, costs and other relevant variables and parameters.

Our formulation formally states the problem of having sales and operations as non-coordinated units. In the operations units, we include production (at refineries and hubs), inventory (at refineries, hubs and depots) and distribution (from refineries to hubs and depots, and from hubs and depots to customers). Recalling that the procurement of crude oils is programmed at a more strategic level, in our model we thus consider the amount of crude oil incoming to the refineries as a given parameter.

We start by formulating minimum cost and maximum revenue models to motivate the different interests of sales and operations units. Then, we formulate decoupled models and the coordination constraints that the company has implemented to partly balance both perspectives. Note that because of the high standardization of the speciality oils, its production occurs according to fixed recipes. The recipe state the amount of each basic oil that must be used in order to generate one unit of each speciality oil product. This characteristic allows us to model the problem by using linear formulations, unlike the literature dealing with cases in the absence of fixed recipes where the properties of the final products relate to the properties of the mixed components through non-linear relations. A classical example of such non-linearities is the pooling problem [2], which is a short term operational problem that can be used to set the fixed recipes as discussed earlier.

In what follows, we introduce the notation of sets and parameters that are used through the remainder of the article.


                     Indexes and sets
                     
                        
                           
                              a
                              ∈
                              A: set of sellers.


                              j
                              ∈
                              J: set of geographic regions.


                              a
                              ∈
                              E
                              
                                 j
                              : set of sellers that belong to region j.


                              k
                              ∈
                              K: set of customers.


                              i
                              ∈
                              I: set of crude oils.


                              b
                              ∈
                              B: set of basic oil products.


                              s
                              ∈
                              S: set of speciality oil products.


                              p
                              ∈
                              P: set of saleable products, the union of sets B and S (basic oils and speciality oils).


                              l
                              ∈
                              L: set of all types of oils, the union of sets I, B and S (crude oils, basic oils and speciality oils).


                              r
                              ∈
                              R: set of refineries.


                              h
                              ∈
                              H: set of hubs.


                              d
                              ∈
                              D: set of depots.


                              f
                              ∈
                              F: set of all locations, the union of sets R, H and D (refineries, hubs and depots).


                              g
                              ∈
                              G: set of storage locations for saleable products, the union of set H and set D (hubs and depots).


                              m
                              ∈
                              M: set of run-modes in refining process.


                              t
                              ∈
                              T: set of periods in the planning horizon (without including the preceding period t
                              =0).


                     Parameters
                     
                        
                           
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          ap
                                          
                                             
                                                p
                                             
                                             
                                                ̃
                                             
                                          
                                          g
                                       
                                    
                                 
                              : maximum proportion between the amount of saleable products p and 
                                 
                                    
                                       
                                          p
                                       
                                       
                                          ̃
                                       
                                    
                                 
                               possible to assign to seller a from location g.


                              β
                              
                                 a
                              : fraction of the revenue that seller a receives as premium.


                              δ
                              
                                 pakt
                              : demand of customer k to seller a for product p in period t.


                              η
                              
                                 irt
                              : amount of crude oil i incoming to refinery r in period t.


                              γ
                              
                                 bs
                              : amount of basic oil b necessary for producing one unit of speciality oil s.


                              λ
                              
                                 pgj
                              : maximum amount of product p that the company can sell from location g to region j per period.


                              ρ
                              
                                 bim
                              : amount of basic oil b generated from one unit of crude oil i at run-mode m.


                              θ
                              
                                 pkt
                              : sale price of one unit of product p to customer k in period t.


                              ζ
                              
                                 pgkt
                              : value chain cost of one unit of product p if it is ordered from location g to be sold to customer k in period t.


                              ψ
                              
                                 pk
                              : unitary cost for unsatisfied demand of customer k for product p.


                              C
                              
                                 irm
                              : cost of refining one unit of crude oil i in mode m at refinery r.


                              C
                              
                                 sh
                              : cost of producing one unit of speciality oil s at hub h.


                              C
                              
                                 fg
                              : unitary transport cost from location f to location g.


                              C
                              
                                 gk
                              : unitary transport cost from location g to customer k.


                              C
                              
                                 lf
                              : inventory cost from storing one unit of oil l in location f.


                              
                                 
                                    
                                       
                                          
                                             
                                                Z
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          lf
                                          0
                                       
                                    
                                 
                              : initial inventory of oil l at location f.


                              
                                 
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          irm
                                          0
                                       
                                    
                                 
                              : initial amount of crude oil i refined in mode m in refinery r.


                              
                                 
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          hs
                                          0
                                       
                                    
                                 
                              : initial amount of speciality oil s produced at hub h.

In the decoupled planning models the objective will be different for the company, planning production and primary transportation, and the sellers, planning sales and secondary distribution of products. Therefore two different models have been formulated, one min-cost model and one max-revenue model.

In this case, production, storage and distribution plans are decided to match estimated sales while at the same time minimizing costs. The estimated sales correspond to the forecast parameters δ
                           
                              pakt
                           . We propose a linear programming model for this problem and present the formulation below.


                           Decision variables
                           
                              
                                 
                                    v
                                    
                                       pagkt
                                    : amount of saleable product p sold from location g to customer k through seller a in period t.


                                    x
                                    
                                       pfgt
                                    : amount of saleable product p transported from location f to location g in period t.


                                    y
                                    
                                       irmt
                                    : amount of crude oil i refined at refinery r in mode m in period t.


                                    y
                                    
                                       sht
                                    : amount of speciality oil s produced at hub h in period t.


                                    z
                                    
                                       lft
                                    : amount of oil l stored in location f at the end of period t.


                           Min-cost objective function
                           
                              
                                 (1)
                                 
                                    
                                       min
                                    
                                    Cost
                                    =
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             m
                                             ∈
                                             M
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             r
                                             ∈
                                             R
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             ∈
                                             I
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                    
                                       
                                          C
                                       
                                       
                                          irm
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          irmt
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             h
                                             ∈
                                             H
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             s
                                             ∈
                                             S
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                    
                                       
                                          C
                                       
                                       
                                          sh
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          sht
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             p
                                             ∈
                                             P
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             f
                                             ∈
                                             F
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             g
                                             ∈
                                             G
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                    
                                       
                                          C
                                       
                                       
                                          fg
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          pfgt
                                       
                                    
                                    +
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      f
                                                      ∈
                                                      F
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      l
                                                      ∈
                                                      L
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      t
                                                      ∈
                                                      T
                                                   
                                                
                                             
                                             
                                                
                                                   C
                                                
                                                
                                                   lf
                                                
                                             
                                             (
                                             
                                                
                                                   z
                                                
                                                
                                                   l
                                                   ,
                                                   f
                                                   ,
                                                   t
                                                   -
                                                   1
                                                
                                             
                                             +
                                             
                                                
                                                   z
                                                
                                                
                                                   lft
                                                
                                             
                                             )
                                          
                                       
                                    
                                    2
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             a
                                             ∈
                                             A
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             p
                                             ∈
                                             P
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                    
                                       
                                          ψ
                                       
                                       
                                          pk
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   pakt
                                                
                                             
                                             -
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      g
                                                      ∈
                                                      G
                                                   
                                                
                                             
                                             
                                                
                                                   v
                                                
                                                
                                                   pagkt
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           Constraints
                           
                              
                                 (2)
                                 
                                    
                                       
                                          z
                                       
                                       
                                          lf
                                          0
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                Z
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          lf
                                          0
                                       
                                    
                                    
                                    ∀
                                    f
                                    ∈
                                    F
                                    ,
                                    
                                    l
                                    ∈
                                    L
                                    .
                                 
                              
                           
                           
                              
                                 (3)
                                 
                                    
                                       
                                          y
                                       
                                       
                                          irm
                                          0
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          irm
                                          0
                                       
                                    
                                    
                                    ∀
                                    r
                                    ∈
                                    R
                                    ,
                                    
                                    m
                                    ∈
                                    M
                                    ,
                                    
                                    i
                                    ∈
                                    I
                                    .
                                 
                              
                           
                           
                              
                                 (4)
                                 
                                    
                                       
                                          y
                                       
                                       
                                          sh
                                          0
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          sh
                                          0
                                       
                                    
                                    
                                    ∀
                                    h
                                    ∈
                                    H
                                    ,
                                    
                                    s
                                    ∈
                                    S
                                    .
                                 
                              
                           
                           
                              
                                 (5)
                                 
                                    
                                       
                                          z
                                       
                                       
                                          i
                                          ,
                                          r
                                          ,
                                          t
                                          -
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          η
                                       
                                       
                                          irt
                                       
                                    
                                    =
                                    
                                       
                                          z
                                       
                                       
                                          irt
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             m
                                             ∈
                                             M
                                          
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          irmt
                                       
                                    
                                    
                                    ∀
                                    r
                                    ∈
                                    R
                                    ,
                                    
                                    i
                                    ∈
                                    I
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                           
                              
                                 (6)
                                 
                                    
                                       
                                          z
                                       
                                       
                                          b
                                          ,
                                          r
                                          ,
                                          t
                                          -
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             ∈
                                             I
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             m
                                             ∈
                                             M
                                          
                                       
                                    
                                    
                                       
                                          ρ
                                       
                                       
                                          bim
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          i
                                          ,
                                          r
                                          ,
                                          m
                                          ,
                                          t
                                          -
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          z
                                       
                                       
                                          brt
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             h
                                             ∈
                                             H
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          brht
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             d
                                             ∈
                                             D
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          brdt
                                       
                                    
                                    
                                    ∀
                                    r
                                    ∈
                                    R
                                    ,
                                    
                                    b
                                    ∈
                                    B
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                           
                              
                                 (7)
                                 
                                    
                                       
                                          z
                                       
                                       
                                          b
                                          ,
                                          h
                                          ,
                                          t
                                          -
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             r
                                             ∈
                                             R
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          brht
                                       
                                    
                                    =
                                    
                                       
                                          z
                                       
                                       
                                          bht
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             d
                                             ∈
                                             D
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          bhdt
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             a
                                             ∈
                                             A
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          bahkt
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             s
                                             ∈
                                             S
                                          
                                       
                                    
                                    
                                       
                                          γ
                                       
                                       
                                          bs
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          sht
                                       
                                    
                                    
                                    ∀
                                    h
                                    ∈
                                    H
                                    ,
                                    
                                    b
                                    ∈
                                    B
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                           
                              
                                 (8)
                                 
                                    
                                       
                                          z
                                       
                                       
                                          b
                                          ,
                                          d
                                          ,
                                          t
                                          -
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             r
                                             ∈
                                             R
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          brdt
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             h
                                             ∈
                                             H
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          bhdt
                                       
                                    
                                    =
                                    
                                       
                                          z
                                       
                                       
                                          bdt
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             a
                                             ∈
                                             A
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          badkt
                                       
                                    
                                    
                                    ∀
                                    d
                                    ∈
                                    D
                                    ,
                                    
                                    b
                                    ∈
                                    B
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                           
                              
                                 (9)
                                 
                                    
                                       
                                          z
                                       
                                       
                                          s
                                          ,
                                          h
                                          ,
                                          t
                                          -
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          y
                                       
                                       
                                          s
                                          ,
                                          h
                                          ,
                                          t
                                          -
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          z
                                       
                                       
                                          sht
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             d
                                             ∈
                                             D
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          shdt
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             a
                                             ∈
                                             A
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          sahkt
                                       
                                    
                                    
                                    ∀
                                    h
                                    ∈
                                    H
                                    ,
                                    
                                    s
                                    ∈
                                    S
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                           
                              
                                 (10)
                                 
                                    
                                       
                                          z
                                       
                                       
                                          s
                                          ,
                                          d
                                          ,
                                          t
                                          -
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             h
                                             ∈
                                             H
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          shdt
                                       
                                    
                                    =
                                    
                                       
                                          z
                                       
                                       
                                          sdt
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             a
                                             ∈
                                             A
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          sadkt
                                       
                                    
                                    
                                    ∀
                                    d
                                    ∈
                                    D
                                    ,
                                    
                                    s
                                    ∈
                                    S
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                           
                              
                                 (11)
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             g
                                             ∈
                                             G
                                          
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          pagkt
                                       
                                    
                                    ⩽
                                    
                                       
                                          δ
                                       
                                       
                                          pakt
                                       
                                    
                                    
                                    ∀
                                    a
                                    ∈
                                    A
                                    ,
                                    
                                    p
                                    ∈
                                    P
                                    ,
                                    
                                    k
                                    ∈
                                    K
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                           
                              
                                 (12)
                                 
                                    v
                                    ⩾
                                    0
                                    ,
                                    
                                    x
                                    ⩾
                                    0
                                    ,
                                    
                                    y
                                    ⩾
                                    0
                                    ,
                                    
                                    z
                                    ⩾
                                    0
                                    .
                                 
                              
                           
                        

The objective function (1) minimizes the total cost through the whole planning horizon up to the depot level (i.e. excluding distribution cost to the customers). The first term is the cost of processing crude oils at the refineries; the second term is the cost of production at the hubs; the third term is the primary distribution transport costs; the fourth term is the total cost of the average inventory per period; the last term is the cost for unsatisfied demand.

Constraint (2) sets the initial level of inventories of crude oils, basic oils and speciality oils. Constraint (3) sets the initial values of crude oils refined in each mode and refinery. Constraint (4) sets the initial values of the speciality oils produced at each hub. Constraint (5) represents the flow conservation of crude oils at the refineries. Constraints (6)–(8) state the conservation of flow of basic oils at the refineries, hubs and depots, respectively. Constraints (9) and (10) give the conservation of flow of speciality oils at the hubs and depots, respectively. Constraint (11) states that the company supplies a customer at most the amount he ordered, through the corresponding seller. The non-negativity of all the variables is stated in constraints (12), where we have dropped the subindexes for ease of exposition.

In this case the goal is to maximize the total revenue obtained from the sales over the planning period, assuming that they will be realized as forecasted. The objective function is stated as follows:


                           Max-revenue objective function
                           
                              
                                 (13)
                                 
                                    
                                       max
                                    
                                    Revenue
                                    =
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             a
                                             ∈
                                             A
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             p
                                             ∈
                                             P
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             g
                                             ∈
                                             G
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                    
                                       
                                          θ
                                       
                                       
                                          pkt
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          pagkt
                                       
                                    
                                 
                              
                           
                        

The constraints from the previous model remain the same as (2)–(12).

We first consider a fully decoupled case, where there is no coordination between sales and operations units. While the sales units focus on their sales premiums, the operations units focus on supplying at minimum cost.

For this case, we develop a decoupled model that is composed of two sub-models: the sales sub-model and the operations sub-model.

In the sales sub-model, the sales units do their planning separately from the other echelons of the supply chain, by considering only the sales prices and the value chain costs to maximize their premiums.

In the operations sub-model, production and primary distribution are planned together and the results from the sales sub-model are considered as input.

According to given demand, the sellers make decisions on which products, in what amount and from which storage location to order for maximizing their premiums.


                           Decision variables
                           
                              
                                 
                                    w
                                    
                                       pagkt
                                    : amount of saleable product p ordered by seller a from location g to be shipped to customer k in period t.


                           Max-premium objective function
                           
                              
                                 (14)
                                 
                                    
                                       max
                                    
                                    Premium
                                    =
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             a
                                             ∈
                                             A
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             p
                                             ∈
                                             P
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             g
                                             ∈
                                             G
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                    
                                       
                                          β
                                       
                                       
                                          a
                                       
                                    
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          pkt
                                       
                                    
                                    -
                                    
                                       
                                          ζ
                                       
                                       
                                          pgkt
                                       
                                    
                                    )
                                    
                                       
                                          w
                                       
                                       
                                          pagkt
                                       
                                    
                                 
                              
                           
                           Constraints
                           
                              
                                 (15)
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             g
                                             ∈
                                             G
                                          
                                       
                                    
                                    
                                       
                                          w
                                       
                                       
                                          pagkt
                                       
                                    
                                    ⩽
                                    
                                       
                                          δ
                                       
                                       
                                          pakt
                                       
                                    
                                    
                                    ∀
                                    a
                                    ∈
                                    A
                                    ,
                                    
                                    p
                                    ∈
                                    P
                                    ,
                                    
                                    k
                                    ∈
                                    K
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                           
                              
                                 (16)
                                 
                                    
                                       
                                          w
                                       
                                       
                                          pagkt
                                       
                                    
                                    ⩾
                                    0
                                    
                                    ∀
                                    a
                                    ∈
                                    A
                                    ,
                                    
                                    p
                                    ∈
                                    P
                                    ,
                                    
                                    g
                                    ∈
                                    G
                                    ,
                                    
                                    k
                                    ∈
                                    K
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                        

The objective function (14) maximizes the total premium obtained by all the sellers, through the whole planning horizon. Constraint (15) states that for each customer each seller will order at most the amount this customer demanded, considering it is possible to serve the same customer from different depots. Constraint (16) corresponds to the non-negativity of the variables.

The quantities w
                           
                              pagkt
                            ordered by the sellers are used as demand parameters in the operations sub-model (from the solution to the sales sub-model, the sellers have already decided on the location from which to order). The production, storage and primary distribution plans of the company are decided to match such a demand, while at the same time minimizing costs. This operations sub-model corresponds to the formulation of the min-cost model in Section 4.1.1, but the demand fulfilment constraint (11) is replaced by constraint (17) as follows:
                              
                                 (17)
                                 
                                    
                                       
                                          v
                                       
                                       
                                          pagkt
                                       
                                    
                                    ⩽
                                    
                                       
                                          w
                                       
                                       
                                          pagkt
                                       
                                    
                                    
                                    ∀
                                    a
                                    ∈
                                    A
                                    ,
                                    
                                    p
                                    ∈
                                    P
                                    ,
                                    
                                    g
                                    ∈
                                    G
                                    ,
                                    
                                    k
                                    ∈
                                    K
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                        

In practice, the company attempts to set conditions in order to achieve certain balance between production and sales of different products from different depots. These conditions work as recommendations and encouragement to the sellers and we incorporate this as two coordination constraints in our decoupled approach. The first coordination constraint is given by an upper bound α on the proportion between two different products that the same seller can order from the same depot. The second coordination constraint imposes a maximum quantity λ for each product that can be ordered in total from sellers in the same region. We introduce these conditions into the sales sub-model, by the formulation of the following constraints
                              
                                 (18)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         k
                                                         ∈
                                                         K
                                                      
                                                   
                                                
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      pagkt
                                                   
                                                
                                                ⩽
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      ap
                                                      
                                                         
                                                            p
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                      g
                                                   
                                                
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         k
                                                         ∈
                                                         K
                                                      
                                                   
                                                
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                      agkt
                                                   
                                                
                                                
                                                ∀
                                                a
                                                ∈
                                                A
                                                ,
                                                
                                                p
                                                ∈
                                                P
                                                ,
                                                
                                                
                                                   
                                                      p
                                                   
                                                   
                                                      ̃
                                                   
                                                
                                                ∈
                                                P
                                                ,
                                                
                                                g
                                                ∈
                                                G
                                                ,
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                t
                                                ∈
                                                T
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (19)
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             a
                                             ∈
                                             
                                                
                                                   E
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          w
                                       
                                       
                                          pagkt
                                       
                                    
                                    ⩽
                                    
                                       
                                          λ
                                       
                                       
                                          pgj
                                       
                                    
                                    
                                    ∀
                                    j
                                    ∈
                                    J
                                    ,
                                    
                                    p
                                    ∈
                                    P
                                    ,
                                    
                                    g
                                    ∈
                                    G
                                    ,
                                    
                                    t
                                    ∈
                                    T
                                    .
                                 
                              
                           
                        

@&#DISCUSSION@&#

The fulfilment of demand in the min-cost model of Section 4.1.1 will be driven by the penalization ψ incorporated in the objective function on the deviation of production with respect to the estimated sales. In fact, provided that the initial inventories, the crude oils supplies and ψ are large enough, the optimal solution to this model will be such that the production is as little as possible to fulfil the estimated forecast in the cheapest feasible way (down-to-depot costs). However, since the objective function does not consider secondary distribution costs, in reality, the implementation might be inconvenient for the company.

When using the max-revenue model of Section 4.1.2, assuming that the initial inventories and crude oils supplies are large enough, the production will reach the level of demand, without concern for any of the costs. In practice this is, of course, inconvenient for the company.

The max-revenue and min-cost problems illustrate a classical conflict between operation and commercial units. The decoupled models of Section 4.2 illustrate the conflict appearing in the company at tactical level.

Note that the sales sub-model problem in the fully decoupled approach is separable in the sellers, thus solving the problem for each single seller a will lead to the same solution as when solving for all of them together. The trivial solution is that the sellers place all the orders such that the price θ is higher than the value chain cost ζ, and they do it from the location such that this difference is the highest. With these orders as input in the operations sub-model, the secondary distribution has been conditioned by the decisions of the sellers.

When there is not enough supply of products to fulfil all the demand, the company may assign priority to some of the customers. In the model, this can be managed by the penalization ψ.

The decoupled models we have formulated illustrate the issues created by the non-coordinated planning in the company. In order to come up with better coordination mechanisms, the coordination constraints have been implemented gradually for all those cases in which the sales orders for some products have undesirably unbalanced the inventories in depots and hubs. Although they mitigate the undesired effects, limiting sales leads to a sub-optimal solution from an integrated perspective. Currently, there is no integrated planning model implemented at the company. We tackle this problem in the next section.

In this section, we propose a model that integrates sales and operations decisions, under the same objective of maximizing the total contribution of sales minus variable costs over the planning horizon. Sales and operation units are modelled together in the same model. The decision on how to fulfil demand is made centrally, as well as the decisions on production, inventory and primary and secondary distribution. The integrated model will be used to identify the potential of an integrated planning over decoupled planning, and used as a benchmark for evaluating coordination constraints.

We maintain the notation and definitions from the previous section for all parameters, sets and variables, but for explicit differentiation in the decision variable on demand fulfilment between this integrated model and the previous cases, instead of using v
                     
                        pagkt
                      we use the notation 
                        
                           
                              
                                 
                                    
                                       v
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 pagkt
                              
                           
                        
                      as decision variable for the amount of saleable product p sold from location g to customer k through seller a in period t.


                     Objective function
                     
                        
                           (20)
                           
                              
                                 max
                              
                              Contribution
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       a
                                       ∈
                                       A
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       p
                                       ∈
                                       P
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       g
                                       ∈
                                       G
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ∈
                                       K
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       t
                                       ∈
                                       T
                                    
                                 
                              
                              
                                 
                                    θ
                                 
                                 
                                    pkt
                                 
                              
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    pagkt
                                 
                              
                              -
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       m
                                       ∈
                                       M
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       r
                                       ∈
                                       R
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       ∈
                                       I
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       t
                                       ∈
                                       T
                                    
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    irm
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    irmt
                                 
                              
                              -
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       h
                                       ∈
                                       H
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       s
                                       ∈
                                       S
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       t
                                       ∈
                                       T
                                    
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    sh
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    sht
                                 
                              
                              -
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       p
                                       ∈
                                       P
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       f
                                       ∈
                                       F
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       g
                                       ∈
                                       G
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       t
                                       ∈
                                       T
                                    
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    fg
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    pfgt
                                 
                              
                              -
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       a
                                       ∈
                                       A
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       g
                                       ∈
                                       G
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ∈
                                       K
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       p
                                       ∈
                                       P
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       t
                                       ∈
                                       T
                                    
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    gk
                                 
                              
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    pagkt
                                 
                              
                              -
                              
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                f
                                                ∈
                                                F
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                l
                                                ∈
                                                L
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                t
                                                ∈
                                                T
                                             
                                          
                                       
                                       
                                          
                                             C
                                          
                                          
                                             lf
                                          
                                       
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             l
                                             ,
                                             f
                                             ,
                                             t
                                             -
                                             1
                                          
                                       
                                       +
                                       
                                          
                                             z
                                          
                                          
                                             lft
                                          
                                       
                                       )
                                    
                                 
                              
                              2
                              -
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       a
                                       ∈
                                       A
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       p
                                       ∈
                                       P
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ∈
                                       K
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       t
                                       ∈
                                       T
                                    
                                 
                              
                              
                                 
                                    ψ
                                 
                                 
                                    pk
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             δ
                                          
                                          
                                             pakt
                                          
                                       
                                       -
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                g
                                                ∈
                                                G
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             pagkt
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     Constraints
                     
                        
                           (21)
                           
                              
                                 
                                    z
                                 
                                 
                                    lf
                                    0
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          Z
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    lf
                                    0
                                 
                              
                              
                              ∀
                              f
                              ∈
                              F
                              ,
                              
                              l
                              ∈
                              L
                              .
                           
                        
                     
                     
                        
                           (22)
                           
                              
                                 
                                    y
                                 
                                 
                                    irm
                                    0
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    irm
                                    0
                                 
                              
                              
                              ∀
                              r
                              ∈
                              R
                              ,
                              
                              m
                              ∈
                              M
                              ,
                              
                              i
                              ∈
                              I
                              .
                           
                        
                     
                     
                        
                           (23)
                           
                              
                                 
                                    y
                                 
                                 
                                    sh
                                    0
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    sh
                                    0
                                 
                              
                              
                              ∀
                              h
                              ∈
                              H
                              ,
                              
                              s
                              ∈
                              S
                              .
                           
                        
                     
                     
                        
                           (24)
                           
                              
                                 
                                    z
                                 
                                 
                                    i
                                    ,
                                    r
                                    ,
                                    t
                                    -
                                    1
                                 
                              
                              +
                              
                                 
                                    η
                                 
                                 
                                    irt
                                 
                              
                              =
                              
                                 
                                    z
                                 
                                 
                                    irt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       m
                                       ∈
                                       M
                                    
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    irmt
                                 
                              
                              
                              ∀
                              r
                              ∈
                              R
                              ,
                              
                              i
                              ∈
                              I
                              ,
                              
                              t
                              ∈
                              T
                              .
                           
                        
                     
                     
                        
                           (25)
                           
                              
                                 
                                    z
                                 
                                 
                                    b
                                    ,
                                    r
                                    ,
                                    t
                                    -
                                    1
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       ∈
                                       I
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       m
                                       ∈
                                       M
                                    
                                 
                              
                              
                                 
                                    ρ
                                 
                                 
                                    bim
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    i
                                    ,
                                    r
                                    ,
                                    m
                                    ,
                                    t
                                    -
                                    1
                                 
                              
                              =
                              
                                 
                                    z
                                 
                                 
                                    brt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       h
                                       ∈
                                       H
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    brht
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       d
                                       ∈
                                       D
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    brdt
                                 
                              
                              
                              ∀
                              r
                              ∈
                              R
                              ,
                              
                              b
                              ∈
                              B
                              ,
                              
                              t
                              ∈
                              T
                              .
                           
                        
                     
                     
                        
                           (26)
                           
                              
                                 
                                    z
                                 
                                 
                                    b
                                    ,
                                    h
                                    ,
                                    t
                                    -
                                    1
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       r
                                       ∈
                                       R
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    brht
                                 
                              
                              =
                              
                                 
                                    z
                                 
                                 
                                    bht
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       d
                                       ∈
                                       D
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    bhdt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       a
                                       ∈
                                       A
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ∈
                                       K
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    bahkt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       s
                                       ∈
                                       S
                                    
                                 
                              
                              
                                 
                                    γ
                                 
                                 
                                    bs
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    sht
                                 
                              
                              
                              ∀
                              h
                              ∈
                              H
                              ,
                              
                              b
                              ∈
                              B
                              ,
                              
                              t
                              ∈
                              T
                              .
                           
                        
                     
                     
                        
                           (27)
                           
                              
                                 
                                    z
                                 
                                 
                                    b
                                    ,
                                    d
                                    ,
                                    t
                                    -
                                    1
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       r
                                       ∈
                                       R
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    brdt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       h
                                       ∈
                                       H
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    bhdt
                                 
                              
                              =
                              
                                 
                                    z
                                 
                                 
                                    bdt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       a
                                       ∈
                                       A
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ∈
                                       K
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    badkt
                                 
                              
                              
                              ∀
                              d
                              ∈
                              D
                              ,
                              
                              b
                              ∈
                              B
                              ,
                              
                              t
                              ∈
                              T
                              .
                           
                        
                     
                     
                        
                           (28)
                           
                              
                                 
                                    z
                                 
                                 
                                    s
                                    ,
                                    h
                                    ,
                                    t
                                    -
                                    1
                                 
                              
                              +
                              
                                 
                                    y
                                 
                                 
                                    s
                                    ,
                                    h
                                    ,
                                    t
                                    -
                                    1
                                 
                              
                              =
                              
                                 
                                    z
                                 
                                 
                                    sht
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       d
                                       ∈
                                       D
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    shdt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       a
                                       ∈
                                       A
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ∈
                                       K
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    sahkt
                                 
                              
                              
                              ∀
                              h
                              ∈
                              H
                              ,
                              
                              s
                              ∈
                              S
                              ,
                              
                              t
                              ∈
                              T
                              .
                           
                        
                     
                     
                        
                           (29)
                           
                              
                                 
                                    z
                                 
                                 
                                    s
                                    ,
                                    d
                                    ,
                                    t
                                    -
                                    1
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       h
                                       ∈
                                       H
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    shdt
                                 
                              
                              =
                              
                                 
                                    z
                                 
                                 
                                    sdt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       a
                                       ∈
                                       A
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ∈
                                       K
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    sadkt
                                 
                              
                              
                              ∀
                              d
                              ∈
                              D
                              ,
                              
                              s
                              ∈
                              S
                              ,
                              
                              t
                              ∈
                              T
                              .
                           
                        
                     
                     
                        
                           (30)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       g
                                       ∈
                                       G
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    pagkt
                                 
                              
                              ⩽
                              
                                 
                                    δ
                                 
                                 
                                    pakt
                                 
                              
                              
                              ∀
                              a
                              ∈
                              A
                              ,
                              
                              p
                              ∈
                              P
                              ,
                              
                              k
                              ∈
                              K
                              ,
                              
                              t
                              ∈
                              T
                              .
                           
                        
                     
                     
                        
                           (31)
                           
                              
                                 
                                    v
                                 
                                 
                                    ¯
                                 
                              
                              ⩾
                              0
                              ,
                              
                              x
                              ⩾
                              0
                              ,
                              
                              y
                              ⩾
                              0
                              ,
                              
                              z
                              ⩾
                              0
                              .
                           
                        
                     
                  

In the integrated model, the objective function (20) maximizes the total contribution of the company over the planning horizon. The first term is the revenue obtained from the sales of all the products through all the sellers. The second term is the variable cost of processing crude oils at the refineries; the third term is the variable cost of production at the hubs; the fourth term is the primary distribution costs; the fifth term is the secondary distribution cost; the sixth term is the total cost of the average inventory per period; the last term is the cost for unsatisfied demand. Constraints (21)–(25) are the same as constraints (2)–(6) of the min-cost model. Constraints (7)–(12) are also considered, but now the variables v in the formulations are changed to 
                        
                           
                              
                                 v
                              
                              
                                 ¯
                              
                           
                        
                     , as stated in constraints (26)–(31).

Note that constraint (30) will drive decisions on distribution from storage locations to the customers, from an integrated perspective, involving operations and sales decisions under the max-contribution objective function. This was not the case in the decoupled model under max-premium and min-cost separated objective functions, where constraint (17) limited the distribution from a given location to a given customer by the corresponding amount w ordered by the seller. Moreover, if there exists an optimal solution to the decoupled model, this solution is feasible in the integrated model. In fact, if v values satisfy constraint (17) in the operations sub-model, it holds that 
                        
                           
                              
                                 ∑
                              
                              
                                 g
                                 ∈
                                 G
                              
                           
                           
                              
                                 v
                              
                              
                                 pagkt
                              
                           
                           ⩽
                           
                              
                                 ∑
                              
                              
                                 g
                                 ∈
                                 G
                              
                           
                           
                              
                                 w
                              
                              
                                 pagkt
                              
                           
                        
                     . Then, because the w values satisfy constraint (15) in the sales sub-model, it follows that the optimal v values of the decoupled solution satisfy 
                        
                           
                              
                                 ∑
                              
                              
                                 g
                                 ∈
                                 G
                              
                           
                           
                              
                                 v
                              
                              
                                 pagkt
                              
                           
                           ⩽
                           
                              
                                 δ
                              
                              
                                 pakt
                              
                           
                        
                     , which matches with constraint (30) of the integrated model. Thus, the solution to the integrated model is at least as good as the decoupled solution. It can also be concluded that if the integrated problem is infeasible, then the decoupled problem is also infeasible.

The integrated planning approach leads to an integrated inventory and network flow problem and it describes a standard large scale tactical planning problem in the supply chain management literature. The network model describes a divergent supply chain and similar models have been solved efficiently earlier (see, e.g., the tactical planning problems in Bredström et al. [6] and Broman et al. [7]).

We provide numerical results for the implementation of the models of Sections 4 and 5 in two main instances. A description on the numerical dimension of these instances is given in Table 1
                     . We consider a time horizon of 3months split in 12weekly periods and weekly demand forecasts as given. Instance I1 will serve as an illustrative example to show the advantages of the integrated over the decoupled planning. Instance I2 enlarges the dimension of the network from instance I1, with higher number of depots, regions, sellers and customers. We use instance I1 as the base of our discussion and instance I2 to strengthen the results.

The resulting integrated model contains about 7700 variables and 2000 constraints for instance I1, and 83,000 variables and 8000 constraints for instance I2. AMPL has been used to code the models and CPLEX 10.0 to solve them on an Intel Core2 Duo 2.27GHz processor with 2GB of RAM. It took less than a second to find the optimal solution to each of the instances.

The results for the illustrative instance I1 are shown in Table 2
                        .

The second column of the table shows the result obtained for the fully decoupled model (DM), expressed in monetary units. The next column corresponds to the solution of the decoupled model with the coordination constraint imposing the bound α as in (18). The percentage figure corresponds to the difference between this solution and the DM solution. Note a reduction of 2.28% in total costs is achieved when introducing this coordination constraint to the sales sub-model.

The column labelled DCλ shows the results when the coordination constraint (19) introducing the regional limit is considered. In this case, a reduction of 1.05% in total costs is obtained compared to the DM case.

The column labelled DCαλ corresponds to the solution when both coordination constraints (18) and (19) are considered simultaneously, leading to a drop of 2.67% in total costs and an increase of 2.80% in contribution, compared to the DM case.

The last column shows the results obtained from the integrated model. This case outperforms all previous ones. A reduction of 9.33% in total costs and an increase of 9.79% in contribution are achieved by the integrated model compared to the DM case. Note the secondary distribution cost from the integrated solution is dramatically lower than in the DM case, with a 77.17% reduction. This is the result of planning the distribution to the customers taking into account not only the particular revenues of each sale, but also the involved costs of the company as a whole.

Still, when compared to the DCαλ case, the integrated model leads to a reduction of 6.85% in total costs and an increment of 6.80% in contribution, thus outperforming the decoupled approach with coordination constraints.

The results of 10 other instances are shown in Table 3
                        . These instances have been built over the basis of instance I1, modifying the values of the sales price (θ) and demand (δ) parameters, in order to carry out a sensitivity analysis. In each instance, the original values of these parameters have been randomly modified within an interval of ±∊%, where ∊ equals 1% in instance (i) and increases one by one up to 10% in instance (x). Thus, for example, in instance (iii) the parameter values of the sales price and the demand prices belong to [0.97×
                        θ,1.03×
                        θ).

From the results in Table 3, we can verify the relative performance of the decoupled model with coordination constraints and the integrated model with respect to the fully decoupled model in these ten instances present just little variation over what we observed on instance I1. On average, the results of the DCαλ model achieve a decrease of 2.66% in total costs and an increase of 2.80% in contribution when compared to the solution of the DM model. On its hand, the results of the integrated model achieve on average a decrease of 9.34% in total costs and an increase of 9.83% in contribution with respect to the solution of the DM model, while a decrease of 6.86% in total costs and an increase of 6.84% in contribution with respect to the solution of the DCαλ model.

Note that for a fair comparison, we have considered a penalization on unfulfilled demand ψ high enough to satisfy all demand, thus the revenue result remains unaffected for all models in each instance. Also, the prices considered are such that it is profitable for the sellers to accept all demand from their customers.

An observation must be made on setting the value chain costs for the sales sub-model. Its estimation will not necessarily match the costs in the operations sub-model and the integrated model. Though this may cause some distortion for comparison purposes, the large differences obtained suggest that the current situation could be significantly improved by integrating commercial decisions with operations decisions. Moreover, we would expect that in practice, it is harder to get accurate estimation of the value chain costs than for each of the other costs (processing, production, transport, inventory) used by the integrated model. The reason for this is that the value chain costs themselves are a solution from an equilibrium problem.

Another observation concerns the premium amounts obtained by the sellers in each model. Table 4
                         shows and compares these amounts obtained in instance I1.

The premiums obtained by the sellers in the decoupled models with coordination constraints differ slightly from what they get in the fully decoupled model, keeping at least one of the sellers with the same premium, and with a variation of the total premium obtained by the sellers not greater than 1.75%. On the other hand, the premiums obtained by the sellers in the integrated model exhibit high differences in comparison to all the other cases. In particular, when comparing with the fully decoupled case, in the integrated case the sellers receives between 35.32% and 82.42% lower premium. It is therefore arguable whether, under the premiums obtained in the integrated model, the sellers would still be encouraged to sell high volumes or not. This issue, which has been overlooked by previous literature in oil supply chain planning, is in line with the OR literature dealing with coordination of supply chain systems. As reviewed by Li and Wang [18], although an integrated solution may result in optimal system performance, this solution is not always in the best interest of every individual member in the system.

However, given that the integrated model leads to higher total contribution, finding a mechanism to share the contribution among sellers and the rest of the company could keep the incentives for the sellers to achieve high sales volumes. Then, the question arises of how to find an allocation such that all stakeholders are motivated to use the integrated model.


                        Table 5
                         shows the percentage of the contribution that the premium of the sellers represents in each problem (labelled “%P/C”). It can be observed that the share that the sellers get in the integrated solution is considerably lower than in the other cases. In total, the drop goes from figures in the order of 5.30% or higher to only 2.05%.


                        Table 6
                         shows the equivalent premium, that we define as the premium amount obtained by the sellers considering the same percentage they received in the original case of the corresponding problem (DM, DCα, DCλ, DCαλ) applied to the total contribution from the integrated solution. For example, seller 1 in the DM case received 1.82% of the contribution as premium (Table 5). The contribution in the integrated solution was 36,633 (Table 2). Then the equivalent premium of seller 1 from the DM case in the integrated solution would be 1.82% of 36,633, thus equal to 666. Note that all the equivalent premiums so obtained are greater than the premiums received by the sellers in the original case that were presented in Table 4.


                        Table 7
                         shows the contribution after total premium for each of the other problems according to different ways of calculating the premiums. The contribution after premiums in the integrated solution corresponds to 36,633–750=35,883.

The first row shows the contribution after premium in the original case, derived from subtracting the total premium values of Table 4 from the contribution values of Table 2.

The second row of Table 7 shows the result of the contribution from the integrated case (36,633) minus the total equivalent premiums of Table 6. We have also specified the percentage of improvement achieved by using the equivalent premium rule with respect to the original case. The resulting contribution after premium computed by this rule outperforms the original cases with an increase ranging from 6.80% to 9.79%.

The last row of Table 7 shows the result of the contribution from the integrated case (36,633) minus the identical premium, that we define as the same absolute premium amount obtained by the sellers in the original case (the total values in Table 4). The resulting contribution after premium in this case is between 7.18% and 10.36% better than in the corresponding original cases.

Reallocation rules based on equivalent premiums and identical premiums are two examples of simple ways of reallocating the additional contribution among the sellers and the company, such that all sellers in this instance are better off than in the decoupled case while the company also obtains a better result.

The results of the extended instance I2 are shown in Table 8
                        . As in the first instance, in this second instance we also considered a penalization on unfulfilled demand ψ large enough to satisfy all demand, and prices such that it is profitable for the sellers to accept all demand from their customers.

The solution of the decoupled model with the coordination constraint (18) imposing the bound α implies a reduction of 1.21% in total costs, compared to the solution of the fully decoupled model. The effect of the coordination constraint (19) on regional limits is more moderate, with savings of only 0.01% in total costs with respect to the solution of the fully decoupled model. When both coordination constraints (18) and (19) are considered together, the savings in total costs are 1.21% and the contribution increases by 0.73%.

The solution to the integrated model in instance I2 outperforms all the decoupled cases, as also was the case in instance I1. Compared to the DM case, a reduction of 14.37% in total costs and an increase of 8.69% in contribution is achieved by the integrated model.

When comparing the integrated solution to the decoupled case with both coordination constraints (DCαλ) the total cost of the integrated solution is 13.32% lower and its contribution is 7.90% higher.

Ten other instances have been built over instance I2, in order to analyze the sensitivity of the results to the sales price and demand parameter values. In the same way as we did for instance I1, in these ten instances the original values of these parameters from instance I2 have been randomly modified within an interval of ±∊%, where ∊ equals 1% in instance (xi) and increases one by one up to 10% in instance (xx). A summary of the results so obtained are shown in Table 9
                        .

On average, in these ten instances the decoupled model with coordination constraints achieves 0.74% more contribution than the fully decoupled model. The decoupled models are outperformed in all instances by the integrated model, which achieves on average 8.74% more contribution than the fully decoupled model and 7.94% more contribution than the decoupled model with coordination constraints.

An analysis of the premium of the sellers for instance I2 would lead to similar observations as for instance I1, with worse premium allocations in the integrated case. The five sellers in instance I2 get, in total, 2.93% of the contribution in the integrated case, while in the fully decoupled case they get 5.02%. However, by reallocating the contribution of the integrated solution using the equivalent premium or the identical premium rules, all the sellers are better off than in the decoupled cases. Also, by using these rules, the contributions after premiums for the company in the integrated case are approximately between 7% and 9% larger than in the decoupled cases.

By using linear programming, we have formulated decoupled and integrated planning models for a divergent supply chain of speciality oil products. In the decoupled approach, we separated sales from the rest of the operations, thus formulating two sub-models: the sales sub-model and the operations sub-model. The sales sub-model decides, given the demand from the customers, the amount of products ordered for each seller from each storage facility in each period of time in the horizon to maximize their total premium. The optimal solution to the sales sub-model problem is used as a given parameter in the operations sub-model, which decides production, primary distribution, inventory and the amount to be assigned to each of the sellers, while at the same time minimizing costs. We also incorporated coordination constraints, by an upper bound on the proportion of two different products assigned to a certain seller from the same depot and an upper bound on the amount of each product that can be sold in the same region.

Then, we proposed a linear model that integrates the sales with the operations planning. In this model, the company as a whole decides on production, inventory, primary distribution and secondary distribution, to maximize the total contribution of the organization over the planning horizon. The advantages of this integrated approach over the decoupled planning is that the decisions on secondary distribution are made together with previous echelons in the supply chain, thus providing a better match with production and storage units. These advantages were reflected in illustrative examples, where the integrated model achieved important decreases in total costs and increases in contribution in comparison to the decoupled models.

We also discussed the premiums obtained by the sellers. In the numerical examples, we observed that, under the current premium allocations based on value chain cost, the sellers were left with much lower premiums in the integrated solution; thus the practical situation may not allow an integrated model to be implemented. In order to motivate the sellers, the development of a revenue/contribution sharing principle between the sellers and the company might be required. This has successfully been developed in other industries; see for example Frisk et al. [13]. In Section 6 we explored two simple rules, which served as reallocation of the contribution such that all the sellers and the company were better off in the integrated planning than in the decoupled planning. Developing pricing mechanisms with allocation of premiums is part of our future research agenda. The integrated model can be a basis for developing methods to calculate internal prices that coordinate the two sub-models to the integrated solution. Ideally, such internal prices should generate solutions where the decoupled and integrated models provide the same solutions. In the literature, there are several decomposition schemes that can be useful for this purpose, for example, based on Lagrangian relaxation [19,25]. This coordination could also be integrated with the work on finding a revenue/contribution sharing principle.

We are currently collaborating with a main company in the speciality oils industry. We believe the proposed integrated model has the potential to improve the understanding of the planning process and also to improve the current supply chain planning in the company. The improvements go in the direction of, for example, how to achieve a better mix of products, the timing at which they are produced, product focus in geographical areas, and how to distribute basic oils and speciality oils among the facilities and the final customers. A further research issue is the possibility to delay mixing of some oils to the depots.

In future work we also consider incorporating uncertainty of demand. This issue has been considered in the oil planning literature, such as the stochastic programming approaches by Al-Othman et al. [1] and Dempster et al. [9]. Research has also been done on integrating planning, as we referred to in the introduction [24,21,14] but none of these and related references in the oil industry have studied the revenue sharing conflicts of aligning operations and sales decisions under the same objective. We have dealt with both problems the integration of decisions in the supply chain and also the revenue sharing issues arising from the integration.

Other possible extension is the integration of the procurement decision to the downstream planning, which in our model would be possible to achieve by defining η as a decision variable instead of a parameter, and adding the corresponding cost (purchase and transport) in the objective function. Finally, a further interesting network design question is the possibility of closing down or opening depots. This requires the model to include binary decision variables and to assign fixed cost for the use of depots. However, for small changes or modifications of the network, it is possible to run a number of what-if scenarios with slightly changed designs with our LP models.

@&#REFERENCES@&#

