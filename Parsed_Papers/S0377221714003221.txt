@&#MAIN-TITLE@&#The static bicycle relocation problem with demand intervals

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A variant of the One-Commodity Pickup and Delivery Traveling Salesman Problem is studied.


                        
                        
                           
                           The supply/demand of a vertex is represented by an interval rather than a single value.


                        
                        
                           
                           An integer programming formulation and a branch-and-cut algorithm are developed.


                        
                        
                           
                           Valid inequalities have been adapted from 1-PDTSP and Covering Tour Problem.


                        
                        
                           
                           The algorithm is capable of solving instances with up to 50 customers within two hours of CPU time.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Traveling salesman

Pickup and delivery

Branch-and-cut

@&#ABSTRACT@&#


               
               
                  This study introduces the Static Bicycle Relocation Problem with Demand Intervals (SBRP-DI), a variant of the One Commodity Pickup and Delivery Traveling Salesman Problem (1-PDTSP). In the SBRP-DI, the stations are required to have an inventory of bicycles lying between given lower and upper bounds and initially have an inventory which does not necessarily lie between these bounds. The problem consists of redistributing the bicycles among the stations, using a single capacitated vehicle, so that the bounding constraints are satisfied and the repositioning cost is minimized. The real-world application of this problem arises in rebalancing operations for shared bicycle systems. The repositioning subproblem associated with a fixed route is shown to be a minimum cost network problem, even in the presence of handling costs. An integer programming formulation for the SBRP-DI are presented, together with valid inequalities adapted from constraints derived in the context of other routing problems and a Benders decomposition scheme. Computational results for instances adapted from the 1-PDTSP are provided for two branch-and-cut algorithms, the first one for the full formulation, and the second one with the Benders decomposition.
               
            

@&#INTRODUCTION@&#

The Static Bicycle Relocation Problem with Demand Intervals (SBRP-DI) is defined on a complete directed graph 
                        
                           G
                           =
                           (
                           V
                           ,
                           A
                           )
                        
                     , where 
                        
                           V
                           =
                           {
                           0
                           ,
                           …
                           ,
                           n
                           }
                        
                      is the set of vertices and A is the set of arcs. Vertex 0 is called the depot while the remaining vertices are called stations. Associated with each vertex 
                        
                           i
                           ∈
                           V
                        
                     , are three parameters 
                        
                           (
                           
                              
                                 l
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 u
                              
                              
                                 i
                              
                           
                           )
                        
                      corresponding respectively to the lower bound, the current supply, and the upper bound of the feasible amount of a commodity at the vertex. With each arc 
                        
                           (
                           i
                           ,
                           j
                           )
                           ∈
                           A
                        
                      is associated a travel cost 
                        
                           
                              
                                 t
                              
                              
                                 ij
                              
                           
                        
                     , and the cost associated with the handling of a bicycle is denoted as h. A vehicle of capacity Q leaves the depot, performs a tour visiting each vertex at most once to perform a pickup or a delivery, and returns to the depot. At the end of the tour, the resulting inventory at every vertex i must lie within the interval 
                        
                           [
                           
                              
                                 l
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 u
                              
                              
                                 i
                              
                           
                           ]
                        
                     . The objective is to minimize the total travel and handling cost.

The SBRP-DI is a variant of the One-Commodity Pickup and Delivery Traveling Salesman Problem (1-PDTSP) studied by Hernández-Pérez and Salazar-González (2004, 2007), in which a single capacitated vehicle visits customers to pick up and deliver the same commodity. In addition to the demand intervals, there are a number of features of the SBRP-DI that differentiate it from the 1-PDTSP. Firstly, the tour may not visit all vertices. Secondly, the commodity cannot flow through the depot. Lastly, a handling cost h is added to the routing cost per every commodity unit handled. The demand intervals introduce a degree of flexibility associated with transshipment vertices, i.e. vertices 
                        
                           i
                           ∈
                           V
                        
                      for which 
                        
                           
                              
                                 l
                              
                              
                                 i
                              
                           
                           ⩽
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           ⩽
                           
                              
                                 u
                              
                              
                                 i
                              
                           
                        
                     . A transshipment vertex may or may not be visited, which may help decrease the cost of routing by supplying or demanding commodities as required. Notably, the Swapping Problem (SP) introduced by Anily and Hassin (1992) also involves pickups and deliveries with transshipment vertices and multiple commodities. Branch-and-cut algorithms for the SP were developed by Bordenave, Gendreau, and Laporte (2009, 2012) and Erdoğan, Cordeau, and Laporte (2010). Bordenave, Gendreau, and Laporte (2010) have also developed construction and improvement heuristics for the SP.

Real-world applications of the SBRP-DI arise in shared bicycle systems, which have attracted the attention of several groups of researchers in recent years. These have been studied from several perspectives: evaluating the mobility patterns of users, determining the number and location of stations, maximizing user satisfaction, and minimizing the cost of relocating the bicycles. The study by Raviv, Tzur, and Forma (2013) categorizes the bicycle relocation problems as static and dynamic, which occur when the system activity level is low and high, respectively. The authors study the Static Repositioning Problem (SRP), in which the objective is to minimize a convex nonlinear function representing user dissatisfaction, and present four integer programming formulations for the SRP, together with computational results.

Research on shared vehicle systems is becoming increasingly widespread. Static Stations Balancing Problem is studied in Benchimol et al. (2011), and a 9.5-approximation algorithm is provided for this problem. Another closely related problem is that of Chemla, Meunier, and Wolfler Calvo (2013), where a bicycle station can be visited more than once for a pickup or a delivery. The authors provide a branch-and-cut algorithm as well as a tabu search algorithm for this problem. A variable neighborhood search algorithm for balancing bicycle sharing systems is designed in Rainer-Harbach, Papazek, Hu, and Raidl (2013). An interesting study by Schuijbroek, Hampshire, and van Hoeve (2013) employs queuing analysis to determine service level requirements at each bike sharing station, and to solve the resulting vehicle routing problem. A recent study (Nair & Miller-Hooks, 2014) analyzes the equilibrium network design problem of shared-vehicle systems and presents a bi-level, mixed-integer program.

Most of the problems cited above are based on a single demand or supply value for every customer, which restricts the vehicle to picking or delivering a preset number of commodities. The SBRP-DI is therefore more general, and empirically more difficult, because these values must lie within an interval. It is a special case of the models presented in Raviv et al. (2013) since these authors use a convex user dissatisfaction function which can be set to zero inside the interval and to infinity outside it. Let us define the deficit of station i as 
                        
                           
                              
                                 d
                              
                              
                                 i
                              
                           
                           =
                           max
                           {
                           
                              
                                 l
                              
                              
                                 i
                              
                           
                           -
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           ,
                           0
                           }
                        
                      and its excess as 
                        
                           
                              
                                 e
                              
                              
                                 i
                              
                           
                           =
                           max
                           {
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           -
                           
                              
                                 u
                              
                              
                                 i
                              
                           
                           ,
                           0
                           }
                        
                     . Transforming an instance of the SBRP-DI into one of the 1-PDTSP by setting the demand (supply) of a station to be equal to its deficit (excess) may yield an infeasible instance since the sum of the demands may not be equal to the sum of supplies.

In this study, we provide two exact algorithms for the SBRP-DI. To gain a better insight into the SBRP-DI, we first study the subproblem of computing pickup and delivery quantities when the vehicle route is fixed. We show that this subproblem is a minimum cost network flow problem (MCNFP), whether the handling cost 
                        
                           h
                           =
                           0
                        
                      or not. We also present a model for the general problem consisting of simultaneously determining the vehicle route as well as the pickup and delivery quantities. We develop a standard branch-and-cut algorithm as well as a Benders decomposition based branch-and-cut algorithm, and we present computational results for both cases.

The remainder of this paper is organized as follows. In Section 2, we study the subproblem corresponding to a fixed route, without and with handling cost. In Section 3 we present an integer linear programming formulation for the SBRP-DI based on our findings in Section 2, as well as valid inequalities we have adapted from the routing literature. A Benders decomposition scheme for the integer linear programming formulation is provided in Section 4, together with a unified branch-and-cut algorithm capable of handling both algorithms. This is followed by computational results in Section 5, and by conclusions in Section 6.

We first focus on the subproblem of determining the pickup and delivery amounts when the vehicle route is fixed. For the sake of simplicity, we assume that the vertices are numbered in the order they are visited. The two cases for which 
                        
                           h
                           =
                           0
                        
                      and 
                        
                           h
                           ⩾
                           0
                        
                      will be treated separately.

The fixed route subproblem without handling cost is called the SBRP-DIF and is defined on an auxiliary graph 
                           
                              
                                 
                                    G
                                 
                                 
                                    ^
                                 
                              
                              =
                              (
                              
                                 
                                    V
                                 
                                 
                                    ^
                                 
                              
                              ,
                              
                                 
                                    A
                                 
                                 
                                    ^
                                 
                              
                              )
                           
                        . Denote the set of vertices by 
                           
                              
                                 
                                    V
                                 
                                 
                                    ^
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ∪
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                        , with 
                           
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              =
                              V
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              =
                              {
                              n
                              +
                              1
                              }
                           
                        . The supply of vertex 
                           
                              i
                              ∈
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                           
                         is 
                           
                              
                                 
                                    
                                       
                                          b
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    
                                       
                                          b
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    n
                                    +
                                    1
                                 
                              
                              =
                              -
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    ∈
                                    V
                                 
                              
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                           
                        . Denote the set of arcs by 
                           
                              
                                 
                                    A
                                 
                                 
                                    ^
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ∪
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                        , where 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                         are constructed as follows. For every vertex 
                           
                              i
                              ∈
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ⧹
                              {
                              0
                              ,
                              n
                              }
                           
                        , insert an arc 
                           
                              (
                              i
                              ,
                              i
                              +
                              1
                              )
                           
                         into 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                           
                        , with cost 0, lower bound 0 and upper bound Q. These arcs represent the number of units transported to the next vertex. We also insert two arcs 
                           
                              (
                              0
                              ,
                              1
                              )
                           
                         and 
                           
                              (
                              n
                              ,
                              0
                              )
                           
                         into 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                           
                        , with cost 0, lower bound 0 and upper bounds 
                           
                              min
                              {
                              
                                 
                                    b
                                 
                                 
                                    0
                                 
                              
                              ,
                              Q
                              }
                           
                         and Q, respectively. These arcs represent number of units leaving and entering the depot. The flow on the arc 
                           
                              (
                              0
                              ,
                              1
                              )
                           
                         is also bounded above by the supply at the depot, in order to avoid commodities from flowing through the depot. For every vertex 
                           
                              i
                              ∈
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                           
                        , insert an arc 
                           
                              (
                              i
                              ,
                              n
                              +
                              1
                              )
                           
                         into 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                        , with cost 0, lower bound 
                           
                              
                                 
                                    l
                                 
                                 
                                    i
                                 
                              
                           
                         and upper bound 
                           
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                           
                        . This arc represents the final amount of the commodity left at vertex i. Define the set of arcs leaving vertex i as 
                           
                              
                                 
                                    δ
                                 
                                 
                                    +
                                 
                              
                              (
                              i
                              )
                           
                        , and the set of arcs entering vertex i as 
                           
                              
                                 
                                    δ
                                 
                                 
                                    -
                                 
                              
                              (
                              i
                              )
                           
                        . Let 
                           
                              
                                 
                                    z
                                 
                                 
                                    ij
                                 
                              
                           
                         denote the commodity flow on arc 
                           
                              (
                              i
                              ,
                              j
                              )
                           
                        . We write 
                           
                              z
                              (
                              S
                              )
                           
                         to denote the sum of the z variables in arc set S, i.e. 
                           
                              z
                              (
                              S
                              )
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    (
                                    i
                                    ,
                                    j
                                    )
                                    ∈
                                    S
                                 
                              
                              
                                 
                                    z
                                 
                                 
                                    ij
                                 
                              
                           
                        . We then have to solve
                           
                              (1)
                              
                                 (
                                 SBRP-DIF
                                 )
                                 
                                 z
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 -
                                 z
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       V
                                    
                                    
                                       ^
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (2)
                              
                                 
                                 
                                    
                                       l
                                    
                                    
                                       i
                                    
                                 
                                 ⩽
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 
                                    
                                       u
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (3)
                              
                                 
                                 0
                                 ⩽
                                 
                                    
                                       z
                                    
                                    
                                       01
                                    
                                 
                                 ⩽
                                 
                                    min
                                 
                                 {
                                 
                                    
                                       b
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 Q
                                 }
                              
                           
                        
                        
                           
                              (4)
                              
                                 
                                 0
                                 ⩽
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 Q
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ⧹
                                 {
                                 (
                                 0
                                 ,
                                 1
                                 )
                                 }
                                 )
                                 .
                              
                           
                        
                     


                        Fig. 1
                         depicts an instance of the SBRP-DIF. Using an enhanced capacity scaling algorithm, together with the fact that the number of arcs is 
                           
                              O
                              (
                              n
                              )
                           
                        , the problem stated above can be solved in 
                           
                              O
                              (
                              
                                 
                                    n
                                 
                                 
                                    2
                                 
                              
                              log
                              
                                 
                                    n
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         time (Ahuja, Magnanti, & Orlin, 1993).

The fixed route subproblem with handling cost is called the SBRP-DIHF and is defined on an auxiliary graph 
                           
                              
                                 
                                    G
                                 
                                 
                                    ‾
                                 
                              
                              =
                              (
                              
                                 
                                    V
                                 
                                 
                                    ‾
                                 
                              
                              ,
                              
                                 
                                    A
                                 
                                 
                                    ‾
                                 
                              
                              )
                           
                        . Denote the set of vertices by 
                           
                              
                                 
                                    V
                                 
                                 
                                    ‾
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ∪
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              ∪
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                           
                        , with 
                           
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              =
                              V
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                              =
                              {
                              2
                              n
                              +
                              2
                              }
                           
                        . We construct 
                           
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                         by including a vertex for every vertex 
                           
                              i
                              ∈
                              V
                           
                        , where the copy of vertex i in 
                           
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                         is 
                           
                              n
                              +
                              1
                              +
                              i
                           
                        . Set the supply of vertex 
                           
                              i
                              ∈
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                           
                         as 
                           
                              
                                 
                                    
                                       
                                          b
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                           
                         and the demand of vertex 
                           
                              n
                              +
                              1
                              +
                              i
                              ∈
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                         as 
                           
                              
                                 
                                    
                                       
                                          b
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    n
                                    +
                                    1
                                    +
                                    i
                                 
                              
                              =
                              -
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                           
                        . Let 
                           
                              
                                 
                                    
                                       
                                          b
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    2
                                    n
                                    +
                                    2
                                 
                              
                              =
                              0
                           
                        . Denote the set of arcs 
                           
                              
                                 
                                    A
                                 
                                 
                                    ‾
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ∪
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              ∪
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                           
                        , where 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                           
                         are constructed as follows. For vertices 
                           
                              i
                              ∈
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ⧹
                              {
                              0
                              ,
                              n
                              }
                           
                        , insert an arc 
                           
                              (
                              i
                              ,
                              i
                              +
                              1
                              )
                           
                         into 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                           
                        , with cost 0, lower bound 0 and upper bound Q. These arcs represent the number of units transported to the next vertex. We also insert two arcs 
                           
                              (
                              0
                              ,
                              1
                              )
                           
                         and 
                           
                              (
                              n
                              ,
                              0
                              )
                           
                         into 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                           
                        , with cost h, lower bound 0 and upper bound 
                           
                              min
                              {
                              
                                 
                                    b
                                 
                                 
                                    0
                                 
                              
                              ,
                              Q
                              }
                           
                         and Q, respectively. These arcs represent the commodity amounts carried out of and into the depot, respectively, and also account for the handling cost at the depot. Note that the flow on the arc 
                           
                              (
                              0
                              ,
                              1
                              )
                           
                         is also bounded above by the supply at the depot in order to avoid commodities from flowing through the depot. For every vertex in 
                           
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                           
                        , insert an arc 
                           
                              (
                              i
                              ,
                              n
                              +
                              1
                              +
                              i
                              )
                           
                         into 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                        , with cost 0, lower bound 
                           
                              
                                 
                                    l
                                 
                                 
                                    i
                                 
                              
                           
                         and upper bound 
                           
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                           
                        . These arcs represent the amount of commodity units left at vertex i after the visit of the vehicle. For every vertex in 
                           
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              ⧹
                              {
                              n
                              +
                              1
                              }
                           
                        , insert two arcs 
                           
                              (
                              n
                              +
                              1
                              +
                              i
                              ,
                              2
                              n
                              +
                              2
                              )
                           
                         and 
                           
                              (
                              2
                              n
                              +
                              2
                              ,
                              n
                              +
                              1
                              +
                              i
                              )
                           
                         into 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                           
                        , with cost h, lower bound 0 and upper bound Q. For vertex 
                           
                              n
                              +
                              1
                           
                        , also insert two arcs 
                           
                              (
                              n
                              +
                              1
                              ,
                              2
                              n
                              +
                              2
                              )
                           
                         and 
                           
                              (
                              2
                              n
                              +
                              2
                              ,
                              n
                              +
                              1
                              )
                           
                         into 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                           
                        , with cost 0, lower bound 0 and upper bound Q. These arcs represent the number of units unloaded and loaded at vertex i, respectively. Note that the handling cost at the depot has been modeled in a different way from that of the other vertices, since handling occurs twice at the depot, once in the beginning and once in the end of the tour. Let us define 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    3
                                 
                                 
                                    ′
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                              ∪
                              {
                              (
                              0
                              ,
                              1
                              )
                              ,
                              (
                              n
                              ,
                              0
                              )
                              }
                           
                         as the set of arcs with a positive cost, for the sake of simplicity. The resulting formulation for this subproblem is then
                           
                              (5)
                              
                                 (
                                 SBRP-DIFH
                                 )
                                 
                                 minimize
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                3
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 h
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                              
                           
                        
                        
                           
                              (6)
                              
                                 
                                 
                                 
                                 subject to
                                 
                                 z
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 -
                                 z
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       V
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (7)
                              
                                 
                                 
                                    
                                       l
                                    
                                    
                                       i
                                    
                                 
                                 ⩽
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 
                                    
                                       u
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (8)
                              
                                 
                                 0
                                 ⩽
                                 
                                    
                                       z
                                    
                                    
                                       01
                                    
                                 
                                 ⩽
                                 
                                    min
                                 
                                 {
                                 
                                    
                                       b
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 Q
                                 }
                              
                           
                        
                        
                           
                              (9)
                              
                                 
                                 0
                                 ⩽
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 Q
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       A
                                    
                                    
                                       ‾
                                    
                                 
                                 ⧹
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ∪
                                 {
                                 (
                                 0
                                 ,
                                 1
                                 )
                                 }
                                 )
                                 .
                              
                           
                        
                     


                        Fig. 2
                         depicts an instance of the SBRP-DIHF. As in the case of SBRP-DIHF, this problem can be solved in 
                           
                              O
                              (
                              
                                 
                                    n
                                 
                                 
                                    2
                                 
                              
                              log
                              
                                 
                                    n
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         time (Ahuja et al., 1993).

We now construct an integer programming formulation for SBRP-DI based on the minimum cost network flow formulation for the SBRP-DIHF presented in Section 2. Although it is possible to construct two different models, based on both network flow formulations, we opt to use the SBRP-DIHF model of Section 2.2 since it can handle both cases. To improve the lower bounds yielded by the relaxation of the formulation, we first strengthen the capacity constraints (17) using the implications of integrality. We next adapt the clique cluster inequalities for the 1-PDTSP (Hernández-Pérez & Salazar-González, 2007) to the SBRP-DIH. Finally, we adapt the arc-vertex inequalities, the strong connectivity constraints, and the strong 2-matching inequalities from the Covering Tour Problem (CTP) (Gendreau, Laporte, & Semet, 1997), the similarity of which enables us to adapt its valid inequalities. The proofs of validity of these constraints are identical for both problems.

Before presenting the formulation, we redefine 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                           
                         as 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              =
                              {
                              (
                              i
                              ,
                              j
                              )
                              :
                              i
                              ,
                              j
                              ∈
                              V
                              ,
                              i
                              
                              ≠
                              
                              j
                              }
                           
                        . With this new definition, the circuits on which the pickup and delivery decisions were considered in Section 2 become cliques, and we can incorporate routing decisions to the model. Also define the vehicle requirement of a subset 
                           
                              S
                              ⊂
                              V
                           
                         as 
                           
                              r
                              (
                              S
                              )
                              =
                              max
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      ∈
                                                      S
                                                   
                                                
                                                (
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                /
                                                Q
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      ∈
                                                      S
                                                   
                                                
                                                (
                                                
                                                   
                                                      l
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                /
                                                Q
                                             
                                          
                                       
                                    
                                 
                              
                           
                        . Denote the mandatory vertices as 
                           
                              
                                 
                                    T
                                 
                                 
                                    ‾
                                 
                              
                              =
                              
                                 
                                    
                                       i
                                       ∈
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       :
                                       i
                                       =
                                       0
                                       
                                       or
                                       
                                       
                                          
                                             d
                                          
                                          
                                             i
                                          
                                       
                                       >
                                       0
                                       
                                       or
                                       
                                       
                                          
                                             e
                                          
                                          
                                             i
                                          
                                       
                                       >
                                       0
                                    
                                 
                              
                           
                        . Let 
                           
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                           
                         be equal to 1 is the vehicle travels from vertex i to j, and 0 otherwise. We write 
                           
                              x
                              (
                              S
                              )
                           
                         to denote the sum of the x variables in arc set S, i.e. 
                           
                              x
                              (
                              S
                              )
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    (
                                    i
                                    ,
                                    j
                                    )
                                    ∈
                                    S
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                           
                        . Finally, let 
                           
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                           
                         be equal to 1 if vertex i is visited, and 0 otherwise. The formulation is
                           
                              (10)
                              
                                 (
                                 SBRP-DIH
                                 )
                                 
                                 minimize
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                3
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 h
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                              
                           
                        
                        
                           
                              (11)
                              
                                 
                                 
                                 subject to
                                 
                                 x
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 =
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                 x
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 =
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                 x
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 S
                                 )
                                 )
                                 ⩾
                                 r
                                 (
                                 S
                                 )
                                 
                                 (
                                 S
                                 ⊂
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (14)
                              
                                 
                                 x
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 S
                                 )
                                 )
                                 ⩾
                                 r
                                 (
                                 S
                                 )
                                 
                                 (
                                 S
                                 ⊂
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (15)
                              
                                 
                                 z
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 -
                                 z
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       V
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (16)
                              
                                 
                                 
                                    
                                       z
                                    
                                    
                                       0
                                       j
                                    
                                 
                                 ⩽
                                 
                                    min
                                 
                                 {
                                 
                                    
                                       b
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 Q
                                 }
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 (
                                 (
                                 0
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (17)
                              
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 
                                    
                                       Qx
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 :
                                 i
                                 
                                 ≠
                                 
                                 0
                                 )
                              
                           
                        
                        
                           
                              (18)
                              
                                 
                                 
                                    
                                       l
                                    
                                    
                                       i
                                    
                                 
                                 ⩽
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 
                                    
                                       u
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (19)
                              
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 
                                    
                                       Qy
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       3
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (20)
                              
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 0
                                 
                                 or
                                 
                                 1
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       A
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (21)
                              
                                 
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 0
                                 
                                 or
                                 
                                 1
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ⧹
                                 
                                    
                                       T
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (22)
                              
                                 
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 1
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       T
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (23)
                              
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩾
                                 0
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       A
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                                 .
                              
                           
                        Equalities (11) set the outflow of a vertex to 1 if it is visited, and to 0 otherwise. Similarly, Equalities (12) set the inflow of a vertex to 1 if it is visited, and to 0 otherwise. Inequalities (13) and (14) are the connectivity constraints which define the minimum outdegree and indegree of a subset of vertices as a function of the capacity requirements. Equalities (15) enforce the flow conservation conditions. Constraints (16) and (17) are capacity constraints, which restrict the flow of commodities on an arc to the capacity of the vehicle. Constraints (18) ensure that the demand interval requirements are met. Constraints (19) forbid loading and unloading operations at a vertex if it is not visited. Constraints (20) and (21) are integrality constraints. Constraints (22) force the depot, the vertices with positive deficits, and the vertices with positive excesses to be visited. Finally, constraints (23) are non-negativity constraints.

We now strengthen the capacity constraints (16) and (17) by using coefficients which imply that a vehicle leaving a vertex should have sufficient capacity to pick up the excess of the vertex if it has an excess, or to deliver the deficit of the vertex if it has a deficit. Let 
                           
                              
                                 
                                    α
                                 
                                 
                                    ij
                                 
                              
                           
                         denote the upper bound on 
                           
                              
                                 
                                    z
                                 
                                 
                                    ij
                                 
                              
                           
                        :
                           
                              
                                 
                                    
                                       α
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Q
                                                
                                                
                                                   (
                                                   i
                                                   ,
                                                   j
                                                   
                                                   ≠
                                                   
                                                   0
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩾
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   Q
                                                   +
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   (
                                                   i
                                                   ,
                                                   j
                                                   
                                                   ≠
                                                   
                                                   0
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   <
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   Q
                                                   +
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                                
                                                   (
                                                   i
                                                   ,
                                                   j
                                                   
                                                   ≠
                                                   
                                                   0
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩾
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   >
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      min
                                                   
                                                   {
                                                   Q
                                                   +
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   Q
                                                   +
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   }
                                                
                                                
                                                   (
                                                   i
                                                   ,
                                                   j
                                                   
                                                   ≠
                                                   
                                                   0
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   <
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   >
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      min
                                                   
                                                   {
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   ,
                                                   Q
                                                   }
                                                
                                                
                                                   (
                                                   i
                                                   =
                                                   0
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      min
                                                   
                                                   {
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   ,
                                                   Q
                                                   +
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   }
                                                
                                                
                                                   (
                                                   i
                                                   =
                                                   0
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   >
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      min
                                                   
                                                   {
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   ,
                                                   Q
                                                   }
                                                
                                                
                                                   (
                                                   j
                                                   =
                                                   0
                                                   )
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        With this definition of 
                           
                              
                                 
                                    α
                                 
                                 
                                    ij
                                 
                              
                           
                        , we can unify and strengthen (16) and (17) as
                           
                              (24)
                              
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 
                                    
                                       α
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 .
                              
                           
                        
                     


                        Clique cluster inequalities are an adaptation of the rank inequalities for the Stable Set Problem. Hernández-Pérez and Salazar-González (2007) have adapted the clique inequalities to the 1-PDTSP by considering subsets of vertices 
                           
                              
                                 
                                    W
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    W
                                 
                                 
                                    m
                                 
                              
                           
                         satisfying the following conditions: (1) all subsets intersect at a single vertex 
                           
                              v
                              :
                              (
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                              ∩
                              
                                 
                                    W
                                 
                                 
                                    l
                                 
                              
                              =
                              {
                              v
                              }
                              ,
                              1
                              ⩽
                              k
                              <
                              l
                              ⩽
                              m
                              )
                           
                        ; (2) the capacity requirement of any subset does not exceed the vehicle capacity 
                           
                              (
                              r
                              (
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                              )
                              ⩽
                              1
                              ,
                              1
                              ⩽
                              k
                              ⩽
                              m
                              )
                           
                        ; (3) the capacity requirement of the union of any two subsets exceeds the vehicle capacity 
                           
                              (
                              r
                              (
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                              ∪
                              
                                 
                                    W
                                 
                                 
                                    l
                                 
                              
                              )
                              ⩾
                              2
                              ,
                              1
                              ⩽
                              k
                              <
                              l
                              ⩽
                              m
                              )
                           
                        . By construction of the customer subsets, only customers in one subset 
                           
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                           
                         can be visited consecutively, implying 
                           
                              x
                              (
                              
                                 
                                    δ
                                 
                                 
                                    +
                                 
                              
                              (
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                              )
                              )
                              =
                              1
                           
                        . The remaining subsets 
                           
                              
                                 
                                    W
                                 
                                 
                                    l
                                 
                              
                           
                         must satisfy 
                           
                              x
                              (
                              
                                 
                                    δ
                                 
                                 
                                    +
                                 
                              
                              (
                              
                                 
                                    W
                                 
                                 
                                    l
                                 
                              
                              )
                              )
                              ⩾
                              2
                           
                        . Summing up the inequality and the following inequalities we obtain
                           
                              (25)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          m
                                       
                                    
                                 
                                 x
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 
                                    
                                       W
                                    
                                    
                                       k
                                    
                                 
                                 )
                                 )
                                 ⩾
                                 2
                                 m
                                 -
                                 1
                                 .
                              
                           
                        We emphasize that the transshipment vertices are an exception, since they do not exist in 1-PDTSP, and their existence may result in 
                           
                              r
                              (
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                              )
                              =
                              0
                           
                         or 
                           
                              r
                              (
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                              ⧹
                              {
                              v
                              }
                              =
                              0
                           
                        . To handle this exception, we modify the second condition as follows: (2) the capacity requirement of any customer subset is exactly one, even when the intersection vertex is deleted 
                           
                              (
                              r
                              (
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                              )
                              =
                              1
                           
                         and 
                           
                              r
                              (
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                              ⧹
                              {
                              v
                              }
                              )
                              =
                              1
                              ,
                              1
                              ⩽
                              k
                              ⩽
                              m
                              )
                           
                        .


                        
                           Proposition 1
                           
                              The inequalities
                              
                                 
                                    (26)
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       ⩽
                                       
                                          
                                             y
                                          
                                          
                                             i
                                          
                                       
                                       
                                       (
                                       (
                                       i
                                       ,
                                       j
                                       )
                                       ∈
                                       
                                          
                                             
                                                
                                                   A
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                              
                              and
                              
                                 
                                    (27)
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       ⩽
                                       
                                          
                                             y
                                          
                                          
                                             j
                                          
                                       
                                       
                                       (
                                       (
                                       i
                                       ,
                                       j
                                       )
                                       ∈
                                       
                                          
                                             
                                                
                                                   A
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                              
                              are valid for SBRP-DIH.
                           


                        
                           Proposition 2
                           
                              The following inequalities are valid for SBRP-DIH:
                              
                                 
                                    (28)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                ∈
                                                S
                                                ,
                                                j
                                                ∈
                                                
                                                   
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            ‾
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ⧹
                                                S
                                             
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       ⩾
                                       1
                                       
                                       (
                                       S
                                       ⊂
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       :
                                       2
                                       ⩽
                                       |
                                       S
                                       |
                                       ⩽
                                       |
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       |
                                       -
                                       2
                                       ,
                                       
                                          
                                             T
                                          
                                          
                                             ‾
                                          
                                       
                                       ⧹
                                       S
                                       
                                       ≠
                                       
                                       ∅
                                       ,
                                       S
                                       ∩
                                       
                                          
                                             T
                                          
                                          
                                             ‾
                                          
                                       
                                       
                                       ≠
                                       
                                       ∅
                                       )
                                       .
                                    
                                 
                              
                              We refer the reader to the study by 
                              Gendreau et al. (1997) 
                              for a proof of 
                              Proposition 2.


                        
                           Proposition 3
                           
                              The following inequalities are valid for SBRP-DIH:
                              
                                 
                                    (29)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                ,
                                                j
                                                ∈
                                                H
                                                :
                                                i
                                                ≠
                                                j
                                             
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       +
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                                ∈
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       +
                                       
                                          
                                             x
                                          
                                          
                                             ji
                                          
                                       
                                       )
                                       ⩽
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                ∈
                                                H
                                             
                                          
                                       
                                       
                                          
                                             y
                                          
                                          
                                             i
                                          
                                       
                                       +
                                       
                                          
                                             1
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       |
                                       
                                          
                                             A
                                          
                                          
                                             ′
                                          
                                       
                                       |
                                       -
                                       1
                                       )
                                       ,
                                    
                                 
                              
                              for all 
                              
                                 
                                    H
                                    ⊂
                                    
                                       
                                          
                                             
                                                V
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                 
                               
                              and 
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ′
                                       
                                    
                                    ⊂
                                    
                                       
                                          
                                             
                                                A
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                 
                               
                              satisfying
                              
                                 
                                    (i)
                                    
                                       
                                          
                                             |
                                             {
                                             i
                                             ,
                                             j
                                             }
                                             ∩
                                             H
                                             |
                                             =
                                             1
                                             
                                             (
                                             (
                                             i
                                             ,
                                             j
                                             )
                                             ∈
                                             
                                                
                                                   A
                                                
                                                
                                                   ′
                                                
                                             
                                             )
                                          
                                       
                                       ,
                                    


                                       
                                          
                                             {
                                             i
                                             ,
                                             j
                                             }
                                             ∩
                                             {
                                             k
                                             ,
                                             l
                                             }
                                             =
                                             ∅
                                             
                                             (
                                             (
                                             i
                                             ,
                                             j
                                             )
                                             
                                             ≠
                                             
                                             (
                                             k
                                             ,
                                             l
                                             )
                                             ∈
                                             
                                                
                                                   A
                                                
                                                
                                                   ′
                                                
                                             
                                             )
                                          
                                       
                                       ,
                                    


                                       
                                          
                                             |
                                             
                                                
                                                   A
                                                
                                                
                                                   ′
                                                
                                             
                                             |
                                             ⩾
                                             3
                                          
                                        
                                       and odd.
                                    


                              We refer the reader to the study by 
                              Gendreau et al. (1997) 
                              for a proof of 
                              
                                 Proposition 3
                              . To identify the violated strong 2-matching constraints, we use the heuristic of 
                              Padberg and Rinaldi (1990)
                              .
                           

In this section we present the details of a Benders decomposition scheme, and a unified branch-and-cut algorithm to solve the full formulations as well as the master problem of the Benders decomposition.

The formulation SBRP-DIH includes a MCNFP as a subproblem, which allows us to apply Benders decomposition. To this end, we remove the flow variables 
                           
                              
                                 
                                    z
                                 
                                 
                                    ij
                                 
                              
                           
                         along with the associated constraints, and we add an auxiliary variable to construct the master problem.
                           
                              (30)
                              
                                 (
                                 MP
                                 )
                                 
                                 minimize
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 +
                                 w
                              
                           
                        
                        
                           
                              (31)
                              
                                 
                                 subject to
                                 
                                 x
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 =
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (32)
                              
                                 
                                 x
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 =
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (33)
                              
                                 
                                 x
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 S
                                 )
                                 )
                                 ⩾
                                 r
                                 (
                                 S
                                 )
                                 
                                 (
                                 S
                                 ⊂
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (34)
                              
                                 
                                 x
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 S
                                 )
                                 )
                                 ⩾
                                 r
                                 (
                                 S
                                 )
                                 
                                 (
                                 S
                                 ⊂
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (35)
                              
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 0
                                 
                                 or
                                 
                                 1
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       A
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (36)
                              
                                 
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 0
                                 
                                 or
                                 
                                 1
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ⧹
                                 
                                    
                                       T
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (37)
                              
                                 
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 1
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       T
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (38)
                              
                                 
                                 w
                                 ⩾
                                 0
                                 .
                              
                           
                        The slave problem is constructed by fixing the 
                           
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                           
                         and 
                           
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                           
                         variables to an optimal solution of the MP. For the sake of simplicity, let 
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    ij
                                 
                              
                              =
                              h
                           
                         if 
                           
                              (
                              i
                              ,
                              j
                              )
                              ∈
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    3
                                 
                                 
                                    ′
                                 
                              
                           
                        , and 0 otherwise. The resulting slave problem is given below:
                           
                              (39)
                              
                                 (
                                 SP
                                 )
                                 
                                 minimize
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                A
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                              
                           
                        
                        
                           
                              (40)
                              
                                 
                                 subject to
                                 
                                 z
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 -
                                 z
                                 (
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 i
                                 )
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 i
                                 ∈
                                 
                                    
                                       V
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                                 ,
                              
                           
                        
                        
                           
                              (41)
                              
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 
                                    
                                       α
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                    
                                       ∗
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                              
                           
                        
                        
                           
                              (42)
                              
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩾
                                 
                                    
                                       l
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (43)
                              
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 
                                    
                                       u
                                    
                                    
                                       i
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (44)
                              
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩽
                                 
                                    
                                       Qy
                                    
                                    
                                       i
                                    
                                    
                                       ∗
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       3
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (45)
                              
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                 
                                 ⩾
                                 0
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       A
                                    
                                    
                                       ‾
                                    
                                 
                                 )
                                 .
                              
                           
                        
                     

The next step is to construct the dual of the slave problem whose solution will yield valid inequalities. Let us associate the dual variable sets 
                           
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    v
                                 
                                 
                                    5
                                 
                              
                           
                         with constraints sets (40)–(44) of the SP. The dual slave problem is then
                           
                              (46)
                              
                                 (
                                 DSP
                                 )
                                 
                                 maximize
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          ∈
                                          
                                             
                                                V
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       α
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                    
                                       ∗
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                l
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                v
                                             
                                             
                                                ij
                                             
                                             
                                                3
                                             
                                          
                                          +
                                          
                                             
                                                u
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                v
                                             
                                             
                                                ij
                                             
                                             
                                                4
                                             
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       Qy
                                    
                                    
                                       i
                                    
                                    
                                       ∗
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       5
                                    
                                 
                              
                           
                        
                        
                           
                              (47)
                              
                                 
                                 subject to
                                 
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                    
                                       1
                                    
                                 
                                 -
                                 
                                    
                                       v
                                    
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       2
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (48)
                              
                                 
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                    
                                       1
                                    
                                 
                                 -
                                 
                                    
                                       v
                                    
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       3
                                    
                                 
                                 +
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       4
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (49)
                              
                                 
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                    
                                       1
                                    
                                 
                                 -
                                 
                                    
                                       v
                                    
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       5
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 (
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       3
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (50)
                              
                                 
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                                 
                                 unrestricted,
                                 
                                    
                                       v
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       4
                                    
                                 
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       5
                                    
                                 
                                 ⩽
                                 0
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       3
                                    
                                 
                                 ⩾
                                 0
                                 .
                              
                           
                        If the optimal solution value of the DSP is strictly greater than that of the auxiliary variable 
                           
                              
                                 
                                    w
                                 
                                 
                                    ∗
                                 
                              
                           
                        , we add an optimality cut of the following form to the MP, using the optimal solution 
                           
                              
                                 
                                    v
                                 
                                 
                                    ∗
                                 
                              
                           
                         of the DSP:
                           
                              (51)
                              
                                 w
                                 ⩾
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          ∈
                                          
                                             
                                                V
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                    
                                       1
                                       ∗
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       α
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       2
                                       ∗
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                l
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                v
                                             
                                             
                                                ij
                                             
                                             
                                                3
                                                ∗
                                             
                                          
                                          +
                                          
                                             
                                                u
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                v
                                             
                                             
                                                ij
                                             
                                             
                                                4
                                                ∗
                                             
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       Qy
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       5
                                       ∗
                                    
                                 
                                 .
                              
                           
                        Note that these inequalities are required only when 
                           
                              h
                              >
                              0
                           
                        . If the DSP is unbounded, we add a feasibility cut of the following form to the MP, using the unbounded ray 
                           
                              
                                 
                                    v
                                 
                                 
                                    ∗
                                 
                              
                           
                        :
                           
                              (52)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          ∈
                                          
                                             
                                                V
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                    
                                       1
                                       ∗
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       α
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       2
                                       ∗
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                l
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                v
                                             
                                             
                                                ij
                                             
                                             
                                                3
                                                ∗
                                             
                                          
                                          +
                                          
                                             
                                                u
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         4
                                                         ∗
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       Qv
                                    
                                    
                                       ij
                                    
                                    
                                       5
                                       ∗
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 ⩽
                                 0
                                 .
                              
                           
                        The feasibility cuts can also be upgraded to yield the rounded Benders inequalities:
                           
                              (53)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 
                                 ⌊
                                 
                                    
                                       α
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       2
                                       ∗
                                    
                                 
                                 ⌋
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                 
                                 ⌊
                                 
                                    
                                       Qv
                                    
                                    
                                       ij
                                    
                                    
                                       5
                                       ∗
                                    
                                 
                                 ⌋
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 ⩽
                                 ⌊
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          ∈
                                          
                                             
                                                V
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                    
                                       1
                                       ∗
                                    
                                 
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ‾
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       l
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       3
                                       ∗
                                    
                                 
                                 -
                                 
                                    
                                       u
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ij
                                    
                                    
                                       4
                                       ∗
                                    
                                 
                                 )
                                 ⌋
                                 .
                              
                           
                        
                     

Our unified branch-and-cut algorithm, capable of handling both SBRP-DIH and MP, can be summarized as follows.
                           
                              
                                 Step 1 (Root node).
                              
                              Construct a subproblem consisting of the initial formulation and insert this subproblem in a list.

If the list is empty, stop. Else select and remove a subproblem from the list.

Solve the subproblem. If the objective function value is less than the best lower bound, go to Step 2.

Identify violated members of the arc-vertex constraints, strong connectivity constraints, strong 2-matching constraints, clique cluster inequalities, and add them to the subproblem. For MP, also solve DSP and identify violated feasibility cuts and optimality cuts. If at least one constraint is generated, go to Step 3.

If the solution is integer, update the best known solution, and go to Step 2.

Construct two subproblems by branching on a binary fractional variable. Add the subproblems to the list and go to Step 2.

To separate the connectivity constraints (13), (14), and the clique cluster inequalities (25), we have used the separation algorithms described in Hernández-Pérez and Salazar-González (2007). To identify the violated strong 2-matching inequalities, we have used the heuristic of Padberg and Rinaldi (1990).

We have implemented the branch-and-cut algorithm using C++ and the Callable Library of CPLEX 12.1 on the IRIDIS 3 computing cluster having Intel Nehalem nodes with two 4-core processors and 22gigabytes of RAM. We have adapted a subset of the 1-PDTSP instances provided by Hernández-Pérez and Salazar-González (2007), which are available at http://hhperez.webs.ull.es/PDsite/. Note that these instances associate a negative quantity with a vertex to denote a demand, and a positive quantity to denote a supply. We have assumed all our vertices to have an identical lower bound p, and an identical upper bound q. Given the set of supply and demand values 
                        
                           
                              
                                 b
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                        
                     , we have set 
                        
                           p
                           =
                           -
                           
                              
                                 min
                              
                              
                                 i
                                 ∈
                                 V
                              
                           
                           
                              
                                 
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                        
                     , and used the following rule to determine the current supply of vertex i:
                        
                           
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                +
                                                q
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         >
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                p
                                                +
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         <
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ⌊
                                                (
                                                p
                                                +
                                                q
                                                )
                                                /
                                                2
                                                ⌋
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         =
                                                         0
                                                      
                                                   
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     This choice of p ensures that 
                        
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           ⩾
                           0
                           ,
                           
                           
                              
                                 d
                              
                              
                                 i
                              
                           
                           =
                           -
                           
                              
                                 b
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                        
                      if 
                        
                           
                              
                                 b
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           <
                           0
                        
                     , and 
                        
                           
                              
                                 e
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 b
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                        
                      if 
                        
                           
                              
                                 b
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           >
                           0
                        
                     , for all 
                        
                           i
                           ∈
                           V
                        
                     . Consequently, our parameter for experimentation becomes q, which is constrained to be at least equal to p. We have experimented with 
                        
                           q
                           -
                           p
                           ∈
                           {
                           1
                           ,
                           2
                           ,
                           3
                           ,
                           4
                           ,
                           5
                           }
                           ,
                           h
                           =
                           0
                        
                      and 
                        
                           h
                           ⩾
                           0
                        
                     . As h grows, the SBRP-DIH instances behave increasingly similar to 
                        
                           q
                           -
                           p
                           =
                           0
                        
                     , since extra handling is discouraged. We have observed that the CPU time requirement is almost identical for relatively small values of h and 
                        
                           h
                           =
                           0
                        
                     , and we only report results for 
                        
                           h
                           =
                           0
                        
                     . We have adapted 240 instances, which yielded 1200 instances when combined with the range of 
                        
                           q
                           -
                           p
                        
                     . Table 1
                      provides results for 
                        
                           |
                           V
                           |
                           =
                           30
                        
                     . Tables 2 and 3
                     
                      present the results for 
                        
                           |
                           V
                           |
                           =
                           40
                        
                      and 
                        
                           |
                           V
                           |
                           =
                           50
                        
                     , respectively. The column “Name” refers to ten instances that share it, e.g. row n30q10 corresponds to average results on 10 instances. The detailed results are available upon request from the first author.

We first present computational results corresponding to the branch-and-cut algorithm used in the solution of SBRP-DIH. When 
                        
                           |
                           V
                           |
                           =
                           30
                        
                     , all instances are solved optimally within six minutes. Table 1 shows that the problem becomes easier as 
                        
                           q
                           -
                           p
                        
                      increases. This is due to the fact that vertices with a deficit can absorb more units, vertices with an excess can supply more, and transshipment vertices have a larger degree of freedom in both directions. Table 1 also shows that solution quality also improves when 
                        
                           q
                           -
                           p
                        
                      becomes larger. This is reflected by the column “gain” which reports the decrease in the objective function with respect to the base case “
                        
                           q
                           -
                           p
                           =
                           0
                        
                     ”. When 
                        
                           |
                           V
                           |
                           =
                           40
                        
                     , all instances are also solved optimally within 12minutes. Tables 2 and 3 report the average CPU times in seconds to solve instances with 
                        
                           q
                           -
                           p
                           =
                           0
                        
                      and 
                        
                           q
                           -
                           p
                           =
                           10
                        
                      for 
                        
                           |
                           V
                           |
                           =
                           30
                        
                      and 
                        
                           |
                           V
                           |
                           =
                           40
                        
                     , respectively. These tables demonstrate the behavior of the algorithm when the instance at hand is closest to the 1-PDTSP (
                        
                           q
                           -
                           p
                           =
                           0
                        
                     ), and when it is closest to the TSP (
                        
                           q
                           -
                           p
                           =
                           10
                        
                     ). When 
                        
                           |
                           V
                           |
                           =
                           50
                        
                     , it is not always possible to solve the problem optimally within two hours of computing time, and our algorithm successfully solves 367 out of 400 instances. The hardest instances are those with low vehicle capacities, and the maximum observed optimality gap is 6.39%. In Table 4
                     , we report the average gaps with respect to the best known lower bound generated by the branch-and-cut algorithm. It can be observed that the average gaps are less than 1% over all instances, and the average computing times are below 40minutes.

The results obtained by solving MP improve upon those of SBRP-DIH in general. CPU times for 
                        
                           |
                           V
                           |
                           =
                           30
                        
                      presented in Table 4 show the superiority of MP over SBRP-DIH. The only exception is a single instance for 
                        
                           q
                           -
                           p
                           =
                           5
                        
                     , for which CPLEX struggled to find the integer optimal solution for about 40minutes. The same behavior is observed for 
                        
                           |
                           V
                           |
                           =
                           40
                        
                     , where MP is solved 4.5 times faster than SBRP-DIH on average. Similar to the analysis of SBRP-DIH, Tables 5 and 6
                     
                      report the average CPU times in seconds to solve instances with 
                        
                           q
                           -
                           p
                           =
                           0
                        
                      and 
                        
                           q
                           -
                           p
                           =
                           10
                        
                      for 
                        
                           |
                           V
                           |
                           =
                           30
                        
                      and 
                        
                           |
                           V
                           |
                           =
                           40
                        
                     , respectively. These tables demonstrate the behavior of the algorithm when the instance at hand is closest to the 1-PDTSP (
                        
                           q
                           -
                           p
                           =
                           0
                        
                     ), and when it is closest to the TSP (
                        
                           q
                           -
                           p
                           =
                           10
                        
                     ). The computational reach of both formulations seems to be 
                        
                           |
                           V
                           |
                           =
                           50
                        
                     , with MP being solved 1.5 times faster than SBRP-DIH on average, and 14 more instances being successfully solved to optimality within two hours of CPU time. Table 7
                      provides computational results for 
                        
                           |
                           V
                           |
                           =
                           50
                        
                     . Note that in spite of a better performance in terms of CPU time, MP struggles to find good initial solutions for larger instances with relatively low values of 
                        
                           q
                           -
                           p
                        
                     , resulting in higher gaps as observed for 
                        
                           |
                           V
                           |
                           =
                           50
                        
                      and 
                        
                           q
                           -
                           p
                           =
                           2
                        
                     .

@&#CONCLUSIONS@&#

We have introduced, modeled, and solved the SBRP-DI, a variant of the 1-PDTSP encountered in the repositioning of bicycles in public sharing systems. We have first studied the subproblem arising when the vehicle route is fixed, and we have showed it to be a MCNFP, whether the handling cost is zero or not. Based on the network flow formulation, we have developed an integer programming formulation. We have imported valid inequalities from the routing literature, and we have developed a branch-and-cut algorithm as well as a Benders decomposition scheme. We have described a unified branch-and-cut algorithm capable of handling both the full model and the master problem of the Benders decomposition. We have also presented computational results for instances adapted from 1-PDTSP. SBRP-DI is observed to be easier than 1-PDTSP, due to the flexibility provided by the demand intervals. The branch-and-cut algorithm is capable of solving instances with up to 50 vertices by either formulation. However, the Benders based formulation and algorithm yield much shorter computation times and can solve more instances.

@&#ACKNOWLEDGMENTS@&#

This study was partially supported by Centre for Operational Research, Management Science and Information Systems (CORMSIS) based within the University of Southampton, and by the Canadian Natural Sciences and Engineering Research Council under Grant 39682-10. This support is gratefully acknowledged. Thanks are due to the two anonymous referees for their valuable comments.

@&#REFERENCES@&#

