@&#MAIN-TITLE@&#Associative topic models with numerical time series

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Introduce a probabilistic graphical model extracting topics with numerical guidance.


                        
                        
                           
                           Enhance the regression performance with unified PGM of text and numbers.


                        
                        
                           
                           Tightly links the analysis on numeric and text data over time.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Time series analysis

Topic models

Text mining

@&#ABSTRACT@&#


               
               
                  A series of events generates multiple types of time series data, such as numeric and text data over time, and the variations of the data types capture the events from different angles. This paper aims to integrate the analyses on such numerical and text time-series data influenced by common events with a single model to better understand the events. Specifically, we present a topic model, called an associative topic model (ATM), which finds the soft cluster of time-series text data guided by time-series numerical value. The identified clusters are represented as word distributions per clusters, and these word distributions indicate what the corresponding events were. We applied ATM to financial indexes and president approval rates. First, ATM identifies topics associated with the characteristics of time-series data from the multiple types of data. Second, ATM predicts numerical time-series data with a higher level of accuracy than does the iterative model, which is supported by lower mean squared errors.
               
            

@&#INTRODUCTION@&#

Probabilistic topic models are probabilistic graphical models used to cluster a corpus with semantics (Blei, Ng, & Jordan, 2003; Griffiths & Steyvers, 2004; McCallum, Corrada-Emmanuel, & Wang, 2005), and they have been successful in analyzing diverse sources of text as well as image data (Gupta & Manning, 2011; Hörster, Lienhart, & Slaney, 2007; Khurdiya, Dey, Raj, & Haque, 2011; Ramage, Dumais, & Liebling, 2010). The essence of the topic models is the probabilistic modeling of how to generate the words in documents, given the prior knowledge of word distributions per key ideas, called topics, in the corpus. Specifically, a topic is a probability distribution over a vocabulary, and the topic models assume that a document is a mixture of multiple topics. These ideas are implicit because they cannot be directly observed, so some describe these topics as latent topics (Blei, 2012). The latent Dirichlet allocation (LDA) (Blei et al., 2003), one of the popular topic models, is the Bayesian approach to modeling such generation processes.

Given the success of LDA, many expansions of LDA are introduced, and they strengthen the probabilistic process of generating topics and words with additional information. One type of such additional information is the meta-data of documents. For instance, the author-topic model (Rosen-Zvi, Griffiths, Steyvers, & Smyth, 2004) includes the authorship model to produce additional estimations on the authorship as well as better topic modeling results. Another type of information is the prior information on the corpus characteristics. For instance, the aspect-sentiment unification model (Jo & Oh, 2011) utilizes the sentiment information of words as priors to estimate the sentiment of topics. While the expansion is motivated by the additional information, such expansion is often realized by either adding additional variables in the graphical model or calibrating prior settings in the inference process.

While most variations of LDA augment the data, such as sentiment lexicons and authorships, from either text data or the meta-data of the corpus, several models relate text data to other types of data, such as geospatial data (Sizov, 2012) and document-level labels (Blei & McAuliffe, 2007; Chen, Zhu, Kifer, & Lee, 2010; Ramage, Hall, Nallapati, & Manning, 2009). This paper considers integrating texts and numerical data over time. We assume that there are events that become the common cause of dynamics in the text and the numeric data. Then, we are interested in identifying the representations of such events which are not directly observable from the corpus and the numbers. For instance, there are latent events, such as interest rate changes or policy changes, in the stock markets that cause the generation of news articles and numerical data. Our goal is to represent such latent events with word distributions per events. The key to identifying such events is the correlation between texts and numeric variables associated with the events. Such correlations between numerical and textual data are common in product sales (Liu, Huang, An, & Yu, 2007), candidate approval (Livne, Simmons, Adar, & Adamic, 2011), and box-office revenues (Asur & Huberman, 2010). In these domains, understanding why we see such numerical fluctuation with the textual context can provide a key insight, i.e., finding a topic that resulted in the huge drop of a stock index.

This paper introduces a new topic model called an associative topic model (ATM), which correlates the time-series data of text and numerical values. We define an associative topic as a soft cluster of unique words whose likelihood of cluster association is influenced by the appearances on documents as well as the fluctuation of numeric values over-time. The association likelihood of words to clusters, or associative topics, is inferred to maximize the joint probability including factors of text generation and numeric value generation by the proportion of topics over-time. The topic proportion is the likelihood of the cluster, or topic, appearance on a certain time, which means that our data consists of timed batch datasets of texts and numbers over the period. In other words, The model assumes that the text and the numerical value at the same timed-batch are generated from a common latent random variable of topic proportions, which indicate the relative ratio of topic appearances at the time (Blei & Lafferty, 2006; Putthividhy, Attias, & Nagarajan, 2010). For instance, a topic on tax could be strongly related to and influencing to the generation of economic articles as well stock prices, for example. Then, we interpret that increasing the proportion of tax topic is the event influencing the numerical-data and text-data generation.

This assumption enables the numerical value to adjust the topic extraction from texts through its movements. Fig. 1
                      describes an example of an associative topic. The associative topic provides summarized information about text-data, and its appearance over time is highly related to the numerical time-series data. Such associative topics are useful in interpretations and predictions. For the interpretation, the associative topics hold more information about the numerical context than do the topics from only texts. Also, the associative topics enable the prediction of the numerical value of the next time step with high accuracy. Fig. 2
                      explains the inputs and the outputs of ATM. A time-series numerical datum, 
                        
                           
                              
                                 y
                              
                              
                                 1
                                 :
                                 T
                              
                           
                        
                     , and time-series text datum, 
                        
                           
                              
                                 D
                              
                              
                                 1
                                 :
                                 T
                              
                           
                        
                      are input data for ATM. ATM provides associated topics with correlation indexes and topic proportions over time indicating the dynamics of topic appearances in text data. Additionally, ATM can predict the next time numerical value, 
                        
                           
                              
                                 y
                              
                              
                                 T
                                 +
                                 1
                              
                           
                        
                     , with the next time text data, 
                        
                           
                              
                                 D
                              
                              
                                 T
                                 +
                                 1
                              
                           
                        
                     .

Inherently, the proposed model infers associative topics that are adjusted to better explain the associated numerical values. When this paper applies the model to the three datasets, the economic news corpus and the stock return from the Dow Jones Industrial Average (DJIA), the same news corpus and the stock volatilities from the DJIA, and the news corpus related to the president and president approval index, we observe that the model provides adjusted topics that explain each numerical value movement. Associative topics extracted from the proposed model have a higher correlation with time-series data when there is a relationship between the text and the numerical data. Also, the model becomes a forecasting model that predicts the next time variable by considering the past text and numerical data. We experimented with the model to predict the numerical time-series variable, and we found that the proposed model provides topics better adapted to the time-series values and better predicts the next time numerical value than do the previous approaches. The contributions of the paper are summarized as follows:
                        
                           –
                           We introduced a model to analyze a bi-modal dataset including text and numerical time-series data, which have different characteristics. This is the first unified topic model for the numerical and text bimodal dataset without batch-processing two different models for each data type.

In the parameter inference of the presented model, we introduced a method for estimating the expectation of the softmax function with Gaussian inputs, which was inevitable in the process of relating the numerical and the text data. This parameter inference technique is applicable to diverse cases of joining two datasets originating from the continuous and discrete domains.

There are several attempts to integrate side information with topic models. Basically, three kinds of side information have been considered: document-level features (i.e., categories, sentiment label, hits, etc.), word-level features (i.e., term volume), and corpus-level features (i.e. product sales, stock indexes). For document-level features, several topic models (Blei & McAuliffe, 2007; Ramage et al., 2009; Zhu, Ahmed, & Xing, 2012) are suggested to incorporate features of a document with the topic information of the document. In order to incorporate them, either the conditional latent topic assignment or the hyper-parameters of conditional distribution is used. For word-level features, a fully generative model (Hong, Yin, Guo, & Davison, 2011) was developed to incorporate features of a word with the significance of the word in topics. More specially, the model integrates a temporal topic model and temporal term-volumes, which is a sort of time series. This work is similar to our work in modeling time-series variables. However, they focused on the prediction of word volumes in text, while we considered time-series numerical variables from a different source not directly related to text data. Also, they assumed topic representation would be helpful for predicting word volumes, while we assumed that topic proportions in a period of time are related to time-series numerical values of the different source. For corpus-level features, which are our viewpoints of external time series, there were several attempts (Bejan & Harabagiu, 2008; Chen, Li, Xu, Yang, & Kitsuregawa, 2012; Kim et al., 2013) to analyze relationships between features in a corpus at time t and topic proportions of the corpus. Unlike the works for document-level and word-level features, they proposed no fully generative models, and therefore, these feature values cannot be easily inferred.

While there is no unified model of corpus-level numerical values and texts over time, there have been efforts to estimate topics related to time series variables by iteratively utilizing multiple statistical models. Iterative Topic Modeling Framework with Time Series Feedback (ITMTF) (Kim et al., 2013) creates a feedback loop between a topic model and a correlation model by utilizing the prior distributions of the topic model as bridging variables. However, the batch style of applying multiple models may have two shortcomings. First, the topic model and the correlation model have two different joint probabilities that are not shared in their inference processes, so the inference to increase one joint probability might not be the right direction to increase the other joint probability. Second, the underlying assumptions might conflict. Each statistical model has underlying assumptions of probability distributions, and the statistical models set up the inference process based upon the assumptions. When chaining these models, the two assumptions regarding the shared variable can be different.

Because of these potential shortcomings, we created a unified model of numerical values and texts as a single probabilistic graphical model instead of chaining two different statistical models. Some previous studies illustrate a prediction of a numerical time-series data with text topics. For example, some researches (Chen et al., 2012; Mahajan, Dey, & Haque, 2008; Si et al., 2013) used a topic model to analyze themes in corpus, and then they inferred a prediction model, i.e., a linear regression, by applying the identified topics as observed variables. These methods held similar shortcomings to those we described above.

This section provides the description of our proposed model, ATM, used to infer the associative topics jointly influenced by the texts and the numeric values. Fundamentally, ATM is a model of Bayesian network, so the first subsection provides its probabilistic graphical model and its independence/causality structure between modeled variables. The first subsection compares and contrasts ATM to its predecessor model, DTM; and the subsection provides a description on the generative process of texts and numeric values from the topic proportion, which is a standard model description in the generative modeling community. The second subsection explains the inference of modeled latent variables with the observed data by following the structure of ATM. We used the variational inference to optimize the parameters of the latent random variables. The third subsection shows the formula to calculate the parameters which were not inferred in the variational inference process. The fourth subsection shows how to turn ATM, which is intrinsically a soft cluster model, into a model predicting the numerical value of the next time.

Here, we describe an ATM that learns associative topics from time-series text data regarding time-series numerical values. Our model captures the trajectory of topic proportions over time, and topics in the trajectory are correlated with a numerical variable over time. The model can be considered a combination of a Kalman filter and LDA. A similar model, which motivated ATM, is the dynamic topic model (DTM) (Blei & Lafferty, 2006), which explores the dynamics of topics, 
                           
                              
                                 
                                    β
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        , and topic appearances over time, 
                           
                              
                                 
                                    α
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        . Fig. 3
                         presents DTM and ATM in graphical representations. The difference between DTM and ATM lies in: (1) adding the numerical time-series variable, 
                           
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        , and (2) simplifying the word distribution by topics, β.

The first difference is the existence of numerical time-series values influenced by the latent variables of the corpus. The objective of the proposed model requires the inclusion of the numerical time-series variables, so we made a causal link from the topic proportions, 
                           
                              
                                 
                                    α
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        , to the numerical variables, 
                           
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        , by assuming that the latent topic from the corpus would generate the numerical values as well as the words in the corpus.

The second difference is the simplified word distributions of topics, β, compared to DTM because we wanted to see a single set of topic words over the period for a simplified insight. If we utilize ATM in the practical field, i.e., stock analyses, the presentation of the dynamic changes in the topic words might not be intuitive to non-experts. If we support the dynamic changes of topic words, it might increase the accuracy on the prediction result of the numerical values, but this would decrease the clarity of the topic interpretation representing the overall period. Additionally, there is a potential risk of overfitting topics to the numeric values.

From now, we describe the details of the assumptions of ATM in Fig. 3. ATM has additional y variables from DTM. In DTM and ATM, α is modeled by the Gaussian distribution to express the dynamics of topic appearances over time. Then, α is linked to the topic proportions of documents, θ, that have the same distribution type:
                           
                              (1)
                              
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 ∼
                                 N
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       I
                                    
                                    
                                       K
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (2)
                              
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 ∼
                                 N
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       a
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       I
                                    
                                    
                                       K
                                    
                                 
                                 )
                              
                           
                        where 
                           
                              
                                 
                                    I
                                 
                                 
                                    K
                                 
                              
                           
                         is K-dimensional identity matrix. In the above, each co-variance matrix is modeled as a scalar matrix to reduce the computational cost. A topic of each word, z, in a document is assigned in accordance with the topic proportion of the document:
                           
                              (3)
                              
                                 
                                    
                                       z
                                    
                                    
                                       t
                                       ,
                                       d
                                       ,
                                       n
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 ∼
                                 Multi
                                 (
                                 π
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 )
                                 )
                              
                           
                        In Formula (3), n is the number of words in the d document at time t. To turn the Gaussian distribution into a prior of multinomial distribution, we used a softmax function, π(θ), as defined below.
                           
                              (4)
                              
                                 
                                    
                                       π
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 θ
                                 )
                                 =
                                 
                                    
                                       exp
                                       (
                                       
                                          
                                             θ
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             K
                                          
                                       
                                       exp
                                       (
                                       
                                          
                                             θ
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        
                     

Another interpretation of using the softmax function is that the scale of θ is ignored and relative differences within θ are used to decide a topic for a word. Finally, each word is generated from topic distributions, 
                           
                              
                                 
                                    β
                                 
                                 
                                    1
                                    :
                                    K
                                 
                              
                           
                        , over words from a vocabulary of size V. Up to this point, the modeling approach of ATM is very similar to that of DTM.

The main idea of ATM is on generating the numerical time-series variables, y, from the prior information of α. In order to use the same information of the topic assignments on words for predicting y, the numerical time-series variables are generated from α through the same softmax function in Formula (4). The equation below specifies the modeled causality between y and α.
                           
                              (5)
                              
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 ∼
                                 N
                                 (
                                 
                                    
                                       b
                                    
                                    
                                       T
                                    
                                 
                                 π
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       δ
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                           
                        where b is a vector of K-dimensional linear coefficient parameters.

Formula (5) is the key mechanism that propagates the influence from the topic proportion, 
                           
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                           
                        , to the numeric values, 
                           
                              
                                 
                                    y
                                 
                                 
                                    t
                                 
                              
                           
                        . We model the relation between the topic proportion and the numeric values as a linear combination, fundamentally. However, our model is different from a typical Gaussian distribution with conditional information, i.e. 
                           
                              N
                              (
                              
                                 
                                    b
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                              )
                           
                        , because we apply a softmax function, 
                           
                              π
                              (
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                              )
                           
                        , to the random variable of the topic proportion, 
                           
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                           
                        . Therefore, this paragraph clarifies the application of the softmax function in the generation process of numeric values. The topic proportion, 
                           
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                           
                        , itself is modeled as a multivariate Gaussian distribution as Formula (1). This suggests that the value has an infinitely long tail in a direction of the modeled dimension. Hence, there is an overfitting risk to infer a value, or an element of 
                           
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                           
                        , from such long tail while learning the parameters from the text side. Then, this overfitted part of, 
                           
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                           
                        , will distort the inference of 
                           
                              b
                           
                        , because both will be combined as a linearly weighted sum if there is no other precaution made. To limit such extreme influence from the text to the numeric values, we use a soft-maxed topic proportion, which is 
                           
                              π
                              (
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                              )
                           
                        , instead of the simple linear combination. The soft-max function has a finite range with continuous activation functionality. Thus, the topic proportion will activate the influence to the numeric value, but the influence will be limited, or squashed in a casual statistics term, to the level of the activation.

Additionally, Formula (5) has an interesting variable to control, 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                        , in its variance term. The variance of 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                         affects the equation as a strength factor for fitting the numerical values to the topic proportions, 
                           
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                           
                        . Learning 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                         means that ATM will appreciate and admit such amount of variance in 
                           
                              
                                 
                                    y
                                 
                                 
                                    t
                                 
                              
                           
                         from the expectation of 
                           
                              
                                 
                                    y
                                 
                                 
                                    t
                                 
                              
                           
                         determined by the linear combination of 
                           
                              b
                           
                         and 
                           
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                           
                        . If we limit the variance level, 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                         to the small amount, the inferred coefficients corresponding to each associative topic will be forced to over-fit the numeric value movement, and this will eventually provide too strong bias in extracting the parameters in the topic extraction of the text modeling part. On the other hand, the high variance of 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                         will provide no guidance to the extracted topics, so this will turn the resulted topics to the ordinary topics without the guidance from the numeric values. Therefore, we experiment two versions of ATM. The first version is fixed-ATM which fixes the variance 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                         as a very small value to maximize the fitness to the numeric values by accepting the possibility of over-fitted associative topics. The second version is an ordinary ATM which infers the variance 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                         without any fixed point, so the extracted topics could be more meaningful by avoiding the over-fitness to the numeric values (see Formula (23)). Such adjustment of the influence strength from the topic proportion to the numeric value is experimented by comparing the result of fixed-ATM and ATM in the result section.


                        Fig. 4
                         is the generative process summarizing the assumptions of ATM. As we mentioned, the differences from DTM are (1) the generative process on numerical time-series value, 
                           
                              
                                 
                                    y
                                 
                                 
                                    t
                                 
                              
                           
                        , and (2) the unified topics, β ignoring dynamic changes by time.

Due to the non-conjugacy between distributions in ATM, the posterior inference becomes intractable. We employed the variational method (Jaakkola, 2001; Jordan, Ghahramani, Jaakkola, & Saul, 1998) to approximate the posterior in the ATM. The idea behind the variational method is to optimize the free parameters of a distribution over the latent variables by minimizing the Kullback–Leibler (KL) divergence.

In ATM, the latent variables are: (1) corpus-level latent states of topic proportions, 
                           
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                           
                        , (2) document-level latent states of topic proportions 
                           
                              
                                 
                                    θ
                                 
                                 
                                    t
                                    ,
                                    d
                                 
                              
                           
                        , and (3) topic indicators 
                           
                              
                                 
                                    z
                                 
                                 
                                    t
                                    ,
                                    d
                                    ,
                                    n
                                 
                              
                           
                        . Below are our factorized assumptions of the variational posterior, 
                           
                              q
                              (
                              α
                              ,
                              θ
                              ,
                              z
                              )
                           
                        . 
                           
                              (6)
                              
                                 q
                                 (
                                 α
                                 ,
                                 θ
                                 ,
                                 z
                                 )
                                 =
                                 q
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 |
                                 
                                    
                                       
                                          
                                             α
                                          
                                          
                                             ̂
                                          
                                       
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 )
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          t
                                          =
                                          1
                                       
                                       
                                          T
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∏
                                                
                                                
                                                   d
                                                   =
                                                   1
                                                
                                                
                                                   
                                                      
                                                         D
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                
                                             
                                          
                                          q
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                td
                                             
                                          
                                          |
                                          
                                             
                                                γ
                                             
                                             
                                                td
                                             
                                          
                                          ,
                                          
                                             
                                                Λ
                                             
                                             
                                                td
                                             
                                          
                                          )
                                          
                                             
                                                
                                                   ∏
                                                
                                                
                                                   n
                                                   =
                                                   1
                                                
                                                
                                                   
                                                      
                                                         N
                                                      
                                                      
                                                         td
                                                      
                                                   
                                                
                                             
                                          
                                          q
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                tdn
                                             
                                          
                                          |
                                          
                                             
                                                ϕ
                                             
                                             
                                                tdn
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                              ,
                              
                                 
                                    γ
                                 
                                 
                                    td
                                 
                              
                              ,
                              
                                 
                                    Λ
                                 
                                 
                                    td
                                 
                              
                           
                         and 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    tdn
                                 
                              
                           
                         are variational parameters of the variational posterior over latent variables. Factorized variational distributions of 
                           
                              
                                 
                                    θ
                                 
                                 
                                    td
                                 
                              
                           
                         and 
                           
                              
                                 
                                    z
                                 
                                 
                                    tdn
                                 
                              
                           
                         are simply modeled, 
                           
                              
                                 
                                    θ
                                 
                                 
                                    td
                                 
                              
                              |
                              
                                 
                                    γ
                                 
                                 
                                    td
                                 
                              
                              ,
                              
                                 
                                    Λ
                                 
                                 
                                    td
                                 
                              
                              ∼
                              N
                              (
                              
                                 
                                    θ
                                 
                                 
                                    td
                                 
                              
                              ;
                              
                                 
                                    γ
                                 
                                 
                                    td
                                 
                              
                              ,
                              
                                 
                                    Λ
                                 
                                 
                                    td
                                 
                              
                              )
                           
                         and 
                           
                              
                                 
                                    z
                                 
                                 
                                    tdn
                                 
                              
                              |
                              
                                 
                                    ϕ
                                 
                                 
                                    tdn
                                 
                              
                              ∼
                              Multi
                              (
                              
                                 
                                    ϕ
                                 
                                 
                                    tdn
                                 
                              
                              )
                           
                        . However, in the variational distribution of 
                           
                              
                                 
                                    α
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        , we retained the sequential structure of the corpus topic appearance by positing a dynamic model with Gaussian variational observations, 
                           
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        . In DTM, the variational Kalman filter model (Blei & Lafferty, 2006) was used to express the topic dynamics, and we adopted the model for estimating the dynamics of the topic proportions in the corpus over time. The key idea of the variational Kalman filter is that observations in the standard Kalman filter model are regarded as the variational parameters 
                           
                              
                                 
                                    α
                                 
                                 
                                    ̂
                                 
                              
                           
                         and the posterior distribution of the latent state in the standard Kalman filter as the variational distribution 
                           
                              q
                              (
                              α
                              |
                              
                                 
                                    α
                                 
                                 
                                    ̂
                                 
                              
                              )
                           
                        . Our variational Kalman filter is as follows:
                           
                              (7)
                              
                                 
                                    
                                       
                                          
                                             α
                                          
                                          
                                             ̂
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 ∼
                                 N
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       ̂
                                    
                                 
                                 
                                    
                                       I
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (8)
                              
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 ∼
                                 N
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       I
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                           
                        
                     

Using the standard Kalman filter calculation, the forward mean and variance are given by
                           
                              (9)
                              
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       
                                          
                                             α
                                          
                                          
                                             ̂
                                          
                                       
                                    
                                    
                                       1
                                       :
                                       t
                                    
                                 
                                 ∼
                                 N
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 ;
                                 
                                    
                                       μ
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       V
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       μ
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      t
                                                      -
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       μ
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       
                                          1
                                          -
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      t
                                                      -
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             α
                                          
                                          
                                             ̂
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       V
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      t
                                                      -
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       V
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       σ
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                           
                        with an initial condition of fixed 
                           
                              
                                 
                                    μ
                                 
                                 
                                    0
                                 
                              
                           
                         and fixed 
                           
                              
                                 
                                    V
                                 
                                 
                                    0
                                 
                              
                           
                        . The backward mean and variance are given by
                           
                              (10)
                              
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       
                                          
                                             α
                                          
                                          
                                             ̂
                                          
                                       
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 ∼
                                 N
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 ;
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      t
                                                   
                                                
                                                +
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       μ
                                    
                                    
                                       t
                                    
                                 
                                 +
                                 
                                    
                                       
                                          1
                                          -
                                          
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      t
                                                   
                                                
                                                +
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                       +
                                       1
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       V
                                    
                                    
                                       t
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             1
                                             -
                                             
                                                
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         V
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      ̃
                                                   
                                                
                                             
                                             
                                                t
                                                +
                                                1
                                             
                                          
                                          -
                                          (
                                          
                                             
                                                V
                                             
                                             
                                                t
                                             
                                          
                                          +
                                          
                                             
                                                σ
                                             
                                             
                                                2
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        In Formula (10), 
                           
                              
                                 
                                    
                                       
                                          μ
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                           
                         are drawn from variational Kalman filter calculations. We approximate the posterior 
                           
                              p
                              (
                              
                                 
                                    α
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                              |
                              
                                 
                                    w
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                              )
                           
                         using the state space posterior 
                           
                              q
                              (
                              
                                 
                                    α
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                              |
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                              )
                           
                        .

Using these variational posteriors and Jensen’s inequality, we can find the lower bound of the log likelihood as follows:
                           
                              (11)
                              
                                 log
                                 p
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 )
                                 ⩾
                                 ∬
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          z
                                       
                                    
                                 
                                 q
                                 (
                                 α
                                 ,
                                 θ
                                 ,
                                 z
                                 )
                                 log
                                 
                                    
                                       p
                                       (
                                       w
                                       ,
                                       y
                                       ,
                                       α
                                       ,
                                       θ
                                       ,
                                       z
                                       )
                                    
                                    
                                       q
                                       (
                                       α
                                       ,
                                       θ
                                       ,
                                       z
                                       )
                                    
                                 
                                 d
                                 θ
                                 d
                                 α
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 log
                                 p
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 )
                                 ]
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          =
                                          1
                                       
                                       
                                          T
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          d
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                D
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 log
                                 p
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       td
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          =
                                          1
                                       
                                       
                                          T
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          d
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                D
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                N
                                             
                                             
                                                td
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 log
                                 p
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       tdn
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       td
                                    
                                 
                                 )
                                 p
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       tdn
                                    
                                 
                                 |
                                 
                                    
                                       z
                                    
                                    
                                       tdn
                                    
                                 
                                 )
                                 ]
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          =
                                          1
                                       
                                       
                                          T
                                       
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 log
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 +
                                 H
                                 (
                                 q
                                 (
                                 α
                                 ,
                                 θ
                                 ,
                                 z
                                 )
                                 )
                              
                           
                        
                     

This bound contains four expectation terms related to the in-hand data. The first term is related to the latent states from both sources of data. The second and third expectation terms are related to the text data and easily found by the same expectation terms in DTM. The fourth term, 
                           
                              
                                 
                                    E
                                 
                                 
                                    q
                                 
                              
                              [
                              log
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                              )
                              ]
                           
                        , is related to the continuous time-series data that we introduce. The first term on the right-hand side of Formula (11) is:
                           
                              (12)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 log
                                 p
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 )
                                 ]
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 log
                                 p
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 )
                                 ]
                                 ∝
                                 -
                                 
                                    
                                       TK
                                    
                                    
                                       2
                                    
                                 
                                 log
                                 
                                    
                                       σ
                                    
                                    
                                       2
                                    
                                 
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             σ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      ̃
                                                   
                                                
                                             
                                             
                                                t
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      ̃
                                                   
                                                
                                             
                                             
                                                t
                                                -
                                                1
                                             
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 Tr
                                 (
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             σ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 (
                                 Tr
                                 (
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 -
                                 Tr
                                 (
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       T
                                    
                                 
                                 )
                                 )
                              
                           
                        using the Gaussian quadratic form identity
                           
                              (13)
                              
                                 
                                    
                                       E
                                    
                                    
                                       m
                                       ,
                                       V
                                    
                                 
                                 [
                                 
                                    
                                       (
                                       x
                                       -
                                       μ
                                       )
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       Σ
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 (
                                 x
                                 -
                                 μ
                                 )
                                 ]
                                 =
                                 
                                    
                                       (
                                       m
                                       -
                                       μ
                                       )
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       Σ
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 (
                                 m
                                 -
                                 μ
                                 )
                                 +
                                 Tr
                                 (
                                 
                                    
                                       Σ
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 V
                                 )
                              
                           
                        The second term of the right-hand side of Formula (11) is:
                           
                              (14)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 log
                                 p
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       td
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 ∝
                                 -
                                 
                                    
                                       K
                                    
                                    
                                       2
                                    
                                 
                                 log
                                 
                                    
                                       a
                                    
                                    
                                       2
                                    
                                 
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             a
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                γ
                                             
                                             
                                                td
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      ̃
                                                   
                                                
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             a
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 (
                                 Tr
                                 (
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 Tr
                                 (
                                 
                                    
                                       Λ
                                    
                                    
                                       td
                                    
                                 
                                 )
                                 )
                              
                           
                        The third term is:
                           
                              (15)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 log
                                 p
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       tdn
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       td
                                    
                                 
                                 )
                                 p
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       tdn
                                    
                                 
                                 |
                                 
                                    
                                       z
                                    
                                    
                                       tdn
                                    
                                 
                                 )
                                 ]
                                 ⩾
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       tdnk
                                    
                                 
                                 
                                    
                                       γ
                                    
                                    
                                       tdk
                                    
                                 
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       tdnk
                                    
                                 
                                 
                                    
                                       
                                          log
                                          
                                             
                                                
                                                   
                                                      ζ
                                                   
                                                   
                                                      ̂
                                                   
                                                
                                             
                                             
                                                td
                                             
                                          
                                          +
                                          
                                             
                                                1
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            ζ
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      td
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                e
                                             
                                             
                                                
                                                   
                                                      γ
                                                   
                                                   
                                                      tdk
                                                   
                                                
                                                +
                                                
                                                   
                                                      Λ
                                                   
                                                   
                                                      tdk
                                                   
                                                
                                                /
                                                2
                                             
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       tdnk
                                    
                                 
                                 log
                                 
                                    
                                       β
                                    
                                    
                                       k
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             tdn
                                          
                                       
                                    
                                 
                              
                           
                        introducing additional variational parameters 
                           
                              
                                 
                                    ζ
                                 
                                 
                                    1
                                    :
                                    T
                                    ,
                                    1
                                    :
                                    D
                                 
                              
                           
                         due to the softmax function whose input variables are drawn from the Gaussian distribution. The closed form of expectation cannot be calculated, but the lower bound of the expectation can be found. This treatment of the lower bound of the expectation keeps the lower bound of log likelihood. The fourth term is:
                           
                              (16)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          =
                                          1
                                       
                                       
                                          T
                                       
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 log
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 ∝
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             δ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       b
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             δ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       b
                                    
                                    
                                       j
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 
                                    
                                       π
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                              
                           
                        
                     

It should be noted that the we applied the softmax function π to α because we modeled the regression from the discretized topic proportions to the numerical variables. The rationale behind the discretization is that what we see as topics from text should influence the regression, so we applied the same softmax treatment to θ and α. While such discretization for topic extraction occurred in DTM to join the multinomial and the Gaussian distributions, this treatment is joining two Gaussian distributions, which is a difference between ATM and DTM. While this difference might seem trivial, this linkage of two Gaussian distributions with the softmax function invokes a non-trivial calculation of the expectation. In Formula (16), finding the lower bound with the variational parameters of the expectation terms is intractable due to non-concavity caused by opposite signs of the expectations (Bouchard, 2007). Additionally, the closed form of the expectation terms cannot be calculated exactly because of the difficulties in log-normality and the rate of two random variables. Hence, we used an approximation approach to calculate the local expectations using the Taylor expansions for rate expectation (Kendall, Stuart, & Ord, 2010; Rice & Papadopoulos, 2009). To the best of our knowledge, this is the first case of inferencing a probabilistic graphical model with approximate expectations of the softmax function with a Gaussian prior. The expectation of the simple softmax function is shown below.
                           
                              (17)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                exp
                                                (
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      ti
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                   
                                                
                                                exp
                                                (
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      tk
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 ≈
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tk
                                             
                                             
                                                2
                                             
                                          
                                          -
                                          
                                             
                                                m
                                             
                                             
                                                ti
                                             
                                          
                                       
                                    
                                 
                              
                           
                        In Formula (17), a new notation, 
                           
                              
                                 
                                    m
                                 
                                 
                                    ti
                                 
                              
                              =
                              
                                 
                                    π
                                 
                                 
                                    i
                                 
                              
                              (
                              
                                 
                                    
                                       
                                          μ
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                              )
                           
                        , is introduced. The joint expectations of the two softmax functions are finally approximated as follows:
                           
                              (18)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 ]
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            exp
                                                            (
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  ti
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            exp
                                                            (
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  tk
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 ≈
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 
                                    
                                       
                                          3
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tk
                                             
                                             
                                                2
                                             
                                          
                                          -
                                          4
                                          
                                             
                                                m
                                             
                                             
                                                ti
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (19)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 
                                    
                                       π
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                exp
                                                (
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      ti
                                                   
                                                
                                                +
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      tj
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      exp
                                                      (
                                                      
                                                         
                                                            α
                                                         
                                                         
                                                            tk
                                                         
                                                      
                                                      )
                                                      )
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ≈
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       tj
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       tj
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 
                                    
                                       
                                          3
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tk
                                             
                                             
                                                2
                                             
                                          
                                          -
                                          2
                                          
                                             
                                                m
                                             
                                             
                                                ti
                                             
                                          
                                          -
                                          2
                                          
                                             
                                                m
                                             
                                             
                                                tj
                                             
                                          
                                       
                                    
                                 
                              
                           
                        In Appendix A, we described the approximate method for finding the expectations of softmax functions. The last term of Formula (11) is the entropy term:
                           
                              (20)
                              
                                 H
                                 (
                                 q
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 log
                                 |
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ,
                                          d
                                       
                                    
                                 
                                 log
                                 
                                    
                                       
                                          
                                             
                                                Λ
                                             
                                             
                                                td
                                             
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ,
                                          d
                                          ,
                                          n
                                          ,
                                          k
                                       
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       tdnk
                                    
                                 
                                 log
                                 
                                    
                                       ϕ
                                    
                                    
                                       tdnk
                                    
                                 
                              
                           
                        With the above expectations terms, we can find an approximated lower bound of the log likelihood. The learning equations for variational parameters are described in Appendix B.

Using variational distributions that are approximate posterior distributions over latent variables, we can find update equations for model parameters. When it comes to topic representations, β can be updated as follows:
                           
                              (21)
                              
                                 
                                    
                                       β
                                    
                                    
                                       kv
                                    
                                 
                                 ∝
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ,
                                          d
                                          ,
                                          n
                                       
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       tdnk
                                    
                                 
                                 I
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       tdn
                                    
                                 
                                 =
                                 v
                                 )
                              
                           
                        where 
                           
                              I
                              (
                              
                                 
                                    w
                                 
                                 
                                    tdn
                                 
                              
                              =
                              v
                              )
                           
                         is a binary function that is equal to 1 when 
                           
                              
                                 
                                    w
                                 
                                 
                                    tdn
                                 
                              
                              =
                              v
                           
                         or 0 otherwise. Variances of Gaussian noises to text data (
                           
                              
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                           
                        ) and numerical time-series data (
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                        ) can be updated as follows:
                           
                              (22)
                              
                                 
                                    
                                       a
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       DK
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   t
                                                   ,
                                                   d
                                                
                                             
                                          
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            γ
                                                         
                                                         
                                                            td
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            
                                                               
                                                                  μ
                                                               
                                                               
                                                                  ̃
                                                               
                                                            
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          Tr
                                          (
                                          
                                             
                                                Λ
                                             
                                             
                                                td
                                             
                                          
                                          )
                                          +
                                          Tr
                                          (
                                          
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      ̃
                                                   
                                                
                                             
                                             
                                                t
                                             
                                          
                                          )
                                          )
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (23)
                              
                                 
                                    
                                       δ
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                t
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      ̃
                                                   
                                                
                                             
                                             
                                                t
                                             
                                             
                                                T
                                             
                                          
                                          b
                                          )
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                b
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      ̃
                                                   
                                                
                                             
                                             
                                                t
                                             
                                          
                                          b
                                       
                                    
                                 
                              
                           
                        
                     

We assumed that each document-level latent state of topic proportion θ are drawn from the time-series latent state of topic proportions, α, with the scalar variance, 
                           
                              
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                           
                        , while the numerical time-series variables are drawn from a linear combination of α with a variance, 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                        . By learning these variations, we can find the degree of correlation between text data and numerical time-series data. A low value of 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                         means two sources of data are strongly correlated and text data can be helpful to predict time-series variables. Conversely, a high value of 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                         means two sources of data are not closely related to each other. If we set fixed variances at a low value, ATM tends to learn topics that have a high explanatory power about the trajectory of numerical time series in the training set.

As noted before, the linear combination of rescaled α and b becomes the estimation of y. To infer b, we maximize the lower bound of its log-likelihood. The function below is the softmax function to infer the coefficient vector.
                           
                              (24)
                              
                                 b
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                             
                                                
                                                   E
                                                
                                                
                                                   q
                                                
                                             
                                             [
                                             π
                                             
                                                
                                                   (
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                
                                                   T
                                                
                                             
                                             π
                                             (
                                             
                                                
                                                   α
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                             ]
                                          
                                       
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       [
                                       π
                                       (
                                       α
                                       )
                                       ]
                                    
                                    
                                       T
                                    
                                 
                                 Y
                              
                           
                        In Formula (24), 
                           
                              
                                 
                                    E
                                 
                                 
                                    q
                                 
                              
                              [
                              π
                              
                                 
                                    (
                                    
                                       
                                          α
                                       
                                       
                                          t
                                       
                                    
                                    )
                                 
                                 
                                    T
                                 
                              
                              π
                              (
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                              )
                              ]
                           
                         is a 
                           
                              K
                              ×
                              K
                           
                         matrix whose elements are 
                           
                              
                                 
                                    E
                                 
                                 
                                    q
                                 
                              
                              [
                              
                                 
                                    π
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    (
                                    
                                       
                                          α
                                       
                                       
                                          t
                                       
                                    
                                    )
                                 
                                 
                                    T
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    π
                                 
                                 
                                    j
                                 
                              
                              (
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                              )
                              ]
                           
                         
                        
                           
                              ∀
                              i
                              ,
                              j
                              ,
                              
                                 
                                    E
                                 
                                 
                                    q
                                 
                              
                              [
                              π
                              (
                              α
                              )
                              ]
                           
                         is a T
                        ×
                        K matrix whose elements are 
                           
                              
                                 
                                    E
                                 
                                 
                                    q
                                 
                              
                              [
                              
                                 
                                    π
                                 
                                 
                                    k
                                 
                              
                              (
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                              )
                              ]
                           
                        , and Y is a numerical value vector over the period T. This update equation is similar to the Gaussian response of Supervised LDA (Blei & McAuliffe, 2007).

After all of the parameters are learned, ATM can be used as a prediction model of a future time-series variable (
                           
                              
                                 
                                    y
                                 
                                 
                                    T
                                    +
                                    1
                                 
                              
                           
                        ) by observing new text data (
                           
                              
                                 
                                    w
                                 
                                 
                                    T
                                    +
                                    1
                                 
                              
                           
                        ). The expectation of 
                           
                              
                                 
                                    y
                                 
                                 
                                    T
                                    +
                                    1
                                 
                              
                           
                         is formalized in the function below.
                           
                              (25)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       y
                                    
                                    
                                       T
                                       +
                                       1
                                    
                                 
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       1
                                       :
                                       T
                                       +
                                       1
                                    
                                 
                                 ]
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       b
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       T
                                       +
                                       1
                                    
                                 
                                 )
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       1
                                       :
                                       T
                                       +
                                       1
                                    
                                 
                                 ]
                              
                           
                        In order to calculate the expectations of the softmax function for the new time-step, we infer the posterior distribution of 
                           
                              
                                 
                                    α
                                 
                                 
                                    T
                                    +
                                    1
                                 
                              
                           
                         utilizing the posterior distribution of 
                           
                              
                                 
                                    α
                                 
                                 
                                    T
                                 
                              
                           
                        , documents 
                           
                              
                                 
                                    D
                                 
                                 
                                    t
                                    +
                                    1
                                 
                              
                           
                        , and learned model parameters. This particular inference is based upon Formula (11) except for the fourth expectation terms. After enough iterations of variational inferences, the posterior distribution of (
                           
                              
                                 
                                    α
                                 
                                 
                                    T
                                    +
                                    1
                                 
                              
                           
                        ) can be used to predict the numerical value of the next time step.

This section demonstrates the utility of the ATM in both explaining and predicting the time-series values. We applied ATM to a financial news corpus and stock indexes as well as to a news corpus related with the president and president approval index. Section 4.1 shows the detailed description of the datasets. Sections 4.2 and 4.3 describe the overview of our experiments and the baseline models, such as autoregressive models (AR), LDA, DTM, ITMTF. Through Sections 4.3, 4.4, 4.5 and 4.6, we discuss the results of the experiments.

We applied ATM in two domains, finance and presidential popularity. For the financial datasets, we used financial news articles from the Bloomberg and the stock indexes of the DJIA from January 2011 to April 2013 (121weeks). Due to the different roles of the indexes, we chose the return, which indicates a profit on an investment, and the volatility, which is a measure for variation of price of a financial instrument. The 60,500 news articles were selected randomly; 500 articles were selected for each week. That is, we used two coupled datasets in the finance domain; one includes Bloomberg articles and the DJIA stock return, and the other includes the same Bloomberg articles and the DJIA stock volatility. For the presidential datasets, we used news articles searched with the name of the president, ‘Obama’ from The Washington Post and the weekly president approval index from January 2009 to June 2014 (284weeks). The 27,582 news articles were selected randomly; fewer than 100 articles were selected for each week. We pruned vocabularies by removing stop-words and terms, which occurred in less than 2% of the documents. We set a time step in the experiment as a week. Table 1
                         describes the summarized information of the datasets.

Our experiments are categorized into qualitative and quantitative analysis from a large perspective, see Fig. 5
                        . The qualitative analysis examines the outputs of ATM and fixed-ATM from three datasets with texts and numeric values over-time.

Section 4.4 enumerates the associative topics extracted by ATM for a qualitative analysis, and the section contrasts the associative topics to the topics without any such guidance, i.e. the topics from LDA and DTM. Section 4.5 shows the results of the fixed-ATM, and the section shows the associative topics which are biased to overfit the numeric values. Since the extracted topics of fixed-ATM are meant to be only dependent variables for the numeric value prediction, we omit the further analysis on the quality of the fixed-ATM topics. If users values the interpretation of extracted associative topics guided by the numeric values, they are recommended to use ATM instead of fixed-ATM. Section 4.6 provides the quantitative evaluations on the numeric value prediction by measuring the mean squared error and the mean absolute error, and the section includes both models for texts and numeric values as well as models for numeric values only, i.e. AR. Section 4.7 investigated the predictive log-likelihoods that is a quantitative measure in explaining unseen data with a model and a historic dataset.

To compare performances of the proposed models, we applied four baseline models. The autoregressive model (AR) is only for analyzing numerical time series, so we compared its numerical value prediction performance with ours. Since other topic models are only for analyzing text data, we applied linear regression models to joint numerical time-series values. The short descriptions of baselines are below.

We could analyze continuous time-series values with the AR, which is a traditional time-series analysis tool. In a univariate autoregressive model AR(p), the variable 
                              
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                              
                            depends on its previous values from 
                              
                                 
                                    
                                       y
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                              
                            to 
                              
                                 
                                    
                                       y
                                    
                                    
                                       t
                                       -
                                       p
                                    
                                 
                              
                           . In this model, selecting lag values, p, is important regarding causalities with past information, and we optimized p empirically.

The basic topic model, LDA, was applied. We firstly analyzed topics in the total corpus regardless of time steps, then extracted a topic in each document, 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       k
                                    
                                    
                                       (
                                       d
                                       )
                                    
                                 
                              
                           . We could compute time-level topic proportions, 
                              
                                 
                                    
                                       tc
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                              
                           , from them as normalizing document topic proportions over time: 
                              
                                 
                                    
                                       tc
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       N
                                       (
                                       
                                          
                                             D
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       d
                                       ∈
                                       
                                          
                                             D
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 
                                    
                                       θ
                                    
                                    
                                       k
                                    
                                    
                                       (
                                       d
                                       )
                                    
                                 
                              
                           , where 
                              
                                 N
                                 (
                                 
                                    
                                       D
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                            is the number of documents at time t. Then, a simple linear regression was applied to evaluate topic association with numerical time-series values.

The time-series topic model, DTM, catches the dynamics of the latent state of topic proportions 
                              
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                              
                           . By utilizing DTM, we could extract the posterior mean of 
                              
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                              
                            dynamics, 
                              
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                              
                           . Considering the softmax treatment for topic assignments, we extracted topic proportions over time by simply applied the softmax function to 
                              
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                              
                           . After defining topic proportions, we utilized a simple linear regression.

Iterative Topic Modeling with Time Series Feedback (ITMTF) is a general text mining framework that combines probabilistic topic modeling with time-series causal analysis to uncover topics that are both coherent semantically and correlated with time-series data. ITMTF consists of the following iterative steps: (1) Find topics with topic modeling techniques, (2) identify causal topics using correlation tests, and (3) make prior topic distribution using topic-level and word-level causality analysis. In (2) and (3) processes, there should be a threshold of confidence. In this paper, we applied LDA(ITMTF-LDA) and DTM(ITMTF-DTM) as topic models and a linear regression as a causal analysis tool with a 70% confidence threshold.

ATM has two variations by the setting of δ. The first variation is learning δ just like the other parameters from the data. This is an ordinary version of ATM, and this model limits the fitting to the past numeric data by allowing the deviation modeled by the variance of δ. This model balances the influence of the numeric and the text data in the parameter inference process. We utilize this ordinary version of ATM in (1) Section 4.4 for qualitative topic evaluation, (2) Section 4.6 for numeric value prediction evaluation, and (3) Section 4.7 for quantitative topic evaluation.

The second variation, or fixed-ATM, is fixing δ as the small value, so the numeric fitting can be maximized, or overfitted from a certain perspective. This would not be a better way to predict the numeric time-series in the future, but this does maximize the influence from the numeric data to the text data in the topic extraction process. Therefore, the model would result in topics that are the best in describing the past numeric value movements, and Section 4.5 shows such retrospective analysis of texts influenced by the numeric values.

To investigate the influence of time-series for identifying associative topics, we applied ATM to the same Bloomberg articles over 121weeks as the text input with different time-series, the stock returns and the volatilities of DJIA. We initialized 
                           
                              
                                 
                                    β
                                 
                                 
                                    1
                                    :
                                    K
                                 
                              
                           
                         to randomly perturbed topics from uniform topics, 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                         to the sample variance of the time-series data, 
                           
                              
                                 
                                    σ
                                 
                                 
                                    2
                                 
                              
                           
                         to 0.1, 
                           
                              
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                           
                         to 0.1, and b to zero vector over the number of topics 10. The top and middle of Fig. 6
                         show the learning results with stock returns and volatilities. The results show that some associative topics from different time series are similar topics, e.g., European crisis, tax cuts, and economic reports, because of the property of the financial domain. However, some associative topics are different: Topics about energy and the economy of Asia are revealed from ATM with stock returns, and the topics about federal lows are revealed from ATM with stock volatilities. When we show two numerical time-series cases, the volatility is better predicted than the return is. This result is expected because of the efficient market hypothesis, which states the difficulty in predicting stock prices and returns (Poon & Granger, 2005). In the financial domain, the volatility often becomes the target of prediction with a general sentiment.

The numeric values over-time drive ATM to extract different topics per the types of the numeric values, i.e. return and volatility. Subsequently, the different topics induced the different dynamics of topic proportions though two dynamics were captured from the same text data. This result qualitatively demonstrates that ATM identifies different associative topics from different time-series values, although the text data and the initial settings are the same. To confirm this influence from the numeric values in extracting topics, we calculated the similarities between (1) topics without numeric information and temporal information (LDA), (2) topics without numeric information (DTM), (3) topics with over-time numeric values, volatilities (ATM(Volatilities)), and (4) topics with over-time numeric values, returns (ATM(Returns)).

Specifically, we investigated the cosine similarities of the topics from different topic extraction models utilizing different information. We examined ten topics from LDA and DTM with the same period text data to compare two sets of topics from ATM with two different numeric values. Fig. 7
                         shows the block diagrams of the results. The color strength of each block indicates the degree of the topic similarities (a black cell means that the two topics are same, and a white cell means that two are quite different). In the case of LDA and DTM, each topic from LDA has a strongly similar topic in DTM. This indicates that DTM extracts similar topics from LDA although DTM takes the time information of text data into account. On the contrary, in the cases of DTM and ATM with returns as well as DTM and ATM with volatilities, ATM was able to extract different topics by considering numerical time-series values, i.e. the topic 4, 7, and 10 from ATM(Return) are matched to none of the topics from DTM. Such difference were observed between the pair of DTM and ATM(Return); DTM and ATM(Volatilities); and ATM(Return) and ATM(Volatilities). This numeric value guided topic extraction is a major objective in developing ATM, and this correlation analysis demonstrates such capability of ATM.

In order to explore The Washington Post corpus and its themes associated with president approval indexes, we inferred the parameters of ATM with 284weeks of data. For learning ATM, we initialized parameters in the same way of the stock index case. ATM identifies two sets of associative topics corresponding to the president approval indexes. The bottom of Fig. 6 shows the results from ATM. The left side lists the estimated words with the top eight probabilities of ten topics and the associative factors that are standardized coefficients b. The results show that an associative topic about family life is positively related with the approval indexes. However, some associative topics are negatively related, e.g. Romney party, war, and policy. In addition, some topics are not highly related, e.g. education, tax, and agency. These results qualitatively demonstrate that ATM identifies plausible associative topics.

Our proposed topic model, ATM, shows how text data and numerical time-series data are related, and ATM identifies associative topics that have explanatory power regarding the relation between two different types of data from two different sources.

ATM can be used for retrospective analysis, not for prediction. In the modeling process of ATM, we integrated numerical time-series data and dynamic topic models. At modeling time-series, we assumed numerical hidden states influence generating time-series variables with Gaussian errors (
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                        ). If we set the error (
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                        ) as the small fixed number, such as 
                           
                              
                                 
                                    10
                                 
                                 
                                    -
                                    10
                                 
                              
                           
                        , then the ATM catches associative topics only explaining the exact trajectories of time-series in the training period. As we mentioned, we label ATM with this treatment as fixed-ATM.

To explore the results of fixed-ATM, we initialized 
                           
                              
                                 
                                    β
                                 
                                 
                                    1
                                    :
                                    K
                                 
                              
                           
                         to randomly perturbed topics from uniform topics, 
                           
                              
                                 
                                    σ
                                 
                                 
                                    2
                                 
                              
                           
                         to 0.1, 
                           
                              
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                           
                         to 0.1, and b to zero vector over the number of topics. We set the number of the topics as 10 for the return and approval index cases and 5 for the volatility case. The different number of topic setting is decided by empirical experiment; the proportions of some topics among 10 with fixed-ATM become close to 0.


                        Fig. 8
                         shows total results from fixed-ATM. When investigating dynamics of topic proportions, all dynamics are dramatically changed to contain errors of time-series. Especially, a few topics are highly correlated in the volatility case. This means most of text data are not effectively related with volatilities by ignoring the error of time-series. In figures of estimations, as we said, the fixed low value of 
                           
                              
                                 
                                    δ
                                 
                                 
                                    2
                                 
                              
                           
                         made the estimation exact in the training period. This treatment is very similar with ITMTF (Kim et al., 2013) because the trajectories of time-series influence directly topics ignoring errors in time-series. In order to analyze highly associative topics over the training periods, fixed-ATM can be useful. As can be seen, there are some different topic effects from ATM results. For example, in the return case, the last topic appears to have the most negative effects from a fixed-ATM, while it was affected in a small way by ATM. This is caused by including the errors of time-series themselves into topic proportions. These results may be used for a retrospective understanding.

To quantitatively evaluate the prediction performance of ATM, we considered the task of predicting the next time value by assuming the model was trained by prior data. We repeated this prediction from the 101th to 121th week (21 different period) for the stock indexes cases and from the 270th to 284th week (25 different period) for the approval index case, using the trained model with historically cumulated data. For instance, to predict y value at 270th week, the model was trained with 1–269th weeks data. The baseline models and ATM infer five topics, and the models had the same initial parameters and the same criteria to stop the approximations. For AR(p), we select p of the best performers on the test data. For ITMTF models, we iterated three times of prior feedback loops with a 70% confidence threshold. After the estimation, we measured the model performance of experimental models with mean squared errors (MSE), 
                           
                              
                                 
                                    1
                                 
                                 
                                    M
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    m
                                 
                              
                              
                                 
                                    (
                                    
                                       
                                          y
                                       
                                       
                                          m
                                       
                                    
                                    -
                                    
                                       
                                          
                                             
                                                y
                                             
                                             
                                                ̂
                                             
                                          
                                       
                                       
                                          m
                                       
                                    
                                    )
                                 
                                 
                                    2
                                 
                              
                           
                        , and mean absolute errors (MAE), 
                           
                              
                                 
                                    1
                                 
                                 
                                    M
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    m
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    m
                                 
                              
                              -
                              
                                 
                                    
                                       
                                          y
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    m
                                 
                              
                              |
                           
                         where M is the number of test points; 
                           
                              
                                 
                                    y
                                 
                                 
                                    m
                                 
                              
                           
                         is the true value of the prediction; and 
                           
                              
                                 
                                    
                                       
                                          y
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    m
                                 
                              
                           
                         is the predicted value. Although the same training data are not used for prediction, MSE and MAE can be used to evaluate the model quality.


                        Table 2
                         displays MSE and MAE from the baseline and the proposed models. The bold font indicates the best model generating both interpretation and prediction in other words, analyzing text and metrics simultaneously while the underlined font indicates the best performer including only numerical model, such as AR. When we focus only on the numerical value prediction, ATM is the best performance model in general. Exceptions are the MSE and the MAE of AR in the volatility prediction; and the MAE of AR in predicting the approval rate. This shows that simple regression model might beat sophisticated metric-text models, but given the result, ATM is the best solution that provides both prediction and interpretation. Additionally, some cases, i.e., predicting stock price, suggests that ATM would be better for the numerical value prediction. Other sophisticated methods, i.e., the generalized linear model, that can replace AR exist, but these models do not provide the interpretation of the context, either.

After measuring the accuracy of the numeric value predictions, we compare the quality of the extracted topics from the texts with the predictive log likelihoods (Blei & Lafferty, 2006; Chang, Gerrish, Wang, Boyd-graber, & Blei, 2009; Wallach, Murray, Salakhutdinov, & Mimno, 2009; Wang, Blei, & Heckerman, 2008). The predictive log-likelihood is frequently utilized and widely accepted in the topic modeling community, and this metric represents how clearly the extracted topics are able to explain the future document distribution from the topic perspective. Since this evaluation only handles the topic modeling, we excluded the evaluation on the numeric only model, i.e. AR.

The predictive log likelihoods in the topic models indicate the probabilities of generating unseen text data with past learned parameters. In the proposed models, the predictive likelihood for next-time text data, 
                           
                              
                                 
                                    w
                                 
                                 
                                    T
                                    +
                                    1
                                 
                              
                           
                        , is specified in the follow:
                           
                              (26)
                              
                                 p
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       T
                                       +
                                       1
                                    
                                 
                                 |
                                 
                                    
                                       w
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 )
                                 =
                                 ∬
                                 p
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       T
                                       +
                                       1
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       T
                                       +
                                       1
                                    
                                 
                                 )
                                 p
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       T
                                       +
                                       1
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       T
                                    
                                 
                                 )
                                 p
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       T
                                    
                                 
                                 |
                                 
                                    
                                       w
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 )
                                 d
                                 
                                    
                                       α
                                    
                                    
                                       T
                                       +
                                       1
                                    
                                 
                                 d
                                 
                                    
                                       α
                                    
                                    
                                       T
                                    
                                 
                              
                           
                        
                     

Due to the same reason of the intractability of the inference, we calculated the lower bound of the likelihood in the same way described in Formula (11). Because the baseline topic models, which are LDA, DTM, ITMTF-LDA, and ITMTF-DTM, are not unified probabilistic models containing numerical variable 
                           
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        , their predictive log-likelihoods do not contain the historical condition of numerical time series. The formula for the baseline topic models is described in the below:
                           
                              (27)
                              
                                 p
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       T
                                       +
                                       1
                                    
                                 
                                 |
                                 
                                    
                                       w
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 )
                                 =
                                 ∫
                                 p
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       T
                                       +
                                       1
                                    
                                 
                                 |
                                 
                                    
                                       Θ
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 )
                                 p
                                 (
                                 
                                    
                                       Θ
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 |
                                 
                                    
                                       w
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                                 )
                                 d
                                 
                                    
                                       Θ
                                    
                                    
                                       1
                                       :
                                       T
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    Θ
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                         indicates latent variables, which are included in the baseline topic models. Due to the intractabilities, the lower bounds of 
                           
                              p
                              (
                              
                                 
                                    w
                                 
                                 
                                    T
                                    +
                                    1
                                 
                              
                              |
                              
                                 
                                    w
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                              )
                           
                         are used. These lower bounds are not exactly comparable values because each probability is derived from different hyper-parameters as well as different condition, such as the existence of 
                           
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        . However, these comparisons are still be worth to measure model performances (Asuncion, Welling, Smyth, & Teh, 2009) due to the difficulty on calculating the exact likelihood.

The upper graphs in Fig. 9
                         display the log likelihoods on test datasets over time from the ATM and the baseline models. The dramatic differences over times are caused by the difference of the period. All models show similar performance from the predictive log likelihood aspect. This is encouraging for ATM because ATM has the similar likelihood performances in spite of the strong assumption that two different sources are generated from the same hidden states. In order to show details, the lower graphs in Fig. 9 show the log likelihood of the last period on the upper graphs in Fig. 9.

@&#CONCLUSION@&#

This paper proposes associative topic model, or ATM, to better capture the relationship between numerical data and text data over time. We tested the proposed model with financial indexes and presidential approval index. The pair of numeric and text data in the financial domain consists of the economic news articles; and the stock return as well as volatility. The pair in the politics domain consists of news articles on the president and the president approval index. Our experiments show meaningful performance gain in predicting the numeric data by utilizing the text data. Additionally, our topic finding capability, i.e. measured by the predictive likelihood, was minimally affected in spite of adding numerical modeling to the text model, which is adding bias that was not there before.

The generality of the model makes it useful in broad application domains that have fluctuating numerical data and text data. For instance, this model is highly applicable to product reviews and sales records over time, as well as political SNS messages, approval ratings, etc. To support the understanding of the model, we presented a variational inference procedure of the model to approximate the posterior.

@&#ACKNOWLEDGEMENTS@&#

This research was supported by Basic Science Research Program through the National Research Foundation of Korea (NRF) funded by the Ministry of Science, ICT & Future Planning (2012R1A1A1044575).

In the paper, we introduced the expectation of a softmax function whose input variables are drawn from Gaussian distribution. Since the covariance matrices of Gaussian distribution were modeled as diagonal matrices, the expectation became the proportion of log-normal distributions whose variables are independent. To find an approximate expectation of softmax function, we adapted the second-order Taylor extension.

We describe a theorem about log-normal distribution and Taylor expansion to find an approximation for the expectation of softmax function whose inputs are independently drawn from 
                           
                              
                                 
                                    α
                                 
                                 
                                    k
                                 
                              
                              ∼
                              N
                              (
                              
                                 
                                    
                                       
                                          μ
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                              )
                           
                         
                        
                           
                              ∀
                              k
                           
                        . We regard 
                           
                              
                                 
                                    X
                                 
                                 
                                    k
                                 
                              
                              =
                              exp
                              (
                              
                                 
                                    α
                                 
                                 
                                    k
                                 
                              
                              )
                           
                         as a log-normal distribution and 
                           
                              Y
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                 
                              
                              
                                 
                                    X
                                 
                                 
                                    k
                                 
                              
                           
                         as a random variable where Y has support 
                           
                              (
                              0
                              ,
                              ∞
                              )
                           
                        . Then, the expectation of the softmax function becomes the expectation of the ratio between two correlated random variables:
                           
                              (A.1)
                              
                                 E
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 α
                                 )
                                 ]
                                 =
                                 E
                                 
                                    
                                       
                                          
                                             
                                                exp
                                                (
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                   
                                                
                                                exp
                                                (
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 =
                                 E
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                             
                                                Y
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

In order to calculate the mean of the ratio, we adapt the second-order Taylor expansion approximation (Kendall et al., 2010; Rice & Papadopoulos, 2009):
                           
                              (A.2)
                              
                                 f
                                 (
                                 X
                                 ,
                                 Y
                                 )
                                 ≈
                                 f
                                 (
                                 θ
                                 )
                                 +
                                 
                                    
                                       f
                                    
                                    
                                       X
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 θ
                                 )
                                 (
                                 X
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       X
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       f
                                    
                                    
                                       Y
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 θ
                                 )
                                 (
                                 Y
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       Y
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 {
                                 
                                    
                                       f
                                    
                                    
                                       XX
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 
                                    
                                       (
                                       X
                                       -
                                       
                                          
                                             θ
                                          
                                          
                                             X
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       f
                                    
                                    
                                       YY
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 
                                    
                                       (
                                       Y
                                       -
                                       
                                          
                                             θ
                                          
                                          
                                             Y
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 2
                                 
                                    
                                       f
                                    
                                    
                                       XY
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 (
                                 X
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       X
                                    
                                 
                                 )
                                 (
                                 Y
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       Y
                                    
                                 
                                 )
                                 }
                              
                           
                        where 
                           
                              θ
                              =
                              (
                              
                                 
                                    θ
                                 
                                 
                                    X
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    Y
                                 
                              
                              )
                           
                        . If 
                           
                              θ
                              =
                              (
                              E
                              [
                              X
                              ]
                              ,
                              E
                              [
                              Y
                              ]
                              )
                           
                        , then a better approximation of expectation is:
                           
                              (A.3)
                              
                                 E
                                 [
                                 f
                                 (
                                 X
                                 ,
                                 Y
                                 )
                                 ]
                                 ≈
                                 f
                                 (
                                 θ
                                 )
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 {
                                 
                                    
                                       f
                                    
                                    
                                       XX
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 V
                                 (
                                 X
                                 )
                                 +
                                 
                                    
                                       f
                                    
                                    
                                       YY
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 V
                                 (
                                 Y
                                 )
                                 +
                                 2
                                 
                                    
                                       f
                                    
                                    
                                       XY
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 Cov
                                 (
                                 X
                                 ,
                                 Y
                                 )
                                 }
                              
                           
                        For 
                           
                              f
                              (
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              ,
                              Y
                              )
                              =
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              /
                              Y
                              ,
                              
                                 
                                    f
                                 
                                 
                                    XX
                                 
                                 
                                    ″
                                 
                              
                              =
                              0
                              ,
                              
                                 
                                    f
                                 
                                 
                                    XY
                                 
                                 
                                    ″
                                 
                              
                              =
                              -
                              
                                 
                                    Y
                                 
                                 
                                    -
                                    2
                                 
                              
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    YY
                                 
                                 
                                    ″
                                 
                              
                              =
                              2
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    Y
                                 
                                 
                                    -
                                    3
                                 
                              
                           
                        , the approximate expectation of the ratio is as follows:
                           
                              (A.4)
                              
                                 E
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                             
                                                Y
                                             
                                          
                                       
                                    
                                 
                                 ≈
                                 
                                    
                                       E
                                       [
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       ]
                                    
                                    
                                       E
                                       [
                                       Y
                                       ]
                                    
                                 
                                 -
                                 
                                    
                                       Cov
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       Y
                                       )
                                    
                                    
                                       E
                                       
                                          
                                             [
                                             Y
                                             ]
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       E
                                       [
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       ]
                                       V
                                       (
                                       Y
                                       )
                                    
                                    
                                       E
                                       
                                          
                                             [
                                             Y
                                             ]
                                          
                                          
                                             3
                                          
                                       
                                    
                                 
                              
                           
                        In the above approximate expectation of the ratio, the mean and variance of the sum of log-normal distribution, 
                           
                              E
                              [
                              Y
                              ]
                           
                         and 
                           
                              V
                              (
                              Y
                              )
                           
                        , can be calculated (Dufresne, 2008; Gao, Xu, & Ye, 2009):
                           
                              (A.5)
                              
                                 E
                                 [
                                 Y
                                 ]
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             k
                                          
                                       
                                       /
                                       2
                                    
                                 
                              
                           
                        
                        
                           
                              (A.6)
                              
                                 V
                                 (
                                 Y
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       2
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                e
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                          
                                          -
                                          1
                                       
                                    
                                 
                              
                           
                        The covariance terms, 
                           
                              Cov
                              (
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              ,
                              Y
                              )
                           
                        , can be calculated easily as follows:
                           
                              (A.7)
                              
                                 Cov
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 Y
                                 )
                                 =
                                 Cov
                                 
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                X
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                 
                                 =
                                 V
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 E
                                 
                                    
                                       [
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       ]
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                e
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                          
                                          -
                                          1
                                       
                                    
                                 
                              
                           
                        
                     

Finally, we can get the expectation of a softmax function whose inputs are drawn from Gaussian distributions:
                           
                              (A.8)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                exp
                                                (
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      ti
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                   
                                                
                                                exp
                                                (
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      tk
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 ≈
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tk
                                             
                                             
                                                2
                                             
                                          
                                          -
                                          
                                             
                                                m
                                             
                                             
                                                ti
                                             
                                          
                                       
                                    
                                 
                              
                           
                        when 
                           
                              
                                 
                                    m
                                 
                                 
                                    ti
                                 
                              
                              =
                              
                                 
                                    π
                                 
                                 
                                    i
                                 
                              
                              (
                              
                                 
                                    
                                       
                                          μ
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                              )
                           
                        , which we introduced.

Jointed variables with two softmax functions are classified into two classes: squared softmax functions,
                           
                              (A.9)
                              
                                 E
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       (
                                       α
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 ]
                                 =
                                 E
                                 
                                    
                                       
                                          
                                             
                                                exp
                                                (
                                                2
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            exp
                                                            (
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 E
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      Y
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        and jointed variables with two softmax functions that have different indexes,
                           
                              (A.10)
                              
                                 E
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 α
                                 )
                                 
                                    
                                       π
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 α
                                 )
                                 ]
                                 =
                                 E
                                 
                                    
                                       
                                          
                                             
                                                exp
                                                (
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      i
                                                   
                                                
                                                +
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            exp
                                                            (
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 E
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      Y
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              i
                              
                              ≠
                              
                              j
                           
                        . The expectation of squared softmax functions can be calculated by substituting 
                           
                              f
                              (
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              ,
                              Y
                              )
                              =
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                                 
                                    2
                                 
                              
                              /
                              
                                 
                                    Y
                                 
                                 
                                    2
                                 
                              
                           
                         in Formula (A.2). For 
                           
                              
                                 
                                    f
                                 
                                 
                                    XX
                                 
                                 
                                    ″
                                 
                              
                              =
                              2
                              
                                 
                                    Y
                                 
                                 
                                    -
                                    2
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    XY
                                 
                                 
                                    ″
                                 
                              
                              =
                              -
                              4
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    Y
                                 
                                 
                                    -
                                    3
                                 
                              
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    YY
                                 
                                 
                                    ″
                                 
                              
                              =
                              6
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    Y
                                 
                                 
                                    -
                                    4
                                 
                              
                           
                        , the approximate expectation of the squared ratio is as follows:
                           
                              (A.11)
                              
                                 E
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      Y
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       E
                                       
                                          
                                             [
                                             
                                                
                                                   X
                                                
                                                
                                                   i
                                                
                                             
                                             ]
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       E
                                       
                                          
                                             [
                                             Y
                                             ]
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       V
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    
                                       E
                                       
                                          
                                             [
                                             Y
                                             ]
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 +
                                 3
                                 
                                    
                                       E
                                       
                                          
                                             [
                                             
                                                
                                                   X
                                                
                                                
                                                   i
                                                
                                             
                                             ]
                                          
                                          
                                             2
                                          
                                       
                                       V
                                       (
                                       Y
                                       )
                                    
                                    
                                       E
                                       
                                          
                                             [
                                             Y
                                             ]
                                          
                                          
                                             4
                                          
                                       
                                    
                                 
                                 -
                                 4
                                 
                                    
                                       E
                                       [
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       ]
                                       Cov
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       Y
                                       )
                                    
                                    
                                       E
                                       
                                          
                                             [
                                             Y
                                             ]
                                          
                                          
                                             3
                                          
                                       
                                    
                                 
                              
                           
                        Using this equation, we can calculate the approximate expectation of squared softmax functions
                           
                              (A.12)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 ]
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            exp
                                                            (
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  ti
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            exp
                                                            (
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  tk
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 ≈
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 
                                    
                                       
                                          3
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tk
                                             
                                             
                                                2
                                             
                                          
                                          -
                                          4
                                          
                                             
                                                m
                                             
                                             
                                                ti
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Two jointed softmax functions are constructed with the total summation and two of log-normal distributions, 
                           
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                           
                         and 
                           
                              
                                 
                                    X
                                 
                                 
                                    j
                                 
                              
                           
                        . This requires a three-dimensional Taylor extension similar to Formula (A.2):
                           
                              (A.13)
                              
                                 f
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       X
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 Y
                                 )
                                 ≈
                                 f
                                 (
                                 θ
                                 )
                                 +
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 θ
                                 )
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 θ
                                 )
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       j
                                    
                                 
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       f
                                    
                                    
                                       Y
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 θ
                                 )
                                 (
                                 Y
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       Y
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 {
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 
                                    
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       -
                                       
                                          
                                             θ
                                          
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 
                                    
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                       -
                                       
                                          
                                             θ
                                          
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       f
                                    
                                    
                                       YY
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 
                                    
                                       (
                                       Y
                                       -
                                       
                                          
                                             θ
                                          
                                          
                                             Y
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 2
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 )
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       j
                                    
                                 
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 )
                                 +
                                 2
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       Y
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 )
                                 (
                                 Y
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       Y
                                    
                                 
                                 )
                                 +
                                 2
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                       Y
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 θ
                                 )
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       j
                                    
                                 
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 )
                                 (
                                 Y
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       Y
                                    
                                 
                                 )
                                 }
                              
                           
                        When we set 
                           
                              f
                              (
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    X
                                 
                                 
                                    j
                                 
                              
                              ,
                              Y
                              )
                              =
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    X
                                 
                                 
                                    j
                                 
                              
                              /
                              
                                 
                                    Y
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          X
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          X
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    ″
                                 
                              
                              =
                              0
                              ,
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          X
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          X
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    ″
                                 
                              
                              =
                              0
                              ,
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          X
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          X
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    ″
                                 
                              
                              =
                              
                                 
                                    Y
                                 
                                 
                                    -
                                    2
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          X
                                       
                                       
                                          i
                                       
                                    
                                    Y
                                 
                                 
                                    ″
                                 
                              
                              =
                              -
                              2
                              
                                 
                                    X
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    Y
                                 
                                 
                                    -
                                    3
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          X
                                       
                                       
                                          j
                                       
                                    
                                    Y
                                 
                                 
                                    ″
                                 
                              
                              =
                              -
                              2
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    Y
                                 
                                 
                                    -
                                    3
                                 
                              
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    YY
                                 
                                 
                                    ″
                                 
                              
                              =
                              6
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    X
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    Y
                                 
                                 
                                    -
                                    4
                                 
                              
                           
                        , the approximate expectation of the two softmax functions is as follows:
                           
                              (A.14)
                              
                                 E
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      Y
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       E
                                       [
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       ]
                                       E
                                       [
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                       ]
                                    
                                    
                                       E
                                       
                                          
                                             [
                                             Y
                                             ]
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 -
                                 2
                                 
                                    
                                       E
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       Cov
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       Y
                                       )
                                    
                                    
                                       E
                                       
                                          
                                             [
                                             Y
                                             ]
                                          
                                          
                                             3
                                          
                                       
                                    
                                 
                                 -
                                 2
                                 
                                    
                                       E
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       Cov
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       Y
                                       )
                                    
                                    
                                       E
                                       
                                          
                                             [
                                             Y
                                             ]
                                          
                                          
                                             3
                                          
                                       
                                    
                                 
                                 +
                                 3
                                 
                                    
                                       E
                                       [
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       ]
                                       E
                                       [
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                       ]
                                       V
                                       (
                                       Y
                                       )
                                    
                                    
                                       E
                                       
                                          
                                             [
                                             Y
                                             ]
                                          
                                          
                                             4
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Finally, the expectation of the two jointed softmax functions that have different indexes is as follows:
                           
                              (A.15)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       π
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 
                                    
                                       π
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                exp
                                                (
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      ti
                                                   
                                                
                                                +
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      tj
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            exp
                                                            (
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  tk
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ≈
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       tj
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       tj
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 
                                    
                                       
                                          3
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tk
                                             
                                             
                                                2
                                             
                                          
                                          -
                                          2
                                          
                                             
                                                m
                                             
                                             
                                                ti
                                             
                                          
                                          -
                                          2
                                          
                                             
                                                m
                                             
                                             
                                                tj
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

In this appendix, we give some details about the learning algorithm, including variational inference and model learning methods for optimizing the lower bound of the log likelihood. Due to the non-conjugacy of the model parameters, we utilized expectation–maximization algorithm to learn several parameters in the proposed model. In E-step, we have to infer the posterior distributions by using variational inference method which convert a problem of finding posterior distribution into that of finding variational parameters maximizing the lower bound of log likelihood. In M-step, we find model parameters also maximizing the lower bound of log likelihood. By iterating E and M steps, we can find approximated model parameters and posterior distributions.

There are several variational parameters, 
                           
                              
                                 
                                    α
                                 
                                 
                                    ̂
                                 
                              
                              ,
                              γ
                              ,
                              Λ
                              ,
                              ζ
                           
                        , and ϕ, that can be used for finding approximate posterior distributions over latent variables.

When maximizing the lower bound as a function of the variational parameters, 
                           
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        , we use a conjugate gradient algorithm because the closed-form equation cannot be found.
                           
                              (B.1)
                              
                                 
                                    
                                       dl
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ̂
                                                
                                             
                                          
                                          
                                             sk
                                          
                                       
                                    
                                 
                                 =
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                       ,
                                       k
                                    
                                 
                                 -
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       t
                                       -
                                       1
                                       ,
                                       k
                                    
                                 
                                 )
                                 
                                    
                                       
                                          
                                             
                                                d
                                                
                                                   
                                                      
                                                         
                                                            μ
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                      ,
                                                      k
                                                   
                                                
                                             
                                             
                                                d
                                                
                                                   
                                                      
                                                         
                                                            α
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      sk
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                d
                                                
                                                   
                                                      
                                                         
                                                            μ
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                      -
                                                      1
                                                      ,
                                                      k
                                                   
                                                
                                             
                                             
                                                d
                                                
                                                   
                                                      
                                                         
                                                            α
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      sk
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ,
                                          d
                                       
                                    
                                 
                                 (
                                 
                                    
                                       γ
                                    
                                    
                                       tdk
                                    
                                 
                                 -
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       tk
                                    
                                 
                                 )
                                 
                                    
                                       
                                          -
                                          
                                             
                                                d
                                                
                                                   
                                                      
                                                         
                                                            μ
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      tk
                                                   
                                                
                                             
                                             
                                                d
                                                
                                                   
                                                      
                                                         
                                                            α
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      sk
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             δ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                       
                                       
                                          K
                                       
                                    
                                 
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       
                                          
                                             dE
                                          
                                          
                                             q
                                          
                                       
                                       [
                                       
                                          
                                             π
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                       ]
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                 
                                 
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ̂
                                                
                                             
                                          
                                          
                                             sk
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             δ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                       
                                          K
                                       
                                    
                                 
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       b
                                    
                                    
                                       j
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             dE
                                          
                                          
                                             q
                                          
                                       
                                       [
                                       
                                          
                                             π
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                       
                                          
                                             π
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                       ]
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                 
                                 
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ̂
                                                
                                             
                                          
                                          
                                             sk
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Derivatives of mean from variational Kalman filter are calculated by forward–backward equations. The forward recurrence is
                           
                              (B.2)
                              
                                 
                                    
                                       d
                                       
                                          
                                             μ
                                          
                                          
                                             tk
                                          
                                       
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ̂
                                                
                                             
                                          
                                          
                                             sk
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      t
                                                      -
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       d
                                       
                                          
                                             μ
                                          
                                          
                                             t
                                             -
                                             1
                                             ,
                                             k
                                          
                                       
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ̂
                                                
                                             
                                          
                                          
                                             sk
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          1
                                          -
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      t
                                                      -
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ̂
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ̂
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ̂
                                                
                                             
                                          
                                          
                                             sk
                                          
                                       
                                    
                                 
                              
                           
                        with the initial condition 
                           
                              d
                              
                                 
                                    μ
                                 
                                 
                                    0
                                    ,
                                    k
                                 
                              
                              /
                              d
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    sk
                                 
                              
                              =
                              0
                           
                        . The backward recurrence is then
                           
                              (B.3)
                              
                                 
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                             -
                                             1
                                             ,
                                             k
                                          
                                       
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ̂
                                                
                                             
                                          
                                          
                                             sk
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      t
                                                      -
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       d
                                       
                                          
                                             μ
                                          
                                          
                                             t
                                             -
                                             1
                                             ,
                                             k
                                          
                                       
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ̂
                                                
                                             
                                          
                                          
                                             sk
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          1
                                          -
                                          
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      t
                                                      -
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ̂
                                                
                                             
                                          
                                          
                                             sk
                                          
                                       
                                    
                                 
                              
                           
                        with the initial condition 
                           
                              d
                              
                                 
                                    
                                       
                                          μ
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    T
                                    ,
                                    k
                                 
                              
                              /
                              d
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    sk
                                 
                              
                              =
                              d
                              
                                 
                                    μ
                                 
                                 
                                    T
                                    ,
                                    k
                                 
                              
                              /
                              d
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    sk
                                 
                              
                           
                        . Derivatives of expectations of single softmax functions in Formula (B.1) are separated into two cases: One is the case in which the softmax function and the variable for the derivative have the same topic index,
                           
                              (B.4)
                              
                                 
                                    
                                       
                                          
                                             dE
                                          
                                          
                                             q
                                          
                                       
                                       [
                                       
                                          
                                             π
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                       ]
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 1
                                 -
                                 2
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 )
                                 +
                                 4
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       3
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 +
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                ti
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 (
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 -
                                 3
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       3
                                    
                                 
                                 )
                              
                           
                        where 
                           
                              
                                 
                                    m
                                 
                                 
                                    ti
                                 
                              
                              =
                              
                                 
                                    π
                                 
                                 
                                    i
                                 
                              
                              (
                              
                                 
                                    
                                       
                                          μ
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         is introduced. The other is the case of different index 
                           
                              i
                              
                              ≠
                              
                              k
                           
                        , 
                           
                              (B.5)
                              
                                 
                                    
                                       
                                          
                                             dE
                                          
                                          
                                             q
                                          
                                       
                                       [
                                       
                                          
                                             π
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                       ]
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                 
                                 =
                                 -
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 
                                    
                                       
                                          2
                                          
                                             
                                                m
                                             
                                             
                                                ti
                                             
                                          
                                          +
                                          2
                                          
                                             
                                                m
                                             
                                             
                                                tk
                                             
                                          
                                          -
                                          3
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tj
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Derivatives of expectation of two jointed softmax functions in Formula (B.2) are separated into 4 cases. The first case is the same topic index between the squared softmax and the variable for the derivative
                           
                              (B.6)
                              
                                 
                                    
                                       
                                          
                                             dE
                                          
                                          
                                             q
                                          
                                       
                                       [
                                       
                                          
                                             π
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             (
                                             
                                                
                                                   α
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       ]
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                 
                                 =
                                 2
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       3
                                    
                                 
                                 (
                                 12
                                 -
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 )
                                 +
                                 18
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       4
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 +
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tj
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 (
                                 6
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       2
                                    
                                 
                                 -
                                 12
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       3
                                    
                                 
                                 )
                              
                           
                        while the second is the different topic index between them:
                           
                              (B.7)
                              
                                 
                                    
                                       
                                          
                                             dE
                                          
                                          
                                             q
                                          
                                       
                                       [
                                       
                                          
                                             π
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             (
                                             
                                                
                                                   α
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       ]
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                 
                                 =
                                 -
                                 2
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 
                                    
                                       
                                          12
                                          
                                             
                                                m
                                             
                                             
                                                ti
                                             
                                          
                                          +
                                          6
                                          
                                             
                                                m
                                             
                                             
                                                tk
                                             
                                          
                                          -
                                          12
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tj
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The third is that one of the jointed softmax functions has the same topic index with the derivative variable
                           
                              (B.8)
                              
                                 
                                    
                                       
                                          
                                             dE
                                          
                                          
                                             q
                                          
                                       
                                       [
                                       
                                          
                                             π
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                       
                                          
                                             π
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                       ]
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 (
                                 2
                                 -
                                 4
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 )
                                 (
                                 12
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       2
                                    
                                 
                                 -
                                 2
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 +
                                 6
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tj
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 )
                                 (
                                 3
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 -
                                 12
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 )
                              
                           
                        and fourth is that none of them has the same topic index
                           
                              (B.9)
                              
                                 
                                    
                                       
                                          
                                             dE
                                          
                                          
                                             q
                                          
                                       
                                       [
                                       
                                          
                                             π
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                       
                                          
                                             π
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             t
                                          
                                       
                                       )
                                       ]
                                    
                                    
                                       d
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             tk
                                          
                                       
                                    
                                 
                                 =
                                 -
                                 2
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       tj
                                    
                                 
                                 +
                                 
                                    
                                       m
                                    
                                    
                                       tk
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       ti
                                    
                                 
                                 
                                    
                                       m
                                    
                                    
                                       tj
                                    
                                 
                                 ×
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 -
                                 1
                                 )
                                 
                                    
                                       
                                          6
                                          
                                             
                                                m
                                             
                                             
                                                tk
                                             
                                          
                                          +
                                          6
                                          
                                             
                                                m
                                             
                                             
                                                ti
                                             
                                          
                                          +
                                          6
                                          
                                             
                                                m
                                             
                                             
                                                tj
                                             
                                          
                                          -
                                          12
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   u
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                tu
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Using these sub-derivative equations, we can find local optimal values of 
                           
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    1
                                    :
                                    T
                                 
                              
                           
                        .

The maximization rules of other variational parameters are similar to the standard topic model, DTM. The additional variational parameter, 
                           
                              
                                 
                                    ζ
                                 
                                 
                                    td
                                 
                              
                           
                        , can be calculated with a closed form.
                           
                              (B.10)
                              
                                 
                                    
                                       ζ
                                    
                                    
                                       td
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             γ
                                          
                                          
                                             tdk
                                          
                                       
                                       +
                                       
                                          
                                             Λ
                                          
                                          
                                             tdk
                                          
                                       
                                       /
                                       2
                                    
                                 
                              
                           
                        For the variational parameter, ϕ, can be calculated as follows:
                           
                              (B.11)
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       tdnk
                                    
                                 
                                 ∝
                                 
                                    
                                       β
                                    
                                    
                                       k
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             tdn
                                          
                                       
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             γ
                                          
                                          
                                             tdk
                                          
                                       
                                    
                                 
                              
                           
                        However, the normality of the prior distribution does not make some update-equations a closed-form. We adapted a conjugate gradient method for 
                           
                              
                                 
                                    γ
                                 
                                 
                                    tdk
                                 
                              
                           
                        . 
                           
                              (B.12)
                              
                                 
                                    
                                       dl
                                    
                                    
                                       d
                                       
                                          
                                             γ
                                          
                                          
                                             tdk
                                          
                                       
                                    
                                 
                                 =
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       γ
                                    
                                    
                                       tdk
                                    
                                 
                                 -
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       tk
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                       
                                       
                                          
                                             
                                                N
                                             
                                             
                                                t
                                             
                                          
                                          d
                                       
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       tdnk
                                    
                                 
                                 -
                                 
                                    
                                       ζ
                                    
                                    
                                       td
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       td
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             γ
                                          
                                          
                                             tdk
                                          
                                       
                                       +
                                       
                                          
                                             Λ
                                          
                                          
                                             tdk
                                          
                                       
                                       /
                                       2
                                    
                                 
                              
                           
                        Also, we adapted the Newton method for 
                           
                              
                                 
                                    Λ
                                 
                                 
                                    tdk
                                 
                              
                           
                         to add the constraint of non-negativity.
                           
                              (B.13)
                              
                                 
                                    
                                       dl
                                    
                                    
                                       d
                                       
                                          
                                             Λ
                                          
                                          
                                             tdk
                                          
                                       
                                    
                                 
                                 =
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             a
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             td
                                          
                                       
                                    
                                    
                                       2
                                       
                                          
                                             ζ
                                          
                                          
                                             td
                                          
                                       
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             γ
                                          
                                          
                                             tdk
                                          
                                       
                                       +
                                       
                                          
                                             Λ
                                          
                                          
                                             tdk
                                          
                                       
                                       /
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             Λ
                                          
                                          
                                             tdk
                                          
                                       
                                    
                                 
                              
                           
                        
                     

By iterating the total optimizations for variational parameters, we can find optimized variational parameters to explain posterior distributions.
                           Algorithm 1
                           Learning algorithm for ATM 
                                 
                                    
                                 
                              
                           

In Appendix B.1 and Section 3.2, we described learning methods for variational and model parameters. Using these methods, we can build a total learning algorithm for ATM. This algorithm includes sub optimization algorithms, which are conjugate gradient method (CGM) and Newton method (NM). The summary is described in Algorithm 1.

@&#REFERENCES@&#

