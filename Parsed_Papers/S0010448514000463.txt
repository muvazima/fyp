@&#MAIN-TITLE@&#Five-axis tool path generation in CNC machining of 
                  T
               -spline surfaces

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Introducing 
                                 T
                              -spline surface to CAM area.


                        
                        
                           
                           Improved space-filling curve (ISFC) tool path for 
                                 T
                              -spline surfaces machining.


                        
                        
                           
                           ISFC generates a non-retracted tool path.


                        
                        
                           
                           Tool path planning algorithm for irregular boundaries and holes in pre-image.


                        
                        
                           
                           Compensation path algorithm to avoid uncut materials on tool path corners.


                        
                     
                  
               
            

@&#KEYPHRASES@&#




                     




                        T




                     -spline surface

Space-filling curve

Tool path generation

Five-axis machining

@&#ABSTRACT@&#


               
               
                  Because of its flexible topology and robust data structure, the 
                        T
                     -spline surface has become the trend of free-form surfaces representation in the realm of CAD design, animation and CAE. Yet its application in manufacturing has not been fully explored. In this work, the possibility of direct tool path generation on the 
                        T
                     -spline surface has been discussed. An improved space-filling curve (ISFC) tool path planning algorithm has been proposed to exploit the advantage of 
                        T
                     -spline as a mathematical representation of free-form surfaces in CAM process, as well as to overcome its disadvantages such as irregular boundaries and holes in the pre-image. The turning problem in traditional SFC has been tackled using Hermite compensation curves. Finally, a prototype system has been developed to implement the proposed algorithm and actual machining has been conducted. The result shows the feasibility as well as the efficiency of the proposed method for 
                        T
                     -spline surfaces tool path generation compared to commercial CAM system.
               
            

@&#INTRODUCTION@&#

In the field of computer-aided manufacturing, there are mainly two types of representation for free-form surface: the tensor-product parametric surface and the polyhedron surface. Both of them have several disadvantages in modeling complex workpieces. The tensor-product surface such as NURBS, as the term implies, is generated by tensor product of two NURBS curves. Every row in its control mesh must contain exactly the same number of control vertices. Most of them are superfluous and do not add information to the surface. In parametric space, the pre-image of a NURBS surface is a rectangular grid of knots. Due to such property, surfaces of arbitrary topology cannot be represented using a single NURBS surface  [1]. In practice, multiple trimmed NURBS patches are usually employed for complicated workpiece  [2–5]. The trimming and joining process not only are time consuming but also leave cracks or ripples between adjacent patches, making it difficult for tool path generation, as can be seen in Fig. 1
                     (a).

The polyhedron surface, also called tessellation surface, has been widely used in both commercial CAM system and academic research  [6–8]. In contrast to analytical representation, the polyhedron surface comprises of a large amount of triangular or quadrilateral facets. To represent complex shapes, finer facets are employed, and the total number of facets will greatly increase. Hence, a large storage memory is taken up for tool path generation, as shown in Fig. 1(b). Another problem of using the polyhedron surface is the lack of geometric information for discretized facets. The fitting of discrete surface normal and curvature are often used as a second best  [9].

Researchers have been eager to find a mathematical model that is able to represent complex workpiece and is suitable for CAM processes as well. Not until the advent of 
                        T
                     -spline, this problem does not have a perfect solution.

The 
                        T
                     -spline and its local refinement is first proposed in  [10,11]. It combines much of the flexibility of Point-based spline  [1] with the topology and structure of NURBS. It possesses unparalleled advantages in representing free-form surfaces compared to the tensor-product NURBS and the polyhedron surface. First, the 
                        T
                     -spline does not require equal number of control vertices for each row in its control mesh. It keeps the least number of control vertices and offer convenience for CAD/CAM data exchange. Second, every control vertex has a dominating area. Only the surface points inside this area will receive contribution from the dominating vertex. The arbitrary topological structure of 
                        T
                     -spline makes it easy to represent complex free-form surface with a single, unified domain. For complicated workpieces, no trimming or gluing is required. As a result, tool path planning problems related to multi-patch machining, such as crack crossing and ripple smoothing between adjacent patches, will not be encountered. Tool path can be spread out over the whole surface, no unnecessary tool retraction is required.

Moreover, the 
                        T
                     -spline is a parametric analytical surface without discretization. CC (cutter-contact) point can be calculated analytically right on the surface. The tedious intersection process between surface facets and the tool can be avoided. The memory cost for recording the surface is also smaller compared to that of polyhedron surface. Furthermore, the local geometric property evaluation can be carried out in explicit form. The key properties for tool path side step determination, such as normal vector, principle curvature, and etc., can be easily derived through differential geometric calculation. No fitting or approximation is required.

Nowadays, 
                        T
                     -spline have been widely used in non-parameterized design  [12,13], movie and animation  [14]. There is also a growing trend of its application in CAE, especially in a newly flourishing area, the iso-geometric analysis  [15,16]. The Autodesk®   
                        T
                     -splines®  Plug-in for Rhino®  is now the only 
                        T
                     -splines modeling tool in the world  [17]. Even though the masses of research on the properties and characteristics of 
                        T
                     -spline in CAD and CAE realm, its application in CAM has not been fully exploited. This is definitely not a trivial problem, for an industrial design can never be called a product until it is manufactured. In this work, we will focus on the tool path generation for 
                        T
                     -spline surface milling.

@&#RELATED WORKS@&#

For the last two decades, researchers have devoted to the problem of tool path generation for free-form surfaces  [18,19]. Tool path planning on freeform surface can be expressed as an optimization problem for covering: to find the shortest path under the constrains of scallop height limit 
                        
                           
                              h
                           
                           
                              m
                           
                        
                     .

To solve the problem, different planning methodologies have been proposed. Because polyhedron surface totally abandoned the parametric domain, tool path planning operation for it can only be carried out in Cartesian space. Drive plane intersection, facet offset  [20], and curve projection  [21] are usually employed. Most of them are calculation expensive. Researchers have also studied the tool path generation for NURBS, especially multi-patch surfaces. Due to the nature of trimmed-NURBS patch, special treatment such as reparameterization  [2], parametric boundary offset  [3], and connection check  [4] are usually required for each patch. This may require a lot of efforts.

No related record is found about the tool path generation on 
                        T
                     -spline surface. However, the space-filling curve (SFC) has the ability of evenly distributing over the surface with only one pass, thus seems to be a promising candidate for 
                        T
                     -spline tool path generation. Cox et al.  [22] and Griffiths  [23] first introduced SFC to 3-axis tool path planning as a theoretical attempt, which symbolized the beginning of SFC application in tool path generation. Quite different from traditional milling operation, Yang et al.  [24] applied SFC pattern to laser sintering. Pessoles and Tournier  [25] reported the implementation of SFC in automatic polishing process of plastic injection molds. Anotaipaiboon and Makhanov  [26] introduced the concept of adaptive space-filling curve to tool path planning. Three steps are taken to produce a continuous tool path with local optimization: grid generation, path generation, and path correction. Traditionally, SFC is required to lie on a rectangular domain. In the effort to expand SFC tool path to non-rectangle domain, Anotaipaiboon and Makhanov  [27] employed harmonic mapping and extended their previous work to curvilinear space-filling curve (CSFC). However, as mentioned in their work, the mapping operation is computational expensive. Moreover, when there are holes in parametric domain, the surface has to be split into several patches. Li  [28] extended the work of Anotaipaiboon and Makhanov, but the case of irregular boundary has not been taken into consideration.

Another problem of traditional SFC tool path is that undercut materials will be left around corners. Mansor et al.  [29] summarized the works of predecessors in detail and proposed an independent methods for uncut area classification, detection, and compensation based on Voronoi diagram. However, the methodologies used in 2.5D milling may not be compatible in free-form surface machining.

In this work a tool path generation method based on improved Space-filling curve (ISFC) is proposed. It evolves from  [26] with consideration of the irregular shape of a 
                        T
                     -splines pre-image.

The rest of this work is arranged as below: In Section  3, the basic definition of 
                        T
                     -spline is reviewed. A simple data structure is proposed, based on which surface point and the vicinity geometric properties are evaluated. Section  4 focuses on the tool path on 
                        T
                     -spline surface. A novel ISFC tool path generating method is proposed considering the characteristic of 
                        T
                     -spline pre-image. The four steps: grid generation, cell generation, cell linking, and path correction, are discussed in detail. To prove the feasibility of the proposed algorithms, computer simulation and cutting experiments are reported in Section  5. Finally in Section  6, we summarize the work and reveal the possible development in the following researches.

In this section, the basic concept and surface point calculation of 
                        T
                     -spline are briefly reviewed. After that, a simple data structure for geometric calculation is proposed. In this work, bi-cubic 
                        T
                     -spline surface is used, but the method can be extended to any other degrees without pain.


                        Fig. 2
                         shows a typical 
                           T
                        -spline surface, it consists of two parts: (1) the control mesh and actual surface in Cartesian space and (2) the pre-image in parametric space. Control vertices in 
                           T
                        -mesh correspond to knots in parametric pre-image. The main discrepancies of 
                           T
                        -spline from tensor-product NURBS can be shown in the pre-image. In NURBS pre-image, every row possesses exactly the same number of knots. In 
                           T
                        -spline, however, the number of knots in every row and column are not necessarily the same. The interrupted knot appears like the capital letter T, so called 
                           T
                        -junction. 
                           T
                        -spline is named after it. This feature enables 
                           T
                        -spline surface to represent complex shapes with less control points. If no special 
                           T
                        -junction appears, the 
                           T
                        -spline degenerates to a NURBS surface.

Moreover, every knot owns a pair of local knot vectors 
                           
                              
                                 
                                    s
                                 
                              
                              
                                 i
                              
                           
                         and 
                           
                              
                                 
                                    t
                                 
                              
                              
                                 i
                              
                           
                        . They together define the dominating area of the knot. Points inside this area will receive influence from the domination knot. The local knot vectors are extracted from the neighborhoods in parametric space. Take knot 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 0
                              
                           
                           
                              [
                              
                                 
                                    s
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              ]
                           
                         in Fig. 2 for example. In bi-cubic case, knot vectors in both directions contain five numbers. First, set the knot coordinates 
                           
                              [
                              
                                 
                                    s
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              ]
                           
                         to the middle of knot vectors of both directions. Then, shoot rays from the 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 0
                              
                           
                         to four directions (
                           +
                           s
                           ,
                           −
                           s
                           ,
                           +
                           t
                        , and 
                           −
                           t
                        ) and expand over two bays respectively, displayed with bold line. The resulting knot vectors are 
                           
                              
                                 
                                    s
                                 
                              
                              
                                 0
                              
                           
                           =
                           
                              [
                              
                                 
                                    s
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    6
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    9
                                 
                              
                              ]
                           
                         and 
                           
                              
                                 
                                    t
                                 
                              
                              
                                 0
                              
                           
                           =
                           
                              [
                              
                                 
                                    t
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    4
                                 
                              
                              ]
                           
                        . As a result, the dominant of 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 0
                              
                           
                         is the rectangle from 
                           
                              [
                              
                                 
                                    s
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    0
                                 
                              
                              ]
                           
                         to 
                           
                              [
                              
                                 
                                    s
                                 
                                 
                                    9
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    4
                                 
                              
                              ]
                           
                        . Every point inside this area will be receive contribution from 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 0
                              
                           
                        .

With these basic concepts, the definition of 
                           T
                        -spline can be introduced.


                        
                           Definition 1
                           Given a bi-parametric pre-image and the control vertices, a point on 
                                 T
                              -spline surface 
                                 
                                    S
                                 
                                 
                                    (
                                    s
                                    ,
                                    t
                                    )
                                 
                               can be calculated by inputting knot coordinates 
                                 
                                    [
                                    s
                                    ,
                                    t
                                    ]
                                 
                               to the following equation  [10]: 
                                 
                                    (1)
                                    
                                       
                                          S
                                       
                                       
                                          (
                                          s
                                          ,
                                          t
                                          )
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   ∈
                                                   A
                                                
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                
                                                   B
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                (
                                                s
                                                ,
                                                t
                                                )
                                             
                                             
                                                
                                                   W
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   ∈
                                                   A
                                                
                                             
                                             
                                                
                                                   B
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                (
                                                s
                                                ,
                                                t
                                                )
                                             
                                             
                                                
                                                   W
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       ,
                                    
                                 
                               in which 
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       i
                                    
                                 
                               denotes the coordinates of control vertex in Cartesian space, and 
                                 
                                    
                                       W
                                    
                                    
                                       i
                                    
                                 
                               denotes the weight. 
                                 A
                               is the set of nodes that make non-zero contribution to current point.


                              
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                                 
                                    (
                                    s
                                    ,
                                    t
                                    )
                                 
                               is the 
                                 T
                              -spline blending function  [30] corresponding to control vertex 
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       i
                                    
                                 
                              , given by 
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                                 
                                    (
                                    s
                                    ,
                                    t
                                    )
                                 
                                 =
                                 N
                                 
                                    [
                                    
                                       
                                          
                                             s
                                          
                                       
                                       
                                          i
                                       
                                    
                                    ]
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 ⋅
                                 N
                                 
                                    [
                                    
                                       
                                          
                                             t
                                          
                                       
                                       
                                          i
                                       
                                    
                                    ]
                                 
                                 
                                    (
                                    t
                                    )
                                 
                              . 
                                 N
                                 
                                    [
                                    
                                       
                                          
                                             s
                                          
                                       
                                       
                                          i
                                       
                                    
                                    ]
                                 
                                 
                                    (
                                    s
                                    )
                                 
                               and 
                                 N
                                 
                                    [
                                    
                                       
                                          
                                             t
                                          
                                       
                                       
                                          i
                                       
                                    
                                    ]
                                 
                                 
                                    (
                                    t
                                    )
                                 
                               are 
                                 B
                              -Spline base functions determined by knot vector 
                                 
                                    
                                       
                                          s
                                       
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          s
                                       
                                       
                                          i
                                          0
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          i
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          i
                                          2
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          i
                                          3
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          i
                                          4
                                       
                                    
                                    ]
                                 
                               and 
                                 
                                    
                                       
                                          t
                                       
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          0
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          2
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          3
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          4
                                       
                                    
                                    ]
                                 
                              . Take 
                                 t
                              -direction for example, 
                                 d
                               denotes degree, base function is iteratively calculated by 
                                 
                                    
                                       
                                          N
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          =
                                          
                                             {
                                             
                                                
                                                   
                                                      1
                                                      ,
                                                   
                                                   
                                                      t
                                                      ∈
                                                      
                                                         [
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               i
                                                               +
                                                               1
                                                            
                                                         
                                                         ]
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                      ,
                                                   
                                                   
                                                      otherwise ,
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          N
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   d
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          =
                                          
                                             
                                                t
                                                −
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      d
                                                   
                                                
                                                −
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          N
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   d
                                                
                                             
                                             ]
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          +
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      d
                                                      +
                                                      1
                                                   
                                                
                                                −
                                                t
                                             
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      d
                                                      +
                                                      1
                                                   
                                                
                                                −
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          N
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   d
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           

In order to apply to above-mentioned calculation, a simple and effective data structure is proposed in this work.


                        
                           Definition 2
                           As show in the C++ style pseudo code in Fig. 3
                              , the intimate connection between a knot in parametric domain and a control vertex in Cartesian space can be represented by the class CNode. Every node process its knot coordinates 
                                 
                                    [
                                    s
                                    ,
                                    t
                                    ]
                                 
                              , local knot vectors and vectS[5] and vectT[5]. In bi-cubic case, 
                                 
                                    [
                                    s
                                    ,
                                    t
                                    ]
                                 
                               equals to the middle of knot vectors in both direction, i.e. the vectS[2] and vectT[2]. 
                                 T
                              -spline is expressed by class CTspline, which can be seen as the aggregation of nodes.

Given a point 
                           
                              P
                           
                           =
                           
                              [
                              s
                              ,
                              t
                              ]
                           
                         in parametric space, in order to evaluate its local geometric properties on 
                           T
                        -spline surface, we have to find out all of the knots that make non-zero contribution to it. Denote the set as contributing knots as 
                           A
                        . Then, for each 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 i
                              
                           
                           ∈
                           A
                        , calculate the value of blending function 
                           
                              
                                 B
                              
                              
                                 i
                              
                           
                           
                              (
                              s
                              ,
                              t
                              )
                           
                         as contribution. Next, according to Eq. (1), multiply each contribution with the coordinates and weight of the corresponding control point. Finally, summing it all up will produce the Cartesian coordinates of the required point. The flowchart is shown in Fig. 4
                        .

In order to evaluate local properties, partial differential of the surface on both directions should be established. According to quotient rule, Eq. (1) can be simplified as 
                           
                              S
                           
                           =
                           
                              B
                           
                           /
                           
                              W
                           
                        , in which 
                           
                              B
                           
                           =
                           ∑
                           
                              
                                 
                                    P
                                 
                              
                              
                                 i
                              
                           
                           
                              
                                 B
                              
                              
                                 i
                              
                           
                           
                              (
                              s
                              ,
                              t
                              )
                           
                           
                              
                                 W
                              
                              
                                 i
                              
                           
                        ,  
                           
                              W
                           
                           =
                           ∑
                           
                              
                                 B
                              
                              
                                 i
                              
                           
                           
                              (
                              s
                              ,
                              t
                              )
                           
                           
                              
                                 W
                              
                              
                                 i
                              
                           
                        . Take derivative to both side, we can get 
                           
                              (2)
                              
                                 
                                    
                                       
                                          (
                                          
                                             S
                                          
                                          ⋅
                                          
                                             W
                                          
                                          )
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       
                                          B
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 ⇒
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          W
                                       
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             B
                                          
                                       
                                       
                                          ′
                                       
                                    
                                    −
                                    
                                       
                                          
                                             W
                                          
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       S
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     

Repeat the procedure, the iterative equation for 
                           k
                        -th derivative is 
                           
                              (3)
                              
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       
                                          (
                                          k
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          W
                                       
                                    
                                 
                                 
                                    [
                                    
                                       
                                          
                                             B
                                          
                                       
                                       
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    −
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          C
                                       
                                       
                                          k
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          
                                             W
                                          
                                       
                                       
                                          
                                             (
                                             j
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          
                                             (
                                             k
                                             −
                                             j
                                             )
                                          
                                       
                                    
                                    ]
                                 
                                 .
                              
                           
                        
                     

From it, the first and second derivatives of surface yield 
                           
                              (4)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      S
                                                   
                                                
                                                
                                                   ∂
                                                   s
                                                
                                             
                                             ≜
                                             
                                                
                                                   
                                                      S
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      W
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         B
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         W
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                
                                                   S
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      S
                                                   
                                                
                                                
                                                   ∂
                                                   t
                                                
                                             
                                             ≜
                                             
                                                
                                                   
                                                      S
                                                   
                                                
                                                
                                                   t
                                                
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      W
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         B
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         W
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                
                                                   S
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      S
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             ≜
                                             
                                                
                                                   
                                                      S
                                                   
                                                
                                                
                                                   s
                                                   s
                                                
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      W
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         B
                                                      
                                                   
                                                   
                                                      s
                                                      s
                                                   
                                                
                                                −
                                                2
                                                
                                                   
                                                      
                                                         W
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         W
                                                      
                                                   
                                                   
                                                      s
                                                      s
                                                   
                                                
                                                
                                                   S
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      S
                                                   
                                                
                                                
                                                   ∂
                                                   s
                                                   ∂
                                                   t
                                                
                                             
                                             ≜
                                             
                                                
                                                   
                                                      S
                                                   
                                                
                                                
                                                   s
                                                   t
                                                
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         
                                                            W
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                [
                                                
                                                   W
                                                
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                      
                                                      
                                                         s
                                                         t
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            W
                                                         
                                                      
                                                      
                                                         s
                                                         t
                                                      
                                                   
                                                   
                                                      S
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            W
                                                         
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            S
                                                         
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                +
                                                
                                                   
                                                      
                                                         W
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                
                                                   
                                                      
                                                         W
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                
                                                   S
                                                
                                                −
                                                
                                                   
                                                      
                                                         B
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                
                                                   W
                                                
                                                ]
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      S
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             ≜
                                             
                                                
                                                   
                                                      S
                                                   
                                                
                                                
                                                   t
                                                   t
                                                
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      W
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         B
                                                      
                                                   
                                                   
                                                      t
                                                      t
                                                   
                                                
                                                −
                                                2
                                                
                                                   
                                                      
                                                         W
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         W
                                                      
                                                   
                                                   
                                                      t
                                                      t
                                                   
                                                
                                                
                                                   S
                                                
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

As a result, surface normal is 
                           
                              n
                           
                           =
                           
                              
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       s
                                    
                                 
                                 ×
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       t
                                    
                                 
                              
                              
                                 
                                    |
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          s
                                       
                                    
                                    ×
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          t
                                       
                                    
                                    |
                                 
                              
                           
                        . And the first and second fundamental forms of surface yield 
                           
                              (5)
                              
                                 
                                    {
                                    
                                       
                                          
                                             E
                                             =
                                             
                                                
                                                   
                                                      S
                                                   
                                                
                                                
                                                   s
                                                
                                                
                                                   2
                                                
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         
                                                            W
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               B
                                                            
                                                         
                                                         
                                                            s
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               W
                                                            
                                                         
                                                         
                                                            s
                                                         
                                                      
                                                      
                                                         S
                                                      
                                                      )
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       
                                          
                                             F
                                             =
                                             
                                                
                                                   
                                                      S
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             
                                                
                                                   
                                                      S
                                                   
                                                
                                                
                                                   t
                                                
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         
                                                            W
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         B
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         W
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                
                                                   S
                                                
                                                )
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         B
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         W
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                
                                                   S
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             G
                                             =
                                             
                                                
                                                   
                                                      S
                                                   
                                                
                                                
                                                   t
                                                
                                                
                                                   2
                                                
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         
                                                            W
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               B
                                                            
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               W
                                                            
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      
                                                         S
                                                      
                                                      )
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       
                                          
                                             L
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         E
                                                         G
                                                         −
                                                         
                                                            
                                                               F
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                〈
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      s
                                                      s
                                                   
                                                
                                                ,
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                ,
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                〉
                                             
                                          
                                       
                                       
                                          
                                             M
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         E
                                                         G
                                                         −
                                                         
                                                            
                                                               F
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                〈
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      s
                                                      t
                                                   
                                                
                                                ,
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                ,
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                〉
                                             
                                          
                                       
                                       
                                          
                                             N
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         E
                                                         G
                                                         −
                                                         
                                                            
                                                               F
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                〈
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      t
                                                      t
                                                   
                                                
                                                ,
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                ,
                                                
                                                   
                                                      
                                                         S
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                〉
                                             
                                          
                                       
                                    
                                 
                              
                           
                         in which 
                           
                              〈
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    s
                                    s
                                 
                              
                              ,
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    t
                                 
                              
                              〉
                           
                         denotes mixed product. Thus, local geometric properties such as normal curvature 
                           
                              
                                 κ
                              
                              
                                 n
                              
                           
                         along direction 
                           
                              [
                              d
                              s
                              ,
                              d
                              t
                              ]
                           
                        , and principal curvatures 
                           
                              
                                 κ
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 κ
                              
                              
                                 2
                              
                           
                         can be easily evaluated by 
                           
                              (6)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   κ
                                                
                                                
                                                   n
                                                
                                             
                                             =
                                             
                                                
                                                   L
                                                   
                                                      
                                                         
                                                            (
                                                            d
                                                            s
                                                            )
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   +
                                                   2
                                                   M
                                                   
                                                   d
                                                   s
                                                   d
                                                   t
                                                   +
                                                   N
                                                   
                                                      
                                                         
                                                            (
                                                            d
                                                            t
                                                            )
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   E
                                                   
                                                      
                                                         
                                                            (
                                                            d
                                                            s
                                                            )
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   +
                                                   2
                                                   F
                                                   
                                                   d
                                                   s
                                                   d
                                                   t
                                                   +
                                                   G
                                                   
                                                      
                                                         
                                                            (
                                                            d
                                                            t
                                                            )
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   κ
                                                
                                                
                                                   1
                                                   ,
                                                   2
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      (
                                                      E
                                                      N
                                                      −
                                                      2
                                                      F
                                                      M
                                                      +
                                                      G
                                                      L
                                                      )
                                                   
                                                   ±
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  (
                                                                  E
                                                                  N
                                                                  −
                                                                  2
                                                                  F
                                                                  M
                                                                  +
                                                                  G
                                                                  L
                                                                  )
                                                               
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         −
                                                         4
                                                         
                                                            (
                                                            E
                                                            G
                                                            −
                                                            
                                                               
                                                                  F
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            (
                                                            N
                                                            L
                                                            −
                                                            
                                                               
                                                                  M
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                   
                                                      (
                                                      E
                                                      G
                                                      −
                                                      
                                                         
                                                            F
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                         These properties will be useful in scallop limited side step calculation.

One of the most charming properties of 
                        T
                     -spline is its arbitrary topology and flexible position of 
                        T
                     -junction. With it, complex shapes can be expressed easily. But it is the very property that creates difficulties for tool path generation. Traditional SFC fails to handle the surfaces with irregular boundaries and islands. Curvilinear SFC  [31] requires surface patch separation and takes a lot of efforts in harmonic mapping. As a result, an improved space-filling curve (ISFC) is proposed to handle the problem of tool path generation on 
                        T
                     -spline surface.

The main steps of ISFC are implemented on the pre-image of 
                           T
                        -spline. A pair of dual graphs 
                           G
                         and 
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                         are constructed for tool path generation, as shown in Fig. 5
                        .

First, a grid is generated in the parametric domain according to scallop limit. The vertices and edges on the grid constitute an undirected graph, denoted as G. Now the tool path generation can be formulated as a Hamiltonian path problem: to find a traverse path on graph 
                           G
                         under the constraints of path length and mechanical limitation.

Second, combine each four of the vertices in G, denoted as a cell. A dual graph 
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                         consists of cells can be created. Then, build links between cells to construct a Minimum Spanning Tree (MST) in graph 
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                        .

After the MST is built, add bridges between vertices according to links of cells. A circulated path on the parametric domain is constructed.

As the path may not be able to fulfill the demand for a tool path, corrections at turning corners have to be made. Finally, a non-retraction CC path is created by mapping the parametric path to Cartesian space.

In the rest of this section, the detail implementation of each step will be presented. Compared to traditional SFC tool path, there are mainly two differences. In the cell generation step, in order to adapt to the irregular boundaries of 
                           T
                        -spline pre-image, special treatments are taken. Also, to solve the corner undercut problem, compensational paths are appended. Five-axis ball end tool is used here for tool path planning. The method can be easily extended to any other tools.

First of all, we briefly review the calculation of offset interval in parametric space. For ball end tool, given a scallop height limit 
                           
                              
                                 h
                              
                              
                                 m
                              
                           
                        , side step 
                           S
                         between two adjacent CC point can be calculated using the cutter shape and surface local property. As shown in Fig. 6
                        , 
                           r
                         is the tool radius, and 
                           R
                           =
                           1
                           /
                           κ
                         is the curvature radius in side step direction.

Offset interval in the parametric space can be evaluated by the following equations  [32], 
                           
                              
                                 (7)
                                 
                                    Δ
                                    s
                                    =
                                    
                                       
                                          ±
                                          S
                                          
                                             (
                                             F
                                             
                                                
                                                   d
                                                   s
                                                
                                                
                                                   d
                                                   u
                                                
                                             
                                             +
                                             G
                                             
                                                
                                                   d
                                                   t
                                                
                                                
                                                   d
                                                   u
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             
                                                E
                                                G
                                                −
                                                
                                                   
                                                      F
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                E
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               d
                                                               s
                                                            
                                                            
                                                               d
                                                               u
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                2
                                                F
                                                
                                                   
                                                      d
                                                      s
                                                      d
                                                      t
                                                   
                                                   
                                                      d
                                                      u
                                                      d
                                                      u
                                                   
                                                
                                                +
                                                G
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               d
                                                               t
                                                            
                                                            
                                                               d
                                                               u
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                              
                                 (8)
                                 
                                    Δ
                                    t
                                    =
                                    
                                       
                                          ∓
                                          S
                                          
                                             (
                                             E
                                             
                                                
                                                   d
                                                   s
                                                
                                                
                                                   d
                                                   u
                                                
                                             
                                             +
                                             F
                                             
                                                
                                                   d
                                                   t
                                                
                                                
                                                   d
                                                   u
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             
                                                E
                                                G
                                                −
                                                
                                                   
                                                      F
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                E
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               d
                                                               s
                                                            
                                                            
                                                               d
                                                               u
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                2
                                                F
                                                
                                                   
                                                      d
                                                      s
                                                      d
                                                      t
                                                   
                                                   
                                                      d
                                                      u
                                                      d
                                                      u
                                                   
                                                
                                                +
                                                G
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               d
                                                               t
                                                            
                                                            
                                                               d
                                                               u
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        
                        
                           E
                           ,
                           F
                        , and 
                           G
                         are the first fundamental parameters of the surface, which can be calculated from Eq. (5).

With the calculation of scallop limit point in parametric space, we can start the process of building grid. First, we sample 
                           k
                         points on the left boundary, i.e. parametric line 
                           s
                           =
                           0
                        . For every point, calculate offset interval 
                           Δ
                           s
                         required for an adjacent CC point on 
                           s
                        -direction using Eq. (7), as shown in Fig. 7
                        (a). Then, choose the minimum among them, and defined as 
                           Δ
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                        , shown in Fig. 7(b). Repeat the same process on parametric line 
                           s
                           =
                           Δ
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                         and yield the minimum interval 
                           Δ
                           
                              
                                 s
                              
                              
                                 1
                              
                           
                        . Repeat this process until the right boundary is reached. As a result, a series of iso-parametric lines are defined, as shown in Fig. 7(c). Iso-parametric lines on 
                           t
                        -direction are constructed in like manner using Eq. (8), shown in Fig. 7(d). Now that scallop-limited iso-parametric lines for 
                           s
                        - and 
                           t
                        -direction are found, by overlapping them yield the vertices of grid, shown in Fig. 7(e).

Note that with the abovementioned method, the resulting intervals between every two adjacent vertices are chosen conservatively such that scallops are maintained under predefined value. However, for surface finishing, the method is considered reasonable.

As mentioned in Section  4.1, the grid of vertices generated above is considered as graph 
                           G
                        . In order to construct a dual graph 
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                        , combine each four vertices to create a cell. Quite different from the canonical rectangle parametric domain in tensor-product NURBS, 
                           T
                        -spline pre-image may have irregular boundaries and holes. Graph 
                           G
                         may contain vertices that appear outside boundaries or inside holes. In Fig. 8
                        -left, they are marked as small hollow squares. These invalid vertices can neither form rational cells nor be evaluated on the actual 
                           T
                        -spline surface. Thus, special treatments should be performed.

There may be three cases that vertices cannot form a cell, as shown in Fig. 8(a). First, if odd numbers of columns or rows of vertices are generated in the grid building step, there will be not enough vertices to construct cells near boundaries. For example, the possible cell A near the upper boundary of 
                           t
                        -direction. Due to the nature that cell consists of four vertices, cell A needs another two vertices to complete. Second, if some vertices of the possible cell fall inside a hole, it will be impossible to construct a valid cell, see possible cell B. The third situation is similar to the second one, see possible cell C, it contains a vertex that falls outside the boundary.

In order to construct a rational graph 
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                        , we have to make complement and modification to current grid. To be specific, for case one, as shown in Fig. 9
                        (a), vertices 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 2
                              
                           
                         are not enough to build a valid cell, additional vertices 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 3
                              
                           
                         and 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 4
                              
                           
                         are appended on the boundary. For cases that possible vertices fall into a hole or outside boundaries, there will be two situations. First, if the possible cell lies on the boundary (see Fig. 9(b)), we can simply offset the invalid vertices 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 2
                              
                           
                         and 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 4
                              
                           
                         back on boundary, so that the possible cell becomes valid. Second, if the possible cell is located around a corner (see Fig. 9(c)), not only should the invalid vertices be offset, new vertices 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 4
                                 b
                              
                           
                         should be appended at the corner. In this way, edges of the cell will be tracing the surface boundaries.

After all the exceptional cases are solved, valid cells are constructed on the graph 
                           G
                        , as shown in Fig. 8(b). Just by tracing edges of cells one by one, a scallop-limited tool path is formed. However, jumping from one cell to another will introduce too many retractions and jeopardize the surface finishing. A proper linking algorithm of cells is crucial for tool path generation, which will be presented next.

Celling linking is a process of building the MST on graph 
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                         that connects all cells with lowest weight. First, the weights of the links should be defined.


                        
                           Definition 3
                           The weights of links in graph 
                                 
                                    
                                       G
                                    
                                    
                                       ′
                                    
                                 
                               are set as the cost of linking two cells. It consists of two parts: the cost of tool path length and the cost of tool axis change, denoted as 
                                 
                                    
                                       L
                                    
                                    
                                       
                                          cost
                                       
                                    
                                 
                               and 
                                 
                                    
                                       A
                                    
                                    
                                       
                                          cost
                                       
                                    
                                 
                               respectively 
                                 
                                    (9)
                                    
                                       cost
                                       =
                                       
                                          
                                             1
                                          
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   L
                                                
                                             
                                             +
                                             
                                                
                                                   w
                                                
                                                
                                                   A
                                                
                                             
                                          
                                       
                                       
                                          (
                                          
                                             
                                                w
                                             
                                             
                                                L
                                             
                                          
                                          
                                             
                                                L
                                             
                                             
                                                
                                                   cost
                                                
                                             
                                          
                                          +
                                          
                                             
                                                w
                                             
                                             
                                                A
                                             
                                          
                                          
                                             
                                                A
                                             
                                             
                                                
                                                   cost
                                                
                                             
                                          
                                          )
                                       
                                       .
                                    
                                 
                               The 
                                 
                                    
                                       w
                                    
                                    
                                       L
                                    
                                 
                               and 
                                 
                                    
                                       w
                                    
                                    
                                       A
                                    
                                 
                               are the coefficients of them. By changing the coefficients, we can control which part of cost takes more effect. In this work, we set 
                                 
                                    
                                       w
                                    
                                    
                                       L
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       A
                                    
                                 
                                 =
                                 1
                              , meaning they are equally important.

The determination of cost 
                           
                              
                                 L
                              
                              
                                 
                                    cost
                                 
                              
                           
                         and 
                           
                              
                                 A
                              
                              
                                 
                                    cost
                                 
                              
                           
                         is explained by a pair of adjacent cells A and B in Fig. 10
                        . Cell A consists of vertices 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 1
                              
                           
                           ∼
                           
                              
                                 
                                    P
                                 
                              
                              
                                 4
                              
                           
                         while cell B contains 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 5
                              
                           
                           ∼
                           
                              
                                 
                                    P
                                 
                              
                              
                                 8
                              
                           
                        . The adjacent edges of them are 
                           a
                         and 
                           b
                         respectively. If two cells are linked, 
                           a
                         and 
                           b
                         will be excluded, and new bridges 
                           c
                         and 
                           d
                         will be added. Suppose vertices 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 i
                              
                           
                         maps to CC points 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 i
                              
                           
                         on actual surface, with unit vector 
                           
                              
                                 
                                    V
                                 
                              
                              
                                 i
                              
                           
                         denoting tool axis orientation.

Denote 
                           
                              |
                              a
                              |
                           
                         and 
                           
                              |
                              b
                              |
                           
                         as the actual lengths of edges in Cartesian space, while 
                           
                              |
                              c
                              |
                           
                         and 
                           
                              |
                              d
                              |
                           
                         as those of newly added bridges, then 
                           
                              
                                 
                                    
                                       L
                                    
                                    
                                       
                                          cost
                                       
                                    
                                 
                                 =
                                 
                                    |
                                    c
                                    |
                                 
                                 +
                                 
                                    |
                                    d
                                    |
                                 
                                 −
                                 
                                    |
                                    a
                                    |
                                 
                                 −
                                 
                                    |
                                    b
                                    |
                                 
                                 .
                              
                           
                         And the cost of tool axis change yields 
                           
                              
                                 
                                    
                                       A
                                    
                                    
                                       
                                          cost
                                       
                                    
                                 
                                 =
                                 Δ
                                 
                                    
                                       
                                          V
                                       
                                    
                                    
                                       47
                                    
                                 
                                 +
                                 Δ
                                 
                                    
                                       
                                          V
                                       
                                    
                                    
                                       52
                                    
                                 
                                 −
                                 Δ
                                 
                                    
                                       
                                          V
                                       
                                    
                                    
                                       42
                                    
                                 
                                 −
                                 Δ
                                 
                                    
                                       
                                          V
                                       
                                    
                                    
                                       57
                                    
                                 
                                 ,
                              
                           
                         in which 
                           Δ
                           
                              
                                 
                                    V
                                 
                              
                              
                                 i
                                 j
                              
                           
                           =
                           
                              |
                              
                                 
                                    
                                       V
                                    
                                 
                                 
                                    j
                                 
                              
                              −
                              
                                 
                                    
                                       V
                                    
                                 
                                 
                                    i
                                 
                              
                              |
                           
                         denotes the axial change between tool postures of two adjacent CC points.

With weights of links defined, we can start to build MST on 
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                        . Different algorithms have been proposed in the literature  [33]. In this work, we adopt the Kruskal greedy algorithm [34]. Let 
                           T
                         be a set of links of the minimum spanning tree in 
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                        . 
                           Q
                         denotes the queue of all possible links in graph 
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                        , ordered with regard to their weights. Then, repeat the following operation until 
                           Q
                         becomes empty:

Pop the first element of 
                           Q
                        . If it does not form a loop with other links from 
                           T
                         in the graph 
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                        , include it into 
                           T
                        .

Finally, back to graph 
                           G
                        , join vertices according to cells links to construct a circulated path on the parametric domain.

Due to the nature of scallop-limited grid generated in Section  4.2, no undercut material will be left behind while tracing edges. The only possible place for uncut area is around the corners, called uncut-pending area, as shown in Fig. 11
                        . For SFC tool path, we classify them into mainly four categories: (a) L-shaped, (b) T-shaped, (c) U-shaped, and (d) H-shaped. Amongst them, the L-shaped and T-shaped are basic forms, while U-shaped and H-shaped can be seen as the combination of two L-shaped and T-shaped respectively.

In this work, two cubic-Hermite curves are employed to form a compensation path. The first curve 
                           
                              
                                 
                                    C
                                 
                              
                              
                                 1
                              
                           
                         starts from corner point 
                           
                              Q
                           
                         to a check point 
                           
                              K
                           
                        , while the second one 
                           
                              
                                 
                                    C
                                 
                              
                              
                                 2
                              
                           
                         starts from check point 
                           
                              K
                           
                         and comes back to corner point 
                           
                              Q
                           
                        . Endpoint tangents of both curves are set such that tool transits smoothly from original path to compensational path, and back to original path again, as shown in Fig. 12
                        .

Let us consider the Hermite curve equation 
                           
                              (10)
                              
                                 
                                    
                                       
                                          C
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       3
                                    
                                 
                                 +
                                 
                                    
                                       
                                          b
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    c
                                 
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 
                                    
                                       
                                          d
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                 i
                                 =
                                 1
                                 ,
                                 2
                                 
                                 t
                                 ∈
                                 
                                    [
                                    0
                                    ,
                                    1
                                    ]
                                 
                                 .
                              
                           
                        
                     

To solve all the coefficients 
                           
                              
                                 
                                    
                                       
                                          [
                                          
                                             
                                                
                                                   C
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                             (
                                             0
                                             )
                                          
                                          
                                          
                                             
                                                
                                                   C
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                             (
                                             1
                                             )
                                          
                                          
                                          
                                             
                                                
                                                   C
                                                
                                             
                                             
                                                i
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             (
                                             0
                                             )
                                          
                                          
                                          
                                             
                                                
                                                   C
                                                
                                             
                                             
                                                i
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             (
                                             1
                                             )
                                          
                                          ]
                                       
                                    
                                    
                                       T
                                    
                                 
                                 =
                                 
                                    M
                                 
                                 ⋅
                                 
                                    
                                       
                                          [
                                          
                                             
                                                
                                                   a
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                          
                                             
                                                
                                                   c
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                          
                                             
                                                
                                                   d
                                                
                                             
                                             
                                                i
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ,
                              
                           
                         in which 
                           
                              
                                 
                                    C
                                 
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           
                              (
                              t
                              )
                           
                         denotes the first derivative of the curve at 
                           t
                        . Matrix 
                           
                              M
                           
                         is given by 
                           
                              
                                 
                                    M
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             0
                                          
                                          
                                             0
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             1
                                          
                                          
                                             1
                                          
                                          
                                             1
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             3
                                          
                                          
                                             2
                                          
                                          
                                             1
                                          
                                          
                                             0
                                          
                                       
                                    
                                    ]
                                 
                                 .
                              
                           
                         Left multiply the inverse of 
                           
                              M
                           
                         to both side of the equation, yield 
                           
                              (11)
                              
                                 
                                    
                                       
                                          [
                                          
                                             
                                                
                                                   a
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                          
                                             
                                                
                                                   c
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                          
                                             
                                                
                                                   d
                                                
                                             
                                             
                                                i
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       T
                                    
                                 
                                 =
                                 
                                    
                                       
                                          M
                                       
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 ⋅
                                 
                                    
                                       
                                          [
                                          
                                             
                                                
                                                   C
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                             (
                                             0
                                             )
                                          
                                          
                                          
                                             
                                                
                                                   C
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                             (
                                             1
                                             )
                                          
                                          
                                          
                                             
                                                
                                                   C
                                                
                                             
                                             
                                                i
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             (
                                             0
                                             )
                                          
                                          
                                          
                                             
                                                
                                                   C
                                                
                                             
                                             
                                                i
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             (
                                             1
                                             )
                                          
                                          ]
                                       
                                    
                                    
                                       T
                                    
                                 
                                 .
                              
                           
                        
                     

With Eq. (11) we can easily solve the Hermite curve for compensation path. The boundary conditions for the two curves are 
                           
                              (12)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                (
                                                0
                                                )
                                             
                                             =
                                             
                                                
                                                   
                                                      C
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                (
                                                1
                                                )
                                             
                                             =
                                             
                                                Q
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                (
                                                1
                                                )
                                             
                                             =
                                             
                                                
                                                   
                                                      C
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                (
                                                0
                                                )
                                             
                                             =
                                             
                                                K
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                
                                                
                                                   1
                                                
                                                
                                                   ′
                                                
                                             
                                             
                                                (
                                                0
                                                )
                                             
                                             =
                                             
                                                GQ
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                
                                                
                                                   2
                                                
                                                
                                                   ′
                                                
                                             
                                             
                                                (
                                                1
                                                )
                                             
                                             =
                                             
                                                QH
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                
                                                
                                                   1
                                                
                                                
                                                   ′
                                                
                                             
                                             
                                                (
                                                1
                                                )
                                             
                                             =
                                             
                                                
                                                   
                                                      C
                                                   
                                                
                                                
                                                   1
                                                
                                                
                                                   ′
                                                
                                             
                                             
                                                (
                                                0
                                                )
                                             
                                             =
                                             −
                                             
                                                [
                                                
                                                   
                                                      
                                                         C
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                
                                                   (
                                                   1
                                                   )
                                                
                                                +
                                                
                                                   
                                                      
                                                         C
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                
                                                   (
                                                   0
                                                   )
                                                
                                                ]
                                             
                                             /
                                             2
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Now the key problem is position of the check point. Note that the check point should be set to position such that the machining width overlaps with adjacent paths.

A bold observation can be made that if check point is set to the farmost point 
                           
                              P
                           
                        , compensation path will cover the whole uncut-pending area. As a result, in this work, check point is set on the diagonal of uncut-pending area for simplicity, i.e. on line 
                           
                              PQ
                           
                        . The position of point 
                           
                              K
                           
                         can be represented by parameter 
                           λ
                         as 
                           
                              (13)
                              
                                 
                                    K
                                 
                                 =
                                 
                                    (
                                    1
                                    −
                                    λ
                                    )
                                 
                                 
                                    P
                                 
                                 +
                                 λ
                                 
                                    Q
                                 
                                 ,
                                 
                                 
                                    (
                                    0
                                    ⩽
                                    λ
                                    ⩽
                                    1
                                    )
                                 
                                 .
                              
                           
                         Because the mapping from parametric domain to Cartesian space is not linear, straight lines in parametric domain do not necessarily refer to straight lines in Cartesian space. The above approximation can only be used on the surfaces where curvatures do not change abruptly. A detail and effective calculation of iso-scallop cutter contact point is introduced in  [35], which includes complex iterative procedures to find an adjacent point. In this work, a method of finding adjacent point using Newton’s iteration is proposed, as shown in Fig. 13
                        . 
                           
                              (1)
                              First, find the scallop 
                                    
                                       
                                          h
                                       
                                       
                                          
                                             PQ
                                          
                                       
                                    
                                  on 
                                    
                                       PQ
                                    
                                 , if 
                                    
                                       
                                          h
                                       
                                       
                                          
                                             PQ
                                          
                                       
                                    
                                    >
                                    
                                       
                                          h
                                       
                                       
                                          m
                                       
                                    
                                 , go to step 2 to enter the check point finding process. Else, it means this corner does not need compensation.

Set 
                                    t
                                    =
                                    1
                                  and parameter 
                                    λ
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          2
                                       
                                    
                                 , then enter Newton’s iteration.

Find check point 
                                    
                                       K
                                    
                                  with current 
                                    λ
                                  using Eq. (13). Calculate scallop height 
                                    
                                       
                                          h
                                       
                                       
                                          
                                             PK
                                          
                                       
                                    
                                  between 
                                    
                                       PK
                                    
                                 .

Check if 
                                    
                                       |
                                       
                                          
                                             h
                                          
                                          
                                             
                                                PK
                                             
                                          
                                       
                                       −
                                       
                                          
                                             h
                                          
                                          
                                             m
                                          
                                       
                                       |
                                    
                                    ⩽
                                    ϵ
                                 . If yes, it means the current 
                                    
                                       K
                                    
                                  is the every check point we are looking for, output 
                                    
                                       K
                                    
                                  for compensation path generation. Else, 
                                    t
                                    =
                                    t
                                    +
                                    1
                                  and go to step 5.

Check if 
                                    
                                       
                                          h
                                       
                                       
                                          
                                             PK
                                          
                                       
                                    
                                    >
                                    
                                       
                                          h
                                       
                                       
                                          m
                                       
                                    
                                 , set 
                                    λ
                                    =
                                    λ
                                    −
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                          
                                       
                                       
                                          t
                                       
                                    
                                 , else set 
                                    λ
                                    =
                                    λ
                                    +
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                          
                                       
                                       
                                          t
                                       
                                    
                                 . Then repeat step 3.

As a result, if there is uncut area, the appropriate check point is calculated using the above process. The additional path can not only cut off residual materials, but smoothen the corner turning as well. If no uncut material is detected in the uncut-pending area, check point is set to the mid-point of diagonal to ensure a smooth turning.

The prototype system shown in Fig. 14
                         has been developed using Microsoft Visual Studio C++ as programming tool, with OpenGL as visual components, and OpenNURBS as geometric kernel to implement the 
                           T
                        -spline data structure and algorithms.

To verify the feasibility of the proposed algorithm, we present the following selected 
                           T
                        -spline models, the die mold of a Mouse, Gamepad Controller, Hinge part, Gearbox Cover, and Sports Helmet, for tool path generation, as shown in Fig. 14. The reason why we choose these models is that they can display the flexibility of 
                           T
                        -spline modeling while keeping least control point and compact data structure as well as the unique properties of 
                           T
                        -spline.
                           
                              (1)
                              Irregular boundary in parametric domain to model special shape, see in the Mouse model the gap between the left and right button prepared for scrolling wheel.

Holes included in the parametric domain should be dealt with by improved path traverse, as can be seen in the button holes in Gamepad model and the screw holes in Hinge model.

The mixture of flat areas and walls, which is often seen in the cavities of die mold. As can be seen in the Hinge model and the Gearbox Cover model.

Different curvature over the surface results in different machining parameters.

And above all, complex shapes can be constructed by single 
                                    T
                                 -spline surfaces.

Due to the fact that most mainstream commercial CAM systems cannot process 
                           T
                        -spline surface, 3D-models have to be divided into multiple trimmed NURBS patches. For example, the Mouse model is divided into five surface patches, namely the left button, the right button, and three patches of the main body. Small cracks appear between left and right buttons and main body. In Siemens®  NX®  and Delcam®  PowerMill®, surface patches have to be traversed one by one employing zig-zag pattern, shown in Fig. 15
                         left. The disadvantages of such strategy are apparent. First, frequent tool approaching and retractions are necessary for each surface patch. Left of Fig. 15(a) and (b) indicate different sub-paths with different colors. At the end of each sub-path, tool is retracted to safe plane or back to zero point and get ready for next patch. This will certainly increase total path length and become a waste of machining time. Second, while machining a single patch, feed direction changes frequently because of the confine of patch boundary. For example, when milling surface patch 1 near the boundary of patch 2, the path direction has been changed 12 times, as can be seen from the zoom-in view in Fig. 15(b) left. Third, the existence of small gap between adjacent patches may introduce undercut, as can be seen from the VERICUT®  simulation in Fig. 15(c) left.

In our prototype system, see Fig. 15 right, each model is treated as a single watertight 
                           T
                        -spline surface. No surface subdivision or discretization is needed. Then, an ISFC tool path is generated on each of them. The whole surface is traveled in only one pass, no unnecessary retraction is needed. Side-steps are chosen such that the residue material is constrained under scallop limit. The path direction changes according to minimum cost of path length and tool axis changes. The resulting path length is greatly reduced compared to that in commercial system, as can be seen in Fig. 16
                        .

The guide plane method is another commonly used tool path strategy in die mold finishing. Tool paths are first generated on a plane covering the whole workpiece. Then, paths are projected to the actual surface. As a Euclidean method, it treats the workpiece surface as a whole and avoids the tedious surface subdivision works. Tool path planning can be carried out on complex die molds. However, it ignores the parametric space and the geometric information on the 
                           T
                        -spline surface. As a result, insufficient path intervals are introduced, especially in the pocket that contains both vertical walls and flat areas. As can be seen in Fig. 17
                        (a) left and (b) left, the CC paths on the vertical wall of Gearbox Cover and result in undercut.

Compared to the traditional tool path, the ISFC is superior in the following ways. First, the distributions of CC points are based on scallop-limit grid generation introduced in Section  4.2. Geometric properties such as surface normal curvatures are taken into consideration. The uneven path interval problem encountered in the traditional guide plane method can be avoided. As shown in Fig. 17(a) right and (b) right, the tool paths are neatly laid out both on the wall and on the flat base.

Second, the tool feed direction are chosen according to criteria of shorter path and less tool axis change, as introduced in Section  4.4. As a result, the cutting tool will turn only when it is necessary and follow a more reasonable feed direction. In the milling of the model Hinge, as can be seen in Fig. 17(c) right, tool path is chosen to climb up and down along the wall instead of moving from side to side. In such a way, the frequent turning when the tool reaches the wall edges can be avoided.

Last but not least, due to the property of 
                           T
                        -spline, the flat area and the wall are represented in a uniform parametric domain. Employing the ISFC, the parametric domain is treated as a whole. There is no boundary between different areas when it comes to tool path planning. As a result, the cutting tool traverses smoothly over the whole workpiece surface. No cracks or crease will be created at the joint area where flat base meets the wall.

There are two main improvements of ISFC compared to traditional SFC. First, due to the existence of holes and irregular boundary in 
                           T
                        -spline pre-image, there may be vertices that cannot construct cells, called floating vertices. The nature of SFC path generation is to build a minimum spanning tree over all the cells and traverse cell vertices with respect to cell links. Floating vertices are not included in cells and thus will not be traversed by the tool. In traditional SFC, floating vertices are left unconsidered and the corresponding areas will be undercut. Shown in Fig. 18
                         is the zoom-in view of model Gamepad. When using traditional SFC, floating vertices appear near the hole for cross button (see Fig. 18(a) left). As a result, uncut materials are left over in the simulation. In ISFC, this problem is solved. To be specific, if vertices are missing near boundaries to complete cells, new vertices on the boundaries are appended. If the possible cell contains vertices that fall inside a hole or outside boundaries, these invalid vertices are offset to the according boundaries. New vertices are appended around the corner if it is necessary. With these efforts, new cells are created and that floating vertices are properly traversed, as shown in Fig. 18 right.

Second, when dealing with the undercut problem around corners, traditional SFC extends the tool path such that the machining stripes of adjacent paths overlap. To be specific, tool path before corner 
                           
                              O
                           
                         is extended to point 
                           
                              P
                           
                         to remove the undercut materials, and then back to the corner again, as shown in Fig. 19
                         left. The disadvantage of this method is that the turnings of tool path at point 
                           
                              P
                           
                         and 
                           
                              O
                           
                         are too abrupt. In ISFC, Hermite compensation curves are applied to smooth corners as well as to ensure that no uncut area appears.

Actual machining is conducted on Mikron UCP 600 five-axis machining center with Heidehain530 CNC system embedded. Machining parameters are set as follows: Spindle speed 3000 rpm, feed rate 800 mpm. Incline angle is set to 10°, a common practice in industry to avoid the zero-cutting speed tool tip. The mouse model is cut out from a stock of aluminum cylinder, 105 mm in diameter, and 50 mm in height. The gearbox cover model is cut from a brick of 100 mm × 100 mm × 20 mm. Fig. 20
                        (b) shows the finished surface of the Mouse workpiece, as well as the local profile of compensation curve. Fig. 20(c) shows the finished workpiece of Gearbox Cover model. As can be seen from the local profiles, intervals of tool paths on both the flat base and the vertical wall are evenly distributed. Surface quality is ensured.

In the effort of searching suitable mathematical representation of free-form surface in CAM, analytical surfaces as well as tessellation surface have been reviewed. As a new comer in CAD/CAE area, 
                        T
                     -spline has already shown its advantages in complex shape representation and promises a good candidate for CAM process. 
                        
                           (1)
                           The proposed algorithm in this work, together with the prototype CAM system and actual machining examples, verified the feasibility of applying 
                                 T
                              -spline directly to tool path generation. This work is by far the first attempt of 
                                 T
                              -spline’s direct application in manufacturing. Results show that the excellent properties of 
                                 T
                              -spline in modeling, such as expressing complex shapes with single surface, have been well adapted to CAM process without pain.

In order to deal with the irregular boundaries and the holes on the pre-image of 
                                 T
                              -spline surface, an improved SFC tool path generation method has been proposed. It ensures that the whole surface is traversed by only one pass, no redundant retraction is needed. A shorter tool path compared to other algorithms is obtained.

Finally, attempts have been made to handle the cornering problems in SFC tool path. Hermite compensation curve has been proposed to ensure the completeness of cutting as well as the smoothness of tool turning.

Moreover, in this work, only ordinary 
                        T
                     -spline surface is taken into consideration. 
                        T
                     -spline with abnormal control vertices, referred to as 
                        T
                     -NURCC, has recently received enormous research interest. With subdivision technique, theoretically all free-form surfaces can be represented by 
                        T
                     -NURCC. It has already shown potential in CAD/CAE area, such as animation and iso-geometric analysis. Yet, the manufacturing of it has not been reported in either literature or industry. The next step of work should focus on exploiting the properties of 
                        T
                     -NURCC surfaces in CAM.

@&#ACKNOWLEDGMENTS@&#

This work was financially supported by Science Fund for Creative Research Groups of National Natural Science Foundation of China (No. 51221004), the National Nature Science Foundation of China (No. 51105335 and No. 51175461). We acknowledge to anonymous reviewers for their comments and advice.

@&#REFERENCES@&#

