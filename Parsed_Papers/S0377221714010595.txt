@&#MAIN-TITLE@&#Clustering financial time series: New insights from an extended hidden Markov model

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A model-based clustering technique is used in mining financial time series data.


                        
                        
                           
                           The model allows unobserved heterogeneity between and within time series.


                        
                        
                           
                           In the analysis of stock markets, the best model has two groups and three regimes.


                        
                        
                           
                           The model performs well in capturing different regime dynamics of stock markets.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Data mining

Hidden Markov model

Stock indexes

Latent class model

Regime-switching model

@&#ABSTRACT@&#


               
               
                  In recent years, large amounts of financial data have become available for analysis. We propose exploring returns from 21 European stock markets by model-based clustering of regime switching models. These econometric models identify clusters of time series with similar dynamic patterns and moreover allow relaxing assumptions of existing approaches, such as the assumption of conditional Gaussian returns. The proposed model handles simultaneously the heterogeneity across stock markets and over time, i.e., time-constant and time-varying discrete latent variables capture unobserved heterogeneity between and within stock markets, respectively. The results show a clear distinction between two groups of stock markets, each one characterized by different regime switching dynamics that correspond to different expected return-risk patterns. We identify three regimes: the so-called bull and bear regimes, as well as a stable regime with returns close to 0, which turns out to be the most frequently occurring regime. This is consistent with stylized facts in financial econometrics.
               
            

@&#INTRODUCTION@&#

In recent years dealing with unobserved heterogeneity has become a predominant topic in many research areas. As Heckman emphasized in his Nobel lecture, one of the most important discoveries in microeconometrics is the pervasiveness of heterogeneity and diversity in economic life: “When a full analysis of heterogeneity in response was made, a variety of candidate averages emerged to describe the average person, and the long-standing edifice of the representative consumer was shown to lack empirical support. (Heckman, 2001, p. 674)”. In finance research, heterogeneity has been mostly assumed observed (e.g., based on countries), where groups and their boundaries are delineated without regarding the intrinsic information on the observed data. However, there are plenty of examples in the academic and professional finance literature that show that heterogeneity exists among capital market participants, business managers, fund managers, among others.

The correct modeling of the dynamics of stock market returns has been an important challenge in modern financial research. Though the dominant approach followed by both academics and practitioners has been to assume that returns follow a normal distribution (see, e.g., Lundblad, 2007 and Fu, 2009), it has also been recognized that stock market returns and returns of financial assets contain skewness and excessive kurtosis. A common conclusion is that the normal distribution is inadequate for short period returns of financial assets (Fama, 1965; Mandelbrot, 1963; Praetz, 1972). Several alternative distributions have therefore been suggested for modeling returns, one of which is the Laplace distribution. These alternatives have in common that they try to accommodate for the excessive kurtosis in the empirical distribution of the returns. Whereas excess kurtosis of financial return distributions has been well addressed in the financial literature, the asymmetry of the distribution has not received much attention, and the few studies available tend to be inconclusive (Peiró, 1999; Simkowitz and Beedles, 1980; Singleton and Wingender, 1986).

Latent class or finite mixture modeling has proven to be a powerful tool for analyzing a wide range of social and behavioral science data (see, for example, Clogg, 1995 and Vermunt, 2003). The identification of distinct dynamics in time series data has been an important topic of research from a substantive point of view. We propose a latent class model for financial data analysis that takes into account unobserved heterogeneity by means of time-constant and time-varying discrete latent variables. A feature of latent class modeling is that it yields a model-based clustering of observational units that is especially attractive to the typical analysis in finance research, where it is of interest to identify subpopulations of firms, investors, markets or countries that differ in their propensities to specific characteristics (regulation, company governance characteristics, etc.). The challenging task of clustering this type of observations is that one has to incorporate data dependency in the clustering process (Kakizawa, Shumway, and Taniguchi, 1998). Therefore, clustering of time series has attracted large attention in statistics and data mining literature. However, most of the proposals developed have been based on classic clustering algorithms in such a way that time series data can be handled. Interested readers may refer to Liao (2005) and Esling and Agon (2012) who provide a detailed discussion of time series clustering in the data mining literature. Contrary to alternative heuristic clustering techniques for financial time series analysis which operate directly on the correlations (e.g., Mantegna, 1999; Basalto et al., 2007) or other measures of similarity between time series being clustered (e.g., Bastos and Caiado, 2013), the approach proposed here is a model-based clustering technique that accommodates for serial dependencies and unobserved heterogeneity by assuming a regime-switching model (RSM), also known as hidden Markov model, underlying each cluster. There is a vast body of literature on RSMs in economics and empirical finance, including Hamilton (1989), Hamilton and Susmel (1994), and Gray (1996) to name just a few. Hidden Markov models and regime-switching models as discrete state models can also be connected to stochastic volatility models (see, e.g., Langrock, MacDonald, and Zucchini, 2012; Rossi and Gallo, 2006). The autoregressive conditional root (ACR) model (Bec, Rahbek, and Shephard, 2008) is another econometric model that connects to regime-switching models. Many extensions of the regime-switching models have been suggested, adding new possibilities and modeling additional stylized facts of financial time series. For instance, Lux and Morales-Arias (2010) proposes a model that takes long memory and heavy tails of return time series into account, whereas Guidolin and Timmermann (2007), Fu, Wei, and Yang (2014), and Bae, Kim, and Mulvey (2014) apply RSMs to asset allocation and portfolio optimization. RSMs have been applied to pension funds optimization (Hainaut, 2014) and weather derivatives (Elias, Wahab, and Fang, 2014). For recent surveys on the application of RSMs in empirical finance, we refer to Lange and Rahbek (2009) and Guidolin (2011). These models have broader fields of application, covering manpower systems, where both observable and latent sources of dynamic heterogeneity should be accounted for (Guerry, 2011), and reliability analysis (Zhou, Hu, Xu, Chen, and Zhou, 2010).

Here, RSMs are extended to take the clustering structure of the returns of 21 European stock market indexes into account. Stock markets are well-known for presenting cycles, however country idiosyncrasies are also likely to make them differ in their transition between boom and bust. As is illustrated below, the proposed approach is flexible in the sense that it can deal with the specific features of financial time series data, such as asymmetry, kurtosis, and unobserved heterogeneity, an aspect that tends to be neglected. Because we selected a rather large and heterogeneous sample of countries including both developed and emerging countries and both EMU (European Monetary Union) and non-EMU countries, we expect that heterogeneity in market returns due to country idiosyncrasies will show up in the results. For instance, emerging market return distributions tend to show larger deviations from normality, i.e., they are more skewed and have fatter tails (Harvey, 1995). In addition, stock markets are also known to contain asymmetry of volatility, i.e., volatility is higher in negative shocks than positive ones (see, e.g., Ang and Bekaert, 2002) and structural breaks in time, or in other words, regime switching.

The results show that stock markets are better described by three regimes: A high returns, a negative returns, and close to zero regimes that we interpret as a bull, a bear, and a stable regime. This, however, challenges the simplistic view that stock markets should be characterized by two regimes. The characterization of regimes is consistent with several stylized facts such as asymmetry in volatility, i.e., bear regimes are associated with larger volatility than bull regimes. Stock markets are clustered into two groups that are mainly distinguished by the propensity to switch to the bear regime, which includes countries that were more affected by crisis during the period of analysis as well as Eastern European emerging countries that were less integrated with the other European countries.

The paper is structured as follows. Section 2 describes the 21 country financial time series data set that is used throughout this paper. Section 3 presents the statistical framework for the analysis of heterogeneous financial time series. It also discusses parameter estimation by maximum likelihood and model selection issues. Section 4 reports the results obtained for the data set at hand. The paper concludes with a summary of the main findings and a description of possible implications.

The data used in this article are daily closing prices from 27 January 1998 to 31 July 2013 for 21 European stock market indexes drawn from Datastream database.
                        1
                     
                     
                        1
                        Observations from different time zones can create problems of non-synchronization on the analysis, to eliminate such problems we focus on European markets.
                      The series are denominated in US dollars. In total, we have 4010 end-of-the-day observations per country. Let Pit
                      be the observed daily closing price of market i on day t, i = 1, …, n and t = 0, …, T. The daily rates of return are defined as the percentage log-return by yit
                      = 100 × log (Pit
                     /P
                     
                        i, t − 1), t = 1, …, T. This definition which is commonly used in the literature is justified by the fact that for expected small increases (decreases) of value, say r, log (1 + r) ≃ r.

The 21 stock markets are listed in Table 1
                     . Figs. 1
                      and 2
                      depict for six distinct countries the index and returns time series, respectively. As is well known, stock markets follow cycles. In the sample period there were two main periods of global stock market crises. The dot-com bubble bursting that started at the end of 1999 and went on until 2003, and the subprime crisis that had its first signs in the summer of 2007, and made stock markets plummet in September 2008 after the Lehman Brothers bankruptcy. From 2004 to 2007, stock markets registered a strong growth.


                     Fig. 2 depicts stock market returns. Russia and Turkey have the highest level of volatility, which is typical of emerging markets. It is worth to note that in August 1998 Russia defaulted a sovereign bond payment triggering the “ruble crisis” in financial markets. Market features like these seem well-suitable to test our econometric model.


                     Table 1 provides the relevant descriptive statistics for the 21 stock-return series. All markets show non-negative median returns. However, only 18 out of 21 had positive mean returns; that is, Greece, Italy, and Portugal showed negative mean returns. Emerging markets such as Czech Republic and Russia show larger positive mean return. These figures confirm that stock market distributions tend to be negatively skewed.

The 21 analyzed markets show very diverse patterns of dispersion, where the largest standard deviations are found for Russia (3.134) and Turkey (2.983) – both emerging markets – which are almost three times larger than for Switzerland, the stock market with the smallest dispersion with a standard deviation of 1.210. Moreover, the excess kurtosis shows values above 0, indicating heavier tails and more peakness than the normal distribution (which has a kurtosis of 0). The Jarque–Bera test rejects the null hypothesis of normality for each of the 21 stock markets’ returns.


                     Figs. 3
                      and 4
                      depict rolling means and standard deviations (30-day window) for these markets. Although moving averages tend to smooth trends, the main booms and peaks in the stock markets’ returns are still visible. The ruble crisis is visible in Russia and it propagates to neighbor markets such as Poland and Hungary (not shown). All stock markets show a volatility peak during the subprime crisis.

The proposed model for statistical analysis of financial time series – the mixture Gaussian hidden Markov model (MGHMM) – contains three types of variables: a time-varying response variable, a time-constant discrete latent variable, and a time-varying discrete latent variable. Let yit
                         represent the metric response of observation i at time point t, where i ∈ {1, …, n} and t ∈ {1, …, T}. The time-constant and time-varying discrete latent variables are denoted by wi
                         and zit
                        , respectively, where wi
                         ∈ {1, …, S} and zit
                         ∈ {1, …, K}. The latter implies that the number of categories of the two types of latent variables equals S and K, respectively. To make as clear as possible the distinction between the two types of latent variables, we will refer to wi
                         as a latent class and to zit
                         as a latent state or regime. The time-constant latent classes (wi
                        ) can be seen as clusters for which the process under study differs. The time-varying latent variable which has a Markovian transition structure (zit
                        ) is used to flexibly model the distribution of the time-specific responses as well as to capture changes that occur across adjacent time points.


                        Fig. 5
                         provides the graph of the econometric model. The model is defined as:

                           
                              (1)
                              
                                 
                                    f
                                    
                                       (
                                       
                                          
                                             y
                                          
                                          i
                                       
                                       ;
                                       
                                          φ
                                       
                                       )
                                    
                                    =
                                    
                                       ∑
                                       
                                          
                                             w
                                             i
                                          
                                          =
                                          1
                                       
                                       S
                                    
                                    
                                       ∑
                                       
                                          
                                             z
                                             
                                                i
                                                1
                                             
                                          
                                          =
                                          1
                                       
                                       K
                                    
                                    
                                       ∑
                                       
                                          
                                             z
                                             
                                                i
                                                2
                                             
                                          
                                          =
                                          1
                                       
                                       K
                                    
                                    ⋯
                                    
                                       ∑
                                       
                                          
                                             z
                                             
                                                i
                                                T
                                             
                                          
                                          =
                                          1
                                       
                                       K
                                    
                                    f
                                    
                                       (
                                       
                                          w
                                          i
                                       
                                       ,
                                       
                                          z
                                          
                                             i
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          z
                                          
                                             i
                                             T
                                          
                                       
                                       ,
                                       
                                          y
                                          
                                             i
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          y
                                          
                                             i
                                             T
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        where f(wi, z
                        
                           i1, …, ziT, y
                        
                           i1, …, yiT
                        ) is the joint density of latent and observed variables and can be factorized into

                           
                              (2)
                              
                                 
                                    f
                                    
                                       (
                                       
                                          w
                                          i
                                       
                                       )
                                    
                                    f
                                    
                                       (
                                       
                                          z
                                          
                                             i
                                             1
                                          
                                       
                                       |
                                       
                                          w
                                          i
                                       
                                       )
                                    
                                    
                                       ∏
                                       
                                          t
                                          =
                                          2
                                       
                                       T
                                    
                                    f
                                    
                                       (
                                       
                                          z
                                          
                                             i
                                             t
                                          
                                       
                                       |
                                       
                                          z
                                          
                                             i
                                             ,
                                             t
                                             −
                                             1
                                          
                                       
                                       ,
                                       
                                          w
                                          i
                                       
                                       ,
                                       
                                          y
                                          
                                             i
                                             ,
                                             t
                                             −
                                             1
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        by

                           
                              (3)
                              
                                 
                                    
                                       ∏
                                       
                                          t
                                          =
                                          1
                                       
                                       T
                                    
                                    f
                                    
                                       (
                                       
                                          y
                                          
                                             i
                                             t
                                          
                                       
                                       |
                                       
                                          z
                                          
                                             i
                                             t
                                          
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                        Eq. (1) describes f(y
                        
                           i
                        ; 
                           φ
                        ), the (probability) density function associated with the time series of return rates for stock market index i. The right-hand side of this equation shows that we are dealing with a mixture model containing one time-constant latent variable and T time-varying latent variables. The total number of mixture components (or latent classes) equals S·KT
                         which is the product of the number of categories of wi
                         and zit
                         for t = 1, 2, …, T. As in any mixture model, f(y
                        
                           i
                        ; 
                           φ
                        ) results from the marginalization over the latent variables, which yields a weighted summation of class-specific probability densities with the (prior) class membership probabilities or mixture proportions as weights (McLachlan and Peel, 2000). The model described in Eqs. (1)–(3) is strongly related to the mixed latent Markov model proposed in the social sciences literature (van de Pol and Langeheine, 1990; Vermunt, Langeheine, and Bockenholt, 1999). Their model was, however, for categorical instead of continuous variables and for (short) panel data rather than long time series like ours.


                        Fig. 5 and Eqs. (2) and (3) show the conditional independence assumptions implied by the MGHMM, and the resulting factorizations which simplify the model structure. More specifically, conditional on latent classes wi
                         and y
                        
                           i, t − 1, zit
                         is associated only with z
                        
                           i, t − 1 and z
                        
                           i, t + 1 and thus not with the latent states occupied at the other time points – the well-known first-order Markov assumption. Eq. (3) shows that conditionally on zit
                        , the response at occasion t(yit
                        ) is independent of responses at other time points – usually referred to as the local independence assumption – and also independent of the latent classes and the latent states at the other time points.

Two remarks should be made about the first-order Markov assumption for the latent states. First, after marginalizing over wi
                        , the process for the sequence zit
                         is no longer Markovian.
                           2
                        
                        
                           2
                           For example, for a given it the value zit
                               results from a mixture of S components with conditional multinomial distribution. As a mixture of Gaussian distributions is no longer (generally speaking) a Gaussian distribution, the same happens with mixtures of other distributions.
                         Second, the Markov assumption for zit
                         conditionally on wi
                         allows a nonlinear structure for the responses yit
                        . This shows that the first-order Markov assumption is not as restrictive as one may initially think (see Fig. 5). Additionally, within each latent class the transition probabilities between regimes depend of the previous return, and consequently the Markov process is inhomogeneous.

The econometric model described in Eqs. (1)–(3) has three key relevant elements for the analysis of heterogeneous time series and takes into account: (1) time-invariant unobserved heterogeneity in the process under study, (2) serial dependency, and (3) flexible distributions that deviate in terms of skewness and kurtosis from normality (see, e.g., Dias and Wedel, 2004). Unobserved heterogeneity is captured by the time-constant latent variable wi
                        , serial dependencies are captured by the first-order Markov transition process in which the state at time point t depends on the state at time point t − 1 and the inhomogeneous Markov process that depends on the prior observed return, and, finally, flexible distributions of the returns are possible because of the time-specific mixture distribution for the response variable.

As can be seen from Eqs. (2) and (3), the model of interest is characterized by four sets of probability functions:

                           
                              •
                              
                                 f(wi
                                 ) is the probability of belonging to a particular latent class w and πw
                                  = P(Wi
                                  = w);


                                 f(z
                                 
                                    i1|wi
                                 ) is the initial regime probability; that is, the probability of having a particular latent initial state conditional on belonging to latent class w: λkw
                                  = P(Z
                                 
                                    i1 = k|Wi
                                  = w), and 
                                    λ
                                 
                                 
                                    w
                                  is the vector containing initial probabilities in latent class w;


                                 f(zit
                                 |z
                                 
                                    i, t − 1, wi, y
                                 
                                    i, t − 1) is a latent transition probability; that is, the probability of being in a particular regime at time point t conditional on the latent state at time point t − 1, class membership, and observed return at time t − 1; assuming an inhomogeneous transition process, we regress the transition probability on the prior stock return using a logit-link function

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                      
                                                         j
                                                         k
                                                         w
                                                      
                                                   
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      P
                                                      (
                                                      
                                                         Z
                                                         
                                                            i
                                                            t
                                                         
                                                      
                                                      =
                                                      k
                                                      |
                                                      
                                                         Z
                                                         
                                                            i
                                                            ,
                                                            t
                                                            −
                                                            1
                                                         
                                                      
                                                      =
                                                      j
                                                      ,
                                                      
                                                         W
                                                         i
                                                      
                                                      =
                                                      w
                                                      ,
                                                      
                                                         y
                                                         
                                                            i
                                                            ,
                                                            t
                                                            −
                                                            1
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         
                                                            e
                                                            
                                                               
                                                                  γ
                                                                  
                                                                     j
                                                                     k
                                                                     w
                                                                  
                                                                  
                                                                     (
                                                                     0
                                                                     )
                                                                  
                                                               
                                                               +
                                                               
                                                                  γ
                                                                  
                                                                     j
                                                                     k
                                                                     w
                                                                  
                                                                  
                                                                     (
                                                                     1
                                                                     )
                                                                  
                                                               
                                                               
                                                                  y
                                                                  
                                                                     i
                                                                     ,
                                                                     t
                                                                     −
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               ∑
                                                               
                                                                  
                                                                     k
                                                                     ′
                                                                  
                                                                  =
                                                                  1
                                                               
                                                               K
                                                            
                                                            
                                                               e
                                                               
                                                                  
                                                                     γ
                                                                     
                                                                        j
                                                                        
                                                                           k
                                                                           ′
                                                                        
                                                                        w
                                                                     
                                                                     
                                                                        (
                                                                        0
                                                                        )
                                                                     
                                                                  
                                                                  +
                                                                  
                                                                     γ
                                                                     
                                                                        j
                                                                        
                                                                           k
                                                                           ′
                                                                        
                                                                        w
                                                                     
                                                                     
                                                                        (
                                                                        1
                                                                        )
                                                                     
                                                                  
                                                                  
                                                                     y
                                                                     
                                                                        i
                                                                        ,
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where 
                                    
                                       γ
                                       
                                          j
                                          k
                                          w
                                       
                                       
                                          (
                                          0
                                          )
                                       
                                    
                                  and 
                                    
                                       γ
                                       
                                          j
                                          k
                                          w
                                       
                                       
                                          (
                                          1
                                          )
                                       
                                    
                                  are the intercept and slope coefficients of y
                                 
                                    i, t − 1 in the multinomial logit model for the transition from regime j to regime k within latent class w. As usual, identifying constraints on the gamma parameters are needed. The matrix with transition probabilities given w and y
                                 
                                    i, t − 1 is denoted by P
                                 
                                    w
                                 (y
                                 
                                    i, t − 1);


                                 f(yit
                                 |zit
                                 ) is the Gaussian density function for the observed response, which is the probability density of having a particular observed stock return in index i at time point t conditional on the regime occupied at time point t. This distribution is characterized by the vector 
                                    
                                       
                                          
                                             θ
                                          
                                          k
                                       
                                       =
                                       
                                          (
                                          
                                             μ
                                             k
                                          
                                          ,
                                          
                                             σ
                                             
                                                k
                                             
                                             2
                                          
                                          )
                                       
                                    
                                  containing the means (μk
                                 ) and variances (
                                    
                                       σ
                                       
                                          k
                                       
                                       2
                                    
                                 ) for regime k, k = 1, …, K (and invariant across latent classes). The vector 
                                    μ
                                  contains all μk
                                 . Since the marginal distribution is a mixture of densities it defines a flexible model that takes skewness and kurtosis into account.

The (SK + 1)(2K − 1) free parameters of the MGHMM (
                           φ
                        ) include the S − 1 class sizes, the S(K − 1) initial state parameters and 2SK(K − 1) transition probability parameters, and the 2K conditional means and variances of the observed variables.

Various special cases of the MGHMM defined in Eqs. (1)–(3) can be obtained by eliminating one or more of its three main elements, the serial dependency structure, the time-varying latent variables, or the time-constant latent variable. For example, if we assume that there is no serial dependency between the time-varying discrete latent variables – that p(zit
                        |z
                        
                           i, t − 1, wi, y
                        
                           i, t − 1) ≡ p(zit
                        |wi
                        ) – we obtain a model that is called a multilevel or hierarchical mixture model (Vermunt, 2003; 2007). This shows that the MGHMM can be seen as a hierarchical Gaussian mixture model that is expanded with a serial dependency structure.

The hidden Markov or Markov switching model (Baum, Petrie, Soules, and Weiss, 1970; Hamilton, 1989) is the special case of the MGHMM that is obtained by eliminating the time-constant latent variable wi
                         from the model, that is, by assuming that there is no unobserved heterogeneity at the upper level of analysis. This model can be obtained without modifying the formulae, but by simply assuming that S = 1; that is, that all stock markets belong to the same group.

The mixture Gaussian model can be seen as a restricted variant of the MGHMM that is obtained by removing the time-varying latent variables zit
                        , resulting in 
                           
                              f
                              
                                 (
                                 
                                    
                                       y
                                    
                                    i
                                 
                                 ;
                                 
                                    φ
                                 
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    
                                       w
                                       i
                                    
                                    =
                                    1
                                 
                                 S
                              
                              f
                              
                                 (
                                 
                                    w
                                    i
                                 
                                 )
                              
                              
                                 ∏
                                 
                                    t
                                    =
                                    1
                                 
                                 T
                              
                              f
                              
                                 (
                                 
                                    y
                                    
                                       i
                                       t
                                    
                                 
                                 |
                                 
                                    w
                                    i
                                 
                                 )
                              
                           
                        . Note that this model is equivalent to a latent class model for T response variables which are assumed to be conditionally independent within latent classes w. For T = 1 it yields the mixture of (univariate) Gaussian distributions (Dias and Wedel, 2004).

Maximum likelihood (ML) estimation of the parameters of the MGHMM involves maximizing the log-likelihood function: 
                           
                              ℓ
                              
                                 (
                                 
                                    φ
                                 
                                 ;
                                 
                                    y
                                 
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    1
                                 
                                 n
                              
                              log
                              f
                              
                                 (
                                 
                                    
                                       y
                                    
                                    i
                                 
                                 ;
                                 
                                    φ
                                 
                                 )
                              
                              ,
                           
                         a problem that can be solved by means of the Expectation-Maximization (EM) algorithm (Dempster, Laird, and Rubin, 1977).

In the E step, we compute the expected value of the T + 1 latent variables given the observed data and the current provisional estimates of the model parameters. In the M step, standard complete data ML methods are used to update the unknown model parameters using an expanded data matrix with previous expectation as weights. Since the EM algorithm needs to compute and store the S·KT
                         entries of expectations over the latent space for each subject or for each unique data pattern, computation time and computer storage increases exponentially with the number of time points, which makes this algorithm impractical or even impossible to apply with more than a few time points. This explains why models like the one proposed here have been used in social science applications only with very short time series (van de Pol and Langeheine, 1990; Vermunt et al., 1999) and has hampered its application for longer time series (Schmittmann, Visser, and Raijmakers, 2006).

However, for hidden Markov models, a special variant of the EM algorithm has been proposed that is usually referred to as the forward–backward or Baum–Welch algorithm (Baum et al., 1970; Hamilton, 1989). This special algorithm is needed because the model for our data set contains a huge number of entries in the joint posterior latent distribution generated by the T + 1 latent variables. Recall that in our application T is quite large. This means that even for S = 2 and K = 2, the number of entries in the joint posterior distribution is too large to process and store for all n stock markets as has to be done within the standard EM algorithm. The Baum–Welch algorithm circumvents the computation of this joint posterior distribution making use of the conditional independencies implied by the model. Whereas this algorithm was originally proposed for hidden Markov models, here we expand it to deal with mixture (Gaussian) hidden Markov models. This algorithm exploits the conditional independence assumptions implied by the model in order to circumvent the computational issue which affects the traditional EM procedure when the number of time points is high. A detailed description of the extended Baum–Welch algorithm is provided in Appendix A.

Contrary to previous work (e.g., Ang and Bekaert, 2002; Wilfling, 2009; Pagan and Sossounov, 2003), we do not set a priori the number of regimes as it happens, for instance, in the bear–bull market framework (K = 2). Consequently, we have to address simultaneously the estimation/selection of S and K, i.e., how to decide about the number of latent classes and regimes needed. The standard model selection approach when using maximum likelihood estimation is by performing likelihood ratio tests across nested models; here the relevant tests are between models with S − 1 and S classes and between models with K − 1 and K regimes. However, in the context of latent class models this approach is problematic because the null hypothesis under test is defined on the boundary of the parameter space, and consequently the regularity condition of Cramer on the asymptotic properties of the MLE is no longer valid. As an alternative, it has been proposed to use information criteria, mostly for cross-sectional modeling. The basic principle under these criteria is parsimony, which results from the trade-off between model fit and model complexity. A number of model selection criteria have been suggested, the most prominent and widely used being the Bayesian Information Criterion (BIC) of Schwarz (1978) and the Akaike Information Criterion (AIC) of Akaike (1974). More recently, simulation studies have explored the performance of information criteria for longitudinal data (Costa and De Angelis, 2010; Dias, 2007; Dias and Vermunt, 2007). These type of simulation studies compare criteria such as Bayesian information criterion (BIC), the Akaike information criterion (AIC), the AIC3, and the consistent AIC (CAIC) in terms of performance. The overall conclusion is that AIC tends to overfit (see, e.g., Dias and Vermunt, 2007) and BIC performs better for large T (see, e.g., Costa and De Angelis, 2010). Thus, our model selection is based on the BIC. The values of S and K to be selected are the ones that minimize the value of BIC, which is defined as

                           
                              (4)
                              
                                 
                                    
                                       BIC
                                       
                                          S
                                          ,
                                          K
                                       
                                    
                                    =
                                    −
                                    2
                                    
                                       ℓ
                                       
                                          S
                                          ,
                                          K
                                       
                                    
                                    
                                       (
                                       
                                          
                                             φ
                                          
                                          ^
                                       
                                       ;
                                       
                                          y
                                       
                                       )
                                    
                                    +
                                    
                                       N
                                       
                                          S
                                          ,
                                          K
                                       
                                    
                                    log
                                    n
                                    ,
                                 
                              
                           
                        where N
                        
                           S, K
                         is the number of free parameters of the model with S latent classes and K regimes. Note that as indicated by Dias (2007), we use sample size as n in the BIC formula, and thus not nT.

@&#RESULTS@&#

This section reports the results obtained when applying the statistical model described in the previous section to the stock return data set at hand. Because we want to understand the forecasting ability of the model across countries, we split the sample into two parts: the information until the end of 2012 is used for estimation (in-sample), and the information from 2013 is used for forecasting (out-of-sample).

We estimated models using S and K values ranging from one to five, with 500 different sets of random starting values to minimize the effect of local maxima. A solution with two latent classes (S = 2) and three regimes (K = 3) yields the lowest BIC value (log-likelihood = − 145689.56; number of free parameters = 35; and BIC = 291485.68).
                        3
                     
                     
                        3
                        Detailed results on model selection are available from the first author upon request. Since for n = 21 log 21 = 3.04, BIC ≃ AIC3 and also not too far from AIC.
                      This means that the best solution incorporates two types of regime dynamics between the three regimes. This model will therefore be treated as the final model in our analysis.

We start by characterizing the latent states or regimes. Table 2
                      provides information on the three regimes; that is, the average proportion of markets in regime k over time and the mean and variance of the return in each regime. The reported means show that the first regime has negative and the third expected positive returns. On the contrary, in regime 2, the mean return is not significantly different from zero. In the financial jargon regimes 1 and 3 are called bear and bull markets, while regime 2 corresponds to a stable regime in which returns are close to 0. The overall probability of being in regime 1 and 3 equals 0.18 and 0.29, respectively. The most frequently occurring regime with more than half of the time points is the one with an almost null expected return.

The asymmetry in the volatility coefficients is consistent with the pattern in stock markets: bear regimes are associated with larger volatility than bull regimes. Thus, in periods of financial crisis, market prices fall down and have higher volatility. Due to financial markets integration, such events tend to spillover to other markets, the so called financial contagion.
                        4
                     
                     
                        4
                        Some examples are the Asian Flu Crisis that affected Southeastern Asian countries and the Russian Crisis of 1998.
                     
                  


                     Table 3
                      provides the probability of being in one of the three regimes for each of the two latent classes. We observe that in both latent classes the process is in regime 2 most of the time. It can be observed that the two latent classes differ with respect to the bullish regime probability. Latent class 1 tends to spend less time in the bear regime than in the bull one, whereas in latent class 2 happens the opposite; that is, class 2 countries are in the bull regime at only 17.8 percent of the time points, whereas this figure equals 34.6 percent for class 2.


                     Fig. 6
                      depicts the transition probabilities as function of y
                     
                        t − 1 for both latent classes. The probability of exiting regime 1 (high volatility and negative returns) is close to zero when previous returns are negative. As returns become positive, the probability of switching to regime 2 increases. The probability of switching between regimes 1 and 3 is always 0, indicating that regime 2 is in fact an intermediate regime between the crisis and bull regimes. The transition probabilities for regime 2 are close to 0 when returns are close to 0, indicating that the market is likely to continue in regime 2. Negative returns increase the likelihood to switch to regime 1 and positive returns increase the likelihood to switch to regime 3. The probability of moving out of regime 3 is 0 when returns are positive, and becomes large when returns decrease (returns become more negative). Class 1 differs from class 2 in the size of the transition probabilities; that is, the transition probabilities are larger in class 1 than in class 2, and more strongly affected by the previous return. For instance, in latent class 1 the transition probability from regime 1 to regime 2 is higher than in latent class 2. For a value of y
                     
                        i, t − 1 around 20, the probability of transition from regime 1 to regime 2 is close to 1 in latent class 1, whereas in latent class 2 this probability is around 0.25, i.e., regimes are more persistent in latent class 2.


                     Table 4
                      summarizes the results related to the distribution of stock markets across latent classes. The estimated prior class membership probabilities indicate that the probability that a randomly selected stock market belongs to class 1 is 0.66 and to class 2 is 0.34. A more detailed interpretation of the nature of the stock market latent variable is obtained by investigating the posterior class membership probabilities, conditional on the observed data (Table 4). As can be seen, 14 countries are assigned to class 1 and 7 to class 2. Except for Sweden, the class assignment probability is always one, indicating that the classes are fully non-overlapping. Note that even for Sweden the misclassification probability is low, assuming that we assign each stock market to the most likely latent class.

As can be seen, class 1 is composed mainly by European developed financial markets: Austria, Belgium, Czech Republic, Denmark, France, Germany, Ireland, Italy, the Netherlands, Portugal, Spain, the UK and two non-E.U. countries, Norway and Switzerland. Class 2 includes Finland, Greece, Hungary, Poland, Russia, Sweden, and Turkey. While this second group is mainly composed of Eastern European countries, it also includes three countries whose stock markets have been severely affected by economic and financial crisis: Finland, Greece, and Sweden. Note that the countries in class 2 are the ones with more pronounced booms and slumps in volatility. The next paragraphs provide more explanations about of the reasons behind the clustering.


                     Figs. 7
                      and 8 show the regime-switching dynamics for countries belonging to the same latent class. They depict the posterior probability of being in each regime at period t. The figures show that the dynamic patterns of the return indices are remarkably similar for countries within each class and substantially different between the two classes. Fig. 7
                      shows that class 1 stock markets displayed little propensity to switch to the bear regime. We see a long period of bull markets and two main periods of bear markets: the first ranging from the end of 1999 until 2003 with episodic crises and the second representing the subprime crisis. Episodes of bear markets were not very frequent and did not last long, except during the global financial crisis. Countries in class 2 had higher propensity to switch to bear regimes (Fig. 8). Differently from class 1 markets, these stock markets seem more affected by the 2000 crisis. But the subprime crisis affected them in a similar way as the stock markets from class 1. Greece and Hungary, two countries close to bankruptcy due to the sovereign crisis and with a bailout from the IMF, spent a long period in bear markets in the beginning of 2010. The bursting of the dot-com bubble had serious economic implications for Sweden. Ericsson, a large producer of mobile telecommunications equipment and one of the main listed Swedish securities, suffered heavy losses after the dot-com crash in the early 2000s. It shed thousands of jobs, affecting many other consulting companies and start-ups in the IT sector. The stock markets of the two neighbor countries Russia and Finland showed similar dynamics. Between 2003 and 2007, Finland and Sweden had a period of bull market, while Russia tended to switch regularly between bull and bear markets. Finally, Turkey switched very quickly between regimes, most of the time in the intermediate regime and quite often in the bear regime.

Despite initial skepticism about the out-of-sample prediction performance of regime-switching models (Dacco and Satchell, 1999; Engel, 1994), recently De Angelis and Paas (2013) found evidence that regime-switching models may outperform the threshold GARCH model with Student-t innovations both in terms of in-sample and out-of-sample prediction. To evaluate the forecasting ability of the model for each country, we compare the one-day ahead forecast to the actual return. Parameters were estimated with the subsample that goes till the end of 2012 (T = 3857). Thus, the in-sample period is from t = 1 to T, whereas the out-of-sample is from t = T + 1 to T* = 4009. We compare our results with those obtained with a model that is commonly used to analyze stock market indexes, namely the GJR-AR(1)-GARCH(1,1) model (Glosten, Jagannathan, and Runkle, 1993) with Student-t innovations which captures both asymmetry and non-normality. Our RSM shows better in-sample prediction than the GARCH model. In terms of out-sample prediction, both models show similar performance. Appendix B gives a detailed description of the relevant GARCH model, and the results obtained with this model.

The last important question to address is market synchronization. Measurement of synchronization of stock markets using cross-correlations of returns is rather popular, but crisis periods may yield very large outliers in returns that introduce noise and inflate similarities between markets. To measure synchronization and co-movement in the 21 stock markets, we compute the association between markets using the posterior probability of being in a given regime. In other words, synchronization is measured by the similarity of markets with respect to the likelihood of being in the same regime.

Let 
                        
                           
                              α
                              ^
                           
                           
                              i
                              t
                              k
                           
                        
                      be the estimated posterior probability that market i in period t will be in regime k. To obtain a number in the full range of real numbers, this probability is expressed using the logit transformation:

                        
                           (5)
                           
                              
                                 
                                    logit
                                    
                                       i
                                       t
                                       k
                                    
                                 
                                 =
                                 log
                                 
                                    (
                                    
                                       
                                          
                                             α
                                             ^
                                          
                                          
                                             i
                                             t
                                             k
                                          
                                       
                                       
                                          1
                                          −
                                          
                                             
                                                α
                                                ^
                                             
                                             
                                                i
                                                t
                                                k
                                             
                                          
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     Synchronization is quantified as the product-moment correlation between two markets’ posterior regime logits. This transformation is needed as the probabilities are between 0 and 1, and the Pearson correlation operates on the real line. Our logit-based measure does not suffer from distortion caused by outliers because it filters out extreme observations of returns. The measure gets close to 1 if markets tend to share the same regime.


                     Table 5
                      shows the correlations between stock markets using this measure applied to regime 2, the most frequent one. Countries belonging to class 1 show a high level of synchronization, but they are less synchronized with countries in the other latent class. Class 2 contains more heterogeneous countries: Turkey and Russia have low synchronization with all markets; Sweden and Finland are strongly synchronized; Greece shows strong synchronization with all EMU (European Monetary Union) countries, most of which are in the other group. Thus, it is worth to note that even if countries are not in the same class, returns can be synchronized in the sense that stock markets tend to be in the same regime at the same time.

@&#CONCLUSION@&#

The identification of groups or classes of financial assets is key in the field of portfolio management. One of the first decisions in the portfolio construction process is the asset allocation decision, which consists of allocating investments among different asset classes in order to optimize the risk/reward trade-off. Our statistical methodology is a powerful tool to identify groups of homogeneous financial assets.

This paper introduced a model-based clustering technique as a data analytic tool for financial time series analysis. The proposed model takes into account both time-constant unobserved heterogeneity between and hidden regimes within time series. Moreover, the flexible modeling of observed responses using a mixture of normal distributions makes it straightforward to capture almost any departure from the normality. For parameter estimation using maximum likelihood, a generalization of the Baum–Welch algorithm for the HMM to the mixture HMM was used.

In the analysis of a sample of 21 stock markets, the best fitting model was the one with two groups. The groups clearly reveal distinguished stock market dynamics, that is, in the switching patterns between the three regimes.

The results obtained with our approach seem to have an one-to-one correspondence with the stock market behavior. First, regimes are consistent with the asymmetry of volatility: the bear regime presents higher volatility than the bull regime. Second, periods of market crises are clearly distinguished from periods of market booms and stability. Third, less developed markets tend to be assigned with a higher probability to the regime associated with higher volatility. Fourth, the transition probabilities are consistent with the persistency of volatility. Overall, the econometric approach is coherent with many stylized facts in finance.

Moreover, the specification of the correct distribution for returns has important implications. The fact that risk models do not account for non-zero higher moments might cause bias in hedging strategies and concomitantly great losses for financial institutions. For instance, it is widely acknowledged that financial institutions have gradually been adopting market risk models that rely more on historic or back simulations instead of symmetric distributions. Portfolio decisions also need to incorporate information about those higher moments. Bekaert, Erb, Harvey, and Viskanta (1998) analyzed the economic impact of taking into account skewness and kurtosis on asset allocation. Their results based on simulations show that investment weights are increased toward the asset with positive skewness (everything constant) and with higher kurtosis (holding skewness positive and constant). The semiparametric nature of the proposed MGHMM allows a flexible specification of the distribution of the observed returns that goes beyond the Gaussian distribution.

Results of the application show that our statistical methodology performs well in capturing the different regime dynamics of stock markets. It clearly distinguishes two groups of countries with different observed patterns. It also goes beyond the traditional approaches of categorizing, for instance, countries in developed and emerging market based on GDP per capita (followed by the World Bank) or credit risk ratings as it is directly based on daily market returns. This methodology highlights distinct dynamics of markets due to their idiosyncrasies, i.e., their arise endogenously. Standard approaches fail to incorporate this phenomenon in asset allocation decisions. For instance, in asset allocation decisions, investment in assets with similar “statistical” properties is redundant and can lead to the destruction of portfolio value. In other words, in the traditional mean-variance framework values do not span the mean-variance frontier and do not enhance the risk-return trade-off of the portfolio. In addition, trading costs of investing in “redundant assets” also erodes portfolio value. Additionally, understanding cycles in stock markets is key because portfolio allocation strategies are regime dependent (Ang and Bekaert, 2002).

@&#ACKNOWLEDGMENTS@&#

The authors would like to thank the editor and two anonymous reviewers for their constructive comments, which helped us to improve the manuscript and the Fundação para a Ciência e Tecnologia (Portugal) for its financial support (PTDC/EGE-GES/103223/2008).

Because of the conditional independence assumption implied by our statistical model, in the M step of the EM algorithm one needs only the distributions f(wi
                     |y
                     
                        i
                     ), f(wi, zit
                     |y
                     
                        i
                     ), and f(wi, z
                     
                        i, t − 1, zit
                     |y
                     
                        i
                     ). The Baum–Welch algorithm obtains these quantities directly rather than first computing the joint distribution of the latent variables given the observed data and parameter estimates (E step) and subsequently collapsing over the remaining dimensions as would be done in the standard EM algorithm (Baum et al., 1970). The two key components of the Baum–Welch algorithm are the forward probabilities 
                        
                           α
                           
                              i
                              w
                              
                                 z
                                 t
                              
                           
                        
                      and the backward probabilities 
                        
                           β
                           
                              i
                              w
                              
                                 z
                                 t
                              
                           
                        
                     . Because of our generalization to the mixture case, we need one additional quantity γiw
                     . These three quantities are defined as follows:

                        
                           (A.1)
                           
                              
                                 
                                    α
                                    
                                       i
                                       w
                                       
                                          z
                                          t
                                       
                                    
                                 
                                 =
                                 f
                                 
                                    (
                                    
                                       z
                                       
                                          i
                                          t
                                       
                                    
                                    ,
                                    
                                       y
                                       
                                          i
                                          1
                                       
                                    
                                    ,
                                    ⋯
                                    ,
                                    
                                       y
                                       
                                          i
                                          t
                                       
                                    
                                    |
                                    
                                       w
                                       i
                                    
                                    ,
                                    
                                       y
                                       
                                          i
                                          ,
                                          t
                                          −
                                          1
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           (A.2)
                           
                              
                                 
                                    β
                                    
                                       i
                                       w
                                       
                                          z
                                          t
                                       
                                    
                                 
                                 =
                                 f
                                 
                                    (
                                    
                                       y
                                       
                                          i
                                          ,
                                          t
                                          +
                                          1
                                       
                                    
                                    ,
                                    ⋯
                                    ,
                                    
                                       y
                                       
                                          i
                                          T
                                       
                                    
                                    |
                                    
                                       z
                                       
                                          i
                                          t
                                       
                                    
                                    ,
                                    
                                       w
                                       i
                                    
                                    ,
                                    
                                       y
                                       
                                          i
                                          ,
                                          t
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           (A.3)
                           
                              
                                 
                                    γ
                                    
                                       i
                                       w
                                    
                                 
                                 =
                                 f
                                 
                                    (
                                    
                                       w
                                       i
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       i
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     Using 
                        
                           
                              α
                              
                                 i
                                 w
                                 
                                    z
                                    t
                                 
                              
                           
                           ,
                        
                     
                     
                        
                           
                              β
                              
                                 i
                                 w
                                 
                                    z
                                    t
                                 
                              
                           
                           ,
                        
                      and γiw
                     , one can obtain the relevant marginal posteriors as follows:

                        
                           (A.4)
                           
                              
                                 f
                                 
                                    (
                                    
                                       w
                                       i
                                    
                                    |
                                    
                                       
                                          y
                                       
                                       i
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       γ
                                       
                                          i
                                          w
                                       
                                    
                                    
                                       f
                                       (
                                       
                                          
                                             y
                                          
                                          i
                                       
                                       )
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (A.5)
                           
                              
                                 f
                                 
                                    (
                                    
                                       w
                                       i
                                    
                                    ,
                                    
                                       z
                                       
                                          i
                                          t
                                       
                                    
                                    |
                                    
                                       
                                          y
                                       
                                       i
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          α
                                          
                                             i
                                             w
                                             
                                                z
                                                t
                                             
                                          
                                       
                                       
                                          β
                                          
                                             i
                                             w
                                             
                                                z
                                                t
                                             
                                          
                                       
                                    
                                    
                                       f
                                       (
                                       
                                          
                                             y
                                          
                                          i
                                       
                                       )
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (A.6)
                           
                              
                                 f
                                 
                                    (
                                    
                                       w
                                       i
                                    
                                    ,
                                    
                                       z
                                       
                                          i
                                          ,
                                          t
                                          −
                                          1
                                       
                                    
                                    ,
                                    
                                       z
                                       
                                          i
                                          t
                                       
                                    
                                    |
                                    
                                       
                                          y
                                       
                                       i
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          γ
                                          
                                             i
                                             w
                                          
                                       
                                       
                                          α
                                          
                                             i
                                             w
                                             
                                                z
                                                
                                                   t
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                       f
                                       
                                          (
                                          
                                             z
                                             
                                                i
                                                t
                                             
                                          
                                          |
                                          
                                             z
                                             
                                                i
                                                ,
                                                t
                                                −
                                                1
                                             
                                          
                                          ,
                                          
                                             w
                                             i
                                          
                                          ,
                                          
                                             y
                                             
                                                i
                                                ,
                                                t
                                                −
                                                1
                                             
                                          
                                          )
                                       
                                       f
                                       
                                          (
                                          
                                             y
                                             
                                                i
                                                t
                                             
                                          
                                          |
                                          
                                             z
                                             
                                                i
                                                t
                                             
                                          
                                          ,
                                          
                                             w
                                             i
                                          
                                          )
                                       
                                       
                                          β
                                          
                                             i
                                             w
                                             
                                                z
                                                t
                                             
                                          
                                       
                                    
                                    
                                       f
                                       (
                                       
                                          
                                             y
                                          
                                          i
                                       
                                       )
                                    
                                 
                              
                           
                        
                     where 
                        
                           f
                           
                              (
                              
                                 
                                    y
                                 
                                 i
                              
                              )
                           
                           =
                           
                              ∑
                              
                                 
                                    w
                                    i
                                 
                                 =
                                 1
                              
                              S
                           
                           
                              γ
                              
                                 i
                                 w
                              
                           
                           ,
                        
                      and f(zit
                     |z
                     
                        i, t − 1, wi, y
                     
                        i, t − 1) and f(yit
                     |zit, wi
                     ) are model probabilities. The key element of the forward–backward algorithm is that the 
                        
                           α
                           
                              i
                              w
                              
                                 z
                                 t
                              
                           
                        
                      and 
                        
                           β
                           
                              i
                              w
                              
                                 z
                                 t
                              
                           
                        
                      are computed using recursive schemes. The forward recursion for 
                        
                           α
                           
                              i
                              w
                              
                                 z
                                 t
                              
                           
                        
                      is:

                        
                           (A.7)
                           
                              
                                 
                                    α
                                    
                                       i
                                       w
                                       
                                          z
                                          1
                                       
                                    
                                 
                                 =
                                 f
                                 
                                    (
                                    
                                       z
                                       
                                          i
                                          1
                                       
                                    
                                    |
                                    
                                       w
                                       i
                                    
                                    )
                                 
                                 f
                                 
                                    (
                                    
                                       y
                                       
                                          i
                                          1
                                       
                                    
                                    |
                                    
                                       z
                                       
                                          i
                                          1
                                       
                                    
                                    ,
                                    
                                       w
                                       i
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           (A.8)
                           
                              
                                 
                                    α
                                    
                                       i
                                       w
                                       
                                          z
                                          t
                                       
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       ∑
                                       
                                          
                                             z
                                             
                                                i
                                                ,
                                                t
                                                −
                                                1
                                             
                                          
                                          =
                                          1
                                       
                                       K
                                    
                                    
                                       α
                                       
                                          i
                                          w
                                          
                                             z
                                             
                                                t
                                                −
                                                1
                                             
                                          
                                       
                                    
                                    f
                                    
                                       (
                                       
                                          z
                                          
                                             i
                                             t
                                          
                                       
                                       |
                                       
                                          z
                                          
                                             i
                                             ,
                                             t
                                             −
                                             1
                                          
                                       
                                       ,
                                       
                                          w
                                          i
                                       
                                       ,
                                       
                                          y
                                          
                                             i
                                             ,
                                             t
                                             −
                                             1
                                          
                                       
                                       )
                                    
                                    ]
                                 
                                 f
                                 
                                    (
                                    
                                       y
                                       
                                          i
                                          t
                                       
                                    
                                    |
                                    
                                       z
                                       
                                          i
                                          t
                                       
                                    
                                    ,
                                    
                                       w
                                       i
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     for t = 2 up to t = T. The backward recursion for 
                        
                           β
                           
                              i
                              w
                              
                                 z
                                 t
                              
                           
                        
                      is:

                        
                           (A.9)
                           
                              
                                 
                                    β
                                    
                                       i
                                       w
                                       
                                          z
                                          T
                                       
                                    
                                 
                                 =
                                 1
                                 ,
                              
                           
                        
                     
                     
                        
                           (A.10)
                           
                              
                                 
                                    β
                                    
                                       i
                                       w
                                       
                                          z
                                          t
                                       
                                    
                                 
                                 =
                                 
                                    ∑
                                    
                                       
                                          z
                                          
                                             i
                                             ,
                                             t
                                             +
                                             1
                                          
                                       
                                       =
                                       1
                                    
                                    K
                                 
                                 
                                    β
                                    
                                       i
                                       w
                                       
                                          z
                                          
                                             t
                                             +
                                             1
                                          
                                       
                                    
                                 
                                 f
                                 
                                    (
                                    
                                       z
                                       
                                          i
                                          ,
                                          t
                                          +
                                          1
                                       
                                    
                                    |
                                    
                                       z
                                       
                                          i
                                          t
                                       
                                    
                                    ,
                                    
                                       w
                                       i
                                    
                                    ,
                                    
                                       y
                                       
                                          i
                                          ,
                                          t
                                       
                                    
                                    )
                                 
                                 f
                                 
                                    (
                                    
                                       y
                                       
                                          i
                                          ,
                                          t
                                          +
                                          1
                                       
                                    
                                    |
                                    
                                       z
                                       
                                          i
                                          ,
                                          t
                                          +
                                          1
                                       
                                    
                                    ,
                                    
                                       w
                                       i
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     for t = T − 1 down to t = 1. The quantity γiw
                      is obtained as:

                        
                           (A.11)
                           
                              
                                 
                                    γ
                                    
                                       i
                                       w
                                    
                                 
                                 =
                                 
                                    ∑
                                    
                                       
                                          z
                                          
                                             i
                                             t
                                          
                                       
                                       =
                                       1
                                    
                                    K
                                 
                                 f
                                 
                                    (
                                    
                                       w
                                       i
                                    
                                    )
                                 
                                 
                                    α
                                    
                                       i
                                       w
                                       
                                          z
                                          t
                                       
                                    
                                 
                                 
                                    β
                                    
                                       i
                                       w
                                       
                                          z
                                          t
                                       
                                    
                                 
                                 ,
                              
                           
                        
                     for any t. So, first we obtain 
                        
                           α
                           
                              i
                              w
                              
                                 z
                                 t
                              
                           
                        
                      and 
                        
                           β
                           
                              i
                              w
                              
                                 z
                                 t
                              
                           
                        
                      for each time point and subsequently we obtain γiw
                     . Next, we compute f(wi
                     |y
                     
                        i
                     ), f(wi, zit
                     |y
                     
                        i
                     ), and f(wi, z
                     
                        i, t − 1, zit
                     |y
                     
                        i
                     ) using Eqs. (A.4)–(A.6). In the M step, these quantities are used to obtain new estimates for the model parameters appearing in Eqs. (2) and (3) using standard methods.

Similar recursive schemes have been proposed for obtaining the gradient vector and the observed information matrix (Lystig and Hughes, 2002). These can be used to maximize the log-likelihood using the Newton–Raphson algorithm.

Let e
                        
                           it
                         be the vector containing the probability of the process being in a particular regime at time point t, conditional on model parameters and information up to t − 1. The predicted values 
                           
                              
                                 
                                    e
                                 
                                 ^
                              
                              
                                 i
                                 t
                              
                           
                         and 
                           
                              
                                 
                                    y
                                    ^
                                 
                                 
                                    i
                                    t
                                 
                              
                              ,
                           
                         conditional on stock market i being in latent class w, is obtained by the following recursive expressions:

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   e
                                                
                                                ^
                                             
                                             
                                                i
                                                1
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      λ
                                                   
                                                   ^
                                                
                                                
                                                   w
                                                
                                                T
                                             
                                             ,
                                             
                                             
                                             t
                                             =
                                             1
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   e
                                                
                                                ^
                                             
                                             
                                                i
                                                t
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      e
                                                   
                                                   ^
                                                
                                                
                                                   i
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   APTARABOLD
                                                   
                                                      P
                                                      ^
                                                   
                                                
                                                w
                                             
                                             
                                                (
                                                
                                                   y
                                                   
                                                      i
                                                      ,
                                                      t
                                                      −
                                                      1
                                                   
                                                
                                                )
                                             
                                             ,
                                             
                                             
                                             t
                                             >
                                             1
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                y
                                                ^
                                             
                                             
                                                i
                                                t
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      e
                                                   
                                                   ^
                                                
                                                
                                                   i
                                                   t
                                                
                                             
                                             
                                                
                                                   μ
                                                
                                                ^
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        In case of a single time series and a homogeneous Markov process, this recursion reduces to the set of equations given in Hamilton (1993); 1994). Our forecasting tool adds two elements to the traditional forecasting by regime-switching models: first, the forecasts are done simultaneously for each cross-section, which adds robustness to the process; second, by allowing for an inhomogeneous process (by conditioning on the returns at time t − 1) the forecasts are tailored for each stock market i at time t.

The GJR-AR(1)-GARCH(1,1) model (Glosten et al., 1993) is defined by an autoregressive process of order 1

                           
                              (B.1)
                              
                                 
                                    
                                       
                                          
                                             
                                                y
                                                
                                                   i
                                                   t
                                                
                                             
                                             =
                                             
                                                μ
                                                i
                                             
                                             +
                                             
                                                ϕ
                                                i
                                             
                                             
                                                y
                                                
                                                   i
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             +
                                             
                                                u
                                                
                                                   i
                                                   t
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where uit
                         = σit
                        ɛ
                           it
                         and the variance equation is

                           
                              (B.2)
                              
                                 
                                    
                                       
                                          
                                             
                                                σ
                                                
                                                   i
                                                   t
                                                
                                                2
                                             
                                             =
                                             
                                                κ
                                                i
                                             
                                             +
                                             
                                                γ
                                                i
                                             
                                             
                                                σ
                                                
                                                   i
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                                2
                                             
                                             +
                                             
                                                α
                                                i
                                             
                                             
                                                u
                                                
                                                   i
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                                2
                                             
                                             +
                                             
                                                ξ
                                                i
                                             
                                             I
                                             
                                                (
                                                
                                                   u
                                                   
                                                      i
                                                      ,
                                                      t
                                                      −
                                                      1
                                                   
                                                
                                                <
                                                0
                                                )
                                             
                                             
                                                u
                                                
                                                   i
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                                2
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where the indicator function It
                        (u
                        
                           i, t − 1 < 0) equals 1 if u
                        
                           i, t − 1 < 0 and 0 otherwise. Thus, the leverage coefficient gives additional weight to negative innovations. The conditional distribution of errors (ɛ
                           it
                        ) is a Student-t with more than 2 degrees of freedom. This GARCH model was estimated for each stock market separately. For sake of space, these results are not reported here but are available from the first author.

The in-sample and out-of-sample fit measures are the mean square error (MSE) and the mean absolute error (MAE), both described in Table B.1
                        .


                        Table B.2
                         summarizes the in-sample and out-of-sample forecasting results. As can be seen, the model performs better for the out-of-sample period than for the in-sample period. This can be explained by the fact that the in-sample period contained the global financial crisis for which prediction errors were large. On the other hand, the calm period of first semester of 2013 (part of out-of-sample period) was described very well. We can also compare the forecasting accuracy across countries, and define a ranking of market uncertainty. For example, Switzerland is the stock market with the lowest in-sample error, whereas the United Kingdom has the lowest out-of-sample error. On the other extreme, Russia and Turkey tend to have high forecasting errors. For some countries the out-of-sample ranking is lower (relatively better prediction) than the in-sample ranking (e.g., Finland and Hungary), whereas for others the reverse applies (e.g., Greece).

In terms of competing models, we conclude that our model performs better in-sample than the AR(1)-GJR-GARCH(1,1) and shows similar out-of-sample performance. These results open promising avenues for further research and developments in terms of model forecasting.

@&#REFERENCES@&#

