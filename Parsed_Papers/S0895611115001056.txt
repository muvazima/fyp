@&#MAIN-TITLE@&#Mapping and characterizing endometrial implants by registering 2D transvaginal ultrasound to 3D pelvic magnetic resonance images

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           We propose a deformable slice-to-volume registration method to map a 2D TVUS into a 3D MR volume.


                        
                        
                           
                           The method uses curve to surface correspondences through a variational one-step ICP.


                        
                        
                           
                           This fusion technique localizes endometriosis with respect to the patient's anatomy.


                        
                        
                           
                           Our method maps the TVUS planar image to a curved 2D surface in MR volume.


                        
                        
                           
                           One-step ICP shows less sensitivity to increment of deformation and slant.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Endometriosis

Iterative closest point

Slice-to-volume registration

Multi-modality

Fusion

Localization

@&#ABSTRACT@&#


               
               
                  We propose a new deformable slice-to-volume registration method to register a 2D Transvaginal Ultrasound (TVUS) to a 3D Magnetic Resonance (MR) volume. Our main goal is to find a cross-section of the MR volume such that the endometrial implants and their depth of infiltration can be mapped from TVUS to MR. The proposed TVUS-MR registration method uses contour to surface correspondences through a novel variational one-step deformable Iterative Closest Point (ICP) method. Specifically, we find a smooth deformation field while establishing point correspondences automatically. We demonstrate the accuracy of the proposed method by quantitative and qualitative tests on both semi-synthetic and clinical data. To generate semi-synthetic data sets, 3D surfaces are deformed with 4–40% degrees of deformation and then various intersection curves are obtained at 0–20° cutting angles. Results show an average mean square error of 5.7934±0.4615mm, average Hausdorff distance of 2.493±0.14mm, and average Dice similarity coefficient of 0.9750±0.0030.
               
            

@&#INTRODUCTION@&#

Endometriosis is a poorly understood, multifocal gynaecological disease that can affect women of any age. The term endometriosis is derived from the word endometrium. It is the tissue that lines the inside lining of the uterus and has an ability to enhance and recede cyclically, in response to oestrogen. More specifically, this tissue builds up and is shed each month and discharged as menstrual flow at the end of each cycle. However, the endometrial tissue can sometimes grow or spread in abnormal ways. In endometriosis, tissues that resemble endometrium are found outside the uterus, typically in the pelvic area [1]. During a woman's menstrual cycle, these tissues respond to the growth and shedding signals as the ones inside the uterine cavity, resulting in internal bleeding. These areas can get irritated and sore. The endometrial tissues can also form scar tissues due to an immune response or fluid-filled sacs. These endometrial tissue sites may develop into what are called lesions, implants, nodules, or growths. The symptoms of endometriosis vary widely from patient to patient, and can run the gamut from none to severe. Consequently, endometriosis may cause chronic pelvic pain, dysmenorrhea, dyspareunia, and infertility [2].

Many patients with endometriosis experience an average delay of 8 years from presenting symptoms to diagnosis and treatment [3]. The diagnosis should not just reveal the existence of the disease, but should also include information such as depth of infiltration and exact location with respect to the patient's anatomy. Surgery benefits from this information since completeness of excision depends highly on the precision of diagnosis [4]. Generally, endometriosis may be diagnosed by performing medical imaging tests. The imaging modalities that have been mostly used to determine the stage of endometriosis are TVUS, MR, and laparoscopy. Fig. 1
                      shows examples of these imaging modalities. Unlike MR and TVUS, in laparoscopy, diagnosis is confirmed intraoperatively. This imaging test is the gold standard for the diagnosis of subtle endometrial lesions. In the case of deep infiltrating endometriosis, the value of laparoscopy is limited, as it does not allow the surgeon to see the endometrial implants that are located inside or under the organs and to quantify the depth of infiltration. TVUS and MR imaging are tailored to avoid these drawbacks.

TVUS imaging is a reliable method for detecting small endometrial implants and estimating their depth of infiltration. TVUS images are obtained using a two-dimensional array transducer that locally deforms the organs’ shape, due to the probe's pressure, and captures a planar image. The main TVUS limitations include its limited field of view and low signal to noise ratio. MR scanning is used as a complimentary examination, since it reveals the patient's pelvic anatomy and large endometrial implants, and gives higher resolution. However, it cannot show the small endometrial implants and their depth of infiltration.

Currently, by visually comparing these two imaging modalities, the radiologists are faced with an overwhelming amount of information. In fact, this is not an easy task as: (1) there is a local deformation between the two modalities, (2) in many TVUS data, the implants’ neighbouring organs are only partially visible due to the small field of view, and (3) the tissues that are exhibited in both MR and TVUS images may not belong to the same slice. To ease the task of the medical experts in both interpretation and decision-making, we need to move towards more comprehensive visualization techniques. Thus, an accurate fusion between TVUS and MR images is needed to generate an augmented MR image. This comprehensive image must contain a patient-specific organ model, the location and shape of endometrial implants as well as their depth of infiltration in the host tissue. This information will help gynaecologists to determine a better intra-operative plan which may improve the precision of surgery by reducing the trauma done to healthy tissues and avoiding under-cutting the implants, which mostly causes recurrence [4].

The TVUS-MR registration and fusion is a difficult technical problem due to the large disparity in gray-level intensities (multi-modality), different dimensionality, soft tissue deformations, and the limited field of view and low signal to noise ratio of TVUS images. Before we describe our method to register these two modalities, we summarize related research from the current literature.

@&#RELATED WORK@&#

To the best of our knowledge, there is no state-of-the-art algorithm to register 2D Ultrasound (US) images with 3D MR volumes. Therefore, we review the current literature related to US-MR image registration for other settings (2D/2D and 3D/3D) and provide a brief survey on multidimensional medical image registration.

Image registration techniques can be roughly divided into two categories: (1) intensity-based and (2) feature-based. A general survey of deformable image registration may be found in [5–8], while a thorough categorization of deformable medical image registration techniques is presented in [9].

US-MR registration is not an easy task as: (1) the available organs in both modalities have different appearances and (2) the initial correspondences between geometric shapes are unknown. To tackle these difficulties, various 2D/2D (e.g. [10–14]) or 3D/3D (e.g. [15–18]) image registration strategies have been proposed. When using a 2D US scanner, the existing methods mostly assume that the 2D US slice is parallel to one of the MR slices. With this assumption, one is able to select the corresponding 2D MR slice from the MR volume. The selection of the 2D MR slice can be achieved automatically with the use of an Electro Magnetic (EM) tracker attached to the US probe during the acquisition. This gives the spatial position of the US slice. It is then possible to estimate an approximate position of the US slice in the MR volume [19–21]. However, EM trackers are not available in most hospitals in Europe, so that in most of the methods, an expert must search for the best MR slice that matches the corresponding US image.


                           Intensity-based methods. Generally, intensity-based US-MR registration methods consist of minimizing an energy function of two terms: (1) a data term that consists of an intensity measure (e.g. Mutual Information (MI), Cross Correlation (CC), and Linear Correlation of Linear Combination (LC2)) and (2) a smoothing term that controls the regularity of the deformation field. The advantage of using an intensity-based method is that it can directly use the image intensity information, without segmentation or user interaction, and thus can be achieved fully automatically. Among intensity-based techniques, the methods relying on MI have been broadly used to align US images to MR data (e.g. [10]). However, MI-based US-MR registration method may easily fail as the joint probability density function is too sparse, and there are very few pixels to calculate MI robustly. To cope with this problem, Fuerst et al. [22] propose 2D/2D and 3D/3D registration algorithms using the similarity measure LC2 to align either 2D US slices or US volumes with Neuro MR images. To achieve this, they assume that the US intensity value of every pixels/voxels is either corrected with the MR intensity value or with the MR gradient magnitude. Thereafter they compute a residual between the US and MR images and optimize the cost function using Bounded Optimization BY Quadratic Approximation [23], which internally estimates own derivative approximations. The usefulness of this strategy is case-dependent as it works with the assumption of intensity or gradient magnitude correction. In the case of brain, their assumption is sufficient as there is enough correlation. However in TVUS-MR registration, the correlation between these images is limited [24], so that a new set of assumption might be needed.


                           Feature-based methods. To solve US-MR registration, feature-based methods have been mainly used as an alternative. The main advantage of these methods is that since the set of identified features is sparse, compared to the original image content, the feature-based method has very fast optimization procedures.

Reynier et al. [15] propose a surface-based registration method for prostate brachytherapy. In their method, the prostate from the MR and US volumes is manually segmented and then the segmented surfaces are used to manually establish point correspondences. Elastic registration is used to estimate the deformation between the two modalities. In this paper, the deformation is modelled using an octree (adaptive resolution) spline [25] and the optimization is performed with the Levenberg-Marquardt algorithm. A limitation of this method is that dense point correspondences are manually determined by an expert, which is a time consuming process as well as being error prone. Therefore, to overcome these limitations, various semi-automatic (e.g. [26,27]), and automatic (e.g. [11–13]) registration strategies have been proposed.

In general, to register a 3D MR data to a 2D US image, methods in the state-of-the-art require the selection of a 2D MR slice and use 2D/2D deformable image registration. This is a limitation, since a US image generally – at least in our case – intersects with multiple MR slices as it is not exactly parallel to any of the MR directions; the problem is thus clearly a multidimensional.

Multidimensional registration is a vital task in medical applications. In a surgical and radiological context, the precise knowledge of position (e.g. position of the surgical instruments or malignant tissues) is important. With the help of registration, the experts can obtain such information and benefit from easier and better guidance in surgery. Here, we provide a brief summary of some relevant registration techniques in the context of treatment, image-guided intervention, and diagnosis. Most of the existing methods try to register 3D pre-operative data such as Computed Tomography (CT), MR, CT Angiography (CTA), to the 2D intra-intervention data including projective X-ray, CT-fluoroscopy, and optical images. Although our problem context is different, some of these methods are relevant as they try to register multidimensional data.

Multidimensional registration may refer either to registration of projective data to 3D data (e.g. a 2D projective X-ray image with 3D CT images [28–30]) or to register a single tomographic slice to 3D volumetric data (e.g. a 2D US slice with 3D CT images [31]). The first case, known as projective registration, tries to find correspondences between a 2D image and a projection of a volume to planes. This approach assumes the knowledge of the projection from 3D to 2D and uses this information to circumvent a 3D volume. However, in our problem, the cutting plane for TVUS is unknown and the projection is not available. Furthermore, we have an unknown deformation between the 3D and 2D objects. We assume the availability of segmentation to estimate the cutting plane and the deformation between objects.

The second case, which is known as slice-to-volume registration, seeks to find correspondences between a 2D image and a cross-section of volume by a plane or a warped surface. One way to solve slice-to-volume registration is to use a compounding technique [32–34]. For example, Heldmann et al. [35] register a CT volume to US slices using this technique. In this manner, the US slice is compounded into volume by interpolation and then a 3D/3D image registration method is employed. However, they practically show that this technique cannot provide reasonable results. They also reveal that matching a CT volume to artificially reconstructed US volume does not provide comprehensive information for the surgeon. Therefore, other approaches have been used to solve the slice-to-volume registration problem.


                           Intensity-based methods. Fei et al. [36] investigate intensity-based registration methods to rigidly align real time interventional MR image slices with high resolution preoperative MR volume. Their algorithm uses for interventional MR-guided radio frequency thermal ablation of prostate cancer. They use multi-resolution and multi-start strategies with two intensity similarity measures to avoid local maxima. At each resolution, the multi-start strategy is used to restart the registration process with randomly perturbed parameters. MI and CC are used as similarity measures. The correlation coefficient is used at two lower resolutions whereas MI is used at full resolution. This is due to the fact that at low resolution, MI surfaces are noisy and contain many local maxima. On the other hand, at full resolution MI has a sharper peak than correlation coefficient. Ferrante et al. [37] propose a deformable intensity-based mapping algorithm between a 2D MR slice and a 3D MR volume. They try to find a linear plane transformation and an in-plane deformation field. This is achieved by using Markov Random Fields. The existing methods mostly rely on an intensity-based similarity measure, but TVUS-MR registration with an intensity similarity measure may easily fail because this approach assumes that there is a sufficient correlation between these images [24].


                           Feature-based methods. To tackle our registration problem, we have chosen to pursue and develop a method based on corresponding geometric features between two images. Dalvi et al. [38] propose a slice-to-volume registration technique to rigidly register 2D MR images to 3D MR volumes of the human brain. Their algorithm extracts phase congruency image features that are then matched using ICP [39]. However, in order to estimate the deformation between two modalities, establishing point correspondences just at each MR slice is not sufficient due to the large MR inter-slice spacing. To solve this problem, the boundary of organs in each MR slice can be segmented and then a 3D surface may be reconstructed. This fills the MR inter-slice spacing by geometric information. Therefore, we chose to use contour to surface correspondences.

The aim of this work is to localize and characterize
                           1
                        
                        
                           1
                           The size and shape of the small endometrial implant as well as its depth of infiltration can be precisely defined with respect to the patient's anatomy after registration. These information are required to permit the characterization of the endometrial implant.
                         endometrial implants in volumetric MR data. To achieve this goal, primary step is to segment corresponding organs in both modalities. Therefore, an expert manually extracts the boundary of available soft tissue organs in TVUS and MR images. Note that such landmarks are usually used by the radiologist during the diagnosis, thus our method does not add neither heavy nor additional constraints. For MR data, we automatically reconstruct a set of 3D surfaces (see Fig. 2
                        (a)), while for the TVUS images we obtain a set of curves (see Fig. 2(b)). Now our goal is to use the shape of objects – for instance, a surface from MR data and a planar curve from TVUS – to fuse the 2D TVUS image into the volumetric MR (see Fig. 2(c)). When comparing two objects in different dimensions, there are mainly two possible solutions. One is to project the higher-dimensional object to the lower space and then compare them. However, in our problem, the parameters of projection and the plane of intersection are unknown. The other way is to directly compare a curve with its corresponding surface. Even though this approach can be computationally expensive, we must choose this approach because of our available data and information.

The dissimilarity between shape of organs in the MR and TVUS images is mainly related to the TVUS transducer's pressure, resulting into a nonlinear transformation, denoted by ϕ, of the 3D MR surface S. In other words, this transformation results in the deformed surface ϕ(S). Let γ be a curve observed using the intersection of a cutting plane with ϕ(S). Formally, our problem can be defined as: Given γ and S, estimate a curve on S that optimally corresponds to γ under deformations. Note that ϕ and the cross-section of the MR volume (see Fig. 2(c)) are unknown variables and we need to estimate them in the registration process.

Our slice-to-volume deformable registration method registers a 2D TVUS image with a 3D MR volume. It is an extension of [13] which studied the case of fusing a 2D TVUS image with a 2D MR image using contour correspondences. Here, we also elaborate our method in detail and provide a new formulation that can handle multiple segmented organs without a precise initialization. In the proposed method, we search for a cross-section of the MR volume by a smooth surface, representing the TVUS. Our variational one-step deformable ICP method directly registers a set of 2D curves (from TVUS) to a set of corresponding 3D surfaces (from MR). It computes a dense deformation field embedding the TVUS domain in the MR coordinate frame while establishing point correspondences automatically. From this registration, any information marked in the TVUS frame such as the boundary of soft tissue organs and endometrial implants may be embedded in the MR. Therefore, we can directly visualize in the MR volume the deformation induced by the probe at the time TVUS was acquired. Fig. 2 shows a general workflow of our deformable slice-to-volume registration. In this figure, a 2D TVUS image, which shows an endometrial implant and its neighbouring organ (Fig. 2(a)), is registered to an MR volume, which depicts a 3D patient-specific organ model (Fig. 2(b)). Fig. 2(c) shows the warped TVUS surface and the location of the endometrial implant in the MR frame (colored in yellow).

The rest of the paper is organized as follows: Section 2 proposes our new feature-based slice-to-volume registration approach. Section 3 provides the results of our experiments and a discussion related to the quantitative and qualitative registration results. Lastly, Section 4 concludes and outlines future work.

We choose TVUS to be our moving image (M) and MR to be our target (F). First, the implant and its neighbouring organs in M are segmented and then the corresponding organs in F are contoured. The segmentation results in a set of m curves γ
                        
                           i
                         on M and a set of m surfaces S
                        
                           i
                         on F, i
                        =1, …, m, representing the boundary of corresponding organs in both modalities. For ease of understanding and simplicity of derivation, we first use only one curve γ and one surface S as in the example of Fig. 2. Let Ω be a bounded open set of 
                           
                              
                                 
                                    ℝ
                                 
                              
                              2
                           
                         representing the TVUS plane, q an arbitrary point in γ, and 
                           ϕ
                           ∈
                           W
                           (
                           Ω
                           ,
                           
                              
                                 
                                    ℝ
                                 
                              
                              3
                           
                           )
                         a dense deformation vector field representing the slice-to-volume registration by embedding the TVUS plane in 3D while deforming it. W is a Sobolev space of sufficiently smooth vector fields over Ω with appropriate boundary conditions.

The literature of 3D/2D registration shows that deformable two-step ICP is a reliable choice when the projection information is available (e.g. [28]). This is due to the fact that projection information can be extremely useful to decrease the search space of the problem. However as we will see in the experimental results, standard ICP mostly fails in the case of slice-to-volume registration. Therefore, we propose a new ICP-based algorithm which reduces the dependency of the procedure on the initial estimate and improves the convergence rate.

Feature-based slice-to-volume registration is a difficult problem, especially for nonlinear deformations. Such a registration is an ill-posed problem as it lacks a unique solution to the vector transformation field. Thus the solution may be a deformation that could not or did not have occurred. However, by imposing prior on the character of the vector transformation field, it is feasible to lead its evolution toward physically meaningful solutions, which simply mean the ill-posed problem is regularized [40]. More specifically, the regularization improves the conditioning of the optimization problem, imposes a smoothness on the solution, and enables more efficient numerical solutions. As prior, we use a local curvature regularizer. By doing so, the resulting displacement field is kept smooth. In other words, we impose a bounded Laplacian to ensure that the registration outside γ would be estimated by interpolation in a way that the overall transformation smoothly maps the moving image onto the reference image.

We first give a variational formulation of the two inner steps of ICP with curvature regularization:

Step 1: closest point computation
                     


                        
                           
                              (1)
                              
                                 ζ
                                 (
                                 q
                                 )
                                 =
                                 
                                    
                                       argmin
                                       
                                    
                                    
                                       Q
                                       ∈
                                       S
                                    
                                 
                                 
                                    d
                                    2
                                 
                                 
                                    
                                       
                                          Q
                                          ,
                                          ϕ
                                          
                                             
                                                q
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

This implicitly defines 
                           ζ
                           ∈
                           
                              C
                              1
                           
                           
                              
                                 
                                    γ
                                    ,
                                    S
                                 
                              
                           
                        , a function that computes the closest-point ζ(q) on S.

Step 2: deformation estimation
                     


                        
                           
                              (2)
                              
                                 ϕ
                                 =
                                 
                                    
                                       argmin
                                       
                                    
                                    
                                       ϕ
                                       ∈
                                       W
                                    
                                 
                                 λ
                                 
                                    
                                       
                                          
                                             ∫
                                             γ
                                          
                                          
                                             d
                                             2
                                          
                                          
                                             
                                                
                                                   ϕ
                                                   (
                                                   q
                                                   )
                                                   ,
                                                   ζ
                                                   
                                                      
                                                         q
                                                      
                                                   
                                                
                                             
                                          
                                          d
                                          γ
                                       
                                       ︸
                                    
                                    
                                       data
                                       
                                       term
                                    
                                 
                                 +
                                 
                                    
                                       
                                          1
                                          −
                                          λ
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∫
                                             Ω
                                          
                                          
                                             
                                                
                                                   
                                                      Δ
                                                      ϕ
                                                   
                                                
                                             
                                             2
                                             2
                                          
                                          d
                                          Ω
                                       
                                       ︸
                                    
                                    
                                       smoothing
                                       
                                       term
                                    
                                 
                              
                           
                        where Δ is the Laplacian operator and λ
                        ∈[0, 1] is a smoothing parameter.

Although two-step ICP has been applied to various registration problems, there are multiple critical issues that need to be considered. First, it generally converges to the correct solution when the initial position of the two data sets is adequately close. Second, the closest point computation step is the bottleneck of the algorithm as it is the most computationally expensive step. Third, the procedure of establishing correspondences makes ICP more vulnerable to local minima [41]. The question that may immediately arise is how the two-step ICP can be reduced to a single minimization problem to improve the convergence rate and the computational time. To achieve this, we follow the idea in [42] and use a distance transform.

We now present our formulation of the registration problem by combining the two steps of the classical formulation in a single step. Substituting Eq. (1) in Eq. (2) yields:


                        
                           
                              (3)
                              
                                 
                                    
                                       
                                          ϕ
                                       
                                       
                                          =
                                          
                                             argmin
                                             
                                                ϕ
                                                ∈
                                                W
                                             
                                          
                                          λ
                                          
                                             ∫
                                             γ
                                          
                                          
                                             d
                                             2
                                          
                                          
                                             
                                                
                                                   ϕ
                                                   (
                                                   q
                                                   )
                                                   ,
                                                   
                                                      argmin
                                                      
                                                         Q
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      d
                                                      2
                                                   
                                                   
                                                      
                                                         
                                                            Q
                                                            ,
                                                            ϕ
                                                            (
                                                            q
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          d
                                          γ
                                       
                                    
                                    
                                       
                                       
                                          +
                                          
                                             
                                                
                                                   1
                                                   −
                                                   λ
                                                
                                             
                                          
                                          
                                             ∫
                                             Ω
                                          
                                          
                                             
                                                
                                                   
                                                      Δ
                                                      ϕ
                                                   
                                                
                                             
                                             2
                                             2
                                          
                                          d
                                          Ω
                                       
                                    
                                 
                              
                           
                        It is clear that 
                           
                              d
                              2
                           
                           
                              
                                 
                                    ϕ
                                    (
                                    q
                                    )
                                    ,
                                    
                                       argmin
                                       
                                          Q
                                          ∈
                                          S
                                       
                                    
                                    
                                       d
                                       2
                                    
                                    
                                       
                                          
                                             Q
                                             ,
                                             ϕ
                                             (
                                             q
                                             )
                                          
                                       
                                    
                                 
                              
                           
                           =
                           
                              min
                              
                                 Q
                                 ∈
                                 S
                              
                           
                           
                              d
                              2
                           
                           
                              
                                 
                                    Q
                                    ,
                                    ϕ
                                    (
                                    q
                                    )
                                 
                              
                           
                        . This can be interpreted as the fact that the cost function depends on the distance to the closest point but not on the closest point itself. This allows us to rewrite Eq. (3) as:
                           
                              (4)
                              
                                 ϕ
                                 =
                                 
                                    argmin
                                    
                                       ϕ
                                       ∈
                                       W
                                    
                                 
                                 λ
                                 
                                    ∫
                                    γ
                                 
                                 
                                    min
                                    
                                       Q
                                       ∈
                                       S
                                    
                                 
                                 
                                    d
                                    2
                                 
                                 
                                    
                                       
                                          Q
                                          ,
                                          ϕ
                                          (
                                          q
                                          )
                                       
                                    
                                 
                                 d
                                 γ
                                 +
                                 (
                                 1
                                 −
                                 λ
                                 )
                                 
                                    ∫
                                    Ω
                                 
                                 
                                    
                                       
                                          
                                             Δ
                                             ϕ
                                          
                                       
                                    
                                    2
                                    2
                                 
                                 d
                                 Ω
                              
                           
                        We observe that the data term now involves a distance transform 
                           D
                           ∈
                           
                              C
                              2
                           
                           (
                           
                              
                                 
                                    ℝ
                                 
                              
                              3
                           
                           ,
                           
                              
                                 ℝ
                              
                           
                           )
                        , since 
                           D
                           ∘
                           ϕ
                           (
                           q
                           )
                           =
                           
                              
                                 min
                                 
                              
                              
                                 Q
                                 ∈
                                 S
                              
                           
                           
                              d
                              2
                           
                           
                              
                                 
                                    Q
                                    ,
                                    ϕ
                                    (
                                    q
                                    )
                                 
                              
                           
                         by definition. The distance map algorithm essentially assigns to every voxel (grid point) the distance to its nearest point. This is extremely efficient, fast and simple. Fig. 3
                         is an example of distance map. Fig. 3(a) shows the segmentation of 4 axial MR slices. Fig. 3(b) illustrates the 3D surface reconstructed from those 4 parallel 2D MR curves. Then, the reconstructed surface is used to generate the distance map (Fig. 3(c)) in which for each point in Fig. 3(b), the corresponding pixel in the distance map of Fig. 3(c) holds the smallest Euclidean distance between each point of the domain and the surface. We can now combine D with Eq. (4), leading to:
                           
                              (5)
                              
                                 ϕ
                                 =
                                 
                                    argmin
                                    
                                       ϕ
                                       ∈
                                       W
                                    
                                 
                                 
                                    
                                       
                                          λ
                                          
                                             ∫
                                             γ
                                          
                                          
                                             
                                                
                                                   
                                                      D
                                                      ∘
                                                      ϕ
                                                      (
                                                      q
                                                      )
                                                   
                                                
                                             
                                             2
                                          
                                          d
                                          γ
                                          +
                                          (
                                          1
                                          −
                                          λ
                                          )
                                          
                                             ∫
                                             Ω
                                          
                                          
                                             
                                                
                                                   
                                                      Δ
                                                      ϕ
                                                   
                                                
                                             
                                             2
                                             2
                                          
                                          d
                                          Ω
                                       
                                       ︸
                                    
                                    
                                       E
                                       
                                          
                                             ϕ
                                          
                                       
                                    
                                 
                              
                           
                        Eq. (5) represents a variational problem with E as a cost functional. The next step is to compute ϕ using numerical methods.


                        
                           Algorithm 1
                           Pseudo-code of the proposed algorithm


                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             1:
                                             
                                                Input: A point cloud from MR (Q) &a set of points from TVUS (q)
                                          
                                          
                                             2:
                                             
                                                Result: Deformation field (ϕ)
                                          
                                          
                                             3:
                                             
                                                Initialization:
                                             
                                          
                                          
                                             4:
                                             
                                                k
                                                ←0 % Iteration counter
                                             
                                          
                                          
                                             5:
                                             
                                                ι
                                                ←10 % Number of planarity constrained iterations
                                             
                                          
                                          
                                             6:
                                             Compute D and ∇D from Q 
                                                % D and ∇ D are used in Eq. 
                                                (12)
                                             
                                          
                                          
                                             7:
                                             
                                                while
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∇
                                                            U
                                                         
                                                      
                                                   
                                                   >
                                                   ɛ
                                                
                                                
                                                do
                                             
                                          
                                          
                                             8:
                                             
                                                Compute U by solving Eq. (12)
                                             
                                          
                                          
                                             9:
                                             
                                                
                                                ϕ
                                                
                                                   k+1
                                                ←
                                                ϕ
                                                
                                                   k
                                                
                                                +
                                                U 
                                                % Update the deformation field
                                             
                                          
                                          
                                             10:
                                             
                                                
                                                if
                                                
                                                k
                                                <
                                                ι
                                                
                                                then
                                             
                                          
                                          
                                             11:
                                             
                                                Π← least-squares plane projection from ϕ
                                                
                                                   k
                                                (q)
                                          
                                          
                                             12:
                                             
                                                
                                                
                                                   
                                                      ϕ
                                                      
                                                         k
                                                         +
                                                         1
                                                      
                                                   
                                                   ←
                                                   Proj
                                                   
                                                      
                                                         
                                                            
                                                               ϕ
                                                               
                                                                  k
                                                                  +
                                                                  1
                                                               
                                                            
                                                            ,
                                                            Π
                                                         
                                                      
                                                   
                                                 
                                                % Flatten the deformation field
                                             
                                          
                                          
                                             13:
                                             
                                                
                                                end if
                                             
                                          
                                          
                                             14:
                                             
                                                
                                                k
                                                ←
                                                k
                                                +1
                                          
                                          
                                             15:
                                             
                                                end while
                                             
                                          
                                       
                                    
                                 
                              
                           

A function ϕ that minimizes E must fulfill the Euler–Lagrange (EL) differential equation. Several numerical optimization algorithms [5,6] may then be applied to solve the resulting nonlinear equation. In Eq. (5), the data term places constraints on the deformation field ϕ at the curve location. To make it more general and to permit its formulation as an EL equation we use an index function δ
                        
                           γ
                        , with δ
                        
                           γ
                        
                        :Ω→{0, 1}, 
                           
                              δ
                              γ
                           
                           
                              
                                 X
                              
                           
                           =
                           1
                         if X
                        ∈
                        γ and 0 otherwise. We rewrite the cost function in Eq. (5) as:
                           
                              (6)
                              
                                 E
                                 [
                                 ϕ
                                 ]
                                 =
                                 
                                    ∫
                                    Ω
                                 
                                 
                                    
                                       
                                          λ
                                          
                                             δ
                                             γ
                                          
                                          
                                             
                                                
                                                   
                                                      D
                                                      ∘
                                                      ϕ
                                                   
                                                
                                             
                                             2
                                          
                                          +
                                          (
                                          1
                                          −
                                          λ
                                          )
                                          
                                             
                                                
                                                   
                                                      Δ
                                                      ϕ
                                                   
                                                
                                             
                                             2
                                             2
                                          
                                       
                                    
                                 
                                 d
                                 Ω
                              
                           
                        Let ϕ
                        0 be an initial registration. We use an additive update rule:
                           
                              (7)
                              
                                 
                                    ϕ
                                    
                                       k
                                       +
                                       1
                                    
                                 
                                 =
                                 
                                    ϕ
                                    k
                                 
                                 +
                                 U
                              
                           
                        where U
                        ∈
                        W is an incremental 3D dense displacement vector field. We restate our problem as:
                           
                              (8)
                              
                                 
                                    
                                       min
                                       U
                                    
                                 
                                 E
                                 
                                    
                                       
                                          
                                             ϕ
                                             k
                                          
                                          +
                                          U
                                       
                                    
                                 
                              
                           
                        By substituting Eq. (6) into Eq. (8), we obtain:
                           
                              (9)
                              
                                 
                                    
                                       
                                          E
                                          [
                                          
                                             ϕ
                                             k
                                          
                                          +
                                          U
                                          ]
                                       
                                       
                                          =
                                          
                                             ∫
                                             Ω
                                          
                                          
                                             
                                                
                                                   λ
                                                   
                                                      δ
                                                      γ
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                               ∘
                                                               
                                                                  
                                                                     
                                                                        
                                                                           ϕ
                                                                           k
                                                                        
                                                                        +
                                                                        U
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   +
                                                   
                                                      
                                                         
                                                            1
                                                            −
                                                            λ
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        Δ
                                                                        
                                                                           U
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                               2
                                                               2
                                                            
                                                            +
                                                            
                                                               
                                                                  
                                                                     
                                                                        Δ
                                                                        
                                                                           ϕ
                                                                           k
                                                                        
                                                                     
                                                                  
                                                               
                                                               2
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          d
                                          Ω
                                       
                                    
                                 
                              
                           
                        The distance transform D is nonlinear and can be approximated by its first order Taylor expansion around ϕ
                        
                           k
                        :


                        
                           
                              (10)
                              
                                 
                                    
                                       
                                          E
                                          [
                                          
                                             ϕ
                                             k
                                          
                                          +
                                          U
                                          ]
                                       
                                       
                                          =
                                          
                                             ∫
                                             Ω
                                          
                                          
                                             
                                                
                                                   λ
                                                   
                                                      δ
                                                      γ
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                               ∘
                                                               
                                                                  ϕ
                                                                  k
                                                               
                                                               +
                                                               
                                                                  
                                                                     
                                                                        ∇
                                                                        D
                                                                        ∘
                                                                        
                                                                           ϕ
                                                                           k
                                                                        
                                                                     
                                                                  
                                                               
                                                               U
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   +
                                                   
                                                      
                                                         
                                                            1
                                                            −
                                                            λ
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        Δ
                                                                        U
                                                                     
                                                                  
                                                               
                                                               2
                                                               2
                                                            
                                                            +
                                                            
                                                               
                                                                  
                                                                     
                                                                        Δ
                                                                        
                                                                           ϕ
                                                                           k
                                                                        
                                                                     
                                                                  
                                                               
                                                               2
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          d
                                          Ω
                                       
                                    
                                 
                              
                           
                        where 
                           ∇
                           =
                           [
                           
                              ∂
                              
                                 ∂
                                 x
                              
                           
                           ,
                           
                              ∂
                              
                                 ∂
                                 y
                              
                           
                           ,
                           
                              ∂
                              
                                 ∂
                                 z
                              
                           
                           ]
                        . A function U that minimizes Eq. (8) must fulfill its EL equation. This is written as a system of three fourth order elliptic Partial Differential Equations (PDEs):
                           
                              (11)
                              
                                 μ
                                 
                                    ∫
                                    γ
                                 
                                 
                                    
                                       
                                          D
                                          ∘
                                          
                                             ϕ
                                             k
                                          
                                          +
                                          
                                             
                                                
                                                   ∇
                                                   D
                                                   ∘
                                                   
                                                      ϕ
                                                      k
                                                   
                                                
                                             
                                          
                                          U
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∇
                                          D
                                          ∘
                                          
                                             ϕ
                                             k
                                          
                                       
                                    
                                 
                                 d
                                 γ
                                 +
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∂
                                                   4
                                                
                                                U
                                             
                                             
                                                ∂
                                                
                                                   X
                                                   4
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 0
                              
                           
                        where 
                           μ
                           =
                           
                              λ
                              
                                 1
                                 −
                                 λ
                              
                           
                        . To solve Eq. (11) numerically, we discretize the curve γ in N points q
                        1, …, q
                        
                           N
                         and Ω onto a rectangular grid. Note that δ
                        
                           q
                        (X)=1 if ∃j
                        ∈1, …, N such that X
                        =
                        q
                        
                           j
                         and 0 otherwise. We consider the unknown function U
                        =[u
                        1, u
                        2, u
                        3]⊤ on a rectangular grid. Therefore, the discretization of Eq. (11) leads to a system of three PDEs:


                        
                           
                              (12)
                              
                                 
                                    
                                       
                                          μ
                                       
                                       
                                          
                                             δ
                                             q
                                          
                                          
                                             
                                                X
                                             
                                          
                                          
                                             
                                                
                                                   D
                                                   
                                                      
                                                         
                                                            
                                                               ϕ
                                                               k
                                                            
                                                            
                                                               
                                                                  X
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      D
                                                      x
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               ϕ
                                                               k
                                                            
                                                            
                                                               
                                                                  X
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      u
                                                      1
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          +
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      D
                                                      y
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               ϕ
                                                               k
                                                            
                                                            
                                                               
                                                                  X
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      u
                                                      2
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                   
                                                   +
                                                   
                                                      D
                                                      z
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               ϕ
                                                               k
                                                            
                                                            
                                                               
                                                                  X
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      u
                                                      3
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             D
                                             ℓ
                                          
                                          
                                             
                                                
                                                   
                                                      ϕ
                                                      k
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          +
                                       
                                       
                                          
                                             
                                                
                                                   ∂
                                                   4
                                                
                                                U
                                             
                                             
                                                ∂
                                                
                                                   x
                                                   4
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∂
                                                   4
                                                
                                                U
                                             
                                             
                                                ∂
                                                
                                                   y
                                                   4
                                                
                                             
                                          
                                          =
                                          0
                                       
                                    
                                 
                              
                           
                        where D
                        ℓ is the derivative of D with respect to ℓ∈{x, y, z}. To solve the PDEs, we use a finite difference scheme with second-order boundary condition ▵U
                        =0. This leads to a large but sparse linear system that can be solved by Successive Over-Relaxation (SOR) [43]. The advantages of iterative solvers like SOR are twofold. First, iterative solvers generally perform very well in discarding the higher frequency parts of the error within the first iterations. This behaviour is reflected in a good initial convergence rate [44]. Second, they are suitable for solving large linear equations [45]. The displacement vector field obtained from Eq. (12) is used to find the intersection of the MR volume by a warped TVUS surface and to localize endometrial implants. To make our algorithm more stable, we use a planarity prior constraint. This is to avoid convergence to a spiky surface which would harm registration. For that purpose, we automatically extract a plane from the TVUS point sets for the first few iterations. We choose the closest plane to the TVUS point set in the least squares sense [46]. We project the displacement field on the plane. This choice puts constraints on the warped surface by flattening the TVUS free-form surface. Applying this strong constraint on the original TVUS surface improves the convergence of our algorithm. After a few iterations, we relax this constraint: when approaching the solution, the surface has only low frequency features and readily converges to the solution. The pseudo code of our method is given in Algorithm 1 where ɛ is a pre-specified convergence threshold set to ɛ
                        =10−5 in our experiments.

We now extend our framework to handle multiple pairs of curves and surfaces. In this case, we have m curves γ
                        1, …, γ
                        
                           m
                         and a set of m corresponding 3D surfaces S
                        1, … , S
                        
                           m
                        . We use each surface S
                        
                           i
                         to compute an Euclidean distance transform D
                        
                           i
                        . By summing over all curve/surface pairs, Eq. (6) becomes:
                           
                              (13)
                              
                                 E
                                 [
                                 ϕ
                                 ]
                                 =
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    m
                                 
                                 
                                    ∫
                                    Ω
                                 
                                 
                                    
                                       
                                          λ
                                          
                                             δ
                                             
                                                
                                                   γ
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         D
                                                         i
                                                      
                                                      ∘
                                                      ϕ
                                                   
                                                
                                             
                                             2
                                          
                                          +
                                          (
                                          1
                                          −
                                          λ
                                          )
                                          
                                             
                                                
                                                   
                                                      Δ
                                                      ϕ
                                                   
                                                
                                             
                                             2
                                             2
                                          
                                       
                                    
                                 
                                 d
                                 Ω
                              
                           
                        where 
                           
                              δ
                              
                                 
                                    γ
                                    i
                                 
                              
                           
                           (
                           X
                           )
                           =
                           1
                         if X
                        ∈
                        γ
                        
                           i
                         and 0 otherwise. Using EL we obtain a system of three fourth order elliptic PDEs:


                        
                           
                              (14)
                              
                                 
                                    
                                       
                                          μ
                                       
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             ∫
                                             
                                                
                                                   γ
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      D
                                                      i
                                                   
                                                   ∘
                                                   
                                                      ϕ
                                                      k
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            ∇
                                                            
                                                               D
                                                               i
                                                            
                                                            ∘
                                                            
                                                               ϕ
                                                               k
                                                            
                                                         
                                                      
                                                   
                                                   U
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∇
                                                   
                                                      D
                                                      i
                                                   
                                                   ∘
                                                   
                                                      ϕ
                                                      k
                                                   
                                                
                                             
                                          
                                          d
                                          
                                             γ
                                             i
                                          
                                       
                                    
                                    
                                       
                                          +
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            4
                                                         
                                                         U
                                                      
                                                      
                                                         ∂
                                                         
                                                            X
                                                            4
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          =
                                          0
                                       
                                    
                                 
                              
                           
                        Eq. (14) is discretized by a finite difference scheme, which leads to a sparse linear system and then solved using SOR. It eventually leads to an algorithm very similar to Algorithm 1.

@&#EXPERIMENTAL RESULTS@&#

The study was carried out on 10 patients who had small endometrial implants in their pelvic area. Note that the reason that only 10 patients were chosen is that the endometriosis mostly cannot be diagnosed at early stages, so that there are hardly to find many patients with the small endometrial implants. For each patient, TVUS and MR imaging were used to examine their pelvic organs. TVUS was performed using a high-frequency Siemens Endocavity Curved Array Ultrasound probe (6.5MHz) and Siemens Sonoline Elegra Ultrasound machine. Axial T2 MR slices with slice thickness of 5mm, repetition time of 44083–49397ms, and echo time of 82.18–85.09ms were acquired with a 1.5 Tesla GEM Suite. MR imaging was performed in order to provide superior anatomic detail and better define abnormalities found using ultrasonography. In our experiments, small implants were visible in TVUS images, but difficult to identify in MR slices. The MR images used in the experiments had an average size of 400×400×5 with a voxel resolution of 0.5×0.5×5mm3.

The procedure of collecting data was as follows: first, an axial TVUS image, which includes both endometrial implant and its neighbouring organs, was chosen for each patient by a pelvic radiologist. Generally for each patient, only one of the collected TVUS images had this information. This is due to the fact that at the time ultrasonographic examination was performed, there was no clue about the location of endometriosis and the radiologist moved the probe in any direction in order to detect the implants. This factor along with the small field of view of the ultrasound scanners were the main reasons that most of the patients’ TVUS images could not depict the required information. Second, using the axial TVUS slice made the same radiologist able to identify 4–5 axial MR slices from the MR volume that closely correspond to the moving 2D TVUS image. Note that the middle MR slice of these selected slices was the closest one to the TVUS image. Thus, in our experiments, we assumed that the TVUS slice was parallel to the middle MR slice and used this constraint as an initial solution. The alternative way to estimate the initial solution was to use a 3D EM tracker on the TVUS transducer to quantifying the probe angle and used this information to rigidly align two data and/or to estimate the initial TVUS cutting plane. However, this approach is a limited method, since the EM trackers are not available in the hospital. Therefore, our procedure of estimating the initial solution is a more effective approach for clinical application.

After selecting data, the soft tissue organs (i.e. bladder, uterus, ovary, rectum) and the small endometrial implants in the TVUS image as well as the corresponding soft tissue organs in each MR slice were segmented. The segmentation was performed by a pelvic radiologist and then confirmed with a gynaecologist. Even though our method relied on the user to segment the organs, in this context, this was clinically acceptable, since manual segmentation of the pelvic organs could be achieved in a reasonable amount of time. Moreover, these features were normally used by the expert during the diagnosis to ease the task of interpretation of the images. The segmentation process took on average less than 10min for each patient. In addition, from a technical point of view, automatic segmentation in this context is extremely challenging due to three main reasons. First, the endometrial implants can be anywhere in the patient's pelvic area, so that we need a segmentation algorithm to be able to detect all the tissues and lesions in the pelvic region. Second, the small endometrial implants, which can be seen in TVUS images, infiltrate through the walls of organs. Therefore, it is difficult to automatically segment both the implant and the host tissue with a high precision. Third, in case of adhesion
                           2
                        
                        
                           2
                           Adhesion is a band of scar tissue that binds two or more adjacent pelvic organs to each other or cover them entirely, causing organ dislocation, pain, and infertility.
                        , the MR images cannot clearly show the organs’ boundary. Consequently, we used manual segmentation to avoid incorporating the segmentation errors in the evaluation of the registration algorithm. We used 300 points to represent each curve. Then, we used the method proposed by Kels et al. [47] to reconstruct a 3D surface from a set of 2D MR contours. For all experiments, the maximum number of iterations was set to be 50 and λ was empirically chosen, and was altered between 0.6 and 0.01, with 0.012 as a step size. The proposed method was implemented on MATLAB and was run on an Intel i5 core 3.3 GHz processor with 16 GB RAM.

We evaluate the proposed method's performance in comparison with variational two-step deformable ICP. In our experiments, the curves contain 300 points each. Then, the moving curve is uniformly sub-sampled to 100 points, unless otherwise noted. We demonstrate the accuracy of the proposed method by quantitative and qualitative tests on semi-synthetic and real world data sets. The true point correspondences are not available for real patient data sets, since the TVUS probe orientation is unknown. However, we assess the results with quantitative and qualitative evaluations on semi-synthetic data sets, generated to faithfully reproduce patient data features. We conduct more than a thousand experiments using semi-synthetic data with artificial deformations and cutting planes to test various aspects of the methods. The artificial deformations are used to simulate the deformations caused by variable probe contact pressure. On the other hand, the cutting planes are used to simulate the variable TVUS probe orientation. Evaluating the performance of the algorithms with respect to the probe orientation is important because the TVUS probe can be easily moved in any direction. Finding an inaccurate TVUS orientation simply causes inaccurate endometrial implant localization. This simply results in a bad surgical planning that increases the trauma done to healthy tissues and/or under-cutting the implant. Thus, the experiments on semi-synthetic data emulate realistic acquisition situations and reveal the expected registration error. We calculate four different quantitative error measures to validate the results. To demonstrate the applicability in real applications, we also conduct tests on 10 patient data. To show the generality of our method, we apply it to four different soft tissue organs: the bladder, uterus, rectum, and ovary.

The registration accuracies are evaluated using some standardized measures. The registration accuracies that measure global overlap are assessed based on Mean Square Error (MSE), Dice Similarity Coefficient (DSC) [48], and Hausdorff Distance (HD) [49]. Local registration accuracy is evaluated in terms of Target Registration Error (TRE). For local registration accuracy evaluation purposes, the curve γ is discretized into 30, 60, and 110 points, while 10 points are randomly selected and used for measuring the TRE. This is an important examination because the performance of ICP algorithms depend also on the density of curve sampling. In addition to this, this test allows us to see whether the compared methods provide smooth deformation fields between point correspondences.

The MSE measures the mean square distance between the N transformed moving points (
                              ϕ
                              (
                              q
                              )
                              ∈
                              
                                 
                                    
                                       ℝ
                                    
                                 
                                 3
                              
                           ) and the corresponding ground truth points (
                              
                                 Q
                                 GT
                              
                              ∈
                              
                                 
                                    
                                       ℝ
                                    
                                 
                                 3
                              
                           ). Mathematically, this can be written as:
                              
                                 (15)
                                 
                                    MSE
                                    =
                                    
                                       1
                                       N
                                    
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       
                                          
                                             
                                                ϕ
                                                (
                                                
                                                   q
                                                   j
                                                
                                                )
                                                −
                                                
                                                   Q
                                                   j
                                                   GT
                                                
                                             
                                          
                                       
                                       2
                                       2
                                    
                                 
                              
                           If registration was fully accurate, points ϕ(q) and Q
                           
                              GT
                            would coincide, and then the MSE would be zero. Therefore, a low MSE value shows a good registration accuracy.

Since the first measure does not take topology into account, we also introduce two other measures, which evaluate the shape. DSC is employed as a statistical validation metric to evaluate the performance of image registration algorithms. It is a measure of the spatial overlap of same foreground labels (f) between the 2D ground truth reference image (F
                           
                              GT
                           (f)) and the 2D moving image (
                              M
                              
                                 
                                    
                                       ϕ
                                       
                                          
                                             f
                                          
                                       
                                    
                                 
                              
                           ) and is defined by:
                              
                                 (16)
                                 
                                    DSC
                                    =
                                    
                                       
                                          2
                                          
                                             
                                                
                                                   M
                                                   
                                                      
                                                         
                                                            ϕ
                                                            
                                                               
                                                                  f
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ∩
                                                   
                                                      F
                                                      GT
                                                   
                                                   
                                                      
                                                         f
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          M
                                          
                                             
                                                
                                                   ϕ
                                                   
                                                      
                                                         f
                                                      
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             F
                                             GT
                                          
                                          
                                             
                                                f
                                             
                                          
                                       
                                    
                                 
                              
                           More simply, this formula represents the size of the union of two sets divided by the average size of them. The value of a DSC ranges from 0, indicating no spatial overlap between two regions, to 1, indicating complete overlap. This means that a high DSC value indicates a good overlap between the tissue regions after registration. Note that a high DSC does not mean a good contour overlap. Therefore, the HD measure must be used.

HD measures similarity between the deformed moving curve 
                              ϕ
                              
                                 
                                    γ
                                 
                              
                              ∈
                              
                                 
                                    
                                       ℝ
                                    
                                 
                                 3
                              
                            and the ground truth curve 
                              
                                 Γ
                                 GT
                              
                              ∈
                              
                                 
                                    
                                       ℝ
                                    
                                 
                                 3
                              
                           . Given a finite set of points 
                              ϕ
                              
                                 
                                    γ
                                 
                              
                              =
                              
                                 
                                    
                                       ϕ
                                       (
                                       
                                          q
                                          1
                                       
                                       )
                                       ,
                                       …
                                       ,
                                       ϕ
                                       (
                                       
                                          q
                                          N
                                       
                                       )
                                    
                                 
                              
                            and 
                              
                                 Γ
                                 GT
                              
                              =
                              
                                 
                                    
                                       
                                          Q
                                          1
                                          GT
                                       
                                       ,
                                       …
                                       ,
                                       
                                          Q
                                          N
                                          GT
                                       
                                    
                                 
                              
                           , the HD between the point sets is given by:
                              
                                 (17)
                                 
                                    HD
                                    (
                                    ϕ
                                    
                                       
                                          γ
                                       
                                    
                                    ,
                                    
                                       Γ
                                       GT
                                    
                                    )
                                    =
                                    max
                                    
                                       
                                          
                                             h
                                             
                                                
                                                   
                                                      ϕ
                                                      
                                                         
                                                            γ
                                                         
                                                      
                                                      ,
                                                      
                                                         Γ
                                                         GT
                                                      
                                                   
                                                
                                             
                                             ,
                                             h
                                             
                                                
                                                   
                                                      
                                                         Γ
                                                         GT
                                                      
                                                      ,
                                                      ϕ
                                                      
                                                         
                                                            γ
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where
                              
                                 (18)
                                 
                                    h
                                    
                                       
                                          
                                             ϕ
                                             
                                                
                                                   γ
                                                
                                             
                                             ,
                                             
                                                Γ
                                                GT
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          max
                                          
                                       
                                       
                                          ϕ
                                          (
                                          q
                                          )
                                          ∈
                                          ϕ
                                          (
                                          γ
                                          )
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   min
                                                   
                                                
                                                
                                                   
                                                      Q
                                                      GT
                                                   
                                                   ∈
                                                   
                                                      Γ
                                                      GT
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ϕ
                                                      (
                                                      q
                                                      )
                                                      −
                                                      
                                                         Q
                                                         GT
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           More specifically, the HD is used to evaluate the contour accuracy. A low HD value shows good contour overlap.

To quantify the local registration error, we use the TRE. It is described as the mean square distance between n corresponding points not used in estimating the deformation. The main challenge in calculating TRE lies in finding corresponding target landmarks. The best target landmarks are those generated by a mechanical device which allows for an accurate positioning of the anatomy. However, this is not achievable for our study. The next best option is to choose anatomical landmarks in the patient's body and the centroid of an organ. We opt for this type of target points to estimate the local registration accuracy to validate our result. TRE is measured by:
                              
                                 (19)
                                 
                                    TRE
                                    =
                                    
                                       1
                                       N
                                    
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       
                                          
                                             
                                                ϕ
                                                
                                                   
                                                      
                                                         
                                                            q
                                                            j
                                                            TAR
                                                         
                                                      
                                                   
                                                
                                                −
                                                
                                                   Q
                                                   j
                                                   TGT
                                                
                                             
                                          
                                       
                                       2
                                       2
                                    
                                 
                              
                           where 
                              ϕ
                              
                                 
                                    
                                       
                                          q
                                          j
                                          TAR
                                       
                                    
                                 
                              
                            are the position of target moving points after registration and 
                              
                                 Q
                                 j
                                 TGT
                              
                            are the position of the corresponding target points from ground truth. The target points used in our experiments are centroids and 10 boundary points which are not used to estimate deformation. A low TRE value shows good local registration accuracy. Various experiments are performed owing to the selection criteria of the number of boundary points for a smooth and accurate deformation of the pelvic soft tissue organs. The validation of such experiments with varying number of control points are shown in Section 3.3.3.

We create a test collection of 11 different 3D surfaces with 10 degrees of deformation and 11 different intersection curves, containing approximately 1200 samples in total. To generate semi-synthetic data, the boundary of soft tissue organs such as the bladder, uterus, ovary, and rectum are segmented from five MR slices. Then, we use [47] to reconstruct 3D surfaces from the 2D segmented contours. The reconstructed 3D surfaces are deformed using an advection method [50]. In this method, every single point on the surface has a certain value of potential vorticity. The points are transported by their local displacement field on the surface. As a consequence, the surface can be deformed in complicated manners. The advection equation is a hyperbolic PDE that governs the motion of the 3D surface S as it is transported by a known displacement vector field U:
                              
                                 (20)
                                 
                                    
                                       
                                          ∂
                                          S
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    +
                                    U
                                    ·
                                    
                                       
                                          
                                             ∇
                                             S
                                          
                                       
                                    
                                    =
                                    0
                                 
                              
                           where 
                              
                                 ∂
                                 
                                    ∂
                                    t
                                 
                              
                            is the derivative with respect to time and 
                              ∇
                              =
                              
                                 
                                    
                                       
                                          
                                             ∂
                                             
                                                ∂
                                                x
                                             
                                          
                                          ,
                                          
                                             ∂
                                             
                                                ∂
                                                y
                                             
                                          
                                          ,
                                          
                                             ∂
                                             
                                                ∂
                                                z
                                             
                                          
                                       
                                    
                                 
                                 ⊤
                              
                            denotes the spatial gradient. In our experiments, U is randomly generated and smoothed. The transport equation is implemented numerically using a third order upwind scheme for its stable and non-diffusing solution among others. The surface is deformed through increasingly larger degrees of deformation. The rate of deformation varies between 4% and 40%. Moreover, since the TVUS probe can move freely in any direction, it is also important to cut different views of the deformed surface. Therefore, various intersection curves are obtained at 11 different cutting angles in the range between 0° and 20°. These comprehensive simulations are used to validate our method and to test its robustness to organ deformation and probe orientation. An example of generated semi-synthetic data is shown in Fig. 4
                           . For instance, Fig. 4(a) shows 3 deformed surfaces, which range from small to extremely sharp deformed surfaces, whereas Fig. 4(b) shows different intersection curves, which are obtained at 0° and 20° cutting angles.

@&#RESULTS@&#

In two-step ICP, the point correspondence problem is solved by the nearest neighbour heuristic which results in significantly poor performance compared to the proposed method. To demonstrate this idea, we test both two-step ICP and our method on the same examples. Since we map the warped free-form surface to the planar domain in one-step ICP (during the first 10 iterations), we use the same constraint for two-step ICP. Moreover, as an initialization, we assume that the moving curve is parallel to an intersection curve which is obtained as the intersecting points between a cutting plane with the middle of the MR slices and the surface itself. We call this the middle intersection curve of the original 3D surface. This assumption is made to keep the system similar to real world data. With that in mind, for each 3D surface with 10 degrees of deformation and 11 different intersection curves, we evaluate the average distances between the true point correspondences, curves, and contour overlapping regions before registration using the MSE, HD, and DSC, respectively. Since there are two variables (deformation and cutting angle), we can have two types of measurements: (a) given a deformation, calculate the MSE, HD, DSC at each cutting angle and (b) given a cutting angle, calculate these registration accuracy measurements at each deformation level. The results are shown in Fig. 5
                            where, for example, first row is the MSE, second row is the HD, and third row is the DSC. The average MSE between the true point correspondences before registration is in the range of 3.72–119.99mm. Moreover, the average HD and DSC before registration are in the range of 1.65–17.71mm and 76.15%–98.75%, respectively.

The qualitative results after registration are shown in Figs. 6 and 7
                           
                           . In these two figures, we use a single 3D surface with 4% and 40% average deformation, respectively. We use two surfaces, one is the deformed version (Figs. 6 and 7(b)) of the other (Figs. 6 and 7(a)). The intersection curves are obtained at 20° cutting angle. Then, we initialize both two- and one-step ICP using the curves coloured in red (see the red curves in Figs. 6 and 7(a)). In these figures, the green curves are the ground truth solutions.

In Fig. 6, we deform a 3D surface with 4% degrees of deformation and the intersection curve is obtained at 20° cutting angle. We then use both one-step and two-step ICP to find the best transformation to align the template set onto the ground truth set. The registration results are depicted in Fig. 6(c). At this deformation level, we can visually observe that both one-step and two-step ICP provide good results, because the shapes before registration are very similar. This is visually demonstrated by Fig. 6(d) in which we show a 2D view (X–Y view) of the curves before and after registration. Moreover, to assess the behaviour of the methods in a quantitative way, we use all the semi-synthetic data sets with 4% average deformation and calculate the errors. The results for 4% deformation with various cutting angles are shown in Fig. 8
                           (a). The average MSE, DSC, and HD show that our method converges to a better solution at this low level of deformation. In one-step ICP, at 4% deformation with 20° cutting angle, the average MSE, DSC, and HD after registration are 0.9925 mm, 99.40%, and 0.9890mm, respectively. However, in two-step ICP, those errors are 5.5392mm, 98.62%, and 2.1574mm. Even though two-step ICP yields less accurate results compared with one-step ICP, the DSC and HD show that both methods have very similar shapes to their corresponding ground truth. Consequently, from these figures we can conclude that both methods provide good results at this deformation level. Fig. 8(a) for 4% degrees of deformation also shows that in two-step ICP, when the cutting angle increases, the registration errors dramatically increases. In other words, two-step ICP becomes less accurate as the initial curve is chosen further from the ground truth.

To make the problem much more challenging, we use a 3D surface with 40% rate of deformation and 20° cutting angle. The results are depicted in Fig. 7. Visually we can see that two-step ICP gives poor performance. Once again, to measure the accuracy of both one-step and two-step ICP algorithms in a quantitative way, we use all the surfaces with 40% average deformation and calculate the registration errors. The results are demonstrated in Fig. 8(c). The average MSE, DSC, and HD show that two-step ICP provides very low registration accuracy at this level of deformation, even for the lowest cutting angle. For example, in one-step ICP, at 40% deformation and 20° cutting angle, the average MSE, DSC, and HD are 4.9939mm, 99.40%, and 2.4936mm, respectively, whereas in two-step ICP, they are 69.5347mm, 80.12%, and 14.1911mm. Fig. 8(c) shows that two-step ICP fails at this level of deformation. However, our method still provides acceptable results, since the distance between the shapes (DSC and HD) after registration are not too high.

We also conduct various tests to check the registration accuracy of both methods with respect to various fixed cutting angles. The results are shown in Fig. 8(d)–(f). Fig. 8(d) shows that for 0° cutting angle, two-step ICP provides poor performance when the deformation level is higher than 32%. In this setting, the proposed method provides good performance. By increasing the cutting angle to 10°, we can see that two-step ICP dramatically lose accuracy, even for small deformation levels. This becomes more evident in 20° cutting angle (see Fig. 8(f)). Fig. 8 shows that our method gives higher results than are obtained with the two-step ICP.

In many cases, we observe that the warped intersection curves in one-step ICP are very close to the ground truth and that the method quickly converges to the optimum. In comparison, the warped intersection curves in two-step ICP frequently gets trapped in local minima and mainly fails. The main reason of this failure is because of large initial difference. In addition, we also found that the warped contour with high frequency bumps results in misplaced correspondences, and the registration process fails. For instance, Fig. 7 is an extreme example of such cases. Two-step ICP finds wrong correspondences and fails to retrieve the correct solution. We observe that the high frequency bumps have a strong influence on the matching process. From Figs. 7–8, we can deduce that one-step ICP is more stable and less sensitive to the initial solution. In other words, it shows that our method is more robust to the deformation and probe orientation.

As mentioned in Section 3.3.1, a total of 100 point correspondences are required on the boundary of segmented organs for a smooth deformation. Therefore, to validate the number of boundary points, several experiments are performed with less than equal 100 boundary points. Fig. 9
                            shows the qualitative registration results using the proposed method and two-step ICP with different sets of control points for semi-synthetic data sets with 20% rate of deformation. The TRE is used as a qualitative test as it allows to examine the smoothness of the estimated deformations between corresponding points and also to validate both methods against several numbers of control points. The first experiment is done with only 30 points on the boundary points, where 10 points are randomly selected and used for measuring the TRE. The registration using 20 control points results in distorted deformations of the organs and this can be seen in Fig. 9(a). The following experiment is done increasing the number of boundary points from 20 to 50. Fig. 9(b) shows that using the proposed method, 50 boundary points provide smoother deformation fields, but the curves cannot be fitted properly. However, two-step ICP still gives very low registration accuracy. Finally an experiment is performed using 100 boundary points. The results are shown in Fig. 9(c). It is clearly found from this figure that both methods provide smooth deformation fields. The analysis of TRE in Fig. 9(c) shows a 6–12 times improvement in the mean TRE for the proposed method than two-step ICP.

The average times required for the proposed method is 153.82s±11.74 and it is roughly four times higher (603.95s±49.13) for two-step ICP considering 100 control points being used. In two-step ICP, establishing point correspondences is the most time consuming step of the algorithm due to its quadratic complexity 
                              
                                 
                                    O
                                    
                                       
                                          
                                             
                                                n
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           . In the proposed method, the closest point complexity has been reduced with the use of distance transform. Therefore, the computation time of the proposed algorithm does not highly depend on the number of control points.

Data from real patients with small implants are used to validate our methodology of combining TVUS with MR and to compare our method against two-step ICP. In these experiments, small implants are just seen in TVUS. Therefore, 2D TVUS images are used to detect small endometrial implants and to segment the visible soft tissue organs whereas MR volumes are used to create a 3D geometric model of the corresponding organs. The soft tissue organs such as the bladder, uterus, ovary, and rectum as well as the implant in the TVUS slice and in the MR slices are segmented. Based on the available data and information, the initial solution ϕ
                        0 for both algorithms is chosen as follows: (1) the TVUS contour globally matches the middle MR slice and (2) the 2D version of the proposed method with λ
                        =0.8 is used to locally register the TVUS contour to the middle MRI slice contour. To show how our method improves diagnosis, we use 10 different patients to localize small implants.


                        Fig. 10
                         shows registration results for multiple surfaces. Fig. 10(a) shows the 2D TVUS slice. In this figure, the soft tissue organs (ovary and bladder) and the endometrial implant can be identified by red and yellow, respectively. Fig. 10(b) shows MR slices with slice thickness of 5mm. In this figure, the boundaries of the ovary and bladder are segmented from four MR slices and the 3D surfaces are reconstructed. We then use both one-step and two-step ICP to find the best transformation to embed the 2D TVUS slice onto the 3D MR surface. The registration results for the proposed method and two-step ICP are depicted in Fig. 10(c) and (d), respectively. Fig. 10(e) illustrates the overlap images where the middle belongs to the rendered MR image and the top and bottom belong to the TVUS image. The resulting displacement field (Fig. 10(g) and (h)) is used to map the endometrial implant shape onto the MR surface, see Fig. 10(i) and (j). The overlap image (Fig. 10(f)) visually indicates that the bladder cannot be aligned by two-step ICP which leads to a low registration accuracy and inaccurate localization. On the other hand, Fig. 10(e) shows that our method aligns both organs with high precision while it is generating smooth deformation field (Fig. 10(g)).

The accuracy of proposed method is also evaluated by a pelvic radiologist. A precise registration algorithm must accurately align all corresponding organs and pelvic anatomical structures across modalities. The expert uses these features to visually assess our registration method. We provide the following data to the expert: MR slices, 3D patient-specific organ model(s), TVUS planar image, embedded TVUS surface, rendered MR image, and embedded TVUS surface with 3D MR surface. We setup a registration quality score where 5 is excellent and 1 is bad. The expert evaluation is given in Fig. 11
                        (a). The dash line means that the expert could not evaluate the results. Fig. 11(a) shows that our method mainly provides high registration accuracy, except for patient 9. From the expert's point of view, the registration results for patient 9 could not be evaluated since all organs (bladder and uterus) and pelvic anatomical structures (cervix and vaginal wall) in the TVUS surface were to be compared with 4 different MR slices (see Fig. 11(b)).

@&#DISCUSSION@&#

The main advantages of TVUS-MR slice-to-volume registration over 2D/2D image registration are twofold. First, this approach removes the assumption that the TVUS slice corresponds to a MR slice. In our context, it is important to discard this assumption, since the goal of endometriosis treatment is to resect the endometriosis without harming the surrounding healthy tissue. To achieve this goal, we need very accurate procedures in order to precisely localize endometriosis and enhance preoperative surgical planning. Slice-to-volume registration is then needed. As mentioned before, each slice of the MR volume can just depict the location of large tissues, and combination of all these slices can help the surgeons to visually reconstruct 3D structures of the patient's pelvic organs. However, such a reconstruction is prone to large error, since the pelvis has complex 3D structures. So a computer-aided reconstruction system must be used to accurately reconstruct 3D models of the patient's organs. This simply enhances the anatomy of this complex part of the body. Thus, the second advantage of slice-to-volume registration is that the surgeons do not need to deeply investigate each imaging modality, since all the necessary information needed to make an accurate preoperative surgical planning are provided as a new volumetric image which removes redundant information. This new image contains the patient-specific organ model from 3D MR volume as well as shape, size, location, depth of infiltration of the endometrial implants from 2D TVUS images. This new image is promising to ease the task of surgeons to make better decisions to avoid under- or over-cutting during surgery.

We evaluate the performance of the proposed method in comparison with two-step deformable ICP. The quantitative error measurements on semi-synthetic data sets provide an assessment of our algorithm in a simulated clinical context. To demonstrate the applicability in real applications, we also conduct tests on 10 real cases. Qualitative and quantitative tests on semi-synthetic data and clinical data sets clearly depict the accuracy of our method. Experimental error analysis shows that our method remarkably reduces the error compare to two-step ICP. Experimentally, we see that the proposed algorithm has 45% higher registration accuracy on average than two-step ICP, from which we can conclude that our procedure is less sensitive to increment of deformation and slant and can provide reliable results in real conditions.

We have proposed a new framework for deformable slice-to-volume registration to localize and characterize endometrial implants. Our method uses a variational one-step deformable ICP method that registers a set of 2D contours to a set of corresponding 3D surfaces. It computes a dense deformation field embedding the TVUS domain in the MR coordinate frame while establishing point correspondences automatically. In order to obtain point correspondences and nonlinear deformations, the method uses distance maps resulting from MR surfaces. To make our algorithm more stable, we use a least squares planar constraint on the warped surface. Applying this strong constraint on the original TVUS surface improves convergence. We evaluate the proposed method's performance in comparison with two-step deformable ICP. The performances of the proposed method are tested by quantitative and qualitative measurements on semi-synthetic and real world data sets. The results obtained on semi-synthetic datasets concluded that the overall performance of the proposed method in terms of global and local registration accuracies are better compared to the two-step ICP algorithm, and thus could be feasibly applied for automatic localization of endometriosis.

From a clinician's point of view, two related questions have not yet been answered. The first one is how much registering a 2D TVUS with a 3D MR can improve the surgery planning. The second one is what the influence is of mapping an endometrial implant into a 3D patient-specific organ model on the surgery. Therefore, we have yet to perform medical examinations to find out answers to these questions. To achieve this, some patients with symptomatic disease who underwent surgery must be selected in the study. Next, surgeons can investigate both MR and TVUS data, separately, and then make pre-operative surgical planning, in which the location of implants and resection lines must be clearly define on the MR images. Finally, the classical procedure of making surgical planning and our method must be compared to surgery results. In this manner, we may observe the accuracy of the surgical planning based on the classical procedure and ours.

@&#REFERENCES@&#

