@&#MAIN-TITLE@&#Cardiorespiratory fitness estimation in free-living using wearable sensors

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           Used machine learning methods to determine multiple level of context in free living and contextualize heart rate data.


                        
                        
                           
                           Estimated cardiorespiratory fitness (CRF) using contextualized heart rate in free living, without laboratory protocols.


                        
                        
                           
                           Reduced CRF estimation error by up to 22.6% compared to other methods.


                        
                        
                           
                           The proposed CRF estimation method does not require specific exercise and was validated against VO2max.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Context recognition

Topic models

Bayesian models

Cardiorespiratory fitness

@&#ABSTRACT@&#


               
               
                  Objective
                  In this paper we propose artificial intelligence methods to estimate cardiorespiratory fitness (CRF) in free-living using wearable sensor data.
               
               
                  Methods
                  Our methods rely on a computational framework able to contextualize heart rate (HR) in free-living, and use context-specific HR as predictor of CRF without need for laboratory tests. In particular, we propose three estimation steps. Initially, we recognize activity primitives using accelerometer and location data. Using topic models, we group activity primitives and derive activities composites. We subsequently rank activity composites, and analyze the relation between ranked activity composites and CRF across individuals. Finally, HR data in specific activity primitives and composites is used as predictor in a hierarchical Bayesian regression model to estimate CRF level from the participant's habitual behavior in free-living.
               
               
                  Results
                  We show that by combining activity primitives and activity composites the proposed framework can adapt to the user and context, and outperforms other CRF estimation models, reducing estimation error between 10.3% and 22.6% on a study population of 46 participants.
               
               
                  Conclusions
                  Our investigation showed that HR can be contextualized in free-living using activity primitives and activity composites and robust CRF estimation in free-living is feasible.
               
            

@&#INTRODUCTION@&#

In the past few years, ubiquitous sensing technologies showed unprecedented insights into the relation between physical activity and health [1]. Wearable sensors are getting more and more widespread due to improvements in miniaturization, battery capacity and user experience design, reaching ubiquitousness in the quantified-self community and being rapidly adopted by the general population. Due to fast paced technological developments and increased availability of multivariate data streams acquired from wearable sensors (e.g. accelerometer, physiological data), new computational and artificial intelligence applications and techniques have been developed. When deployed in unsupervised free-living settings computational and artificial intelligence techniques can help shedding light on the complex relation between human behavior and health, ultimately driving behavioral change and better health outcomes [2–5].

Wearable sensors have great potential for accurate physical activity monitoring in daily life [2,3]. However, artificial intelligence capabilities of current systems and devices are limited, with almost all solutions focusing on behavioral aspects of physical activity such as steps, activity type and energy expenditure [6,7]. On the other hand, cardiorespiratory fitness (CRF) is a marker of cardiovascular and cardiorespiratory health, and therefore is a key health parameter that could be estimated using state of the art technologies and computational methods [8–10].

CRF is defined as the ability of the circulatory and respiratory systems to supply oxygen during sustained physical activity and is considered among the most important determinants of health and wellbeing. CRF is not only an objective measure of habitual physical activity, but also a useful diagnostic and prognostic health indicator for patients in clinical settings, as well as healthy individuals [8]. Epidemiological research has shown that in both individuals affected by disease [11] and healthy individuals [12,13] higher level of CRF resulted in better outcomes in term of slower disease progression, lower risk of cardiovascular disease as well as lower risk of all cause mortality. Thus, knowledge of CRF can be key in managing a healthy lifestyle.

Current practice for CRF measurement is direct measurement of oxygen volume (VO2 in ml/min) during maximal exercise (i.e. VO2max), the gold standard. However, VO2max tests are affected by multiple limitations. Medical supervision is required and the test can be risky for individuals in non-optimal health conditions. Less risky submaximal tests have also been developed [14]. Submaximal tests to estimate CRF typically require measuring heart rate (HR) while running at a certain speed or biking at a certain intensity. The inverse relation between HR at a certain exercise intensity, fixed by the strict exercise protocol that has to be sustained, and fitness, is the rationale behind this approach.

In this work, we propose to use artificial intelligence methods to estimate CRF using wearable sensor data acquired in free-living. We rely on the inverse relation between HR and fitness, but without the need for specific exercise protocols in laboratory settings. We aim at using computational techniques to automatically determine contexts in which HR can be interpreted, without any supervision from the user, and in free-living. Our hypothesis is that physiological data, for example HR, in free-living settings is not only affected by activity primitives such as walking, but by a combination of activity primitives and more abstract activity composites such as social interactions, working, etc. We define context as a combination of activity primitives and activity composites. Thus, we propose a method to determine both activity primitives and activity composites, to contextualize HR. Finally, after determining the user's context, we use contextualized HR to estimate person-specific CRF in a hierarchical Bayesian model. By using a non-nested hierarchical Bayesian model, parameters can vary depending on the activity performed, therefore being more flexible than models requiring specific activities. This paper provides the following contributions:
                        
                           1.
                           We propose a context recognition framework to contextualize HR and estimate CRF based on contextualized HR in free-living. First, we use topic models (TMs) to derive activity composites. Secondly, we rank activity composites to determine which activity composites are best suited for CRF estimation. Finally, we use HR data in specific contexts (i.e. activity primitives, walking speeds and activities composites) as a predictor in a hierarchical Bayesian model to estimate CRF.

We show the effectiveness of the proposed approach to estimate CRF on a dataset including 14 days of unsupervised free-living recordings from 46 participants and reference VO2max acquired in laboratory conditions. CRF estimation error was reduced between 10.3% and 22.6% compared to alternative methods.

@&#RELATED WORK@&#

Energy expenditure is the most commonly used metric to quantify physical activity. Accelerometers and HR monitors are the most commonly used single sensor devices in epidemiologic studies and consumer products. Different methods have been developed in the past to monitor physical activity using such accelerometer and HR monitors. Typically, accelerometer-based systems rely on the relation between motion intensity close to the body's center of mass and energy expenditure. Using a single accelerometer prevents discriminating upper and lower body movement, e.g. biking and arm exercises, leading to large estimation error for activities not involving whole body motion. For example, Crouter and Bassett [15] had to remove biking activities from their evaluation, due to the inability of their system to capture physical activity when there is limited motion close to the body's center of mass.

Recent work showed that introducing artificial intelligence methods, activity type can be reliably detected with wearable sensors, opening new opportunities for physical activity monitoring [17–21]. Similarly, several activity trackers and wearable sensors have been released on the market in the recent past, typically providing users with estimates of calories burnt and steps taken (e.g. Fitbit). While activity type, energy expenditure, steps, etc. are important, they reflect only individual behavior, but do not provide insights on the individual's actual health status. CRF can potentially provide more information on an individual's health status, being a marker of cardiovascular and cardiorespiratory health, and therefore a key health parameter [8–10]. Thus, our work aims at moving beyond quantification of human behavior, and towards quantification of health status as derived by CRF.

VO2max is regarded as the most precise method for determining CRF [22]. Despite the indubitable importance of CRF in health, measurements of VO2max are rare since they require specialized personnel and expensive equipment. The high motivation demand and exertion of the participants makes the test unfeasible in many patients groups [23]. As an alternative, many non-excercise and submaximal models have been developed. Non-exercise modellaboratory-based of CRF use easily accessible characteristics such as age, gender and self-reported physical activity [24,25]. However, for individuals with similar characteristics, CRF levels cannot be discriminated, as shown in Fig. 1
                        . Submaximal tests have been developed to estimate VO2max during specific protocols while monitoring HR at predefined workloads [14]. Contextualized HR, e.g. HR while performing a specific activity in laboratory settings, is discriminative of CRF levels between individuals with similar characteristics, due to the inverse relation between HR and CRF [26] (see Fig. 1). Commercial devices, for example some sport watches paired to HR monitors [27,28] (e.g. Garmin or Polar devices), provide CRF estimation using a regression model including HR at a predefined running speed as predictor. However, submaximal tests are still affected by limitations; the test should be re-performed every time CRF needs to be assessed, often requires laboratory infrastructure and specific activities to be performed [29].

While some devices and methods were developed to provide CRF estimation while performing intense exercise or under laboratory settings, very few systems and algorithms developed up to now focus on providing CRF estimation in free-living settings [26]. Using wearable sensor in free-living to estimate VO2max is a novel approach. The estimation could be applied to a larger population compared to maximal or submaximal laboratory tests. Individuals not performing sports could still benefit from knowing more about their health status, via estimates of CRF, and potentially be motivated to take up a more active lifestyle.

Preliminary work explored the relation between physical activity as expressed by a step counter, and CRF [30]. While number of steps can provide useful insights, the relation between HR and oxygen uptake at a certain exercise intensity cannot be exploited using motion based sensors. Plasqui and Westerterp [26] showed that a combination of average HR and level of motion over a period of seven days correlates significantly with VO2max. However, the relation between average HR and activity counts depends on the amount of activity performed [26]. Tonis et al. [31] explored different parameters to estimate CRF from HR and accelerometer data during activities of daily living simulated in laboratory settings. However VO2max reference and free-living data were not collected.

When moving towards free-living settings, HR is more difficult to interpret, since activities vary depending on the different lifestyles people adopt. However, contextualizing HR in free-living settings using pattern recognition and artificial intelligence methods opens an opportunity to bring sub-maximal tests to uncontrolled free-living conditions.

We hypothesized that HR in free-living settings is not only affected by activity primitives but by a combination of activity primitives and more abstract activity composites. Thus, we consider as context a combination of activity primitives and activity composites. For example, HR during the activity primitive sedentary changes substantially depending on the context in which such activity is performed. HR during social interactions is higher than during work for sedentary activities, possibly due to the higher physiological stress involved in talking and interacting with other people, as shown in Fig. 2
                        . Thus, CRF estimation models might benefit from inclusion of activity composites representing additional factors present in free-living (e.g. psychological stress, interactions with other people, etc.).

Various pattern recognition and artificial intelligence methods have been proposed to determine context and activities in literature. Typically, activities are thought of in a hierarchical manner, starting from activity primitives, to more abstract activity composites [32].

An example of activity primitives can be a set of postures and locomotion activities, such as: lying down, sedentary, dynamic, walking, biking and running, as determined using supervised methods in previous research  [16]. On the contrary, higher level contextual information, such as activity composites, require a different recognition approach. Such activities are personal and need unsupervised methods able to discover different patterns in each individual, depending on their behavior. A possible solution is the use of TMs  [33]. In activity recognition, TMs were applied to discover activity composites from activity primitives [34]. Recent work investigated the impact of multiple TMs (in particular LDA, latent Dirichlet allocation) parameters for activity composites discovery, showing promising results [35] for recognition of abstract activity composites.

In our previous work [36], we proposed a method to determine which activity composites are better suited to interpret HR for one individual. For example, we determined in which activity composites HR was more representative of HR normalization parameters used to personalize EE estimates. Our approach consisted of ranking activity composites based on features in order to compare them across participants. In this work, we extend our method to the relation between HR during activity composites and VO2max. We aim at finding for each individual specific contexts where HR is representative of CRF in free-living, using an unsupervised approach. Then, we use contextualized HR to predict CRF without the need for laboratory tests or specific exercises.

Following a top down approach, CRF y
                     
                        CRF
                      was estimated from contextualized HR 
                        
                           
                              HR
                              ¯
                           
                           
                              ctx
                              *
                           
                        
                      and anthropometric characteristics by a hierarchical Bayesian regression model, as shown in Fig. 3
                     . Contextualized HR 
                        
                           
                              HR
                              ¯
                           
                           
                              ctx
                              *
                           
                        
                      refers to HR during specific activity primitives, speeds and relevant activity composites. We used features from accelerometer X
                     
                        acc
                     , HR X
                     
                        hr
                     , location X
                     
                        coo
                      and anthropometrics X
                     
                        ant
                      as input to our context recognition and CRF estimation models. Activity primitives c were used together with stay regions sr as input for LDA topic discovery to obtain activity composites. Activity composites were ranked to find the most relevant ones for CRF estimation, referred to as relevant activity composites (see Section 3.3 for details). The procedure to determine activity primitives, speeds, activity composites, and therefore contextualized HR 
                        
                           
                              HR
                              ¯
                           
                           
                              ctx
                              *
                           
                        
                      is shown in Fig. 4
                     .

In the remaining of this section, we detail the approach and provide an example. We consider walking at 3 and 5 km/h as exemplary activity primitives and speeds. Thus, to determine contextualized HR, we consider HR data while walking at 3 and 5 km/h during relevant activity composites.

The CRF estimation y
                        
                           CRF
                         was derived by a hierarchal Bayesian regression model. Parameters modeling the relations between 
                           
                              
                                 HR
                                 ¯
                              
                              
                                 ctx
                                 *
                              
                           
                         and y
                        
                           CRF
                         vary depending on the context ctx. We denote the estimation model as:
                           
                              (1)
                              
                                 
                                    
                                       
                                          
                                             y
                                             
                                                
                                                   CRF
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          ∼
                                       
                                       
                                          N
                                          (
                                          
                                             X
                                             
                                                
                                                   CRF
                                                   p
                                                
                                             
                                          
                                          
                                             β
                                             CRF
                                          
                                          +
                                          
                                             X
                                             
                                                ctx
                                                [
                                                p
                                                ]
                                             
                                          
                                          
                                             β
                                             
                                                ctx
                                                [
                                                p
                                                ]
                                             
                                          
                                          ,
                                          
                                             σ
                                             CRF
                                             2
                                          
                                          )
                                          ,
                                       
                                    
                                    
                                       
                                          ctx
                                       
                                       
                                          =
                                       
                                       
                                          1
                                          ,
                                          …
                                          ,
                                          R
                                          
                                          p
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          np
                                       
                                    
                                    
                                       
                                          
                                             X
                                             
                                                
                                                   CRF
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          [
                                          1
                                          ,
                                          
                                             X
                                             
                                                
                                                   ant
                                                   p
                                                
                                             
                                          
                                          ]
                                          ∈
                                          
                                             
                                                
                                                   ℝ
                                                
                                             
                                             
                                                np
                                                ×
                                                (
                                                D
                                                +
                                                1
                                                )
                                             
                                          
                                          ,
                                          
                                          p
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          np
                                       
                                    
                                    
                                       
                                          
                                             X
                                             ctx
                                          
                                       
                                       
                                          =
                                       
                                       
                                          [
                                          
                                             
                                                HR
                                                ¯
                                             
                                             
                                                ctx
                                                *
                                             
                                          
                                          ]
                                          ∈
                                          
                                             
                                                
                                                   ℝ
                                                
                                             
                                             
                                                np
                                                ×
                                                1
                                             
                                          
                                          ,
                                          
                                          p
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          np
                                       
                                    
                                 
                              
                           
                        where matrix 
                           
                              X
                              
                                 
                                    CRF
                                    p
                                 
                              
                           
                         is of dimension np
                        ×(D
                        +1). np is the number of participants, while D the number of anthropometric characteristics 
                           
                              X
                              
                                 
                                    ant
                                    p
                                 
                              
                           
                         for a person p, which includes body weight, height, age and sex. The associated parameters β
                        
                           CRF
                         do not vary by context ctx since they are relative to a person and remain the same across different activities. Contexts ctx are a set R representing a combination of activity primitives and speeds during relevant and activity composites, as shown in Fig. 3. In our example, contexts are R
                        =2, i.e. walking at 3 or 5km/h during relevant activity composites, and control the parameters β
                        
                           ctx
                         for the predictor 
                           
                              
                                 HR
                                 ¯
                              
                              
                                 ctx
                                 *
                              
                           
                        . By letting the parameters β
                        
                           ctx
                         vary, users are not constrained to one specific activity. Instead, the model will provide a CRF estimate y
                        
                           CRF
                         depending on the available activity primitives and speeds. Details on the model parameters estimation procedure are reported in Section 5.

In this section we introduce our context recognition architecture to determine contextualized HR 
                           
                              
                                 HR
                                 ¯
                              
                              
                                 ctx
                                 *
                              
                           
                        , as shown in Fig. 4. Activity composites were discovered using LDA. LDA is a generative probabilistic model which discovers K activity composites, from S time windows of N words y
                        
                           n
                        . For activity recognition, words y
                        
                           n
                         are typically basic building blocks for activity composites, such as activity primitives. In our implementation we used stay regions and activity primitives (see Section 5) as words y
                        
                           n
                        . Accelerometer features X
                        
                           acc
                         were used to derive activity primitives c
                        
                           i
                         combining a Support Vector Machines (SVM) classifier and subsequent Hidden Markov Models (HMM) used to smooth transitions between activities. The hidden states corresponded to the real activity composites, c
                        
                           i
                        , while the observable states are the ones recognized by the SVM. Stay regions were derived from GPS coordinates X
                        
                           coo
                         using time and distance thresholds (see Section 5). According to the generative process, for each word y
                        
                           n
                        , we first draw the activity composite z
                        
                           n
                        . z
                        
                           n
                         is a scalar z
                        ∈1:
                        K indicating the activity composite for time window n. Each assigned activity composite z
                        
                           n
                         is derived from a multinomial distribution defined by the parameter θ
                        
                           s
                        . θ
                        
                           s
                         is the distribution over activity composites for time window s:
                           
                              (2)
                              
                                 
                                    θ
                                    s
                                 
                                 ∼
                                 Dir
                                 (
                                 α
                                 )
                                 ,
                                 
                                 1
                                 ≤
                                 s
                                 ≤
                                 S
                              
                           
                        
                        
                           
                              (3)
                              
                                 
                                    z
                                    n
                                 
                                 ∼
                                 Mult
                                 (
                                 
                                    θ
                                    s
                                 
                                 )
                                 ,
                                 
                                 1
                                 ≤
                                 s
                                 ≤
                                 S
                                 ,
                                 
                                 1
                                 ≤
                                 n
                                 ≤
                                 N
                              
                           
                        
                     

LDA defines θ
                        
                           s
                         as a Dirichlet distribution with hyperparameter α. Then, another multinomial is used to choose a word y
                        
                           n
                        , conditioned on the activity composite z
                        
                           n
                        , p(y
                        
                           n
                        |z
                        
                           n
                        ):
                           
                              (4)
                              
                                 
                                    y
                                    n
                                 
                                 ∼
                                 Mult
                                 (
                                 
                                    β
                                    
                                       
                                          z
                                          n
                                       
                                    
                                 
                                 )
                                 ,
                                 
                                 1
                                 ≤
                                 n
                                 ≤
                                 N
                              
                           
                        
                     

Where β is defined as the probability of each word n ∈ 1 : N for topic z. The joint distribution can be specified as:
                           
                              (5)
                              
                                 p
                                 (
                                 y
                                 ,
                                 z
                                 ,
                                 θ
                                 ,
                                 ϕ
                                 |
                                 α
                                 ,
                                 β
                                 )
                                 =
                                 
                                    ∏
                                    
                                       s
                                       =
                                       1
                                    
                                    S
                                 
                                 ∫
                                 p
                                 (
                                 
                                    θ
                                    s
                                 
                                 ,
                                 α
                                 )
                                 
                                    ∏
                                    
                                       n
                                       =
                                       1
                                    
                                    N
                                 
                                 
                                    ∑
                                    
                                       z
                                       =
                                       1
                                    
                                    K
                                 
                                 p
                                 (
                                 
                                    z
                                    
                                       sn
                                       |
                                       
                                          θ
                                          s
                                       
                                    
                                 
                                 )
                                 p
                                 (
                                 
                                    y
                                    sn
                                 
                                 |
                                 
                                    z
                                    sn
                                 
                                 ,
                                 β
                                 )
                                 d
                                 
                                    θ
                                    s
                                 
                              
                           
                        
                     

We were interested in estimating the distributions of the parameter θ
                        
                           s
                        . Multiple activity composites were derived by LDA in each time window s, each activity composite being assigned a probability. For each time window we considered only the activity composite maximizing θ
                        
                           s
                        , indicated hereafter as z
                        
                           s
                        , the window's main activity composite.

During the training phase, the HR for activity primitives and speeds was computed for each main activity composite z
                        
                           s
                         and participant par. Accelerometer features X
                        
                           acc
                         were used to estimate walking speed as y
                        
                           speed
                        
                        =
                        X
                        
                           speed
                        
                        β
                        
                           speed
                        
                        +
                        ϵ, X
                        
                           speed
                        
                        ={X
                        
                           acc
                        , X
                        
                           ant
                        }. The resulting matrix HR
                        
                           ctx
                         is of dimension K
                        ×
                        npar, where K is the number of activity composites and npar is the number of participants. LDA-derived activity composites do not include semantics and cannot be compared across participants. To overcome the problem of comparing activity composites, we characterized them with a set of features T which we used to rank activity composites, as in [36]. In order to provide a generalized method that is applicable to new participants, we chose features T that are independent of a person's lifestyle, for example, T
                        1
                        ∈
                        T could be the relative time spent sedentary in each activity composite for the different participants. Regardless of what a person's lifestyle is, it will always be possible to order LDA-derived activity composites by feature T
                        1, e.g. the relative time spent sedentary in each activity composite. Then, HR
                        
                           ctx
                         was ranked by feature T
                        1, providing a way to investigate the relation between the HR in different activity composites and CRF, across participants. The ranking orders HR
                        
                           ctx
                         by values of T
                        1 from maximum to minimum. Since we are interested in highlighting commonalities across activities composites, ranked HR
                        
                           ctx
                         are smoothed by a moving average, resulting in 
                           
                              
                                 HR
                                 ¯
                              
                              ctx
                           
                        . As a result, we obtain an array of k ranked HR values per participant. We conclude the training phase by determining which feature in T maximizes Pearson's correlation between 
                           
                              
                                 HR
                                 ¯
                              
                              ctx
                           
                         and CRF. We define the vector of correlations r
                        
                           T
                         for a set of TN features in a context ctx. Thus, for each context ctx, we have:
                           
                              (6)
                              
                                 
                                    r
                                    T
                                 
                                 =
                                 {
                                 
                                    r
                                    
                                       
                                          rank
                                          
                                             T
                                             1
                                          
                                       
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    r
                                    
                                       
                                          rank
                                          TN
                                       
                                    
                                 
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (7)
                              
                                 
                                    r
                                    
                                       
                                          rank
                                          i
                                       
                                    
                                 
                                 =
                                 r
                                 
                                    
                                       
                                          
                                             
                                                HR
                                                ¯
                                             
                                             
                                                
                                                   ctx
                                                   
                                                      par
                                                      =
                                                      {
                                                      1
                                                      ,
                                                      …
                                                      ,
                                                      npar
                                                      }
                                                      ,
                                                      i
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             CRF
                                             
                                                par
                                                =
                                                {
                                                1
                                                ,
                                                …
                                                ,
                                                npar
                                                }
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              r
                              
                                 
                                    rank
                                    i
                                 
                              
                           
                         is the correlation between the vector of contextualized HR 
                           
                              
                                 HR
                                 ¯
                              
                              ctx
                           
                         and CRF, among all participants par for a feature T
                        
                           i
                         in a context ctx. The activity composite providing the highest correlation was selected, i.e. the first element of the 
                           
                              
                                 HR
                                 ¯
                              
                              ctx
                           
                         vector across individuals and CRF, to determine which feature T
                        
                           i
                         results in activity composites most representative of CRF. Thus, the feature T
                        
                           i
                        
                        =maxr
                        
                           Tctx
                         showing the highest correlation between 
                           
                              
                                 HR
                                 ¯
                              
                              ctx
                           
                         and CRF is chosen to determine relevant activities composites.

As an example, we consider as contexts ctx walking at 5km/h during activity composites with the maximum relative time spent sedentary, i.e. relevant activity composites, as shown in Fig. 5
                        . We first determine the vector of k elements HR
                        
                           ctx
                        , representing the mean HR while walking at 5km/h in each LDA-discovered activity composite. Then, HR
                        
                           ctx
                         are ranked based on the feature T
                        
                           i
                         maximizing the correlation on our training set (i.e. the relative time spent sedentary in each activity composite), to determine 
                           
                              
                                 HR
                                 ¯
                              
                              
                                 ctx
                                 *
                              
                           
                        . The first element of the ranked and smoothed 
                           
                              
                                 HR
                                 ¯
                              
                              ctx
                           
                         vector, is the contextualized HR 
                           
                              
                                 HR
                                 ¯
                              
                              
                                 ctx
                                 *
                              
                           
                        , used as input for CRF estimation (Fig. 6
                        ).

Participants were 46 (21 male, 25 female), age 24.7±4.9 years, weight 68.6±10.9kg, height 172.8±8.9cm, BMI 22.9±2.5kg/m2 and VO2max 3020.8±668.9ml/min. Written informed consent was obtained, and the study was approved by the ethics committee of Maastricht University. The sensor platform used was an ECG Necklace, a platform configured to acquire one lead ECG data at 256Hz, and three-axial accelerometer data at 32Hz. The ECG Necklace was worn on the chest, close to the body's center of mass. The ECG Necklace was worn during laboratory protocols and free-living. Additionally, during free-living each participant carried a Samsung Galaxy S3 used to record GPS coordinates at 5min intervals. Reference CRF was determined as VO2max, by means of an incremental test on a cycle ergometer [37] using a indirect calorimeter that analyzed O2 consumption and CO2 production. The dataset considered for this work contains 507 days of data collected from 46 participants in free-living, thus for each participant we acquired about 11 days of accelerometer, ECG and GPS data. Compared to the two-week protocol, available data per participants varied between 7 and 14 days, due to participant availability, sensor failures and power outages, as participants forgot to recharge, causing data losses. Nevertheless, we consider that the recordings were sufficient to capture the behavior of each participant. 75h of laboratory recordings including reference VO2, VCO2, acceleration, ECG and VO2max were also obtained for model validation.

We collected data in free-living and laboratory settings and evaluated four approaches to CRF estimation. All approaches were evaluated with respect to reference CRF measured by means of a VO2max test carried out on a cycle ergometer. In the remaining of this paper, we will use the following terminology to characterize the four estimation conditions that were used for comparison; (a) anthropometrics: no HR data was used, (b) no-context: HR in free-living was used directly to estimate CRF, (c) primitives: HR in free-living was contextualized using activity primitives and speed, (d) composites: HR in free-living was contextualized using activity primitives, speed and relevant activity composites.

Two laboratory protocols were designed and implemented for each participant on two separate days to avoid the maximal fitness test to affect physiological parameters during less intense activities and vice versa. Additionally, each participant wore the ECG Necklace in free-living for 14 days. All results on CRF estimation were obtained from the free-living data, whereas the laboratory data was used to derive the models, as detailed in the next sections.

Data from laboratory protocols were used to develop supervised methods for activity type recognition and walking speed estimation. Activity type recognition and walking speed estimation models were deployed in free-living and used as building blocks to contextualize HR. Additionally reference VO2max was collected under laboratory protocols to validate the proposed CRF estimation models. Data collected in free-living were used to determine contextualized HR and use contextualize HR as predictor for CRF estimation. CRF estimation models including contextualized HR as predictor relied on; laboratory-validated activity type recognition and walking speed estimation models, stay regions determined without supervision in free-living (see Section 5) and activity composites determined using LDA, in free-living.

Participants reported at the lab on three separate days and after refraining from drinking, eating and smoking in the two hours before the experiment. Two laboratory protocols were performed. The first protocol included simulated activities performed while wearing a portable indirect calorimeter. Activities included: lying down, sitting, sit and write, standing, cleaning a table, sweeping the floor, walking (treadmill flat at 2.5, 3, 3.5, 4, 4.5, 5, 5.5, 6km/h) and running (treadmill flat at 7, 8, 9, 10km/h). Activities were carried out for a period of at least 4min. The second protocol was a VO2max test providing reference data for biking and CRF. The third day was used for anthropometric measurements including the participant's body weight, height and body fat assessed using doubly labelled water [38].

Participants worn the ECG necklace for 14 consecutive days in free-living and manually annotated their activity composites in a paper diary. Participants were instructed to annotate activity composites as they occurred during the day and to annotate only activity composites such as going to work, sleeping, commuting, etc. Annotated activity composites were not used for model development since activity composites were derived using LDA, and therefore without supervision from activity primitives, as detailed in Sections 3 and 5. The annotations were only used to interpret the LDA and CRF estimation results as detailed in the discussion, Section 7. Activity composites can only be determined from free-living data, since they cannot be simulated under laboratory conditions. Participants carried a Samsung S3 phone and were instructed to charge both the ECG Necklace and phone and to change electrodes daily.

All models were derived using leave-one-participant-out cross validation. The same training set, consisting of data from all participants but one, was used to build feature selection, activity recognition, walking speed estimation and CRF estimation models. The remaining data were used for validation. The procedure was repeated for each participant and results were averaged. LDA models were built on data from the participant to be validated, since no reference or training set are necessary. Performance of the activity recognition models was evaluated using the class-normalized accuracy, in laboratory recordings. Results for walking speed estimation and CRF estimation are reported in terms of Root-mean-square error (RMSE) and Pearson's correlation (r), where the outcome variables were speed in km/h and CRF in ml/min, respectively. Paired t-tests were used to compare RMSE between models.

@&#IMPLEMENTATION@&#

Accelerometer data from the three axes were segmented in 5s windows, band-pass filtered between 0.1 and 10Hz, to isolate the dynamic component due to body motion, and low-pass filtered at 1Hz, to isolate the static component, due to gravity. Feature selection for activity type recognition was based on results from our previous work [19], using a different dataset. Selected features were: mean of the absolute signal, inter-quartile range, median, variance, main frequency peak, low frequency band signal power. Accelerometer features for walking speed estimation were: mean of the absolute signal, inter-quartile range, variance, main frequency peak, high frequency band signal power. HR was determined from RR intervals extracted from raw ECG data and averaged over 15s windows.

Laboratory activities were grouped into six clusters to be used for classification of activity primitives. The six clusters were lying (lying down), sedentary (sitting, sit and write, standing), dynamic (cleaning the table, sweeping the floor), walking, biking and running. Activity primitives were derived combining a SVM and HMM. For the SVMs, we used a Gaussian radial basis kernel (cost function parameter C
                           =1). Parameters were set based on previous work from our group [21]. The HMM is defined by parameters λ
                           =(π, A, B); where π are the initial state probabilities, A is the transition probability matrix, defining the probability of transitioning between one activity to the other at time interval t. The HMM states corresponded to activity primitives. B is the emission matrix, which defines the probability of getting an emission at time t, given the state. We implemented the emission matrix B as b
                           
                              ij
                           
                           =0.5⇔
                           i
                           =
                           j, b
                           
                              ij
                           
                           =0.1⇔
                           i
                           ≠
                           j, while transitions probabilities A between actual states were derived from training data. Training data was the SVM classification result obtained with reference activity primitives manually annotated in laboratory settings.

Walking speed was estimated using a multiple regression model using as predictors the features listed in Section 5.1.1, together with the participant's height. Laboratory recordings on a treadmill while walking at different speeds were used to build participant-independent walking speed models.

Stay regions were computed from GPS coordinates according to time and distance thresholds, which were set to 60min and 1km according to previous literature [39]. The time threshold ensures that each stay region is a location where the participants spent a significant amount of time, while the distance threshold ensures that noisy recordings do not result into a multitude of stay regions being detected. GPS data was collected at 5min intervals to conserve battery power. The relatively wide distance and time thresholds were chosen due to the low frequency of the GPS recordings.

Input primitives for LDA were occurrences histograms of stay regions and activity primitives in each time window s. LDA hyperparameter α was set to 0.01, while segment size and number of topics k were set to 15min and 20 topics, respectively, based on results obtained in previous research [35]. Parameters were optimized using an implementation of the variational expectation–maximization algorithm proposed in [33]. HR during activities composites HR
                           
                              ctx
                            was ranked according to different features T: amount of time spent in each activity composite, relative amount of time spent in each activity primitive for an activity composite, with respect to the total time spent in the same activity primitive across all activities composites and relative time spent in each activity primitive per activity composite. These features were chosen since they can be computed across participants and activities composites regardless of the participant lifestyle or activity composite semantics. Ranked HR
                           
                              ctx
                            were correlated with CRF to determine which activities composites features were more representative of CRF. Ranking of HR
                           
                              ctx
                            values was smoothed by a moving average of 2 elements, i.e. over the first two ranked activity composites. The relevant activity composites discovery procedure was also evaluated independently of the participant. Contextualized HR HR
                           
                              ctx
                            was ranked and correlated with CRF for np
                           −1 participants. The feature resulting as the most representative of CRF, i.e. the one for which correlation was maximized, was used to determine relevant activity composites for the left out participant. The procedure was repeated np times, where np was the number of participants.

Hierarchical Bayesian models for CRF estimation introduced in Section 3 were implemented using R and JAGS. Posterior parameters estimations were performed by Gibbs sampling with 3 chains and 10,000 iterations. The first 500 iterations were discarded (burn-in period). We consider reference VO2max as CRF. We chose walking at different speeds as activity primitives normally carried out by most of the population. We evaluated our VO2max estimation models using as predictor HR contextualized over a broad range of walking speeds, from 2.5 to 6km/h. The hierarchical Bayesian model to estimate CRF also included the participant's weight, age, sex and height as predictors. We implemented the models listed in Section 4 for comparison, thus estimating VO2max using anthropometric characteristics only (case anthropometrics), HR in free-living (case no-context), HR while walking at a certain speed (case primitives), and HR while walking at a certain speed relevant activity composites (case composites).

@&#RESULTS@&#

Activity primitives and walking speed were validated in laboratory settings. Class-normalized accuracy of the SVM-HMM activity recognition classifier was 95.8%. More specifically, accuracy was 98.2% for lying, 98.9% for sedentary, 83.5% for dynamic, 99.4% for walking, 96.5% for biking and 98.4% for running. Walking speed estimation RMSE was 0.37km/h.


                        Fig. 7
                         shows the absolute value of the correlation between HR and VO2max for different contexts. HR in free-living was moderately correlated with VO2max (comparison case no-context, r
                        =−0.43). Correlation between HR and VO2max in free-living was stronger for walking activity primitives, compared to no-context, ranging from −0.55 to −0.63. Correlation had a tendency to increase as speed increased, reaching the highest value for walking at 6km/h. Fig. 8
                         shows results for VO2max estimation models. RMSE between estimated and predicted VO2max when no HR data was used (case anthropometrics) was 322.5ml/min.

The relation between contextualized HR 
                           
                              
                                 HR
                                 ¯
                              
                              ctx
                           
                         (i.e. including relevant activity composites) and VO2max was maximized ranking activities composites by feature T
                        
                           i
                        
                        = relative time spent sedentary within an activity composite. Correlation ranged between −0.57 and −0.71, reaching the highest value for walking at 6 km/h. Thus, correlation was consistently improved when a combination of activity primitives and relevant activity composites was used to contextualized HR, compared to no-context and activity primitives only, as shown in Fig. 7.

RMSE was reduced to 286.3 ml/min (11.3% error reduction) when including free-living HR as predictor but no contextual information (case no-context). Estimation error was further reduced for case primitives, i.e. using the HR while walking at a certain speed as predictors. More specifically, RMSE varied between 287.3 and 267.6ml/min, depending on walking speed. RMSE was reduced by 17.0% and 6.5% compared to case anthropometrics and no-context respectively, when the best model was used (i.e. walking at 6km/h). Contextualizing HR by a combination of activity primitives and activity composites provided better accuracy than any other model. RMSE varied between 268.9ml/min and 249.5ml/min, depending on walking speed. A combination of activity primitives and activity composites always outperformed activity primitives alone, as shown in Fig. 8.

Activity primitives in free-living were recognized as follows: 44.5% lying, 36.4% sedentary, 9.5% dynamic, 5.4% walking, 3.8% biking and 0.4% running. The average walking speed in free-living over the entire dataset was 3.5±1.5km/h. Participants spent 71±27min per day in walking activities, 7±5.4min walking at 6km/h.

Overall, combining activity primitives and activities composites provided error reductions up to 22.6%, 12.8% and 10.3% compared to anthropometrics, no-context and primitives respectively. Fig. 9
                         shows estimated and measured VO2max for the four models compared in this study. Explained variance (R
                        2) and RMSE are reported, showing increased R
                        2 and reduced error as more context is included. For the latter figure, only the best performing models is shown for cases primitives and composites.

@&#DISCUSSION@&#

Many methods have been developed to estimate VO2max using data collected under supervised laboratory conditions or following strict protocols. However, to the best of our knowledge, this is the first work, which proposes to use pattern recognition and artificial intelligence methods to determine activity primitives and activity composites as contextual information, and then interpret HR data in free-living. We showed RMSE reductions of 22.6% compared to estimates derived using anthropometric characteristics only, and RMSE reductions up to 10.3% compared to estimates derived using activity primitives, highlighting the benefit of our context recognition method.

We hypothesized that the presence of a multitude of factors such as psychological stress, interactions with other people, etc. in free-living required a novel approach over the prior estimation attempts used in laboratory settings. In particular, HR in free-living is not only affected by activity primitives – as shown in the lab – but by both activity primitives and activity composites. Thus, developing computational methods able to incorporate knowledge of contextual information beyond activity primitives could potentially improve interpretation of HR in free-living. Our results confirm the importance of activity composites in free-living. RMSE was consistently reduced over a broad range of walking speeds, as shown in Fig. 8. We translated the need for contextual information into a hierarchical model. In our previous work we introduced relevant activity composites for energy expenditure estimation [36]. We established relevant activity composites to relate discovered activity composites for which no supervised information exists, to behaviour-related HR.

In this work, we discovered individual activity composites of each user without identifying them. Measuring the composite discovery performance was not needed since we assessed the CRF estimation based on the LDA output. We determined which activity composites were better suited for CRF estimation by ranked them according to the correlation of selected features and HR. The approach simplified our study methodology as no activity composite annotations were required. However, discovered activity composite do not provide semantics and comparison between participants is challenging. Typically, activity composite of interest are isolated and further classified using supervised methods [34,35], thus requiring prior knowledge of the activity composites to discover, effectively limiting the unsupervised nature of the method. Ranking allowed for comparison of activity composite specific features across participants, thus making the approach unsupervised and generalizable to new participants.

We found a strong relation between the relative time spent sedentary in each activity composite and CRF. A possible explanation for the relation between HR contextualized by activity composites ranked by relative time spent sedentary in each activity composite and CRF is that activities composites in which people spend most of their time sedentary are typically representative of a stable physiological condition, which might be more representative of their CRF level. On the contrary, short or infrequent activities might involve more stressful situations as well as more intermittent HR, causing cardiovascular responses which are not as reliable for HR interpretation [40]. An example of an activity composite that maximizes the relative time spent sedentary is working at the office. While most of the time while working at the office an individual is probably sedentary, there can still be many periods of walking, that are therefore used to contextualize HR. In such periods, HR might be less affected by for example carrying loads, effects of previously performed intense exercise, walking hills, etc.) and therefore be more representative of CRF.

We relied on the inverse relation between HR at a certain workload and VO2max, as often reported for laboratory protocols. However, by using a non-nested hierarchical approach, where parameters varied based on the activities, we did not constrain the participant in performing specific activities or walking at predefined speeds. Instead, based on the participant's preferred walking speed in free-living, the optimal parameters were used. The activity primitives chosen as free-living contexts were lying down and walking, for the following reasons. First, we aimed at activities commonly performed by healthy individuals. Secondly, the inverse relation between HR at rest or sleeping HR and CRF was already shown in previous research [41,42], highlighting how this parameter can be valuable for VO2max estimation. Finally, walking activities can be discriminated in intensity, by detecting walking speed, using simply an accelerometer. Determining the specific intensity of an activity is an important factor when trying to detect specific context in free-living, since detecting only activity type, if the activity can be carried out at different intensities, would not be sufficient to determine the same context for each individual. However, walking is an activity that can be accurately quantified in terms of both type (i.e. walking) and intensity (i.e. speed). On our free-living dataset, participants spent more than an hour per day walking (71±27min), and about 10% of walking activities involved walking at 6km/h (7±5.4min). Thus, walking confirmed to be a common activity of daily life, and a good candidate to contextualize HR for CRF estimation. Noteworthy, RMSE for VO2max estimation was not consistently reduced by including in the models HR collected while walking at higher speeds. Thus, highlighting the additional complexity of analyzing HR data in free-living.

Being able to accurately determine the user context in terms of activity type and intensity allows us to bring the principle used in laboratory-based submaximal tests (i.e. the inverse relation between HR measured while performing an exercise at a certain intensity, such as biking at a fixed power on a cycle ergometer, and VO2max) to free-living settings. Contextualizing HR by means of activity primitives and speed improved correlation between free-living HR and CRF. Our approach builds on LDA and a hierarchical Bayesian model to discover activity composites and relating VO2max to behavior in a probabilistic framework. As a result, RMSE for CRF estimation against VO2max reference was reduced up to 22.6%.

The proposed CRF estimation model could be used to provide accurate information about an individual's health without the need for laboratory infrastructure or specific tests. Estimating CRF continuously in free-living creates a feedback loop from measurements to lifestyle. CRF estimates may provide the basis for many adaptive applications supporting behavior change. Moreover, CRF is not only important for fitness applications, but to health and patient care too, as CRF has known associations to disease risk. Our investigation showed that robust CRF estimation in free-living is feasible, thus confirming that the applications described above are realistic.

@&#ACKNOWLEDGMENT@&#

The authors would like to thank G. Plasqui, G. Schiavone, G. ten Velde and S. Camps for support during data collection.

@&#REFERENCES@&#

