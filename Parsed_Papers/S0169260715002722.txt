@&#MAIN-TITLE@&#Modeling skeletal bone development with hidden Markov models

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           Automated segmentation of X-ray images for skeletal bone age assessment.


                        
                        
                           
                           Hidden Markov models for bone development modelling.


                        
                        
                           
                           A software tool for supporting clinicians in the X-Ray investigation according to the TW2 clinical method.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Medical imaging

Image processing

Machine learning

@&#ABSTRACT@&#


               
               
                  This paper presents a tool for automatic assessment of skeletal bone age according to a modified version of the Tanner and Whitehouse (TW2) clinical method. The tool is able to provide an accurate bone age assessment in the range 0–6 years by processing epiphysial/metaphysial ROIs with image-processing techniques, and assigning TW2 stage to each ROI by means of hidden Markov models.
                  The system was evaluated on a set of 360 X-rays (180 for males and 180 for females) achieving a high success rate in bone age evaluation (mean error rate of 0.41±0.33 years comparable to human error) as well as outperforming other effective methods. The paper also describes the graphical user interface of the tool, which is also released, thus to support and speed up clinicians’ practices when dealing with bone age assessment.
               
            

@&#INTRODUCTION@&#

The advancements in computer science have always boosted a large number of scientific fields by both facilitating and hastening the execution of repetitive and/or complex tasks. Image processing methods, in particular, have been used in a variety of applications in diagnostic medicine since their mere conception [1,2] improving the diagnostic accuracy [3,4]. Projection radiography was the first non-invasive method to depict the internal structures of the human body and it is currently one of the most used imaging methods. During the last decades a notable increase of interest in determining accurately the bone age by processing X-Rays, has been observed. This interest arises from the fact that having an accurate and objective assessment of the age of an individual may result extremely useful in many applications ranging from detecting and evaluating hereditary, hormonal or developmental disorders [5,6] to creating indisputable evidence in legal cases where the real age of a person can determine his eligibility for criminal sanctions [7], legal rights [8], etc.

In the clinical practices, two approaches have been used for skeletal bone age assessment: the Greulich and Pyle (GP) [9] and the Tanner and Whitehouse (TW) [10] methods. Both approaches have been tested from the scientific community and their validity is already confirmed [11–14].

The GP method, which is the simplest and most intuitive one, relies on comparing a subject's X-Ray of the left wrist to a gold standard atlas categorized according to age and sex. The TW2 method uses a-priori knowledge and creates a detailed analysis of the features of twenty predetermined regions of interest (ROIs) located in the left hand's bones, including epiphysis/metaphysis ROI (EMROI), carpal ROI (CROI), radius, and ulna. Each ROI is evaluated by assigning to it a letter, which represents the developmental status, ranging from A, meaning that the bone is completely absent, to I, which represents a fully developed, mature bone. As a final step, by summing up all the ROI scores the effective bone age is calculated.

The GP method is less complicated and generally faster than the TW2 method and as a consequence the most used in the clinical practices. However, TW2 offers better reproducibility and accuracy [15] and, because of its modular nature, is proner to automation [16].

Although much research has been carried out, the problem of estimating accurately the bone age of an individual is far from being solved [17–19].

In this paper we present a method and a tool aiming at determining skeletal bone age based on X-Rays of the left wrist according to a modified version of the TW2 method based on EMROIs only, combined with hidden Markov model-based classifiers for accurate bone development modeling. In the next section a review of the existing approaches is found, while Section 3 describes the proposed method and the GUI based on it. Section 4 reports the performance analysis on a dataset of 360 X-Rays and in the last section, conclusions and future work are given.

@&#RELATED WORKS@&#

Early attempts for “automating” the process of skeletal bone age assessment can be dated back to the early 90s, and in particular, in [20] where the authors present the first system employing image processing techniques, namely Sobel Gradient and thresholding, to make the image more suitable for the bone age assessment task. Measurements of the phalanxes were compared to the standard phalangeal length table [21] and accordingly the bone age was calculated. While this method suffered from the classical “infancy” problems (e.g. image quality, reproducibility etc..), it can be considered as one of the first steps towards more complex and accurate systems for bone age assessment. Since then, many other methods for assessing skeletal bone age, especially based on the TW2 method, have proposed and they can be categorized in three main groups: fuzzy-based, deformable models-based and machine learning-based.

Fuzzy logic has been widely exploited for bones classification. In [22] the authors present an automatic skeletal bone age assessment system for young children (from 0 to 7 years old) using only carpal bones. This method initially employs fully automatic carpal bone segmentation and morphological feature analysis and, subsequently, applies a fuzzy classification approach to bone development. Other fuzzy-based methods combined with morphological features of the carpal bones can be found in [23] where the authors also integrate Principal Component Analysis and statistical correlation or Support Vector Machines [24] to build a growth model of the carpal bones, stating a success rate of 87–89%, although they considered a relatively large admissible error of 1.5 years. Fuzzy classifiers are used in [25] for automating the GP method. Although it achieves a very high accuracy rate at lower age groups (0–2 years), its performance deteriorates when X-Rays of older subjects were used.

Deformable models (and especially Active Shape Models) have been largely used for skeletal bone age assessment [26–28]. Despite deformable model based approaches are capable of modeling EMROI shapes, they are ad-hoc solutions relying on many parameters, and, thus their results depend largely on the quality of input images. The authors in [29] suggest that one of the main difficulties in evaluating bone age, is the irregular (i.e. largely varying) development of the trapezium and trapezoid bones and they propose a method, based on the integration of anatomical knowledge and trigonometry theory for the TW2 assessment.

Machine learning techniques have been also used, e.g., in [30], an X-Ray image is first segmented using a K-means clustering algorithm on the gray-level co-occurrence matrix, although the authors do not report detailed performance evaluation. A Support Vector Machine and correlation prototypes [31], and in [32], Support Vector Regression and smart class mapping have been proposed that, however, perform poorly in terms of accuracy. Contrary to the majority of the existing systems based on a single evaluation method, BoneXpert [33] is an automatic skeletal bone age assessment system combining both TW and GP methods. The main drawback of BoneXpert, however, is its high image rejection rate, meaning that it does not process low quality images and it often requires a heavy preprocessing step in order to make the image appropriate for processing.

While there exist many computer-based EMROI classification systems that employ machine learning approaches (e.g. Neural Networks, Fuzzy Classifiers, Support Vector Machines, etc.) one of the main limitations is the lack of methods to model bone shapes effectively and dynamically. To deal with this issue we employ Hidden Markov Models, which is a model of a sequential process changing states at discrete sequence intervals thus able to model ROIs’ discrete stage. A further contribution of this paper is the integration of several existing works, from preprocessing to finger extraction to stage assignment, into a unified tool which can be used by clinicians.

Generally, the existing applications for skeletal bone age evaluation follow a standard workflow (Fig. 1
                     ) model: the input image is initially processed by noise removal (for enhancing image clearness); afterwards, background removal methods are employed to highlight only the parts necessary for the further classification.

Before presenting our method, a brief description of the TW2 clinical method is given.

The TW2 method is based on a predefined standard of bone maturity depending on age. It employs 20 ROIs located on the first, third and fifth finger and the carpus of the left hand. The finger ROIs are called EMROIs (Epiphyses/Metaphyses ROI) and the carpal ones (including radius and ulna) CROIs (Fig. 2
                        ). The maturity of the bone is determined by the state of the epiphysis: if it is completely absent, it is an initial developmental state, otherwise, if it is completely fused to the metaphysis, bone maturation is completed. The development progression of each ROI can be divided into discrete stages, with each one assigned a letter from A (epiphysis is absent) to I (epiphysis-metaphysis fusion complete). A numerical score is further associated with each stage of each bone and the overall maturity score is calculated by adding the individual ones. This score is then used to find the age according to the graphs in Fig. 3
                        .

Raw X-Ray images often contain impurities and noise that may complicate automatic processing. For this reason, it is necessary to pre-process the input X-Ray in order to both enhance bones and to remove unnecessary parts, such as background and/or radiological markers. As background, we define an area outside the field of the radiation, which should be entirely black. To accomplish this, we employ a flood-fill approach, which ensures a hand-to-background ratio [29] (Fig. 4
                        ). After background removal, orientation correction is carried out, as very often (especially in scanned X-Ray) hands are not well-oriented, thus preventing the identification of the starting points for the algorithm.

To achieve this, we use wedge functions (i.e. binary functions aiming at identifying which part of an image belongs to the background and which one to the foreground [34], Fig. 7, left) to detect the middle finger and identify the axis (r
                        2) passing from the midpoint of the width at half-way the finger's length, and the midpoint of the width at its base (Fig. 5
                        , Left). After identifying the angle of the r
                        2 axis with the vertical one, the image is rotated, obtaining the one shown in Fig. 5, right. The GUI section for hand orientation is shown in Fig. 6
                        .

After pre-processing, fingers and the relative EMROIs are identified and extracted. The TW2 method uses information contained in the first (thumb), third (middle) and fifth (pinkie) fingers. Identifying the third and fifth fingers is simple and is carried out by means of wedge functions. In particular, wedge functions are used to isolate each finger and find tips, middle and base points of each finger by analysing wedge functions’ local maxima and minima. Each finger region is then rotated and extracted. Thumb extraction, instead, is implemented by a different procedure, consisting of identifying the points T
                        
                           thumb
                        , A and B (Fig. 7
                        , right), by the following method:


                        
                           
                              1.
                              We define as T
                                 
                                    thumb
                                  the right-most, firstly, and top-most, secondly, point that belongs to the hand.

Starting from the T
                                 
                                    thumb
                                  point, we scan from the X-Ray's right margin considering the wedges found line by line. When a non ending wedge is detected (i.e. the base of the thumb was found), we set as A the end point of the previous wedge found.

Starting from an arbitrary distance from the point A and scanning along the thumb's opposite side, we calculate the distances from A to all such points and set as B the point with the minimum distance (Fig. 7, right).

The thumb is then extracted by cutting the image at the segment defined by the points A and B, which separates the thumb from the rest of the hand.

EMROI extraction, instead, has been carried out by taking into account, for each finger, the average gray-level of the segmented image depicting a finger. We then compute the first-order derivative of the average gray-level profile and search for local maxima: these values indicate the bone borders for metaphysis, epiphysis, and diaphysis and are used to extract the EMROIs. We then apply, for reducing noise, smoothing filters on gray-level finger images. The first derivative is applied to the smoothed signal in order to enhance the identified EMROIs. Finally, by thresholding the previous signal, we obtain a suitable filter to and using it extract the desired EMROIs. In fact, based on the peaks of the obtained filter, the distance between the middle and the distal part of the finger and the one between the proximal and the middle part of the finger are calculated. If they are out of an anatomically plausible range, a warning message is displayed, and the procedure starts again by working on the derivative of the gray-level profile. The GUI section for EMROI extraction is illustrated in Fig. 8
                        .

Once the EMROIs have been extracted, the Difference of Gaussians (DoG) filter [35] is applied for image enhancement. The DoG filter allows us to identify the soft tissue, typically appearing as a smooth region, by using a Gaussian function with a suitable standard deviation and, then, to remove it by subtracting it to another one with a less smoothing effect.

By applying the DoG filter we remove all soft tissue, thus highlighting bone contours (Fig. 9
                        , top right). To correct holes and general shape degradation due to DoG a flood fill approach is applied again (Fig. 9, bottom left).

In order to verify that the identified contours represent bone shapes we check for a set of geometrical and morphological criteria: metaphysis and diaphysis must touch the top and bottom margins of the image, respectively, and the epiphysis compactness must have a higher value than the other ones. Additionally areas of the identified bones should be in a fixed range of values and the finger's middle axis should pass through each bone.

In case metaphysis and epiphysis are fused (i.e. only two bones were extracted, instead of three), the depth of the convexity defect is calculated in order to distinguish fused bones. The fused bones then are cut at the deepest points of such defect, making sure that no erroneous oblique cuts occur.

When the number of extracted bones is equal to three, the labels are assigned from left to right: metaphysis, epiphysis and diaphysis (Fig. 9, bottom right). The procedure is implemented through the GUI shown in Fig. 10
                        .

At this point, a thresholded image for each EMROI is available that contains the extracted bones. What remains is their classification (i.e. TW2 stage assignment), a task not always trivial because bad quality images may introduce undesirable effects in the form of fused bones.

The features extracted from each detected EMROI for stage assignment, are derived from the Tanner and Whitehouse (TW2) method. In detail, for each EMROI a feature vector containing the following features (shown in Fig. 11
                        ) is created:
                           
                              
                                 
                                    FV
                                    
                                       
                                          bone
                                          stage
                                       
                                    
                                 
                                 =
                                 [
                                 
                                    d
                                    meta
                                 
                                 ,
                                 
                                    d
                                    
                                       
                                          m
                                          1
                                       
                                    
                                 
                                 ,
                                 
                                    d
                                    
                                       
                                          nv
                                          1
                                       
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    d
                                    
                                       
                                          nv
                                          5
                                       
                                    
                                 
                                 ,
                                 
                                    d
                                    
                                       
                                          h
                                          epi
                                       
                                    
                                 
                                 ,
                                 
                                    area
                                    1
                                 
                                 ,
                                 …
                                 ,
                                 
                                    area
                                    6
                                 
                                 ]
                              
                           
                        where d
                        
                           meta
                         is the width of the metaphysis, 
                           
                              d
                              
                                 
                                    nv
                                    1
                                 
                              
                           
                           ,
                           …
                           ,
                           
                              d
                              
                                 
                                    nv
                                    5
                                 
                              
                           
                         are the heights of the different lines that divide the epiphysis’ main axis in six equal parts, and area
                        1, …, area
                        6 are their areas. Finally, 
                           
                              d
                              
                                 
                                    h
                                    epi
                                 
                              
                           
                         is the distance between the metaphysis and the diaphysis.

The last module performs stage assignment and is carried out by Hidden Markov Model (HMM) [36], which is a statistical model, similar to regular Markov model with the difference that it contains only unobservable states. This means that the internal state of the model at any given time is not directly visible, but the output is. Each state of the HMM has a probability distribution over its outputs.

While the bone development process is dynamic (i.e. it changes constantly during the development of the skeleton), it is a slow evolving one and as such, HMM are sufficient for modeling it.

In our case we created a HMM for each EMROI and for each state (A-I), for a total of 72 HMM classifiers (27 – 9 stages for 3 EMROIs – HMMs for the middle finger, 27 for the pinkie and 18 – 9 stages for 2 EMROIs – for the thumb). The observations of the models are the feature vectors described in the previous section. Given a feature vector of 14 elements, it represents a set of 14 observations, one for each feature, that are introduced sequentially into the respective HMM, which returns the probability that the sequence belongs to it. In other words, the output of the single HMM is the probability that the fed feature vector was produced by it. Once these probabilities are calculated. the HMM representing the state with the maximum likelihood is chosen and its respective stage label is assigned to the EMROI. The architecture of the HMM based classifier used can be seen in Fig. 12
                        .

The output of this system is a set of letters representing the most probable developmental state for each EMROI. By summing up their corresponding values and using the graphs in Fig. 3, the bone age of the subject is obtained (Fig. 13
                        ).

@&#EXPERIMENTAL RESULTS@&#

The proposed method was tested 360 left-hand X-Ray images (180 males and 180 females), 30 X-Rays for each year in the range of 0−6. Since the dataset size is small, k-fold cross-validation method with k
                     =5 was adopted. For each of the X-Rays, the 14-value feature vectors were extracted and used for HMMs training, and for each patient the developmental status of each EMROI was evaluated and then compared to the ones assessed by two expert physicians. While the importance of each single EMROI is important for assessing the accuracy of the system, calculating the discrepancy of the computed bone age with the effective one, in order to give a global idea about the performance of the whole system, is more important.

In order to test how our approach performs compared to other approaches, we also tested the systems described in [29], in [37] and in [34]. The values for the StdDev
                     1 and StdDev
                     2 parameters of the DoG filter were set, respectively, to 13 and 1.85. We compared the results of all the above systems against the evaluations performed by the two experts. A perfect stage assignment is defined as the result where the developmental stage assignment corresponds completely with the ones made by the experts. A good evaluation is defined as the result obtained when the discrepancy from the expert's evaluation is of only one stage and, finally, a bad EMROI assignment is considered when the discrepancy is of two stages or more. As shown in Table 1
                     , the proposed method outperformed all the others in terms of accuracy in bone stage assignment. In fact, assuming as correct evaluations the Perfect and the Good ones (i.e. the difference in EMROI stage assignment with respect to the radiologist's one does not exceed one step), the correct assignment rate is over 96% in both cases. The other comparing systems performed well (and, in particular, our previous work, [29]) but they did not, in any case, reach the performance of the proposed method.

While Table 1 reflects the performance of the systems in classifying correctly the single EMROIs, it should be noted that they do not express their potential in assessing the correct bone age of the individual. This aspect of the systems is shown in the Table 2
                      where the Mean Average Error (MAE) and the Standard Deviation (STD) between the computed bone age and the evaluations of the two radiologists are shown. Our method, achieved excellent results when compared both with the radiologists’ evaluations (MAEs of 0.37 and 0.41, with STDs of 0.29 and 0.33, respectively). Such performance is clearly superior with respect to the other methods tested (best case MAEs of 0.88 and 0.61, with STDs of 0.14 and 0.22, respectively).

@&#CONCLUSIONS AND FUTURE WORK@&#

In this work, we presented an automatic skeletal bone age assessment method (and a tool built on top of it) that implements the TW2 method for EMROI classification and employs Hidden Markov Models for modeling the different stages of development of the bones. The system was tested and compared against existing state-of-the-art methods and outperformed all of them achieving a correct detection rate of more than 95%, when single EMROIs are concerned. Although the system's performance is very good in terms of accuracy, there is much for improvement and in particular in the preprocessing step, where the DoG filter could be replaced by more sensitive and precise image segmentation methods, such as Markov Random Fields [38]. Moreover, the method, at the moment operates only in the range [0-6] years, and we are working on bone age assessment for subjects older than 6 years when most of the bones may be fused.

The Skeletal Bone Age tool can be downloaded at http://perceive.dieei.unict.it/download.php.

@&#REFERENCES@&#

