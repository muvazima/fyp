@&#MAIN-TITLE@&#A new machine learning approach for predicting the response to anemia treatment in a large cohort of End Stage Renal Disease patients undergoing dialysis

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           Prediction algorithm trained and tested on a large sample of real clinical data.


                        
                        
                           
                           Prediction improvement based on red blood cell dynamics and drug kinetics.


                        
                        
                           
                           There is still room for improvement of anemia management in dialysis.


                        
                        
                           
                           The model presented is suitable for the application in a daily clinical practice.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Prediction

Hemoglobin

Chronic Kidney Disease

Anemia

Machine learning

@&#ABSTRACT@&#


               
               
                  Chronic Kidney Disease (CKD) anemia is one of the main common comorbidities in patients undergoing End Stage Renal Disease (ESRD). Iron supplement and especially Erythropoiesis Stimulating Agents (ESA) have become the treatment of choice for that anemia. However, it is very complicated to find an adequate treatment for every patient in each particular situation since dosage guidelines are based on average behaviors, and thus, they do not take into account the particular response to those drugs by different patients, although that response may vary enormously from one patient to another and even for the same patient in different stages of the anemia. This work proposes an advance with respect to previous works that have faced this problem using different methodologies (Machine Learning (ML), among others), since the diversity of the CKD population has been explicitly taken into account in order to produce a general and reliable model for the prediction of ESA/Iron therapy response. Furthermore, the ML model makes use of both human physiology and drug pharmacology to produce a model that outperforms previous approaches, yielding Mean Absolute Errors (MAE) of the Hemoglobin (Hb) prediction around or lower than 0.6g/dl in the three countries analyzed in the study, namely, Spain, Italy and Portugal.
               
            

@&#INTRODUCTION@&#

A disorder like Chronic Kidney Disease (CKD) has global consequences for the organism, and it progressively makes a complete renal replacement therapy necessary. During End Stage Renal Disease (ESRD), dialysis partially reintegrates the blood filtration function; however, this is not sufficient to completely replace the renal endocrine role causing the development of common comorbidities, like CKD secondary anemia (CKD-anemia) [1]. Healthy kidneys secrete erythropoietin (EPO) that stimulates proliferation and differentiation of precursor cells into circulating Red Blood Cells (RBC). However, in CKD patients the capability of producing EPO becomes ineffective, leading both to a failure of the RBC production and to a contraction of the RBC lifespan [2]. The availability of exogenous Erythropoiesis Stimulating Agents (ESA) improved the treatment of CKD-anemia [3] although the clinical outcomes are still not completely successful [4] oftentimes. RBC maturation process strongly depends on iron availability, EPO concentration and EPO level fluctuations at the site of action [5,6]. Moreover, in the case of CKD, erythropoiesis is also strongly influenced by momentary or general patient conditions; specifically, inflammation and resistance to ESA treatment are two of the main determinants for drug response variability. Main difficulties in the selection of an optimal therapy dosing derive from the non-linear ESA dose/effect relationship, the high intra- and inter-individual response variability and the temporal discrepancy between the short ESA permanence in the blood (hours) and the long RBCs׳ lifespan (months) [7]. Therefore, patient status as well as ESA pharmacokinetics and pharmacodynamics are crucial factors for a correct long-term dose–response prediction that would avoid continuous raises and falls in Hemoglobin (Hb) levels.

Given the complexity of the medical problem and the importance of the Hb variation prediction, the major aim of our present work has been to explore the potential of Machine Learning (ML) to derive a predictor of the response to the ESA/Iron therapy in hemodialysis patients affected by secondary anemia. To address this goal, we combined well-established ML techniques with careful feature engineering guided by the principles of actual drug kinetics, specific biological dynamics and clinical patient information. In the dialysis clinics under study, all the dialysis parameters were recorded at each session and registered in a central database together with the results of the routine laboratory analyses and the periodic control visits. This wide database offers a dynamic patient clinical picture, with updated biochemical indicators values and information on the pharmacological therapy, including the actual quantities of each medicament that patients have taken [8]. Such a large amount of clinical data is of pivotal importance to have a significant approximation to the general population; however the high complexity of this kind of data (multidimensional and non-linear) makes a correct interpretation difficult when operated only on the basis of standard statistical analyses. Conversely, ML techniques offer the advantage of inferring directly from the data the possible unknown relationships existing among the features present in a large and complex dataset thus finding an appropriate and powerful application in clinic and therapy management [9,10].

This is not the first attempt of using ML to predict Hb levels or help in anemia management. Artificial Neural Networks (ANNs) have been used by several authors during the last decade to individualize ESA doses [11,12,10]; even most of the authors of this paper produced a very recent publication dealing with Hb prediction [13]. In general, those methods used current and previous Hb levels, ESA doses, and other variables that describe the patient׳s condition, in order to predict the next Hb level. The goal of those previous works was to select the optimal ESA dose in order to achieve a given Hb level; this approach is suitable only when the optimization horizon is the next time step. The same idea has been applied using other machine learning techniques, such as fuzzy logic [14,15], support vector machines [16] or Bayesian networks [17]. There have been other ML approaches focused on an efficient long-term anemia management instead of a pure prediction one-step ahead; relevant works on this topic have been developed in [14,18–20].

Main concerns with previous ML implementations for Hb levels prediction in anemic patients have been the incomplete correspondence between the model and the true patient biology, the utilization of restricted study populations or the availability of a scant amount of patient data. In our case, the size and the diversity of the considered CKD population have been essential to derive a general and reliable model for the prediction of ESA/Iron therapy response. Additionally the ML application has been designed on the actual human physiology, i.e. taking into account RBC lifespan to build Hb records, and ESA pharmacology, i.e. considering not just the total quantity of administered drug but also the administration scheduling. This approach strongly enhanced the model accuracy.

The rest of the paper is outlined as follows. Section 2 describes the methods used in this work; data collection and experimental setup are presented in Section 3. A description of the results is given in Section 4, followed by a discussion in Section 5. Conclusions end up the paper in Section 6.

@&#METHODS@&#

When given intravenously, Darbepoetin alpha shows a half-life of about 24h stimulating the RBC maturation process. Erythrocyte development requires about 13 days to be completed within the bone marrow [21]; afterwards, immature reticulocytes are released into the bloodstream for becoming mature Hb-laden RBC that usually survive for about 60–90 days in ESRD patients [22]. We therefore modeled our ML algorithm considering that the present Hb levels may be influenced (with declining potency) by Darbepoetin alpha doses administered during the previous three months. This time lapse includes erythropoiesis and erythrocyte lifespan. Additionally, given a monthly Darbepoetin dose, effect on Hb level may be different depending on the dose scheduling. For this reason, time granularity was finer than in the previous work, in which ESA doses were accounted between two subsequent Hb measures.

As predicting future Hb levels is an intrinsically temporal problem, it is crucial to devise an effective way to encode the temporal structure of the data before feeding them to the chosen learning algorithm. Additionally, our aim is that the mentioned temporal structure encompasses the Darbepoetin kinetics and the RBC dynamics. There is an additional and important problem to face in this framework; sampling frequency of the various features is different, and hence, many methods for time series analysis based on an even sampling cannot be applied. For instance, in the problem presented here, laboratory tests are recorded approximately once per month, while treatment data are available every second day. Therefore it is necessary to define a merging logic to combine the relevant features into a consistent temporal series of patient records. The natural choice for the timeline driver is the Hb measure; that is, for a given patient we built a distinct record whenever a new Hb value was available.

Dose accumulation intervals going backwards from the Hb measure were parametrically defined in order to include information about administered Darbepoetin alpha and Iron dosages in a fashion able to maintain a fine level of detail about the timing of drug administration, which is crucial when conceiving a model shaped on the actual pharmacokinetics of a drug. In other words, given a Hb measure at time t, denoted by Hb(t), and given a vector of parameters defined as
                           
                              (1)
                              
                                 
                                    
                                       dose
                                    
                                    
                                       −
                                    
                                 
                                 
                                    
                                       accumulation
                                    
                                    
                                       −
                                    
                                 
                                 rule
                                 =
                                 [
                                 
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          1
                                       
                                    
                                    …
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          n
                                       
                                    
                                 
                                 ]
                              
                           
                        the accumulated dose for drug D relative to the reference time t is a vector
                           
                              (2)
                              
                                 
                                    
                                       accumulated
                                    
                                    
                                       −
                                    
                                 
                                 dose
                                 =
                                 [
                                 
                                    
                                       
                                          D
                                       
                                       
                                          1
                                       
                                    
                                    …
                                    
                                       
                                          D
                                       
                                       
                                          n
                                       
                                    
                                 
                                 ]
                              
                           
                        where D
                        
                           k
                         is the drug dose administered between time 
                           t
                           −
                           (
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    0
                                 
                                 
                                    k
                                    −
                                    1
                                 
                              
                              Δ
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                           
                           )
                         and time 
                           t
                           −
                           (
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    0
                                 
                                 
                                    k
                                 
                              
                              Δ
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                           
                           )
                        .

Our algorithm also takes as additional inputs, other auxiliary medical parameters known to contribute to Hb level fluctuations (such as inflammation markers, iron availability indicators, and dialysis treatment adequacy). These variables were not preprocessed with any accumulation rule, because they were either measured every month together with Hb level, or if multiple values were available between two consecutive Hb measurements their average was considered (e.g. OcmKtv and Weight). The initial set of available features was considerably large (see Table 1), and using all of them would produce a rather high-dimensional input space that, generally, is detrimental to learning a good model [23]. Thus, the goal is to find the right trade-off between providing the model with as much information as possible and limiting the number of variables. That trade-off was achieved by means of running the algorithm with different combinations of the available features in order find the optimal subset.

The subset of variables that, together with the drug doses, produced the best algorithm performances was formed by Height, Dry Body Weight, Hb, OcmKtV, Ferritin, Albumin and Leucocytes. Those variables were selected from those usually monitored in clinical practice, and among them, the final selection was carried out according to the suggestions made by clinicians about the relevance of different features.

As a result of the above detailed processing steps, each patient was described by a sequence of records 
                           〈
                           
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                              …
                              
                                 
                                    R
                                 
                                 
                                    3
                                 
                              
                           
                           〉
                        , where each record R
                        
                           t
                         stores the values for all selected variables at time t. Notice that the clinical history length (and consequently the number of records) might be different for each patient.

These data represent the input for training and testing our predictive model, implemented as a feed-forward Artificial Neural Network (ANN) [24]. ANNs are computational models inspired by the processing principles found in brains, and extensively used as function approximators in a variety of applications. They are composed of computational units called neurons, exchanging information through weighted connections. Neurons are arranged in a variable number of layers: an input layer to which the data is fed; an output layer where the result of computation is returned; and one or more than one hidden layers in between. The ANN, presented with a collection of input–output pairs called the training set, takes those examples to learn how to approximate the relation between such pairs; to do so, it iteratively adjusts the weights of its connections. If the learning phase is successful, the resulting model will be able to generalize what it has learned to unseen examples: that is, given a new set of inputs (the test set) the ANN should be able to predict the corresponding outputs with reasonable accuracy. In order to avoid suboptimal models different configurations of a Multilayer Perceptron (MLP) architecture were tested. Number of hidden layers was varied from 1 to 3, with the number of neurons in each layer varying from 2 to 20 with a step of 2 neurons. Additionally, for each configuration various random weight initializations were tested. Training of the network was accomplished by means of the Levenberg–Marquardt algorithm, and the maximum number of epochs was considered equal to 300 (anyway convergence was achieved in a lower number of iterations). The best results in terms of Mean Absolute Error (MAE) were obtained by MLP architectures formed by two hidden layers with 8 neurons in each layer.

We performed a retrospective observational study (from January, 1st 2006 to December, 31st 2010) on patients undergoing hemodialysis in Fresenius Medical Care (FME) clinics in Portugal, Spain and Italy. Only patients who fulfilled the following criteria were included in the study:
                        
                           •
                           Patients who received intravenous (IV) ESA only in the form of Darbepoetin alpha, and IV elemental iron as Iron Sucrose or Iron Gluconate.

Patients who did not receive blood transfusions during the study period.

Patients who had at least three Hb measurements.

From the complete clinical database, we extrapolated specific patient information, which may have an impact on the individual therapy response. From this set of variables, those with low occurrence (more than 50% of missing values) were removed; the remaining variables are listed with their mean values and standard deviations in Table 1
                     . Patient general information was recorded at the time of the first clinic admission. Laboratory exams were usually performed once a month and blood sample was withdrawn before the dialysis session. At every treatment, actual Darbepoetin alpha and Iron dose administration were recorded as well as parameters concerning the dialysis treatment, like Modality, Dry Body Weight, Pre-dialysis Weight, etc. Spanish population was formed by a 65% of male patients and a 35% of female ones, while both for Italian and Portuguese data sets the ratio was 60% of men and 40% of women. Finally, 688 patients (21,866 records) from Italian clinics, 1397 patients (24,565 records) from Spanish clinics and 2050 patients (55,487 records) from Portuguese ones formed part of this study. Since diabetes is related to resistance to EPO treatment, it is important to know the percentage of diabetic patients within the data set (26% of the Italian patients underwent diabetes; in the case of Spain and Portugal, the corresponding percentages were 25% and 33%, respectively).

In order to obtain robust models, the available dataset was divided into two complementary subsets, namely training and test sets. Training set, containing 66% of the data, was used to perform the learning process, while the test, holding the remaining 34% of the data, was used to validate the derived model. It should be emphasized that the test set was, in turn, split into two data sets: 17% of the data was used to carry out the cross-validation strategy (evaluation of the performance of the model fitted with the training data) while the remainder 17% was completely kept for testing the performance in a real environment since they were not used at all either for training the model or for cross-validation, but only to analyze the performance with completely unseen data, thus simulating a real clinical framework. To avoid bias in the results due to a particular selection of the training and test set, multiple rounds of cross validation were performed. Each resulting couple of training and test set was standardized to zero mean and unit standard deviation.

@&#RESULTS@&#

The performance of the models was evaluated by means of the Mean Error (ME), as a measure of bias, while the Mean Absolute Error (MAE) and Root Mean Square Error (RMSE) were used as measures of accuracy. Tables 2–4
                     
                     
                      show the results achieved in the three considered countries, while Table 5
                      shows the overall results. In particular, the MLP proposed in this paper is compared with a linear model and, in the case of Italy and Spain, also with another MLP reported recently in the literature by most of the authors of this paper [13]. The proposed model outperforms the linear model and the MLP reported in [13]. The achieved results are similar for the three countries, although the best results are encountered for Portugal. Guidelines for anemia management suggest to keep Hb level between 10 and 13g/dl and most recently between 10 and 12g/dl, thus, aiming to the middle of the desired range, a deviation of 1g/dl is permitted [25,26]. We thus calculated the percentage of errors lower than 1g/dl for Portugal, Italy and Spain, finding success percentages of 93%, 91% and 90%, respectively. It is also remarkable that the extremely low value of ME guarantees that models are not biased, i.e., they do not tend to underestimate the value of Hb nor to overestimate it. The proposed MLP, hence, shows an adequate performance; it should be pointed out that the model presents a nice validation capability since results in training, validation and external test data sets were very similar, as shown in Table 6
                     .

In addition to the numerical values provided in Tables 2–6, it is useful to visualize the temporal evolution of individual patients comparing the actual value of Hb that was measured and the Hb value predicted by the MLP model. To this end, Figs. 1–4 show examples for patients in whom the prediction was poor, average, good and very good, respectively. Fig. 1
                      shows the case of a patient for whom the prediction model commits important errors around or larger than 1g/dl in some Hb measurements; moreover, the prediction seems to be delayed in some time windows with respect to the actual Hb value, likely due to the high relevance of the current value of Hb to predict the next one. Fig. 2
                      shows an average prediction, in which the model approximately follows the trend of the time series but the prediction seems to be a moving-averaged version of the actual time series, thus committing important errors in the presence of abrupt changes. Fig. 3
                      shows a good behavior although in terms of the prediction, it is not a complicated one since the patient is quite stable and there are slight changes in the Hb values that are more easily predicted than abrupt changes like those shown in Fig. 2. Finally, Fig. 4
                      shows the case of a very good prediction since the model is able to capture abrupt changes and provide a very accurate prediction even in the presence of abrupt changes and quite different Hb values (ranging from less than 10g/dl to 15g/dl in only four months).

@&#DISCUSSION@&#

In [13], most of the authors of this paper carried out a thorough evaluation of many different methods to carry out a reliable Hb prediction. Results were very promising, but several arisen problems made us think about a new approach. Firstly, since the most relevant value in the prediction of a future value of Hb, turned out to be the current Hb level, this produced a sort of delay in the prediction, since models were prone to predict most of the time the current value of Hb as the most likely one for a subsequent monitoring, too. This delay occurred for all the tested models; the use of very sophisticated models did not improve the prediction considerably, thus suggesting that there was a certain accuracy threshold that could not be surpassed by means of using the same data structure with different methods; that may also be linked to the fact that the systematic error committed by measuring machines did not give a wide margin of improvement.

Therefore, we came up with the idea presented in this paper that is rather focused on better exploiting the available information and making more sensible predictions, i.e., predictions that are aligned with the real behavior and lifespan of RBC and the effect produced by the drugs administered to correct the anemia, mainly ESAs.

Several protocols have been designed for a balanced anemia treatment strategy; however, the elaboration of an efficient therapy outcome prediction is very difficult and still largely based on clinician׳s subjective evaluations. This approach commonly implies control of Hb variation at close intervals followed by prompt Darbepoetin alpha dose adjustments. Nonetheless, changing ESA dosage before a new Hb steady-state has been achieved may cause undesired Hb cycling [27]; on the contrary, a correct system for Darbepoetin alpha prescription can be improved by anticipating the effect of the possible actions. Iron, in addition to erythropoietin, is essential for Hb formation, so Darbepoetin alpha therapy is given in conjunction with an iron repletion treatment to ensure sufficient iron availability. Determination of a correct combined Darbepoetin/Iron therapy is a very challenging task due to the complexity of the parameters influencing the therapy response and to the high unpredictability of the processes involved. Another important aspect of anemia management is the high inter and intra-individual variability in ESA and Iron therapy response; thus, the assessment of model robustness and reliability needs to measure performances on a dataset representing a mixed patient population. For this reason, the model described in this paper has the potential to be applied as a support tool within a real clinical setting.

A main limitation of the current study is that it is restricted to one kind of ESA, namely Darbepoetin because it is the most usually administered ESA in the countries under study. As shown in [12], prediction models can deal with different kinds of ESA, being the kind of ESA one of the inputs to the model. It is also remarkable that some features that are known to play an important role in this framework (hyperparathyroidism, inflammatory status, etc.) were not used as inputs to the model because they were not always routinely acquired in the clinics under study.

@&#CONCLUSIONS@&#

This paper has presented a reliable ML approach to predict Hb values in patients undergoing secondary anemia to CKD. The work is the result of a long experience of the authors in this problem, with some previous works in which the produced models were not completely satisfactory.

The proposed approach puts together the potential of ML models in general, and the MLP in particular, to produce accurate models given a representative data set with a better use of the available information using a priori knowledge of lifespan of RBC and the effect produced by Iron and ESAs. The result is an improved approach that outperforms the models published so far to face this problem.

The successful results shown in Tables 2–6 and Figs. 1–4 and the fact that the model has been tested on a large dialysis population make the model suitable for its application as support tool in the real clinical practice. Our ongoing work deals with the implementation of the model in pilot clinics spread over different geographical areas to test the real performance on completely new patients. The goal is to check whether the model can be finally used in the short term as a decision support system to be implemented and successfully working in most of FME clinics.

None declared.

@&#REFERENCES@&#

