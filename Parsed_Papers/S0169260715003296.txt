@&#MAIN-TITLE@&#Eliminating rib shadows in chest radiographic images providing diagnostic assistance

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We introduce a two-step algorithm for eliminating rib shadows in chest radiographic images.


                        
                        
                           
                           The algorithm delineates the ribs using a novel hybrid self-template approach.


                        
                        
                           
                           It suppresses the delineated ribs using an unsupervised regression model.


                        
                        
                           
                           The rib delineations can improve the performance of CAD systems.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Computer-aided diagnosis (CAD)

Chest radiography

Medical image analysis

Bone suppression

@&#ABSTRACT@&#


               
               
                  A major difficulty with chest radiographic analysis is the invisibility of abnormalities caused by the superimposition of normal anatomical structures, such as ribs, over the main tissue to be examined. Suppressing the ribs with no information loss about the original tissue would therefore be helpful during manual identification or computer-aided detection of nodules on a chest radiographic image. In this study, we introduce a two-step algorithm for eliminating rib shadows in chest radiographic images. The algorithm first delineates the ribs using a novel hybrid self-template approach and then suppresses these delineated ribs using an unsupervised regression model that takes into account the change in proximal thickness (depth) of bone in the vertical axis. The performance of the system is evaluated using a benchmark set of real chest radiographic images. The experimental results determine that proposed method for rib delineation can provide higher accuracy than existing methods. The knowledge of rib delineation can remarkably improve the nodule detection performance of a current computer-aided diagnosis (CAD) system. It is also shown that the rib suppression algorithm can increase the nodule visibility by eliminating rib shadows while mostly preserving the nodule intensity.
               
            

@&#INTRODUCTION@&#

Radiography is considered among the least expensive and least harmful of the conventional imaging modalities. Despite the availability of a wide variety of more complicated imaging techniques, it remains ubiquitous in medical practice even for well-equipped hospitals and radiology departments. It usually serves as a handy screening tool before the decision to undertake more elaborate examinations, such as computed tomography or laboratory analyses for pathology. Detection of lung nodules using chest radiographs is a common example of these studies. Despite its practical use in various areas, the reliable analysis of radiographic images remains a challenge—whether done manually or computationally—because of their low resolution and “noisy” content. In addition to these major difficulties, chest radiographic analysis suffers from the presence of normal anatomical structures (e.g., bones, other overlapping organs), which obscure abnormalities that are buried in normal lung tissue. In a typical scenario, nodules in the main tissue might be blocked from view by shadows of quasi-parallel bones in the ribcage. Therefore, delineation followed by suppression of the ribs on the input image without losing any information regarding the lung tissue underneath the ribs is an important computational challenge in computer-aided diagnosis (CAD) systems that are applied to chest radiographs.

In this study, we addressed the problem of eliminating rib shadows from lung images obtained by chest radiography, which is usually designed as a sub-module of radiographic CAD systems. To this end, we introduce a two-step approach. It first delineates the ribs using a novel integrative approach based on parabola curve fitting from rib seeds obtained via log Gabor filtering and then suppresses the delineated ribs using an unsupervised regression model. The system is completely unsupervised. That is, it does not require a training set of manually delineated ribs or any knowledge-driven rules provided by an expert. The new system is examined visually in a well-known chest radiography set [1]. It has been clearly demonstrated that the ribs can be delineated provided that at least one template can be detected from the original image. The knowledge of rib delineation itself offers an additional feature to current CAD systems, which can improve their nodule detection performance. Using rib suppression thereafter can further assist both manual and computational diagnosis by providing a clear view of main lung tissue.

@&#RELATED WORK@&#

Diagnostic image analysis of chest radiographs has been enriched mostly in two directions: (1) the development of CAD systems for automatic detection of nodules and (2) segmentation of anatomical structures to provide preprocessed images for other systems. The latter may include detection of lung areas or delineation of the ribs. The readers are referred to recent surveys for nodule detection algorithms [2–4]. Here, we present a more elaborate view of previous studies on rib delineation and suppression. Automated detection of ribs on chest radiographs is an old problem in medical image analysis. In one of the earliest studies on rib detection, Toriwaki et al. [5], in 1980, located rib edges by a template matching approach and fitted parabolas to these borders. This idea was later used in many studies. De Souza [6] used the derivatives of vertical profiles to detect the pixels on the rib boundaries and fitted parabola to them. Sanada et al. modeled ribs as ellipses, and the ribcage as a sinusoidal pattern [7]. Sarkar and Chaudhuri [8] performed a set of gray-level calculations to predict rib border candidates. Yue et al. [9] used a modified Hough transform to fit parabolas to rib edges and refined the boundaries using a snake approach. Vogelsang et al. [10] followed a similar strategy for fitting parabolas to the edges using a template matching approach and refined the ribs by new estimates of parabolas for each rib. Karargyris et al. [11] smoothed the detected edges using a Savitzk-Golay filter. Lee et al. [12] used a knowledge-based generalized Hough transform to locate rib borders starting from the best template detected by a simple Sobel operator. Ogul et al. [13] used a specific region growing technique to refine the rib borders detected similarly by a template matching approach. Horváth et al. [14] refined the final ribs with the help of a dynamic programming-based active contour algorithm. In general, all these methods share these three aspects: detecting the positions of the upper and/or lower rib borders, fitting a curve to the borders, and refining the final rib shadows. It is also worth mentioning various supervised approaches that used a set of training images with manually delineated rib borders [15–17] to predict the locations of ribs from the learned model.

Rib suppression has received relatively less attention, although its clinical implications would have been more critical for giving diagnostic assistance [18]. In many studies, the task is accomplished by estimating a fixed intensity difference between bone and normal tissue. That value is then simply subtracted from the observed rib intensity to view the main tissue underneath [19,20]. It is obvious that the assumption of a fixed proximal thickness (depth) for the ribs is far from practical. Suzuki et al. used a supervised approach that was trained from dual-energy X-ray measurements to estimate rib shadow [21]. The only unsupervised approach that allows an intensity difference for each pixel of the bone region treats the problem as a multi-criteria optimization task [12]. Those authors recommended a genetic algorithm that minimizes the difference between the observed and predicted values of rib intensities to estimate the varying differences in intensity, which values are subtracted from delineated rib regions. There are two major problems with that study. First, estimating a different intensity difference may distort the homogeneity of the bone texture. Second, a genetic algorithm is not practical to use because of its high computational complexity. Therefore, we need a method that takes into consideration the homogeneity of the bone while being able to complete the computation within a reasonable time that is acceptable to radiologists. Here, we assume that the difference in the intensities of the bone and the main tissue may change from the center of a rib to its borders but remains almost the same in the neighboring area along the parabolic direction. With this assumption, we offer a regression method that first predicts the intensity difference for the rib center and then extends this value in a vertical direction so as to make the difference between the suppressed rib borders and the main tissue just below (or above) the border minimal.

@&#METHODS@&#

The system has an image preprocessing stage that involves two main tasks: local contrast enhancement (LCE) and lung segmentation. We use a common contrast enhancement approach [4] to increase contrast in the radiographic images, which is given by:
                           
                              (1)
                              
                                 
                                    
                                       L
                                       
                                          L
                                          C
                                          E
                                       
                                    
                                    =
                                    
                                       
                                          (
                                          L
                                          −
                                          
                                             L
                                             ˜
                                          
                                          )
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      L
                                                      ˜
                                                   
                                                   2
                                                
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         L
                                                         ˜
                                                      
                                                      )
                                                   
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where L is the original image, and the tilde indicates Gaussian blurring (Fig. 1
                        a and b). Lung segmentation is performed using a gray-level transform suggested by Chen et al. [22]. Before applying the gray-level transform, however, the radiographic images are enhanced by subtracting the two-dimensional fitted surface from the image and unsharp filtering. After squaring the gray levels, a Gaussian filter is applied to smooth the image. Following the preprocessing, the system performs two consecutive operations—rib delineation and then rib suppression—that take the product of the lung-segmented and original image as input (Fig. 1c).

In contrast to the existing methods that employ a curve fitting from the predicted upper or lower rib edges, our rib delineation step attempts to fit a template of a parabolic curve from a seed of the rib starting point, which can be effectively predicted using a robust log Gabor filtering approach. In this case, we can identify a curve somewhere in the middle of the rib rather than in the rib borders. The entire rib shadow is delineated by a problem-specific region growing technique, which we introduce in this section. This growing stage allows the system to detect exact rib regions that do not necessarily follow the globally fitted parabola equation extracted from the best template in the same image. This condition is considered to be another major contribution of this study.

Rib delineation involves six steps: (1) template extraction; (2) finding the rib starts at the outmost region of the ribcage by log Gabor filtering; (3) selecting the single best template that is most compatible with the rib cage; (4) estimating rib thickness; (5) parabola fitting to detect all ribs; and (6) delineating the entire set of ribs by a specific region-growing technique.

The rib detection task starts with extraction of a rib template from the content of queried image itself (Fig. 1d). This allows the framework to be exhibited entirely in an unsupervised manner. The template extraction method was based on the work of Lee et al. [12]. First, a locale sampling scheme technique is employed to enhance the rib contrast. The edge detection operator is then used to reveal candidate edges, and finally a simple selection scheme is applied to fix the template, which appears in the middle of the lung fields. The overall description of their methodology, however, did not elaborate on how to convert the edge-detected image into binary form or how to select the template that appears in the middle of the lung. It is there that both strategies significantly affect the continuity of the rib structure and, in turn, the quality of the final rib template extracted. In our study, we obtained the best binary image results when we used the minimum cross entropy (MCE) method for thresholding. In MCE, a cross entropy is computed in pixel-to-pixel basis between the original image and its binarized version. An iterative algorithm employing the gray-level histogram is applied to select the threshold that minimizes the computed cross entropy.

The best thresholding technique, however, may result in many small non-rib candidates and does not provide rib continuity. Therefore, after MCE, we apply a set of morphological operators: (1) a dilation operator is applied to connect disjointed ribs caused by missing foreground pixels due to thresholding, (2) an opening operator removes the noise, and (3) an erosion operator constructs the final rib structure by shrinking the foreground pixels in size and enlarging the holes within those areas.

To select the best candidates, we first flag the eight connected components that have the highest pixel count. Then, morphological thinning takes place. At the final step, we remove the templates by their orientation, Euler number, and eccentricity values. The remaining templates are further reduced after detecting rib starts until we have one template for each lung field. Orientation determines how candidate template is placed in the image. The ribs have opposite orientation angles in right and left lobes. Therefore, a candidate is removed if its orientation angle is conflicting with the lung lobe where it is located. Euler number is defined as the difference between the number of connected components and the number of holes in a candidate template. Here, we disregard the candidates with a negative Euler number. Eccentricity is the ratio of the distance between the foci of candidate template region and its major axis length. We accept only the candidates with an eccentricity value lower than 0.3 since the template would be too wide to become a rib at higher values.

Because the rib edges are easily affected by high noise levels when pure pixel-based edge detection methods are used [11], we chose to use log Gabor wavelets to find the rib borders. Using only the fourth scale and 45° and 135° [23] with the Otsu thresholding method gave us not all rib structures from the vertical middle line to the outer borders of the lung, but the initial points with real height values. Here, “initial points” refer to the region in which the rib structure intersects with the outer border of the lung. Finally, by shifting the lung mask, we can see all of the ribs positioned at their initial points, and we can eliminate those that do not appear to be at their initial points. We then apply a morphological thinning operation so the ribs are in a single-pixel-wide formation.

When more than one template is estimated for each lung field, we reduce them by calculating their distance to each of the thinned rib structures. The closest template is chosen as the best one. When a template is found only for one lung field (right or left), we create a new template by taking the symmetry of the existing one. Calculating the symmetry of a template consists mainly of three steps: (1) the best template must be formed as an elliptical curve because it is comprised of scattered pixels (Fig. 2
                           , dark blue lines on the right lung). Using these non-formed pixels, we find the coefficients for a polynomial p(x) of degree n that is a best fit (in a least-squares sense) for the data in y.
                              
                                 (2)
                                 
                                    
                                       p
                                       (
                                       x
                                       )
                                       =
                                       
                                          p
                                          1
                                       
                                       
                                          x
                                          n
                                       
                                       +
                                       
                                          p
                                          2
                                       
                                       
                                          x
                                          
                                             n
                                             −
                                             1
                                          
                                       
                                       +
                                       ⋯
                                       +
                                       
                                          p
                                          n
                                       
                                       x
                                       +
                                       
                                          p
                                          
                                             n
                                             +
                                             1
                                          
                                       
                                    
                                 
                              
                           (2) Its mirror symmetry is calculated (Fig. 2, magenta template). (3) Its final position is found with respect to the center of the mass of the region (Fig. 2, yellow template). After we compute the x and y coordinates of the vertex of the parabola we found in step (1), we can easily calculate the difference between this point and the center of the mass comprising the lung field on which this template lies. As this distance should be the same on these symmetrical lung fields, shifting the symmetrical template the distance value gives us the final template for the left lung (Fig. 1f).

The rib height (rh) value is used as a stopping criterion while enlarging the rib structure from its center. The main point of calculating rh is to find the longest vertical line that exists on the rib structures. Using all of the vertical lines—except those that, according to the Japanese Society of Radiological Technology (JSRT) database, are too thin (<10 pixels) or too thick (>24 pixels)—we calculated the mean rib height. This estimation is done automatically after the stage that detects the outermost starting point of ribs. This is an intermediate step before full delineation of ribs, but after complete detection of rib starts. Since the outermost rib regions are easier to detect, estimating a rib height with this stage makes the further delineation possible.

Parabola fitting is the task of estimating the parameters of template parabola equation that fit its pixels into approximate center of all ribs having their outermost starts are detected. In previous steps, we formulated both templates (for right and left lung areas) by calculating p
                           1, p
                           2, p
                           3 values. To fit the curve somewhere in the middle of the rib, we need to optimize the last parameter of the parabola. Whereas the first and second parameters are shape related, the third parameter affects the position of the template on the rib by moving the template up and down. Keeping the first two parameters the same, we calculated a list of p
                           3 values for each rib using each pixel pair that appears in the structure. Their means give us the final position of the template for its corresponding rib (Fig. 1g).

Each rib in a ribcage has potentially a different geometry based on its vertical location. Therefore, a global template parabola positioned into a specific rib starting from its outermost start does not necessarily fit into its curvature structure. The problem can be approached in two ways. First method is to apply a specific region growing technique that extends the rib until its borders, resulting with a full delineation having a center different from the initially fitted parabola [13]. The second approach, which we propose here, is to refine the rib center by re-estimating rib-specific parabola equation parameters and extend the rib linearly until the predicted rib height is reached. For comparison, we implemented both approaches.

The first method has two stages. The first stage is the quasi-parallel growth of the initial parabola curve fitted to a rib. We use the pixels in the middle of the rib as the initial seed points for regional growing by setting a threshold of average intensity change along all pixels on the parabola. The grown rib structure has broken pixels at some points. We use these broken pixels to generate the preliminary rib borders. The main idea is to shift the middle-line curve up and down repeatedly—provided that the shifted curve contains at least 50% of initially grown pixels. The first stage of regional growing resulted in a ticker parabola. In some cases, we could reach rib borders on the regionally growing part, but the result was generally a thinner structure than the actual rib. During the second stage, we considered the rib to consist of four horizontal parts, each of which we used individually to form the final rib structure. For each horizontal part, the growing process was repeated separately on the upper or lower part (not on both) based on the mean intensity change until the exact rib with predicted height was formed.

Our new method for rib region growing treats each pixel in the first parabolic curve independently and shifts it vertically into a new position (Fig. 1h). This position is determined such that it maximizes the intensity difference of upper rib half with the lung tissue above its border and that of lower rib half with the lung tissue beneath its border (Fig. 3
                           ). The new position of that pixel is more likely to be in vertical center of the rib since the entire rib has often a higher intensity than the lung tissue above and beneath the rib borders. For a fixed horizontal position x
                           0, the vertical position of the rib center y
                           0 is shifted into new position y
                           
                              i
                           , where i refers to the number of pixel shifts in any direction, i.e. up or down. The value of i is determined by an exhaustive search between −rh/2<
                           i
                           <
                           rh/2 so as to maximize the following objective function;
                              
                                 (3)
                                 
                                    
                                       f
                                       (
                                       i
                                       )
                                       =
                                       
                                          
                                             
                                                Σ
                                                
                                                   
                                                      y
                                                      i
                                                   
                                                   <
                                                   y
                                                   <
                                                   
                                                      y
                                                      i
                                                   
                                                   +
                                                   r
                                                   h
                                                   /
                                                   2
                                                
                                             
                                             
                                                L
                                                w
                                             
                                             (
                                             x
                                             ,
                                             y
                                             )
                                          
                                          
                                             
                                                Σ
                                                
                                                   
                                                      y
                                                      i
                                                   
                                                   +
                                                   r
                                                   h
                                                   /
                                                   2
                                                   +
                                                   1
                                                   <
                                                   y
                                                   <
                                                   
                                                      y
                                                      i
                                                   
                                                   +
                                                   r
                                                   h
                                                
                                             
                                             
                                                L
                                                w
                                             
                                             (
                                             x
                                             ,
                                             y
                                             )
                                          
                                       
                                       +
                                       
                                          
                                             
                                                Σ
                                                
                                                   
                                                      y
                                                      i
                                                   
                                                   −
                                                   r
                                                   h
                                                   /
                                                   2
                                                   <
                                                   y
                                                   <
                                                   
                                                      y
                                                      i
                                                   
                                                
                                             
                                             
                                                L
                                                w
                                             
                                             (
                                             x
                                             ,
                                             y
                                             )
                                          
                                          
                                             
                                                Σ
                                                
                                                   
                                                      y
                                                      i
                                                   
                                                   −
                                                   r
                                                   h
                                                   /
                                                   2
                                                   −
                                                   1
                                                   <
                                                   y
                                                   <
                                                   
                                                      y
                                                      i
                                                   
                                                   −
                                                   r
                                                   h
                                                
                                             
                                             
                                                L
                                                w
                                             
                                             (
                                             x
                                             ,
                                             y
                                             )
                                          
                                       
                                    
                                 
                              
                           where L
                           
                              w
                            refers to the sum of intensities for the pixels between x
                           0
                           −
                           w
                           <
                           x
                           <
                           x
                           0
                           
                           +
                           
                           w for a vertical position y, and w is a manual parameter that denotes the width of the window considered for comparing the intensities between regions of interests. The value of w should be large enough that the appearance of a nodule or other abnormality in that region would not misguide the rib boundaries and be small enough that the variations in the overall pixel intensity along horizontal direction would not affect the local rib intensity model. Based on our visual inspections, we set w to 20 in our experiment, which reasonably satisfies these constraints.

The shift operation is allowed at most rh/2 times in both directions since further shifts may have the pixel coincide with another rib border. Due to irregularities in the lung tissue, estimated center pixels may be relocated into a wrong direction. Since we observe that those pixels can be simply regarded as outliers, we use a dynamic programming algorithm to eliminate them. We then built a new list of rib center points from remaining pixels, which in turn will be used to construct a new parabola that would best fit into the specific rib under consideration (Fig. 1i). Therefore, a distinct parabola can be fitted into each rib in the same rib-cage guided by an initial global template. Taking new parabolic curve as the complete rib center, the task of rib region growing for final delineation is then straightforward: it simply extends the center curve in upper and lower directions for rh/2 times (Fig. 1j).

Having delineated the ribs on the image, the next step was to suppress the delineated regions to remove the shadow of the ribs without losing information about the original lung tissue. Whereas the current solutions for rib suppression assume that the contribution of the intensity of the ribs is the same for all points in the delineated region, we took into account variations in the thickness of the ribs in the proximal direction when vertically moving away from the center. Our basic assumption was that the vertical center of a rib has the greatest thickness proximally, and the borders have the lowest. Therefore, suppression starts from the pixels at the vertical center of the rib and extends adaptively until the rib borders are reached.

Given the observed intensity values, S
                        =(s
                        1,s
                        2,…,s
                        
                           k
                        ), for a set of pixels that refers to the parabolic curve at the rib center in the vertical direction, where k is the number of such pixels, the aim was to find the suppressed intensity values, S′=(s
                        1′,s
                        2′,…,s
                        
                           k′), which can be simply calculated by S′
                           =S
                        −
                        D. D
                        =(d
                        1
                        ,d
                        2,…,d
                        
                           k
                        
                        ) is the bone–tissue difference that occurs depending on the rib thickness in the proximal direction. Therefore, the rib suppression task can be defined as estimating rib shadow, D, from known intensity values of the main tissue outside the rib borders and the bone tissue in the horizontal neighborhood (Fig. 1k) and subtracting from the observed intensity (Fig. 1l).

We compute the values of D, based on the approximate geometric model for rib cross-section anatomy shown in Fig. 4a. The rib cross-section is assumed to be a rectangle with circular end points at each border. This assumption reasonably fits into exact anatomy of posterior ribs [24]. With this geometric model, the value of d
                        
                           i
                        , for ith pixel in the rib curve, is same until a vertical position c, where the proximal rib thickness begins to degrade. Having labeled the rib center by vertical position 0, the rib intensity to be subtracted for vertical position j, denoted by d
                        
                           i
                        (j) is calculated as (see Fig. 4b):
                           
                              (4)
                              
                                 
                                    
                                       d
                                       i
                                    
                                    (
                                    j
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               d
                                                               i
                                                            
                                                            (
                                                            0
                                                            )
                                                         
                                                         
                                                            (
                                                            r
                                                            h
                                                            −
                                                            c
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  (
                                                                  r
                                                                  h
                                                                  −
                                                                  c
                                                                  )
                                                               
                                                               2
                                                            
                                                            −
                                                            
                                                               
                                                                  (
                                                                  j
                                                                  −
                                                                  c
                                                                  )
                                                               
                                                               2
                                                            
                                                         
                                                      
                                                      ,
                                                   
                                                
                                                
                                                   
                                                      j
                                                      >
                                                      c
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         d
                                                         i
                                                      
                                                      (
                                                      0
                                                      )
                                                      ,
                                                   
                                                
                                                
                                                   
                                                      j
                                                      ≤
                                                      c
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Here, we need two parameters to be estimated: c and d
                        
                           i
                        (0), which denote the point that rib begins to get thinner and the intensity difference for rib center respectively. We intuitively set c
                        =
                        rh/4, which is reasonable good choice to soften the transitions between rib and lung tissue at the borders. d
                        
                           i
                        (0) is estimated by an unsupervised regression model given by:
                           
                              (5)
                              
                                 
                                    
                                       d
                                       i
                                    
                                    (
                                    0
                                    )
                                    =
                                    
                                       
                                          
                                             ∑
                                             
                                                
                                                   
                                                      
                                                         
                                                            i
                                                            −
                                                            w
                                                            <
                                                            x
                                                            <
                                                            i
                                                            +
                                                            w
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            −
                                                            
                                                               
                                                                  r
                                                                  h
                                                               
                                                               2
                                                            
                                                            ≤
                                                            y
                                                            ≤
                                                            
                                                               
                                                                  r
                                                                  h
                                                               
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                s
                                                x
                                             
                                             (
                                             y
                                             )
                                          
                                          −
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  i
                                                                  −
                                                                  w
                                                                  <
                                                                  x
                                                                  <
                                                                  i
                                                                  +
                                                                  w
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        r
                                                                        h
                                                                     
                                                                     2
                                                                  
                                                                  <
                                                                  y
                                                                  r
                                                                  h
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      x
                                                   
                                                   (
                                                   y
                                                   )
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  i
                                                                  −
                                                                  w
                                                                  <
                                                                  x
                                                                  <
                                                                  i
                                                                  +
                                                                  w
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  −
                                                                  r
                                                                  h
                                                                  y
                                                                  <
                                                                  −
                                                                  
                                                                     
                                                                        r
                                                                        h
                                                                     
                                                                     2
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      x
                                                   
                                                   (
                                                   y
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          2
                                          w
                                          *
                                          r
                                          h
                                       
                                    
                                 
                              
                           
                        Informally, the intensity difference to be subtracted from the rib center is estimated by subtracting average of the pixel intensities just above the upper rib border and those just below the lower rib border from observed average intensity on the rib center. This approach makes sense because the cumulative intensity in a chest radiographic image linearly changes in vertical direction due to positioning of the patient in screening. Here, w is the same parameter as used in rib center refinement, and set to 20 with same reasoning explained in previous section.

To prove the proposed anatomical model is correct, we select a rib region and plot its vertical intensity profile (Fig. 5
                        ). Although our model refers to anatomy of sole rib, but not the overlap of tissue and rib, this profile can give an intuition about the sole rib anatomy if the selected rib region has little abnormality in underlying lung tissue. For this reason, we select here a rib region in the middle of right lung lobe, where the normal tissue has a homogeneous texture since an overlapping organ or a dense vessel structure does not exist. To get an aligned plot of several horizontally neighboring rib sections, we divide the pixel intensity by average intensity over same vertical rib position. Fig. 5 illustrates the vertical intensity profile of several horizontally neighboring positions along the rib region. Their average is shown by a red plot. According to this figure, observed intensity profile does fit reasonably to the anatomical rib model that we assume in Fig. 4.

@&#RESULTS@&#

We compiled our method based on a well-known JSRT data set that had 154 chest radiographs with known nodules. Among the 154 images, at least one template had been identified in 150 images, with the best one selected for self-template matching. No template was identified for the other four images (JSRT images numbered as 51, 70, 145 and 152). This demonstrates the general success of the rib template extraction step.

In 65% of images, all ribs were perfectly located with a false discovery rate of 8.5%. This detection rate is computed as 90.1% if only one rib is allowed to be missed, which is usually the case because the lowest left rib is often obscured by the heart shadow. In this context, we define rib detection as correct identification of the position of the rib regardless of whether its borders are perfectly located. Here, a false discovery rate refers to average number of regions which were reported as a rib by the system but in fact having no actual rib pixel on it. When each rib is considered as a separate sample, the detection recall (or sensitivity) is 97.1%, with a precision of 91.5% out of all images.

The delineation (locating the exact position of all pixels) performance was evaluated by the accuracy, sensitivity, and specificity of predictions at the pixel level. With this objective, a ground truth was built by having an observer manually delineate the ribs in all images. Another observer then attempted the delineations to determine the effect of human perception. Both observers have a deep knowledge on medical imaging modalities and a significant expertise in radiography image analysis. Based on the system predictions for all individual pixels, the evaluation metrics are computed as follows:
                        
                           (6)
                           
                              
                                 S
                                 p
                                 e
                                 c
                                 i
                                 f
                                 i
                                 c
                                 i
                                 t
                                 y
                                 =
                                 
                                    
                                       n
                                       u
                                       m
                                       b
                                       e
                                       r
                                        
                                       o
                                       f
                                        
                                       p
                                       i
                                       x
                                       e
                                       l
                                       s
                                        
                                       c
                                       o
                                       r
                                       r
                                       e
                                       c
                                       t
                                       l
                                       y
                                        
                                       p
                                       r
                                       e
                                       d
                                       i
                                       c
                                       t
                                       e
                                       d
                                        
                                       a
                                       s
                                        
                                       n
                                       o
                                       r
                                       m
                                       a
                                       l
                                        
                                       t
                                       i
                                       s
                                       s
                                       u
                                       e
                                    
                                    
                                       n
                                       u
                                       m
                                       b
                                       e
                                       r
                                        
                                       o
                                       f
                                        
                                       a
                                       c
                                       t
                                       u
                                       a
                                       l
                                        
                                       n
                                       o
                                       r
                                       m
                                       a
                                       l
                                        
                                       t
                                       i
                                       s
                                       s
                                       u
                                       e
                                        
                                       p
                                       i
                                       x
                                       e
                                       l
                                       s
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (7)
                           
                              
                                 S
                                 e
                                 n
                                 s
                                 i
                                 t
                                 i
                                 v
                                 i
                                 t
                                 y
                                 =
                                 
                                    
                                       n
                                       u
                                       m
                                       b
                                       e
                                       r
                                        
                                       o
                                       f
                                        
                                       p
                                       i
                                       x
                                       e
                                       l
                                       s
                                        
                                       c
                                       o
                                       r
                                       r
                                       e
                                       c
                                       t
                                       l
                                       y
                                        
                                       p
                                       r
                                       e
                                       d
                                       i
                                       c
                                       t
                                       e
                                       d
                                        
                                       a
                                       s
                                        
                                       r
                                       i
                                       b
                                    
                                    
                                       n
                                       u
                                       m
                                       b
                                       e
                                       r
                                        
                                       o
                                       f
                                        
                                       a
                                       c
                                       t
                                       u
                                       a
                                       l
                                        
                                       r
                                       i
                                       b
                                        
                                       p
                                       i
                                       x
                                       e
                                       l
                                       s
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (8)
                           
                              
                                 A
                                 c
                                 c
                                 u
                                 r
                                 a
                                 c
                                 y
                                 =
                                 
                                    
                                       n
                                       u
                                       m
                                       b
                                       e
                                       r
                                        
                                       o
                                       f
                                        
                                       c
                                       o
                                       r
                                       r
                                       e
                                       c
                                       t
                                       l
                                       y
                                        
                                       p
                                       r
                                       e
                                       d
                                       i
                                       c
                                       t
                                       e
                                       d
                                        
                                       p
                                       i
                                       x
                                       e
                                       l
                                       s
                                        
                                       (
                                       r
                                       i
                                       b
                                        
                                       o
                                       r
                                        
                                       n
                                       o
                                       r
                                       m
                                       a
                                       l
                                        
                                       t
                                       i
                                       s
                                       s
                                       u
                                       e
                                       )
                                    
                                    
                                       n
                                       u
                                       m
                                       b
                                       e
                                       r
                                        
                                       o
                                       f
                                        
                                       a
                                       l
                                       l
                                        
                                       p
                                       i
                                       x
                                       e
                                       l
                                       s
                                    
                                 
                              
                           
                        
                     The overall delineation performance is shown in Tables 1 and 2
                     
                      together with the manual performance of the other observer and automated performances of two previous methods. All delineation results, including manual observations and automated predictions, are deposited in our web site for public use (www.baskent.edu.tr/∼hogul/xray). According to the results, the present method achieves a better performance than the previous methods for all evaluation criteria in all cases. It was also revealed that the system can perform as successfully as the manual observers. This result is consistent for both cases where the observers tested the delineation performance of one another.

To assess the diagnostic assistance value of delineation, we re-compiled an existing CAD tool so as to take into account the knowledge of delineated ribs. The CAD system that we use follows a supervised approach that learns to discriminate between nodule and non-nodule segments in an image using a set of representative image features [4]. After fixing a trained model, all new samples are submitted through a prediction interface to report nodule alerts. We modified the CAD system by using an additional feature in nodule representation. The new feature has a boolean value that denotes the center of the candidate nodule as being on a rib region or not. This knowledge can obtained from manual delineation of pixels or the prediction of our automatic delineation system. The system was re-trained with the new feature representation scheme that simply concatenates the existing feature set with this boolean value. The candidate nodule segments were predicted in the same way. Table 3
                      shows the nodule detection performances for original CAD systems and modified CAD systems. The modified version was run for both manually delineated ribs and those automatically detected by our delineation algorithm. The whole experiment was conducted on JSRT database to measure the sensitivity of predictions. The average number of false positives, i.e. the segments incorrectly predicted as nodules, per image was also reported since it is a common performance indicator used in CAD system evaluations. The table determines that the knowledge of rib delineations can significantly improve the nodule detection performance in CAD systems with our simple strategy of incorporating one additional feature into training model. It is shown that the nodule detection sensitivity is increased with lower number of false nodule alerts. The automatic rib delineation model that we propose can perform as successfully as the manual delineation in assisting the diagnostic tool.

Diagnostic assistance value of the rib suppression was also determined by the degree of improvement in existing CAD systems after relevant modification. To this end, the images with eliminated rib shadow were fed to the CAD system which was re-trained with suppressed images using the same feature sets in its original configuration. The results were shown in Table 3. Although number of detected nodules cannot be increased, the rib suppression can help in reducing the number of false nodule alerts.

We introduce the concept of nodule visibility to evaluate the usability of rib suppression in manual observation of the nodules hidden by bones. The nodule visibility, denoted by Δ, is defined as the ratio of average intensity of the nodule pixels beneath the rib to the average intensity of rib pixels surrounding the nodule area. Here, a nodule is assumed to have a circular shape and surrounding area is considered as a ring outside the nodule circle. The ring has the same internal radius as the nodule and an external radius determined such that the surrounding area is almost equal to that of nodule. We only considered the nodules whose center is a pixel annotated as rib. In case of partial overlap between the nodule and overlapping rib, we only evaluated the pixels on rib region. Having a nodule visibility for the original image, Δorg, and another for the suppressed image, Δsup; we calculate the differential visibility by Δsup/Δorg. To have a good suppression, we expect this ratio to be at least 1. If it is 1, this implies that suppression does not reduce the visibility of the nodule while eliminating rib shadow. If this ratio is higher than 1, the nodule visibility is increased with suppression. Having a differential visibility lower than 1 means that nodule was suppressed more than ribs; therefore its visibility is reduced. Fig. 6
                      demonstrates the evaluation of nodule visibility for 20 images in the dataset, where annotated nodule center resides on a predicted rib region. According to the results, the nodule visibility was increased in ten of those cases. For eight of the cases, the visibility was unchanged. The visibility was decreased in only two cases. These results validate that the suppression model can successfully eliminate rib shadows while serving an increased, or at least preserved, nodule visibility to manual observer.

The rib suppression performance is illustrated by some images with their original and suppressed versions in Fig. 7
                     . It can be argued from the examples that the system can successfully eliminate the rib shadows and display a better view of normal tissue. In each image, the rib intensity is sufficiently lowered while the nodule intensity is mostly preserved. It should be also noted that, some irregular, but healthy, tissue patterns particularly in lower parts of the lung fields are still kept in suppressed images.

A current limitation of the proposed suppression algorithm is the fact that the rib shadow cannot be calculated effectively for the regions close to the chest wall due to the horizontal window that is used in regression model. This leads to failure of suppression in outer rib pixels. This may even cause that the original shape of a nodule in this area is distorted. The case reported in Fig. 8
                      is indeed the main reason for decreased sensitivity of CAD system with suppressed images in Table 3. Since the structure of the nodule was broken, relevant image features calculated in classification system were misguided the prediction. This nodule has also attained the lowest differential visibility (0.98) reported in Fig. 6.

@&#DISCUSSION AND CONCLUSIONS@&#

We have introduced a complete framework that takes an unprocessed lung image obtained through chest radiography, reports the pixels of the entire rib regions, and eliminates rib shadows by subtracting an estimated rib effect from the observed intensity.

The contributions of the study are threefold. First, a parabola equation extracted from a rib border template is fitted into rib seeds, which are defined as the starting points of the ribs closer to the outermost (right or left) part of the ribcage. The previous methods largely depended on the quantitative and qualitative value of detected rib borders. Most often, the method employed for edge detection failed to cover all of the ribs in the ribcage or reported incorrectly some other curves that resemble a rib boundary. As the present method does not require detection of any border but only its outermost starting point, the detection rate can be substantially increased by using the log Gabor filtering approach. The second contribution is a new region-growing technique that is introduced to extend the rib center to build the entire rib until rib boundaries are reached. The technique allows each individual rib to grow independently from its initial parabola equation. In that sense, the difference between the curvature structures of the upper and lower ribs can be elaborated. The experimental results have shown that the automated system can delineate the ribs as successfully as a manual observation. The novel rib suppression technique that we offer is the third contribution. The technique assumes different rib thicknesses in the vertical direction while preserving it in the horizontal direction as being more relevant to the foundations of ribcage anatomy. A regression model built on this assumption can successfully remove the rib shadows, which finally provides a clear view of lung tissue.

It is shown that the knowledge of rib delineations can improve the nodule detection ability of current CAD systems. This can be achieved by integrating an additional feature that represents the estimated information of whether the candidate nodule is obscured by a rib shadow. The suppressed image can also help in reducing the false nodule alerts, which is usually more desirable by radiologists to consider a CAD system as a practical tool in clinical use. It is systematically shown that the visibility of nodules can be increased after rib suppression. Furthermore, the knowledge to be generated by the proposed system, either in the form of delineation or suppression, is anticipated to facilitate the detection of other abnormalities in chest radiographs, which in turn to offer a general diagnostic tool that will assist radiologists.

A number of future directions can be drawn to compete with current limitations of the system. For weak suppression problem in lung regions close to chest wall, using a narrower window may usually help. However, we observed that lowering window width resulted with a weaker suppression in general rib area. From a clinical point of view, this is less preferred since the upper and lower rib borders become more apparent, which is the actual reason why rib shadow elimination is needed. Another solution will be using a context-sensitive regression model which is computed with varying parameters for each region. Evaluating computational feasibility of such model is left as a future work. Another limitation of the current system is imposed by our assumption that the images have almost horizontal symmetry. The missing cases in template extraction can be attributed to two reasons. First, rib shadows cannot be observed in original image. In fact, this should not be considered as a problem, since no suppression is needed in this case. Therefore, failing to delineate the ribs has no negative effect in the manual observation of a radiologist. Second reason is the lack of horizontal symmetry in lung area. This leads to a failure in identifying the symmetry of an extracted template only in one lobe. Since the system disregards any rib template found in only one lobe, no further delineation, and therefore suppression, can be pursued. In practical applications, a pre-processing step that can transform the input image as to have a horizontal symmetry will be needed. To increase the nodule detection performance in upper lung regions, detection and suppression of clavicles is also crucial. Although our suppression model can be simply applied for clavicles, their delineation requires a specific model since they cannot fit into a parabolic model that we assumed for the ribs. Integrating this system with a clavicle detection model will be more helpful in practice.

@&#ACKNOWLEDGMENTS@&#

This study was supported by the Turkish Ministry of Science, Technology, and Industry and Akgun Software Company (SAN-TEZ project grant no.: 379.STZ.2013-2).

@&#REFERENCES@&#

