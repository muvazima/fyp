@&#MAIN-TITLE@&#The Zeta-image, illuminant estimation, and specularity manipulation

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A novel log-chromaticity illumination constraint we call the Zeta-image.


                        
                        
                           
                           The new feature is equivalent to a novel application of the Kullback–Leibler Divergence.


                        
                        
                           
                           For illumination estimation the method outperforms other unsupervised methods.


                        
                        
                           
                           Post-processing any color constancy method, that method’s accuracy is improved.


                        
                        
                           
                           Using the Zeta-image we are able to manipulate specular content in the image.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Specular

Illuminant estimation

Color constancy

Zeta-image

@&#ABSTRACT@&#


               
               
                  Identification of illumination, the main step in colour constancy processing, is an important problem in imaging for digital images or video, forming a prerequisite for many computer vision applications. In this paper we present a new and effective physics-based colour constancy algorithm which makes use of a novel Log-Relative-Chromaticity planar constraint. We call the new feature the Zeta-image. We show that this new feature makes use of a novel application of the Kullback–Leibler Divergence, here applied to chromaticity values instead of probabilities. The new method requires no training data or tunable parameters. Moreover it is simple to implement and very fast. Our experimental results across datasets of real images show that the proposed method significantly outperforms other unsupervised methods while its estimation accuracy is comparable with more complex, supervised, methods. As well, we show that the new planar constraint can be used as a post-processing stage for any candidate colour constancy method in order to improve its accuracy. Its application in this paper demonstrates its utility, delivering state of the art performance. The Zeta-image is a wholly new representation for understanding highlights in images, and we show as well that it can be used to identify and remove specularities. More generally, since the Zeta-image is intimately bound up with specularities, we show how specular content in the image can be manipulated, either decreasing or increasing highlights.
               
            

@&#INTRODUCTION@&#

Identification of illumination is an important problem in image processing for digital cameras. The implications for a useful discounting or regularizing for light in images are substantial in various computer vision tasks such as image retrieval, colour reproduction and object detection [1].

In a scene consisting of dielectric materials (e.g., plastics, and indeed most non-metals) there is typically substantive specular content. This does not necessarily mean extremely bright mirror-like reflection, but can consist for example of the glint of light reflected from blades of grass, or the sheen of light reflected from a plastic desk surface. For non-metals, this very common specular content is an important indicator of the colour of the lighting in a scene, and hence has substantial bearing on determination of a correct white balance for camera images.

Many colour constancy algorithms have been proposed (see [2,3] for an overview). The foundational colour constancy method, the so-called White-Patch or Max-RGB method, estimates the light source colour from the maximum response of the different colour channels [4]. Another well-known colour constancy method is based on the Grey-World hypothesis [5], which assumes that the average reflectance in the scene is achromatic. Grey-Edge is a recent version of the Grey-World hypothesis that says: the average of the reflectance differences in a scene is achromatic [6]. Besides these simple assumptions there are other approaches that use physical image formation models in order to estimate the illuminant. These usually use the specular reflection component of light as a main source of information. Moreover, there are more complex methods to estimate the colour of the illuminant by using a model that is learned on training images.

In this paper, we set out a new discovery, consisting of a planar constraint that must be obeyed, in a certain standard model of reflectance, by specular or near-specular pixels in an image. The new feature involved we call the Zeta-image, and below we show that this feature is tied to the information-theoretic concept of applying one distribution to generate bitstring codes for another; here we view chromaticity components, which add to 1, in the role of probabilities. We present a novel physics-based colour constancy algorithm based on a Log-Relative-Chromaticity planar constraint (LRCP-Constraint), which requires no training data or tunable parameters. It is easy to implement and very fast compared to more complex colour constancy methods such as gamut mapping. Our experimental results over three large datasets of both laboratory and real world images show that the proposed method significantly outperforms other unsupervised methods while its accuracy of estimation is comparable with more complex methods that need training data and tunable parameters.

The paper is organized as follows. We discuss related work in Section 2, and in Section 3 we describe the fundamental process of the Log-Relative-Chromaticity planar constraint that we set out in this paper and define the Zeta-image to that purpose. In Section 4 we explicate aspects of the new planar constraint by making use of synthetic data. In Section 5 we illustrate the utility of the Zeta-image for real images and propose two colour constancy algorithms based on the LRCP-Constraint, one a search-based and then search-plus-analytic based method of estimating the illuminant, and the second a method for applying the LRCP-Constraint as a post-processing step to improve the estimate for any colour constancy method used. We compare our proposed algorithms with previous colour constancy algorithms over three standard datasets in Section 6, demonstrating the efficacy of the new insight for real images.

We then go on to further make use of the association of the Zeta-image with specular content: Section 7 examines the role of the Zeta-image in manipulating specularities, in the spirit of the “dichromatic editing” procedure in [7]. Here we set out a simple and fast method for specularity manipulation, either boosting or diminishing the specular content. Finally, in Section 8 we summarize, and identify questions for further work.

In forming the LRCP-Constraint, we suggest using a Relative Chromaticity, meaning the chromaticity of pixels (i.e., colour without magnitude), divided by the putative chromaticity of the illuminant. Dividing by the light chromaticity is the main innovative step in this paper: it forms an educated guess (called an ansatz in physics), that we claim will bear fruit by generating a constraint on the illuminant colour. We introduced this proposed approach in [8] and here explicate the method in detail. As well, here we set out a novel method for manipulating specular content in images, based on the Log-Relative-Chromaticity feature stemming from this ansatz. In the preliminary publication, we did not include any discussion of specularity manipulation, and as well the experimental section was not complete. In this submission we go on to set out the details of the method more comprehensively, and as well investigate the meaning of the new feature with illustrations.

@&#RELATED WORK@&#

Illumination estimation methods can be categorized into two major groups: (1) static methods, which try to estimate the illuminant for each image based on its statistical or physical properties and (2) learning-based methods, which try to estimate the illuminant using a model that is learned on training images.

Grey-based methods form a main part of static methods. They have been formalized into a single framework [9,10] using the Minkowski p-norm:
                        
                           (1)
                           
                              
                                 
                                    
                                       
                                          ∫
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                               
                                                               
                                                                  n
                                                               
                                                            
                                                            
                                                               
                                                                  I
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            (
                                                            x
                                                            )
                                                         
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  n
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                p
                                             
                                          
                                          
                                          dx
                                       
                                    
                                 
                                 
                                    
                                       
                                          1
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    e
                                 
                                 
                                    k
                                 
                              
                           
                        
                     where e is estimated illuminant colour, k denotes 
                        
                           R
                           ,
                           G
                        
                      or 
                        
                           B
                           ,
                           p
                        
                      denotes the Minkowski norm and n is grey-edge order. If 
                        
                           n
                           =
                           0
                        
                     , for 
                        
                           p
                           =
                           1
                        
                      the equation is equal to the grey-world assumption, for 
                        
                           p
                           =
                           ∞
                        
                      it is equal to colour constancy by White-Patch, and for 
                        
                           1
                           <
                           p
                           <
                           ∞
                        
                      it is Shades of Grey. For higher n it is a variant of Grey-Edge.

Static colour constancy methods also include some physics-based methods, which usually use specularity to estimate the illuminant chromaticity, and we shall discuss these below in Section 2.1.

The Gamut Mapping algorithm, a more complex and more accurate algorithm, was introduced by Forsyth [11]. It is based on the assumption that in real-world images, for a given illuminant one observes only a limited number of colours. Several extensions have been proposed [12,13].

Another learning-based approach to the illumination estimation problem is the Bayesian method [14,15], in which the variability of reflectance and illuminant are modeled as independent random variables. These methods estimate illuminant colour from the posterior distribution condition learned from training images. Here the illuminant prior could be uniform over a subset of illuminants [14] or could be an empirical distribution of illuminants in training images [15]. Other machine learning techniques includes using neural networks [16], in which binarized chromaticity histograms are used to estimate 2D illuminant chromaticity via a neural network system, or support vector regression [17]. In a method using spatio-spectral statistics, Chakrabarti et al. [18] go on to use horizontal and vertical Gaussian second derivatives as subband filters, and adopting a parametric statistical model they derive a maximum-likelihood estimate of the illuminant in an iterative scheme.

More complex methods try to learn to select the best algorithm or combination of algorithms for each image using pixel information as well as spatial information. They extract texture, shape or colour features from sets of training images, and estimate the colour of the illuminant for each image using several statistical illumination estimation algorithms. They then learn a model based on extracted features as well as the error of these estimates compared to known ground truth. This type of model could e.g. learn the set of weights associate with estimates of these illumination estimation algorithms [19,20] or directly learn the colour of the illuminant [21,22]. It can be stated that the main differences amongst this kind of algorithm are in the feature extraction blocks, where the feature could be simple, such as a colour histogram [23,21], or edge direction histogram [21], or more complex features such as Weibull features [19,22,20], Wiccest features [20], or Wavelet statistics [21].

Gijsenij and Gevers [19] cluster images by a k-means algorithm using natural image statistics to characterize the images on the basis of Weibull distribution parameters. They then make a correspondence between each cluster and the best single algorithm for training images for that cluster. To estimate the illuminant of a test image, they select the algorithm according to its cluster or combination of the individual algorithms according to the distances to neighbouring clusters.

Van de Weijer et al. [24] extend the grey world hypothesis to say: the average reflectance of semantic classes in an image is equal to a constant colour, rather than being just grey. Therefore, for each of the semantic classes present in an image they compute that illuminant which transforms the pixels assigned to that class into the average reflectance colour of that semantic class in the training images. They call this a top-down approach as opposed to bottom-up approaches used in many other colour constancy methods. They also make use of high-level visual information to select the best illuminant out of a set of possible illuminants generated by other methods.

Finally, in the Exemplar-Based colour constancy method [25], both texture features and weakly colour-constant three-channel RGB colour values are used in order to find the nearest-neighbour surfaces from training data for each surface. Then a possible illuminant for each surface is estimated based on histogram matching of each surface to its nearest-neighbour surfaces from the training data.

In specular reflection, light from a single incoming direction is reflected into a small cone of outgoing directions. This contrasts with diffuse reflection, where light is partially absorbed and partially scattered within the surface material. Moreover, the spectral power distribution (SPD) of specular reflections is the same as the illumination’s SPD, within a Neutral Interface Reflection (NIR) [26] condition, which obtains in large measure for the surfaces of optically inhomogeneous objects (such as ceramics, plastics, and paints); however it does not hold for the surfaces of optically homogeneous objects (such as gold, bronze, and copper) [27]. These properties make specular reflection, which is usually in bright areas of an image, an appropriate tool for estimating illumination. Many illumination estimation methods derive from the dichromatic model for specular reflection proposed by Shafer [28].

Klinker et al. [29] showed that when the diffuse colour is constant over a surface, the colour histogram of its image forms a skewed-T shaped distribution, with the diffuse and specular pixels forming linear clusters. They used this information to estimate a single diffuse colour. In order to use this principle, their approach needed to segment an image into several regions of homogeneous diffuse colour.

Lee [30] proposed a method which uses specularity to compute illumination by using the fact that in the CIE chromaticity diagram [31] the coordinates of the colours from different points on the same surface will fall on a straight line connected to the specular point. This is the case when the light reflected from a uniform surface is an additive mixture of the specular component and the diffuse component. This seminal work initiated a substantial body of work on identifying specular pixels and using these to attempt to discover the illuminant [32,33]. Another approach extending these algorithms is to define a constraint on the possible colours of illumination, making estimation more robust [34,35]. Although these works are theoretically strong, most of them do not report performance over real world datasets of images with and without specularities.

In a recent approach, Gevers et al. [36] use a specular weighting scheme to emphasize potential specular (or shadow) edges, which then partake in a weighted grey-edge illumination estimation. The estimate is improved by iteratively removing colour cast and re-estimating the illuminant again using new weights, eventually driving the change in illumination estimate toward 
                           
                              
                                 
                                    (
                                    1
                                    ,
                                    1
                                    ,
                                    1
                                    )
                                 
                                 
                                    t
                                 
                              
                           
                        .

@&#EVALUATION@&#

In order to evaluate performance of a colour constancy method we need to calculate the error of our estimation. Suppose the actual chromaticity of the illuminant is denoted by 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                        , and consider an estimate 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    est
                                 
                                 
                                    e
                                 
                              
                           
                         determined by any of the aforementioned illumination estimation methods. Various error measures have been used to calculate the error between the correct value and the estimate. Two measures commonly used are angular error, which is the angle between 3-vector 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                         and 3-vector 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    est
                                 
                                 
                                    e
                                 
                              
                           
                        , and Euclidean error. With the usual 
                           
                              
                                 
                                    L
                                 
                                 
                                    1
                                 
                              
                           
                        -norm based chromaticity defined in terms of 3 components as 
                           
                              {
                              r
                              ,
                              g
                              ,
                              b
                              }
                              =
                              {
                              R
                              ,
                              G
                              ,
                              B
                              }
                              /
                              (
                              R
                              +
                              G
                              +
                              B
                              )
                           
                        , the Euclidean distance error metric simply uses distance in 3-D chromaticity colour space. Note that in fact angular error and Euclidean distance are highly correlated to each other [37]. Here we also mention perceptual Euclidean distance [38], which uses perceptually optimized weights for Euclidean distance; and finally also used are the RMS error over all pixels, in 
                           
                              r
                              ,
                              g
                              ,
                              b
                           
                         or 
                           
                              R
                              ,
                              G
                           
                        , between the image corrected for illumination and the ground truth image. In this paper, we use angular error as our measurement for computing estimation error because of its frequent use in the literature [37,39]. It is also shown by [38] that the angular error is a reasonably good indicator of the human perceptual performance of colour constancy methods.

In terms of 3-component chromaticity vectors 
                           ρ
                        , angular error is defined as
                           
                              (2)
                              
                                 
                                    
                                       err
                                    
                                    
                                       angle
                                    
                                 
                                 (
                                 
                                    
                                       ρ
                                    
                                    
                                       e
                                    
                                 
                                 ,
                                 
                                    
                                       ρ
                                    
                                    
                                       est
                                    
                                    
                                       e
                                    
                                 
                                 )
                                 =
                                 acos
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      e
                                                   
                                                
                                                ·
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      est
                                                   
                                                   
                                                      e
                                                   
                                                
                                             
                                             
                                                ‖
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      e
                                                   
                                                
                                                ‖
                                                ‖
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      est
                                                   
                                                   
                                                      e
                                                   
                                                
                                                ‖
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Having a set of images with known colour of illuminant, we can calculate the error of estimation (using either of the generally used error metrics) for each image. Then the overall metric of performance of an algorithm for that set of images can be the mean of errors. However the mean by itself is not a good index for evaluating performance of methods [37]. The median or trimean of errors is usually preferred in the literature [37,38] because the mean is sensitive to outliers. The median indicates the performance of the methods for half of the images or equally the 50th percentile error. The trimean of a distribution is defined as a weighted average of its median and its top and bottom quartiles. In this paper we calculate both mean and median to compare different illumination estimation algorithms.

Let the RGB 3-vector for the light itself as seen by the camera be 
                           
                              
                                 
                                    e
                                 
                                 
                                    k
                                 
                              
                           
                        , and let the 3-vector for the reflectance at a pixel as seen by the camera, under equi-energy white light, be 
                           
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                           
                        . Now in a simple product-of-vectors model [40] we approximately have the matte (“body”, i.e., non-specular) RGB value at that pixel equal to
                           
                              (3)
                              
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                 
                                 
                                 ≃
                                 
                                 
                                    
                                       σ
                                       
                                          
                                             s
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 k
                                 =
                                 1
                                 …
                                 3
                              
                           
                        where 
                           
                              σ
                           
                         is shading. In the standard Lambertian model for matte shading, 
                           
                              σ
                           
                         equals lighting-direction dotted into surface normal. Here, 
                           
                              
                                 
                                    q
                                 
                                 
                                    k
                                 
                              
                           
                         is a triple giving the overall (integrated) camera sensor strength [40,41] (
                           
                              
                                 
                                    q
                                 
                                 
                                    k
                                 
                              
                           
                         can be omitted if the R, G, and B sensor magnitudes are assumed equal to unity; otherwise, in a general situation, two sensor magnitudes appear in the product 
                           
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                              
                                 
                                    e
                                 
                                 
                                    k
                                 
                              
                           
                         and so the approximation (3) would be incorrect without a factor 
                           
                              
                                 
                                    q
                                 
                                 
                                    k
                                 
                              
                           
                         in the denominator).

If we also consider an additional specular component, this equation becomes
                           
                              (4)
                              
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                 
                                 ≃
                                 
                                    
                                       σ
                                       
                                          
                                             s
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 +
                                 β
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                              
                           
                        where 
                           
                              β
                           
                         represents the amount of specular component at that pixel. The value of 
                           
                              β
                           
                         for a pixel will depend upon the lighting direction, the surface normal, and the viewing geometry [28]. Here, the specular component 
                           
                              β
                              
                                 
                                    e
                                 
                                 
                                    k
                                 
                              
                           
                         is simply assumed to be the same colour as the light itself, in a Neutral Interface Model [30] for dielectrics. For purposes of discovering properties of this equation, let us assume for the time being that 
                           
                              β
                           
                         is simply a constant – in actuality it will be a scalar property of each pixel and this issue is further discussed below in Section 3.4. Let us lump values 
                           
                              σ
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                              /
                              
                                 
                                    q
                                 
                                 
                                    k
                                 
                              
                           
                         into a single quantity and for convenience call this simply 
                           
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                           
                        . Now we have
                           
                              (5)
                              
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 β
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                              
                           
                        
                     

The chromaticity [31] 
                        
                           
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                              
                           
                         is colour without magnitude in an 
                           
                              
                                 
                                    L
                                 
                                 
                                    1
                                 
                              
                           
                         norm, as mentioned above: 
                           
                              ρ
                              =
                              {
                              R
                              ,
                              G
                              ,
                              B
                              }
                              /
                              (
                              R
                              +
                              G
                              +
                              B
                              )
                           
                        , so here we have
                           
                              (6)
                              
                                 
                                    
                                       ρ
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       β
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             j
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       β
                                       
                                          
                                             e
                                          
                                          
                                             j
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        
                     

Let the chromaticity of the light itself be denoted
                           
                              (7)
                              
                                 
                                    
                                       ρ
                                    
                                    
                                       k
                                    
                                    
                                       e
                                    
                                 
                                 =
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                
                                                   3
                                                
                                             
                                          
                                          
                                             
                                                e
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Now here we wish to examine the properties of the Relative Chromaticity, which we define to be the chromaticity 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                              
                           
                         divided by the chromaticity of the light 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                                 
                                    e
                                 
                              
                           
                        . Let us call this quotient chromaticity 
                           
                              
                                 
                                    χ
                                 
                                 
                                    k
                                 
                              
                           
                        , so that
                           
                              (8)
                              
                                 
                                    
                                       χ
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ρ
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       
                                          
                                             ρ
                                          
                                          
                                             k
                                          
                                          
                                             e
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       β
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             j
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       +
                                       β
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             3
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 ·
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             3
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             j
                                          
                                       
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              
                           
                        where all divisions are taken to be component-wise.

For convenience, let 
                           
                              E
                              ≡
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    3
                                 
                              
                              
                                 
                                    e
                                 
                                 
                                    j
                                 
                              
                              =
                              ‖
                              e
                              
                                 
                                    ‖
                                 
                                 
                                    1
                                 
                              
                           
                         where 
                           
                              ‖
                              ·
                              
                                 
                                    ‖
                                 
                                 
                                    1
                                 
                              
                           
                         is the 
                           
                              
                                 
                                    L
                                 
                                 
                                    1
                                 
                              
                           
                         norm. Then we arrive at
                           
                              (9)
                              
                                 
                                    
                                       χ
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       β
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      
                                                         
                                                            e
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             E
                                          
                                       
                                       +
                                       β
                                    
                                 
                              
                           
                        So, for a pixel with no matte component 
                           
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                           
                         but only a purely specular component, 
                           
                              β
                           
                         dominates and we would have 
                           
                              
                                 
                                    χ
                                 
                                 
                                    k
                                 
                              
                              ≡
                              1
                           
                         for all 3-vector elements 
                           
                              k
                              =
                              1
                              …
                              3
                           
                        .

Next we show that in fact log values are preferable, in that a simple Planarity Constraint falls out of the formulation once we move to the log domain.

Let us define a new quantity, 
                           
                              ψ
                           
                        , which is the logarithm of the ratio 
                           
                              χ
                           
                         defined above: we call this the Log-Relative-Chromaticity:
                           
                              (10)
                              
                                 
                                    
                                       ψ
                                    
                                    
                                       k
                                    
                                 
                                 
                                 =
                                 
                                 log
                                 (
                                 
                                    
                                       χ
                                    
                                    
                                       k
                                    
                                 
                                 )
                                 
                                 =
                                 
                                 log
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      e
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Now near a specular point 
                           
                              β
                           
                         increases, and we can take the limit as 
                           
                              (
                              1
                              /
                              β
                              )
                              →
                              0
                           
                        . Let 
                           
                              α
                              =
                              1
                              /
                              β
                           
                        . Then in the limit as specularity increases, 
                           
                              ψ
                           
                         goes to
                           
                              (11)
                              
                                 
                                    
                                       
                                          lim
                                       
                                       
                                          α
                                          →
                                          0
                                       
                                    
                                 
                                 
                                 
                                    
                                       ψ
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       
                                          lim
                                       
                                       
                                          α
                                          →
                                          0
                                       
                                    
                                 
                                 log
                                 
                                    
                                       
                                          (
                                          α
                                          
                                             
                                                s
                                             
                                             
                                                k
                                             
                                          
                                          +
                                          1
                                          )
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            α
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              ∑
                                                                           
                                                                           
                                                                              j
                                                                           
                                                                        
                                                                     
                                                                     (
                                                                     
                                                                        
                                                                           s
                                                                        
                                                                        
                                                                           j
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           e
                                                                        
                                                                        
                                                                           j
                                                                        
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                            E
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        In order to use a Taylor series for this limit, we must first find the partial derivative of 
                           
                              
                                 
                                    ψ
                                 
                                 
                                    k
                                 
                              
                           
                         with respect to 
                           
                              α
                           
                        . Some algebra produces the following derivative:
                           
                              (12)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             ψ
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       ∂
                                       α
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             Es
                                          
                                          
                                             k
                                          
                                       
                                       -
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                          
                                       
                                       
                                          
                                             s
                                          
                                          
                                             j
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             j
                                          
                                       
                                    
                                    
                                       (
                                       α
                                       
                                          
                                             s
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       1
                                       )
                                       
                                          
                                             
                                                α
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      m
                                                   
                                                
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      m
                                                   
                                                
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      m
                                                   
                                                
                                                +
                                                E
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Then to second order in 
                           
                              α
                           
                         we have the Maclaurin series
                           
                              (13)
                              
                                 
                                    
                                       
                                          lim
                                       
                                       
                                          α
                                          →
                                          0
                                       
                                    
                                 
                                 
                                 
                                    
                                       ψ
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 α
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               
                                                                  ψ
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                         
                                                         
                                                            ∂
                                                            α
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                α
                                                =
                                                0
                                             
                                          
                                       
                                    
                                 
                                 +
                                 O
                                 
                                    
                                       
                                          
                                             
                                                α
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Thus in the limit 
                           
                              
                                 
                                    ψ
                                 
                                 
                                    k
                                 
                              
                           
                         goes to
                           
                              (14)
                              
                                 
                                    
                                       ψ
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 α
                                 
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                k
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                   
                                                
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      j
                                                   
                                                
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                E
                                             
                                          
                                       
                                    
                                 
                                 +
                                 O
                                 
                                    
                                       
                                          
                                             
                                                α
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              α
                              >
                              0
                           
                        .

Omitting 
                           
                              O
                              (
                              
                                 
                                    α
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         (small by assumption in the limit), we note by inspection that the quantity 
                           
                              
                                 
                                    ψ
                                 
                                 
                                    k
                                 
                              
                           
                         is orthogonal to the illuminant vector:
                           
                              (15)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       ψ
                                    
                                    
                                       k
                                    
                                 
                                 
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 0
                                 ,
                                 
                                 so
                                 
                                 also
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       ψ
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       ρ
                                    
                                    
                                       k
                                    
                                    
                                       e
                                    
                                 
                                 =
                                 0
                              
                           
                        
                     

Therefore we have a planar constraint on image pixels that are near-specular.


                        Planar constraint: 
                        For near-specular pixels, Log-Relative-Chromaticity values are orthogonal to the light chromaticity.
                     

Note that in Eq. (14) above we have expressed this orthogonality in a different way than the usual, Euclidean-norm based calculation of the part of the vector 
                           s
                         that is orthogonal to vector 
                           e
                        , viz. 
                        
                           
                              (
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                              -
                              s
                              ·
                              
                                 
                                    e
                                 
                                 
                                    ˆ
                                 
                              
                              
                                 
                                    
                                       
                                          e
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                              )
                           
                         for normalized light vector 
                           
                              
                                 
                                    e
                                 
                                 
                                    ˆ
                                 
                              
                           
                        .

Nevertheless, it is easy to verify that Eq. (15) does indeed hold. The meaning of Eq. (14) is that we are forming an 
                           
                              
                                 
                                    L
                                 
                                 
                                    1
                                 
                              
                           
                        -based projection onto the plane orthogonal to the light.

Here we define the Zeta-image 
                        
                           
                              ζ
                           
                         as the dot-product of the Log-Relative-Chromaticity 
                           ψ
                        , Eq. (16), with a putative light direction:
                           
                              (16)
                              
                                 ζ
                                 =
                                 -
                                 ψ
                                 ·
                                 
                                    
                                       ρ
                                    
                                    
                                       e
                                    
                                 
                                 =
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          3
                                       
                                    
                                 
                                 log
                                 (
                                 
                                    
                                       ρ
                                    
                                    
                                       k
                                    
                                 
                                 /
                                 
                                    
                                       ρ
                                    
                                    
                                       k
                                    
                                    
                                       e
                                    
                                 
                                 )
                                 
                                 
                                    
                                       ρ
                                    
                                    
                                       k
                                    
                                    
                                       e
                                    
                                 
                              
                           
                        
                     

The Zeta-image 
                           
                              ζ
                           
                         is a scalar image. Note that the Log-Relative-Chromaticity 
                           
                              ψ
                           
                        , defined in Eq. (10), and appearing above in Eq. (16), is dependent on the choice of light 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                        , i.e., 
                           
                              ψ
                              =
                              ψ
                              (
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                              )
                           
                        .

Based on the planar constraint, the Zeta-image value is zero for near-specular pixels; and as well we will show that it is a non-negative value (with the sign included as above). Neutral (i.e., illuminant-coloured) pixels have 
                           
                              ζ
                              =
                              0
                           
                        , so also help Eq. (15) find the correct 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                        . The Zeta-image was introduced in [8] and here is investigated more thoroughly. In the following sections we will see the application of the Zeta-image for illumination estimation and as well, in a related but very different usage, for specularity manipulation in the sense of increasing or attenuating the specular content of images.

Having enunciated a plane constraint governing Relative Chromaticity formed by dividing by the actual light chromaticity, we also investigate the effect of dividing by an incorrect light, one that was not in fact involved in forming the image at hand.

Suppose the correct illumination chromaticity vector is 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                         but instead we have supposed that it is 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    
                                       
                                          e
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                        . Then in carrying out our division by the putative illuminant chromaticity, we have instead
                           
                              (17)
                              
                                 
                                    
                                       χ
                                    
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       ρ
                                    
                                    
                                       k
                                    
                                 
                                 /
                                 
                                    
                                       ρ
                                    
                                    
                                       k
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                k
                                             
                                          
                                          
                                             
                                                e
                                             
                                             
                                                k
                                             
                                          
                                          +
                                          β
                                          
                                             
                                                e
                                             
                                             
                                                k
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                
                                             
                                          
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                j
                                             
                                          
                                          
                                             
                                                e
                                             
                                             
                                                j
                                             
                                          
                                          +
                                          β
                                          
                                             
                                                e
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                 
                                 ·
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             j
                                          
                                          
                                             ′
                                          
                                       
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       α
                                       
                                          
                                             s
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       1
                                    
                                    
                                       α
                                       
                                          
                                             s
                                             
                                             ·
                                             e
                                          
                                          
                                             E
                                          
                                       
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      E
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                             
                                                E
                                             
                                          
                                       
                                    
                                 
                              
                           
                        so that
                           
                              (18)
                              
                                 
                                    
                                       
                                          lim
                                       
                                       
                                          α
                                          →
                                          0
                                       
                                    
                                 
                                 
                                 
                                    
                                       ψ
                                    
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 log
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      E
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                             
                                                E
                                             
                                          
                                       
                                    
                                 
                                 +
                                 α
                                 
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                k
                                             
                                          
                                          -
                                          
                                             
                                                s
                                                
                                                ·
                                                e
                                             
                                             
                                                E
                                             
                                          
                                       
                                    
                                 
                                 +
                                 O
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       ψ
                                    
                                    
                                       k
                                    
                                    
                                       0
                                    
                                 
                                 +
                                 log
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      e
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      
                                                         
                                                            e
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    ψ
                                 
                                 
                                    k
                                 
                                 
                                    0
                                 
                              
                           
                         is the set of planar values found for the correct light, in Eq. (14).

For this new version of 
                           
                              ψ
                           
                        , now for the set of image chromaticities relative to the putative light chromaticity, with the log taken, the gamut of values is shifted by the last term on the right hand side of the second line of Eq. (18).

Comparing Eqs. (15) and (18), we see that the idea of dividing by the illuminant chromaticity produces a gamut for specular pixels, for the case of an incorrect choice of light chromaticity, which is shifted with respect to the original gamut. This property is potentially of value for determining the actual value of the light chromaticity in a scene.

The fact that specular scalar factor 
                           
                              β
                           
                         is not a constant makes no difference to the argument: for near-specular pixels any value of 
                           
                              β
                           
                         still leads to quantity 
                           
                              
                                 
                                    ψ
                                 
                                 
                                    k
                                 
                              
                           
                         lying in the plane orthogonal to the illuminant, and that plane being shifted as in Eq. (18) for the incorrect choice of illuminant.

Using synthetic data as a guide, we can investigate the planar constraint.

Suppose 
                           
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                           
                         is uniform-randomly distributed. Then 
                           
                              s
                              
                           
                         uniformly occupies the unit cube in RGB colour space. Let us form 
                           
                              ψ
                           
                         values that are consistent with the near-to-specular model Eq. (14): these values are on a plane orthogonal to the light 3-vector 
                           
                              
                                 
                                    e
                                 
                                 
                                    k
                                 
                              
                           
                         that was utilized to form the gamut.


                        Fig. 1
                         shows the gamut for 
                           
                              ψ
                           
                         in blue, when we divide by the correct illuminant chromaticity, and the shifted gamut 
                           
                              
                                 
                                    ψ
                                 
                                 
                                    ′
                                 
                              
                           
                         in red when we have divided by an incorrect chromaticity. The blue plane goes through the origin – the 
                           ψ
                         vector for the light itself is 0 – and 
                           ψ
                         vectors that are on the blue plane are orthogonal to the lighting direction 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                        , shown as a green arrow.

However, for the shifted plane, shown in red, the center of the plane is not at the origin, so 
                           
                              
                                 
                                    ψ
                                 
                                 
                                    ′
                                 
                              
                           
                         vectors on that plane, such as the cyan arrow shown on the red plane, are actually 3-vectors in the 
                           
                              ψ
                           
                         space (shown in black) that are not orthogonal to the green lighting vector. That is, the calculation (16) proceeds using vector components which are defined relative to the fixed origin position 0
                         not some point such as the middle of the red plane.

A complete synthetic example consists of accurately modeled matte plus specular components. Here, let us consider a test image Fig. 2
                         consisting of three shaded spheres with surface colours equal to patches 1, 4, and 9 of the Macbeth ColorChecker [42] (dark skin, moderate olive green, moderate red), and under standard illuminant D65 (standard daylight with correlated colour temperature 6504K [31]). If we adopt a Lambertian model then the matte image is as in Fig. 2(a). Here we produce a synthetic image using the sensor curves for a Kodak DCS420 digital colour camera. We now add a specular reflectance lobe for each surface reflectance function. For illustration, using a simple Phong specular model [43], with roughness 0.05 and multiplicative factor 1.0, the matte image goes over to one with highlights as in Fig. 2(b). These surfaces are particular instances of dichromatic surface spectral reflectances [28].

Now suppose we have correctly guessed the lighting chromaticity; then let us go on to form the Log-Relative-Chromaticity 
                           ψ
                        . Forming the dot-product (16) we arrive at values as depicted in Fig. 2(c). The 
                           ψ
                         values for low dot product values are found to indeed lie nearly on a plane, and the idea of asking that the dot-product (16) be small is indeed justified for this synthetic data. Moreover, the perpendicular to the plane found is very close to the actual light used to form the image.

To show the discriminative power of the planar constraint, let us now suppose we have guessed an incorrect light chromaticity. For the light used in this synthetic image, the correct light chromaticity is 
                           
                              [
                              0.279
                              ,
                              0.317
                              ,
                              0.405
                              ]
                           
                        . Now instead divide by the chromaticity of an incorrect light: here we divide by a light chromaticity 
                           
                              [
                              0.172
                              ,
                              0.363
                              ,
                              0.464
                              ]
                           
                        , a very different illuminant. Then the dot-product appears as in Fig. 2(d), a much less discriminative identification of specular pixels than when we in fact used the correct light. Moreover, the perpendicular to the best-fit plane is much poorer an estimate of the correct light chromaticity. That is, suppose we identify as candidate specular pixels those whose absolute value of dot-product Eq. (16) with the candidate light chromaticity falls in the lowest 5-percentile, say, i.e., nearest to zero. Forming a Singular Value Decomposition of 
                           ψ
                         values for those pixels determines the best-fit plane; the third eigenvector is associated with the normal to that plane, and within the model presented here that normal should be close to the illuminant chromaticity in direction.


                        Fig. 2(e) shows a mask for pixels in the lowest 5-percentile of Zeta values (16); for these pixels, SVD values for 
                           
                              ψ
                           
                         3-vectors are 1.0, 0.85, 0.014, showing that they do indeed lie close to a plane. (Note that the image Fig. 2 is constructed more accurately not using the approximate recipe Eq. (3) but instead is constructed using sums of spectral reflectance times illuminant spectral power distribution times camera sensors.) If, instead, we divide by the wrong illuminant chromaticity, we get a low-Zeta mask as shown in Fig. 2(f), which misses an entire sphere. Moreover, the 
                           
                              ψ
                           
                         values there are much further from occupying a plane: the singular values are 1.0, 0.14, 0.006.

Here we begin construction of an algorithm by considering first a simple search method as motivation, and then stating an analytic solution.

The planar constraint suggests that the dot product for near-light-colour (e.g., specular) pixels is minimized for the correct illuminant. This points to a useful descriptor for finding the specular point.

Suppose we were to assume that for any candidate illuminant the lowest 10-percentile, say, of dot-product values (16) could be near-specular pixels. Now, to find the correct illuminant, we need to minimize dot-product values (16) over candidate illuminants for those lowest 10-percentile pixels. Thus an optimization can be stated as follows.

We already defined the Zeta-image 
                           
                              ζ
                           
                         as the dot-product of the Log-Relative-Chromaticity, 
                           ψ
                        , with a putative light direction in Eq. (16). The actual value of 
                           
                              ζ
                           
                         will in turn depend on which illuminant chromaticity we divided by. Therefore we minimize over the sum 
                           
                              I
                           
                         of 
                           
                              ζ
                           
                         values 
                           
                              |
                              ζ
                              |
                           
                         for pixels (for the current illuminant chromaticity) that lie in the bottom 10-percentile of dot-product values:
                           
                              (19)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      min
                                                   
                                                   
                                                      
                                                         
                                                            ρ
                                                         
                                                         
                                                            e
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             I
                                             =
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      ψ
                                                      ∈
                                                      
                                                         
                                                            Ψ
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                
                                             
                                             |
                                             ζ
                                             |
                                          
                                       
                                    
                                    
                                       
                                          
                                             subject
                                             
                                             to
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                      =
                                                      1
                                                   
                                                   
                                                      3
                                                   
                                                
                                             
                                             
                                                
                                                   ρ
                                                
                                                
                                                   k
                                                
                                                
                                                   e
                                                
                                             
                                             =
                                             1
                                             ,
                                             
                                             0
                                             <
                                             
                                                
                                                   ρ
                                                
                                                
                                                   k
                                                
                                                
                                                   e
                                                
                                             
                                             <
                                             1
                                             ,
                                             
                                             k
                                             =
                                             1
                                             …
                                             3
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    Ψ
                                 
                                 
                                    0
                                 
                              
                           
                         is the set of pixel dot-product values (16) with the candidate illuminant chromaticity 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                         that are in the lowest 10-percentile.

The meaning of Eq. (19) is that we carry out a search, over possible illuminant chromaticities 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                        . This can be phrased as either an optimization-based approach or, as implemented here, a simple hierarchical grid search. Then we adopt a heuristic that says that the lowest 10-percentile of values of dot-products with the candidate illuminant could be specular or in general illuminant-coloured. For these pixels we calculate the sum of absolute values of dot-products and take as the best candidate light that which delivers the minimum sum.


                        Fig. 3
                        (a) shows an input image, and Fig. 3(b) shows a boolean map of the lowest 10-percentile of dot-product values (16) with the correct illuminant chromaticity of that image. In contrast, if we show the lowest 10-percentile of dot products with the chromaticity of an incorrect light, where 
                           ψ
                         values are constructed using that incorrect light, the boolean map identifying putative specular/illuminant-coloured pixels is as displayed in Fig. 3(c). We see that using the correct light produces a much more plausible map of possible pixels that will help identify the light.

For Fig. 3(a), the 
                           
                              ψ
                           
                         values of near-specular pixels based on the optimization Eq. (19) do indeed form a plane orthogonal to the light vector, as can be easily verified numerically. In Fig. 4
                         we display a mesh plot of the objective function 
                           
                              I
                           
                         of Eq. (19) for Fig. 3(a). It can be seen that the function has only one minimum.

The float-valued Zeta-image is displayed in Fig. 3(d). We show next that we can directly use the Zeta-image to analytically find the correct illuminant chromaticity.

Having motivated the method, we now state an analytic solution that in fact produces excellent results and is very simple and fast. Suppose we identify a possible set 
                           
                              
                                 
                                    Ψ
                                 
                                 
                                    0
                                 
                              
                           
                         of specular pixels by any convenient method – e.g., we could simply take the top 5% or 10% of brightness.

Let the number of such bright pixels be N. Then our analytic solution is as follows:
                           Theorem 1
                           
                              Up to an 
                              
                                 
                                    
                                       
                                          L
                                       
                                       
                                          1
                                       
                                    
                                 
                               
                              normalization, 
                              
                                 the light colour is given by the geometric mean
                              
                              
                                 
                                    (20)
                                    
                                       
                                          
                                             ρ
                                          
                                          
                                             k
                                          
                                          
                                             e
                                          
                                       
                                       =
                                       g
                                       (
                                       
                                          
                                             ρ
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       ≡
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∏
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            N
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         ρ
                                                      
                                                      
                                                         k
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             1
                                             /
                                             N
                                          
                                       
                                       ,
                                       
                                       k
                                       =
                                       1
                                       …
                                       3
                                    
                                 
                              
                              To prove this, let us first solve an auxiliary optimization replacing 
                              
                                 (19)
                              
                              . We show below that 
                              
                                 
                                    ζ
                                 
                               
                              from Eq. 
                              
                                 (16)
                               
                              must be non-negative, so [with no absolute-value bars as in 
                              
                                 
                                    I
                                 
                               
                              in Eq. 
                              
                                 (19)
                              
                              ] we first solve an analytic minimization
                              
                                 
                                    (21)
                                    
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      e
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                N
                                             
                                          
                                       
                                       
                                          
                                             ζ
                                          
                                          
                                             i
                                          
                                       
                                       +
                                       λ
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         k
                                                         =
                                                         1
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      e
                                                   
                                                
                                                -
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                              where 
                              
                                 
                                    i
                                    =
                                    1
                                    .
                                    .
                                    N
                                 
                               
                              ranges over the N pixels in 
                              
                                 
                                    ψ
                                    ∈
                                    
                                       
                                          Ψ
                                       
                                       
                                          0
                                       
                                    
                                 
                              
                              , and 
                              
                                 
                                    λ
                                 
                               
                              is a Lagrange multiplier enforcing that 
                              
                                 
                                    
                                       
                                          ρ
                                       
                                       
                                          e
                                       
                                    
                                 
                               
                              is a chromaticity. Taking partial derivatives with respect to 
                              
                                 
                                    
                                       
                                          ρ
                                       
                                       
                                          k
                                       
                                       
                                          e
                                       
                                    
                                 
                               
                              we have the normal equations
                              
                                 
                                    (22)
                                    
                                       -
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         log
                                                         (
                                                         
                                                            
                                                               ρ
                                                            
                                                            
                                                               k
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         -
                                                         log
                                                         
                                                            
                                                               ρ
                                                            
                                                            
                                                               k
                                                            
                                                            
                                                               e
                                                            
                                                         
                                                      
                                                   
                                                
                                                -
                                                1
                                             
                                          
                                       
                                       +
                                       λ
                                       =
                                       0
                                    
                                 
                              
                              
                                 
                                    (23)
                                    
                                       with
                                       
                                       solution
                                       
                                       
                                          
                                             ρ
                                          
                                          
                                             k
                                          
                                          
                                             e
                                          
                                       
                                       
                                       =
                                       
                                       g
                                       (
                                       
                                          
                                             ρ
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       ·
                                       exp
                                       (
                                       -
                                       (
                                       N
                                       +
                                       λ
                                       )
                                       /
                                       N
                                       )
                                    
                                 
                              
                              (Also, taking the derivative of 
                              
                                 (21)
                               
                              with respect to 
                              
                                 
                                    λ
                                 
                               
                              enforces 
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          3
                                       
                                    
                                    
                                       
                                          ρ
                                       
                                       
                                          k
                                       
                                       
                                          e
                                       
                                    
                                    =
                                    1
                                 
                              
                              , so that scaling the solution 
                              
                                 (23)
                               
                              to obey 
                              
                                 
                                    
                                       
                                          L
                                       
                                       
                                          1
                                       
                                    
                                 
                              
                              -norm
                              
                              =
                              
                              1 solves for 
                              
                                 
                                    λ
                                 
                               
                              as well if we like, but this is not used here.)
                           

The meaning of (21) then is: The planarity constraint yields the geometric mean of the chromaticities as the solution for the light, up to trivial scaling of the 
                           
                              
                                 
                                    L
                                 
                                 
                                    1
                                 
                              
                           
                        -norm.

However so far we have omitted absolute value bars, with a full optimization minimizing 
                           
                              I
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                 
                              
                              |
                              
                                 
                                    ζ
                                 
                                 
                                    i
                                 
                              
                              |
                           
                        . We now observe that the form (16) formally has the structure of the Kullback–Leibler Divergence from information theory, in that chromaticities for image, 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                                 
                                    i
                                 
                              
                           
                        , and light, 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                                 
                                    e
                                 
                              
                           
                         all add to unity: 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                    =
                                    1
                                 
                                 
                                    3
                                 
                              
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                              
                              =
                              1
                           
                        . We are minimizing 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    N
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             =
                                             1
                                          
                                          
                                             3
                                          
                                       
                                       -
                                       
                                          
                                             ρ
                                          
                                          
                                             k
                                          
                                          
                                             e
                                          
                                       
                                       log
                                       
                                          
                                             
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      i
                                                   
                                                
                                                /
                                                
                                                   
                                                      ρ
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      e
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        , which has the K–L structure except that instead of summing over probabilities for symbols we are here summing over colour-channels. Thus each dot product (the sum over k at each pixel) is necessarily non-negative since it represents the extra bits required to code samples from 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                                 
                                    e
                                 
                              
                           
                         when using a code based on 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                                 
                                    i
                                 
                              
                           
                         (where the units are bits if base-2 logarithms are used). Hence we can simply consider the minimization (21), with solution (20) up to scaling. As a final step, we calculate a final value for 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                                 
                                    e
                                 
                              
                           
                         by trimming pixels to the least-10% values of the Zeta-image 
                           
                              ζ
                           
                         and recalculating the geometric mean (20).

Thus we propose an iterative-analytic solution algorithm by analytically finding the illuminant (20) using an initial specular candidate set and calculating the Zeta image using the geometric-mean estimated illuminant; and then recalculating the illuminant using the geometric mean of pixels with the least-10% values of Zeta. The top-brightness pixels have already been shown to play a significant role in many illumination estimation methods [44,45]; as well, specular pixels tend to be bright and therefore we select the initial specular candidate set via the top-
                           
                              T
                              %
                           
                         brightness pixels for different T values, and iterate the above steps twice. The final estimate is that from the threshold value which provides the minimum average value of 
                           
                              ζ
                           
                        . The detailed algorithm is set out in Algorithm 1.
                           Algorithm 1
                           Zeta analytic solution for illumination estimation
                                 
                                    
                                       
                                       
                                          
                                             1: for all threshold T in 
                                                   
                                                      {
                                                      5
                                                      %
                                                      ,
                                                      3
                                                      %
                                                      ,
                                                      2
                                                      %
                                                      ,
                                                      1
                                                      %
                                                      ,
                                                      .
                                                      5
                                                      %
                                                      }
                                                   
                                                 
                                                do
                                             
                                          
                                          
                                             2: Find top brightness pixels by thresholding 
                                                   
                                                      R
                                                      +
                                                      G
                                                      +
                                                      B
                                                   
                                                 values as the candidate specular set
                                          
                                          
                                             3: Initially estimate the specular point 
                                                   
                                                      
                                                         
                                                            ρ
                                                         
                                                         
                                                            e
                                                         
                                                      
                                                   
                                                 by geometric mean of pixels in specular candidate set
                                          
                                          
                                             4: Calculate 
                                                   
                                                      ζ
                                                   
                                                 for this 
                                                   
                                                      
                                                         
                                                            ρ
                                                         
                                                         
                                                            e
                                                         
                                                      
                                                   
                                                 using Eq. (16)
                                             
                                          
                                          
                                             5: Recalculate 
                                                   
                                                      
                                                         
                                                            ρ
                                                         
                                                         
                                                            e
                                                         
                                                      
                                                   
                                                 by geometric mean of pixels in 10%-lowest 
                                                   
                                                      ζ
                                                   
                                                
                                             
                                          
                                          
                                             6: Iterate to step 4 twice
                                          
                                          
                                             7: end for
                                             
                                          
                                          
                                             8: Choose the estimate given by the threshold that minimizes the average 
                                                   
                                                      ζ
                                                   
                                                 for the final set of candidate specular pixels
                                          
                                       
                                    
                                 
                              
                           

Since areas of images that are specular tend to be bright, according to our theory the geometric mean of pixels in these bright (generally, specular) regions is the optimal estimate for the illuminant. Our insight is in contradistinction to the work of Choudhury and Medioni [46] and Funt and Shi [47] which proposed finding the max after a local mean calculation (e.g.after local blurring). In the presence of specular highlights illuminant estimation is here seen to be the mean of the max and not the converse. Indeed, using the correct ordering is crucial (a fact borne out by our experiments reported below).

Suppose we have an estimate 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                    ★
                                 
                              
                           
                         of the correct illuminant: this could come from any desired colour constancy algorithm. If our estimate is indeed near the correct illuminant we can then identify as near-specular pixels those whose absolute value of dot-product Eq. (16) with the candidate light chromaticity is nearest to zero. Forming a Singular Value Decomposition of 
                           ψ
                         values for those pixels determines the best-fit plane, with the third eigenvector associated with the normal to that plane. Within the model presented here that normal should be close to the illuminant chromaticity in direction. Because of the additional evidence brought to bear by Eq. (16) we expect the estimate to improve. If instead the illuminant estimate is wrong, then we have found in experiments that the above SVD step will almost always not change it much and no harm is done by carrying out this post-processing step.

We carry out
                           
                              (24)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   ψ
                                                
                                                
                                                   k
                                                
                                             
                                             =
                                             log
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ρ
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ρ
                                                               
                                                               
                                                                  k
                                                               
                                                               
                                                                  
                                                                     
                                                                        e
                                                                     
                                                                     
                                                                        ∗
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                             k
                                             =
                                             1
                                             …
                                             3
                                             ;
                                             
                                             Ψ
                                             =
                                             
                                                
                                                   ψ
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   ρ
                                                
                                                
                                                   e
                                                   ★
                                                
                                             
                                             ;
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ψ
                                             (
                                             
                                                
                                                   Ψ
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                             ≡
                                             SVD
                                             (
                                             ψ
                                             (
                                             
                                                
                                                   Ψ
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                             )
                                             =
                                             U
                                             
                                             diag
                                             (
                                             d
                                             )
                                             
                                             
                                                
                                                   V
                                                
                                                
                                                   T
                                                
                                             
                                             ;
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   ρ
                                                
                                                
                                                   e
                                                
                                             
                                             =
                                             V
                                             
                                                
                                                   
                                                
                                                
                                                   3
                                                
                                             
                                             /
                                             |
                                             V
                                             
                                                
                                                   
                                                
                                                
                                                   3
                                                
                                             
                                             |
                                             ;
                                             
                                             success
                                             =
                                             (
                                             
                                                
                                                   d
                                                
                                                
                                                   3
                                                
                                             
                                             
                                             small
                                             )
                                             
                                             &
                                             
                                             (
                                             
                                                
                                                   ρ
                                                
                                                
                                                   e
                                                
                                             
                                             ≃
                                             
                                                
                                                   ρ
                                                
                                                
                                                   e
                                                   ★
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                    ★
                                 
                              
                           
                         is the estimate of the illumination provided by a colour constancy method, 
                           
                              
                                 
                                    Ψ
                                 
                                 
                                    0
                                 
                              
                           
                         is the lowest 10-percentile of 
                           
                              Ψ
                           
                        , and 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                         is the estimate of the illumination based on the planar constraint.

The meaning of Eq. (24) is that, for any estimate 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                    ★
                                 
                              
                           
                         of the light chromaticity 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                        , if the model (15) is obeyed around the light point then SVD should produce an estimate of the light that agrees with 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                    ★
                                 
                              
                           
                        .

We demonstrate below that this planar constraint does indeed improve the estimate of 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                           
                        , verifying the suitability of the plane constraint applied as a post-processing step, for any candidate colour constancy algorithm. In the next section we will demonstrate the substantial improvement delivered by this simple planar constraint when added to each of several well-known colour constancy algorithms as a post-processing step.

We apply our proposed method to three standard real-image datasets [48,15,49] and compare our results to other colour constancy algorithms.

Our first experiment uses the Barnard dataset [48], denoted the SFU Laboratory dataset, which contains 321 measured images under 11 different measured illuminants. The scenes are divided into two sets as follows: minimal specularities (22 scenes, 223 images – i.e., 19 missing images); and non-negligible dielectric specularities (9 scenes, 98 images – 1 illuminant is missing for 1 scene).

For a more real-world (out of the laboratory) image experiment we use the Gehler colour constancy dataset [15], denoted the ColorChecker dataset. This dataset consists of 568 images, both indoor and outdoor. The illuminant ground truth for these images is known because each image has a Macbeth ColorChecker placed in the scene, which must be masked off in tests. These images are captured using the automatic setting of the camera, so they contain clipped pixels, are non-linear, have been demosaiced, and include the effect of the camera’s white balancing. Therefore, Shi and Funt [50] introduced a re-processed version of the ColorChecker dataset, with an estimate of the raw image data in an attempt to recover linear values.

Also, Ciurea and Funt [49] introduced the GreyBall dataset, which contains 11,346 lower-quality real-world images (with image resolution 
                           
                              360
                              ×
                              240
                           
                        ) extracted from video recorded under a wide variety of imaging conditions. The images are divided into 15 different clips taken at different locations. The ground truth was acquired by attaching a grey sphere to the camera, displayed in the corner of the image. This grey sphere must be masked during experiments. The ground truth of the GreyBall dataset is obtained using the original images (using the NTSC-RGB colour model). Therefore, the ground truth was recomputed by [3] by converting the images from NTSC-RGB to linear RGB, assuming a gamma of 2.2. This modified dataset is denoted the GreyBall dataset.

To compare, we use the standard well-known colour constancy methods: White-Patch, Grey-World, and Grey-Edge implemented by [6]. For Grey-Edge we use optimal settings, which differ per dataset [51] (
                           
                              p
                              =
                              7
                           
                        , 
                           
                              σ
                              =
                              4
                           
                         for the SFU Laboratory dataset and 
                           
                              p
                              =
                              1
                              ,
                              σ
                              =
                              6
                           
                         for the ColorChecker dataset). We also use the result provided by Gijsenij and et al. [13] for pixel-based gamut mapping, using the best general gamut mapping setting, which is for 1st-jet as reported in [13]. We also compare with the Exemplar-based method [25], which provides the state of the art for this problem. For other methods we use results as provided by Gijsenij [3,51].

For methods which need training data, such as the gamut mapping methods, in the SFU Laboratory dataset 31 images (all images recorded under the syl-50MR16Q-illuminant) were used for computation of the canonical gamut, and subsequently these were omitted from the test set. For the ColorChecker dataset, threefold cross-validation was used to learn the canonical gamut (with the folds as well as the ground truth supplied with the original dataset). Testing for supervised methods is as described in [3], Section 7.1.


                        Table 1
                         shows the accuracy of the plane constraint Eq. (24) in Section 5.3 as a post-processing step applied to the results of each of the well-known colour constancy algorithms (White-Patch, Grey-World and Grey-Edge), in order to improve the estimate. The errors are in terms of the median of angular errors for 3-D illuminant chromaticity.

As expected, applying the plane constraint can evidently improve the estimate of illuminants while being very fast and easy to implement. Experimental results in Table 1 indicate that estimate errors can be reduced by some 15–30% by this simple mechanism.


                        Tables 2–4
                        
                        
                         indicates the accuracy of the proposed methods for the SFU Laboratory dataset [48], the ColorChecker dataset [50] and the GreyBall dataset [49], in terms of the mean and median of angular errors, for several colour constancy algorithms applied to these datasets. For those methods which need data-dependent tunable parameters, we utilize optimal parameters for their dataset. For an overview of results of different algorithms on these datasets refer to [3,51]. In these Tables, the top part shows unsupervised methods; the bottom part shows supervised methods.

For the SFU Laboratory dataset the Planar Constraint Search Eq. (19) does best in terms of median angular error compared to the other reported colour constancy methods, even those needing training data. We do note that for this dataset the Planar Constraint Search Eq. (19) is not the best for the ColorChecker dataset, with learning-based methods, Gamut Mapping and Exemplar Based methods performing better. However, both Planar Search and the Analytic method of Section 5.2 (“Analytic Geomean”) do as well or better than the other relatively fast methods for the GreyBall dataset, and are only bested by the much more complex method [19].

Run-times average 5.2s for Planar-Constraint Search and 415ms for the Analytic method, on a dual core 2.53GHz PC running 64-bit Windows 7 with 8GB of memory; and using code provided by the corresponding authors, this compares to 617ms for the GreyEdge algorithm and 63.2s for 1st-Jet Gamut Mapping, operating on the SFU Laboratory dataset using (unoptimized) Matlab.


                        Fig. 5
                         shows examples of colour-corrected images from the GreyBall dataset based on the proposed method using the geometric mean (called the Zeta-image method) compared to White-Patch, Grey-World, Grey-Edge and Gamut Mapping methods, with the angular error for each estimate displayed over the grey sphere mounted onto the video camera (which was itself masked off in forming estimates).

The Zeta-image should identify specular pixels. Here we are interested in seeing whether the Zeta-image provides a guide to manipulating specularities. We begin with an illuminant-dependent colour space in order to separate out the effect of specular reflection. Here we use SUV colour space proposed by Mallick et al. [52], defined by two rotations making the first dimension, S, equal to the illuminant colour 3-vector. In [52] the illuminant is assumed to be known, whereas here we shall always recover the illuminant. In examples shown, we utilize the Zeta-image analytic geometric mean procedure in Eq. (20) for this purpose. In SUV colour space, the axes U and V are set as two directions orthogonal to the illuminant, and hence free from the illumination colour (although for clipped pixels this condition is not valid). The S component has a contribution from the lighting, as well as an unknown contribution from any diffuse reflection which is in the illuminant direction in colour space.

Generally, we propose that modifying specularities is reduced to modifying the S channel, which we aim to do by manipulating the Zeta-image. Thus we maintain the 
                        
                           U
                           ,
                           V
                        
                      components unchanged. Since smaller zeta indicates more specular contribution, we can simply deprecate this amount by multiplying the S channel by a monotonic function 
                        
                           f
                           (
                           ζ
                           )
                        
                      of zeta. We could use regression on non-bright pixels to generate f, but we simply use the following equation:
                        
                           (25)
                           
                              
                                 
                                    S
                                 
                                 
                                    modified
                                 
                              
                              =
                              S
                              ·
                              
                                 
                                    (
                                    ζ
                                    /
                                    a
                                    )
                                 
                                 
                                    b
                                 
                              
                           
                        
                     where a normalizes the 
                        
                           ζ
                        
                      value and determines the pixels that are affected by 
                        
                           ζ
                        
                     ; and b, with range 
                        
                           [
                           -
                           1
                           ,
                           1
                           ]
                        
                     , determines the shape of the transfer-function curve. Positive b reduces specularity since it reduces the modified S; and negative b enhances the specularity. In Fig. 6
                      this simple transform generates arguably excellent specular-free images and demonstrates the applicability of the Zeta-image approach.


                     Fig. 6 shows the result of specularity removal compared to Tan and Ikeuchi’s method [33] for specularity removal. As well, we show the U,V channels from [52], transformed back to RGB space. Specularity attenuation is shown here using the values 
                        
                           a
                           =
                           max
                           (
                           ζ
                           )
                        
                      and 
                        
                           b
                           =
                           0.3
                        
                     . Comparison (particularly zoomed-in) with Fig. 6(c) shows the higher quality output of the new specular-diminished image; and moreover this advantage is gained without having to know the illuminant. In column (e) of Fig. 6 we also show the result for specularity enhancement, here using the value 
                        
                           b
                           =
                           -
                           0.3
                        
                     ; of course, a slider can be used for user-control of specularity removal or enhancement if desired.


                     Fig. 7
                      summarizes the procedure for specularity manipulation using the Zeta-image.

We can hone the method further by carefully examining effects on real-world images. Consider the image in Fig. 8
                        (a).
                           1
                           Image© Christopher Grey www.ChristopherGrey.com, used with permission, www.sekonic.com/Portals/0/Articles/Grey_Underexposure_image01.jpg.
                        
                        
                           1
                         First we find the illuminant, using the fast analytic method Eq. (20). Then the Zeta-image is generated using Eq. (16). Fig. 8(b) shows 
                           
                              ζ
                           
                        , displayed by normalizing to the range 
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                         by dividing by 
                           
                              max
                              (
                              ζ
                              )
                           
                         and displaying reversed in intensity.

Now we mean to decrease, or to enhance, the specular content via the simple Eq. (25). Suppose we wish to increase specular content: then we should use a negative value of b, say 
                           
                              b
                              =
                              -
                              0.3
                           
                        . Fig. 8(c) shows the S-channel of the SUV image and Fig. 8(d) shows S as modified by Eq. (25).

The question arises whether the same effect might be achieved by a simple tone curve correction on the S-channel: i.e., is 
                           
                              S
                              ·
                              f
                              (
                              ζ
                              )
                           
                         simply a scalar function of S? Fig. 8(e) shows the specular-enhanced image that results from going back to RGB colour space, as in Algorithm 2 below. To examine the relationship between enhanced S values and the original S, Fig. 8(f) plots S versus the modified value of S: we see that the Zeta effect is indeed not simply a tone-curve correction.


                        Fig. 8(g) shows a specularity-decreased image, resulting from the choice 
                           
                              b
                              =
                              +
                              0.2
                           
                        . Several other examples of using this specularity manipulation technique are shown in Fig. 9
                        .
                           2
                           Images© Imaging Resource: Dave Etchells, Publisher, used with permission, www.imaging-resource.com.
                        
                        
                           2
                         The mutually supportive role of specularities, light sources, and neutral surfaces for finding the illuminant colour is discussed in [45]. However, this means that in using the Zeta-image for specularity manipulation, we cannot disambiguate between white (source-coloured) and specular pixels.

While the image results presented are not exhaustive, of course, they do justify the claim that the Zeta-image carries additional information regarding specular highlights.
                           Algorithm 2
                           Specularity manipulation
                                 
                                    
                                       
                                       
                                          
                                             1: Find 
                                                   
                                                      
                                                         
                                                            ρ
                                                         
                                                         
                                                            e
                                                         
                                                      
                                                   
                                                 light chromaticity estimate by Algorithm 1
                                             
                                          
                                          
                                             2: Generate Zeta-image 
                                                   
                                                      ζ
                                                   
                                                 by Eq. (16)
                                             
                                          
                                          
                                             3: Transform RGB vector 
                                                   R
                                                
                                                to SUV colour space vector 
                                                   w
                                                : 
                                                   
                                                      S
                                                      =
                                                      
                                                         
                                                            ρ
                                                         
                                                         
                                                            e
                                                         
                                                      
                                                      /
                                                      ‖
                                                      
                                                         
                                                            ρ
                                                         
                                                         
                                                            e
                                                         
                                                      
                                                      ‖
                                                      ;
                                                      
                                                      U
                                                      ,
                                                      V
                                                      ⊥
                                                      S
                                                      ;
                                                      
                                                      W
                                                      =
                                                      [
                                                      S
                                                      ,
                                                      U
                                                      ,
                                                      V
                                                      ]
                                                      ;
                                                      w
                                                      =
                                                      W
                                                      
                                                      R
                                                   
                                                
                                             
                                          
                                          
                                             4: Modify S by Eq. (25): 
                                                   
                                                      
                                                         
                                                            w
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      =
                                                      S
                                                   
                                                , 
                                                   
                                                      
                                                         
                                                            w
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      →
                                                      
                                                         
                                                            w
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            S
                                                         
                                                         
                                                            modified
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             5: Return to RGB colour space: 
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            W
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      
                                                         
                                                            w
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

@&#CONCLUSION@&#

In this paper we present a novel physics-based insight regarding a plane constraint that obtains for Log-Relative-Chromaticity values near the illuminant point (for specularities in the neutral-interface model, or white surfaces). This insight provides a useful and simple method for identifying the illuminant chromaticity that requires no training data or tunable parameters. It is easy to implement and fast compared to complex colour constancy methods such as gamut mapping, while retaining comparable performance. Experiment results over datasets consisting of laboratory images and of real-world images demonstrate that the proposed method significantly outperforms other unsupervised methods while its accuracy of illuminant estimation is comparable with the best (supervised) methods but much faster.

As well, the plane constraint can also be brought to bear to improve estimates provided by other illuminant estimation algorithms. Since the feature vectors corresponding to specular or near-specular pixels in an image must lie on a plane (within the simple and straightforward model employed here), the planar constraint can be used as a post-processing step; experimental results indicate that estimate errors can be reduced by some 15% by this simple mechanism.

Here we have concentrated on a simple algorithm with a fixed threshold; but of course the 10% threshold we have used should in fact be a free parameter subject to optimization. Although results show that the new algorithm outperforms other methods in terms of median error, the method does occasionally fail and this brings down mean performance. If we have an image without any specularity, light source, or neutral surface, the method clearly fails. Moreover, in a failure case the output will be the matte colour of a surface in the scene, which would likely be an unrealistic illuminant colour. On the other hand, for non-artificial lab images it is in reality difficult to find a truly matte surface, without some admixture of specular content. For images of near-matte surfaces, the method effectively finds bright, white surfaces, but also gets a boost from any specular content actually present.

To show that the Zeta-image does indeed carry extra information regarding specularities in images, we also showed in a test using calibrated images (Fig. 6) that the Zeta-image can be used not only to identify specularities but further to generate highlight-free images retaining natural shading, with excellent results. Using two parameters (or simply one if 
                        
                           a
                           =
                           max
                           (
                           ζ
                           )
                        
                      in Eq. (25)), a simple mapping can be shown to increase specularity or decrease it, in a controlled manner. Tests on uncalibrated images (Figs. 8 and 9) further demonstrate the promise of the specularity manipulation method.

In future, we would also like to go on to generalize the Zeta method to encompass situations with multiple illuminants in a scene (e.g. as in [53–56,25]). Notwithstanding the fact that this important image regime is not specifically considered here, the performance of the method indicates that it can still be applicable, in that several of the images we used in tests did in fact have multiple illuminants, yet the method still worked.

Performance achieved by the simple approach presented shows the scientific merit of the new insight obtained. The most interesting contribution is the development of the Zeta-image itself.

@&#REFERENCES@&#

