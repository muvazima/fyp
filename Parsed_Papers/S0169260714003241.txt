@&#MAIN-TITLE@&#A machine learning approach to multi-level ECG signal quality classification

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A five-level ECG signal quality classification algorithm using a machine learning approach was proposed.


                        
                        
                           
                           13 signal quality metrics were derived from segments of ECG waveforms.


                        
                        
                           
                           The algorithm was trained and tested on a simulated dataset and was validated using data from the MIT-BIH arrhythmia database.


                        
                        
                           
                           A classification accuracy of 80.26% and a single class overlap accuracy of 98.60% on the test set were obtained by selecting 10 metrics model.


                        
                        
                           
                           A classification accuracy of 88.07±0.32% and a single class overlap accuracy of 99.34±0.07% were gained on the validation fold of MITDB.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

ECG

Signal quality

Multi-level classification

Machine learning

Support vector machine

@&#ABSTRACT@&#


               
               
                  Current electrocardiogram (ECG) signal quality assessment studies have aimed to provide a two-level classification: clean or noisy. However, clinical usage demands more specific noise level classification for varying applications. This work outlines a five-level ECG signal quality classification algorithm. A total of 13 signal quality metrics were derived from segments of ECG waveforms, which were labeled by experts. A support vector machine (SVM) was trained to perform the classification and tested on a simulated dataset and was validated using data from the MIT-BIH arrhythmia database (MITDB). The simulated training and test datasets were created by selecting clean segments of the ECG in the 2011 PhysioNet/Computing in Cardiology Challenge database, and adding three types of real ECG noise at different signal-to-noise ratio (SNR) levels from the MIT-BIH Noise Stress Test Database (NSTDB). The MITDB was re-annotated for five levels of signal quality. Different combinations of the 13 metrics were trained and tested on the simulated datasets and the best combination that produced the highest classification accuracy was selected and validated on the MITDB. Performance was assessed using classification accuracy (Ac), and a single class overlap accuracy (OAc), which assumes that an individual type classified into an adjacent class is acceptable. An Ac of 80.26% and an OAc of 98.60% on the test set were obtained by selecting 10 metrics while 57.26% (Ac) and 94.23% (OAc) were the numbers for the unseen MITDB validation data without retraining. By performing the fivefold cross validation, an Ac of 88.07±0.32% and OAc of 99.34±0.07% were gained on the validation fold of MITDB.
               
            

@&#INTRODUCTION@&#

Electrocardiogram (ECG) recordings are often corrupted by large amounts of noise and artifacts that can be within the frequency band of useful cardiac data and can manifest with similar morphologies to the ECG waveform itself [1]. Not only does the presence of noise and artifact interfere with the correct recognition of QRS, P and T waves of the ECG, but also increases the rate of false alarms for cardiac monitors [2].

Some earlier published works have described ECG signal quality assessment and noise estimation methods, generally as part of a general approach to ECG analysis. Moody and Mark used the residual after projecting a QRS complex onto the first five principal components (PCs) of an ensemble of QRS complexes, or the Karhunen–Loève transform [3]. Standard noise measurement methods for ECG, which can be used as individual signal quality indices (SQIs), were reviewed by Clifford et al., including the root mean square (RMS) power in the isoelectric region, the ratio of R-peak to noise amplitude in the isoelectric region, the Crest factor or peak-to-RMS ratio and the ratio between in-band (5–40Hz) and out-of-band spectral power [1]. Li et al. developed four SQIs which included the ratio of power in various bands of the spectrum, the degree of agreement between different QRS detectors, the degree of agreement between beat detection on different leads, and the kurtosis of the ECG [4]. These quality measures were calibrated to provide a mapping between a normalized SQI and an expected error in the heart rate (HR). The normalized SQI was then used as a weighting factor in the procedure of HR estimation by fusing the HR traces from the ECG and arterial blood pressure with a Kalman filter. This SQI-weighted HR estimation method provides an accurate HR estimate even in the presence of high levels of persistent noise and artifact, and during episodes of extreme bradycardia and tachycardia. Redmond et al. used signal masking methods to determine artifacts and the degree of missing information in the ECG [5]. Only three feature masks were described in their work: (1) a rail contact mask was used to mark the saturation to 0 or rail voltage; (2) a high-frequency mask was obtained by using a fifth-order high-pass elliptic forward–backward filter with a cut-off of 40Hz (with a fixed threshold in order to detect muscle and electrode-tissue contact noise) and (3) a low power mask was employed by using an IIR filter with a pass band of 0.7–33Hz and a fixed threshold to locate low power segments in the ECG signal. The algorithm yielded a sensitivity of 89% and a specificity of 98% although the fixed thresholds required manual tuning for different signal sources and it was not tested on an independent test set. Moreover, the analysis was not performed on a standard or public database and so the results cannot be compared to any other published method, nor can the results be considered to apply to any data outside their application. Their selection of noise sources was also not comprehensive.

The 2011 PhysioNet/Computing in Cardiology (PCinC) Challenge was to develop an efficient algorithm able to run on a mobile phone and provide useful feedback to indicate if an ECG is of adequate quality for interpretation [6,7]. The Challenge data were standard 12-lead ECG recordings with full diagnostic bandwidth (0.05–100Hz). Each lead was sampled at 500Hz with 16-bit resolution. The leads were recorded simultaneously for a minimum of 10s. Every ECG was reviewed by a group of annotators with varying amounts of expertise in ECG analysis, in blinded fashion for grading and interpretation. Between 3 and 18 annotators, working independently, examined each ECG channel, assigning it to a letter and a numerical rating (A (0.95): excellent; B (0.85): good; C (0.75): adequate; D (0.60): poor; or F (0): unacceptable) for signal quality. The average numerical rating, 
                        
                           s
                           ⌢
                        
                     , was calculated in each case, and each record was assigned to one of three groups [6,8]:
                        
                           •
                           Group 1 (acceptable): if 
                                 
                                    
                                       s
                                       ⌢
                                    
                                    ≥
                                    0.70
                                 
                              , and NF≤1.

Group 2 (indeterminate): if 
                                 
                                    
                                       s
                                       ⌢
                                    
                                    ≥
                                    0.70
                                 
                              , and NF≥2.

Group 3 (unacceptable): if 
                                 
                                    
                                       s
                                       ⌢
                                    
                                    <
                                    0.70
                                 
                              .

(NF is the number of grades that were marked as F.) Approximately 70% of the collected records were assigned to group 1, 30% to group 3, and fewer than 1% to group 2, reflecting a high degree of agreement among the annotators. A total of 1500 12-lead ECGs were divided into two sets, in a ratio of 2:1. The larger set of 1000 ECGs was used for training (Set-A), for which binary annotations (acceptable or unacceptable) were available. A smaller set of 500 ECGs was available for testing (Set-B), although competition entrants were blinded to the annotations. Several algorithms from the Challenge were then published in a special focus issue of Physiological Measurement (“Signal Quality in Cardiorespiratory Monitoring”) [8–15]. Hayn et al. explored the use of four criteria; a no signal detector, a spike detector, a lead crossing point analysis and a measure of the robustness of QRS detection. An accuracy of 93.3% was achieved on the training set and 91.6% on the test set [9]. Xia et al. developed twelve signal quality heuristics and calculated these for each of the 12 ECG leads, yielding a 12 by 12 matrix. The elements were then summed and a threshold applied to provide a classification for a given 12 lead ECG. After optimization of the threshold, the authors achieved an accuracy of 95%, with a sensitivity of 88% and specificity of 97% on the training set, but the authors did not report the performance on an independent test set [10]. Clifford et al. used a series of SQIs (based on morphological, statistical and spectral characteristics) and a support vector machine (SVM) or multilayer perceptron neural network to combine the SQIs and provide a quality estimate [8]. A classification accuracy of 98% on the training set and 97% on the test set was achieved. Only Clifford et al. studied the effect of the SQIs on arrhythmic data, and showed that arrhythmias led to a drop in accuracy to 93% indicating that algorithms may need retraining for some rhythms [8]. Subsequent work by the same research group showed that classification accuracies of up to 99% on training and test sets were obtained for normal sinus rhythm and up to 95% for arrhythmias on training and test sets [16].

These studies provided a two-class mapping for ECG signal quality: acceptable or unacceptable (as shown in PCinC website, the score is the fraction of group 1 and group 3 ECGs in set-B that were correctly classified by the participant's algorithm). However, clinical usage may demand much more specific signal quality levels according to different requirements [15]. Vaglio et al. studied different noise levels to help the cardiologist to define the set of ECGs that need a manual review after the automatic ECG measurements such as QT, PR and QRS intervals [17]. Vaglio points out that three signal quality bins will be satisfactory: low, average and good quality. ECGs flagged as low-quality will need manual reading, ECGs flagged as average-quality will need cardiologist over-read and good quality ECGs won’t need any further review process. Redmond et al. classified the ECG quality into three categories based on the determinability of heart rate: good (HR is easy to determine); average (HR is difficult, but possible to determine); bad (HR cannot reliably be determined) [15]. To analyze low amplitude characteristic segments such as the P wave or ST segment, more levels of signal quality were required. Quesnel et al. used five signal-to-noise ratio (SNR) levels to gate alarms for myocardial ischemia by indicating ST deviations in ambulatory ECG [18]. Annotation of noise is also marked in some public domain ECG databases, such as MIT-BIH arrhythmia database (MITDB) [19,20], but no further sub-level of noise was made. Fig. 1
                      shows two ECGs marked as noisy in MITDB where the noise levels and types of the two ECGs are quite different.

In this paper, we present a five-level ECG signal quality classification algorithm using a machine learning approach. A total of 13 signal quality metrics were derived from segments of ECG waveforms and were presented to a support vector machine to perform training on a simulated dataset and validated on the MIT-BIH arrhythmia database.

@&#METHODS@&#

By consulting our clinical partners and improving on the quality rating from the PCinC challenge, we define the single lead ECG signal quality categories as follow.
                              
                                 •
                                 Level 0 (clean): An outstanding recording with no visible noise or artifact

Level 1 (minor noise): A good recording with transient artifact or low-level noise that does not interfere with interpretation or recognition of P, T or atrial flutter waves

Level 2 (moderate noise): An adequate recording that can be interpreted with confidence despite visible and obvious flaws, but does not interfere with recognition of QRS complexes or ventricular flutter waves

Level 3 (severe noise): A poor recording that may be interpretable with difficulty. Noise interferes with QRS or ventricular flutter recognition

Level 4 (extreme noise): An unacceptably poor recording that cannot be interpreted with confidence because of significant technical flaws.

Two biomedical engineering master's degree students with moderate training in ECG analysis annotated each ECG lead separately and an ECG expert reviewed each of these annotations. When there was disagreement between the two students and the expert agreed with one of them, the majority decision ruled. If the expert disagreed with both of the annotators, (even though the two students agreed), a discussion between all annotators was conducted to reach a consensus.

The PCinC Challenge dataset was re-annotated by our group. The simulated dataset was composed by selecting the clean ECG leads (annotated as Level 0) from the PCinC Challenge dataset and adding different types of noise at varying SNR levels from the MIT-BIH Noise Stress Test Database (NSTDB) [20,21]. There were 1895 and 763 single leads of ECG marked as Level 0 in the PCinC Challenge training set (Set-A) and test set (Set-B) respectively, and these were defined to be Level 0 of the simulated dataset. Each lead was 10s in duration. Three types of real ECG noise namely BW (baseline wander), EM (electrode motion artifact) and MA (muscle artifact), were added to the clean leads with different levels of SNR as shown in Table 1
                           . Therefore a total of 5685 (1895×3) training segments and 2289 (763×3) test segments were created for each noise level. An illustration of signal quality at each level of the simulated dataset is shown in Fig. 2
                           . A segment of 5s ECG signal in the middle of each lead was used in this study, and so the first and last 2.5s were discarded. Note that the dominant rhythm of the simulated dataset is of normal sinus rhythm.

The MITDB was re-annotated to include the five levels of signal quality by our group and was used as the real validation dataset. Every lead of the 48 half-hour ECG recordings in the MIT database was annotated using WAVE 
                           [22], which is an extensible interactive graphical environment for manipulating sets of digitized signals with optional annotations provided by Physionet. The annotator marked the beginning and the ending time of each different signal quality level by click the mouse buttons at the corresponding position of the ECG lead. Then a second-by-second annotation file was created automatically based on these fiducial markers. A five second non-overlapping window was used to segment the ECG data into different quality levels by a program designed by our group that reviewed the annotation file automatically. Note the 5s segments were annotated according to the annotation of the consistent continuous seconds. The segments which maintained the same quality level for at least 5s were selected. Since the more noisy types of ECG tend to be less frequent or last a shorter amount of time in the MITDB, a modified selection approach was taken. Segments with four continuous seconds at a consistent quality level and a fifth second where the level was lower than that of the other 4s was selected. Additionally, segments with 3s at a consistent quality level and the first and the fifth seconds of lower quality than that of the central 3s were selected for use. Since overlapping windows will cause the longer segment (which happens to be clean) to repeat many more times than the shorter segment (which happens to be noisy), we used non-overlapping windows in this work. A summary of the number of ECG segments of each quality level in the real dataset is to be found in Table 2
                           . An illustration of each quality level of the real dataset is to be found in Fig. 3
                           .

Each channel of ECG was down-sampled to 125Hz using an anti-aliasing filter which is a linear-phase lowpass FIR filter designed using the Parks-McClellan algorithm [23], with a 35Hz passband and 45Hz stopband cutoff frequency, and at least 48.25dB attenuation in the stopband and less than 1.925dB of ripple in the passband. QRS detection was performed on each channel individually using two open source QRS detectors (eplimited and wqrs) since eplimited is less sensitive to noise [4]. Note that eplimited is a QRS detector based on the Hamilton and Tompkins algorithm [24], whereas wqrs is based upon a length transform [25].

Thirteen signal quality indices were extracted from the ECG waveform by expanding on earlier works and published papers.
                           
                              1.
                              
                                 bSQI: the percentage of beats detected by wqrs that were also detected by eplimited 
                                 [2].


                                 sSQI: the third moment (skewness) of the ECG signal [8].


                                 kSQI: the fourth moment (kurtosis) of the ECG signal [2].


                                 pSQI: the relative power in the QRS complex [2].
                                    
                                       (1)
                                       
                                          
                                             p
                                             S
                                             Q
                                             I
                                             =
                                             
                                                
                                                   
                                                      ∫
                                                      5
                                                      
                                                         15
                                                      
                                                   
                                                   
                                                      P
                                                      (
                                                      f
                                                      )
                                                      d
                                                      f
                                                   
                                                
                                                
                                                   
                                                      ∫
                                                      5
                                                      
                                                         40
                                                      
                                                   
                                                   
                                                      P
                                                      (
                                                      f
                                                      )
                                                      d
                                                      f
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              


                                 basSQI: the relative power in the baseline [8].
                                    
                                       (2)
                                       
                                          
                                             b
                                             a
                                             s
                                             S
                                             Q
                                             I
                                             =
                                             1
                                             −
                                             
                                                
                                                   
                                                      ∫
                                                      0
                                                      1
                                                   
                                                   
                                                      P
                                                      (
                                                      f
                                                      )
                                                      d
                                                      f
                                                   
                                                
                                                
                                                   
                                                      ∫
                                                      0
                                                      
                                                         40
                                                      
                                                   
                                                   
                                                      P
                                                      (
                                                      f
                                                      )
                                                      d
                                                      f
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              


                                 bsSQI: baseline wander check in time domain.
                                    
                                       (3)
                                       
                                          
                                             b
                                             s
                                             S
                                             Q
                                             I
                                             =
                                             
                                                1
                                                N
                                             
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                            
                                                               a
                                                               i
                                                            
                                                         
                                                         
                                                            B
                                                            
                                                               a
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where Ra
                                 
                                    i
                                  is the peak-to-peak amplitude of the ECG waveform around each QRS complex (from R
                                 −0.07s to R
                                 +0.08s), R is the fiducial marker of QRS complex of eplimited, i
                                 =1, 2, 3, …, N is the detected QRS complex in the analysis window.


                                 Ba
                                 
                                    i
                                  is the peak-to-peak amplitude of baseline (filtered by a 1Hz lowpass filter, H(z)=0.0503/(1−0.9497z
                                 −1)) around each QRS complex(from R
                                 −1s to R
                                 +1s).


                                 eSQI: the relative energy in the QRS complex.
                                    
                                       (4)
                                       
                                          
                                             e
                                             S
                                             Q
                                             I
                                             =
                                             
                                                
                                                   
                                                      ∑
                                                      i
                                                   
                                                   
                                                      E
                                                      
                                                         r
                                                         i
                                                      
                                                   
                                                
                                                
                                                   E
                                                   a
                                                
                                             
                                          
                                       
                                    
                                 where Er
                                 
                                    i
                                 
                                 =∑x
                                 2 is the energy of each QRS segment (from R
                                 −0.07s to R
                                 +0.08s), i
                                 =1, 2, 3, … is the detected QRS complex in the analysis window, Ea is the energy of the analysis window.


                                 hfSQI: the relative amplitude of high frequency noise.
                                    
                                       (5)
                                       
                                          
                                             h
                                             f
                                             S
                                             Q
                                             I
                                             =
                                             
                                                1
                                                N
                                             
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                            
                                                               a
                                                               i
                                                            
                                                         
                                                         
                                                            
                                                               H
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where the ECG signal (x) was multiplied by integer coefficients high pass filter, with the difference equation y(j)=
                                 x(j)−2x(j
                                 −1)+
                                 x(j
                                 −2). Then the filtered signal (y) was summed for every six points s(j)=|y(j)|+|y(j
                                 −1)|+⋯+|y(j
                                 −5)|. Ra
                                 
                                    i
                                  is the peak-to-peak amplitude of each QRS complex. H
                                 
                                    i
                                  is the mean of s(j) before each QRS complex (from R
                                 −0.28s to R
                                 −0.05s).


                                 purSQI: signal purity of ECG [26].
                                    
                                       (6)
                                       
                                          
                                             p
                                             u
                                             r
                                             S
                                             Q
                                             I
                                             =
                                             
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  ω
                                                                  2
                                                               
                                                            
                                                            ¯
                                                         
                                                         (
                                                         k
                                                         )
                                                         )
                                                      
                                                      2
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            ω
                                                            0
                                                         
                                                      
                                                      ¯
                                                   
                                                   (
                                                   k
                                                   )
                                                   
                                                      
                                                         
                                                            ω
                                                            4
                                                         
                                                      
                                                      ¯
                                                   
                                                   (
                                                   k
                                                   )
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 where 
                                    
                                       
                                          
                                             ω
                                             ¯
                                          
                                          n
                                       
                                       =
                                       
                                          ∫
                                          
                                             −
                                             π
                                          
                                          π
                                       
                                       
                                          
                                             ω
                                             n
                                          
                                          P
                                          (
                                          
                                             e
                                             
                                                j
                                                ω
                                             
                                          
                                          )
                                          d
                                          ω
                                       
                                    
                                 
                              


                                 P(e
                                 
                                    jω
                                 ) is the power spectrum of the ECG in the analysis window, and ω
                                 =2πf.


                                 rsdSQI: the relative standard deviation (STD) of QRS complex.
                                    
                                       (7)
                                       
                                          
                                             h
                                             f
                                             S
                                             Q
                                             I
                                             =
                                             
                                                1
                                                N
                                             
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                
                                                   
                                                      σ
                                                      
                                                         r
                                                         i
                                                      
                                                   
                                                   
                                                      σ
                                                      
                                                         a
                                                         i
                                                      
                                                      *
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where σr
                                 
                                    i
                                  is the STD of each QRS (from R
                                 −0.07s to R
                                 +0.08s), σa
                                 
                                    i
                                  is the STD around each QRS (from R
                                 −0.2s to R
                                 +0.2s).


                                 entSQI: the sample entropy of the ECG waveform [27].
                                    
                                       (8)
                                       
                                          
                                             e
                                             n
                                             t
                                             S
                                             Q
                                             I
                                             =
                                             E
                                             n
                                             (
                                             m
                                             ,
                                             r
                                             ,
                                             N
                                             )
                                             =
                                             −
                                             ln
                                             
                                                
                                                   
                                                      
                                                         
                                                            A
                                                            m
                                                         
                                                         (
                                                         r
                                                         )
                                                      
                                                      
                                                         
                                                            B
                                                            m
                                                         
                                                         (
                                                         r
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where N is the length of the ECG waveform, m is the preset length of repeat templates, r is a preset tolerance. For a time series of N points, {u(j):1≤
                                 j
                                 ≤
                                 N} forms the N
                                 −
                                 m
                                 +1 vectors x
                                 
                                    m
                                 (i) for 
                                    
                                       {
                                       
                                          i
                                       
                                       1
                                       ≤
                                       i
                                       ≤
                                       N
                                       −
                                       m
                                       +
                                       1
                                       }
                                    
                                 , where x
                                 
                                    m
                                 (i)={u(i
                                 +
                                 k):0≤
                                 k
                                 ≤
                                 m
                                 −1} is the vector of m data points from u(i) to u(i
                                 +
                                 m
                                 −1). 
                                    
                                       
                                          B
                                          m
                                       
                                       (
                                       r
                                       )
                                       =
                                       
                                          
                                             (
                                             N
                                             −
                                             m
                                             )
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          ∑
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             N
                                             −
                                             m
                                          
                                       
                                       
                                          
                                             B
                                             i
                                             m
                                          
                                          (
                                          r
                                          )
                                       
                                    
                                  and 
                                    
                                       
                                          A
                                          m
                                       
                                       (
                                       r
                                       )
                                       =
                                       
                                          
                                             (
                                             N
                                             −
                                             m
                                             )
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          ∑
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             N
                                             −
                                             m
                                          
                                       
                                       
                                          
                                             A
                                             i
                                             m
                                          
                                          (
                                          r
                                          )
                                       
                                    
                                 . We defined 
                                    
                                       
                                          B
                                          i
                                          m
                                       
                                       (
                                       r
                                       )
                                    
                                  as (N
                                 −
                                 m
                                 −1)−1 times the number of vectors x
                                 
                                    m
                                 (j) within r of x
                                 
                                    m
                                 (i), where j ranges from 1 to N
                                 
                                 −
                                 
                                 m(j
                                 ≠
                                 i). Similarly, we define 
                                    
                                       
                                          A
                                          i
                                          m
                                       
                                       (
                                       r
                                       )
                                    
                                  as (N
                                 −
                                 m
                                 −1)−1 times the number of vectors x
                                 
                                    m+1(j) within r of x
                                 
                                    m+1(i), where j ranges from 1 to N-m (j ≠ i).


                                 hfMSQI: high frequency mask of ECG waveform [5].

The ECG signal was first notch filtered at 50/60Hz to remove line noise. The signal was then high-pass filtered using a 5th order elliptic filter with a cut-off of 40Hz, −80dB gain in the stopband and 0.5dB ripple in the passband. Note that in the pre-processing step the low pass filter has cut out the frequencies that are greater than 45Hz, the high-pass filter here keeps the information within the high frequency band 40–45Hz. However, it can still be used for high frequency muscle artifact and electrode-tissue contact noise detection. The high-pass signal was squared and then lowpass filtered using a 0.05s normalized Hamming window FIR filter. Then the instantaneous power estimate (p) was square-rooted and used as a high frequency mask to compare with a fixed threshold. However, a ratio of p between the sum of QRS range (p
                                 
                                    i
                                 ) and the sum of full analysis window (p
                                 
                                    a
                                 ) is more comparable than the instantaneous value (p) used by Redmond in [5].
                                    
                                       (9)
                                       
                                          
                                             h
                                             f
                                             M
                                             S
                                             Q
                                             I
                                             =
                                             
                                                
                                                   
                                                      ∑
                                                      i
                                                   
                                                   
                                                      
                                                         p
                                                         i
                                                      
                                                   
                                                
                                                
                                                   
                                                      p
                                                      a
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where p
                                 
                                    i
                                  ranges from R
                                 −0.07s to R
                                 +0.08s.


                                 PiCASQI: periodic component analysis (PiCA) periodicity measure of the ECG waveform [28].

If we define the covariance of the signal x(t) as:
                                    
                                       (10)
                                       
                                          
                                             
                                                C
                                                x
                                             
                                             (
                                             τ
                                             )
                                             =
                                             
                                                E
                                                t
                                             
                                             {
                                             x
                                             (
                                             t
                                             +
                                             τ
                                             )
                                             x
                                             (
                                             t
                                             )
                                             }
                                          
                                       
                                    
                                 where E
                                 
                                    t
                                 
                                 {•} indicates averaging over t,τ is a constant time-lag. In order to apply this to the ECG signal, we replace τ with a variable τ
                                 
                                    t
                                  that is calculated from beat-to-beat ECG. Therefore, in each ECG cycle, the sample at time-instant t is compared with the sample t
                                 +
                                 τ
                                 
                                    t
                                 , which is the sample with the same phase value in the succeeding ECG beat. Then,
                                    
                                       (11)
                                       
                                          
                                             P
                                             i
                                             C
                                             A
                                             S
                                             Q
                                             I
                                             =
                                             
                                                
                                                   
                                                      
                                                         
                                                            C
                                                            x
                                                         
                                                         (
                                                         
                                                            τ
                                                            t
                                                         
                                                         )
                                                      
                                                      
                                                         
                                                            C
                                                            x
                                                         
                                                         (
                                                         0
                                                         )
                                                      
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         
                                                            E
                                                            t
                                                         
                                                         {
                                                         x
                                                         (
                                                         t
                                                         +
                                                         
                                                            τ
                                                            t
                                                         
                                                         )
                                                         x
                                                         (
                                                         t
                                                         )
                                                         }
                                                      
                                                      
                                                         
                                                            E
                                                            t
                                                         
                                                         {
                                                         x
                                                         
                                                            
                                                               (
                                                               t
                                                               )
                                                            
                                                            2
                                                         
                                                         }
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

To classify the signal quality of the ECG, we used a SVM classifier (Lib-SVM library) [29,30] with a Gaussian radial basis function (RBF) kernel defined by: 
                           
                              K
                              (
                              
                                 x
                                 n
                              
                              ,
                              
                                 x
                                 m
                              
                              )
                              =
                              exp
                              (
                              γ
                              
                                 
                                    
                                       
                                          
                                             x
                                             n
                                          
                                          −
                                          
                                             x
                                             m
                                          
                                       
                                    
                                 
                                 2
                              
                              )
                           
                        , where γ controls the width of the Gaussian and plays a role in controlling the flexibility of the resulting classifier. x
                        
                           n
                         and x
                        
                           m
                         are two vectors expressed in the initial feature space. Lib-SVM decouples the multiclass classification problem to several two-class problems and a voting strategy is used: each binary classification is considered to be a voting where votes can be cast for all data points. In the end, a point is designated to be in a class with the maximum number of votes.

Every possible combination of the SQIs was fed into the SVM model as input to train the model using the training set from the simulated dataset with 5s window lengths beginning from the individual SQI, then pairs, triplets and so on. The models were then evaluated on the test set of the simulated dataset. The SQI combination which provided the best performance was selected and used to classify the real dataset without retraining. Cross validation was also performed on the simulated dataset and real dataset separately.

@&#PERFORMANCE EVALUATION@&#

Classification accuracy (Ac) was used to evaluate the performance of the algorithm. Table 3
                         presents the confusion matrix, where rater A stands for the algorithm output and rater B stands for the annotation label. The Ac is defined as follows:
                           
                              (12)
                              
                                 
                                    A
                                    c
                                    =
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       q
                                    
                                    
                                       
                                          
                                             
                                                n
                                                
                                                   k
                                                   k
                                                
                                             
                                          
                                          N
                                       
                                    
                                 
                              
                           
                        where q is the number of categories, N is the total number of segments.

However, as neighboring classes may have substantial overlap, we also used a metric which assumes that an individual type classified into neighbor types is acceptable (e.g. level 2 is classified as level 1 or level 3). This ‘acceptable single class overlap accuracy’ (OAc) was also used to denote this process and further evaluate performance.
                           
                              (13)
                              
                                 
                                    O
                                    A
                                    c
                                    =
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       q
                                    
                                    
                                       
                                          
                                             
                                                n
                                                
                                                   k
                                                   k
                                                
                                             
                                             +
                                             
                                                n
                                                
                                                   (
                                                   k
                                                   +
                                                   1
                                                   )
                                                   k
                                                
                                             
                                             +
                                             
                                                n
                                                
                                                   (
                                                   k
                                                   −
                                                   1
                                                   )
                                                   k
                                                
                                             
                                          
                                          N
                                       
                                    
                                 
                              
                           
                        
                     

Note there are no n
                        (q+1)q
                         and n
                        01 in (13).

Furthermore, we report the Cohen's Kappa and Gwet's AC1 [31] for performance evaluation.
                           
                              (14)
                              
                                 
                                    K
                                    a
                                    p
                                    p
                                    a
                                    =
                                    
                                       
                                          
                                             p
                                             a
                                          
                                          −
                                          
                                             p
                                             e
                                          
                                       
                                       
                                          1
                                          −
                                          
                                             p
                                             e
                                          
                                       
                                    
                                    ,
                                     
                                    where
                                       
                                    
                                       p
                                       a
                                    
                                    =
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       q
                                    
                                    
                                       
                                          p
                                          
                                             k
                                             k
                                          
                                       
                                       ,
                                       
                                          p
                                          e
                                       
                                    
                                    =
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       q
                                    
                                    
                                       p
                                       k
                                       +
                                       p
                                       +
                                       k
                                    
                                 
                              
                           
                        
                        
                           
                              (15)
                              
                                 
                                    A
                                    C
                                    I
                                    =
                                    
                                       
                                          
                                             p
                                             a
                                          
                                          −
                                          
                                             p
                                             e
                                          
                                       
                                       
                                          1
                                          −
                                          
                                             p
                                             e
                                          
                                       
                                    
                                    ,
                                     
                                    where
                                       
                                    
                                       p
                                       a
                                    
                                    =
                                    
                                       1
                                       
                                          1
                                          −
                                          
                                             p
                                             M
                                          
                                       
                                    
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       q
                                    
                                    
                                       
                                          p
                                          
                                             k
                                             k
                                          
                                       
                                    
                                    ,
                                       
                                    
                                       p
                                       e
                                    
                                    =
                                    
                                       1
                                       
                                          q
                                          −
                                          1
                                       
                                    
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       q
                                    
                                    
                                       
                                          π
                                          k
                                       
                                       (
                                       1
                                       −
                                       
                                          π
                                          k
                                       
                                       )
                                    
                                 
                              
                           
                        where p
                        
                           kl
                        
                        =
                        n
                        
                           kl
                        /N represents the percentage of subjects classified into category k by the algorithm and into category l by the annotated label; p
                        
                           k+
                         and p
                        +k
                         represent the percentage of subjects assigned to category k by the algorithm and annotated label respectively; p
                        
                           m
                         is the relative number of subjects rated by a single rater and π
                        
                           k
                        
                        =(p
                        
                           k+
                        +
                        p
                        +k
                        )/2.

@&#RESULTS@&#

The performance of the individual SQIs was determined using the training and test datasets of the simulated data. Table 4
                         shows that hfSQI got the best acceptable overlap accuracy on training and test datasets of the simulated data. The results for the best SQIs combinations are summarized in Table 5
                        . The best OAc of 98.84% on the training set and 98.60% on the test set was obtained by selecting 10 SQIs, namely the combinations of hfSQI, kSQI, PiCASQI, sSQI, basSQI, bsSQI, entSQI, pSQI, purSQI and hfMSQI. When selecting four or more SQIs, the OAc remained above 98% on the training and test sets. However, the Kappa and AC1 continued to increase from 65% to 75% along with the increasing number of SQIs, which showed the increase in agreement between the algorithm and the label along with the increasing number of selected SQIs. Table 6
                         provides the confusion matrix on the test dataset when the selected 10-SQI model was used.

To evaluate the performance of the selected 10-SQI model, we performed the fivefold cross validation on the simulated dataset. The training and test datasets were combined and randomly partitioned into five equal sized subsamples (folds). Of the five folds, a single fold was retained as the validation data for testing the model, and the remaining four folds were used as training data. The cross-validation process was then repeated five times, with each of the five folds used exactly once as the validation data. We then repeated the fivefold cross validation process ten times and averaged the results which are presented in Table 7
                        . The average OAc on the validation fold was 98.79±0.13%, which was almost the same as that on the training folds (98.79±0.04), indicating the robustness of the model's performance.

The selected 10-SQI model was evaluated on the real dataset without retraining. The results showed an Ac of 57.26%, an OAc of 94.23%, a Kappa of 30.62% and an AC1 of 49.83% on the unseen real dataset. The confusion matrix for the real dataset is shown in Table 8
                         and the detailed results on each record of the real dataset are shown in Table 9
                        . From Table 9, it can be seen that good OAc was achievable when the dominant rhythm was sinus rhythm. However, the accuracy was lower when arrhythmias were present, such as atrial flutter (AFL) and atrial fibrillation (AF) (record 201, 203 and 217), ventricular flutter (VFL) (record 207) and ventricular trigeminy (record 208 and 214). This reveals that the irregular arrhythmia waveforms, such as large AFL/AF waves, VFL waves and frequent ventricular beats, will impact correct signal quality classification. Since the model was trained on the simulated dataset which mostly consisted of normal sinus rhythm, the characteristics of arrhythmias were not included in the training of the model.

In order to test the performance when signals with arrhythmias were used for training, we performed the fivefold cross validation on the real dataset and repeated ten times. The average results are shown in Table 10
                        . An Ac of 88.07±0.32%, OAc of 99.34±0.07%, Kappa of 74.65±0.67% and AC1 of 86.48±0.37% on the validation fold were obtained, which are substantially better than the results using the model trained on the simulated dataset (which included no arrhythmia data).

@&#DISCUSSION AND CONCLUSION@&#

In general, different applications and situations require different levels of ECG quality [14]. The two-class mapping for ECG signal quality (acceptable or unacceptable) was the most common in the previous studies because of its simplicity [5,8–14]. But the signal quality scores to which these studies were relevant were not informative for interpretation. Annotators were only asked to indicate how easy it was to interpret the signal in general. The difficulty of interpretation is highly dependent on what information one intends to extract from the signal [15]. As Redmond pointed out in [15], determining heart rate was much easier than identifying waveform morphology changes, and the signal quality levels required to reliably perform each task would vary significantly.

One solution of this issue is to use a continuous signal quality score. In our previous studies [2,4], continuous signal quality metrics were extracted for the usages of false alarm reduction and robust heart rate estimation and thresholds were selected based on specific applications. Although a continuous score allows ECG qualities be divided into different levels, in the end specific thresholds must be set to distinguish the usability of the ECG in a given context. As Johannesen states [14], “In general, the quality required to accept or reject a recording depends on how the recording will be used. We can envision several different situations where the thresholds for a recording to be ‘acceptable’ differ: Detecting T-wave alternans or QRS late potentials might require a higher signal quality than that needed for regular rhythm analysis…” In this study, although some of the signal metrics are continuous, these metrics have to be fused to provide an integrated score through an SVM-based mapping. The SVM algorithm can indeed provide a continuous output by training the model with a two-type classification training set, but the continuous value is hard to validate since it is difficult to create a test dataset with continuous signal quality annotations.

The alternative solution is to use more specific signal quality levels. Redmond et al. classified the ECG quality into three categories based on the determinability of heart rate [15]. Quesnel et al. used five SNR levels to gate alarms for myocardial ischemia by indicating ST deviations in ambulatory ECG [18]. A five-level quality index was also used as initial grades for annotation by volunteer annotators in the PCinC Challenge [6]. The annotators were asked to provide an overall assessment of each selected 12-lead ECG by assigning one of five possible letter grades to it: A (an outstanding recording with no visible noise or artifact; such an ECG may be difficult to interpret for intrinsic reasons, but not technical ones); B (a good recording with transient artifact or low level noise that does not interfere with interpretation; all leads recorded well); C (an adequate recording that can be interpreted with confidence despite visible and obvious flaws, but no missing signals); D (a poor recording that may be interpretable with difficulty, or an otherwise good recording with one or more missing signals); or F (an unacceptably poor recording that cannot be interpreted with confidence because of significant technical flaws). Each grade represented the observer's assessment of the entire ECG record (10s and 12 channels), as an overall measure of quality. In this study, we graded the signal quality into five categories according to clinical usage, such as whether or not the noise interferes with interpretation or recognition of P, T waves and QRS complexes.

We created a simulated dataset for algorithm development by selecting clean segments of the ECG in the 2011 PCinC Challenge database, and adding three types of realistic ECG noise at different SNR levels from the NSTDB. Adding realistic ECG noise to clean ECG data in order to create noisy datasets has become a standard method since Moody introduced this method in 1984 [21] and has since been generally accepted by researchers [3,4,8,18,32]. The most commonly used noise dataset is the NSTDB Database. However, the additive noise model has the limitation that it differs to some extent with the real world ECG records where there can be non-linear distortion and missing channels. This difference partly explains why the performance (OAc) drops from 98.79% on the simulated dataset to 94.23% on the unseen real dataset. We reviewed the annotations in the noisy categories in MITDB and found that none of Level 1, 0.3% of Level 2, 3.2% of Level 3, and 45.8% of Level 4 are non-linear distortion and non-additive noise. That is, the percentage of non-linear and non-additive noise increases along with the increase in noise level.

In a previous study, we found that the signal quality classification algorithm experienced a reduction in performance on an arrhythmia database when it was not explicitly retrained using signals containing arrhythmia episodes [8,16]. The result presented here displays a similar performance drop, providing additional evidence that this is to be expected. The reason for the poor results on arrhythmic data is that the classification model was trained on the simulated dataset which mostly consisted of normal sinus rhythm. Moreover, the Challenge data were acquired from healthy subjects, and thus, they did not include a wide range of pathological cardiac conditions. Since the AFL or AF waves show characteristic flutter waves or disorganized electrical activity between two QRS complexes and the VFL waves show a sinusoidal waveform without clear definition of the QRS and T waves, the extracted signal quality metrics, such as kurtosis or the metrics involved in QRS detection, will differ from the metrics extracted from sinus rhythm. As the training set did not include the irregular arrhythmia waveforms, the model has no ability to learn how to classify these types of arrhythmia data into clean or noisy categories and then is likely to cause a classification error. In order to test the performance when arrhythmia data were used for training, we performed the fivefold cross validation on the real dataset. This resulted in an Ac of 88.07±0.32% and OAc of 99.34±0.07% on the validation folds, which are obviously better than the results using the model trained on the simulated dataset, wherein no arrhythmia data are present. However, as noted by Clifford et al. in [8] and Li et al. in [33] it may be more judicious to apply rhythm detectors first, and then select an appropriate SQI combination pertinent to the suspected rhythm, or develop a rhythm classifier which includes signal quality metrics.

In summary, in this study we have presented a five-level ECG signal quality classification algorithm using a machine learning approach. By validating on a simulated noisy dataset and real world data (the MIT-BIH arrhythmia database), the proposed algorithm was shown to provide a high classification accuracy. By classifying the signal quality of the ECG into specific levels, a common reference for different clinical applications may be achieved. However, we note that the subjective descriptions of quantized data quality levels have significant overlap and inter-observer variability is often high, which hampers the design of a perfect classifier.

@&#ACKNOWLEDGMENT@&#

The authors gratefully acknowledge funding for this research from Mindray DS USA.

@&#REFERENCES@&#

