@&#MAIN-TITLE@&#Temporal mammogram image registration using optimized curvilinear coordinates

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           The comparison of mammograms requires a registration between them.


                        
                        
                           
                           A mammogram registration method based on the curvilinear coordinates is proposed.


                        
                        
                           
                           Temporal mammogram pairs are used to validate the proposed method.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Mammogram

Registration

Coordinates

Mutual information

Optimization

@&#ABSTRACT@&#


               
               
                  Registration of mammograms plays an important role in breast cancer computer-aided diagnosis systems. Radiologists usually compare mammogram images in order to detect abnormalities. The comparison of mammograms requires a registration between them. A temporal mammogram registration method is proposed in this paper. It is based on the curvilinear coordinates, which are utilized to cope both with global and local deformations in the breast area. Temporal mammogram pairs are used to validate the proposed method. After registration, the similarity between the mammograms is maximized, and the distance between manually defined landmarks is decreased. In addition, a thorough comparison with the state-of-the-art mammogram registration methods is performed to show its effectiveness.
               
            

@&#INTRODUCTION@&#

The goal of image registration is to find the optimal transformation function that aligns one image with another. In other words, the registration process should bring the coordinates of the current (template) mammogram to the coordinates of the previous one. Registration helps doctors analyze and visualize of mammograms. The comparison of mammograms requires a registration (alignment) method. Four breast mammogram comparisons are usually performed [19]:
                        
                           •
                           
                              Temporal analysis is performed between mammograms for the same breast at different screening examinations.


                              Bilateral analysis is performed between mammograms of the left and right breasts of the same woman.


                              Ipsilateral analysis is performed between the craniocaudal (CC) and mediolateral oblique (MLO) views of the same breast.

Analysis of breast images acquired from different modalities (e.g. X-ray with magnetic resonance imagining (MRI)).

A full review of medical image registration methods can be found in [18,28]. Few works have evaluated the performance of image registration methods using mammograms. In [8], an evaluation of four registration methods with MLO–MLO or CC–CC mammogram pairs was presented. The utilized methods were: nipple-based alignment, center of mass alignment, warping based on manually selected control points and mutual information-based (MI) registration method. The MI-based method yielded the best registration results, whereas, the control points-based method performed worst. Diez et al. [7] presented a quantitative evaluation of state-of-the-art intensity-based image registration methods applied to mammographic images. The study assessed the suitability of global rigid transformation and local deformable registration methods for mammographic image analysis. They showed that local deformations (multi-resolution B-Spline deformations) obtain the most accurate registration results. In [21], a comparison between affine, fluid and free-form deformation registration methods was shown. The study concluded that the affine method achieved the best registration results.

The main drawbacks of the existing mammogram registration methods are that they use either non-realistic global transformations or local deformable models. The global registration methods cannot properly cope with the local deformations; in turn, the local deformation models may yield unrealistic deformations.

In this paper, we propose a framework for temporal mammogram registration based on a transformation model derived from the breast anatomy, namely the curvilinear coordinate system. In curvilinear mapping, a coordinate pair (s, t) is assigned to each pixel in Cartesian coordinates, (x, y). The theoretical point of view of the proposed representation was inspired from the work proposed in [5] where a dimensionless polar coordinate system was used to generate a new representation for iris images. The construction of the curvilinear coordinates does not require any information about the internal structures of the breast. To construct the curvilinear coordinates, we use the breast boundary and a reference point located on it. Thus the resulted representation of a given mammogram is invariant to changes in the size, position and orientation of the internal structures of the breast (the internal structures do not play any role on the construction process). We utilized the curvilinear coordinates to cope both with global and local deformations in the breast area and compensate the deformations between the mammograms.


                     Fig. 1
                      shows a mammogram that has been forwardly transformed from the Cartesian coordinates to the curvilinear coordinates, and then it has been inversely transformed from the curvilinear coordinates to the Cartesian coordinates.

The use of curvilinear coordinates in mammogram registration enables us to build a registration approach based on a reasonable grid which mimics the anatomy of the breast, instead of using the Cartesian grid which is composed of vertical and horizontal lines. In addition, mammogram registration based on the curvilinear coordinates does not need determining control points nor use of a correspondence algorithm. The parameters of curvilinear coordinates may be optimized, as will be shown later, to find the best alignment between the reference and template images.

A preliminary work [22] presented the basic idea of the use of the curvilinear representation to register the mammograms. However, the current paper contains more contributions such as:
                        
                           •
                           We proposed an optimization procedure to find the optimal reference points of the curvilinear coordinates for both, the reference and the template mammograms (Section 3.2), whilst in [22] the location of the reference points were assumed at the middle of the breast boundary.

In [22], the authors assumed that the segmentation of the breast boundary was given. In the current work, we integrate the segmentation procedure within the registration framework. Moreover, we discuss the effect of boundary segmentation on the accuracy of the proposed method (Section 4.3).

We evaluate the proposed method with a private mammographic images database, containing realistic deformations between the mammograms; in contrast, few mammograms with artificial deformations were used in [22].

A review and a discussion for the related mammogram registration methods are added in this paper (Section 2). Comparisons with some related works are also provided (Section 4.4).

@&#RELATED WORK@&#

In general, image registration methods can be divided into feature-based and intensity-based methods. However, with mammogram registration, more specific registration categories are existing such as breast contour-based, anatomical structures-based and image representation-based methods. Here, we discuss the related work of each category.

Feature-based methods depend on the features extracted from the mammograms. Control points are the most used features in registration of mammograms. Marias et al. [17] used a set of breast boundary points and internal points with thin plate spline to register a pair of temporal mammograms. They used a matching approach to detect the potential internal points by comparing the features of the local maximum and minimum points in the breast region in the reference and template mammograms. Hong et al. [11] also proposed a method to compare mammogram pairs. They extracted salient regions in a topological way. An integral invariant representation of shape, in combination with area and distance measures, were used to establish the correspondences between mammograms. Furthermore, Lionel et al. [31] proposed a curvilinear structure-based mammogram registration approach. In their method, they incorporated junctions of curvilinear structures as internal landmarks. The curvilinear structures describe connective tissue, blood vessels and mammary ducts, which are detected by an algorithm based on the monogenic signal. The junctions are extracted using a local energy-based method, which considers the orientation information provided by the monogenic signal.

Indeed, it is difficult to extract consistent features from the mammograms because the appearance of the breast region dramatically depends on the strength of the compression which was applied to the breast using the compression paddles; therefore, few distinct landmarks can be determined. The main drawback of the aforementioned methods is that the extracted features (e.g. points and regions) may differ due to the compression, and this fact may cause inaccurate registration results.

Intensity-based registration depends on the image pixel values. The illumination change between mammograms and the mapping model affects the accuracy of these methods. Richard et al. [24] combined a region matching procedure and segmentation by formulating the energy minimization problem with free boundary conditions. A multi-grid implementation with a coarse-to-fine strategy was used to reduce the execution time. The gradient descent algorithm was used to optimize the energy. The main drawback of this method is that the gradient descent may get trapped into a local minimum, yielding inaccurate registration results; in addition, the accuracy of the segmentation process controls the success of the overall registration model.

In [26] an affine transformation was used to recover the global deformations between magnetic resonance breast images followed by a free-form deformation based on B-splines to model the local deformations. Normalized mutual information was used as a similarity measure. The authors of [25] added a regularization term to [26] to preserve the local volumes. Bernd et al. [9] proposed a unified approach to fast image registration and a new curvature-based registration technique. The internal forces are designed to minimize the curvature of the displacement field. The illumination change between mammograms and the mapping model affects the accuracy of the aforementioned methods.

Breast contour alignment produces a good basis for registering the mammograms. Sallam et al. [27] proposed an automated technique for identifying differences between corresponding mammograms. Their method recovered an approximate deformation between a pair of mammograms based on the determination of corresponding features across the two mammograms. The registration process was completed by using an un-warping technique to transform the template mammogram into the coordinate system of the reference mammogram. Marias et al. [15] proposed a multi-scale landmark selection approach to improve the accuracy of temporal mammogram registration. They explained the need to establish correspondences between internal regions in temporal mammograms for robust and more accurate registration results. Based on automatically detected boundary landmarks, they made a partial registration and subsequently analyzed the mammogram pair using a non-linear wavelet scale-space to identify the significant regions of interest. They showed that a small (but significant) number of internal correspondences greatly improved the registration accuracy and approximated better the complex internal tissue deformation in the breast region. In addition, in [16] they proposed a three-step framework for mammogram sequences registration: boundary registration, extraction of the correspondence between internal points using wavelet-based analysis and finally thin plate spline transformation was used to un-warp the template mammogram using the boundary and the internal points. Although the registration results were acceptable, the accuracy of these methods depends mainly on the internal points. The compression applied during the acquisition process deforms the internal regions of the breast, which may yield an error in the determination of the internal control points. These errors may produce bad registration results.

Some works used the anatomical structures of the breast in mammogram registration. Rajagopal et al. [23] used an anatomically realistic bio-mechanical model of the breast. A model was customized to each breast. These models were generated by fitting a geometrical model to segmented data from breast MRIs. Boucher et al. [2] proposed a two-step mammogram registration approach. In the first step, they used the pectoral muscle and the nipple to make a rigid alignment of MLO mammogram pairs. This step minimizes the differences caused by positioning and compression. In the second step, some deformation based on linear scalings were applied to local regions in the mammograms. This method cannot be used to register CC mammographic pairs.

Image representations may yield an improvement in the registration accuracy. Image representations should be invariant to changes in the size, position and orientation of the internal structures. In [6,5], a representation for iris images was proposed. This representation used a dimensionless polar coordinate system to generate a new representation for each iris image. The invariance to the aforementioned factors was achieved by mapping the iris images to a double dimensionless pseudo-polar coordinate system. In [6], the rubber sheet model was used to assign each pixel of the iris image, regardless of its size and papillary dilation, a pair of real coordinates (r,θ), where r is on the unit interval [0, 1] and θ is an angle in [0,2π].

The previous methodology motivated us to build a new coordinate system for breast mammograms (the curvilinear coordinates), in which the breast boundary and the nipple can be used as a basis for establishing these coordinates for each mammogram. As the coordinates of [6,5], the generated curvilinear coordinates of each mammogram is invariant to changes in the size, position and orientation of the internal structures.

Sami et al. [3] used anatomical coordinates to represent the breast region within a mammogram. These coordinates were based on the breast anatomy of 2D medio-lateral (ML) or medio-lateral oblique (MLO) view mammograms. The mammograms were registered according to the location of the pectoral muscle, the nipple and the shape of the breast boundary. A second-order approximation for the breast boundary was based on the location of the nipple, two points in the breast boundary and the pectoral muscle. Then, a non-linear mapping was used to map one image to the coordinates of the second image. Despite the effectiveness of the method in [3], it cannot be applied to register CC–CC or CC–MLO mammogram pairs because CC mammograms do not contain pectoral muscle. The manual selection of the aforementioned points represents the main disadvantage of this method as the construction of the coordinates (which map the image) is sensitive to the accuracy of the user. Moreover, second-order polynomials are insufficient to approximate the breast boundary under different compression levels. In addition, detecting the location of the nipple is a difficult problem specially in mammograms which do not contain any nipple in the mammogram profile.

Unlike Brandt's method [3], the proposed method is fully automatic (no need for manual inputs) and it can also be applied to both CC–CC and MLO–MLO mammographic pairs.

A dataset of 100 temporal mammogram pairs is used in our experiments. This dataset was collected from the Hospital Universitari Sant Joan (Reus, Spain). The collected temporal mammograms are Full Field Digital Mammograms (FFDM) with sizes of 1770×2370, 3540×4740 and 2364×2964 pixels, and with spatial resolution of 100μm. The image size depends on the compression plates used in the acquisition process (the amount of the compression varies according to the breast size of each woman). The collected images were saved in the digital imaging and communication in medicine (DICOM) format. The ground truth of each mammogram was prepared by experienced radiologists.

Prior to undergoing registration, each mammogram was preprocessed to extract the breast area, identify the orientation and determine the breast boundary. The curvilinear coordinates are used to represent the breast region in each mammogram. The breast region representation using the curvilinear coordinates is based on the breast boundary and an arbitrary reference point (origin). The breast boundary is used as a centreline, then it is used to generate the curvilinear grid. An exhaustive search technique is used to find the optimal reference points, which maximizes the MI between the reference and template mammograms. The proposed method can properly align both the breast boundary as well as the internal structures of the breast region. Fig. 2
                      presents the main steps of the proposed registration approach.

The steps of the preprocessing stage can be summarized as follows:
                           
                              1
                              The mammograms used in this paper have different sizes, so they were resized into a common size. In our experiments, we tried many image sizes, we found that the size 1024×1024 pixels maintains the performance of the proposed method with low computational complexity.

To achieve an acceptable accuracy, it is necessary to enhance the mammograms without causing a distortion of the soft details. We used the median filter for noise suppression and image enhancement. The median filter is used to generate a low-frequency image by replacing the pixel value of each pixel in the mammogram with the median pixel value computed over a square area of 11×11 pixels centered at the pixel location [30].

The breast region is extracted from the mammogram image by removing the artifacts and background. To do that, we used the approach proposed by Subashini et al. [29]. The intensity values of mammograms were scaled to the range [0, 255] and a threshold of 18 was used to convert each mammogram to binary image (mask). The connected component labeling algorithm was used to select the largest object from each binary image (the breast area and the pectoral muscle). Then, morphological operations were used to remove the isolated pixels (clean operation) and to reduce noise (majority operation, 3×3 neighborhood). We used the resulted mask to remove the labels and the artifacts from the mammograms.

The mammogram has the image of the breast at the center with left or right orientation. In the first case, the chest wall lies on the left side of the mammogram image, whereas in the second one, it lies on the right side. To register the mammograms, they should have the same orientation. In [4], pixels near the left and right corners were extracted and the pixel with brightest value determines the orientation of the breast. Given the resulted binary mask of step 3, we removed 1/8 of the number of the rows from the top and bottom borders and 1/8 of the number of the columns from the left and the right sides; this reduces the black boundaries surrounding the breast region. Then the sum of the first column (S
                                 
                                    f
                                 ) and the sum of the last column (S
                                 
                                    l
                                 ) were calculated. If S
                                 
                                    f
                                  < S
                                 
                                    l
                                 , the breast is right-oriented; otherwise, it is left-oriented. In this paper, we work with right-oriented images. After estimating the orientation, all mammograms are converted to the same orientation.

To eliminate the pectoral muscle, we used the resulted binary mask of step 3 and the mammogram orientation which we determined in step 4 to determine the location of the seed of a region growing segmentation (threshold=30). If the mammogram was left-oriented, the location of the seed was set to (5th row, 5th column), whilst in the case of right-oriented mammograms, the location of the seed was set to (5th row, number of columns-5). After these operations, the mask of the pectoral muscle was generated. To smooth this mask, we used erosion and dilation morphological operations with a flat, disk-shaped structuring element (the radius was set to 5).

To detect the breast skin boundary, we used the algorithm proposed by Maitra et al. [14]. This algorithm consists of two stages: image enhancement and edge detection. The breast contour is extracted by defining the outermost edges, so the starting point of the scanning process should be determined. Each row of the mammogram is scanned from left to determine the right most edge points. This scanning process is repeated for all the rows to find the breast contour.

In curvilinear mapping, a coordinate pair (s, t) is assigned to each pixel in Cartesian coordinates, (x, y). This operation represents a direct mapping from Cartesian to curvilinear coordinates
                           
                              (1)
                              
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 
                                    →
                                    
                                       
                                          M
                                          c
                                       
                                    
                                 
                                 (
                                 s
                                 ,
                                 t
                                 )
                              
                           
                        where c is the breast skin boundary that generates the curvilinear coordinates and M
                        
                           c
                         is the mapping operator which transforms the image from Cartesian coordinates I(x, y) to curvilinear coordinates I(s, t) as follows:
                           
                              (2)
                              
                                 I
                                 (
                                 s
                                 ,
                                 t
                                 )
                                 =
                                 
                                    M
                                    c
                                 
                                 {
                                 I
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 }
                              
                           
                        In curvilinear mapping, each pixel is identified by its surface distance, s, and the penetration distance, t. The surface distance, s, is measured from the reference point of the coordinate system (a point γ on the breast skin boundary) while t is measured from the breast's surface. The direct mapping M
                        
                           c
                         can be interpreted as a boundary-driven function that computes the (s, t) coordinates that correspond to each (x, y) Cartesian coordinate pair.

As shown in Fig. 4
                        (a), the process starts with the breast skin boundary c (red curve) and the reference point γ (this point belongs to the breast boundary c, see the yellow arrow in Fig. 4(a)). Then s-coordinate (green curves) and t-coordinate (blue curves) are generated. The domain of the s-coordinate is normalized to s
                        ∈[0, 1], in correspondence with the two extreme points of the breast boundary around the reference point. The domain of the t-coordinate is also normalized to t
                        ∈[0, 1].

The curvilinear coordinates can be generated from the breast boundary c as follows. Let the breast boundary be c
                        =(x(u), y(u)) with length L. The surface distance s of a point (x, y) is defined as:
                           
                              (3)
                              
                                 s
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             2
                                             L
                                          
                                          ∫
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               dx
                                                               du
                                                            
                                                         
                                                      
                                                   
                                                   2
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            
                                                               dy
                                                               du
                                                            
                                                         
                                                      
                                                   
                                                   2
                                                
                                                du
                                             
                                          
                                          −
                                          1
                                       
                                    
                                 
                              
                           
                        As illustrated in Fig. 4(b), the two segments around the reference point (γ) can be approximated using two N-degree parametric polynomials of s, ϕ
                        0(s) and ϕ
                        1(s):
                           
                              (4)
                              
                                 
                                    
                                       
                                          
                                             ϕ
                                             1
                                          
                                          (
                                          s
                                          )
                                          =
                                          (
                                          
                                             x
                                             1
                                          
                                          ,
                                          
                                             y
                                             1
                                          
                                          )
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             ϕ
                                             0
                                          
                                          (
                                          s
                                          )
                                          =
                                          (
                                          
                                             x
                                             0
                                          
                                          ,
                                          
                                             y
                                             0
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        These polynomials correspond to the parametric curves for all the points in curvilinear coordinates with t
                        =0 and t
                        =1, respectively. The variables x
                        0, y
                        0, x
                        1 and y
                        1 can be computed as follows.
                           
                              (5)
                              
                                 
                                    
                                       
                                          
                                             x
                                             0
                                          
                                          =
                                          
                                             ∑
                                             
                                                n
                                                =
                                                1
                                             
                                             N
                                          
                                          
                                             P
                                             
                                                0
                                                ,
                                                n
                                             
                                          
                                          
                                             s
                                             n
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             y
                                             0
                                          
                                          =
                                          
                                             ∑
                                             
                                                n
                                                =
                                                1
                                             
                                             N
                                          
                                          
                                             P
                                             
                                                1
                                                ,
                                                n
                                             
                                          
                                          
                                             s
                                             n
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             x
                                             1
                                          
                                          =
                                          
                                             ∑
                                             
                                                n
                                                =
                                                1
                                             
                                             N
                                          
                                          
                                             P
                                             
                                                2
                                                ,
                                                n
                                             
                                          
                                          
                                             s
                                             n
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             y
                                             1
                                          
                                          =
                                          
                                             ∑
                                             
                                                n
                                                =
                                                1
                                             
                                             N
                                          
                                          
                                             P
                                             
                                                3
                                                ,
                                                n
                                             
                                          
                                          
                                             s
                                             n
                                          
                                       
                                    
                                 
                              
                           
                        where P
                        0,n
                        , P
                        1,n
                        , P
                        2,n
                         and P
                        3,n
                         are constant coefficients. In this work N is set to 4. To generate the parametric curves for all the points at any t (the orange curve in Fig. 4(b)), we define the auxiliary curve 
                           
                              ϕ
                              ¯
                           
                           (
                           
                              x
                              ¯
                           
                           ,
                           
                              y
                              ¯
                           
                           )
                         as follows.
                           
                              (6)
                              
                                 
                                    
                                       
                                          
                                             x
                                             ¯
                                          
                                          =
                                          (
                                          t
                                          −
                                          1
                                          )
                                          (
                                          
                                             x
                                             0
                                          
                                          
                                          cos
                                          
                                          
                                             θ
                                             0
                                          
                                          +
                                          
                                             y
                                             0
                                          
                                          
                                          sin
                                          
                                          
                                             θ
                                             0
                                          
                                          )
                                          +
                                          t
                                          (
                                          
                                             x
                                             1
                                          
                                          
                                          cos
                                          
                                          
                                             θ
                                             1
                                          
                                          +
                                          
                                             y
                                             1
                                          
                                          
                                          sin
                                          
                                          
                                             θ
                                             1
                                          
                                          )
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             y
                                             ¯
                                          
                                          =
                                          (
                                          t
                                          −
                                          1
                                          )
                                          (
                                          
                                             y
                                             0
                                          
                                          
                                          cos
                                          
                                          
                                             θ
                                             0
                                          
                                          −
                                          
                                             x
                                             0
                                          
                                          
                                          sin
                                          
                                          
                                             θ
                                             0
                                          
                                          )
                                          +
                                          t
                                          (
                                          
                                             y
                                             1
                                          
                                          
                                          cos
                                          
                                          
                                             θ
                                             1
                                          
                                          −
                                          
                                             x
                                             1
                                          
                                          
                                          sin
                                          
                                          
                                             θ
                                             1
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        where θ
                        0 and θ
                        1 are the angles at the extreme points of ϕ
                        0(s) and ϕ
                        1(s) (see Fig. 4(b)), by substituting s
                        =1 in Eq. (5), they are calculated as follows.
                           
                              (7)
                              
                                 
                                    
                                       
                                          
                                             θ
                                             0
                                          
                                          =
                                          
                                             tan
                                             
                                                −
                                                1
                                             
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            y
                                                            0
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                            0
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             θ
                                             1
                                          
                                          =
                                          
                                             tan
                                             
                                                −
                                                1
                                             
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            y
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        The analytical expression that transforms each (x, y) pair into its corresponding (s, t) pair is calculated by rotating the auxiliary curve in Eq. (6) by θ(t),
                           
                              (8)
                              
                                 
                                    
                                       
                                          x
                                          (
                                          s
                                          ,
                                          t
                                          )
                                          =
                                          
                                             x
                                             ¯
                                          
                                          
                                          cos
                                          
                                          θ
                                          (
                                          t
                                          )
                                          −
                                          
                                             y
                                             ¯
                                          
                                          
                                          sin
                                          
                                          θ
                                          (
                                          t
                                          )
                                          ,
                                       
                                    
                                    
                                       
                                          y
                                          (
                                          s
                                          ,
                                          t
                                          )
                                          =
                                          
                                             x
                                             ¯
                                          
                                          
                                          sin
                                          
                                          θ
                                          (
                                          t
                                          )
                                          +
                                          
                                             y
                                             ¯
                                          
                                          
                                          cos
                                          
                                          θ
                                          (
                                          t
                                          )
                                       
                                    
                                 
                              
                           
                        The angle θ(t)=(θ
                        1
                        −
                        θ
                        0)t
                        +
                        θ
                        0 is a function of t and the extreme angles θ
                        0 and θ
                        1, and it represents the rotation angle that goes from θ
                        0 to θ
                        1 as t moves from 0 to 1.


                        Fig. 5
                         shows examples of the curvilinear mapping. For each mammogram we show the breast boundary, the curvilinear grid and the (s, t) mapping. For the sake of clear display for the curvilinear grid, few points of s- and t-coordinates are plotted. As shown, the two parametric polynomials, ϕ
                        0(s), and ϕ
                        1(s), properly fit the breast boundary (they yielded an interpolation error lower than 0.5%); moreover, they do not stretch inside breast region. As we mentioned before, N is set to 4. This value yields a good approximation for breast contours (see the examples of Fig. 5).

As the curvilinear mapping M
                        
                           c
                         establishes a one-to-one correspondence between each coordinate pair 
                           [
                           (
                           x
                           ,
                           y
                           )
                           
                              →
                              
                                 
                                    M
                                    c
                                 
                              
                           
                           (
                           s
                           ,
                           t
                           )
                           ]
                        , it is possible to invert the curvilinear mapping to recover the original image in Cartesian space as follows:
                           
                              (9)
                              
                                 I
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 =
                                 
                                    M
                                    c
                                    
                                       −
                                       1
                                    
                                 
                                 {
                                 I
                                 (
                                 s
                                 ,
                                 t
                                 )
                                 }
                              
                           
                        In other words, the inverse mapping 
                           
                              M
                              c
                              
                                 −
                                 1
                              
                           
                         transforms each curvilinear coordinate pair (s, t) to its correspondence Cartesian coordinate pair (x, y) as follows:
                           
                              (10)
                              
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 
                                    ←
                                    
                                       
                                          M
                                          c
                                          
                                             −
                                             1
                                          
                                       
                                    
                                 
                                 (
                                 s
                                 ,
                                 t
                                 )
                              
                           
                        In order to align the template mammogram I
                        
                           t
                         with the coordinates of the reference mammogram I
                        
                           r
                        , both of them are mapped to the curvilinear coordinate system as follows:
                           
                              (11)
                              
                                 
                                    
                                       
                                          
                                             I
                                             r
                                          
                                          (
                                          s
                                          ,
                                          t
                                          )
                                          =
                                          
                                             M
                                             
                                                
                                                   c
                                                   r
                                                
                                             
                                          
                                          {
                                          
                                             I
                                             r
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          }
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             I
                                             t
                                          
                                          (
                                          s
                                          ,
                                          t
                                          )
                                          =
                                          
                                             M
                                             
                                                
                                                   c
                                                   t
                                                
                                             
                                          
                                          {
                                          
                                             I
                                             t
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          }
                                       
                                    
                                    
                                       
                                    
                                 
                              
                           
                        where I
                        
                           r
                        (s, t) is the curvilinear mapping of I
                        
                           r
                        (x, y) using the breast boundary of the reference mammogram C
                        
                           r
                        , and I
                        
                           t
                        (s, t) is the curvilinear mapping of I
                        
                           t
                        (x, y) using the breast boundary of the template mammogram C
                        
                           t
                        . The registered mammogram I
                        
                           reg
                         can be estimated by reverse mapping the template mammogram using the boundary of reference mammogram C
                        
                           r
                         as follows:
                           
                              (12)
                              
                                 
                                    I
                                    reg
                                 
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 
                                    ←
                                    
                                       
                                          M
                                          
                                             
                                                c
                                                r
                                             
                                          
                                          
                                             −
                                             1
                                          
                                       
                                    
                                 
                                 
                                    I
                                    t
                                 
                                 (
                                 s
                                 ,
                                 t
                                 )
                              
                           
                        where 
                           
                              M
                              
                                 
                                    c
                                    r
                                 
                              
                              
                                 −
                                 1
                              
                           
                         is the reverse mapping using the boundary of the reference mammogram C
                        
                           r
                        .

Since Eq. (8) cannot be analytically inverted, the inverse mapping 
                           
                              M
                              c
                              
                                 −
                                 1
                              
                           
                         can only be obtained numerically. We used the Quickhull algorithm [1] to perform the inverse mapping (it yielded an interpolation error lower than 0.5%). Note that both the direct and inverse mapping can be implemented in one step. This is, it is possible to implement the operation 
                           
                              M
                              
                                 
                                    c
                                    r
                                 
                              
                              
                                 −
                                 1
                              
                           
                           {
                           
                              M
                              
                                 
                                    c
                                    t
                                 
                              
                           
                           {
                           
                              I
                              t
                           
                           (
                           x
                           ,
                           y
                           )
                           }
                           }
                         without needing to perform inverse mapping operations.

The position of the reference point (origin) of the curvilinear grid may be assumed in the middle of the breast boundary as in [22]. A more accurate assumption is to consider the nipple position as a reference point for the coordinate system. However, the nipple is not visible in most of mammograms. In addition, the nipple appears as a region in the mammogram, thus choosing one reference point from that region is problematic. Fig. 6
                         shows the curvilinear grid at six different positions (P1–P6) for the reference point (the yellow arrow points to the reference point of the grid). It is clear that P4 is the most suitable position to establish the curvilinear grid.


                        Fig. 7
                         shows the sensitivity of the registration process to the position of the reference point of the curvilinear mapping. As the position of the reference point changes, the MI between the registered and the reference mammograms changes. The indices of the breast boundary are normalized to [0, 1], and the position of the reference point is set at one of the breast boundary indices. In Fig. 7, the x-axis represents the possible reference point positions of the reference mammogram while the y-axis represents the possible reference point positions of the template mammogram. The position which produces the maximum MI will be selected to establish the curvilinear mapping and to estimate the registered mammogram I
                        
                           reg
                        .

Taking the position of the reference point of the reference and template mammograms γ
                        =[γ
                        1, γ
                        2] into account, the registration process can be formulated as an optimization problem as follows.
                           
                              (13)
                              
                                 
                                    γ
                                    *
                                 
                                 =
                                 arg
                                 
                                    max
                                    γ
                                 
                                 S
                                 (
                                 
                                    I
                                    r
                                 
                                 (
                                 s
                                 ,
                                 t
                                 )
                                 ,
                                 
                                    I
                                    t
                                 
                                 (
                                 s
                                 ,
                                 t
                                 )
                                 )
                              
                           
                        where S is a function that measures the degree of similarity between the reference and template mammograms (I
                        
                           r
                        ,I
                        
                           t
                        ) and γ
                        *
                        =[γ
                        1, γ
                        2] is the vector that contains the position of the reference point of the reference mammogram γ
                        1 and the reference point of the template mammogram γ
                        2. The sum of square differences is often used as a similarity measure in mono-modal image registration because the grey levels are approximately the same in the reference and template images [10]. However, the presence of pathological subjects in mammograms such as lesions as well as breast compression invalidate the assumption of grey level constancy between images. For this reason, we used the MI as a similarity measure (cost function). MI measures the dependency between the intensity distributions of two images [13]. It can work properly with pixels that are non-lineally related.

As there are only two parameters to be optimized (the location of the reference points), we used an exhaustive search procedure to find the optimal values (γ
                        1, γ
                        2) which maximize the MI between the reference and registered mammograms. In this paper, we restricted the domain of (γ
                        1, γ
                        2) to [0.3–0.7] with step of 0.04. The optimal reference points are fed to the curvilinear mapping to transform the template mammogram to the coordinates of the reference mammogram.

@&#RESULTS@&#

To evaluate the ability of the proposed method for registering temporal mammograms, we have done several experiments, and the results are summarized in this section.

@&#EVALUATION@&#

The measurement of the performance of mammogram registration methods is considered as a specially difficult task, because the deformation may be different in each mammogram and the breast region structures may change due to the growth of tissues or masses. In this paper, the structural similarity (SSIM) index [32] is used to evaluate the proposed registration framework. The SSIM index is an implementation of the idea of structural similarity between two images considering contrast, luminance and structure. A value of SSIM of 1 indicates a perfect similarity between the two mammograms while 0 indicates that the two mammograms are completely different. The SSIM index between images x and y is defined as follows.
                           
                              (14)
                              
                                 
                                    
                                       
                                          SSIM
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          =
                                          
                                             
                                                (
                                                2
                                                
                                                   μ
                                                   x
                                                
                                                
                                                   μ
                                                   y
                                                
                                                +
                                                C
                                                1
                                                )
                                                (
                                                2
                                                
                                                   σ
                                                   xy
                                                
                                                +
                                                C
                                                2
                                                )
                                             
                                             
                                                (
                                                
                                                   μ
                                                   x
                                                   2
                                                
                                                +
                                                
                                                   μ
                                                   y
                                                   2
                                                
                                                +
                                                C
                                                1
                                                )
                                                (
                                                
                                                   σ
                                                   x
                                                   2
                                                
                                                +
                                                
                                                   σ
                                                   y
                                                   2
                                                
                                                +
                                                C
                                                2
                                                )
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             σ
                                             xy
                                          
                                          =
                                          
                                             1
                                             
                                                T
                                                −
                                                1
                                             
                                          
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             T
                                          
                                          (
                                          
                                             x
                                             i
                                          
                                          −
                                          
                                             μ
                                             x
                                          
                                          )
                                          (
                                          
                                             y
                                             i
                                          
                                          −
                                          
                                             μ
                                             y
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        where T is the total number of pixels in each image, μ
                        
                           x
                         is the average of x, μ
                        
                           y
                         is the average of y, σ
                        
                           x
                         is the standard deviation of x, and σ
                        
                           y
                         is the standard deviation of y. C1=(k
                        1
                        L)2 and C2=(k
                        2
                        L)2 are two variables to stabilize the division with small denominator. L is the dynamic range of the pixel values (in our case is 256). The values of k1 and k2 are 0.01, and 0.03, respectively [32].

The joint histogram between the reference and the registered mammograms represents a visualization of the correspondence between the pixels in the mammograms. As the amount of dispersion in the joint entropy image decreases, the MI between the reference and the registered mammograms increases, indicating a better geometric alignment between the two mammograms has been achieved [13].

In addition, we calculate the error against expert-defined landmarks, between each registered mammogram, and the reference mammogram. The set of landmarks are extracted from anatomical regions (nipple, visible masses and linear structures).

@&#EXPERIMENTAL RESULTS@&#

We define the oversampling factor (OSF), which sets the number of the points of s- and t-coordinates as an integer factor of the number of the pixels along x- and y-coordinates, respectively. In our experiments, the size of the mammograms is 1024×1024 pixels (the number of the pixels along x- and y-coordinates is 1024); therefore, the number of the points of s- and t-coordinates is 1024×
                        OSF. Table 1
                         shows that the change on OSF has a small effect in the performance of the proposed method. In this work, OSF is set to 2.


                        Fig. 8
                         shows an example of a temporal mammogram registration pair. The proposed method produced a good alignment between the reference and current (template) mammograms by compensating the deformations between them. In addition, the proposed method aligned the local deformation without producing unrealistic results. Fig 9
                         shows the joint entropy image between the reference and current mammogram before and after registration using the proposed approach. The entropy image after registration has less dispersion, indicating that a better alignment has been achieved using the proposed method.

In this paper, the optimization-based scheme is compared with a nipple-based scheme where the location of the nipple is manually detected to be used as a reference point. As shown in Table 2
                        , the mammogram registration using optimized reference points improves the results of registration using nipples because the later approach is sensitive to the nipple detection accuracy and, moreover, the nipple is not visible in most of mammograms. In addition, the nipple appears as a region in the mammogram, so choosing the exact reference point is problematic.

We evaluated the accuracy of the automatic scheme against the nipple-based scheme using the Wilcoxon rank sum test, finding that the SSIM and the MI values obtained with the automatic scheme vs. those obtained with the nipple-based were not statistically significant (p-value>0.05).

To demonstrate the effectiveness of the proposed method, it has also been compared with three related methods: Demons 
                        [12], DRAMMS 
                        [20] and Brandt's method [3].

Pectoral muscle appears usually in MLO mammograms. Several works (e.g. [8]) have reported that the suppression of pectoral muscle improves the registration results. To study the effect of the pectoral muscle, the registration results of the proposed approach, Demons and DRAMMS with a set of 50 MLO mammogram pairs were compared with and without pectoral muscle. We did not consider Brandt's method in this experiment because it can be only applied in the absence of the pectoral muscle. Table 3
                         shows the SSIM and MI values of the proposed method (with and without the existence of pectoral muscle). The results indicate that pectoral muscle suppression improves the performance of the proposed approach. The SSIM values of Demons without pectoral muscle were better than those with the pectoral muscle; in turn, the SSIM values of DRAMMS with and without the pectoral muscle were comparable. The MI values of the Demons and DRAMMS with the pectoral muscle were better than those without the pectoral muscle. Both SSIM and MI values without pectoral muscle were significantly better than the values of the proposed approach with pectoral muscle (Wilcoxon rank sum test, p-value<0.05). In the case of Demons and DRAMMS, the SSIM and MI values with and without the pectoral muscle were not statistically significant (Wilcoxon rank sum test, p-value>0.05). With and without pectoral muscle, the SSIM values of the proposed method were statistically significant than the ones of Demons (p-value<0.01) and the MI values were statistically significant than the ones of DRAMMS (p-value<0.01).

Here we discuss the effect of the accuracy of boundary segmentation on the proposed method. Segmenting of the breast tissue is not so complex process because we simply separate the breast region from a black background. This process does not produce noticeable errors. Fig. 10
                         shows five segmentation scenarios of the boundaries of the reference and the template mammograms (each boundary has a different color). For each segmentation scenario, we applied the curvilinear transformation and the registered mammogram was determined. Finally, the SSIM index between the reference and registered mammograms was calculated. Each segmentation scenario produced a different SSIM value (Fig. 10(c)). The best segmentation scenario is seg1 (the red boundary) whereas the worst one is seg5 (the magenta boundary). Although seg1, seg2 and seg3 are different, they yielded comparable SSIM values. Indeed, the accuracy of the boundary segmentation affects the accuracy of the registration process. However, if a good segmentation is made, the proposed method will achieve good results. In turn, high segmentation errors may lead to very bad registration results. In the preprocessing step (Section 3.1), we have adjusted the settings of the segmentation step in order to assume a good boundary segmentation. The segmentation step did not produce very bad segmentation results like seg5 scenario.

Both Demons and DRAMMS are general purpose medical image registration methods while the proposed and Brandt's methods are designed to register only mammograms. DRAMMS is an attribute-based deformable image registration method. It describes each pixel by high-dimensional Gabor attributes extracted from multiscale and multi-orientation neighborhoods of each pixel. Demons is an intensity-based deformable registration approach that considers image registration as a non-parametric diffusion process. In this approach, the pixels are matched to their correspondences according to local intensity characterizations.

We used the ITK implementation of Demons. Our method, as well as DRAMMS and Brandt's were implemented using the MATLAB language. In the case of DRAMMS, the free form deformation was used as the deformation model and the discrete optimization was chosen as the optimization strategy. In the discrete optimization, the regularization parameter was set to 0.1. In the attribute extraction part, Gabor filters were used, the number of scales was set to 4 and the number of orientations was set to 6. The distance between the control points was set to 7 pixels in xy directions.

With Demons, we used the DeformableRegistration2 ITK algorithm. The number of iterations of this algorithm was set to 50. The standard deviation of the Gaussian kernel which smooths the deformation field after each iteration, was set to 1.0. The aforementioned parameters produce reasonable results.


                        Table 4
                         presents the SSIM and MI values of the registration of 50 mammogram pairs. Moreover, we present the error between each registered mammogram and the reference mammogram against expert-defined landmarks. The set of landmarks were picked from anatomical regions in the breast (nipple, visible masses and linear structures). The Euclidean distance is used to calculate the landmark errors. The proposed method yields the best SSIM values and the smallest landmark errors. The DRAMMS method achieves MI values comparable to those of the proposed method.

DRAMMS and Demons ignore the anatomical structure of the breast, as they are general purpose registration methods, whereas our method depends on the structure of the breast. The main disadvantage of Brandt's method is that it has many manual inputs (e.g. the location of the nipple) which makes its performance very sensitive to the accuracy of the user. We called the time that is required to get the manual inputs MT. In contrast, the proposed method is fully automatic.

The results of the Wilcoxon rank sum test indicated that the Landmark errors obtained with the proposed method were not significantly better than those obtained with Demons and Brandt's methods (p-value>0.05). The MI values obtained with the proposed method were statistically significant than those obtained with Demons and Brandt methods. In turn, the MI values obtained with the proposed method were not significantly better than those obtained with DRAMMS. Although the results of the proposed method and DRAMMS are comparable, the execution time of the proposed method is much lower than the one of DRAMMS.

Unlike the related methods, the proposed method does not need to find control points nor a correspondence algorithm. Moreover, it can cope both with global and local deformations in the breast area without causing unrealistic deformations. Table 5
                         provides a final overall comparison between the merits of the proposed method and some of the related methods. From Table 5 we observe that our method is a novel contribution, as it is fully automatic and it does not require a correspondence step. Both Demons and DRAMMS include an attribute matching step in the registration framework. In this step, an automatic approach is used to find some corresponding pixels in the reference and template images by comparing their attributes (features). The main disadvantage of Demons and DRAMMS is that the compression applied during the screening deforms the breast tissues, which yields different features for the corresponding regions, leading to a reduction in the performance of those methods.

In our experiments, the average execution time for one curvilinear transformation was 2.8s. To find the optimal reference points, the exhaustive search tried 10 points (10 transformations) in the range of [0.3,0.7] with step of 0.04.

In this paper, we have evaluated the performance of the proposed method using temporal mammograms from the same mammographic view (CC–CC or MLO–MLO mammographic images). The proposed method cannot register mammograms that were acquired from different views (e.g. CC with MLO) because the breast has different shape in each view. Moreover, the current version of proposed method cannot register breast images that were acquired from different modalities (e.g. registering mammogram with MRI images for the same breast). In the future work, we will try to extend the proposed method to register breast images that were acquired from different modalities.

In this paper, a new registration approach for aligning temporal mammogram images has been presented. The proposed approach uses a curvilinear coordinate system to align the mammograms. In this way the system uses anatomical-driven coordinates instead of using the Cartesian coordinates, which ignore the anatomical structure of the breast. Unlike Brandt's method, which requires many manual inputs and which was designed to register only MLO–MLO mammographic pairs, the proposed method is fully automatic and it can also be applied to both CC–CC and MLO–MLO mammographic pairs.

It has been shown that the representation of the curvilinear coordinates depends on its reference point. An exhaustive search is used to find the best reference point of the reference and the template mammograms, which maximizes the MI between them.

The proposed registration approach was evaluated using a set of temporal mammograms. The performance of the proposed approach was compared with another scheme based on manually detected nipples. The SSIM and MI values in the case of optimized reference points were higher than these obtained in the nipple-based scheme. Compared to three image registration methods (Demons, DRAMMS and Brandt's method), the proposed method has achieved the best SSIM and MI values. It also achieved the smallest landmark errors (5.23mm).

The future work will be focused on adapting the proposed approach for multi-modal mammogram image registration such as registering mammogram and MRI image for the same breast. In addition, we will evaluate the performance of the proposed approach with the task of tomosynthesis image registration.

@&#ACKNOWLEDGMENTS@&#

We would like to thank the editor and reviewers for their insightful comments, which helped us to further improve the strength of the work in this paper. We also thank Dr. Meritxell Arenas, Dr. Luis Martin and Dr. Anna Magarolas (Hospital Universitari Sant Joan, Reus, Spain) for their help in preparing the dataset used in this work. We also thank Said Pertuz and Carme Julia for their efforts in the initial steps of this work. Our research was partly supported by the Spanish Government through project TIN2012-37171-C02-02.

@&#REFERENCES@&#

