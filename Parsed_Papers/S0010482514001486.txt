@&#MAIN-TITLE@&#New method for geometric calibration and distortion correction of conventional C-arm

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           A new method is proposed to calibrate and correct the image for conventional C-arm.


                        
                        
                           
                           C-arm is calibrated with non-linear model before image distortion correction.


                        
                        
                           
                           An automatic method for marker extraction in C-arm image and matching is realized.


                        
                        
                           
                           The new method can simplify the installment of the calibration phantom onto C-arm.


                        
                        
                           
                           Increasing polynomial order will increase both the precision and time-consumption.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

X-ray fluoroscopy

C-arm machine

Distortion correction

Geometric calibration

Two-stage calibration

@&#ABSTRACT@&#


               
               
                  Image distortion correction and geometric calibration are critical operations for using C-arm DSA (Digital Subtraction Angiography) images to digitally navigate vascular interventional surgery. In traditional ways, C-arm images are corrected with global or local correction methods where a supposed virtual ideal image is needed, and then the corrected images are utilized to calibrate the C-arm with a pin-hole model. In this paper, we propose a new method to calibrate the C-arm with a nonlinear model and to improve navigation performance. We first calibrate the C-arm with a nonlinear model and then the distortion correction is accomplished without virtual ideal image. In this paper, the nonlinear model of C-arm imaging system is addressed at first, and then the C-arm is calibrated with a two-stage method. In the first stage, the C-arm is calibrated with the markers in image center by RAC (radial alignment constraint) method, and in the second stage the calibration parameters are optimized with Levenberg-Marquadt algorithm by minimizing the sum of the square of difference between all markers׳ real distorted positions and their theoretical distorted positions in the phantom image. Based on the calibration result, the image distortion can be corrected. To verify our method, experiments were conducted with a conventional DSA C-arm machine in hospital. The errors in distortion correction and 3D (three-dimensional) reconstruction were quantitatively compared with the global polynomial correction method and visual model method, and the results showed that the proposed method had better performance in distortion correction and 3D reconstruction.
               
            

@&#INTRODUCTION@&#

C-arm X-ray machine is widely used for its flexible mobility and perspectives ability to acquire real-time medical X-ray images of the physiological tissue of patient. In C-arm X-ray image based medical robotic system, the C-arm should be calibrated to get 3D information from 2D images [1]. However, images captured by conventional C-arm have inherent geometric distortion [2], mainly including pincushion distortion, sigmoidal distortion and local distortions [3–5]. These distortions should be corrected for accurate navigation.

Traditionally, the distortion correction is conducted at first. Then the corrected images are used to calibrate the C-arm with the pinhole model [6]. There are two main types of conventional correction methods: local method [5,7] and global method [8–10]. Soimu et al. [11], designed a method by combining both global and local methods. Yan et al. [2] proposed a method based on moving least squares and polynomial fitting. They also came up with a hybrid method integrating the moving least-squares method and multilevel B-spline approximation approach [12]. For these traditional correction methods, both the distorted and the undistorted image positions of calibration phantom markers are needed. The distorted positions can be extracted from the real images, while their undistorted positions must be acquired by special ways. Most researchers [5,13–15] assumed that the phantom plane was parallel to the imaging plane of C-arm input screen and that distortions at the central region of the C-arm image were very small. The ideal positions of markers were deduced from the markers׳ positions in the central image region. As the image plane of input screen is virtual and invisible, it is hard to guarantee that the plane of phantom is parallel to it. In [22] we compared the installation of phantom between with and without a bubble level. The result showed that directly installing the phantom resulted in larger distortion correction error than installing under help with a bubble level. But the installment of phantom with a bubble level help was complex and took longer time than directly installment. Furthermore, sigmoidal distortion is particularly bigger in the center region of the image than the border area [16]. Gronenschild pointed out that computation of the ideal image from central markers in the distorted image is unreliable [5].

Previous studies focused on distortion correction and the distortion correction errors were analyzed generally. Since pin-hole model is linear model, few discussed about the 3D reconstruction or localization error with C-arm. But in fact, the actual imaging procedure of C-arm is nonlinear. This should be considered to improve the localization accuracy with C-arm.

In our previous study [17] a visual model (VM) based method was proposed to solve geometric calibration and image distortion correction, in which the C-arm was regarded as a nonlinear CCD(Charge Coupled Device ) camera. In that work, we calibrated the C-arm with two steps. In the first step we just considered the radial distortion and calibrated the C-arm with Tsai׳s RAC method. In the next step, we took into account of the decentering distortion and thin prism distortion, and optimized the calibration using the result in the first step as initial value. After calibration, the C-arm image distortion can be corrected with the calibrated image center and distortion parameters. It worked but the result was not ideal, because the sigmoidal distortion of C-arm is different from the decentering distortion and thin prism distortion of a CCD camera lens.

In this paper, we improve the VM method by introducing a revised nonlinear projection model of C-arm. With the improved method, the distortion error is decreased and the localization accuracy is improved. We firstly introduce the nonlinear model based geometric calibration of C-arm and image geometric distortion correction, then compare it with traditional global polynomial (GP) method and VM method in aspect of distortion error and distance reconstruction error. The results show that the proposed method has a better performance than GP and VM. The proposed method is a vital basis of the IGS (Image Guidance System) of RVIR (Remote Vascular Intervention Robot) [18] which has been validated by animal clinic experiment [19].

The proposed method differs from previous techniques in three aspects: First, C-arm is calibrated before image distortion correction, which is reversed to the traditional ways, therefore their applied mechanisms are also different. Second, we do not need to suppose the phantom to be parallel to the image plane of the C-arm and to compute the virtual ideal image using positions of phantom markers in central image, which is necessary in traditional studies but whose accuracies are controversial. Third, C-arm calibration is not based on pinhole model but a revised nonlinear model. With this method, we can install the calibration phantom directly and quickly, without need of a bubble level׳s help.

In a C-arm imaging system, the X-ray beams transmitted by X-ray tube penetrate through an object, e.g. patient body, project onto the input screen of X-ray detector to form an X-ray image, as shown in Fig. 1
                        . The projection model of an ideal C-arm is pinhole model [6]. If we use 
                           
                              
                                 x
                              
                              
                                 ˜
                              
                           
                         to denote the homogeneous coordinate of 
                           x
                        , then a 3D point 
                           
                              
                                 P
                              
                              
                                 ˜
                              
                           
                           =
                           
                              
                                 [
                                 X
                                 ,
                                 Y
                                 ,
                                 Z
                                 ,
                                 1
                                 ]
                              
                              
                                 T
                              
                           
                         and its ideal image projection point 
                           
                              
                                 p
                              
                              
                                 ˜
                              
                           
                           =
                           
                              
                                 [
                                 u
                                 ,
                                 v
                                 ,
                                 1
                                 ]
                              
                              
                                 T
                              
                           
                         has the following relation:
                           
                              (1)
                              
                                 s
                                 
                                    
                                       p
                                    
                                    
                                       ˜
                                    
                                 
                                 =
                                 M
                                 
                                    
                                       P
                                    
                                    
                                       ˜
                                    
                                 
                              
                           
                        where s is a scalar factor and 
                           M
                         is the 3 × 4 projection matrix.

However, the real C-arm imaging system exists geometrical distortions, including pincushion, sigmoidal and local distortions. Among them, the local distortion is irregular for different C-arm input screen [13], but it is rather smaller compared with the other two distortions. Therefore it is often neglected [14]. Let 
                           
                              
                                 p
                              
                              
                                 d
                              
                           
                         be the actual projection position of point 
                           P
                        . 
                           
                              
                                 p
                              
                              
                                 d
                              
                           
                         depends on C-arm distortion and can be described as
                           
                              (2)
                              
                                 
                                    
                                       p
                                    
                                    
                                       d
                                    
                                 
                                 =
                                 p
                                 +
                                 δ
                                 ,
                                 
                                 δ
                                 =
                                 
                                    
                                       δ
                                    
                                    
                                       p
                                    
                                 
                                 +
                                 
                                    
                                       δ
                                    
                                    
                                       s
                                    
                                 
                              
                           
                        where δ is the total geometrical distortion, including pincushion distortion δ
                        
                           p
                         and sigmoidal distortion δ
                        
                           s
                        .

Pincushion distortion is caused by the curved surface of input screen, which is similar to a CCD camera lens. Previous studies [2,7,13] implied that pincushion distortion could be modeled as that of a CCD. Weng et al.׳s [20] pincushion distortion model is chosen in our technique and can be expressed by the following form:
                           
                              (3)
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   px
                                                
                                             
                                             =
                                             
                                                
                                                   x
                                                
                                                
                                                   u
                                                
                                             
                                             (
                                             
                                                
                                                   k
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   k
                                                
                                                
                                                   3
                                                
                                             
                                             
                                                
                                                   r
                                                
                                                
                                                   4
                                                
                                             
                                             +
                                             
                                                
                                                   k
                                                
                                                
                                                   5
                                                
                                             
                                             
                                                
                                                   r
                                                
                                                
                                                   6
                                                
                                             
                                             +
                                             …
                                             )
                                          
                                       
                                       
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   py
                                                
                                             
                                             =
                                             
                                                
                                                   y
                                                
                                                
                                                   u
                                                
                                             
                                             (
                                             
                                                
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   k
                                                
                                                
                                                   4
                                                
                                             
                                             
                                                
                                                   r
                                                
                                                
                                                   4
                                                
                                             
                                             +
                                             
                                                
                                                   k
                                                
                                                
                                                   6
                                                
                                             
                                             
                                                
                                                   r
                                                
                                                
                                                   6
                                                
                                             
                                             +
                                             …
                                             )
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 r
                                 =
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             u
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             y
                                          
                                          
                                             u
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           (
                           
                              
                                 x
                              
                              
                                 u
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 u
                              
                           
                           )
                         is the undistorted position and k
                        1,k
                        2,k
                        3,…are the coefficients of pincushion distortion.

We used the first item in each of the above equations to model the pincushion distortion of C-arm. Therefore, k
                        1 and k
                        2 represent the coefficients of pincushion distortion of C-arm.

Sigmoidal distortion is introduced by the electron optics between the input and the output phosphor of the input screen and the interaction with external earth׳s magnetic field or other stray magnetic fields around the input screen. It changes considerably in pattern and magnitude when the C-arm position changes.

Since for sigmoidal distortion the tangential displacement is different along the radial displacement, we reckon that sigmoidal distortion includes rotation and displacement effect. Therefore we model the sigmoidal distortion by the following function:
                           
                              (4)
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   sx
                                                
                                             
                                             =
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   u
                                                
                                             
                                             
                                             cos
                                             
                                             θ
                                             −
                                             
                                                
                                                   y
                                                
                                                
                                                   u
                                                
                                             
                                             
                                             sin
                                             
                                             θ
                                             )
                                             (
                                             1
                                             +
                                             t
                                             /
                                             r
                                             )
                                             −
                                             
                                                
                                                   x
                                                
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   sy
                                                
                                             
                                             =
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   u
                                                
                                             
                                             
                                             sin
                                             
                                             θ
                                             +
                                             
                                                
                                                   y
                                                
                                                
                                                   u
                                                
                                             
                                             
                                             cos
                                             
                                             θ
                                             )
                                             (
                                             1
                                             +
                                             t
                                             /
                                             r
                                             )
                                             −
                                             
                                                
                                                   y
                                                
                                                
                                                   u
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 r
                                 =
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             u
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             y
                                          
                                          
                                             u
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        where θ and t are the magnitudes of rotational and translational effects respectively (see Figs. 2 and 3
                        
                        ).

Rotational and translational effects of sigmoidal distortion vary from one position to another. The earth׳s magnetic field is unstable because of different locations and time, meanwhile, the internal electronic beam of C-arm could not be acquired accurately. Therefore, it is difficult to find the accurate relationship between distortion parameters and their positions. In order to minimize the localized effect, we utilized the following n-order polynomial to calculate k
                        1, k
                        2, θ and t separately.
                           
                              (5)
                              
                                 ϑ
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       p
                                       =
                                       0
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       q
                                       =
                                       0
                                    
                                    
                                       n
                                       −
                                       p
                                    
                                 
                                 
                                    
                                       a
                                    
                                    
                                       pq
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       u
                                    
                                    
                                       p
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       u
                                    
                                    
                                       q
                                    
                                 
                              
                           
                        where n is polynomial degree, and a
                        
                           pq
                         is the polynomial coefficient, and ϑ represents k
                        1, k
                        2, θ and t.

C-arm calibration can be performed based on its nonlinear distortion model. The nonlinear optimization is a common solution to this issue. However, the initial parameters have a great influence on the accuracy and optimization speed. Therefore, a good estimation of the initial parameters of the C-arm is important. In the central region of C-arm image, sigmoidal distortion is much smaller than pincushion distortion. Since Tsai׳s Radial Alignment Constraints (RAC) [21] is a good camera calibration method for those versatile cameras which just considers the radial(pincushion) distortion only, it could be utilized to estimate the initial parameters of C-arm. With above consideration, we conducted the C-arm calibration as following steps:

At first, a phantom with many markers is used to get the calibration image. The markers are extracted from the phantom image, their coordinates in image and 3D space are worked out and matched. The marker detection and matching algorithm will be described in Section 3.

Secondly, the C-arm is calibrated by RAC method with markers in the central image region. In our case, the markers lying within the quarter radius of the image are considered to be central markers. The initial imaging parameters of the C-arm are acquired except the sigmoidal distortion parameters.

Thirdly, C-arm parameters (including sigmoidal distortions parameters) are optimized with the markers in the whole image. The optimization object is to minimize the distances between the real markers’ image positions and their theoretical distortion positions:
                           
                              (6)
                              
                                 min
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       n
                                    
                                 
                                 [
                                 
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             di
                                          
                                       
                                       −
                                       
                                          
                                             x
                                          
                                          
                                             di
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             di
                                          
                                       
                                       −
                                       
                                          
                                             y
                                          
                                          
                                             di
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 ]
                              
                           
                        where 
                           (
                           
                              
                                 x
                              
                              
                                 d
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 d
                              
                           
                           )
                         is the actual distorted coordinate, 
                           (
                           
                              
                                 x
                              
                              
                                 d
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 d
                              
                              
                                 ′
                              
                           
                           )
                         is the calculated distorted position and the subscript i denotes the ith marker. n is the total marker number in the whole image. The optimization is conducted with Levenberg–Marquardt algorithm. The initial parameters for sigmoidal distortion are 0, and other initial parameters are computed in the second step.

C-arm calibration builds the relationship between the images and their coordinates in the world reference frame and determines the distortion parameters. To calibrate the C-arm, markers should be used whose coordinates in world reference frame and in image are known or can be worked out, whose coordinate sequence should also be correspondent. For these purposes, a double-layered aluminium calibration phantom is designed.

In our method, a double-layered aluminium calibration phantom is utilized, as shown in Fig. 4
                        . It consists of one mount base, and two removable parallel thin plate. In the lower layer arrays of ϕ 1 holes are spaced with same center interval (2cm), except three holes A, B and C whose diameters are ϕ 2, as shown in Fig. 4(c). These three holes are used to build a coordinate system for later automatic matching between marker׳s world coordinates and their images coordinates. In the upper layer there are just nine ϕ 1 holes which are vertically corresponding to nine holes on the lower layer, as shown in Fig. 4(c). These holes work as markers and their centers work as marker points. Fig. 5
                        (a) shows one X-ray image of the phantom.

The reasons that we designed the calibration phantom this way are as following: At first, since non-coplanar phantom could result in better calibration result in RAC calibration, double-layer design is utilized which could provide spatial phantom. Secondly, the markers should be quantitatively enough to get precise calibration, while also should be easily detected and distinguished in the X-ray images of the phantom, therefore many markers are distributed in the lower plate while only nine markers in the upper layer plate. Thirdly, the phantom is made of aluminium because the material is low cost and light.

From Fig. 5(a), it can be seen that there are large numbers of markers in the phantom image. Since the phantom should be removed after calibration, and the FOV (field of view) of C-arm varies with doctor׳s adjustment, the markers that enter into the FOV vary in every calibration procedure. Therefore an automatic method should be developed to extract the marker images and match them with their coordinates in the world frame.

To automatically extract the markers in X-ray image, the mathematical morphology method is utilized. At first, the phantom X-ray image is filtered with a Wiener filter. Then open operation of mathematical morphology is utilized to acquire the image background. The open operation of mathematical morphology is defined as 
                           f
                           ○
                           s
                           =
                           (
                           f
                           ⊖
                           s
                           )
                           ⊕
                           s
                        , where f is the filtered image and s is 3 × 3 structuring element, ⊕ is gray-scale dilation and ⊖ is gray-scale erosion. Thirdly, we subtract the filtered image by the background image to extract the markers׳ image. At last the markers are segmented using threshold technique and their sub-pixel image coordinates are calculated with centroid computation. Here the centroid of the marker is regarded as the image of the center of hole-marker since the cylindrical hole is very small. Fig. 5(b) shows the extracted marker image.

In Fig. 5(b), the points a, b and c are the projections of three large holes A, B and C in Fig. 4(b). These three points can be quickly detected from the extracted marker images since they covered the most pixels than other points. These three points can also be easily distinguished because a is nearest to the image center while b is farthest to the image center. There are eight rectangles in Fig. 5(b) and two dots are enclosed within every rectangle. For every these two dots, the dot closer to the image center belongs to the upper layer, while the other one is in the lower layer. This can be inferred from Fig. 5(c), since the upper layer is nearer to the X-ray detector than lower layer, the correspondent markers in the upper layer will be nearer to the image center.

For automatic matching, we utilize the three large markers A, B and C in the lower layer of the phantom to build local physical frame on the calibration phantom, and accordingly their image points a, b and c are utilized to build affine coordinates frame in the distorted X-ray image. Since the lower layer of the phantom and the image are both planar, there is homography between them. The homography can be computed by four markers A, B, C and M (M is shown in Fig. 4(c)) and their correspondent image points.

Actually the homography is very close to affine translation because the lower layer is nearly parallel to the virtual image plane of X-ray detector, and their distance is far smaller than SID (Source–Intensifier–Distance). Therefore we modify the marker׳s image coordinates to recover the ideal affine translation. Based on their sub-pixel positions, they are rounded to the nearest integer to get their affine coordinates in the above-mentioned affine coordinate frame. For affine transformation, the simple ratio is invariant. From the markers ideal image affine coordinate and equivalent center-to-center space, we can calculate the markers’ space coordinates in the local physical frame, which is shown in Fig. 6
                        .

After C-arm calibration, the distortion parameters are acquired. Then the image geometrical distortion can be corrected.

Geometric distortion correction of C-arm images can be divided into two steps: spatial transformation and gray-level interpolation. Spatial transformation is the process of finding the position mappings between distorted and corrected (undistorted or ideal) pixels. After calibration, the image center 
                        (
                        
                           
                              u
                           
                           
                              0
                           
                        
                        ,
                        
                           
                              v
                           
                           
                              0
                           
                        
                        )
                     , projection matrix and distortion parameters of C-arm are acquired. The spatial transformation between the ideal pixel 
                        p
                        =
                        
                           
                              [
                              u
                              ,
                              v
                              ]
                           
                           
                              T
                           
                        
                      and the distorted pixel 
                        
                           
                              p
                           
                           
                              d
                           
                        
                        =
                        
                           
                              [
                              
                                 
                                    u
                                 
                                 
                                    d
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    d
                                 
                              
                              ]
                           
                           
                              T
                           
                        
                      can be determined by the following equation:
                        
                           (7)
                           
                              {
                              
                                 
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                d
                                             
                                          
                                          =
                                          (
                                          (
                                          u
                                          −
                                          
                                             
                                                u
                                             
                                             
                                                0
                                             
                                          
                                          )
                                          
                                             
                                                d
                                             
                                             
                                                x
                                             
                                          
                                          +
                                          
                                             
                                                δ
                                             
                                             
                                                x
                                             
                                          
                                          )
                                          /
                                          
                                             
                                                d
                                             
                                             
                                                x
                                             
                                          
                                          +
                                          
                                             
                                                u
                                             
                                             
                                                0
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                d
                                             
                                          
                                          =
                                          (
                                          (
                                          v
                                          −
                                          
                                             
                                                v
                                             
                                             
                                                0
                                             
                                          
                                          )
                                          
                                             
                                                d
                                             
                                             
                                                y
                                             
                                          
                                          +
                                          
                                             
                                                δ
                                             
                                             
                                                y
                                             
                                          
                                          )
                                          /
                                          
                                             
                                                d
                                             
                                             
                                                y
                                             
                                          
                                          +
                                          
                                             
                                                v
                                             
                                             
                                                0
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     where d
                     
                        x
                      and d
                     
                        y
                      are the physical size of C-arm image pixel along u and v direction respectively, 
                        (
                        
                           
                              δ
                           
                           
                              x
                           
                        
                        ,
                        
                           
                              δ
                           
                           
                              y
                           
                        
                        )
                      are the distortions along image axes direction and can be calculated with Eqs. (3)–(5).

Then we rectified the distorted image by using back projection algorithm and bilinear interpolation. The projection matrix and distortion parameters vary when the orientation and SID (Source Intensifier Distance) of the C-arm changes. Therefore, these parameters are specific for a particular orientation of C-arm. Fig. 7
                      shows the distorted image and corrected image of a ruler.

@&#EXPERIMENTS AND RESULTS@&#


                     Fig. 8
                      shows the experiment environment, which is the operation room part of RVIR. The RVIR is located in Beijing Navy General Hospital. The C-arm DSA machine is GE DLX digital system, which has a 12 in. input screen. Fluoroscopic images acquired are 512 × 512 pixels. The phantom is mounted on the input screen of the C-arm, which is removable. For the purpose of 3D reconstruction, X-ray images obtained at two or more rotational angles are necessary. To unify coordinates, we paste a checkerboard marker on the calibration phantom and use an optoelectronic tracking system with a double CCD camera system to track the checkerboard marker. The robot consists of two parts, catheter operator and passive support manipulator.

The error of distortion correction and 3D reconstruction are vital to C-arm based medical robot. Distortion, 3D reconstruction and catheter localization error tests were conducted. We also carried out these experiments with global polynomial (GP) [8] and visual model based method (VM) [17] to compare their performances.

We choose the difference between real distorted positions and their corresponding theoretical computed distorted positions of the phantom markers to measure the accuracy. Maximal, minimal, mean and RMS of their distances were used to evaluate the accuracy of distortion correction.

In this experiment, we tested distortion error of the new method, GP and VM methods. The proposed method is based on distortion model of C-arm. The visual models adopted in VM are those of a camera. Literature [20] provides the detailed distortion model of a camera. We fixed secondary angle of C-arm (
                              β
                              =
                              0
                              °
                           ) and made its primary angle 
                              α
                              =
                              {
                              −
                              90
                              °
                              ,
                              −
                              85
                              °
                              ,
                              −
                              80
                              °
                              ,
                              …
                              ,
                              90
                              °
                              }
                            respectively, 37 distorted images of phantom were acquired in total.

In the proposed method, 
                              (
                              
                                 
                                    k
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    k
                                 
                                 
                                    2
                                 
                              
                              ,
                              θ
                              ,
                              t
                              )
                            are computed by four polynomial equations respectively (Eq. (5)), we tested these four equations with different orders to find the optimal one. GP method was tested with 3rd, 4th, 5th and 6th-order polynomial degrees. The VM method does not use polynomials to estimate parameters.

From Table 1
                            and Fig. 9
                           , one can see that, the proposed method has a better accuracy than VM method and has a better or at least a comparable accuracy than GP method. The optimal accuracies of the proposed method, GP and VM methods were 0.34 pixels, 0.45 pixels and 1.48 pixels respectively. The results proved the effectiveness of the proposed distortion model. In Fig. 9, the horizontal axis represents the number of test, and the vertical axis is the error. The three curves in the figure show the error changes with the polynomial degree change, but each time we just change one polynomial degree. In the first curve, only the last degree is changed. In the second curve, only the first degree is changed. In the third curve, it is the second. From Fig. 9, we can notice that, along with increasing of polynomials degree, RMS errors of the proposed method descend more or less at most cases. Moreover, it indicates that the polynomial degree of translational effect t affected the accuracy of our method most; next is that of k
                           1; least is that of k
                           2. In our test, although the error will decrease with the incensement of the degree in total, the time consumption will increase more. Therefore in consideration of balance between accuracy and time-consumption, the polynomial degree of (2nd, 2nd, 2nd, 4nd) is recommended for the proposed method.

It is difficult to estimate the true world coordinate of a point, but the distance between two points is irrelevant to the world coordinate, therefore the distance reconstruction is utilized to evaluate the accuracy of 3D reconstruction. The maximal, minimal, mean and RMS of length errors between actual and reconstructed distances are calculated to estimate the performance of 3D reconstruction.

A synthetic glass plate is designed for distance measurement, as shown in Fig. 10
                           . 20 steel balls with different diameters are embedded. In this test, we placed the synthetic glass plate on a suitable position of operation table, and captured two images I
                           0 and I
                           30 at primary angles 0° and 30° (see Fig. 11
                           ). We utilized three different techniques to carry out this test, which can be described as following.
                              
                                 1.
                                 Geometric calibration and distortion correction were implemented by the proposed method with polynomial degree of (2nd, 2nd, 2nd, 4th).

Geometric calibration and distortion correction were performed by the VM method.

Distorted images were corrected by GP method with 4th-order polynomial for its optimal performance of distortion correction, and C-arm at different views were calibrated by pinhole camera calibration.


                           Table 2
                            shows the accuracies of reconstructed distances between every two steel balls based on diverse methods. The results show that 3D reconstruction based on the proposed method has a higher precision than that based on GP or VM. The reconstruction errors of the new method, GP and VM methods were 0.53mm , 0.69mm and 0.78mm.

In this test, we compared the displacement of the catheter, measured by the robot and by C-arm with the proposed method. A glass vascular model filled with distilled water was utilized, as shown in Fig. 12
                        . In the robot, encoders were mounted on the driving motors. We suppose that in this test there was no slippage between the catheter and the driving wheels and that the catheter did not deform in the glass vessel model, the displacement of the catheter tip could be measured by the encoders of the robot. The C-arm has been calibrated with the proposed method at two pre-defined position. Each time the C-arm will be rotated to the two pre-defined positions to get two views in order to localize the catheter end position by stereovision.

The test procedure is as following: At first, the surgeon teleoperated the robot to push the catheter into the model for a distance, then rotated the catheter without push movement, then pushed again for another distance. Error in this experiment was defined as the difference between the displacement calculated by the robot and by the C-arm. The errors are shown in Table 3
                        , from which it can be seen that the maximum displacement error of catheter localization was 0.50mm.

Note that, in a real blood vessel, the resistance of viscous blood and the blood vessel wall may result in slippage and deformation of the catheter, in which case the displacement of the catheter tip in the blood vessel by the robot may not be accurate; however, this can be avoided by localization with C-arm.

@&#DISCUSSION AND CONCLUSION@&#

This work proposed a new method to solve geometric calibration and image distortion correction of conventional C-arm. Compared with previous methods, this technique is capable of performing both geometric calibration and distortion correction and simplifies the geometric calibration procedure.

Different tests were conducted to quantify the precision of the method. The distortion error tests validated the proposed method and indicated that our method (0.34 pixels) has a higher accuracy than GP (0.45 pixels) and VM (1.48 pixels) for distortion correction. Noted that in this comparison experiment, the error is defined as the difference between real distorted positions and their theoretical distorted positions. In traditional study, the error is defined as the difference between ideal positions and their corrected positions, in which the image will shrink to the center which will result in smaller errors. Furthermore, the ideal positions and their corrected positions are both virtual information, neither is acquired from the image directly.

In the 3D reconstruction error tests, since it is hard to know the ball׳s real position in the world reference frame, we reconstruct the distance between any two balls because the distance is irrelevant to the reference frame. In our distance reconstruction tests, the errors are 0.53mm, 0.69mm and 0.78mm for the proposed method, GP and VM respectively. The results show that the reconstruction accuracy using the introduced method has a distinct advantage. In the catheter localization test, the catheter displacement by the robot and C-arm are nearly same, which show it is feasible to use the C-arm to locate the catheter position in case the catheter bends or deforms in blood vessel.

In the C-arm calibration, the localization errors of markers in the phantom image could affect the calibration precision. In our method, we localize the markers with centroid method because the cylindric hole is very small and their image cover just a few pixels. The calibration can be improved in future either by using small balls as markers or by locate the markers with more accurate method such as gray weighted centroid method.

The current robotic system is based on conventional single C-arm. Therefore during the interventional surgery, we should rotate the C-arm to at least two predefined view positions. If there were bi-C-arm, it was not necessary to rotate the C-arm to get stereo-view, the reconstruction error could be less and saving more operation time. Furthermore, in the catheter localization, just the displacement is calculated. Further work should be focused on getting the catheter׳s rotation information in the future.

None declared.

@&#ACKNOWLEDGMENTS@&#

This research was supported by Chinese NSFC (Grant nos. 60905021 and 61171005) and National High Technology Research and Development Program of China (Grant no. 2013AA040804).

@&#REFERENCES@&#

