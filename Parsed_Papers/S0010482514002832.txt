@&#MAIN-TITLE@&#Optic disc segmentation using the sliding band filter

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           A fully automatic method for the optic disc segmentation in retinal images is proposed.


                        
                        
                           
                           This method is robust to variations of contrast and illumination, and insensitive to the presence of pathological conditions.


                        
                        
                           
                           The results are compared with manually extracted boundaries from three public databases.


                        
                        
                           
                           These results demonstrate that the proposed solution outperforms recent approaches.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Optic disc segmentation

Retinal images

Sliding band filter

Boundary extraction

Segmentation evaluation

@&#ABSTRACT@&#


               
               
                  
                     Background: The optic disc (OD) centre and boundary are important landmarks in retinal images and are essential for automating the calculation of health biomarkers related with some prevalent systemic disorders, such as diabetes, hypertension, cerebrovascular and cardiovascular diseases.
                  
                     Methods: This paper presents an automatic approach for OD segmentation using a multiresolution sliding band filter (SBF). After the preprocessing phase, a low-resolution SBF is applied on a downsampled retinal image and the locations of maximal filter response are used for focusing the analysis on a reduced region of interest (ROI). A high-resolution SBF is applied to obtain a set of pixels associated with the maximum response of the SBF, giving a coarse estimation of the OD boundary, which is regularized using a smoothing algorithm.
                  
                     Results: Our results are compared with manually extracted boundaries from public databases (ONHSD, MESSIDOR and INSPIRE-AVR datasets) outperforming recent approaches for OD segmentation. For the ONHSD, 44% of the results are classified as Excellent, while the remaining images are distributed between the Good (47%) and Fair (9%) categories. An average overlapping area of 83%, 89% and 85% is achieved for the images in ONHSD, MESSIDOR and INSPIR-AVR datasets, respectively, when comparing with the manually delineated OD regions.
                  
                     Discussion: The evaluation results on the images of three datasets demonstrate the better performance of the proposed method compared to recently published OD segmentation approaches and prove the independence of this method when from changes in image characteristics such as size, quality and camera field of view.
               
            

@&#INTRODUCTION@&#

The optic disc (OD) is one of the main structures in a retinal image and its shape and appearance are important for the detection of glaucoma and assessment of white lesions related with diabetic retinopathy. The OD is also a landmark for other retinal features, such as the distance between the OD and the fovea, which is often used for estimating the location of the macula [1]. In addition, OD segmentation is an important stage for the calculation of indexes related to vascular changes, such as the Arteriolar-to-Venular Ratio (AVR) [2] as the estimation of this index requires a previous OD segmentation in order to determine the region of interest [3].

There are several works on the automatic segmentation of OD in retinal images which can mainly be grouped into four categories, namely template-based methods [4–7], deformable model methods [8–13], morphological-based approaches [14–16], and pixel classification methods [17,18]. Within the first category, Aquino et al. [4] follow a voting-type algorithm to locate a pixel within the OD as initial information to define a starting sub-image. Then morphological and edge detection algorithms are applied on the sub-image to segment the OD in the red and green channels separately. In both channels, the OD boundaries are approximated using the Circular Hough Transform (CHT) and finally the one with higher score in the CHT is selected. The method proposed by Wong et al. [5] uses a level-set approach to obtain the OD boundary, that is afterwards smoothed by fitting an ellipse. A general energy function proposed by Zheng et al. [6], which integrates priors on the boundaries of the optic disc and optic cup, as well as on the minimum rim thickness. The optic cup and disc are segmented by using an energy function in a global optimization framework with a graph cut technique. Recently, Giachetti et al. [7] proposed a multiresolution ellipse fitting method which combines a radial symmetry detector and a vessel density map to detect the OD in low-resolution image. Afterwards, the OD boundary is determined using refined elliptic contours on the mid-resolution and high-resolution images. The final segmented contour is improved with a snake-based refinement algorithm.

Regarding the deformable model approaches, Lowell et al. [8] determine the OD location by finding the maximum of a correlation filter using a specialized template. Afterwards, the OD is segmented by means of a deformable contour based on a global elliptical model and on a local deformation. In the snake model proposed by Xu et al. [9], after each snake deformation, an unsupervised approach labels the contour points as edge- or uncertain-points. Then the classification result is used to refine the OD boundary before repeating the contour deformation. Li and Chutatape [10] proposed a method which extracts a point distribution model from the training set using several landmarks on OD boundaries and on main vessels inside the OD. Then this model is used by an iterative matching algorithm to locate the OD. Joshi et al. [11] modified a region-based active contour model. They improved the Chan–Vese model by using local red channel intensities and two texture feature spaces in the neighborhood of the pixels under analysis. The method proposed in [12] uses template matching and a directional matched filter to localize the OD. For OD segmentation, the authors first remove the blood vessels and bright regions using alternating sequential filtering and morphological operations. Then a fast and hybrid level set segmentation method with optimized parameters is used for extracting the OD boundary. In the method proposed by Hsiao et al. [13], the Canny edge detector and the Hough transform are used for obtaining the edge map. Afterwards, the edge map is used as an initial contour in supervised gradient vector flow snake which consists of a snake deformation stage and a contour supervised classification stage.

In the group of mathematical morphology algorithms for OD segmentation, Reza et al. [14] threshold the green component in order to obtain a binary image with isolated bright parts. Then, morphological opening is used to detect the connected components and to remove the small ones. Afterwards, extended maxima operator and minima imposition are used for extracting the OD and exudate boundaries. In [15], an adaptive mathematical morphology approach is used in two stages. In the first stage a coarse detection of OD boundary is obtained and in the second stage the results are improved. The method described in [16] uses principal component analysis in the first stage to obtain a grey image with an improved representation of the OD. After removing the vessels, a variant of watershed and stochastic watershed is applied. Finally, a geodesic transformation is used to discriminate the watershed regions as OD or non-OD regions.

In the pixel-based classification category, Abràmoff et al. [17] use a feature selection and a k-nearest neighbor classifier. The final step is the classification of each pixel into rim, cup, or background. Recently, Cheng et al. [18] proposed a method which classifies each superpixel as disc or non-disc region using histograms with enhanced contrast and texture features. Superpixels are local and coherent regions that provide local image information. Superpixel classification is used for initialization of the disc boundary followed by a deformable model for getting the final contour.

Since the intensity inside OD is variable and the OD region can be degraded by different types of retinal lesions, OD segmentation is challenging and still an open task mainly for reducing the processing time and, in pathological images, for improving the performance. In this paper, we propose a new method for OD segmentation that can be classified as a template-based solution. Our main motivation was the development of a fully automatic method that is able to produce useful results even in the presence of severe pathological conditions and showing a great independence from image acquisition settings. In this method the response of a filter suitable for the enhancement of bright circular regions, the sliding band filter (SBF), is used for estimating both the OD centre and the OD boundary. For high resolution images, the sliding band filter (SBF) is used twice. The first SBF is applied on downsampled images to estimate the optic disc centre (ODC) that is then used for defining a region of interest where the second SBF is afterwards applied for fine boundary extraction. The parameters of the second SBF are set adaptively based on the image size and camera field of view (FOV). This OD segmentation approach is evaluated on the images of three public datasets.

The proposed method is a fully automatic algorithm which segments the optic disc independently of image characteristics such as size and camera field of view. Our solution is robust to variations of contrast and illumination, the presence of exudates and peripapillary atrophy caused by diabetic retinopathy, risk of macular edema, and the blurredness of images due to severe cataracts. From now on we shortly call this approach the SBF-based OD segmentation, or simply SBF-based method.

This paper is organized as follows. Section 2 presents our approach for OD segmentation. The results in images of three different datasets are presented in Section 3, where a comparison with the manual segmentation is also included. Finally, Section 4 summarizes the conclusions.

@&#METHODS@&#


                     Fig. 1
                      depicts the block diagram of the SBF-based method for OD segmentation. The main phases are (1) preprocessing, for vessel removal; (2) low-resolution ODC estimation, for obtaining an approximated location of the ODC on downsampled images; (3) OD segmentation, for extracting the OD boundary on high-resolution images.

In the preprocessing phase, for decreasing the interference of vessels in the OD segmentation, the method starts by segmenting the vascular tree, followed by the replacement of the vessel pixels with an estimation of neighbouring background. In the next phase, an initial location for ODC is obtained aiming at defining a region of interest where, for reducing the computation time, a low-resolution SBF is applied to a downsampled image. As a result, a new candidate for the ODC location is selected from the filter response. In the third phase, the high-resolution SBF, with a higher number of support region lines, is applied to the region around the new ODC candidate on the original image. The parameters of this filter are automatically adapted to the image size and the camera field of view. The OD segmentation is finalized by detecting the maximum response of the SBF and applying a smoothing algorithm to the extracted boundary. In the following subsections, detailed descriptions of each phase of the proposed method are presented.

Since the OD region is usually a yellowish bright region, it shows high contrast in both red and green components of image. Therefore the original colour image is converted to a grey-scale one (I
                        
                           RG
                        ), where the pixel values are obtained from the red (I
                        
                           R
                        ) and green (I
                        
                           G
                        ) components of the RGB image using the equation
                           
                              (1)
                              
                                 
                                    
                                       I
                                    
                                    
                                       RG
                                    
                                 
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             I
                                          
                                          
                                             R
                                          
                                       
                                       
                                          
                                             (
                                             x
                                             ,
                                             y
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             I
                                          
                                          
                                             G
                                          
                                       
                                       
                                          
                                             (
                                             x
                                             ,
                                             y
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                    
                                       1
                                       /
                                       2
                                    
                                 
                              
                           
                        
                     

The OD segmentation process can be negatively influenced by the presence of the retinal vessels. In order to decrease this influence, the vessels are segmented and then replaced by an estimate of their neighbouring background in the image I
                        
                           RG
                        . For vessel segmentation, we have used a method developed in our research group by Mendonça et al. [19,20]. Fig. 2
                        (b) shows the segmented vascular tree for the original image of Fig. 2(a).

The background is estimated by grey-level morphological closing applied to I
                        
                           RG
                         after removing the vessel pixels using a non-flat, ball-shaped structuring element defined by
                           
                              (2)
                              
                                 B
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       r
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             
                                                r
                                             
                                             
                                                2
                                             
                                          
                                          −
                                          min
                                          (
                                          
                                             
                                                r
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          
                                             
                                                i
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          )
                                       
                                       )
                                    
                                    
                                       0.5
                                    
                                 
                                 ,
                                 
                                 −
                                 r
                                 ≤
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ≤
                                 r
                              
                           
                        
                     

We use a simple and efficient method for vessel caliber measurement. A distance transform is applied to the segmented vascular tree and the result of this operation is the labelling of each vessel pixel (p) with its distance to the closest boundary point, d
                        
                           p
                        . After that, the vessel caliber for each vessel centerline pixel, 
                           vc
                           (
                           p
                           )
                        , is estimated by 
                           vc
                           (
                           p
                           )
                           =
                           2
                           
                              
                                 d
                              
                              
                                 p
                              
                           
                           −
                           1
                        . The radius of the structuring element, r, is given by 
                           r
                           =
                           
                              
                                 1
                              
                              
                                 2
                              
                           
                           max
                           (
                           vc
                           (
                           p
                           )
                           )
                        . Fig. 2(c) shows the final image after replacement of the vessel pixels with local background estimates.

The SBF is a member of the convergence index (CI) filter class, whose output is a measure of the convergence degree of the gradient vectors calculated for the pixels belonging to the filter support region [21–23]. For each pixel with spatial coordinates 
                           (
                           x
                           ,
                           y
                           )
                        , the convergence index (C) is defined by
                           
                              (3)
                              
                                 C
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       M
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       (
                                       k
                                       ,
                                       l
                                       )
                                       ∈
                                       R
                                    
                                 
                                 cos
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 k
                                 ,
                                 l
                                 )
                              
                           
                        where 
                           
                              
                                 θ
                              
                              
                                 i
                              
                           
                           (
                           k
                           ,
                           l
                           )
                         is the orientation angle of the gradient vector at point 
                           (
                           k
                           ,
                           l
                           )
                         with respect to the line, with direction i, that connects 
                           (
                           k
                           ,
                           l
                           )
                         to 
                           (
                           x
                           ,
                           y
                           )
                        . M is the number of points in the filter support region R.

Distinct members of CI filters use different definitions for the support region, R. The support region of the coin filter (CF) is a circle with variable radius [24], while the support region of the iris filter (IF) can change in each direction [25]. A ring shaped region with varying radius and fixed width is the support region of the adaptive ring filter (ARF) [26]. The support region of the SBF is a fixed width band whose position in each direction changes for maximizing the convergence index value in each point [21,22]. For all these filters, the support region is usually restricted to a set of radial lines emerging from the point where the filter is being applied to, and equally distributed over a circular region centred at this point.

The SBF has a more generic formulation in comparison with other CI filters, which is desirable for OD segmentation due to the fact that the shape of OD differs from an exact rounded area [27]. The SBF can also be parameterized to use a narrow band and ignore the gradient information at the centre of the OD, thus reducing the interference of vessels.

The SBF response at a pixel of interest 
                           P
                           (
                           x
                           ,
                           y
                           )
                         is defined by
                           
                              (4)
                              
                                 SBF
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       N
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       C
                                    
                                    
                                       max
                                    
                                 
                                 (
                                 i
                                 )
                              
                           
                        
                        
                           
                              (5)
                              
                                 
                                    
                                       C
                                    
                                    
                                       max
                                    
                                 
                                 (
                                 i
                                 )
                                 =
                                 
                                    
                                       max
                                    
                                    
                                       
                                          
                                             R
                                          
                                          
                                             min
                                          
                                       
                                       ≤
                                       n
                                       ≤
                                       
                                          
                                             R
                                          
                                          
                                             max
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       
                                          1
                                       
                                       
                                          d
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          n
                                       
                                       
                                          n
                                          +
                                          d
                                       
                                    
                                    cos
                                    
                                       
                                          θ
                                       
                                       
                                          i
                                          ,
                                          m
                                       
                                    
                                 
                                 )
                              
                           
                        where N is the number of support region lines, 
                           
                              
                                 θ
                              
                              
                                 i
                                 ,
                                 m
                              
                           
                         represents the angle of the gradient vector at the point m pixels away from P in direction i, d corresponds to the width of the band, and R
                        
                           min
                         and R
                        
                           max
                         represent, respectively, the inner and outer sliding limits of the band. The number of support region lines (N) controls the resolution and computational cost of the SBF. The high-resolution SBF uses a higher number of support region lines, making the computation more time consuming while increasing the sensitivity of the filter to neighbouring changes; the low-resolution SBF uses a smaller number of support region lines which reduces the computation time as well as filter accuracy. Fig. 3
                         presents a schematic representation of the SBF concept where the search region is defined by the inner (R
                        
                           min
                        ) and outer (R
                        
                           max
                        ) circles and the set of d points corresponding to maximal convergence is shown in grey; in this example only 8 support region lines are considered.

As a first step, an initial ODC location is estimated and used for defining the ROI where the SBF is applied. In this phase, both a SBF with a small number of support region lines and a downsampled image are used for reducing the computation time. The filter response gives a more accurate location for the ODC to be used in the next phase.

Regarding the computational complexity of the SBF, the OD segmentation can be speed up by focusing the SBF on a limited region of interest (ROI). For this purpose, an initial ODC is estimated using the approach based on the entropy of vascular directions by Mendonça et al. [28], using the vessel segmented image obtained in the preprocessing phase. The initial ODC, O
                           
                              init
                           , is the centre of this ROI (Fig. 2(d)).

The SBF filter is computationally expensive and its application to a high-resolution image takes a lot of time. In order to reduce the computational time, we have used the SBF twice. The first SBF is applied on a large ROI of a downsampled image in order to obtain a coarse ODC location, whose position is used for establishing a smaller ROI on the original size image for applying the second SBF. To downsample an image to a common size, we have used as reference an image with the resolution of 760×570 pixels and 45° camera field of view (FOV). The images are downsampled according to the size and FOV of the reference image using the scale factor (α) that is computed by multiplying the image size scale factor (
                              
                                 S
                                 1
                              
                           ) and the FOV scale factor (S
                           2). 
                              
                                 S
                                 1
                              
                            is defined as the quotient between the diameter of retinal image mask (d
                           2) and the diameter of the reference image mask (d
                           1).


                           
                              
                                 S
                                 2
                              
                            is defined by 
                              
                                 
                                    S
                                 
                                 
                                    2
                                 
                              
                              =
                              
                                 
                                    D
                                 
                                 
                                    1
                                 
                              
                              /
                              
                                 
                                    D
                                 
                                 
                                    2
                                 
                              
                           , where D
                           1 and D
                           2 represent, respectively, the diagonal of the reference image plane and the diagonal of the actual image plane. The diagonal field of view can be calculated using
                              
                                 (6)
                                 
                                    tan
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          2
                                          
                                             
                                                f
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                 
                              
                           where ϕ
                           
                              i
                            is the field of view, 
                              
                                 
                                    D
                                 
                                 
                                    i
                                 
                              
                            represents the diagonal of the image plane, and 
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                              
                            is the camera focal length.

Using (6) and assuming that the focal lengths of cameras are similar (
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              ≈
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                              
                           ), the FOV scale factor is estimated by
                              
                                 (7)
                                 
                                    
                                       
                                          S
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                D
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                f
                                             
                                             
                                                1
                                             
                                          
                                          tan
                                          (
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   1
                                                
                                             
                                             /
                                             2
                                          
                                          )
                                       
                                       
                                          
                                             
                                                f
                                             
                                             
                                                2
                                             
                                          
                                          tan
                                          (
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   2
                                                
                                             
                                             /
                                             2
                                          
                                          )
                                       
                                    
                                    
                                       
                                          →
                                       
                                       
                                          
                                             
                                                f
                                             
                                             
                                                1
                                             
                                          
                                          ≈
                                          
                                             
                                                f
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          tan
                                          (
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   1
                                                
                                             
                                             /
                                             2
                                          
                                          )
                                       
                                       
                                          tan
                                          (
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   2
                                                
                                             
                                             /
                                             2
                                          
                                          )
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    ϕ
                                 
                                 
                                    1
                                 
                              
                            represents the reference image FOV and 
                              
                                 
                                    ϕ
                                 
                                 
                                    2
                                 
                              
                            is the FOV of the image being processed.

Finally, the scale factor for image downsampling is calculated by
                              
                                 (8)
                                 
                                    α
                                    =
                                    
                                       
                                          S
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                2
                                             
                                          
                                          tan
                                          (
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   1
                                                
                                             
                                             /
                                             2
                                          
                                          )
                                       
                                       
                                          
                                             
                                                d
                                             
                                             
                                                1
                                             
                                          
                                          tan
                                          (
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   2
                                                
                                             
                                             /
                                             2
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        

The image is downsampled using α, and afterwards, the SBF is applied to the ROI. The ROI is considered as a w×w square window centred at O
                           
                              init
                           . Fig. 4
                           (b) shows the SBF result on the ROI of Fig. 4(a). In order to find a new candidate for ODC (O
                           
                              l1), the locations of K candidate points with highest filter response are listed, 
                              Q
                              =
                              {
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                              )
                              ,
                              
                              i
                              =
                              1
                              ,
                              2
                              …
                              ,
                              K
                              }
                           . These points are represented by the dots in Fig. 4(c). The outliers of this set are excluded based on two criteria: (1) the relation of its value with the highest value of the filter response; (2) distance to the centroid of the K point set. The criteria for excluding outliers are defined by
                              
                                 (9)
                                 
                                    SBF
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    <
                                    (
                                    1
                                    −
                                    β
                                    )
                                    
                                       
                                          max
                                       
                                       
                                          1
                                          ≤
                                          i
                                          ≤
                                          K
                                       
                                    
                                    (
                                    
                                       SBF
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    )
                                 
                              
                           
                           
                              
                                 (10)
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            y
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            y
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          )
                                       
                                       
                                          0.5
                                       
                                    
                                    >
                                    γ
                                 
                              
                           where 
                              SBF
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                              )
                            is the filter response at point 
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                              )
                            using (4), and x
                           
                              m
                            and y
                           
                              m
                            represent the centroid of the K points. After excluding the outliers, the new centroid of the remaining points in set 
                              Q
                            is the new candidate for ODC (O
                           
                              l1), that will be the centre of the new ROI to apply the high-resolution SBF in the next phase. The new ODC is shown with a grey cross in Fig. 4(d).

In this phase, a high-resolution SBF is applied to the original image. By high-resolution SBF, we mean a filter with a higher number of support region lines, N. The ROI for applying the SBF is a square region around the new ODC that was calculated in the previous phase. Unlike the low-resolution version of the filter, all SBF parameters in this phase are computed using the scale factor α.

For reducing the computation time, we have used a smaller region for the ROI when compared with the ROI used in the previous phase. For ROI determination, a default value of w
                           
                              h
                            pixels for the window size is then multiplied by the scale factor obtained from (8). The values for SBF parameters (R
                           
                              min
                           , R
                           
                              max
                            and d) depend on image size, so for each particular image they are obtained multiplying the low-resolution SBF ones by α.

As illustrated in Fig. 5
                           , the number of support region lines (N) is calculated using
                              
                                 (11)
                                 
                                    sin
                                    (
                                    
                                       θ
                                       /
                                       2
                                    
                                    )
                                    =
                                    
                                       
                                          h
                                       
                                       
                                          2
                                          α
                                          
                                             
                                                R
                                             
                                             
                                                avg
                                             
                                          
                                       
                                    
                                    
                                       
                                          →
                                       
                                       
                                          θ
                                          =
                                          2
                                          π
                                          /
                                          N
                                       
                                    
                                    N
                                    =
                                    
                                       
                                          π
                                       
                                       
                                          
                                             
                                                sin
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          (
                                          h
                                          /
                                          2
                                          α
                                          
                                             
                                                R
                                             
                                             
                                                avg
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        

If 
                              x
                              ≪
                              1
                           , 
                              
                                 
                                    sin
                                 
                                 
                                    −
                                    1
                                 
                              
                              (
                              
                                 x
                              
                              )
                              ≈
                              x
                           , Eq. (11) can be simplified to
                              
                                 (12)
                                 
                                    N
                                    =
                                    
                                       
                                          2
                                          π
                                          α
                                          
                                             
                                                R
                                             
                                             
                                                avg
                                             
                                          
                                       
                                       
                                          h
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    R
                                 
                                 
                                    avg
                                 
                              
                            is an average value for OD radius in the reference image as mentioned in Section 2.3.2, and h is the distance between endpoints of the support region lines.

After applying the SBF to the new defined ROI, the location of the point with the maximum value of filter response, (
                              
                                 
                                    x
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    c
                                 
                              
                           ), is selected as the final ODC. Given the detected ODC coordinates, the OD shape can be estimated using the position of the band that maximizes the convergence index response in each direction of the support region lines. To estimate the OD shape, we find the positions of the sliding band points (band support points) that contributed to maximum response. The coordinates of the band support points (X,Y) are obtained using
                              
                                 (13)
                                 
                                    X
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          x
                                       
                                       
                                          c
                                       
                                    
                                    +
                                    
                                       
                                          r
                                       
                                       
                                          max
                                       
                                    
                                    (
                                    i
                                    )
                                    ×
                                    cos
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              
                           
                           
                              
                                 (14)
                                 
                                    Y
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          y
                                       
                                       
                                          c
                                       
                                    
                                    +
                                    
                                       
                                          r
                                       
                                       
                                          max
                                       
                                    
                                    (
                                    i
                                    )
                                    ×
                                    sin
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              
                           where r
                           
                              max
                           (i) corresponds to the radius in direction i, which is obtained using
                              
                                 (15)
                                 
                                    
                                       
                                          r
                                       
                                       
                                          max
                                       
                                    
                                    (
                                    i
                                    )
                                    =
                                    
                                       
                                          arg
                                          
                                          max
                                       
                                       
                                          
                                             
                                                R
                                             
                                             
                                                min
                                             
                                          
                                          ≤
                                          n
                                          ≤
                                          
                                             
                                                R
                                             
                                             
                                                max
                                             
                                          
                                       
                                    
                                    (
                                    
                                       
                                          
                                             1
                                          
                                          
                                             d
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             m
                                             =
                                             n
                                          
                                          
                                             n
                                             +
                                             d
                                          
                                       
                                       cos
                                       
                                          
                                             θ
                                          
                                          
                                             i
                                             ,
                                             m
                                          
                                       
                                    
                                    )
                                 
                              
                           The band support points that represent the OD boundary are shown on the original size and cropped images, respectively, in Fig. 6
                           (a) and (b).

In order to finalize the OD shape, a robust local regression algorithm is used for smoothing the boundary [29]. First the distances between boundary points and the final ODC are obtained (d
                           
                              op
                           (i)), and afterwards a locally weighted smoothing method is applied to the set of d
                           
                              op
                           (i). The smoothing process is considered to be local as it smooths each value by using a subset of neighbouring data points. A robust regression weight function is defined for the data points contained within the subset, which makes the process resistant to outliers.

The local regression smoothing process starts by computing the regression weights for each data point in the subset. The number of data points in the subset is set equal to 
                              N
                              /
                              4
                           , and the symmetric weight function is defined by
                              
                                 (16)
                                 
                                    
                                       
                                          w
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    j
                                    )
                                    =
                                    
                                       
                                          (
                                          
                                             1
                                             −
                                             
                                                
                                                   |
                                                   
                                                      1
                                                      −
                                                      
                                                         
                                                            2
                                                            j
                                                         
                                                         
                                                            (
                                                            
                                                               N
                                                               /
                                                               4
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                   |
                                                
                                                
                                                   3
                                                
                                             
                                          
                                          )
                                       
                                       
                                          3
                                       
                                    
                                    ,
                                    
                                    j
                                    =
                                    {
                                    
                                       1
                                       ,
                                       2
                                       ,
                                       3
                                       ,
                                       …
                                       ,
                                       
                                          
                                             N
                                          
                                          
                                             4
                                          
                                       
                                    
                                    }
                                 
                              
                           where 
                              
                                 
                                    w
                                 
                                 
                                    1
                                 
                              
                              (
                              j
                              )
                            is the weight for the j
                           th data point within the subset, and N is the number of boundary points. Afterwards, a second-degree polynomial is employed for the weighted linear least square regression of d
                           
                              op
                           (i).

For preventing the distortion introduced by outliers, the distances d
                           
                              op
                           (i) are smoothed again using robust weights. The computation of robust weights requires the computation of the residuals obtained in a previous smoothing step. The robust weights are given by
                              
                                 (17)
                                 
                                    
                                       
                                          w
                                       
                                       
                                          2
                                       
                                    
                                    (
                                    j
                                    )
                                    =
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      (
                                                      
                                                         1
                                                         −
                                                         
                                                            
                                                               (
                                                               
                                                                  
                                                                     
                                                                        e
                                                                     
                                                                     
                                                                        j
                                                                     
                                                                  
                                                                  /
                                                                  6
                                                                  M
                                                               
                                                               )
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      2
                                                   
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                |
                                                
                                                   
                                                      
                                                         e
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   <
                                                   6
                                                   M
                                                
                                                |
                                             
                                          
                                          
                                             
                                                0
                                                ,
                                             
                                             
                                                |
                                                
                                                   
                                                      
                                                         e
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ≥
                                                   6
                                                   M
                                                
                                                |
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    e
                                 
                                 
                                    j
                                 
                              
                            is the residual of the j
                           th data point produced by the previous regression smoothing algorithm, and M is the median of absolute deviation of the residuals.

Further smoothing is obtained using a second-degree polynomial and the robust weights. The smoothing result is shown with a solid line in Fig. 6(c). The final boundary points are specified using the smoothed distances from the ODC. Fig. 6(d) presents the final OD boundary overlapped on the original RGB image.

@&#RESULTS@&#

The automatic OD segmentation method described in the previous sections was evaluated in the images of three public datasets, ONHSD [8], MESSIDOR [30], and INSPIRE-AVR [31]. The ONHSD contains 99 images with resolution of 760×570 pixels and 8 bits per colour plane. The images were captured using a Canon CR6 45MNf fundus camera, with a field angle lens of 45°. The standard reference for this dataset was provided by experts at the University of Lincoln [32]. The ODC has been marked up by a clinician and four clinicians marked the OD boundary on the radial spokes (at 15° angles) radiating from the nominated centre. The MESSIDOR dataset contains 1200 eye fundus colour images acquired using a Topcon TRC NW6 non-mydriatic retinograph with a 45° FOV. 800 of these images were captured with pupil dilation and 400 without dilation. The images are 1440×960, 2240×1488, or 2304×1536 pixels in size and 8 bits per colour plane. The OD boundary was manually delimited by experts at the University of Huelva [33], and used as a gold standard for the evaluation.

The 40 high resolution images of the INSPIRE-AVR dataset have resolution of 2392×2048 pixels and are OD-centred. All images were obtained using a 30° Zeiss fundus camera. The OD boundary of each image was approximated by an ellipse fitted to 16 points marked up by an expert. The manual OD segmentation for this dataset is available for download from the RetinaCAD website [34]. Using these three datasets we are able to analyse the performance of our approach on images with different resolution (ranging from 760×570 to 2392×2048 pixels), acquired using various fundus cameras and distinct FOVs (30°, 45°).

The image and FOV sizes in the ONHSD were considered as reference values for parameter setting. Table 1
                         shows the values of the parameters that were established using the images of the ONHSD, and afterwards applied to the two other datasets.

The second column of Table 2
                         shows the values for the parameters of the low-resolution SBF, and the third column of Table 2 represents the formulas to obtain the parameters for the high-resolution SBF. Table 3
                         presents the scale factors for the different datasets calculated using (8). The SBF parameters for the MESSIDOR and INSPIRE-AVR datasets, calculated using (α), are shown in Table 4
                        .

The original ONHSD dataset has 99 images. Similar to [8,4], we excluded the images with no discernible OD or with severe enough cataracts to prevent meaningful segmentation, leaving a final set of 90 images for assessing the SBF method. The size of the images in this dataset is equal to the reference size. Therefore the scale factor for ONHSD images is equal to 1 and there is no need to apply the high-resolution SBF. For this reason, after getting the result from the low-resolution SBF, the boundary was extracted as mentioned in Section 2.4.2. After finalizing the OD shape using the smoothing algorithm, the results were compared with those of the Circular Hough Transform (CHT) [4], Morphology-based method (MBM) [16], Temporal Lock, Simple and DV-Hough methods [8].

In this dataset four clinicians marked 24 boundary points (at 15° angles), and the mean and the radial standard deviations of these values were calculated. For comparing our results with those of the other methods, we have used the same subjective evaluation method defined by Lowell et al. [8]. The discrepancy, δ
                        
                           j
                         on image j is defined by
                           
                              (18)
                              
                                 
                                    
                                       δ
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       |
                                       
                                          
                                             
                                                m
                                             
                                             
                                                i
                                             
                                             
                                                j
                                             
                                          
                                          −
                                          
                                             
                                                μ
                                             
                                             
                                                i
                                             
                                             
                                                j
                                             
                                          
                                       
                                       |
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             i
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       ϵ
                                    
                                 
                              
                           
                        where μ
                        
                           i
                        
                        
                           j
                         and σ
                        
                           i
                        
                        
                           j
                         are, respectively, the mean and the standard deviation of values obtained by four clinicians on spoke i of image j, m
                        
                           i
                        
                        
                           j
                         is the location of the boundary using the segmentation method on spoke i of image j, and ϵ is a small factor to prevent division by zero when the clinicians are in exact agreement and was set equal to 0.5.

Lowell et al. also classified each image based on the discrepancy value as Excellent (
                           
                              
                                 δ
                              
                              
                                 j
                              
                           
                           <
                           1
                        ), Good (
                           
                              
                                 δ
                              
                              
                                 j
                              
                           
                           <
                           2
                        ), Fair (
                           
                              
                                 δ
                              
                              
                                 j
                              
                           
                           <
                           5
                        ), and Poor (
                           
                              
                                 δ
                              
                              
                                 j
                              
                           
                           ≥
                           5
                        ). The segmentation methods are assessed considering the percentage of OD segmentations classified into those four categories. Table 5
                         shows the percentage of images per subjective category for different methods. The results of the proposed method are included in the first row and the second row presents the results of the Circular Hough Transform method [4]. The MBM [16], Temporal Lock, Simple and DV-Hough methods [8] are also included in this table.

In order to be able to compare with other published works, other measures were calculated: Dice׳s coefficient (DC) which describes the similarity degree between two regions; Accuracy (ACC) which is calculated by the sum of correctly detected OD pixels and non-OD pixels divided by the total number of pixels; true positive fraction (TPF) is obtained by dividing the number of correctly detected OD pixels by the total number of OD pixels in the reference image; false positive fraction (FPF) which is the ratio between the number of wrong detected OD pixels and the total number of non-OD pixels in the reference image; the mean absolute distance (MAD) which measures the accuracy of the OD boundary; and finally, Matthews correlation coefficient (MCC) which shows the quality of binary classifications by considering the different cardinalities of the two classes. Table 6
                         compares the result of our method with the results of MBM [16] on the ONHSD.

As we can see in Tables 5 and 6, the proposed method outperforms all the others, thus demonstrating that the method is adequate for low-resolution images. This gives us some confidence in evaluating our approach in two other independent datasets, the MESSIDOR and INSPIRE-AVR datasets. Some results of the proposed OD segmentation method on images of ONHSD dataset are shown in Fig. 7
                        .

The proposed method was used for segmenting the OD in the 1200 images of the MESSIDOR dataset. The parameters of the high-resolution SBF that were set based on the calculated scale factor (α) are shown in the first three rows of Table 4. In order to compare our result with those of the methods [4,12,18], we use the overlapping score (S) that measures the common area between the OD region obtained using the automatic method (A) and the region delimited by experts (E) in [33], being defined by
                           
                              (19)
                              
                                 S
                                 =
                                 
                                    
                                       Area
                                       (
                                       
                                          A
                                          ∩
                                          E
                                       
                                       )
                                    
                                    
                                       Area
                                       (
                                       
                                          A
                                          ∪
                                          E
                                       
                                       )
                                    
                                 
                              
                           
                        
                     

The percentage of images for different intervals of the overlapping score, and the average of overlapping for all 1200 images are shown in Table 7
                        . The table includes the values for the SBF-based method, the multiresolution ellipse fitting (MEF) [7], the superpixel classification (SPC) approach proposed by Cheng et al. [18] and the CHT method [4]. The last row in this table presents the average overlapping score for the fast and hybrid level set model (F-HLSM) method proposed by Yu et al. [12]. As shown in this table, the overlapping between the manually segmented OD region and SBF-based method is always higher than the ones for the other methods, reaching an average overlapping score of 0.89 for the whole set of images in this dataset. Fig. 8
                         shows some segmentation samples obtained with the proposed methodology.

The comparison between the result of our method and the results of MBM [16] on the MESSIDOR dataset is shown in Table 8
                        . The ratio between MAD and the estimated OD radius (r
                        
                           OD
                        ) is used by Yu et al. [12] for evaluating the F-HLSM method. In order to measure this ratio, the authors estimated the OD radii equal to 70, 100 and 110 pixels for the images of MESSIDOR datasets with different sizes. Table 9
                         shows the percentage of images in four subjective categories (Excellent, Good, Moderate and Fair), which are defined based on the ratio between MAD and estimated OD radius. As we can see in the second row of this table, the MAD value is not larger than one-tenth of the OD radius for 76% of 1200 images. The average of MAD is 8% of the OD radius, which is less than 10.1% reported by [12].

In the MESSIDOR datasets, there are several images from patients affected by diabetic retinopathy (DR) and macular edema (ME). These conditions can cause exudates with intensity similar to OD and peripapillary atrophy which can distort the result of OD segmentation. This dataset contains information regarding DR and risk of ME grading. The retinopathy grades (Normal, D1, D2 and D3) are obtained based on the number of microaneurysms, hemorrhages and neovascularization. The risk of macular edema is graded as Normal and two risk levels measuring the shortest distance between macula and hard exudates. The shortest distance between macula and hard exudates has been used for grading the risk of macular edema as Normal, R1 and R2. Table 10
                         shows the average and the standard deviation of the overlapping score (S) for the images with different DR and ME grades. As we can see in this table, there is no significant difference between the average of overlapping scores, which demonstrates the robustness of the SBF-based method in the presence of diabetic retinopathy and risk of macular edema. Fig. 9
                         shows examples of the SBF-based results in the mentioned pathological conditions.

The good performance of the proposed method on the large number of images with different characteristics of the MESSIDOR dataset demonstrates the robustness of this method to illumination and contrast variations. Fig. 10
                         shows the results of OD segmentation in different contrast and illumination conditions.

It should be noted that the initial OD detection method, described in Section 2.2, failed in three images of the MESSIDOR dataset where the OD was located outside of the OD boundary in the standard reference as shown in Fig. 11
                        . In two of these images, the proposed algorithm failed to segment the OD correctly since the initial OD location is far from the actual ODC (Fig. 11(a) and (b)). In the third image, the algorithm overcame the initial OD localization failure and segmented the OD correctly (Fig. 11(c)).

In this dataset, the success rate of initial OD localization was 99.75% while we have now achieved a success rate of 99.83% for the OD detection in both low-resolution and high-resolution phases. This success rate is similar to the one for the MEF method and is higher than the ones for F-HLSM and CHT methods which are 99.08% and 98.83%, respectively.

The proposed algorithm was implemented in MATLAB on an Intel CPU i7-2600k, 3.40GHz, 8GB RAM computer. The average running time was 10.6s per image in the MESSIDOR dataset, while the running times for the CHT, MEF, SPC and F-HLSM methods on the same dataset were 7.36s, 8s, 10.9s and 11.3s, respectively.

In order to evaluate the performance of our approach on high resolution images and different FOV (30°), the proposed method was also evaluated on the 40 images of INSPIRE-AVR dataset. For segmenting the OD, the parameters of the high-resolution SBF were set based on the last row of Table 4. The performance of the SBF-based method is in Table 11
                        . An average overlapping score of 85% was achieved for the whole dataset, while the mean MAD value was less than 9% of the OD radius. Some images depicting the manual ground-truth and the result of the SBF-based segmentation are shown in Fig. 12
                        .

@&#CONCLUSION@&#

The segmentation of the optic disc in retinal images is essential for the automated assessment of vascular changes. In previous sections, we have described a new automatic methodology for OD segmentation that is distinct from previous approaches. This method uses the SBF in two different phases. In the first one, a low-resolution SBF is applied to the downsampled images in order to obtain an initial estimation of the ODC location, whose position is used for establishing the ROI for the high-resolution SBF in the following phase. The parameters of high-resolution SBF are adapted to the image size and camera field of view. The maximum response of the SBF gives the band support points that are used for an initial delineation of the OD boundary, which is afterwards smoothed using a robust local regression algorithm.

The proposed method outperforms recently published approaches for OD segmentation. The promising results on the images of three different datasets prove the independence of this approach from changes in image characteristics such as size, quality and camera field of view.

None Declared.

@&#ACKNOWLEDGEMENT@&#

The authors would like to thank the authors of ONHSD, MESSIDOR and INSPIRE-AVR datasets for making their retinal image datasets publicly available, and Pedro Quelhas for sharing the codes for local convergence filters [35]. This work was supported by FEDER funds through the Programa Operacional Factores de Competitividade-COMPETE and by Portuguese funds through FCT-Fundação para a Ciência e a Tecnologia in the framework of the project PEst-C/SAU/LA0002/2013 and the research grant SFRH /BD/73376/2010.

@&#REFERENCES@&#

