@&#MAIN-TITLE@&#Adaptive registration of magnetic resonance images based on a viscous fluid model

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A new non-rigid registration algorithm based on a viscous fluid model is proposed.


                        
                        
                           
                           Unlike the traditional fluid registration methods, the proposed model is governed by the nonlinear Navier–Stokes partial differential equation (PDE) that varies in both temporal and spatial domains.


                        
                        
                           
                           An adaptive scheme of using the mutual information is introduced to guide the evolution of the process.


                        
                        
                           
                           As consistent with the theory of the viscous fluid model, we found that our method faithfully transformed the template images into the reference images based on the intensity flow.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Non-rigid registration

Incompressible fluid flow

Mutual information

MRI

@&#ABSTRACT@&#


               
               
                  This paper develops a new viscous fluid registration algorithm that makes use of a closed incompressible viscous fluid model associated with mutual information. In our approach, we treat the image pixels as the fluid elements of a viscous fluid governed by the nonlinear Navier–Stokes partial differential equation (PDE) that varies in both temporal and spatial domains. We replace the pressure term with an image-based body force to guide the transformation that is weighted by the mutual information between the template and reference images. A computationally efficient algorithm with staggered grids is introduced to obtain stable solutions of this modified PDE for transformation. The registration process of updating the body force, the velocity and deformation fields is repeated until the mutual information reaches a prescribed threshold. We have evaluated this new algorithm in a number of synthetic and medical images. As consistent with the theory of the viscous fluid model, we found that our method faithfully transformed the template images into the reference images based on the intensity flow. Experimental results indicated that the proposed scheme achieved stable registrations and accurate transformations, which is of potential in large-scale medical image deformation applications.
               
            

@&#INTRODUCTION@&#

Image registration is one of the fundamental and essential tasks within image processing and analysis. It is the process of determining the correspondence between structures in two images, which are respectively called the template (source) image and the reference (target) image. The challenge of registration is to find an optimal geometric transformation between corresponding image data. In other words, given a reference image and a template image, the goal is to find a suitable transformation such that the transformed template image becomes similar or even identical to the reference image. Recently, there is an increasing need for the registration of medical images, for example, magnetic resonance (MR) images, in many research and clinical applications such as diagnosis, therapy and surgery planning, and tracking of physical deformations (e.g., tumor growth, brain atrophy) [1–4]. In essence, the intention is to match two or more images that depict the same anatomical structures at different times or from different subjects or from different imaging modalities.

A number of registration methods based on different physical theories and mathematical formulas have been proposed [3,5–12]. Transformations of maintaining distances between all pixels in images are referred to as rigid-body transformations that are based on coordinate changing by translation and rotation. In contrast, non-rigid transformations map straight lines into curves in such a way as to determine the transformation function of an object between two images. Non-rigid methods are often used to handle large scale and complicated deformations such as the registration of medical images [13]. In general, non-rigid transformation models can be broadly divided into two major categories: physical based models and function representations [13,14]. In particular, the physical models are derived from the theory of continuum mechanics and can be divided into three main subcategories: optical flow, linear elasticity, and fluid flow [13].

Optical flow methods have been used to find small scale deformations in temporal sequences of images. The basic assumption of optical flows is based on the principle of intensity conservation between image frames. For image registration, the motion equation of optical flows is numerically approximated to achieve stable transformations for the guidance of the displacement, e.g., the demons algorithm [15]. Furthermore, Gaussian convolution is introduced to smooth the displacement map to reduce the influences of noise. A disadvantage of this model is that there is no constraint on the displacement field and the template image is resampled at each iteration [13,16]. Subsequently, Wang et al. [17] accelerated the demons algorithm [15] by introducing an active force along with an adaptive force strength adjustment during the iterative process. Noticeable improvements on the computation speed and a higher tolerance of large organ deformations were achieved using this method.

The basic idea underlining linear elasticity is based on (a) stress, which is the contact force per unit area acting on orthogonal planes, and (b) strain, which is a measure of the amount of deformation. Considering a linearly elastic material in force equilibrium and assuming that the stress components vary linearly across an infinitesimal element, it can be shown that the stress tensor is symmetric and the number of independent stress components can be reduced to six [18]. For a homogeneous isotropic material the stress–strain relationship can be simplified to the Piola–Kirchoff form, from which we obtain the Navier–Cauchy linear elastic partial differential equation (PDE) as follows:
                        
                           (1)
                           
                              
                                 μ
                                 
                                    ∇
                                    2
                                 
                                 
                                    d
                                    ⇀
                                 
                                 +
                                 (
                                 μ
                                 +
                                 λ
                                 )
                                 ∇
                                 (
                                 ∇
                                 ⋅
                                 
                                    d
                                    ⇀
                                 
                                 )
                                 +
                                 
                                    f
                                    ⇀
                                 
                                 =
                                 0
                                 ,
                              
                           
                        
                     where μ and λ are the Lamé constants, 
                        
                           d
                           ⇀
                        
                      represents the displacement, ∇2
                     =∇·∇, ∇ is the gradient operator, and 
                        
                           f
                           ⇀
                        
                      denotes the body force per unit volume, which drives registration. Eq. (1) is the governing transformation equation for linear elastic registration that is only accurate for small deformations [13,18]. For larger deformations, elastic displacements do not reach the desired transformation because the deformation is a compromise between internal and external forces [19].

Fluid registration is of particular importance in medical image analysis, as it can be used to localize regions of anatomical change in longitudinal studies and accommodate large deformations while maintaining a diffeomorphism [20–22]. A diffeomorphism is a globally one-to-one smoothing and continuous transformation with differential derivatives that are invertible [23]. Generally speaking, viscous fluid registration methods require the solutions to large sets of PDEs and continuum mechanics provides the theoretical foundation for fluid flow registration. Fluid flow models are based on physical properties of fluids that follow Newtonian mechanics and must satisfy physical laws such as the conservation of linear momentum that leads to the equation of motion. For a Newtonian fluid the viscous stress tensor is linearly related to the rate of the deformation tensor. By assuming Stokes flow (low Reynolds number) and only a small spatial variation in the hydrostatic pressure, we obtain the simplified Navier–Stokes equation for a viscous fluid as [13,18,24]
                     
                        
                           (2)
                           
                              
                                 
                                    μ
                                    f
                                 
                                 
                                    ∇
                                    2
                                 
                                 
                                    V
                                    ⇀
                                 
                                 +
                                 (
                                 
                                    μ
                                    f
                                 
                                 +
                                 
                                    λ
                                    f
                                 
                                 )
                                 ∇
                                 (
                                 ∇
                                 ⋅
                                 
                                    ∇
                                    ⇀
                                 
                                 )
                                 +
                                 
                                    f
                                    ⇀
                                 
                                 =
                                 0
                                 ,
                              
                           
                        
                     where μ
                     
                        f
                      and λ
                     
                        f
                      are the viscosity coefficients of the fluid, 
                        
                           V
                           ⇀
                        
                      represents the velocity vector, the term 
                        
                           
                              μ
                              f
                           
                           
                              ∇
                              2
                           
                           
                              V
                              ⇀
                           
                        
                      indicates constant volume or incompressible viscous flow and the 
                        
                           (
                           
                              μ
                              f
                           
                           +
                           
                              λ
                              f
                           
                           )
                           ∇
                           (
                           ∇
                           ⋅
                           
                              ∇
                              ⇀
                           
                           )
                        
                      term controls expansion or contraction of the fluid. Note that the Navier–Stokes PDE (2) is equivalent to the Navier–Cauchy linear elastic PDE (1) with the variable velocity 
                        
                           V
                           ⇀
                        
                      replaced by displacement 
                        
                           d
                           ⇀
                        
                     .

This viscous fluid model of the dynamical PDE (2) was proposed by Christensen et al. [24,25] to allow large magnitude deformations. In their approach, image pixels are regarded as viscous fluid particles that are governed by the PDEs, which constrain the movement during the registration process. To numerically solve the PDEs, the authors used conventional finite difference techniques associated with the successive over-relaxation (SOR) scheme. A regridding procedure is required when the nonlinear transformations evaluated on a finite lattice become singular. Subsequently, Freeborough and Fox [26] adopted a full multi-grid (FMG) framework along with the SOR for the coarse solution to match a set of Alzheimer disease (AD) images. Crum et al. [27] used semi-coarsening and exploited the inherent multi-resolution nature of FMG to implement a multi-scale approach. Xu and Dony [2] used the least mean square inverse filter to solve the PDEs of the viscous fluid model [24]. D’Agostino et al. [28] adopted a multimodal viscous fluid model registration algorithm based on maximization of mutual information. Rong et al. [29] presented a fast registration method by combining the traditional viscous fluid model with B-spline and fast Fourier transformation to accelerate the computation.

Motivated by the success of the existing viscous fluid models and mutual information frameworks [1,4,10,26–30], we propose a variational registration algorithm based on the theory of fundamental fluid mechanics. The ambition of this paper is in an attempt to develop an adaptive image registration algorithm that makes use of a closed incompressible viscous fluid model associated with mutual information. Unlike the existing fluid registration methods, the governing equation of the proposed framework is based on the temporally and spatially variant Navier–Stokes PDE. For registration, the pressure term is replaced with a body force that computes the intensity differences between the template image and the reference image to drive the flow. To adaptively control the evolution and to accelerate the process, the body force is associated with mutual information, which is an entropy function of the similarity between the two images. A computationally efficient technique that decomposes the governing PDE into two components in 2-D is proposed to compute the flow velocity at each pixel, which iteratively transforms the template image into the reference image. We will demonstrate the effectiveness of this new algorithm on a wide variety of monomodal MR images and compare the results with state-of-the-art methods.

The remainder of the paper is organized as follows. Section 2 describes the proposed viscous fluid registration algorithm in both theoretical foundation and numerical implementation. In Section 3, we describe the evaluation of coefficients and present the registration results of representative MR images. Finally, in Section 4, we discuss the characteristics of this new framework and the associated results followed by conclusions.

We start by considering the Navier–Stokes equations for a viscous incompressible fluid in 2-D as stated in the following formulas [31]
                        
                           
                              (3)
                              
                                 
                                    
                                       
                                          ∂
                                          u
                                          (
                                          x
                                          ,
                                          t
                                          )
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    +
                                    (
                                    u
                                    (
                                    x
                                    ,
                                    t
                                    )
                                    ⋅
                                    ∇
                                    )
                                    u
                                    (
                                    x
                                    ,
                                    t
                                    )
                                    =
                                    −
                                    ∇
                                    p
                                    +
                                    
                                       1
                                       
                                          
                                             Re
                                          
                                       
                                    
                                    
                                       Δ
                                    
                                    u
                                    (
                                    x
                                    ,
                                    t
                                    )
                                    ,
                                 
                              
                           
                        
                        
                           
                              (4)
                              
                                 
                                    d
                                    i
                                    v
                                     
                                    
                                       u
                                    
                                    (
                                    
                                       x
                                    
                                    ,
                                    t
                                    )
                                    =
                                    ∇
                                    ⋅
                                    
                                       u
                                    
                                    (
                                    
                                       x
                                    
                                    ,
                                    t
                                    )
                                    =
                                    0
                                    ,
                                 
                              
                           
                        
                     

where u is the divergence-free velocity vector at position x and time t, Re is the Reynolds number, p represents pressure that is the Lagrange multiplier for the constraint in Eq. (4), and Δ represents the Laplace operator. Unlike the Navier–Stokes equation in Eq. (2), Eq. (3) is a variant PDE in both temporal and spatial domains driven by the gradient of the pressure −∇
                        p. For image registration, we replace this term with a body force and rewrite Eq. (3) as
                           
                              (5)
                              
                                 
                                    
                                       
                                          ∂
                                          
                                             u
                                          
                                          (
                                          
                                             x
                                          
                                          ,
                                          t
                                          )
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    +
                                    (
                                    
                                       u
                                    
                                    (
                                    
                                       x
                                    
                                    ,
                                    t
                                    )
                                    ⋅
                                    ∇
                                    )
                                    
                                       u
                                    
                                    (
                                    
                                       x
                                    
                                    ,
                                    t
                                    )
                                    =
                                    −
                                    
                                       F
                                    
                                    +
                                    
                                       1
                                       
                                          R
                                          e
                                       
                                    
                                    
                                       Δ
                                    
                                    
                                       u
                                    
                                    (
                                    
                                       x
                                    
                                    ,
                                    t
                                    )
                                    ,
                                 
                              
                           
                        where 
                           F
                         is the body force related to image transformation that is defined as
                           
                              (6)
                              
                                 
                                    
                                       F
                                    
                                    =
                                    α
                                    (
                                    T
                                    (
                                    
                                       x
                                    
                                    −
                                    
                                       d
                                    
                                    )
                                    −
                                    R
                                    (
                                    
                                       x
                                    
                                    )
                                    )
                                    ∇
                                    T
                                    (
                                    
                                       x
                                    
                                    −
                                    
                                       d
                                    
                                    )
                                    ,
                                 
                              
                           
                        
                     

where T represents the template image, R represents the reference image, T(x
                        −
                        d)−
                        R(x) is the intensity difference between T and R, d is the deformation,
                           
                              (7)
                              
                                 
                                    
                                       d
                                    
                                    =
                                    ∫
                                    
                                       
                                          u
                                       
                                       (
                                       
                                          x
                                       
                                       ,
                                       t
                                       )
                                       d
                                       t
                                       .
                                    
                                 
                              
                           
                        
                     

In Eq. (6), the gradient of the template image ∇T(x
                        −
                        d) gives the direction of local forces exerted on T and α is a weight for controlling the magnitude of the driving force using
                           
                              (8)
                              
                                 
                                    α
                                    =
                                    log
                                    
                                       
                                          M
                                          I
                                          (
                                          R
                                          ,
                                          R
                                          )
                                       
                                       
                                          M
                                          I
                                          (
                                          T
                                          ,
                                          R
                                          )
                                       
                                    
                                    ,
                                 
                              
                           
                        
                     

where MI(R,R) represents the self-mutual information [28,32] of the reference image R and MI(T,R) represents the mutual information between the template image T and the reference image R, which is defined in Appendix. The mutual information introduced in Eq. (8) in the weighting function α is used to measure the correspondence between the template image T and the reference image R with the normalization of MI(R,R). At the beginning of registration, MI(T,R) is quite small and α is large that gives a strong body force to drive the flow with large deformations. However, when the template image T is getting similar with the reference image R, MI(T,R) is larger and the value of α becomes smaller that results in small deformations and finally stops the registration process when α is approaching zero and below a prescribed threshold.

We assume that the simulation is a closed 2-D flow in a rectangular domain Ω
                        =[0, l
                        
                           x
                        ]×[0, l
                        
                           y
                        ], where l
                        
                           x
                         and l
                        
                           y
                         represent the dimension of the flow domain that corresponds to the image under registration. As illustrated in Fig. 1(a), the four boundaries are denoted as 
                           E
                        , 
                           S
                        , 
                           W
                        , 
                           N
                         that are time invariant and nonslip on each wall, i.e.,
                           
                              (9)
                              
                                 
                                    u
                                    (
                                    x
                                    ,
                                    
                                       l
                                       y
                                    
                                    )
                                    =
                                    
                                       u
                                       N
                                    
                                    (
                                    x
                                    )
                                    ,
                                     
                                    v
                                    (
                                    x
                                    ,
                                    
                                       l
                                       y
                                    
                                    )
                                    =
                                    0
                                    ,
                                 
                              
                           
                        
                        
                           
                              (10)
                              
                                 
                                    u
                                    (
                                    x
                                    ,
                                    0
                                    )
                                    =
                                    
                                       u
                                       S
                                    
                                    (
                                    x
                                    )
                                    ,
                                     
                                    v
                                    (
                                    x
                                    ,
                                    0
                                    )
                                    =
                                    0
                                    ,
                                 
                              
                           
                        
                        
                           
                              (11)
                              
                                 
                                    u
                                    (
                                    0
                                    ,
                                    y
                                    )
                                    =
                                    0
                                    ,
                                     
                                    v
                                    (
                                    0
                                    ,
                                    y
                                    )
                                    =
                                    
                                       v
                                       W
                                    
                                    (
                                    y
                                    )
                                    ,
                                 
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    u
                                    (
                                    
                                       l
                                       x
                                    
                                    ,
                                    y
                                    )
                                    =
                                    0
                                    ,
                                     
                                    v
                                    (
                                    
                                       l
                                       x
                                    
                                    ,
                                    y
                                    )
                                    =
                                    
                                       v
                                       E
                                    
                                    (
                                    y
                                    )
                                    ,
                                 
                              
                           
                        where u(x,y) and v(x,y) represent the velocity components of 
                           u
                         in the x- and y-axis, respectively, and u
                        
                           N
                        (x), u
                        
                           S
                        (x), v
                        
                           W
                        (y), v
                        
                           E
                        (y) represent the nonslip velocity on the four walls.

The nonlinear term (
                           u
                        (
                           x
                        , t)·∇)
                           u
                        (
                           x
                        , t) in Eq. (5) comes from the movement of the fluid and also has two components in 2-D
                           
                              (13)
                              
                                 
                                    (
                                    
                                       u
                                    
                                    ⋅
                                    ∇
                                    )
                                    
                                       u
                                    
                                    =
                                    
                                       
                                          u
                                          
                                             ∂
                                             
                                                ∂
                                                x
                                             
                                          
                                          +
                                          v
                                          
                                             ∂
                                             
                                                ∂
                                                y
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   u
                                                
                                             
                                             
                                                
                                                   v
                                                
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      u
                                                      
                                                         u
                                                         x
                                                      
                                                      +
                                                      v
                                                      
                                                         u
                                                         y
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      u
                                                      
                                                         v
                                                         x
                                                      
                                                      +
                                                      v
                                                      
                                                         v
                                                         y
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

Further applying the zero divergence condition in Eq. (4) with 
                           
                              
                                 u
                                 x
                              
                              =
                              −
                              
                                 v
                                 y
                              
                           
                         gives us neater equations of Eq. (13) as
                           
                              (14)
                              
                                 
                                    
                                       
                                          
                                             
                                                u
                                                
                                                   u
                                                   x
                                                
                                                +
                                                v
                                                
                                                   u
                                                   y
                                                
                                                =
                                                u
                                                
                                                   u
                                                   x
                                                
                                                +
                                                
                                                   
                                                      (
                                                      u
                                                      v
                                                      )
                                                   
                                                   y
                                                
                                                +
                                                u
                                                
                                                   u
                                                   x
                                                
                                                =
                                                
                                                   
                                                      (
                                                      
                                                         u
                                                         2
                                                      
                                                      )
                                                   
                                                   x
                                                
                                                +
                                                
                                                   
                                                      (
                                                      u
                                                      v
                                                      )
                                                   
                                                   y
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                u
                                                
                                                   v
                                                   x
                                                
                                                +
                                                v
                                                
                                                   v
                                                   y
                                                
                                                =
                                                v
                                                
                                                   v
                                                   y
                                                
                                                +
                                                
                                                   
                                                      (
                                                      u
                                                      v
                                                      )
                                                   
                                                   x
                                                
                                                +
                                                v
                                                
                                                   v
                                                   y
                                                
                                                =
                                                
                                                   
                                                      (
                                                      
                                                         v
                                                         2
                                                      
                                                      )
                                                   
                                                   y
                                                
                                                +
                                                
                                                   
                                                      (
                                                      u
                                                      v
                                                      )
                                                   
                                                   x
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The governing registration equation in Eq. (5) can now be decomposed into both x and y directions ready for finite differences:
                           
                              (15)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   u
                                                   t
                                                
                                                +
                                                
                                                   f
                                                   x
                                                
                                                =
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         u
                                                         2
                                                      
                                                      )
                                                   
                                                   x
                                                
                                                −
                                                
                                                   
                                                      (
                                                      u
                                                      v
                                                      )
                                                   
                                                   y
                                                
                                                +
                                                
                                                   1
                                                   
                                                      
                                                         Re
                                                      
                                                   
                                                
                                                (
                                                
                                                   u
                                                   
                                                      x
                                                      x
                                                   
                                                
                                                +
                                                
                                                   u
                                                   
                                                      y
                                                      y
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   v
                                                   t
                                                
                                                +
                                                
                                                   f
                                                   y
                                                
                                                =
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         v
                                                         2
                                                      
                                                      )
                                                   
                                                   y
                                                
                                                −
                                                
                                                   
                                                      (
                                                      u
                                                      v
                                                      )
                                                   
                                                   x
                                                
                                                +
                                                
                                                   1
                                                   
                                                      
                                                         Re
                                                      
                                                   
                                                
                                                (
                                                
                                                   v
                                                   
                                                      x
                                                      x
                                                   
                                                
                                                +
                                                
                                                   v
                                                   
                                                      y
                                                      y
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where 
                           
                              −
                              
                                 
                                    (
                                    
                                       u
                                       2
                                    
                                    )
                                 
                                 x
                              
                              −
                              
                                 
                                    (
                                    u
                                    v
                                    )
                                 
                                 y
                              
                           
                         and 
                           
                              −
                              
                                 
                                    (
                                    
                                       v
                                       2
                                    
                                    )
                                 
                                 y
                              
                              −
                              
                                 
                                    (
                                    u
                                    v
                                    )
                                 
                                 x
                              
                           
                         are the inertia or convection term, 1/Re(u
                        
                           xx
                        
                        +
                        u
                        
                           yy
                        ) and 
                           
                              1
                              /
                              R
                              e
                              (
                              
                                 v
                                 
                                    x
                                    x
                                 
                              
                              +
                              
                                 v
                                 
                                    y
                                    y
                                 
                              
                              )
                           
                         are the diffusion or dissipation term, f
                        
                           x
                         and f
                        
                           y
                         represent the body force 
                           F
                         in the x- and y-axis, respectively.

A simple and effective Navier–Stokes solver separates the computation into three major pieces: (a) convection term (
                           u
                        
                        ·∇)
                           u
                         is treated explicit, (b) diffusion term Δ
                           u
                         is treated implicit, and (c) body force correction leads to final solutions [33,34]. Assume that continuity condition 
                           
                              d
                              i
                              v
                               
                              
                                 u
                              
                              =
                              0
                           
                         is satisfied and we have the velocity fields u
                        
                           n
                         and v
                        
                           n
                         at the nth time step, the velocity fields u
                        
                           n+1 and v
                        
                           n+1 at the (n
                        +1)th time step are then obtained based on the following techniques. This splitting method first creates a velocity vector 
                           u
                        * from 
                           u
                        
                        
                           n
                         at beginning of the step by introducing a Courant–Friedrich–Levy (CFL) condition to the nonlinear terms as [33]
                        
                           
                              (16)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         u
                                                         *
                                                      
                                                      −
                                                      
                                                         u
                                                         n
                                                      
                                                   
                                                   
                                                      
                                                         Δ
                                                      
                                                      t
                                                   
                                                
                                                =
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            (
                                                            
                                                               u
                                                               n
                                                            
                                                            )
                                                         
                                                         2
                                                      
                                                      )
                                                   
                                                   x
                                                
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         u
                                                         n
                                                      
                                                      
                                                         v
                                                         n
                                                      
                                                      )
                                                   
                                                   y
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                         *
                                                      
                                                      −
                                                      
                                                         v
                                                         n
                                                      
                                                   
                                                   
                                                      
                                                         Δ
                                                      
                                                      t
                                                   
                                                
                                                =
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            (
                                                            
                                                               v
                                                               n
                                                            
                                                            )
                                                         
                                                         2
                                                      
                                                      )
                                                   
                                                   y
                                                
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         u
                                                         n
                                                      
                                                      
                                                         v
                                                         n
                                                      
                                                      )
                                                   
                                                   x
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where Δt is the time step. The viscosity terms are then treated implicitly to avoid the limitation of spatial discretization as
                           
                              (17)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            *
                                                            *
                                                         
                                                      
                                                      −
                                                      
                                                         u
                                                         *
                                                      
                                                   
                                                   
                                                      
                                                         Δ
                                                      
                                                      t
                                                   
                                                
                                                =
                                                
                                                   1
                                                   
                                                      
                                                         Re
                                                      
                                                   
                                                
                                                (
                                                
                                                   u
                                                   
                                                      x
                                                      x
                                                   
                                                   
                                                      *
                                                      *
                                                   
                                                
                                                +
                                                
                                                   u
                                                   
                                                      y
                                                      y
                                                   
                                                   
                                                      *
                                                      *
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                         
                                                            *
                                                            *
                                                         
                                                      
                                                      −
                                                      
                                                         v
                                                         *
                                                      
                                                   
                                                   
                                                      
                                                         Δ
                                                      
                                                      t
                                                   
                                                
                                                =
                                                
                                                   1
                                                   
                                                      
                                                         Re
                                                      
                                                   
                                                
                                                (
                                                
                                                   v
                                                   
                                                      x
                                                      x
                                                   
                                                   
                                                      *
                                                      *
                                                   
                                                
                                                +
                                                
                                                   v
                                                   
                                                      y
                                                      y
                                                   
                                                   
                                                      *
                                                      *
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        
                     

The intermediate velocity field 
                           
                              (
                              
                                 u
                                 
                                    *
                                    *
                                 
                              
                              ,
                              
                                 v
                                 
                                    *
                                    *
                                 
                              
                              )
                           
                         is further corrected by the body force to obtain the updated velocity using
                           
                              (18)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            n
                                                            +
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         u
                                                         
                                                            *
                                                            *
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         Δ
                                                      
                                                      t
                                                   
                                                
                                                =
                                                −
                                                
                                                   f
                                                   x
                                                   n
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                         
                                                            n
                                                            +
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         v
                                                         
                                                            *
                                                            *
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         Δ
                                                      
                                                      t
                                                   
                                                
                                                =
                                                −
                                                
                                                   f
                                                   y
                                                   n
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where f
                        
                           x
                        
                        
                           n
                         and f
                        
                           y
                        
                        
                           n
                         are the image body force based on Eq. (6). The displacement d used to deform the template image in Eq. (7) is computed using
                           
                              (19)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         d
                                                         x
                                                      
                                                   
                                                   
                                                      n
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                
                                                   u
                                                   
                                                      n
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   Δ
                                                
                                                t
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         d
                                                         y
                                                      
                                                   
                                                   
                                                      n
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                
                                                   v
                                                   
                                                      n
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   Δ
                                                
                                                t
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where d
                        
                           x
                         and d
                        
                           y
                         are the displacement components in the x- and y-axis, respectively.

Finite differences provide a good approximation of second derivatives in a grid point (i,j) by a centered stencil for the Laplacian computation in Eq. (17) as
                           
                              (20)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Δ
                                                
                                                
                                                   u
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                =
                                                
                                                   
                                                      (
                                                      
                                                         u
                                                         
                                                            x
                                                            x
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                +
                                                
                                                   
                                                      (
                                                      
                                                         u
                                                         
                                                            y
                                                            y
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                =
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            i
                                                            −
                                                            1
                                                            ,
                                                            j
                                                         
                                                      
                                                      −
                                                      2
                                                      
                                                         u
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         u
                                                         
                                                            i
                                                            +
                                                            1
                                                            ,
                                                            j
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               Δ
                                                            
                                                            x
                                                            )
                                                         
                                                         2
                                                      
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            i
                                                            ,
                                                            j
                                                            −
                                                            1
                                                         
                                                      
                                                      −
                                                      2
                                                      
                                                         u
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         u
                                                         
                                                            i
                                                            ,
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               Δ
                                                            
                                                            y
                                                            )
                                                         
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   Δ
                                                
                                                
                                                   v
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                =
                                                
                                                   
                                                      (
                                                      
                                                         v
                                                         
                                                            x
                                                            x
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                +
                                                
                                                   
                                                      (
                                                      
                                                         v
                                                         
                                                            y
                                                            y
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                =
                                                
                                                   
                                                      
                                                         v
                                                         
                                                            i
                                                            −
                                                            1
                                                            ,
                                                            j
                                                         
                                                      
                                                      −
                                                      2
                                                      
                                                         v
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         v
                                                         
                                                            i
                                                            +
                                                            1
                                                            ,
                                                            j
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               Δ
                                                            
                                                            x
                                                            )
                                                         
                                                         2
                                                      
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         v
                                                         
                                                            i
                                                            ,
                                                            j
                                                            −
                                                            1
                                                         
                                                      
                                                      −
                                                      2
                                                      
                                                         v
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         v
                                                         
                                                            i
                                                            ,
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               Δ
                                                            
                                                            y
                                                            )
                                                         
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where Δx and Δy are the grid spacing in the x- and y-axis, respectively. For the first derivatives computation, a centered stencil approximation can yield instabilities and the staggered grids are used instead [33]. Suppose we are not interested in the value of u
                        
                           x
                         in the position of u
                        
                           i,j
                        , but the value in the middle between the points u
                        
                           i+1,j
                         and u
                        
                           i,j
                        . The forward difference approximation,
                           
                              (21)
                              
                                 
                                    
                                       
                                          (
                                          
                                             u
                                             x
                                          
                                          )
                                       
                                       
                                          i
                                          +
                                          (
                                          1
                                          /
                                          2
                                          )
                                          ,
                                          j
                                       
                                    
                                    ≡
                                    
                                       
                                          
                                             u
                                             
                                                i
                                                +
                                                1
                                                ,
                                                j
                                             
                                          
                                          −
                                          
                                             u
                                             
                                                i
                                                ,
                                                j
                                             
                                          
                                       
                                       
                                          
                                             Δ
                                          
                                          x
                                       
                                    
                                    ,
                                 
                              
                           
                        is a stable centered finite difference approximation to u
                        
                           i,j
                         in the middle between the two grids. In the staggered grid, this position corresponds to the position of the body force F
                        
                           i,j
                         as shown in Fig. 1(b). To compute the nonlinear terms in Eq. (16), for example, updating u we requires u
                        2 to be defined in the cell centers and uv to be defined in the cell corners as
                           
                              (22)
                              
                                 
                                    
                                       
                                          (
                                          
                                             u
                                             2
                                          
                                          )
                                       
                                       
                                          i
                                          +
                                          (
                                          1
                                          /
                                          2
                                          )
                                          ,
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         u
                                                         
                                                            i
                                                            +
                                                            1
                                                            ,
                                                            j
                                                         
                                                      
                                                   
                                                   2
                                                
                                             
                                          
                                       
                                       2
                                    
                                    ,
                                 
                              
                           
                        
                        
                           
                              (23)
                              
                                 
                                    
                                       u
                                       
                                          i
                                          ,
                                          j
                                          +
                                          (
                                          1
                                          /
                                          2
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          
                                             u
                                             
                                                i
                                                ,
                                                j
                                             
                                          
                                          +
                                          
                                             u
                                             
                                                i
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                       
                                       2
                                    
                                    ,
                                 
                              
                           
                        
                        
                           
                              (24)
                              
                                 
                                    
                                       v
                                       
                                          i
                                          +
                                          (
                                          1
                                          /
                                          2
                                          )
                                          ,
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          
                                             v
                                             
                                                i
                                                ,
                                                j
                                             
                                          
                                          +
                                          
                                             v
                                             
                                                i
                                                +
                                                1
                                                ,
                                                j
                                             
                                          
                                       
                                       2
                                    
                                    .
                                 
                              
                           
                        
                     

Similarly for updating the component v in Eq. (16), we obtain these quantities using
                           
                              (25)
                              
                                 
                                    
                                       
                                          (
                                          
                                             v
                                             2
                                          
                                          )
                                       
                                       
                                          i
                                          ,
                                          j
                                          +
                                          (
                                          1
                                          /
                                          2
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         v
                                                         
                                                            i
                                                            ,
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                   2
                                                
                                             
                                          
                                       
                                       2
                                    
                                    ,
                                 
                              
                           
                        
                        
                           
                              (26)
                              
                                 
                                    
                                       u
                                       
                                          i
                                          +
                                          (
                                          1
                                          /
                                          2
                                          )
                                          ,
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          
                                             u
                                             
                                                i
                                                ,
                                                j
                                             
                                          
                                          +
                                          
                                             u
                                             
                                                i
                                                +
                                                1
                                                ,
                                                j
                                             
                                          
                                       
                                       2
                                    
                                    ,
                                 
                              
                           
                        
                        
                           
                              (27)
                              
                                 
                                    
                                       v
                                       
                                          i
                                          ,
                                          j
                                          +
                                          (
                                          1
                                          /
                                          2
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          
                                             v
                                             
                                                i
                                                ,
                                                j
                                             
                                          
                                          +
                                          
                                             v
                                             
                                                i
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                       
                                       2
                                    
                                    .
                                 
                              
                           
                        
                     

Obviously, what we do is to create new data between grids by averaging and we can rewrite Eq. (16) for the nonlinear terms as
                           
                              (28)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         u
                                                         *
                                                      
                                                      −
                                                      
                                                         u
                                                         n
                                                      
                                                   
                                                   
                                                      
                                                         Δ
                                                      
                                                      t
                                                   
                                                
                                                =
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  u
                                                                  ¯
                                                               
                                                               h
                                                            
                                                            )
                                                         
                                                         2
                                                      
                                                      )
                                                   
                                                   x
                                                
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         v
                                                      
                                                      
                                                         
                                                            v
                                                            ¯
                                                         
                                                         h
                                                      
                                                      )
                                                   
                                                   y
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                         *
                                                      
                                                      −
                                                      
                                                         v
                                                         n
                                                      
                                                   
                                                   
                                                      
                                                         Δ
                                                      
                                                      t
                                                   
                                                
                                                =
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  v
                                                                  ¯
                                                               
                                                               v
                                                            
                                                            )
                                                         
                                                         2
                                                      
                                                      )
                                                   
                                                   y
                                                
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         v
                                                      
                                                      
                                                         
                                                            v
                                                            ¯
                                                         
                                                         h
                                                      
                                                      )
                                                   
                                                   x
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where an overbar with superscript h represents a horizontally averaged quantity and an overbar with superscript v represents a vertically averaged quantity. Finally, the displacement in Eq. (19) is smoothed by a Gaussian filter to enforce soothing deformations using
                           
                              (29)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      d
                                                      ˜
                                                   
                                                   x
                                                
                                                (
                                                x
                                                ,
                                                y
                                                )
                                                =
                                                G
                                                (
                                                x
                                                ,
                                                y
                                                )
                                                *
                                                
                                                   d
                                                   x
                                                
                                                (
                                                x
                                                ,
                                                y
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      d
                                                      ˜
                                                   
                                                   y
                                                
                                                (
                                                x
                                                ,
                                                y
                                                )
                                                =
                                                G
                                                (
                                                x
                                                ,
                                                y
                                                )
                                                *
                                                
                                                   d
                                                   y
                                                
                                                (
                                                x
                                                ,
                                                y
                                                )
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where 
                           
                              
                                 
                                    d
                                    ˜
                                 
                                 x
                              
                           
                         and 
                           
                              
                                 
                                    d
                                    ˜
                                 
                                 y
                              
                           
                         are the smoothed displacement in the x- and y-axis, respectively, the symbol * represents convolution, and G(x,y) is a Gaussian function defined as
                           
                              (30)
                              
                                 
                                    G
                                    (
                                    x
                                    ,
                                    y
                                    )
                                    =
                                    
                                       1
                                       
                                          σ
                                          
                                             
                                                2
                                                π
                                             
                                          
                                       
                                    
                                    
                                       e
                                       
                                          −
                                          
                                             x
                                             2
                                          
                                          +
                                          
                                             y
                                             2
                                          
                                          /
                                          (
                                          2
                                          
                                             σ
                                             2
                                          
                                          )
                                       
                                    
                                    ,
                                 
                              
                           
                        where σ is the standard deviation used to control the degree of smoothness.

@&#RESULTS@&#

We have applied our algorithm to a wide variety of simulated and MR images. The images were arbitrarily distorted on different anatomical structures to create template images for the experiments. To analyze the performance of the proposed algorithm, the sum of squared difference (SSD) and the correlation coefficient (CC) before and after registration between the template images and the reference images were computed as given in the following equations:
                        
                           (31)
                           
                              
                                 S
                                 S
                                 D
                                 =
                                 
                                    
                                       ∑
                                    
                                    x
                                 
                                 
                                    
                                       ∑
                                    
                                    y
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         A
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                         −
                                                         B
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                          2
                                       
                                    
                                    N
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           (32)
                           
                              
                                 C
                                 C
                                 =
                                 
                                    
                                       ∑
                                       
                                          ∑
                                          
                                             (
                                             A
                                             (
                                             x
                                             ,
                                             y
                                             )
                                             −
                                             
                                                A
                                                ¯
                                             
                                             )
                                          
                                          ∑
                                          
                                             ∑
                                             
                                                (
                                                B
                                                (
                                                x
                                                ,
                                                y
                                                )
                                                −
                                                
                                                   B
                                                   ¯
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                ∑
                                                
                                                   
                                                      
                                                         (
                                                         A
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                         −
                                                         
                                                            A
                                                            ¯
                                                         
                                                         )
                                                      
                                                      2
                                                   
                                                   ∑
                                                   
                                                      ∑
                                                      
                                                         
                                                            
                                                               (
                                                               B
                                                               (
                                                               x
                                                               ,
                                                               y
                                                               )
                                                               −
                                                               
                                                                  B
                                                                  ¯
                                                               
                                                               )
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        
                     where A(x,y) and B(x,y) represent the intensities of images A and B at (x,y), respectively, ||·|| represents the Euclidean norm, N represents the total pixel number, 
                        
                           A
                           ¯
                        
                      and 
                        
                           B
                           ¯
                        
                      represent the average intensities of images A and B, respectively. These two indexes compute the pixel-by-pixel intensity similarity between two images and provide a good measurement for performance evaluation. Both a smaller score of SSD approaching zero and a larger score of CC approaching unity indicate better similarities between the two images.


                     Fig. 2
                      first illustrates the ability of our algorithm in transforming a phantom image of a big oval to a small c-like shape and correcting a distorted chessboard map back to normal. In both cases, the proposed method correctly registered the template images in accordance with the reference images. As presented in Table 1
                     , quantitative analyses using the SSD and CC coefficients indicate accurate registration performance. Fig. 3
                      illustrates the registration of brain MR images with major differences around the lateral ventricles. The template image was faithfully transformed to the reference image with CC=0.9915 as shown in Fig. 3(d). The corresponding displacement field map and deformation grid map are shown in Fig. 3(e) and (f), respectively. The intensity differences between the reference image and the registered image are depicted in Fig. 3(c). Obviously, the overall difference distribution in intensity after the registration was significantly decreased, particularly in the lateral ventricles.


                     Fig. 4
                      shows the evolution of transforming skull-stripped brain MR images from distortion back to normality, which reveals high accuracy with CC=0.9946. The registration ability of knee MR images was studied as illustrated in Fig. 5
                     . These two images have quite different structures in the femur, patella, and tibia tissues. Qualitative analysis demonstrated excellent transformations as shown in Fig. 5(d). The corresponding displacement field map and deformation grid map are shown in Figs. 5(e) and (f), respectively. Quantitative analysis of intensity differences between the reference image and the registered image also reveals significantly overall reductions as depicted in Fig. 5(c). In Figs. 6 and 7
                     
                     , we respectively illustrate the registration using different methods on anatomical structures with large deformations in T1-weighted and T2-weighted MR images, which were obtained from the BrainWeb simulator repository [35]. In Figs. 6(c) and (d), the methods in [15,17] were not able to effectively transform the template image with CC=0.9354 and CC=0.9691, respectively. The proposed method efficiently registered the template image with a much higher CC of 0.9822 as illustrated in Fig. 6(e). In Fig. 7, all methods were somewhat inefficient to transform the highly distorted template image back to the reference image. However, the proposed method is visually more pleasing and with a higher CC of 0.9816 comparing to 0.9758 using [15] and 0.9710 using [17]. Finally, in Fig. 8
                     , we show the registration results of the CC index on a number of central slices in the BrainWeb images. Considerably high CC values with 0.9933±0.0032 and 0.9892±0.0039 were obtained after registration on the T1-weighted MR images in Fig. 8(a) and T2-weighted MR images in Fig. 8(b), respectively.

@&#DISCUSSION AND CONCLUSIONS@&#

Stimulated by the success of existing fluid flow models, we proposed a new registration algorithm based on the incompressible viscous fluid model associated with mutual information. By treating pixels as fluid elements, we replaced the pressure term with the image-based body force to guide the transformation. This force was further weighted by the mutual information between the template and reference images. As described in Section 2.3, a simple numerical technique was introduced to alternatively compute the implicit and explicit flow velocity in the Navier–Stokes PDE with stable solutions. Our governing equation in Eq. (5) varies with respect to both time and space that is fundamentally different from the traditional fluid registration equation (2), which is explicitly related to space only. A computationally expensive algorithm associated with the SOR was used to iteratively solve Eq. (2) that can result in singularity [24]. When this happens, a regridding scheme is needed to reinitialize the nonlinear transformation.

To evaluate the performance of our viscous fluid registration algorithm, we have used a wide variety of synthetic and real MR images. For relatively smaller deformations illustrated in Figs. 3 and 4, the values of SSD were extremely infinitesimal and the scores of CC were exceptionally close to unity as presented in Table 1. For large deformations illustrated in Figs. 2(a), (6), and (7), while the scores of CC were slightly lower than the small deformation cases the values of SSD were still negligible. The displacement field maps and the deformation grid maps illustrated in Figs. 3 and 5 indicate excellent correspondences regarding deformation and intensity differences using the proposed method. Statistical analyses based on the CC values in the T1-weighted and T2-weighted MR images of the BrainWeb dataset in Fig. 8 also suggest accurate, robust, and reliable registration.

For black-and-white images with sharp edges and cusps as illustrated in Fig. 2(b) of the chessboard map, the SSD value was somewhat larger comparing to other cases. This is probably because of the use of Gaussian filtering in smoothing the displacement field that led to slightly blurred images as shown in the right diagram of Fig. 2(b), which is also true for Fig. 2(a). Another reason may be in behalf of the congenital defect of unsharp edges presented in the template image. Nevertheless, for gray-scale medical images such as MRI, strong black-and-white edges usually do not exist due to the partial volume effect and noise influences. Consequently, filtering the displacement with the Gaussian operator is beneficial to smooth deformations and stable solutions. Moreover, owing to the introduction of the mutual information to the driving body force, the deformation rate is highly nonlinear with large displacements for the first several iterations and gradually decreasing displacements in the subsequent iterations toward the end.

The mutual information ratio in Eq. (8) varies with respect to the degree of differences between the reference image and the template image. Fig. 9
                      shows a representative illustration of the mutual information ratio approaching unity when the iteration number is getting larger. As presented in Eq. (17), the Reynolds number and time step compensate each other. In our approach, we set the Reynolds number a constant value of unity and varied the time step to accelerate the registration process. Values of the time step equal to 1 can achieve conservative results and higher values of 2–4 or more can save computation time, depending on the transformation. With Δt
                     =1, the computation time for Figs. 3 and 5 is respectively 17.67s and 32.31s running on an Intel Core i7 2.40GHz CPU machine. For Fig. 6, as our algorithm achieved better results with much more iterations, the computation time is 83.18s comparing to 4.34s of [15] and 18.89s of [17].

In summary, a new viscous fluid model associated with mutual information has been described for adaptive registration. Unlike the traditional fluid flow models, the governing equation of the proposed framework is based on the temporally and spatially variant Navier–Stokes PDE. The pressure term was replaced by an image-based body force weighted by the mutual information between the template image and the reference image. A computationally efficient technique with staggered grids was introduced to obtain stable solutions of this PDE for the transformation. Our registration algorithm was extensively evaluated by a number of phantom, BrainWeb, and real MR images. As consistent with the theory of the proposed viscous fluid model, we found that our method accurately and reliably transformed the template images into the reference images. Experimental results indicated that the proposed scheme achieved stable registrations and accurate transformations, which is of potential in large-scale MR image processing applications.

None declared.

@&#ACKNOWLEDGEMENT@&#

This work was supported by the National Science Council under Research Grant No. NSC100-2320-B-002-073-MY3.

In probability and information theory, entropy is a measure of the uncertainty associated with a random variable given by the following equation:
                        
                           (A1)
                           
                              
                                 H
                                 (
                                 X
                                 )
                                 =
                                 E
                                 (
                                 I
                                 (
                                 X
                                 )
                                 )
                                 =
                                 ∑
                                 
                                    p
                                    (
                                    X
                                    )
                                    log
                                    
                                       
                                          
                                             1
                                             
                                                p
                                                (
                                                X
                                                )
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        
                     where X represents a discrete random variable, I(X) represents the information content of X, E represents the expectation, p(X) represents the probability mass function in terms of X, and H(X) represents the entropy of X. Accordingly, we can compute the entropy of an image by treating the image pixel as a random variable, say, images A and B using
                        
                           (A2)
                           
                              
                                 H
                                 (
                                 A
                                 )
                                 =
                                 −
                                 
                                    ∑
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       L
                                       −
                                       1
                                    
                                 
                                 
                                    p
                                    (
                                    
                                       A
                                       i
                                    
                                    )
                                    log
                                    p
                                    (
                                    
                                       A
                                       i
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           (A3)
                           
                              
                                 H
                                 (
                                 B
                                 )
                                 =
                                 −
                                 
                                    ∑
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       L
                                       −
                                       1
                                    
                                 
                                 
                                    p
                                    (
                                    
                                       B
                                       i
                                    
                                    )
                                    l
                                    o
                                    g
                                    p
                                    (
                                    
                                       B
                                       i
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     where the index i is taken over all grayscales of the images, L is the number of possible intensity levels in the images (e.g., 4096 for a 12-bit image), p(·
                     
                        i
                     ) is the probability of gray level i occurring in the corresponding image, H(A) and H(B) represent the image entropy of A and B, respectively. In addition, the joint entropy H(A,B) of images A and B can be defined as
                        
                           (A4)
                           
                              
                                 H
                                 (
                                 A
                                 ,
                                 B
                                 )
                                 =
                                 
                                    ∑
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       L
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       ∑
                                       
                                          j
                                          =
                                          0
                                       
                                       
                                          L
                                          −
                                          1
                                       
                                    
                                    
                                       p
                                       (
                                       
                                          A
                                          i
                                       
                                       ,
                                       
                                          B
                                          j
                                       
                                       )
                                       l
                                       o
                                       g
                                       p
                                       (
                                       
                                          A
                                          i
                                       
                                       ,
                                       
                                          B
                                          j
                                       
                                       )
                                    
                                 
                                 ,
                              
                           
                        
                     where p(A
                     
                        i
                     , B
                     
                        j
                     ) is the joint intensity probability that represents the probability of these values A
                     
                        i
                      and B
                     
                        j
                      occurring together and p(A
                     
                        i
                     ,B
                     
                        j
                     )logp(A
                     
                        i
                     ,B
                     
                        j
                     ) is defined to be 0 if p(A
                     
                        i
                     ,B
                     
                        j
                     )=0.

With the introduction of the entropy functions, the mutual information between two images A and B is given by [10]
                     
                        
                           (A5)
                           
                              
                                 M
                                 I
                                 (
                                 A
                                 ,
                                 B
                                 )
                                 =
                                 H
                                 (
                                 A
                                 )
                                 +
                                 H
                                 (
                                 B
                                 )
                                 −
                                 H
                                 (
                                 A
                                 ,
                                 B
                                 )
                                 ,
                              
                           
                        
                     where MI(A,B) represents the mutual information of images A and B with H(A), H(B), and H(A,B), and defined in Eqs. (A2), (A3) and (A4), respectively. The mutual information is a quantity that measures the mutual dependence of two random variables [28,30,32], i.e., the intensity distribution correlation between images A and B in our case. When the intensity distributions between two images are greatly intersected, the mutual information is larger, and vice versa [1]. On the other hand, when the intensities of two images are completely independent, the mutual information is zero.

@&#REFERENCES@&#

