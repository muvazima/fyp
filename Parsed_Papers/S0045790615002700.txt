@&#MAIN-TITLE@&#A novel lottery protocol for mobile environments

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           This study proposes a fair and secure protocol allowing users to safely and fairly purchase lottery tickets by smart phone.


                        
                        
                           
                           The proposed lottery protocol can satisfy the fairness, accuracy, and public verification requests in a mobile environment.


                        
                        
                           
                           The proposed protocol can prevent the various malicious attacks discussed above with low computation costs.


                        
                        
                           
                           The proposed protocol can achieve the multi-participants in a mobile environment.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

E-lottery

Fairness

Elliptic curve

Attack

Mutual authentication

@&#ABSTRACT@&#


               
               
                  In general, in order for individuals to take part in a lottery, they must purchase physical lottery tickets from a store. However, due to the popularity and portability of smart phones, this paper proposes a lottery entry purchase protocol for joint multi-participants in a mobile environment. This method integrates cryptology, including elliptic curve cryptography and public key infrastructure, enabling users to safely and fairly join a lottery via a mobile device. The lottery organization involves an untraceable tamperproof decryptor to generate the winning numbers, and the generation of those winning numbers is fair and publicly verifiable. All participants share an equal probability of winning the prize. Subsequently, a comparison table shows that the proposed protocol can withstand attacks and efficiently satisfy the known requirements in a mobile environment. In addition, this study also ensures public verification and mutual authentication.
               
            

@&#INTRODUCTION@&#

Lottery gambling is non-predictable [1–3] and its prizes vary in size. While all participants stand a chance of winning, it is impossible to know which participant will win each lottery. The actual value of the prize will vary, depending on how many people take part in each lottery, and how many winners there are for each draw. This form of gambling thus remains fascinating and exciting for many people. Participants must select several numbers when they purchase each lottery ticket, and the lottery organization (LO) randomly generates the winning number. If the numbers selected by a participant match the randomly selected winning numbers, then they will have won the lottery. Sometimes, however, different participants select the same winning numbers, and in this case the prize money will be shared between them. If the prize is not claimed, the prize will be added to the prize money generated for the next draw, often called “roll-over”. This is an extremely powerful method to entice participant to purchase lottery tickets.

With the rapid growth and development of portable devices (such as the cell phone or PDA) [4–7], mobile commerce has becomes a focal issue. At present, a method for implementing a fair and secure joint purchase e-lottery protocol via a mobile environment has still not been proposed. This study thus reviewed some lottery schemes to propose just such a solution. In 2005, Chow et al. [8] proposed an e-lottery scheme using a verifiable random function. Lee and Chang [9] proposed an electronic t-out-of-n lottery on the Internet in 2009. Even though the winning prize probability is very low [10], the participants can adopt the following two methods to enhance their probability of winning.
                        
                           •
                           The coordinator can join other participants to purchase one lottery ticket if the coordinator and participant just want to spend a small amount of money.

If the coordinator wants to purchase sequential numbers of lottery tickets, the coordinator can invite other participants in order to collect more money.

The previous schemes [9–11] offered a participant lottery purchases on the Internet, but could not support an efficient joint purchase protocol in a mobile environment.

So, the participants had to collect funds and commit a coordinator to purchase many lottery tickets in order to increase the probability of winning the lottery. A fair and joint e-lottery protocol cannot depend on the presupposition that the coordinator can be trusted. The chances for any participant to win the prize must be equal, and that participant must be able to claim his/her own prize. However the important issue is that the participant can be awarded the prize individually, even when the coordinator denies the committed activity. Moreover, this study noted that the elliptic curve is suitable for mobile environments [12,13]. Elliptic curve cryptography (ECC) can use a small key size to achieve the same security level of a discrete logarithm problem (DLP). For example, 160-bit ECC and 1024-bit RSA have the same security level [14]. In 2004, Liaw [15] proposed an untraceable decryptor which can randomly input a selector with memory, and store the input data in a buffer. Furthermore, it can be designed to output data when receiving n records, or at a specific pre-set time. If it receives an enabling signal, the public key decryptor will select a pair of parameters for itself automatically, and the private key cannot be modified because it is stored in the PROM.

In a lottery protocol, one of the fundamental characteristics is that no one can predict or control the outcome. When a lottery is run, participants must believe that the lottery was fair and secure. In addition, a fair and secure joint purchase e-lottery protocol in a mobile environment is also necessary. Therefore, this study proposes the following requirements for a good joint purchase lottery protocol for a mobile environment:
                        
                           •
                           Defend against attacks: The proposed protocol must be secure against known attacks (such as replay attack, man-in-the-middle attack, and impersonation attack).

Anonymity: The coordinator should be anonymous to ensure a fair transaction during the ticket purchase.

Verifiability: All legal lotteries and the generation of the winning numbers must be publicly verifiable.

Fairness: The probability of each participant winning must be the same.

Accuracy: The prize should be rewarded to the real winner/s and genuine proportional prizes allotted.

The remainder of this paper is arranged as follows. Section 2 presents the preliminaries of bilinear pairings and related mathematical assumptions. Section 3 describes the proposed efficient joint purchase protocol. Security analyses of this protocol are presented in Section 4. Section 5 offers discussion of the performance analysis. Conclusions are presented in Section 6.

This section will introduce bilinear pairings and related methodologies. Bilinear pairings are defined on elliptic curves for efficient ID-based cryptosystems [16–20].


                        
                           
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                              
                           
                         is an additive cyclic group with a large prime order q, and 
                           
                              
                                 
                                    G
                                 
                                 
                                    2
                                 
                              
                           
                         is a multiplicative cyclic group with the same order q. 
                           
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                              
                           
                         is a subgroup of the additive group of points on an elliptic curve over a finite field 
                           
                              E
                              (
                              
                                 
                                    F
                                 
                                 
                                    p
                                 
                              
                              )
                           
                        , and 
                           
                              
                                 
                                    G
                                 
                                 
                                    2
                                 
                              
                           
                         is a subgroup of the multiplicative group over a finite field. P is a generator of 
                           
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                              
                           
                        . The detailed descriptions of groups, maps and other parameters are given in [16–20]. A bilinear pairing is a map 
                           
                              e
                              :
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                              
                              ×
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                              
                              →
                              
                                 
                                    G
                                 
                                 
                                    2
                                 
                              
                           
                        , and satisfies the following properties:
                           
                              (1)
                              Bilinear: e(aP,
                                 bQ)=
                                 e
                                 
                                    
                                       
                                          
                                             (
                                             P
                                             ,
                                             Q
                                             )
                                          
                                          
                                             ab
                                          
                                       
                                    
                                  for all 
                                    
                                       P
                                       ,
                                       Q
                                       ∈
                                       
                                          
                                             G
                                          
                                          
                                             1
                                          
                                       
                                    
                                 , and 
                                    
                                       a
                                       ,
                                       b
                                       ∈
                                       
                                          
                                             Z
                                          
                                          
                                             q
                                          
                                          
                                             ∗
                                          
                                       
                                    
                                 .

Non-degenerate: there exists 
                                    
                                       P
                                       ,
                                       Q
                                       ∈
                                       
                                          
                                             G
                                          
                                          
                                             1
                                          
                                       
                                    
                                  such that 
                                    
                                       e
                                       (
                                       P
                                       ,
                                       Q
                                       )
                                       
                                       ≠
                                       
                                    
                                 1.

Computability: For all 
                                    
                                       P
                                       ,
                                       Q
                                       ∈
                                       
                                          
                                             G
                                          
                                          
                                             1
                                          
                                       
                                    
                                 , there is an efficient algorithm to compute 
                                    
                                       e
                                       (
                                       P
                                       ,
                                       Q
                                       )
                                    
                                 .

A bilinear map which satisfies the above three properties is called an admissible bilinear map.

Bilinear pairings have the following problems and assumptions defined on elliptic curves.
                           
                              (1)
                              Decision Diffie-Hellman (DDH) problem: Given xP, yP, 
                                    
                                       zP
                                       ∈
                                       
                                          
                                             G
                                          
                                          
                                             1
                                          
                                       
                                    
                                  for some 
                                    
                                       x
                                       ,
                                       y
                                       ,
                                       z
                                       ∈
                                       
                                          
                                             Z
                                          
                                          
                                             q
                                          
                                          
                                             ∗
                                          
                                       
                                    
                                 , let 
                                    
                                       e
                                       (
                                       xP
                                       ,
                                       yP
                                       )
                                    
                                  and 
                                    
                                       e
                                       (
                                       P
                                       ,
                                       zP
                                       )
                                    
                                 . Hence, the DDH problem is easily addressed in 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             1
                                          
                                       
                                    
                                 .

Computational Diffie-Hellman (CDH) problem: Given P, xP, 
                                    
                                       yP
                                       ∈
                                       
                                          
                                             G
                                          
                                          
                                             1
                                          
                                       
                                    
                                 , it is difficult to compute 
                                    
                                       xyP
                                       ∈
                                       
                                          
                                             G
                                          
                                          
                                             1
                                          
                                       
                                    
                                 ; hence, the CDH problem is difficult to address in 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             1
                                          
                                       
                                    
                                 .

Bilinear Diffie-Hellman (BDH) assumption: Let (P,
                                 xP,
                                 yP,
                                 zP) for some 
                                    
                                       x
                                       ,
                                       y
                                       ,
                                       z
                                       ∈
                                       
                                          
                                             Z
                                          
                                          
                                             q
                                          
                                          
                                             ∗
                                          
                                       
                                    
                                 ; computing 
                                    
                                       e
                                       
                                          
                                             (
                                             P
                                             ,
                                             P
                                             )
                                          
                                          
                                             xyz
                                          
                                       
                                       ∈
                                       
                                          
                                             G
                                          
                                          
                                             2
                                          
                                       
                                    
                                  is difficult.

This section will describe an efficient joint purchase protocol based on an elliptic curve for mobile environments. The method consists of five phases: the initial phase, the joint participant phase, the ticket purchase phase, the winning number generation phase and the lottery prize claim phase. There are five parties in the proposed protocol:
                        
                           •
                           Coordinator (C): The coordinator collects participants’ information and commits to buying lottery tickets.

Participant (P): One of the participants using a mobile device to participate in the lottery.

Participant Group (PG): All of the participants (including the coordinator).

Lottery Proxy Center (LPC): A trustee web site that is committed to coordinating the lottery.

Lottery Originator (LO): An organization deploying an LPC provides the lottery prizes and holds the lottery; The LO also sets up an untraceable and tamperproof decryptor [14] to generate winning numbers for each lottery draw.

In order to hold a fair and verifiable lottery, the LO is involved in the proposed protocol, generating the winning number, for public verification. Cryptology, such as symmetrical encryption and hash chain, is applied in the proposed protocol. The Internet Secure Socket Layer (SSL) protocol is applied to protect the end-to-end communications for lottery issuing and casting. A scenario involving the proposed protocol is shown in Fig. 1
                     .
                        
                           (1)
                           LO
                              
                                 
                              
                              P: The participant uses his/her identity to register to the LO. The LO sends back a permit ticket.

C
                              
                                 
                              
                              P: The coordinator sends a request message for ticket purchases to other participants. The participants then respond to a hidden identity message.

C
                              
                                 
                              
                              LPC: The coordinator proposes a purchase request including a participant’s information, to purchase lottery tickets with participants’ information.

LPC
                              
                                 
                              
                              PG: The LPC sends shadows to the participants’ group, respectively.

LPC
                              
                                 
                              
                              LO: The LPC sends shadows to the participants’ group, respectively.

LO
                              
                                 
                              
                              P: The LO generates winning numbers by untraceable decryptor, and then publishes the winning numbers.

P
                              
                                 
                              
                              LO: The winning participant uses his/her shadow to claim the winning prize. Finally, the LO returns an invoice to the participant.

The following notations are used in the proposed protocol:
                        
                           
                              
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   x
                                                
                                             
                                          
                                       
                                    
                                    the random number generated by X, 
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   X
                                                
                                             
                                             ∈
                                             
                                                
                                                   Z
                                                
                                                
                                                   q
                                                
                                                
                                                   ∗
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       n
                                    
                                    a large number where 
                                          
                                             n
                                             =
                                             p
                                             ·
                                             q
                                             ,
                                             φ
                                             (
                                             n
                                             )
                                          
                                        is a Euler Totient function and 
                                          
                                             φ
                                             (
                                             n
                                             )
                                             =
                                             (
                                             p
                                             -
                                             1
                                             )
                                             (
                                             q
                                             -
                                             1
                                             )
                                          
                                       . The 
                                          
                                             (
                                             p
                                             ,
                                             q
                                             )
                                          
                                        is a pair of large prime numbers
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             ·
                                             )
                                          
                                       
                                    
                                    a one way hash function, 
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             :
                                             
                                                
                                                   {
                                                   0
                                                   ,
                                                   1
                                                   }
                                                
                                                
                                                   ∗
                                                
                                             
                                             ×
                                             
                                                
                                                   G
                                                
                                                
                                                   1
                                                
                                             
                                             →
                                             
                                                
                                                   {
                                                   0
                                                   ,
                                                   1
                                                   }
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       , where k is the fixed output length [21]
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   2
                                                
                                             
                                             (
                                             ·
                                             )
                                          
                                       
                                    
                                    the map-to-point function, 
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   2
                                                
                                             
                                             :
                                             
                                                
                                                   {
                                                   0
                                                   ,
                                                   1
                                                   }
                                                
                                                
                                                   ∗
                                                
                                             
                                             →
                                             
                                                
                                                   G
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             R
                                             (
                                             ·
                                             )
                                          
                                       
                                    
                                    the real random number function [22]
                                    
                                 
                                 
                                    
                                       
                                          
                                             PRG
                                             (
                                             ·
                                             )
                                          
                                       
                                    
                                    the pseudo-random number generation function
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ID
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                    the identity of user i
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   IDi
                                                
                                             
                                          
                                       
                                    
                                    the hash value of the user i identity, where 
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   IDi
                                                
                                             
                                             =
                                             
                                                
                                                   h
                                                
                                                
                                                   2
                                                
                                             
                                             (
                                             
                                                
                                                   ID
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             s
                                          
                                       
                                    
                                    the LO and LPC’s secret key, 
                                          
                                             s
                                             ∈
                                             
                                                
                                                   Z
                                                
                                                
                                                   q
                                                
                                                
                                                   ∗
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   ID
                                                
                                             
                                          
                                       
                                    
                                    the private identity of user i
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   CK
                                                
                                                
                                                   c
                                                   ,
                                                   i
                                                
                                             
                                          
                                       
                                    
                                    the session key between coordinator and user i
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   E
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             M
                                             )
                                             /
                                             Dk
                                             (
                                             M
                                             )
                                          
                                       
                                    
                                    use symmetrical key k to encrypt or decrypt message M
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   SKX
                                                
                                             
                                             (
                                             M
                                             )
                                          
                                       
                                    
                                    use X’s private key 
                                          
                                             
                                                
                                                   SK
                                                
                                                
                                                   X
                                                
                                             
                                          
                                        to sign message M
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   PKX
                                                
                                             
                                             (
                                             M
                                             )
                                          
                                       
                                    
                                    use X’s public key 
                                          
                                             
                                                
                                                   PK
                                                
                                                
                                                   X
                                                
                                             
                                          
                                        to verify message M
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Sig
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                    the 
                                          
                                             i
                                          
                                       th signature
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   TK
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                    the permit ticket of the ith purchase
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   SHK
                                                
                                                
                                                   X
                                                
                                             
                                          
                                       
                                    
                                    
                                       X’s shadow
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   SHK
                                                
                                                
                                                   XY
                                                
                                             
                                          
                                       
                                    
                                    the shadow key between X and Y
                                    
                                 
                                 
                                    
                                       
                                          
                                             f
                                             (
                                             x
                                             )
                                          
                                       
                                    
                                    a polynomial function generated for embedding the LO’s private key 
                                          
                                             
                                                
                                                   SK
                                                
                                                
                                                   LO
                                                
                                             
                                          
                                       , where 
                                          
                                             f
                                             (
                                             x
                                             )
                                             =
                                             c
                                             ·
                                             x
                                             +
                                             
                                                
                                                   SK
                                                
                                                
                                                   LO
                                                
                                             
                                             
                                             mod
                                             
                                             φ
                                             (
                                             n
                                             )
                                             ,
                                             c
                                             ∈
                                             [
                                             1
                                             ,
                                             φ
                                             (
                                             n
                                             )
                                             ]
                                          
                                       
                                    
                                 
                                 
                                    
                                       Q
                                    
                                    the point of group 
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   X
                                                
                                             
                                          
                                       
                                    
                                    the nonce generated by X, and the 
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   X
                                                
                                             
                                             ∈
                                             
                                                
                                                   Z
                                                
                                                
                                                   q
                                                
                                                
                                                   ∗
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       Num
                                    
                                    the lottery number selected by coordinator, where 
                                          
                                             Num
                                             =
                                             (
                                             
                                                
                                                   no
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   no
                                                
                                                
                                                   2
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   no
                                                
                                                
                                                   j
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ta
                                             ,
                                             tp
                                             ,
                                             tc
                                          
                                       
                                    
                                    the time of winner announcement; deadline of prize claim request; deadline for collecting information between coordinator and participants
                                 
                                 
                                    
                                       timestampX
                                    
                                    
                                       
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       s timestamp
                                 
                                 
                                    
                                       
                                          
                                             x
                                             [
                                             R
                                             ]
                                          
                                       
                                    
                                    the x coordinate of the R point on the elliptic curve [23]
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Inv
                                                
                                                
                                                   X
                                                
                                             
                                          
                                       
                                    
                                    
                                       X’s invoice
                                 
                                 
                                    
                                       m
                                    
                                    the number of participants
                                 
                                 
                                    ∣∣
                                    the concatenation operation
                                 
                                 
                                    
                                       
                                          
                                             ⊕
                                          
                                       
                                    
                                    the exclusive OR operation
                                 
                                 
                                    
                                       
                                          
                                             A
                                             
                                             ≟
                                             
                                             B
                                          
                                       
                                    
                                    comparing whether or not A is equal to B
                                    
                                 
                                 
                                    
                                       
                                          
                                       
                                    
                                    the secure channel (for example: SSL channel)
                                 
                                 
                                    
                                       
                                          
                                       
                                    
                                    the insecure channel
                                 
                              
                           
                        
                     
                  

In the initial phase, the participant i should register to be a legal user. The LO then issues a purchasing permit, public identity and private identity for participant i. The scenario of the initial phase is shown in Fig. 2
                        .
                           
                              Step 1:
                              The LO generates a secret key s and sends it to LPC; the LO also selects a finite field 
                                    
                                       
                                          
                                             F
                                          
                                          
                                             q
                                          
                                       
                                    
                                  over a large odd prime 
                                    
                                       q
                                       >
                                       
                                          
                                             2
                                          
                                          
                                             160
                                          
                                       
                                    
                                 , and then an elliptic curve function is used: 
                                    
                                       
                                          
                                             EC
                                          
                                          
                                             q
                                          
                                       
                                       (
                                       a
                                       ,
                                       b
                                       )
                                       :
                                       
                                          
                                             y
                                          
                                          
                                             2
                                          
                                       
                                       ≡
                                       
                                          
                                             x
                                          
                                          
                                             3
                                          
                                       
                                       +
                                       ax
                                       +
                                       b
                                       (
                                       mod
                                       
                                       q
                                       )
                                    
                                  with the order q over 
                                    
                                       
                                          
                                             F
                                          
                                          
                                             q
                                          
                                       
                                    
                                 , where 
                                    
                                       a
                                       ,
                                       b
                                       ∈
                                       
                                          
                                             F
                                          
                                          
                                             q
                                          
                                       
                                    
                                 , and 
                                    
                                       4
                                       
                                          
                                             a
                                          
                                          
                                             3
                                          
                                       
                                       +
                                       27
                                       
                                          
                                             b
                                          
                                          
                                             2
                                          
                                       
                                       
                                       ≠
                                       
                                       0
                                       
                                       mod
                                       
                                       q
                                    
                                  
                                 [16], with the public point Q with the order n over 
                                    
                                       
                                          
                                             EC
                                          
                                          
                                             q
                                          
                                       
                                       (
                                       a
                                       ,
                                       b
                                       )
                                    
                                 . The LO computes 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             pub
                                          
                                       
                                       =
                                       s
                                       ·
                                       Q
                                    
                                 . The 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             k
                                          
                                       
                                    
                                 (·) and 
                                    
                                       
                                          
                                             D
                                          
                                          
                                             k
                                          
                                       
                                    
                                 (·) are the symmetric encryption and decryption algorithms [16], respectively. Then it publishes: 
                                    
                                       
                                          
                                             EC
                                          
                                          
                                             q
                                          
                                       
                                       (
                                       a
                                       ,
                                       b
                                       )
                                       ,
                                       Q
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             pub
                                          
                                       
                                       ,
                                       
                                          
                                             E
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       ·
                                       )
                                       ,
                                       and
                                       ,
                                       
                                          
                                             D
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       ·
                                       )
                                    
                                 .

The participant i sends his/her real identity 
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                    
                                  to the LO for registration.

First, the LO checks the real identity, and then generates the public identity 
                                    
                                       
                                          
                                             H
                                          
                                          
                                             
                                                
                                                   ID
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 , private identity 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             
                                                
                                                   ID
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 , and purchases permit ticket 
                                    
                                       
                                          
                                             TK
                                          
                                          
                                             i
                                          
                                       
                                    
                                 . 
                                    
                                       (1)
                                       
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                h
                                             
                                             
                                                2
                                             
                                          
                                          (
                                          
                                             
                                                ID
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       (2)
                                       
                                          
                                             
                                                d
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          =
                                          s
                                          ·
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       (3)
                                       
                                          
                                             
                                                C
                                             
                                             
                                                
                                                   
                                                      TK
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                E
                                             
                                             
                                                
                                                   
                                                      SK
                                                   
                                                   
                                                      LO
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                d
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       (4)
                                       
                                          
                                             
                                                SG
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          
                                             
                                                S
                                             
                                             
                                                
                                                   
                                                      SK
                                                   
                                                   
                                                      LO
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                C
                                             
                                             
                                                
                                                   
                                                      TK
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       (5)
                                       
                                          
                                             
                                                TK
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          (
                                          
                                             
                                                C
                                             
                                             
                                                
                                                   
                                                      TK
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                SG
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 The LO stores 
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                    
                                 , and then sends the initial messages 
                                    
                                       (
                                       
                                          
                                             H
                                          
                                          
                                             
                                                
                                                   ID
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             d
                                          
                                          
                                             
                                                
                                                   ID
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             TK
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                  to participant i.

Upon receiving the initial message, participant i verifies ticket 
                                    
                                       
                                          
                                             TK
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       (6)
                                       
                                          
                                             
                                                V
                                             
                                             
                                                
                                                   
                                                      PK
                                                   
                                                   
                                                      LO
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                SG
                                             
                                             
                                                1
                                             
                                          
                                          )
                                          
                                          ≟
                                          
                                          
                                             
                                                C
                                             
                                             
                                                
                                                   
                                                      TK
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    
                                 If the equality holds, then participant i uses 
                                    
                                       
                                          
                                             TK
                                          
                                          
                                             i
                                          
                                       
                                    
                                  to purchase a lottery entry. Afterward, the LO and LPC can verify the participant’s identity via ticket 
                                    
                                       
                                          
                                             TK
                                          
                                          
                                             i
                                          
                                       
                                    
                                 .

In the joint participant phase, coordinator C broadcasts a request message to other participants. If the other participators agree to the coordinator’s request, they will respond with a message to the coordinator. The scenario of the joint participant phase is shown in Fig. 3
                        .
                           
                              Step 1:
                              The Coordinator C chooses a nonce 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             c
                                          
                                       
                                    
                                  and a point Q of the group 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             1
                                          
                                       
                                    
                                 . The coordinator then computes 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             c
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             T
                                          
                                          
                                             c
                                          
                                       
                                    
                                 : 
                                    
                                       (7)
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                c
                                             
                                          
                                          =
                                          
                                             
                                                N
                                             
                                             
                                                c
                                             
                                          
                                          ·
                                          Q
                                       
                                    
                                 
                                 
                                    
                                       (8)
                                       
                                          
                                             
                                                T
                                             
                                             
                                                c
                                             
                                          
                                          =
                                          
                                             
                                                N
                                             
                                             
                                                c
                                             
                                          
                                          ·
                                          
                                             
                                                Q
                                             
                                             
                                                pub
                                             
                                          
                                          +
                                          
                                             
                                                h
                                             
                                             
                                                1
                                             
                                          
                                          (
                                          
                                             
                                                Q
                                             
                                             
                                                c
                                             
                                          
                                          )
                                          ·
                                          
                                             
                                                d
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      c
                                                   
                                                
                                             
                                          
                                       
                                    
                                 The coordinator selects a random number 
                                    
                                       
                                          
                                             r
                                          
                                          
                                             c
                                          
                                       
                                    
                                  and a number Num of the lottery to generate a signature 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             c
                                          
                                          
                                             ∗
                                          
                                       
                                    
                                 : 
                                    
                                       (9)
                                       
                                          
                                             
                                                R
                                             
                                             
                                                c
                                             
                                          
                                          =
                                          
                                             
                                                r
                                             
                                             
                                                c
                                             
                                          
                                          ·
                                          Q
                                       
                                    
                                 
                                 
                                    
                                       (10)
                                       
                                          
                                             
                                                s
                                             
                                             
                                                c
                                             
                                             
                                                ∗
                                             
                                          
                                          =
                                          
                                             
                                                r
                                             
                                             
                                                c
                                             
                                             
                                                -
                                                1
                                             
                                          
                                          (
                                          Num
                                          -
                                          
                                             
                                                N
                                             
                                             
                                                c
                                             
                                          
                                          ·
                                          x
                                          [
                                          
                                             
                                                R
                                             
                                             
                                                c
                                             
                                          
                                          ]
                                          )
                                          mod
                                          
                                          n
                                       
                                    
                                 The coordinator repeatedly stores Num, 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             c
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             c
                                          
                                       
                                    
                                  in the database and broadcasts request messages 
                                    
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             c
                                          
                                       
                                       ,
                                       
                                          
                                             T
                                          
                                          
                                             c
                                          
                                       
                                       ,
                                       
                                          
                                             H
                                          
                                          
                                             
                                                
                                                   ID
                                                
                                                
                                                   c
                                                
                                             
                                          
                                       
                                       ,
                                       Num
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             c
                                          
                                       
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             c
                                          
                                          
                                             ∗
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             c
                                          
                                       
                                       )
                                    
                                  to other participants.

Upon receiving the request message, participant i checks if the request has been made before the collect deadline time 
                                    
                                       
                                          
                                             t
                                          
                                          
                                             c
                                          
                                       
                                    
                                 . Next, the participant checks the coordinator’s legality:
                                    
                                       (11)
                                       
                                          e
                                          (
                                          
                                             
                                                T
                                             
                                             
                                                c
                                             
                                          
                                          ,
                                          Q
                                          )
                                          
                                          ≟
                                          
                                          e
                                          (
                                          
                                             
                                                Q
                                             
                                             
                                                c
                                             
                                          
                                          +
                                          
                                             
                                                h
                                             
                                             
                                                1
                                             
                                          
                                          (
                                          
                                             
                                                Q
                                             
                                             
                                                c
                                             
                                          
                                          )
                                          ·
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      c
                                                   
                                                
                                             
                                          
                                          )
                                          ,
                                          
                                             
                                                Q
                                             
                                             
                                                pub
                                             
                                          
                                          )
                                       
                                    
                                 If the equality holds, then participant i checks the lottery number Num:
                                    
                                       (12)
                                       
                                          
                                             
                                                V
                                             
                                             
                                                1
                                             
                                          
                                          =
                                          x
                                          [
                                          
                                             
                                                R
                                             
                                             
                                                c
                                             
                                          
                                          ]
                                          ·
                                          
                                             
                                                Q
                                             
                                             
                                                c
                                             
                                          
                                          +
                                          
                                             
                                                s
                                             
                                             
                                                c
                                             
                                             
                                                ∗
                                             
                                          
                                          ·
                                          
                                             
                                                R
                                             
                                             
                                                c
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       (13)
                                       
                                          
                                             
                                                V
                                             
                                             
                                                2
                                             
                                          
                                          =
                                          Num
                                          ·
                                          Q
                                       
                                    
                                 
                                 
                                    
                                       (14)
                                       
                                          
                                             
                                                V
                                             
                                             
                                                1
                                             
                                          
                                          ≟
                                          
                                             
                                                V
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 Participant i chooses a nonce 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             i
                                          
                                       
                                    
                                  and computes 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 : 
                                    
                                       (15)
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          
                                             
                                                N
                                             
                                             
                                                i
                                             
                                          
                                          ·
                                          Q
                                       
                                    
                                 Participant i generates the session key 
                                    
                                       
                                          
                                             CK
                                          
                                          
                                             c
                                             ,
                                             i
                                          
                                       
                                    
                                  between coordinator C and participant i for encrypting the participant’s information:
                                    
                                       (16)
                                       
                                          
                                             
                                                CK
                                             
                                             
                                                c
                                                ,
                                                i
                                             
                                          
                                          =
                                          
                                             
                                                N
                                             
                                             
                                                i
                                             
                                          
                                          ·
                                          
                                             
                                                Q
                                             
                                             
                                                c
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       (17)
                                       
                                          
                                             
                                                C
                                             
                                             
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                E
                                             
                                             
                                                
                                                   
                                                      CK
                                                   
                                                   
                                                      c
                                                      ,
                                                      i
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                ID
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 Finally, participant i sends the response message 
                                    
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             C
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                  to the coordinator C.

Upon receiving the response message, coordinator C computes the session key 
                                    
                                       
                                          
                                             CK
                                          
                                          
                                             c
                                             ,
                                             i
                                          
                                       
                                    
                                  and decrypts 
                                    
                                       
                                          
                                             C
                                          
                                          
                                             1
                                          
                                       
                                    
                                 : 
                                    
                                       (18)
                                       
                                          
                                             
                                                CK
                                             
                                             
                                                c
                                                ,
                                                i
                                             
                                          
                                          =
                                          
                                             
                                                N
                                             
                                             
                                                c
                                             
                                          
                                          ·
                                          
                                             
                                                Q
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       (19)
                                       
                                          
                                             
                                                ID
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   
                                                      CK
                                                   
                                                   
                                                      c
                                                      ,
                                                      i
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                C
                                             
                                             
                                                1
                                             
                                          
                                          )
                                       
                                    
                                 The coordinator stores 
                                    
                                       (
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                  in the database.

In this procedure, the coordinator integrates the participants’ information into the purchase request for the LPC. The scenario is shown in Fig. 4
                           .
                              
                                 Step 1:
                                 After the 
                                       
                                          
                                             
                                                t
                                             
                                             
                                                c
                                             
                                          
                                       
                                    , coordinator C generates the purchase message 
                                       
                                          
                                             
                                                M
                                             
                                             
                                                buy
                                             
                                          
                                       
                                     with participants’ information:
                                       
                                          (20)
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   buy
                                                
                                             
                                             =
                                             (
                                             
                                                
                                                   ID
                                                
                                                
                                                   1
                                                
                                             
                                             ‖
                                             
                                                
                                                   ID
                                                
                                                
                                                   2
                                                
                                             
                                             ‖
                                             …
                                             ‖
                                             
                                                
                                                   ID
                                                
                                                
                                                   m
                                                
                                             
                                             ‖
                                             
                                                
                                                   Q
                                                
                                                
                                                   1
                                                
                                             
                                             ‖
                                             
                                                
                                                   Q
                                                
                                                
                                                   2
                                                
                                             
                                             ‖
                                             …
                                             ‖
                                             
                                                
                                                   Q
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          (21)
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   buy
                                                
                                             
                                             =
                                             
                                                
                                                   M
                                                
                                                
                                                   buy
                                                
                                             
                                             ⊕
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             e
                                             (
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   N
                                                
                                                
                                                   c
                                                
                                             
                                             ·
                                             
                                                
                                                   Q
                                                
                                                
                                                   pub
                                                
                                             
                                             )
                                             )
                                          
                                       
                                    Coordinator C uses his/her private identity to encrypt the purchase information 
                                       
                                          (
                                          (
                                          
                                             
                                                Q
                                             
                                             
                                                c
                                             
                                          
                                          ,
                                          
                                             
                                                V
                                             
                                             
                                                buy
                                             
                                          
                                          )
                                          ,
                                          
                                             
                                                TK
                                             
                                             
                                                c
                                             
                                          
                                          ,
                                          
                                             
                                                timestamp
                                             
                                             
                                                c
                                             
                                          
                                          ,
                                          Num
                                          )
                                       
                                    , where 
                                       
                                          
                                             
                                                TK
                                             
                                             
                                                c
                                             
                                          
                                          =
                                          (
                                          
                                             
                                                C
                                             
                                             
                                                
                                                   
                                                      TK
                                                   
                                                   
                                                      c
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                SG
                                             
                                             
                                                c
                                             
                                          
                                          )
                                       
                                     issued by LO:
                                       
                                          (22)
                                          
                                             
                                                
                                                   C
                                                
                                                
                                                   2
                                                
                                             
                                             =
                                             
                                                
                                                   E
                                                
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         
                                                            
                                                               ID
                                                            
                                                            
                                                               c
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             (
                                             (
                                             
                                                
                                                   Q
                                                
                                                
                                                   c
                                                
                                             
                                             ,
                                             
                                                
                                                   V
                                                
                                                
                                                   buy
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   TK
                                                
                                                
                                                   c
                                                
                                             
                                             ,
                                             
                                                
                                                   timestamp
                                                
                                                
                                                   c
                                                
                                             
                                             ,
                                             Num
                                             )
                                          
                                       
                                    Coordinator C sends purchase message 
                                       
                                          (
                                          
                                             
                                                C
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      c
                                                   
                                                
                                             
                                          
                                          )
                                       
                                     to the LPC for lottery ticket purchase.

The LPC uses secret key s and 
                                       
                                          
                                             
                                                H
                                             
                                             
                                                IDc
                                             
                                          
                                       
                                     to decrypt 
                                       
                                          
                                             
                                                C
                                             
                                             
                                                2
                                             
                                          
                                       
                                    : 
                                       
                                          (23)
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                             
                                             =
                                             s
                                             ·
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          (24)
                                          
                                             (
                                             (
                                             
                                                
                                                   Q
                                                
                                                
                                                   c
                                                
                                             
                                             ,
                                             
                                                
                                                   V
                                                
                                                
                                                   buy
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   TK
                                                
                                                
                                                   c
                                                
                                             
                                             ,
                                             
                                                
                                                   timestamp
                                                
                                                
                                                   c
                                                
                                             
                                             ,
                                             Num
                                             )
                                             =
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         
                                                            
                                                               ID
                                                            
                                                            
                                                               c
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             (
                                             
                                                
                                                   C
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                          
                                       
                                    The LPC checks if 
                                       
                                          
                                             
                                                timestamp
                                             
                                             
                                                LPC
                                             
                                          
                                          -
                                          
                                             
                                                timestamp
                                             
                                             
                                                c
                                             
                                          
                                          ⩽
                                          Δ
                                          T
                                       
                                    .

Upon receiving 
                                       
                                          
                                             
                                                SG
                                             
                                             
                                                c
                                             
                                          
                                       
                                     and 
                                       
                                          
                                             
                                                C
                                             
                                             
                                                TKc
                                             
                                          
                                       
                                     from 
                                       
                                          
                                             
                                                TK
                                             
                                             
                                                c
                                             
                                          
                                       
                                    , the LPC then verifies:
                                       
                                          (25)
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   
                                                      
                                                         PK
                                                      
                                                      
                                                         LO
                                                      
                                                   
                                                
                                             
                                             (
                                             
                                                
                                                   SG
                                                
                                                
                                                   c
                                                
                                             
                                             )
                                             
                                             ≟
                                             
                                             
                                                
                                                   C
                                                
                                                
                                                   
                                                      
                                                         TK
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 

Upon receiving the purchase message, the LPC verifies the coordinator’s identity, generates the lottery for the participant group, and then sends the lottery numbers to participants, respectively. The scenario is shown in Fig. 5
                           .
                              
                                 Step 1:
                                 The LPC extracts the participants’ information 
                                       
                                          
                                             
                                                M
                                             
                                             
                                                buy
                                             
                                          
                                       
                                     from 
                                       
                                          
                                             
                                                V
                                             
                                             
                                                buy
                                             
                                          
                                       
                                    : 
                                       
                                          (26)
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   buy
                                                
                                             
                                             =
                                             
                                                
                                                   V
                                                
                                                
                                                   buy
                                                
                                             
                                             ⊕
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             e
                                             (
                                             
                                                
                                                   d
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   Q
                                                
                                                
                                                   c
                                                
                                             
                                             )
                                             )
                                             =
                                             (
                                             
                                                
                                                   ID
                                                
                                                
                                                   1
                                                
                                             
                                             ‖
                                             
                                                
                                                   ID
                                                
                                                
                                                   2
                                                
                                             
                                             ‖
                                             …
                                             ‖
                                             
                                                
                                                   ID
                                                
                                                
                                                   m
                                                
                                             
                                             ‖
                                             
                                                
                                                   Q
                                                
                                                
                                                   1
                                                
                                             
                                             ‖
                                             
                                                
                                                   Q
                                                
                                                
                                                   2
                                                
                                             
                                             ‖
                                             …
                                             ‖
                                             
                                                
                                                   Q
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                h
                                             
                                             
                                                2
                                             
                                          
                                          (
                                          
                                             
                                                ID
                                             
                                             
                                                1
                                             
                                          
                                          )
                                          ,
                                       
                                     for 
                                       
                                          i
                                          =
                                          1
                                       
                                     to 
                                       
                                          m
                                       
                                    , where m is the number of participants.

The LPC then selects a nonce 
                                       
                                          
                                             
                                                N
                                             
                                             
                                                RPC
                                             
                                          
                                       
                                     and generates 
                                       
                                          
                                             
                                                K
                                             
                                             
                                                i
                                             
                                          
                                       
                                     as participants’ shadows 
                                       
                                          
                                             
                                                SHK
                                             
                                             
                                                i
                                             
                                          
                                       
                                     for claiming the prize:
                                       
                                          
                                             
                                                
                                                   SH
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             f
                                             (
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             )
                                             (
                                             -
                                             
                                                
                                                   H
                                                
                                                
                                                   LO
                                                
                                             
                                             /
                                             (
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   H
                                                
                                                
                                                   LO
                                                
                                             
                                             )
                                             )
                                             mod
                                             
                                             ϕ
                                             (
                                             n
                                             )
                                             ,
                                             for
                                             
                                             i
                                             =
                                             1
                                             
                                             to
                                             
                                             m
                                          
                                       
                                    
                                    
                                       
                                          (27)
                                          
                                             
                                                
                                                   K
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             
                                                
                                                   (
                                                   
                                                      
                                                         N
                                                      
                                                      
                                                         LPC
                                                      
                                                   
                                                   ⊕
                                                   
                                                      
                                                         H
                                                      
                                                      
                                                         
                                                            
                                                               ID
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      
                                                         PK
                                                      
                                                      
                                                         LO
                                                      
                                                   
                                                
                                             
                                             mod
                                             
                                             n
                                             ,
                                             
                                             for
                                             
                                             i
                                             =
                                             1
                                             
                                             to
                                             
                                             m
                                          
                                       
                                    
                                    
                                       
                                          (28)
                                          
                                             
                                                
                                                   SHK
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             
                                                
                                                   K
                                                
                                                
                                                   i
                                                
                                                
                                                   
                                                      
                                                         SH
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             mod
                                             
                                             n
                                             ,
                                             
                                             for
                                             
                                             i
                                             =
                                             1
                                             
                                             to
                                             
                                             m
                                          
                                       
                                    The LPC generates the 
                                       
                                          
                                             
                                                RQ
                                             
                                             
                                                LPC
                                             
                                          
                                       
                                     and 
                                       
                                          
                                             
                                                ST
                                             
                                             
                                                j
                                             
                                          
                                       
                                     in order for participants to verify the LPC’s identity:
                                       
                                          (29)
                                          
                                             
                                                
                                                   RQ
                                                
                                                
                                                   LPC
                                                
                                             
                                             =
                                             
                                                
                                                   N
                                                
                                                
                                                   LPC
                                                
                                             
                                             ·
                                             Q
                                          
                                       
                                    
                                    
                                       
                                          (30)
                                          
                                             
                                                
                                                   ST
                                                
                                                
                                                   j
                                                
                                             
                                             =
                                             
                                                
                                                   N
                                                
                                                
                                                   LPC
                                                
                                             
                                             ·
                                             
                                                
                                                   Q
                                                
                                                
                                                   pub
                                                
                                             
                                             +
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   RQ
                                                
                                                
                                                   LPC
                                                
                                             
                                             )
                                             ·
                                             
                                                
                                                   d
                                                
                                                
                                                   LPC
                                                
                                             
                                          
                                       
                                    To ensure that the shadow is mapped to the true participant, the LPC hides the lottery 
                                       
                                          
                                             
                                                SHK
                                             
                                             
                                                i
                                             
                                          
                                       
                                     in 
                                       
                                          
                                             
                                                RV
                                             
                                             
                                                i
                                             
                                          
                                       
                                     by the participant’s public identity 
                                       
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                     and public point 
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                pub
                                             
                                          
                                       
                                    . The participant extracts his/her own shadow 
                                       
                                          
                                             
                                                SHK
                                             
                                             
                                                i
                                             
                                          
                                       
                                     by using the secret key s and public identity 
                                       
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                    : 
                                       
                                          (31)
                                          
                                             
                                                
                                                   RV
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             
                                                
                                                   SHK
                                                
                                                
                                                   i
                                                
                                             
                                             ⊕
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             e
                                             (
                                             s
                                             ·
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   N
                                                
                                                
                                                   LPC
                                                
                                             
                                             ·
                                             
                                                
                                                   Q
                                                
                                                
                                                   pub
                                                
                                             
                                             )
                                             )
                                             ,
                                             
                                             for
                                             
                                             i
                                             =
                                             1
                                             
                                             to
                                             
                                             m
                                          
                                       
                                    At last, the LPC generates the tickets of lottery 
                                       
                                          
                                             
                                                TK
                                             
                                             
                                                
                                                   
                                                      raffle
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                     as proof that the participants possess their lottery tickets:
                                       
                                          (32)
                                          
                                             
                                                
                                                   C
                                                
                                                
                                                   
                                                      
                                                         raffle
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   E
                                                
                                                
                                                   
                                                      
                                                         SK
                                                      
                                                      
                                                         LPC
                                                      
                                                   
                                                
                                             
                                             (
                                             
                                                
                                                   ID
                                                
                                                
                                                   1
                                                
                                             
                                             ‖
                                             
                                                
                                                   ID
                                                
                                                
                                                   2
                                                
                                             
                                             ‖
                                             …
                                             ‖
                                             
                                                
                                                   ID
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          (33)
                                          
                                             
                                                
                                                   SG
                                                
                                                
                                                   
                                                      
                                                         raffle
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   S
                                                
                                                
                                                   
                                                      
                                                         SK
                                                      
                                                      
                                                         LPC
                                                      
                                                   
                                                
                                             
                                             (
                                             
                                                
                                                   C
                                                
                                                
                                                   
                                                      
                                                         raffle
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                             ,
                                             Num
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   a
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   p
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          (34)
                                          
                                             
                                                
                                                   TK
                                                
                                                
                                                   
                                                      
                                                         raffle
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                             =
                                             (
                                             
                                                
                                                   C
                                                
                                                
                                                   
                                                      
                                                         raffle
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   SG
                                                
                                                
                                                   
                                                      
                                                         raffle
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                             ,
                                             Num
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   a
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   p
                                                
                                             
                                             )
                                          
                                       
                                    The LPC sends lottery message 
                                       
                                          (
                                          
                                             
                                                H
                                             
                                             
                                                LO
                                             
                                          
                                          ,
                                          
                                             
                                                RQ
                                             
                                             
                                                LPC
                                             
                                          
                                          ,
                                          
                                             
                                                ST
                                             
                                             
                                                j
                                             
                                          
                                          ,
                                          
                                             
                                                RV
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                TK
                                             
                                             
                                                
                                                   
                                                      raffle
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          )
                                       
                                     to the participant group.

Upon receiving the lottery message, the participants check if the message is round or not:
                                       
                                          (35)
                                          
                                             Check
                                             
                                             e
                                             (
                                             
                                                
                                                   ST
                                                
                                                
                                                   j
                                                
                                             
                                             ,
                                             Q
                                             )
                                             ≟
                                             e
                                             (
                                             
                                                
                                                   RQ
                                                
                                                
                                                   LPC
                                                
                                             
                                             +
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   RQ
                                                
                                                
                                                   LPC
                                                
                                             
                                             )
                                             ·
                                             
                                                
                                                   H
                                                
                                                
                                                   RO
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   Q
                                                
                                                
                                                   pub
                                                
                                             
                                             )
                                          
                                       
                                    If the equality holds, the participants get their shadows 
                                       
                                          
                                             
                                                SHK
                                             
                                             
                                                i
                                             
                                          
                                       
                                     with the private identity 
                                       
                                          
                                             
                                                d
                                             
                                             
                                                IDi
                                             
                                          
                                       
                                    : 
                                       
                                          (36)
                                          
                                             
                                                
                                                   SHK
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             
                                                
                                                   RV
                                                
                                                
                                                   i
                                                
                                             
                                             ⊕
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             e
                                             (
                                             
                                                
                                                   d
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   RQ
                                                
                                                
                                                   LPC
                                                
                                             
                                             )
                                             )
                                             ,
                                             
                                             for
                                             
                                             i
                                             =
                                             1
                                             
                                             to
                                             
                                             m
                                          
                                       
                                    
                                 

The LPC sends participants’ information to the LO. The LO generates the shadow key by the participant information and stores it in the database. Fig. 6
                            shows the scenario of storing purchase information.
                              
                                 Step 1:
                                 The LPC generates shadow key 
                                       
                                          
                                             
                                                SH
                                             
                                             
                                                i
                                                ,
                                                LO
                                             
                                          
                                       
                                    : 
                                       
                                          (37)
                                          
                                             
                                                
                                                   SH
                                                
                                                
                                                   i
                                                   ,
                                                   LO
                                                
                                             
                                             =
                                             f
                                             (
                                             
                                                
                                                   H
                                                
                                                
                                                   LO
                                                
                                             
                                             )
                                             (
                                             -
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             /
                                             (
                                             
                                                
                                                   H
                                                
                                                
                                                   LO
                                                
                                             
                                             -
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             )
                                             )
                                             mod
                                             
                                             ϕ
                                             (
                                             n
                                             )
                                             ,
                                             for
                                             
                                             i
                                             =
                                             1
                                             
                                             to
                                             
                                             m
                                          
                                       
                                    and integrates 
                                       
                                          
                                             
                                                K
                                             
                                             
                                                i
                                             
                                          
                                       
                                     into K and 
                                       
                                          
                                             
                                                SH
                                             
                                             
                                                i
                                                ,
                                                LO
                                             
                                          
                                       
                                     into SH:
                                       
                                          (38)
                                          
                                             K
                                             =
                                             (
                                             
                                                
                                                   K
                                                
                                                
                                                   1
                                                
                                             
                                             ‖
                                             
                                                
                                                   K
                                                
                                                
                                                   2
                                                
                                             
                                             ‖
                                             …
                                             ‖
                                             
                                                
                                                   K
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                             ,
                                             for
                                             
                                             i
                                             =
                                             1
                                             
                                             to
                                             
                                             m
                                          
                                       
                                    
                                    
                                       
                                          (39)
                                          
                                             SH
                                             =
                                             (
                                             
                                                
                                                   SH
                                                
                                                
                                                   1
                                                   ,
                                                   LO
                                                
                                             
                                             ‖
                                             
                                                
                                                   SH
                                                
                                                
                                                   2
                                                   ,
                                                   LO
                                                
                                             
                                             ‖
                                             …
                                             ‖
                                             
                                                
                                                   SH
                                                
                                                
                                                   m
                                                   ,
                                                   LO
                                                
                                             
                                             )
                                             ,
                                             for
                                             
                                             i
                                             =
                                             1
                                             
                                             to
                                             
                                             m
                                          
                                       
                                    The LPC sends 
                                       
                                          (
                                          Num
                                          ,
                                          
                                             
                                                N
                                             
                                             
                                                LPC
                                             
                                          
                                          ,
                                          
                                             
                                                M
                                             
                                             
                                                buy
                                             
                                          
                                          ,
                                          K
                                          ,
                                          SH
                                          )
                                       
                                     to the LO via secure channel.

Upon receiving the message, the LO uses 
                                       
                                          
                                             
                                                SH
                                             
                                             
                                                i
                                                ,
                                                LO
                                             
                                          
                                       
                                     and 
                                       
                                          
                                             
                                                K
                                             
                                             
                                                i
                                             
                                          
                                       
                                     to compute 
                                       
                                          
                                             
                                                T
                                             
                                             
                                                i
                                                ,
                                                LO
                                             
                                          
                                       
                                    : 
                                       
                                          (40)
                                          
                                             
                                                
                                                   T
                                                
                                                
                                                   i
                                                   ,
                                                   LO
                                                
                                             
                                             =
                                             
                                                
                                                   K
                                                
                                                
                                                   i
                                                
                                                
                                                   
                                                      
                                                         SH
                                                      
                                                      
                                                         i
                                                         ,
                                                         LO
                                                      
                                                   
                                                
                                             
                                             ,
                                             for
                                             
                                             i
                                             =
                                             1
                                             
                                             to
                                             
                                             m
                                          
                                       
                                    The LO stores 
                                       
                                          (
                                          Num
                                          ‖
                                          
                                             
                                                N
                                             
                                             
                                                LPC
                                             
                                          
                                          ‖
                                          
                                             
                                                M
                                             
                                             
                                                buy
                                             
                                          
                                          ‖
                                          K
                                          ‖
                                          
                                             
                                                T
                                             
                                             
                                                1
                                                ,
                                                LO
                                             
                                          
                                          ‖
                                          
                                             
                                                T
                                             
                                             
                                                2
                                                ,
                                                LO
                                             
                                          
                                          ‖
                                          …
                                          ‖
                                          
                                             
                                                T
                                             
                                             
                                                m
                                                ,
                                                LO
                                             
                                          
                                          )
                                       
                                     in the database.

After the winner announcement deadline, the LO sends k numbers (i.e. 1,2,…,59) [1] to the decryptor for the generation of the winning numbers. The scenario of the decryptor generating the winning numbers is shown in Fig. 7
                        .
                           
                              Step 1:
                              Upon receiving the 59 numbers from the LO, the decryptor generates a new public/private key 
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             p
                                          
                                       
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                       )
                                       /
                                       
                                          
                                             d
                                          
                                          
                                             p
                                          
                                       
                                    
                                  
                                 [23], and then selects a random number 
                                    
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                    
                                  by real random function [22], for i
                                 =1 to k.

The decryptor uses 
                                    
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                    
                                  and the public key 
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             p
                                          
                                       
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                       )
                                    
                                  to generate 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             i
                                          
                                       
                                    
                                 : 
                                    
                                       (41)
                                       
                                          
                                             
                                                M
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          
                                             
                                                t
                                             
                                             
                                                i
                                             
                                             
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                no
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          mod
                                          
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                          ,
                                          
                                          for
                                          
                                          i
                                          =
                                          1
                                          
                                          to
                                          
                                          k
                                       
                                    
                                 
                                 
                                    
                                       (42)
                                       
                                          M
                                          =
                                          (
                                          
                                             
                                                M
                                             
                                             
                                                1
                                             
                                          
                                          ‖
                                          
                                             
                                                M
                                             
                                             
                                                2
                                             
                                          
                                          ‖
                                          …
                                          ‖
                                          
                                             
                                                M
                                             
                                             
                                                k
                                             
                                          
                                          )
                                       
                                    
                                 It then selects 6 winning numbers 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             6
                                          
                                       
                                    
                                  by pseudo-random number generating function PRG():
                                    
                                       (43)
                                       
                                          
                                             
                                                V
                                             
                                             
                                                j
                                             
                                          
                                          =
                                          PRG
                                          (
                                          M
                                          )
                                          ,
                                          
                                          for
                                          
                                          j
                                          =
                                          1
                                          
                                          to
                                          
                                          6
                                       
                                    
                                 The decryptor uses private key 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             p
                                          
                                       
                                    
                                  to sign 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             j
                                          
                                       
                                    
                                 : 
                                    
                                       (44)
                                       
                                          
                                             
                                                V
                                             
                                             
                                                j
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          
                                             
                                                (
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      d
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          ·
                                          
                                             
                                                t
                                             
                                             
                                                j
                                             
                                             
                                                -
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                (
                                                
                                                   
                                                      no
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      d
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          mod
                                          
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                          ,
                                          
                                          for
                                          
                                          j
                                          =
                                          1
                                          
                                          to
                                          
                                          6
                                       
                                    
                                 The decryptor then publishes 
                                    
                                       (
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ‖
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                       ‖
                                       …
                                       ‖
                                       
                                          
                                             V
                                          
                                          
                                             6
                                          
                                          
                                             ′
                                          
                                       
                                       ‖
                                       M
                                       ‖
                                       
                                          
                                             e
                                          
                                          
                                             p
                                          
                                       
                                       ‖
                                       
                                          
                                             d
                                          
                                          
                                             p
                                          
                                       
                                       ‖
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                       )
                                    
                                  for public verification. Moreover, the decryptor sends 
                                    
                                       (
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ‖
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                       ‖
                                       …
                                       ‖
                                       
                                          
                                             V
                                          
                                          
                                             6
                                          
                                          
                                             ′
                                          
                                       
                                       ‖
                                       
                                          
                                             e
                                          
                                          
                                             p
                                          
                                       
                                       ‖
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                       )
                                    
                                  to the LO.

The LO uses the public key 
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             p
                                          
                                       
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                       )
                                    
                                  to decrypt:
                                    
                                       (45)
                                       
                                          
                                             
                                                wno
                                             
                                             
                                                j
                                             
                                          
                                          =
                                          
                                             
                                                (
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          mod
                                          
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                          =
                                          
                                             
                                                no
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          for
                                          
                                          j
                                          =
                                          1
                                          
                                          to
                                          
                                          6
                                       
                                    
                                 and then publishes the winning numbers (
                                    
                                       
                                          
                                             wno
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             wno
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             wno
                                          
                                          
                                             6
                                          
                                       
                                    
                                 ).

In this phase, the winning participant claims the prize if his/her number matches the winning number. The LO uses the relative shadow to check the participant’s identity, which is already in the database; if it matches, the LO grants the claim into his/her credit and generates an invoice for the winning participant. In Fig. 8
                        , the participant claims the prize from LO by his/her shadow and ticket.
                           
                              Step 1:
                              Before the claim deadline 
                                    
                                       
                                          
                                             t
                                          
                                          
                                             p
                                          
                                       
                                    
                                 , participant i must generate the claim message with his/her shadow 
                                    
                                       
                                          
                                             SHK
                                          
                                          
                                             i
                                          
                                       
                                    
                                 , private 
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             TK
                                          
                                          
                                             
                                                
                                                   raffle
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                  to claim the prize:
                                    
                                       (46)
                                       
                                          
                                             
                                                U
                                             
                                             
                                                i
                                                ,
                                                WIN
                                             
                                          
                                          =
                                          
                                             
                                                SHK
                                             
                                             
                                                i
                                             
                                          
                                          ⊕
                                          
                                             
                                                h
                                             
                                             
                                                1
                                             
                                          
                                          (
                                          e
                                          (
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                N
                                             
                                             
                                                i
                                             
                                          
                                          ·
                                          
                                             
                                                Q
                                             
                                             
                                                pub
                                             
                                          
                                          )
                                          )
                                       
                                    
                                 
                                 
                                    
                                       (47)
                                       
                                          
                                             
                                                C
                                             
                                             
                                                3
                                             
                                          
                                          =
                                          
                                             
                                                E
                                             
                                             
                                                
                                                   
                                                      d
                                                   
                                                   
                                                      
                                                         
                                                            ID
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          (
                                          (
                                          
                                             
                                                Q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                U
                                             
                                             
                                                i
                                                ,
                                                WIN
                                             
                                          
                                          )
                                          ,
                                          
                                             
                                                TK
                                             
                                             
                                                
                                                   
                                                      raffle
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                timestamp
                                             
                                             
                                                i
                                                ,
                                                WIN
                                             
                                          
                                          )
                                       
                                    
                                 To prove the participant has claimed the prize, the participant must generate the signature by his/her shadow 
                                    
                                       
                                          
                                             SHK
                                          
                                          
                                             i
                                          
                                       
                                    
                                 : 
                                    
                                       (48)
                                       
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ·
                                          Q
                                       
                                    
                                 
                                 
                                    
                                       (49)
                                       
                                          
                                             
                                                s
                                             
                                             
                                                i
                                             
                                             
                                                ∗
                                             
                                          
                                          =
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          1
                                          (
                                          
                                             
                                                SHK
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          
                                             
                                                N
                                             
                                             
                                                i
                                             
                                          
                                          ·
                                          x
                                          [
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                          
                                          ]
                                          )
                                          mod
                                          
                                          n
                                       
                                    
                                 The LPC then sends 
                                    
                                       (
                                       Num
                                       ,
                                       
                                          
                                             C
                                          
                                          
                                             3
                                          
                                       
                                       ,
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                          
                                             ∗
                                          
                                       
                                       )
                                    
                                  to the LO via secure channel.

The LO first checks if the Num and 
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                    
                                  exist in the database. If they do not, it rejects the request. Next, the LO uses Num to find if the consistent lottery information exists in the database and then checks the participant’s identity and number:
                                    
                                       (50)
                                       
                                          Num
                                          
                                          ≟
                                          
                                          
                                             
                                                Num
                                             
                                             
                                                WIN
                                             
                                          
                                       
                                    
                                 The LO recovers the private identity 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             IDi
                                          
                                       
                                    
                                  from the database by the identity 
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                    
                                 : 
                                    
                                       (51)
                                       
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                h
                                             
                                             
                                                2
                                             
                                          
                                          (
                                          
                                             
                                                ID
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       (52)
                                       
                                          
                                             
                                                d
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          =
                                          s
                                          ·
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       (53)
                                       
                                          (
                                          (
                                          
                                             
                                                P
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                U
                                             
                                             
                                                i
                                                ,
                                                WIN
                                             
                                          
                                          )
                                          ,
                                          
                                             
                                                TK
                                             
                                             
                                                
                                                   
                                                      raffle
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                timestamp
                                             
                                             
                                                i
                                                ,
                                                WIN
                                             
                                          
                                          )
                                          =
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   
                                                      d
                                                   
                                                   
                                                      
                                                         
                                                            ID
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                C
                                             
                                             
                                                3
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       (54)
                                       
                                          Check
                                          
                                          
                                             
                                                timestamp
                                             
                                             
                                                LO
                                             
                                          
                                          -
                                          
                                             
                                                timestamp
                                             
                                             
                                                i
                                             
                                          
                                          ⩽
                                          Δ
                                          T
                                       
                                    
                                 
                                 
                                    
                                       (55)
                                       
                                          
                                             
                                                V
                                             
                                             
                                                
                                                   
                                                      PK
                                                   
                                                   
                                                      LO
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                SG
                                             
                                             
                                                
                                                   
                                                      raffle
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          )
                                          
                                          ≟
                                          
                                          
                                             
                                                C
                                             
                                             
                                                
                                                   
                                                      raffle
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       (56)
                                       
                                          
                                             
                                                SHK
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          
                                             
                                                U
                                             
                                             
                                                i
                                                ,
                                                WIN
                                             
                                          
                                          ⊕
                                          
                                             
                                                h
                                             
                                             
                                                1
                                             
                                          
                                          (
                                          e
                                          (
                                          
                                             
                                                d
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                Q
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       (57)
                                       
                                          
                                             
                                                T
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          
                                             
                                                K
                                             
                                             
                                                i
                                             
                                             
                                                
                                                   
                                                      SHK
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          mod
                                          
                                          n
                                       
                                    
                                 
                                 
                                    
                                       (58)
                                       
                                          
                                             
                                                N
                                             
                                             
                                                LPC
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          (
                                          
                                             
                                                T
                                             
                                             
                                                i
                                                ,
                                                LO
                                             
                                          
                                          ·
                                          
                                             
                                                T
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          ⊕
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       (59)
                                       
                                          Check
                                          
                                          
                                             
                                                N
                                             
                                             
                                                LRC
                                             
                                             
                                                ′
                                             
                                          
                                          ≟
                                          
                                             
                                                N
                                             
                                             
                                                LPC
                                             
                                          
                                       
                                    
                                 If the above verifications hold, the LO dispatches the prize to the winner’s credit, and computes invoice 
                                    
                                       
                                          
                                             C
                                          
                                          
                                             
                                                
                                                   Inv
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 : 
                                    
                                       (60)
                                       
                                          
                                             
                                                C
                                             
                                             
                                                
                                                   
                                                      Inv
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                E
                                             
                                             
                                                
                                                   
                                                      SK
                                                   
                                                   
                                                      LO
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                H
                                             
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                timestamp
                                             
                                             
                                                
                                                   
                                                      Inv
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          ,
                                          Num
                                          ,
                                          
                                             
                                                SHK
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       (61)
                                       
                                          
                                             
                                                SG
                                             
                                             
                                                
                                                   
                                                      Inv
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                S
                                             
                                             
                                                
                                                   
                                                      SK
                                                   
                                                   
                                                      LO
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                C
                                             
                                             
                                                
                                                   
                                                      Inv
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       (62)
                                       
                                          
                                             
                                                TK
                                             
                                             
                                                
                                                   
                                                      Inv
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          =
                                          (
                                          
                                             
                                                SG
                                             
                                             
                                                
                                                   
                                                      Inv
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                C
                                             
                                             
                                                
                                                   
                                                      Inv
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                 Finally, the LO stores the draw information 
                                    
                                       (
                                       Num
                                       ,
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             SHK
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                          
                                             ∗
                                          
                                       
                                       
                                          
                                             timestamp
                                          
                                          
                                             
                                                
                                                   Inv
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       )
                                    
                                  in the database. In this way, if the winning participant denies having claimed the prize, the LO can use 
                                    
                                       (
                                       Num
                                       ,
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             SHK
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                          
                                             ∗
                                          
                                       
                                       
                                          
                                             timestamp
                                          
                                          
                                             
                                                
                                                   Inv
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       )
                                    
                                  to prove that the prize was issued, and then send the invoice message 
                                    
                                       
                                          
                                             TK
                                          
                                          
                                             
                                                
                                                   Inv
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                  to the winning participant.

Participant i verifies the invoice message:
                                    
                                       (63)
                                       
                                          
                                             
                                                V
                                             
                                             
                                                
                                                   
                                                      PK
                                                   
                                                   
                                                      LO
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                SG
                                             
                                             
                                                
                                                   
                                                      Inv
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          )
                                          
                                          ≟
                                          
                                          
                                             
                                                C
                                             
                                             
                                                
                                                   
                                                      Inv
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                    
                                 If the equality holds, the participant checks if the prize has been transferred to his/her credit.

This section will discuss known attacks and criteria for the proposed protocol.

In the lottery ticket purchase phase, coordinator C sends purchase messages 
                           
                              (
                              
                                 
                                    C
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    H
                                 
                                 
                                    
                                       
                                          ID
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              )
                           
                         to the LPC. If a malicious attacker intercepts or wiretaps the messages, the attacker can use the message to request a lottery ticket as the message comprises the coordinator’s public identity 
                           
                              
                                 
                                    H
                                 
                                 
                                    IDi
                                 
                              
                           
                        . Even if the LPC receives and agrees to the replay message; the attacker will still not be able to claim the prize because the LPC sends back the lottery tickets with the identity from 
                           
                              
                                 
                                    M
                                 
                                 
                                    buy
                                 
                              
                              =
                              (
                              
                                 
                                    ID
                                 
                                 
                                    1
                                 
                              
                              ‖
                              
                                 
                                    ID
                                 
                                 
                                    2
                                 
                              
                              ‖
                              …
                              ‖
                              
                                 
                                    ID
                                 
                                 
                                    m
                                 
                              
                              ‖
                              
                                 
                                    Q
                                 
                                 
                                    1
                                 
                              
                              ‖
                              
                                 
                                    Q
                                 
                                 
                                    2
                                 
                              
                              ‖
                              …
                              ‖
                              
                                 
                                    Q
                                 
                                 
                                    m
                                 
                              
                              )
                           
                         and only the receiver should use the correct private identity 
                           
                              
                                 
                                    d
                                 
                                 
                                    IDi
                                 
                              
                           
                         to retrieve the shadow 
                           
                              
                                 
                                    SHK
                                 
                                 
                                    i
                                 
                              
                           
                         to claim the prize as follows:
                           
                              
                                 
                                    
                                       SHK
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       RV
                                    
                                    
                                       i
                                    
                                 
                                 ⊕
                                 
                                    
                                       h
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 e
                                 (
                                 
                                    
                                       d
                                    
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       RQ
                                    
                                    
                                       LPC
                                    
                                 
                                 )
                                 )
                              
                           
                        Therefore, an attacker cannot claim the prize by replay attack.

Assume an attacker intercepts messages 
                           
                              (
                              
                                 
                                    Q
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    T
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    H
                                 
                                 
                                    
                                       
                                          ID
                                       
                                       
                                          c
                                       
                                    
                                 
                              
                              ,
                              Num
                              ,
                              
                                 
                                    R
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    c
                                 
                                 
                                    ∗
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    c
                                 
                              
                              )
                           
                         between the coordinator and participant. They can modify the coordinator’s identity 
                           
                              
                                 
                                    H
                                 
                                 
                                    
                                       
                                          ID
                                       
                                       
                                          c
                                       
                                    
                                 
                              
                           
                         to 
                           
                              
                                 
                                    H
                                 
                                 
                                    
                                       
                                          ID
                                       
                                       
                                          A
                                       
                                    
                                 
                              
                           
                         and the number Num to 
                           
                              
                                 
                                    Num
                                 
                                 
                                    A
                                 
                              
                           
                        . The participant will thus receive the fake messages 
                           
                              (
                              
                                 
                                    Q
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    T
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    H
                                 
                                 
                                    
                                       
                                          ID
                                       
                                       
                                          A
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    Num
                                 
                                 
                                    A
                                 
                              
                              ,
                              
                                 
                                    R
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    c
                                 
                                 
                                    ∗
                                 
                              
                              ·
                              
                                 
                                    t
                                 
                                 
                                    c
                                 
                              
                              )
                           
                        .

First, the participant checks the legality by:
                           
                              
                                 e
                                 (
                                 
                                    
                                       T
                                    
                                    
                                       c
                                    
                                 
                                 ,
                                 Q
                                 )
                                 
                                 ≟
                                 
                                 e
                                 (
                                 
                                    
                                       Q
                                    
                                    
                                       c
                                    
                                 
                                 +
                                 
                                    
                                       h
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       Q
                                    
                                    
                                       c
                                    
                                 
                                 )
                                 ·
                                 
                                    
                                       H
                                    
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             A
                                          
                                       
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       Q
                                    
                                    
                                       pub
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       
                                          
                                             e
                                             (
                                             (
                                             
                                                
                                                   Q
                                                
                                                
                                                   c
                                                
                                             
                                             +
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   Q
                                                
                                                
                                                   c
                                                
                                             
                                             )
                                             ·
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                
                                             
                                             )
                                             
                                                
                                                   Q
                                                
                                                
                                                   pub
                                                
                                             
                                             )
                                             =
                                          
                                       
                                       
                                          
                                             
                                             e
                                             (
                                             (
                                             
                                                
                                                   N
                                                
                                                
                                                   c
                                                
                                             
                                             ·
                                             Q
                                             +
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   Q
                                                
                                                
                                                   c
                                                
                                             
                                             )
                                             ·
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                
                                             
                                             )
                                             ,
                                             s
                                             ·
                                             Q
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             =
                                          
                                       
                                       
                                          
                                             
                                             e
                                             
                                                
                                                   (
                                                   (
                                                   
                                                      
                                                         N
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   ·
                                                   Q
                                                   +
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   )
                                                   ·
                                                   
                                                      
                                                         H
                                                      
                                                      
                                                         
                                                            
                                                               ID
                                                            
                                                            
                                                               A
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                   ,
                                                   Q
                                                   )
                                                
                                                
                                                   s
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             =
                                          
                                       
                                       
                                          
                                             
                                             e
                                             (
                                             (
                                             
                                                
                                                   N
                                                
                                                
                                                   c
                                                
                                             
                                             ·
                                             s
                                             ·
                                             Q
                                             +
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   Q
                                                
                                                
                                                   c
                                                
                                             
                                             )
                                             ·
                                             s
                                             ·
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                
                                             
                                             )
                                             ,
                                             Q
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             =
                                          
                                       
                                       
                                          
                                             
                                             e
                                             (
                                             (
                                             
                                                
                                                   N
                                                
                                                
                                                   c
                                                
                                             
                                             ·
                                             
                                                
                                                   Q
                                                
                                                
                                                   pub
                                                
                                             
                                             +
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   Q
                                                
                                                
                                                   c
                                                
                                             
                                             )
                                             ·
                                             
                                                
                                                   d
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                
                                             
                                             )
                                             ,
                                             Q
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             ≠
                                          
                                       
                                       
                                          
                                             
                                             e
                                             (
                                             
                                                
                                                   T
                                                
                                                
                                                   c
                                                
                                             
                                             ,
                                             P
                                             )
                                             =
                                             e
                                             (
                                             (
                                             
                                                
                                                   N
                                                
                                                
                                                   c
                                                
                                             
                                             ·
                                             
                                                
                                                   Q
                                                
                                                
                                                   pub
                                                
                                             
                                             +
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   Q
                                                
                                                
                                                   c
                                                
                                             
                                             )
                                             ·
                                             
                                                
                                                   d
                                                
                                                
                                                   
                                                      
                                                         ID
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                             
                                             )
                                             ,
                                             Q
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        Therefore, the attacker should have the secret key s to make the private identity 
                           
                              
                                 
                                    d
                                 
                                 
                                    
                                       
                                          ID
                                       
                                       
                                          c
                                       
                                    
                                 
                              
                           
                         for forging the legal identity. But the secret key s is kept secret by the LO and LPC.

Second, the selected lottery number 
                           
                              
                                 
                                    Num
                                 
                                 
                                    A
                                 
                              
                           
                         should be checked as follows:
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   1
                                                
                                             
                                             =
                                          
                                       
                                       
                                          
                                             
                                             x
                                             [
                                             R
                                             ]
                                             ·
                                             
                                                
                                                   Q
                                                
                                                
                                                   c
                                                
                                             
                                             +
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   ∗
                                                
                                             
                                             )
                                             ·
                                             
                                                
                                                   R
                                                
                                                
                                                   c
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             =
                                          
                                       
                                       
                                          
                                             
                                             (
                                             x
                                             [
                                             R
                                             ]
                                             )
                                             ·
                                             
                                                
                                                   N
                                                
                                                
                                                   c
                                                
                                             
                                             ·
                                             Q
                                             +
                                             (
                                             
                                                
                                                   r
                                                
                                                
                                                   c
                                                
                                                
                                                   -
                                                   1
                                                
                                             
                                             (
                                             Num
                                             -
                                             
                                                
                                                   N
                                                
                                                
                                                   c
                                                
                                             
                                             ·
                                             x
                                             [
                                             R
                                             ]
                                             )
                                             (
                                             
                                                
                                                   r
                                                
                                                
                                                   c
                                                
                                             
                                             ·
                                             Q
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             =
                                          
                                       
                                       
                                          
                                             
                                             (
                                             x
                                             [
                                             R
                                             ]
                                             )
                                             ·
                                             
                                                
                                                   N
                                                
                                                
                                                   c
                                                
                                             
                                             ·
                                             Q
                                             +
                                             (
                                             Num
                                             -
                                             
                                                
                                                   N
                                                
                                                
                                                   c
                                                
                                             
                                             ·
                                             x
                                             [
                                             R
                                             ]
                                             )
                                             Q
                                          
                                       
                                    
                                    
                                       
                                          
                                             =
                                          
                                       
                                       
                                          
                                             
                                             (
                                             Num
                                             )
                                             Q
                                          
                                       
                                    
                                    
                                       
                                          
                                             ≠
                                          
                                       
                                       
                                          
                                             
                                             (
                                             
                                                
                                                   Num
                                                
                                                
                                                   A
                                                
                                             
                                             )
                                             Q
                                             =
                                             
                                                
                                                   V
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Thus, it cannot pass the verification, unless the attacker knows the nonce 
                           
                              
                                 
                                    N
                                 
                                 
                                    c
                                 
                              
                           
                        . But nonce 
                           
                              
                                 
                                    N
                                 
                                 
                                    c
                                 
                              
                           
                         was generated by the coordinator and can never be disclosed.

Due to repeated forgery attempts (such as double claiming, without sharing with anyone else) taking place in lotteries, it is important to be able to verify a participant’s identity. This study discusses three cases of attempted forgery that are addressed by the proposed protocol.
                           
                              Case 1:
                              The attacker impersonates a legal coordinator.

The attacker uses the request message 
                                    
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             c
                                          
                                       
                                       ,
                                       
                                          
                                             T
                                          
                                          
                                             c
                                          
                                       
                                       ,
                                       
                                          
                                             H
                                          
                                          
                                             
                                                
                                                   ID
                                                
                                                
                                                   c
                                                
                                             
                                          
                                       
                                       ,
                                       Num
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             c
                                          
                                       
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             c
                                          
                                          
                                             ∗
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             c
                                          
                                       
                                       )
                                    
                                  to request a participant’s information. He/she can get the replay message 
                                    
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             C
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                  and use the nonce 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             c
                                          
                                       
                                    
                                  to generate the session key 
                                    
                                       
                                          
                                             CK
                                          
                                          
                                             c
                                             ,
                                             i
                                          
                                       
                                       =
                                       
                                          
                                             N
                                          
                                          
                                             c
                                          
                                       
                                       ·
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 . However, an attack that extracts nonce 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             c
                                          
                                       
                                    
                                  is difficult to achieve because of the Elliptic Curve Discrete Log Problem (ECDLP) from 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             c
                                          
                                       
                                    
                                 . Therefore, the attacker cannot obtain the participant’s real identity 
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                    
                                 .

The attacker impersonates a legal participant.

If the LPC agrees to the purchase, it will generate shadow 
                                    
                                       
                                          
                                             SHK
                                          
                                          
                                             i
                                          
                                       
                                    
                                  for every participant from 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             buy
                                          
                                       
                                    
                                  and send them to participants, respectively. Even if the attacker gets the messages 
                                    
                                       (
                                       
                                          
                                             RQ
                                          
                                          
                                             LPC
                                          
                                       
                                       ,
                                       
                                          
                                             ST
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             RV
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                 ; he/she must have a private identity 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             
                                                
                                                   ID
                                                
                                                
                                                   c
                                                
                                             
                                          
                                       
                                    
                                  to receive the shadow as follows:
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            RV
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ⊕
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      (
                                                      e
                                                      (
                                                      s
                                                      ·
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            
                                                               
                                                                  ID
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            RQ
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      )
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                      
                                                         
                                                            RV
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ⊕
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      (
                                                      e
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  H
                                                               
                                                               
                                                                  
                                                                     
                                                                        ID
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  N
                                                               
                                                               
                                                                  LPC
                                                               
                                                            
                                                            ·
                                                            Q
                                                            )
                                                         
                                                         
                                                            s
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                      
                                                         
                                                            RV
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ⊕
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      (
                                                      e
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  H
                                                               
                                                               
                                                                  
                                                                     
                                                                        ID
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                               
                                                            
                                                            ,
                                                            Q
                                                            )
                                                         
                                                         
                                                            s
                                                            ·
                                                            
                                                               
                                                                  N
                                                               
                                                               
                                                                  LPC
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                      
                                                         
                                                            SHK
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ⊕
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      (
                                                      e
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  H
                                                               
                                                               
                                                                  
                                                                     
                                                                        ID
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  Q
                                                               
                                                               
                                                                  pub
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            
                                                               
                                                                  N
                                                               
                                                               
                                                                  LPC
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                      ⊕
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      (
                                                      e
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  H
                                                               
                                                               
                                                                  
                                                                     
                                                                        ID
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                               
                                                            
                                                            ,
                                                            s
                                                            ·
                                                            Q
                                                            )
                                                         
                                                         
                                                            
                                                               
                                                                  N
                                                               
                                                               
                                                                  LPC
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                      
                                                         
                                                            SHK
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

However, the private identity 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             
                                                
                                                   ID
                                                
                                                
                                                   c
                                                
                                             
                                          
                                       
                                    
                                  and secret key s can never be leaked, so it is impossible for an attacker to obtain the shadow 
                                    
                                       
                                          
                                             SHK
                                          
                                          
                                             i
                                          
                                       
                                    
                                 .

The attacker impersonates a legal winning participant.

When a participant presents 
                                    
                                       
                                          
                                             SHK
                                          
                                          
                                             i
                                          
                                       
                                    
                                  and Num to claim a prize, the LO will index by Num to find the corresponding 
                                    
                                       
                                          
                                             K
                                          
                                          
                                             i
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             T
                                          
                                          
                                             i
                                             ,
                                             LO
                                          
                                       
                                    
                                  in the database. The LO then checks the legality as follows:
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            T
                                                         
                                                         
                                                            i
                                                            ,
                                                            LO
                                                         
                                                      
                                                      ·
                                                      
                                                         
                                                            T
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ⊕
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            
                                                               
                                                                  ID
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                      (
                                                      
                                                         
                                                            K
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            
                                                               
                                                                  SH
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  LO
                                                               
                                                            
                                                         
                                                      
                                                      ·
                                                      
                                                         
                                                            K
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            
                                                               
                                                                  SHK
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                      ⊕
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            
                                                               
                                                                  ID
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     K
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     f
                                                                     (
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     )
                                                                     (
                                                                     -
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     /
                                                                     (
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     -
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                     )
                                                                  
                                                               
                                                               ·
                                                               
                                                                  
                                                                     K
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     f
                                                                     (
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                     (
                                                                     -
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     /
                                                                     (
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     -
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     )
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      ⊕
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            
                                                               
                                                                  ID
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     K
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     (
                                                                     c
                                                                     ·
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     +
                                                                     
                                                                        
                                                                           SK
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     )
                                                                     (
                                                                     -
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     /
                                                                     (
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     -
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                     )
                                                                  
                                                               
                                                               ·
                                                               
                                                                  
                                                                     K
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     (
                                                                     c
                                                                     ·
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     +
                                                                     
                                                                        
                                                                           SK
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     )
                                                                     (
                                                                     -
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     /
                                                                     (
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     -
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     )
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      ⊕
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            
                                                               
                                                                  ID
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     K
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     (
                                                                     -
                                                                     c
                                                                     ·
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     ·
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     +
                                                                     c
                                                                     ·
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     ·
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     +
                                                                     
                                                                        
                                                                           SK
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     (
                                                                     -
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     +
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     )
                                                                     /
                                                                     (
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           LO
                                                                        
                                                                     
                                                                     -
                                                                     
                                                                        
                                                                           H
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 ID
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      ⊕
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            
                                                               
                                                                  ID
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        (
                                                                        
                                                                           
                                                                              N
                                                                           
                                                                           
                                                                              LPC
                                                                           
                                                                        
                                                                        ⊕
                                                                        
                                                                           
                                                                              H
                                                                           
                                                                           
                                                                              
                                                                                 
                                                                                    ID
                                                                                 
                                                                                 
                                                                                    i
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                        )
                                                                     
                                                                     
                                                                        
                                                                           
                                                                              PK
                                                                           
                                                                           
                                                                              LO
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  SK
                                                               
                                                               
                                                                  LO
                                                               
                                                            
                                                         
                                                      
                                                      ⊕
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            
                                                               
                                                                  ID
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                      
                                                         
                                                            N
                                                         
                                                         
                                                            LRC
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            N
                                                         
                                                         
                                                            LRC
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

If the participant is not a real winner, his/her identity will not be present in the database.

A participant’s ticket 
                           
                              
                                 
                                    TK
                                 
                                 
                                    c
                                 
                              
                           
                         is very important, so the proposed method encrypts this information into 
                           
                              
                                 
                                    C
                                 
                                 
                                    2
                                 
                              
                           
                         with his/her private identity 
                           
                              
                                 
                                    d
                                 
                                 
                                    
                                       
                                          ID
                                       
                                       
                                          c
                                       
                                    
                                 
                              
                           
                         and then blends it into the lottery ticket purchase phase as follows:
                           
                              
                                 
                                    
                                       C
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       
                                          
                                             d
                                          
                                          
                                             
                                                
                                                   ID
                                                
                                                
                                                   c
                                                
                                             
                                          
                                       
                                    
                                 
                                 (
                                 (
                                 
                                    
                                       Q
                                    
                                    
                                       c
                                    
                                 
                                 ,
                                 
                                    
                                       V
                                    
                                    
                                       buy
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       TK
                                    
                                    
                                       c
                                    
                                 
                                 ,
                                 
                                    
                                       timestamp
                                    
                                    
                                       c
                                    
                                 
                                 ,
                                 Num
                                 )
                              
                           
                        In particular, the participant’s information 
                           
                              (
                              
                                 
                                    ID
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    Q
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         is blended into 
                           
                              
                                 
                                    V
                                 
                                 
                                    buy
                                 
                              
                           
                         as follows:
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   buy
                                                
                                             
                                             =
                                             (
                                             
                                                
                                                   ID
                                                
                                                
                                                   1
                                                
                                             
                                             ‖
                                             
                                                
                                                   ID
                                                
                                                
                                                   2
                                                
                                             
                                             ‖
                                             …
                                             ‖
                                             
                                                
                                                   ID
                                                
                                                
                                                   n
                                                
                                             
                                             ‖
                                             
                                                
                                                   Q
                                                
                                                
                                                   1
                                                
                                             
                                             ‖
                                             
                                                
                                                   Q
                                                
                                                
                                                   2
                                                
                                             
                                             ‖
                                             …
                                             ‖
                                             
                                                
                                                   Q
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   buy
                                                
                                             
                                             =
                                             
                                                
                                                   M
                                                
                                                
                                                   buy
                                                
                                             
                                             ⊕
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             e
                                             
                                                
                                                   (
                                                   
                                                      
                                                         H
                                                      
                                                      
                                                         
                                                            
                                                               ID
                                                            
                                                            
                                                               c
                                                            
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         pub
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      
                                                         N
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        Only the LO and LPC have the secret key s to make the private identity 
                           
                              
                                 
                                    d
                                 
                                 
                                    IDi
                                 
                              
                           
                        , as follows:
                           
                              
                                 
                                    
                                       d
                                    
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 s
                                 ·
                                 
                                    
                                       H
                                    
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                              
                           
                        Thus participants’ identities are secret during the transactions.

In the winning number generation phase, the decryptor selects and publishes the winning number message 
                           
                              (
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              ‖
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                                 
                                    ′
                                 
                              
                              ‖
                              …
                              ‖
                              
                                 
                                    V
                                 
                                 
                                    6
                                 
                                 
                                    ′
                                 
                              
                              ‖
                              M
                              ‖
                              
                                 
                                    e
                                 
                                 
                                    p
                                 
                              
                              ‖
                              
                                 
                                    d
                                 
                                 
                                    p
                                 
                              
                              ‖
                              
                                 
                                    n
                                 
                                 
                                    p
                                 
                              
                              )
                           
                        . The participants can use the published parameters 
                           
                              (
                              M
                              ‖
                              
                                 
                                    e
                                 
                                 
                                    p
                                 
                              
                              ‖
                              
                                 
                                    d
                                 
                                 
                                    p
                                 
                              
                              |
                              |
                              
                                 
                                    n
                                 
                                 
                                    p
                                 
                              
                              )
                           
                         to verify the published winning numbers 
                           
                              (
                              
                                 
                                    wno
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    wno
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    wno
                                 
                                 
                                    6
                                 
                              
                              )
                           
                         as follows:
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             check
                                             
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                                
                                                   
                                                      
                                                         e
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                
                                             
                                             ·
                                             (
                                             
                                                
                                                   no
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             mod
                                             
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                             
                                             ≟
                                             
                                             
                                                
                                                   M
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             for
                                             
                                             i
                                             =
                                             1
                                             
                                             to
                                             
                                             k
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             check
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                
                                             
                                             ·
                                             
                                                
                                                   t
                                                
                                                
                                                   j
                                                
                                                
                                                   -
                                                   1
                                                
                                             
                                             
                                             ≟
                                             
                                             
                                                
                                                   V
                                                
                                                
                                                   j
                                                
                                                
                                                   ′
                                                
                                             
                                             ,
                                             for
                                             
                                             j
                                             =
                                             1
                                             
                                             to
                                             
                                             6
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             check
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         V
                                                      
                                                      
                                                         j
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      
                                                         e
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                
                                             
                                             mod
                                             
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                             
                                             ≟
                                             
                                             
                                                
                                                   wno
                                                
                                                
                                                   u
                                                
                                             
                                             ,
                                             for
                                             
                                             j
                                             =
                                             1
                                             
                                             to
                                             
                                             6
                                          
                                       
                                    
                                 
                              
                           
                        If anyone challenges the result of the winning numbers 
                           
                              (
                              
                                 
                                    wno
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    wno
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    wno
                                 
                                 
                                    6
                                 
                              
                              )
                           
                        , they can use the pseudo-random number generation function PRG(·) with M to generate the winning numbers again.

The lottery protocol should ensure an equal probability of winning the prize for every participant. The decryptor’s winning number generating function cannot be controlled or influenced by the LO or any participants. In the proposed protocol, the untraceable and tamperproof decryptor is independent, despite being set up by the LO. When the LO sends the selected numbers 
                           
                              
                                 
                                    no
                                 
                                 
                                    i
                                 
                              
                           
                         to the decryptor, the decryptor automatically generates a pair of parameters e/d for itself. Even if the decryptor publishes the parameters after generating the winning numbers, the LO or participants will not be able to guess the parameters for the next generation. Because the decryptor uses the real random number function to generate parameters, the real number has a corresponding random number 
                           
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                           
                        . For this reason, the real random numbers have a new fake number 
                           
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                           
                         for every iteration by new parameters 
                           
                              (
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    e
                                 
                                 
                                    p
                                 
                              
                              ,
                              
                                 
                                    d
                                 
                                 
                                    p
                                 
                              
                              ,
                              
                                 
                                    n
                                 
                                 
                                    p
                                 
                              
                              )
                           
                        . The queue is also different every time in the decryptor. Since no one can predict the outcome, the winning number generation is fair.

If the LO distributes the winning prize, he/she should accurately know how many participants are engaged in the lottery. In the purchase phase, the coordinator integrates participants’ information into purchase message 
                           
                              
                                 
                                    M
                                 
                                 
                                    buy
                                 
                              
                           
                        ; the LPC then follows the message to generate shadows and the LO stores the purchase message in the database. When a participant claims a prize, the LO will generate correlated shadow keys by the purchase message. If the participant is a legal winner, the LO checks:
                           
                              
                                 
                                    
                                       N
                                    
                                    
                                       LRC
                                    
                                    
                                       ′
                                    
                                 
                                 
                                 ≟
                                 
                                 
                                    
                                       N
                                    
                                    
                                       LPC
                                    
                                 
                              
                           
                        Moreover, the purchase message includes participants’ information. The LO can count the number of the purchase in order to determining which prize/s should be allocated to each winning participant.

This section compares the performance of the proposed method in terms of security and computation costs, and compares this performance with those of other methods to show the contribution of this paper. First, the security and function analysis of the proposed protocol is compared with previous protocols in Table 1
                     . From this it is clear that the proposed protocol can withstand attacks and satisfy the known requirements, while other protocols cannot. Chow et al. and Lee and Chang’s protocol only use the pseudo-random function to generate winning numbers. These other protocols cannot, therefore, defend against known attacks. Moreover, they do not satisfy the fairness, accuracy and public verification request requirements in a mobile environment. Therefore, a participant in the proposed protocol can use his/her cell phone or mobile device to simply and safely purchase lottery numbers by him/herself or jointly with other participants.

Subsequently, Table 2
                      summarizes the performance of the proposed protocol in terms of joint purchase, lottery ticket purchase, and prize claiming. This study defines some notations for the proposed protocol as follows:
                        
                           
                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          e
                                       
                                    
                                 
                              : the time taken to execute a bilinear map operation 
                                 
                                    e
                                    :
                                    
                                       
                                          G
                                       
                                       
                                          1
                                       
                                    
                                    ×
                                    
                                       
                                          G
                                       
                                       
                                          1
                                       
                                    
                                    →
                                    
                                       
                                          G
                                       
                                       
                                          2
                                       
                                    
                                 
                              .


                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          mul
                                       
                                    
                                 
                              : the time taken to execute a multiplication operation of point.


                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          H
                                          1
                                       
                                    
                                 
                              : the time taken to execute a one-way hash function 
                                 
                                    
                                       
                                          h
                                       
                                       
                                          1
                                       
                                    
                                 
                              (·).


                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          H
                                          2
                                       
                                    
                                 
                              : the time taken to execute a map-to-point hash function 
                                 
                                    
                                       
                                          h
                                       
                                       
                                          2
                                       
                                    
                                 
                              (·).


                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          add
                                       
                                    
                                 
                              : the time taken to execute an addition operation of points.


                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          exp
                                       
                                    
                                 
                              : the time taken to execute a modular exponentiation operation.


                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          sym
                                       
                                    
                                 
                              : the time taken to execute a symmetrical encryption/decryption operation.


                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          XOR
                                       
                                    
                                 
                              : the time taken to execute an XOR operation.


                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          sign
                                       
                                    
                                 
                              : the time taken to sign a signature.


                              m: the number of participants.

The time taken to execute a bilinear map operation 
                        
                           
                              
                                 T
                              
                              
                                 e
                              
                           
                        
                      is longer than other operations, with the exclusion of the time taken to execute a symmetrical encryption/decryption operation 
                        
                           
                              
                                 T
                              
                              
                                 sym
                              
                           
                        
                     . Some lightweight operations of the simulation results demonstrate that 
                        
                           
                              
                                 T
                              
                              
                                 add
                              
                           
                        
                      and 
                        
                           
                              
                                 T
                              
                              
                                 H
                                 1
                              
                           
                        
                      are trivial in comparison with 
                        
                           
                              
                                 T
                              
                              
                                 e
                              
                           
                           ,
                           
                              
                                 T
                              
                              
                                 mul
                              
                           
                        
                      and 
                        
                           
                              
                                 T
                              
                              
                                 H
                                 2
                              
                           
                        
                     . The operation of the participant’s mobile device is lightweight while the lottery proxy center and lottery originator are regarded as powerful devices.

In Table 2, it is seen that the participant plays a part in every phase, but his/her computation cost is not heavy. The coordinator joins other participant information and purchase lottery. However, his/her computation is similar to that of other participants. The LO should maintain low computation to keep the system stable, even if the LO is a powerful server. Obviously, the LPC has high computation cost; it must verify the coordinator’s identity, generate lottery numbers for every participant and send participant information to the LO. This is necessary so that the proposed scheme can prevent the attacks discussed above, and so that participants can claim their prizes. Based on the description above, the ticket purchase process can be guaranteed by the proposed lottery ticket purchase protocol with low computation cost.

@&#CONCLUSIONS@&#

In general, lottery participants must purchase physical lottery tickets in stores. However, smart phones and mobile devices have become very popular and powerful, and are capable of supporting secure mobile environments. This study therefore proposes a fair and secure protocol allowing users to safely and fairly purchase lottery tickets by smart phone.

Since ECC is easily implemented in mobile devices, a joint e-lottery scheme is proposed. The proposed scheme can achieve security and particular requests as follows:
                        
                           •
                           Support e-lottery activity.

Public verification.

Fairness.

Defend against known attacks.

Mutual authentication.

In the proposed scheme, even if the coordinator wishes to pocket prizes without sharing with anyone else, they will fail. This is because winning participants can claim prizes independently, even if the coordinator misappropriates the prize. Furthermore, the fairness of the winning number is ensured by the use of an untraceable and tamperproof decryptor with a real random number generation function. It can also provide public verification by a pseudo-random number generation function.

Based on the performance analysis, the proposed lottery protocol can satisfy the fairness, accuracy, and public verification requests in a mobile environment requirements. As a result, each mobile user can easily purchase lottery numbers using their smart device. In addition, the proposed protocol can prevent the various malicious attacks discussed above with low computation costs. Future research will investigate participant commissions join other brokers to claim prizes in a mobile environment.

@&#ACKNOWLEDGEMENTS@&#

This research was supported by the Ministry of Science and Technology, Taiwan, ROC, under contract number MOST 103-2221-E-324 -023, MOST 103-2622-E-212-009 -CC2, MOST103-2632-E-324-001-MY3 and MOT 104-2221-E-324-012.

@&#REFERENCES@&#

