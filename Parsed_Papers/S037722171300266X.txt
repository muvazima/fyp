@&#MAIN-TITLE@&#A stochastic aggregate production planning model in a green supply chain: Considering flexible lead times, nonlinear purchase and shortage cost functions

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Quantity discount is considered to encourage the producer to order more quantities.


                        
                        
                           
                           Interrelationship between lead time, transportation cost, and GHGs is considered.


                        
                        
                           
                           Demand uncertainty is assumed to follows a pre-specified distribution function.


                        
                        
                           
                           Shortages are penalized by a generic nonlinear multiple breakpoint function.


                        
                        
                           
                           The concepts of GHG emission and waste management are incorporated into the model.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Supply chain management

Aggregate production planning

Green principles

Quantity discount

Nonlinear shortage cost

Demand uncertainty

@&#ABSTRACT@&#


               
               
                  In this paper we develop a stochastic programming approach to solve a multi-period multi-product multi-site aggregate production planning problem in a green supply chain for a medium-term planning horizon under the assumption of demand uncertainty. The proposed model has the following features: (i) the majority of supply chain cost parameters are considered; (ii) quantity discounts to encourage the producer to order more from the suppliers in one period, instead of splitting the order into periodical small quantities, are considered; (iii) the interrelationship between lead time and transportation cost is considered, as well as that between lead time and greenhouse gas emission level; (iv) demand uncertainty is assumed to follow a pre-specified distribution function; (v) shortages are penalized by a general multiple breakpoint function, to persuade producers to reduce backorders as much as possible; (vi) some indicators of a green supply chain, such as greenhouse gas emissions and waste management are also incorporated into the model. The proposed model is first a nonlinear mixed integer programming which is converted into a linear one by applying some theoretical and numerical techniques. Due to the convexity of the model, the local solution obtained from linear programming solvers is also the global solution. Finally, a numerical example is presented to demonstrate the validity of the proposed model.
               
            

@&#INTRODUCTION@&#

Awareness of the environment has been increasing in the last few decades. More people are conscious of the world’s environmental problems such as global warming, toxic substance usage, and a decrease of non-renewable resources. In response to this threat, a number of organizations are applying ‘green’ principles, such as using environmentally friendly raw materials and recycled paper for packaging, and reducing the use of fossil fuels (Mirzapour Al-e-hashem et al., 2011c). These green principles have been expanded to many areas of work, including supply chains. Green Supply Chain Management (GSCM) has been emerging in the last few years (Markovitz-Somogyi et al., 2009). Adding the ‘green’ concept to the ‘supply chain’ concept creates a new paradigm where the supply chain will have a direct relation to the environment. This is interesting because historically, these two paradigms have been in head-on collision with each other (Srivastava, 2007). This idea covers every stage in manufacturing and in the life cycle of product, i.e. from product design to recycling (see for example Diabat and Govindan, 2011; Wang et al., 2011; Zhu and Sarkis, 2011; Eltayeb et al., 2011; Yeh and Chuang, 2011; Bai and Sarkis, 2010; Sheu, 2008; Kumar et al., 2012). Also, Min and Kim (2012) have presented a comprehensive review on green supply chain researches by studying more than five hundred papers.

Green logistics as a sub set of green supply chain has been expanding in the last few years (Srivastava, 2007). One comprehensive literature review of studies on green logistic is Dekker et al. (2012). They state that respect to the environment, transportation is the most visible aspect of supply chains. They examine four choices with respect to transportation which are supported by Operations Research models, namely, mode choice (or modal split), use of intermodal transport, equipment choice and fuel choice. The former choice in transport is the mode of transportation (mode choice), viz. transport by plane, ship, truck, rail, barge or pipelines. Each mode has different characteristics in terms of costs, transit time, accessibility, and also different environmental performance. In present study we use this method to embed the environmental issue in our model.

One of the most important questions in green logistics is how to identify preferred solutions balancing environmental and business concerns (Quariguasi Frota Neto et al., 2009). Quariguasi Frota Neto et al. (2009) have emphasized that Improving environmental quality comes at a cost, so the question is which trade-offs occur between the environmental impacts of an economic activity and its costs, and what are best solutions balancing ecological and economic concerns? The aim is to determine solutions in which environmental damage can only be decreased if costs are increased. These solutions are called eco-efficient. The idea of exploring best alternatives is based on Pareto-optimality (Huppes and Ishikawa, 2005).

One of the well known subjects that could be addressed in GSCM is aggregate production planning (APP), an operational activity that draws up an aggregate plan for the production process, in advance of 3–18months, to give an idea to management as to what quantity of materials and other resources are to be procured and when, so that the total cost of operations of the organization is kept to the minimum over that period. Many researchers have focused on APP from several years ago (Shi and Haase, 1996) and numerous APP models with differing degrees of difficulty have been developed in the last decades. Since Holt et al. (1955) presented the approach for the first time; scholars have proposed numerous models to help solve APP problems, each with their own supporters and detractors. In a comprehensive study, Nam and Logendran (1992) reviewed APP models from 140 journal articles and 14 books, and classified them into optimal and near-optimal models. Hanssman and Hess (1960) proposed a model based on the linear programming approach using a linear cost function of the decision variables. Haehling (1970) extended the Hanssman and Hess (1960) model for multi-product, multi-stage production systems in which optimal disaggregation decisions can be made under capacity constraints. Masoud and Hwang (1980) presented three Multi Criteria Decision Making Methods (MCDMs): Goal Programming (GP), sequential multi-objective problem and the step method. These methods are applied to solve APP problems by maximizing profits, and minimizing changes in workforce levels, inventory investments and backorders. Goodman (1974) proposed a GP model which approximates the original nonlinear cost structure of Holt’s model by linear terms and solves it applying a variant of the simplex method. Baykasoglu (2001) has extended Masud and Hwang’s model with more constraints such as sub-contractor selection and setup times. The integration of APP problems with other planning problems has been considered, for instance scheduling problems (Buxey, 1993; Foote et al., 1988), manpower planning problems (Mazzola et al., 1998), long set up time problems (Porkka et al., 2003; Xue et al., 2011) and supply chain planning (Ramezanian et al., 2012; Jamalnia and Soukhakian, 2009; Mirzapour Al-e-hashem et al., 2012, Mirzapour Al-e-hashem et al., 2011a,b).

@&#MOTIVATION@&#

However, the wide range of studies devoted to the APP and its integration with the other supply chain challenges, it is becoming increasingly difficult to ignore the gap of environmental aspect in this respect. According to the literature, to the best of our knowledge, while Mirzapour Al-e-hashem et al. (2011c) is the first attempt to adopt green concepts to aggregate production planning in deterministic condition, the present study is among the first to embed the concept of green logistic in aggregate production planning under uncertainty.

We incorporate the concept of green supply chain in two ways: 1 – mode choice; by considering transport mode decision variables (mode choice) to reduce GHGs. We assume an interrelationship between lead time and transportation mode: the shorter the lead times, the more expensive transportation will be, while also increasing GHGs and 2 – waste management; obviously a supply chain is also characterized by the products it supplies. Mirzapour Al-e-hashem et al. (2011b) consider only the inventory aspects of products, but we take a more comprehensive view. The point is that some products are friendlier to the environment than others. In other words, we assume each unit of product is associated with a percentage of waste, and we limit the total amount of waste produced by each factory.

Previous models dealing with supply chains mostly employ a simplified transportation cost function such as linear term in the objective function (see e.g. Ng et al., 2001 and Leblanc et al., 2004). This approach can be justified by assuming that these costs are part of the unit price (and therefore are managed by the supplier) or are fixed and incorporated into the ordering costs (Leenders et al., 2002). Despite the fact that linear (constant unit) transportation costs are desirable from a simplicity and tractability standpoint, they are often far from accurate (Carter et al., 1995). Thomas and Griffin (1996), Ertogral et al. (2007) and Hill and Galbreth (2008) identify the impact of complex shipping costs as an issue that has not been adequately addressed in the literature. In this paper we assume that the vehicle type can be selected among various available vehicle types and the transportation cost depends directly on the associated fixed and variables cost of selected vehicles.

Vendors usually offer quantity discounts to encourage the customer to order more, and the producer intends to discount the unit production cost if the amount of production is large. This study solves a nonlinear APP model capable of treating various quantity discount functions simultaneously, including linear, single breakpoint, step, and multiple breakpoint functions. In addition, we consider the shortage cost function as a multi-breakpoint nonlinear function to persuade the decision maker (DM) to reduce the backorders as much as possible.

Finally by introducing a new theoretical linearization technique and utilizing the previously available ones, the proposed nonlinear model is approximated to a solvable linear mixed integer program to obtain a global optimum. In the end, using the two-stage stochastic programming approach, a numerical example is analyzed to validate the model.

The rest of the manuscript is organized as follows: in Section 2, the problem description and model assumptions are presented. In Section 3 the model formulation is described and in Section 4 solution procedure is presented. The validity and applicability of the proposed model are demonstrated by an example in Section 5. Finally, conclusions and future research are presented in Section 6.

Aggregate production planning is a traditional problem that firms have to deal with. APP is concerned with the determination of production, inventory, and workforce levels to meet varying demand requirements over a medium-term planning horizon that ranges from 3 to 18months. The planning horizon is often divided into several periods. Typically, the physical resources of the firm are assumed to be fixed during the planning horizon of interest. Given the external demand requirements, the planning effort is oriented toward the best utilization of those resources (see Gallego, 2001).

The proposed multi-site APP problem in a supply chain can be described as follows:

There are K suppliers, J factories (plant), and I customers. In order to fulfill the uncertain demand of customers, each factory produces several product items grouped into N product families. Here we call this the product. Each product is made from only one raw material and should be supplied by the suppliers. Production costs (fixed and variable) of a certain item at different sites can be different. The procurement cost of the raw materials depends on the order size and can vary, that is, the larger the order, the lower the procurement cost per unit, while the basic price could be different among different suppliers. Each factory is characterized by its own inventory and production capacities. The latter is limited to the available workers and the allowed amount of regular working time and overtime. As all factories, suppliers and customers are spread out geographically, the transportation cost from suppliers to factories and from factories to customers can vary. The unit transportation cost is a function of the vehicle type that should be selected from the available vehicle types.

Given that storing products in customers’ zones is possible, and that backorders will be penalized by a nonlinear structure cost function, the problem is to determine: (1) the quantity of product n manufactured at factory j to fulfill the stochastic demand of customer zone i in each period of time; (2) the quantity of raw material n provided by supplier k in all periods to fulfill the net requirements of factory j with regard to lead time; (3) the number of workers hired and fired in each period; (4) the quantity of product n stored at factory j and customer zone i in each period; (5) the type of vehicle used for transportation of the products; (6) the amount of demand in each customer zone not met in each period, so that the total loss along the entire supply chain will be minimized regarding some green principles such as greenhouse gas emission and waste management.


                        
                           
                              
                                 
                                 
                                 
                                    
                                       
                                          Variables
                                       
                                       
                                    
                                    
                                       
                                          XR
                                          
                                             njt
                                          
                                       
                                       the amount of product type n produced at plant j in regular time of period t
                                       
                                    
                                    
                                       
                                          XO
                                          
                                             njt
                                          
                                       
                                       the amount of product type n produced at plant j in overtime of period t
                                       
                                    
                                    
                                       
                                          L
                                          
                                             jt
                                          
                                       
                                       available workers at plant j in period t
                                       
                                    
                                    
                                       
                                          F
                                          
                                             jt
                                          
                                       
                                       the number of workers fired at plant j in period t
                                       
                                    
                                    
                                       
                                          H
                                          
                                             jt
                                          
                                       
                                       the number of workers hired at plant j in period t
                                       
                                    
                                    
                                       
                                          I1
                                             njt
                                          
                                       
                                       inventory level of product type n at plant j at the end of period t
                                       
                                    
                                    
                                       
                                          I2
                                             nit
                                          
                                       
                                       inventory level of product type n at demand point i at the end of period t
                                       
                                    
                                    
                                       
                                          XQ
                                          
                                             nkjgt
                                          
                                       
                                       number of units of product type n shipped from supplier k(1, 2,…, K) to plant j in period t by vehicle type g(1, 2,…, G)
                                    
                                    
                                       
                                          YQ
                                          
                                             njigt
                                          
                                       
                                       number of units of product type n shipped from plant j to demand point i in period t by vehicle type g
                                       
                                    
                                    
                                       
                                          b
                                          
                                             nit
                                          
                                       
                                       shortage of product n in demand point i in period t
                                       
                                    
                                    
                                       
                                          Y
                                          
                                             njt
                                          
                                       
                                       a binary variable that determines whether plant j produces product type n in period t
                                       
                                    
                                    
                                       
                                          XV
                                          
                                             kjgt
                                          
                                       
                                       the number of vehicle type g used for transportation between supplier k and factory j
                                       
                                    
                                    
                                       
                                          YV
                                          
                                             jigt
                                          
                                       
                                       the number of vehicle type g used for transportation between factory j and customer zone i
                                       
                                    
                                    
                                       
                                          Parameters
                                       
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      nit
                                                   
                                                
                                                /
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      nit
                                                   
                                                   
                                                      s
                                                   
                                                
                                             
                                          
                                       
                                       demand for product n (1, 2,…, N) at demand point i(1, 2, … , I) in period t(1, 2, … , T)/under scenario s(1,…, S)
                                    
                                    
                                       
                                          CR
                                          
                                             jn
                                          
                                       
                                       the variable production cost for product type n in regular time at plant j
                                       
                                    
                                    
                                       
                                          CO
                                          
                                             jn
                                          
                                       
                                       the variable production cost for product type n in overtime at plant j
                                       
                                    
                                    
                                       
                                          PC
                                          
                                             nj
                                          
                                       
                                       the fixed production cost of product type n at plant j
                                       
                                    
                                    
                                       
                                          P
                                          
                                             ni
                                          
                                       
                                       sale price of product n at demand point i
                                       
                                    
                                    
                                       
                                          SC
                                          
                                             j
                                          
                                       
                                       labor cost at factory j
                                       
                                    
                                    
                                       
                                          a
                                          
                                             nj
                                          
                                       
                                       manpower needs to produce one unit of product type n at plant j
                                       
                                    
                                    
                                       
                                          FC
                                          
                                             j
                                          
                                       
                                       firing cost at factory j
                                       
                                    
                                    
                                       
                                          HC
                                          
                                             j
                                          
                                       
                                       hiring cost at factory j
                                       
                                    
                                    
                                       
                                          CI1
                                             nj
                                          
                                       
                                       inventory holding cost for product n at plant j
                                       
                                    
                                    
                                       
                                          CI2
                                             ni
                                          
                                       
                                       inventory holding cost for product n at demand point i
                                       
                                    
                                    
                                       
                                          α
                                       
                                       allowed fraction of overtime
                                    
                                    
                                       
                                          TV
                                          
                                             g
                                          
                                       
                                       the variable transportation cost of vehicle type g
                                       
                                    
                                    
                                       
                                          TF
                                          
                                             g
                                          
                                       
                                       the fixed transportation cost when vehicle type g is selected for transportation
                                    
                                    
                                       
                                          d1
                                             kj
                                          
                                       
                                       distance between supplier k and factory j
                                       
                                    
                                    
                                       
                                          d2
                                             ji
                                          
                                       
                                       distance between factory j and customer zone i
                                       
                                    
                                    
                                       
                                          CM
                                          
                                             nk
                                          
                                       
                                       cost of product type n provided by supplier k
                                       
                                    
                                    
                                       
                                          CP1
                                             j
                                          
                                       
                                       product storage capacity at plant j
                                       
                                    
                                    
                                       
                                          CP2
                                             j
                                          
                                       
                                       product storage capacity at customer zone i
                                       
                                    
                                    
                                       
                                          CS
                                          
                                             nk
                                          
                                       
                                       number of product type n that could be provided by supplier k in each period
                                    
                                    
                                       
                                          v
                                          
                                             n
                                          
                                       
                                       volume of a unit product type n (m3)
                                    
                                    
                                       
                                          V
                                          
                                             g
                                          
                                       
                                       the capacity of vehicle type g (m3)
                                    
                                    
                                       
                                          GHG
                                          
                                             g
                                          
                                       
                                       CO2 emissions for vehicle type g per distance unit
                                    
                                    
                                       
                                          GHl
                                          
                                             jt
                                          
                                       
                                       allowed greenhouse gas emission level in period t by factory j
                                       
                                    
                                    
                                       
                                          WT
                                       
                                       allowed amount of waste produced by each factory
                                    
                                    
                                       
                                          wp
                                       
                                       percentage of waste produced by product n in factory j
                                       
                                    
                                    
                                       
                                          LT
                                          
                                             nkjg
                                          
                                       
                                       lead time required for shipping product type n from supplier k to plant j using vehicle type g
                                       
                                    
                                    
                                       
                                          LT
                                          
                                             njig
                                          
                                       
                                       lead time required for shipping product type n from plant j to demand point i using vehicle type g
                                       
                                    
                                    
                                       
                                          π
                                          
                                             ni
                                          
                                       
                                       shortage cost of product n at demand point i
                                       
                                    
                                    
                                       
                                          ρ
                                          
                                             ξ
                                          
                                       
                                       occurrence probability of scenario s (1,…, S)
                                    
                                 
                              
                           
                        
                     

Objective function terms
                           
                              
                                 Labor cost
                              
                              
                                 
                                    
                                       (1)
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                SC
                                             
                                             
                                                j
                                             
                                          
                                          ·
                                          
                                             
                                                L
                                             
                                             
                                                jt
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                FC
                                             
                                             
                                                jt
                                             
                                          
                                          ·
                                          
                                             
                                                F
                                             
                                             
                                                jt
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                HC
                                             
                                             
                                                kj
                                             
                                          
                                          ·
                                          
                                             
                                                H
                                             
                                             
                                                jt
                                             
                                          
                                       
                                    
                                 
                              


                                 
                                    
                                       (2)
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   n
                                                   ,
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                          
                                          CI
                                          
                                             
                                                1
                                             
                                             
                                                nj
                                             
                                          
                                          ·
                                          I
                                          
                                             
                                                1
                                             
                                             
                                                njt
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   n
                                                   ,
                                                   i
                                                   ,
                                                   t
                                                
                                             
                                          
                                          CI
                                          
                                             
                                                2
                                             
                                             
                                                ni
                                             
                                          
                                          ·
                                          I
                                          
                                             
                                                2
                                             
                                             
                                                nit
                                             
                                          
                                       
                                    
                                 
                              


                                 
                                    
                                       (3)
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                   ,
                                                   j
                                                   ,
                                                   i
                                                   ,
                                                   g
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                TF
                                             
                                             
                                                g
                                             
                                          
                                          ·
                                          (
                                          
                                             
                                                XV
                                             
                                             
                                                kjgt
                                             
                                          
                                          +
                                          
                                             
                                                YV
                                             
                                             
                                                jigt
                                             
                                          
                                          )
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                   ,
                                                   j
                                                   ,
                                                   g
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                TV
                                             
                                             
                                                g
                                             
                                          
                                          d
                                          
                                             
                                                1
                                             
                                             
                                                kj
                                             
                                          
                                          
                                             
                                                XV
                                             
                                             
                                                kjgt
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   ,
                                                   i
                                                   ,
                                                   g
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                TV
                                             
                                             
                                                g
                                             
                                          
                                          d
                                          
                                             
                                                2
                                             
                                             
                                                ji
                                             
                                          
                                          ·
                                          
                                             
                                                YV
                                             
                                             
                                                jigt
                                             
                                          
                                       
                                    
                                 
                              


                                 
                                    
                                       (4)
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   n
                                                   ,
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                PC
                                             
                                             
                                                jt
                                             
                                          
                                          ·
                                          
                                             
                                                Y
                                             
                                             
                                                njt
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                   ,
                                                   g
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                CR
                                             
                                             
                                                jg
                                             
                                          
                                          ·
                                          
                                             
                                                XR
                                             
                                             
                                                njt
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                   ,
                                                   g
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                CO
                                             
                                             
                                                jg
                                             
                                          
                                          ·
                                          
                                             
                                                XO
                                             
                                             
                                                njt
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   n
                                                   ,
                                                   k
                                                   ,
                                                   j
                                                   ,
                                                   g
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                CM
                                             
                                             
                                                nk
                                             
                                          
                                          (
                                          
                                             
                                                XQ
                                             
                                             
                                                nkjgt
                                             
                                          
                                          )
                                          ·
                                          
                                             
                                                XQ
                                             
                                             
                                                nkjgt
                                             
                                          
                                       
                                    
                                 
                              


                                 
                                    
                                       (5)
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   n
                                                   ,
                                                   j
                                                   ,
                                                   i
                                                   ,
                                                   g
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                ni
                                             
                                          
                                          ·
                                          
                                             
                                                YQ
                                             
                                             
                                                njigt
                                             
                                          
                                       
                                    
                                 
                              


                                 
                                    
                                       (6)
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   n
                                                   ,
                                                   i
                                                   ,
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                π
                                             
                                             
                                                ni
                                             
                                          
                                          (
                                          
                                             
                                                B
                                             
                                             
                                                nit
                                             
                                          
                                          )
                                          ·
                                          
                                             
                                                B
                                             
                                             
                                                nit
                                             
                                          
                                       
                                    
                                 
                              

The GHG and waste limits introduced can be interpreted as an ethical boundary set by the corporate strategy or as a threshold over which the firm might pay extra taxes because of its emission ratio. In fact, the waste produced during the production process (wp) in our model is not tangible, contrary to defective products that force a plant to produce more than usual or to consider associated costs as an objective function. In our model the waste is of the same nature as GHGs. For example, some products in industry produce contaminated water during their production process. In some cases, the governmental rules limit the amount of industrial waste and emissions authorized, in order to protect the environment against their harmful effects. In fact wp is the rate at which each product produces these environmentally destructive impacts.

As noted above, vendors usually offer quantity discounts to encourage the customer to order more, and the producer discounts the unit production cost if the amount of production is large. In this research we propose an APP model capable of treating various quantity discount functions simultaneously, including linear, single breakpoint, step, and multiple breakpoint functions. A multiple breakpoint quantity discount function depicted in Fig. 1
                         can usually be represented as follows:
                           
                              (24)
                              
                                 
                                    
                                       CM
                                    
                                    
                                       nk
                                    
                                 
                                 (
                                 
                                    
                                       XQ
                                    
                                    
                                       nkjgt
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         CM
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         CM
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   )
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ⋮
                                                
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         CM
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where r
                        
                           i
                         is the slope when the quantity ordered is betweenXQ
                        
                           i
                         and XQ
                        
                           i+1, and m means there are m
                        −1 line segments in CM(XQ
                        
                           i
                        ). CM
                        
                           nk
                         is the unit purchase cost, but it is not constant to allow us to simply measure total purchase cost such as CM
                        
                           nk
                        
                        ×
                        XQ
                        
                           nkjgt
                        . In case of quantity discount, the purchase cost is a function of quantity ordered (see Fig. 1), it therefore must be written as: CM
                        
                           nk
                        (XQ
                        
                           nkjgt
                        )×
                        XQ
                        
                           nkjgt
                        , in which CM
                        
                           nk
                        (XQ
                        
                           nkjgt
                        ) means that CM is a function of XQ. Since the price and quantity discount functions are variable, the total cost function of the APP model is then formulated as a nonlinear form which is difficult to solve for finding a global solution (see Eq. (4)). In order to solve the APP model for obtaining a global solution, this study applies the linearization techniques presented in the next section.

Due to the difficulty of dealing with nonlinear functions, many APP models assume that the shortage cost is penalized by a linear function. We consider the shortage cost function as a multiple breakpoint nonlinear function to persuade the decision maker (DM) to reduce the backorders as much as possible. In this way, more backorders lead to more and more shortage costs; in other words, the slope of the penalty function gradually increases by the amount of backorders.

The relationship between backorders and shortage costs depicted in Fig. 2
                         could be formulated as follows:
                           
                              (25)
                              
                                 
                                    
                                       π
                                    
                                    
                                       ni
                                    
                                 
                                 (
                                 
                                    
                                       B
                                    
                                    
                                       nit
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         π
                                                      
                                                      
                                                         ni
                                                         1
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ni
                                                         1
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         π
                                                      
                                                      
                                                         ni
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ni
                                                         2
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   )
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ⋮
                                                
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         π
                                                      
                                                      
                                                         ni
                                                         (
                                                         q
                                                         -
                                                         1
                                                         )
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         niq
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         q
                                                         -
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         q
                                                         -
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         q
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

To linearize the multiple breakpoint discount function CM
                        
                           nk
                        (XQ
                        
                           nkjgt
                        ), we introduce a binary variable (t), and also convert variable XQ
                        
                           nkjgt
                         to m
                        −1 independent variables as 
                           
                              
                                 
                                    
                                       
                                          XQ
                                       
                                       
                                          m
                                       
                                    
                                 
                                 
                                    nkjgt
                                 
                              
                           
                        , where;


                        
                           
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    1
                                 
                                 
                                    m
                                    -
                                    1
                                 
                              
                              
                                 
                                    
                                       
                                          XQ
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 
                                    nkjgt
                                 
                              
                           
                        , so Eq. (24) can be rewritten as follows:
                           
                              (26)
                              
                                 
                                    
                                       CM
                                    
                                    
                                       nk
                                    
                                 
                                 (
                                 
                                    
                                       XQ
                                    
                                    
                                       nkjgt
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         CM
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               nkjgt
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         1
                                                         )
                                                      
                                                   
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               nkjgt
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         1
                                                         )
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         CM
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   )
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               nkjgt
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         2
                                                         )
                                                      
                                                   
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               nkjgt
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         2
                                                         )
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ⋮
                                                
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         CM
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   )
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               nkjgt
                                                            
                                                         
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               nkjgt
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         m
                                                         -
                                                         1
                                                         )
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Therefore, the last term of the Eq. (4) in the objective function (CM
                        
                           nk
                        (XQ
                        
                           nkjgt
                        )·
                        XQ
                        
                           nkjgt
                        ) could be expanded as
                           
                              (27)
                              
                                 CM
                                 (
                                 XQ
                                 )
                                 ·
                                 XQ
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         CM
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         (
                                                         1
                                                         )
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         1
                                                         )
                                                      
                                                   
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         (
                                                         1
                                                         )
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         CM
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   )
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         (
                                                         2
                                                         )
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         2
                                                         )
                                                      
                                                   
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         (
                                                         2
                                                         )
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ⋮
                                                
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         CM
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   )
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         (
                                                         m
                                                         -
                                                         1
                                                         )
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         m
                                                         -
                                                         1
                                                         )
                                                      
                                                   
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         m
                                                         -
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         (
                                                         m
                                                         -
                                                         1
                                                         )
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        As proved in Appendix A, with the help of m
                        −1 constraints, the equivalent mathematical structure of 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    n
                                    ,
                                    k
                                    ,
                                    j
                                    ,
                                    g
                                    ,
                                    t
                                 
                              
                              
                                 
                                    CM
                                 
                                 
                                    nk
                                 
                              
                              (
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                              )
                              ·
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                           
                         can be written as
                           
                              (28)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          k
                                          ,
                                          j
                                          ,
                                          g
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          m
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          (
                                          
                                             
                                                CM
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                r
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                                XQ
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          )
                                          
                                             
                                                
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                r
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               nkjgt
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (29)
                              
                                 
                                    
                                       
                                       
                                          
                                             s
                                             .
                                             t
                                             .
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   XQ
                                                
                                                
                                                   nk
                                                   (
                                                   m
                                                   -
                                                   1
                                                   )
                                                
                                             
                                             
                                                
                                                   t
                                                
                                                
                                                   nkjgt
                                                   (
                                                   m
                                                   -
                                                   1
                                                   )
                                                
                                             
                                             ⩽
                                             
                                                
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                
                                                
                                                   (
                                                   m
                                                   -
                                                   1
                                                   )
                                                
                                             
                                             ⩽
                                             
                                                
                                                   XQ
                                                
                                                
                                                   nkm
                                                
                                             
                                             
                                                
                                                   t
                                                
                                                
                                                   nkjgt
                                                   (
                                                   m
                                                   -
                                                   1
                                                   )
                                                
                                             
                                             
                                             ∀
                                             n
                                             ,
                                             k
                                             ,
                                             j
                                             ,
                                             g
                                             ,
                                             t
                                             ,
                                             m
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (30)
                              
                                 
                                    
                                       XQ
                                    
                                    
                                       nkjgt
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          m
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          XQ
                                       
                                       
                                          nkjgt
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 
                                 ∀
                                 n
                                 ,
                                 k
                                 ,
                                 j
                                 ,
                                 g
                                 ,
                                 t
                              
                           
                        
                        
                           
                              (31)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          m
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       
                                          
                                             nkijgm
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 =
                                 1
                                 
                                 ∀
                                 n
                                 ,
                                 k
                              
                           
                        There is also another linearization technique proposed by Tsai (2007) for multiple breakpoint functions. We have applied Tsai’s method for comparison with our proposed method. As shown in Appendix B, the equivalent linear form of the Eq. (24) based on Tsai’s techniques is simplified as follows:
                           
                              (32)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          k
                                          ,
                                          j
                                          ,
                                          g
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       CM
                                    
                                    
                                       nk
                                    
                                 
                                 (
                                 
                                    
                                       XQ
                                    
                                    
                                       nkjgt
                                    
                                 
                                 )
                                 
                                    
                                       XQ
                                    
                                    
                                       nkjgt
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          k
                                          ,
                                          j
                                          ,
                                          g
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          m
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                Z
                                             
                                             
                                                (
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       nkjgt
                                    
                                 
                              
                           
                        
                        
                           
                              (33)
                              
                                 
                                    
                                       
                                       
                                          
                                             s
                                             .
                                             t
                                             .
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      =
                                                      1
                                                   
                                                   
                                                      m
                                                      -
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   XQ
                                                
                                                
                                                   
                                                      
                                                         nkm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         
                                                            
                                                               nkjgtm
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             ⩽
                                             
                                                
                                                   XQ
                                                
                                                
                                                   nkjgt
                                                
                                             
                                             ⩽
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      =
                                                      1
                                                   
                                                   
                                                      m
                                                      -
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   XQ
                                                
                                                
                                                   nk
                                                   (
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   +
                                                   1
                                                   )
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         
                                                            
                                                               nkjgtm
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (34)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          m
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       
                                          
                                             nkjgtm
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 =
                                 1
                              
                           
                        
                        
                           
                              (35)
                              
                                 
                                    
                                       
                                       
                                          
                                             (
                                             
                                                
                                                   CM
                                                
                                                
                                                   
                                                      
                                                         nkm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   r
                                                
                                                
                                                   
                                                      
                                                         nkm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   XQ
                                                
                                                
                                                   
                                                      
                                                         nkm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             )
                                             
                                                
                                                   XQ
                                                
                                                
                                                   nkjgt
                                                
                                             
                                             +
                                             
                                                
                                                   r
                                                
                                                
                                                   
                                                      
                                                         nkm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   XQ
                                                
                                                
                                                   nkjgt
                                                
                                                
                                                   2
                                                
                                             
                                             -
                                             (
                                             1
                                             -
                                             
                                                
                                                   t
                                                
                                                
                                                   
                                                      
                                                         nkjgtm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             M
                                             ⩽
                                             
                                                
                                                   z
                                                
                                                
                                                   
                                                      
                                                         nkjgtm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (36)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   
                                                      
                                                         nkjgtm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             ⩽
                                             (
                                             
                                                
                                                   CM
                                                
                                                
                                                   
                                                      
                                                         nkm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   r
                                                
                                                
                                                   
                                                      
                                                         nkm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   XQ
                                                
                                                
                                                   
                                                      
                                                         nkm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             )
                                             
                                                
                                                   XQ
                                                
                                                
                                                   nkjgt
                                                
                                             
                                             +
                                             
                                                
                                                   r
                                                
                                                
                                                   
                                                      
                                                         nkm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   XQ
                                                
                                                
                                                   nkjgt
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             +
                                             (
                                             1
                                             -
                                             
                                                
                                                   t
                                                
                                                
                                                   
                                                      
                                                         nkjgtm
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             )
                                             M
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (37)
                              
                                 -
                                 
                                    
                                       t
                                    
                                    
                                       
                                          
                                             nkjgtm
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 M
                                 ⩽
                                 
                                    
                                       z
                                    
                                    
                                       
                                          
                                             nkjgm
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 ⩽
                                 
                                    
                                       t
                                    
                                    
                                       
                                          
                                             nkjgtm
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 M
                              
                           
                        Comparing the two methods, we have: In our proposed method (28)–(31), the nonlinear term 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                XQ
                                             
                                             
                                                nkjgt
                                             
                                          
                                       
                                       
                                          (
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                         is located in the objective function, while in the second method (32)–(37), this nonlinear term is located in the constraints. Despite of the fact that in both methods n
                        ×
                        k
                        ×
                        j
                        ×
                        g
                        ×
                        t
                        × (m
                        −1) extra binary (t) and nonzero (
                           
                              
                                 
                                    XQ
                                 
                                 
                                    (
                                    m
                                    )
                                 
                              
                           
                         or Z) variables are used for linearization, in the proposed method merely four different classes of constraints will be imposed on the primitive model while in Tsai’s (2007) method, seven new different classes of constraints will be added to the model. This comparison proves that the proposed method is preferred due to the smaller scale of the equivalent problem.

Using the proposed linearization method we convert the multiple breakpoint shortage cost function to an equivalent mathematical programming structure as follows:
                           
                              (38)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          i
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       π
                                    
                                    
                                       ni
                                    
                                 
                                 (
                                 
                                    
                                       B
                                    
                                    
                                       nit
                                    
                                 
                                 )
                                 ·
                                 
                                    
                                       B
                                    
                                    
                                       nit
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          i
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          q
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          (
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   
                                                      niq
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                γ
                                             
                                             
                                                
                                                   
                                                      niq
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                                B
                                             
                                             
                                                
                                                   
                                                      niq
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          )
                                          
                                             
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                γ
                                             
                                             
                                                
                                                   
                                                      niq
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (39)
                              
                                 
                                    
                                       
                                       
                                          
                                             s
                                             .
                                             t
                                             .
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   B
                                                
                                                
                                                   ni
                                                   (
                                                   q
                                                   -
                                                   1
                                                   )
                                                
                                             
                                             
                                                
                                                   τ
                                                
                                                
                                                   nit
                                                   (
                                                   q
                                                   -
                                                   1
                                                   )
                                                
                                             
                                             ⩽
                                             
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                
                                                
                                                   (
                                                   q
                                                   -
                                                   1
                                                   )
                                                
                                             
                                             ⩽
                                             
                                                
                                                   B
                                                
                                                
                                                   niq
                                                
                                             
                                             
                                                
                                                   τ
                                                
                                                
                                                   nit
                                                   (
                                                   q
                                                   -
                                                   1
                                                   )
                                                
                                             
                                             
                                             ∀
                                             n
                                             ,
                                             i
                                             ,
                                             t
                                             ,
                                             q
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (40)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          q
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       τ
                                    
                                    
                                       
                                          
                                             nitq
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 =
                                 1
                                 
                                 ∀
                                 n
                                 ,
                                 i
                              
                           
                        
                        
                           
                              (41)
                              
                                 
                                    
                                       B
                                    
                                    
                                       nit
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          q
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          nit
                                       
                                       
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                 ∀
                                 n
                                 ,
                                 i
                              
                           
                        where q is the number of segments, τ is a binary variable and γ is the slope of the segments.

These equivalent mathematical programs for quantity discount function and shortage cost are still not linear because of the existence of the nonlinear terms 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                         in the model.

In order to linearize the model we apply a famous technique, namely, piecewise linear programming. According to this technique (Chang, 2002; Li and Yu, 1999), to linearize a non-convex function f(x) we can use Eq. (42) as follows:
                           
                              (42)
                              
                                 L
                                 (
                                 f
                                 (
                                 x
                                 )
                                 )
                                 =
                                 f
                                 (
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 x
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                l
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          l
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   l
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       -
                                       
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   l
                                                
                                                
                                                   ′
                                                
                                             
                                             -
                                             1
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 |
                                 x
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 |
                                 +
                                 x
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       a
                                    
                                    
                                       m
                                    
                                 
                                 ⩾
                                 x
                                 ⩾
                                 α
                                 >
                                 0
                              
                           
                        where L(f(x)) is the piecewise linear form of thef(x) and, l is the number of divisions. The more divisions there are, the more precise the estimation will be, and the more computational complexities there will be. As shown in Fig. 3
                        , S
                        
                           l
                         is the slope of the lines, computed using the following equation:
                           
                              (43)
                              
                                 
                                    
                                       s
                                    
                                    
                                       l
                                    
                                 
                                 =
                                 
                                    
                                       f
                                       (
                                       
                                          
                                             a
                                          
                                          
                                             l
                                             +
                                             1
                                          
                                       
                                       )
                                       -
                                       f
                                       (
                                       
                                          
                                             a
                                          
                                          
                                             l
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             l
                                             +
                                             1
                                          
                                       
                                       -
                                       
                                          
                                             a
                                          
                                          
                                             l
                                          
                                       
                                    
                                 
                              
                           
                        According to Yu and Li (2000) and Li and Yu (1999), for a minimization problem, for s
                        
                           l
                        
                        >
                        s
                        
                           l−1 (shortage penalty function), the linear equivalent for the absolute term could be written as follows:
                           
                              (44)
                              
                                 Min
                                 
                                 L
                                 (
                                 f
                                 (
                                 x
                                 )
                                 )
                                 =
                                 f
                                 (
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 x
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                l
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          2
                                       
                                       
                                          l
                                          -
                                          1
                                       
                                    
                                 
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                       -
                                       1
                                    
                                 
                                 )
                                 (
                                 
                                    
                                       ξ
                                    
                                    
                                       1
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 +
                                 x
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (45)
                              
                                 s
                                 .
                                 t
                                 .
                                 
                                 x
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       l
                                    
                                 
                                 +
                                 
                                    
                                       ξ
                                    
                                    
                                       1
                                       l
                                    
                                 
                                 ⩾
                                 0
                                 ,
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       1
                                       l
                                    
                                 
                                 ⩾
                                 0
                              
                           
                        Also, for s
                        
                           l
                        
                        <
                        s
                        
                           l−1 (quantity discount function), the linear equivalent formulation for the absolute term could be written as follows:
                           
                              (46)
                              
                                 
                                    
                                       
                                          
                                             Min
                                             
                                          
                                       
                                       
                                          
                                             L
                                             (
                                             f
                                             (
                                             x
                                             )
                                             )
                                             =
                                             f
                                             (
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                             +
                                             
                                                
                                                   s
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             x
                                             -
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                             +
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      
                                                         
                                                            l
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      =
                                                      2
                                                   
                                                   
                                                      l
                                                      -
                                                      1
                                                   
                                                
                                             
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   s
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             -
                                             1
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             (
                                             -
                                             
                                                
                                                   ξ
                                                
                                                
                                                   2
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             +
                                             
                                                
                                                   u
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             +
                                             x
                                             -
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (47)
                              
                                 s
                                 .
                                 t
                                 .
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       2
                                       l
                                    
                                 
                                 ⩾
                                 x
                                 +
                                 M
                                 (
                                 
                                    
                                       u
                                    
                                    
                                       l
                                    
                                 
                                 -
                                 1
                                 )
                                 ,
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       2
                                       l
                                    
                                 
                                 ⩾
                                 0
                                 ,
                                 
                                 
                                    
                                       u
                                    
                                    
                                       l
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                              
                           
                        Therefore, by using Eqs. (44) and (46), the nonlinear terms 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                XQ
                                             
                                             
                                                nkjgt
                                             
                                          
                                       
                                       
                                          (
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                B
                                             
                                             
                                                nit
                                             
                                          
                                       
                                       
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                         are replaced by the equivalent piecewise linear form of 
                           
                              L
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                              ,
                              L
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        . Finally, by considering the constraints (45) and (47), the linear equivalent deterministic APP model for the supply chain could be written as follows:
                           
                              (48)
                              
                                 Min
                                 
                                 Z
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       SC
                                    
                                    
                                       j
                                    
                                 
                                 ·
                                 
                                    
                                       L
                                    
                                    
                                       jt
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       FC
                                    
                                    
                                       j
                                    
                                 
                                 ·
                                 
                                    
                                       F
                                    
                                    
                                       jt
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       HC
                                    
                                    
                                       j
                                    
                                 
                                 ·
                                 
                                    
                                       H
                                    
                                    
                                       jt
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          j
                                          ,
                                          t
                                       
                                    
                                 
                                 CI
                                 
                                    
                                       1
                                    
                                    
                                       nj
                                    
                                 
                                 ·
                                 I
                                 
                                    
                                       1
                                    
                                    
                                       njt
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          i
                                          ,
                                          t
                                       
                                    
                                 
                                 CI
                                 
                                    
                                       2
                                    
                                    
                                       ni
                                    
                                 
                                 ·
                                 I
                                 
                                    
                                       2
                                    
                                    
                                       nit
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          ,
                                          j
                                          ,
                                          i
                                          ,
                                          g
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       TF
                                    
                                    
                                       g
                                    
                                 
                                 ·
                                 (
                                 
                                    
                                       XV
                                    
                                    
                                       kjgt
                                    
                                 
                                 +
                                 
                                    
                                       YV
                                    
                                    
                                       jigt
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          ,
                                          j
                                          ,
                                          g
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       TV
                                    
                                    
                                       g
                                    
                                 
                                 d
                                 
                                    
                                       1
                                    
                                    
                                       kj
                                    
                                 
                                 
                                    
                                       XV
                                    
                                    
                                       kjgt
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          ,
                                          i
                                          ,
                                          g
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       TV
                                    
                                    
                                       g
                                    
                                 
                                 d
                                 
                                    
                                       2
                                    
                                    
                                       ji
                                    
                                 
                                 ·
                                 
                                    
                                       YV
                                    
                                    
                                       jigt
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          j
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       PC
                                    
                                    
                                       jt
                                    
                                 
                                 ·
                                 
                                    
                                       Y
                                    
                                    
                                       njt
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          j
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       CR
                                    
                                    
                                       jn
                                    
                                 
                                 ·
                                 
                                    
                                       XR
                                    
                                    
                                       njt
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          j
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       CO
                                    
                                    
                                       jn
                                    
                                 
                                 ·
                                 
                                    
                                       XO
                                    
                                    
                                       njt
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          k
                                          ,
                                          j
                                          ,
                                          g
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          m
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          (
                                          
                                             
                                                CM
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                r
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                                XQ
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          )
                                          
                                             
                                                
                                                   
                                                      
                                                         XQ
                                                      
                                                      
                                                         nkjgt
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                r
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          L
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        XQ
                                                                     
                                                                     
                                                                        nkjgt
                                                                     
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     
                                                                        m
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          i
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          q
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          (
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   
                                                      niq
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                γ
                                             
                                             
                                                
                                                   
                                                      niq
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                                B
                                             
                                             
                                                
                                                   
                                                      niq
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          )
                                          
                                             
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         nit
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                γ
                                             
                                             
                                                
                                                   
                                                      niq
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          L
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        B
                                                                     
                                                                     
                                                                        nit
                                                                     
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     
                                                                        q
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          ,
                                          j
                                          ,
                                          i
                                          ,
                                          g
                                          ,
                                          t
                                       
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       ni
                                    
                                 
                                 ·
                                 
                                    
                                       YQ
                                    
                                    
                                       njigt
                                    
                                 
                              
                           
                        
                        
                           
                              (49)
                              
                                 
                                    
                                       
                                          
                                             s
                                             .
                                             t
                                             .
                                          
                                       
                                       
                                    
                                    
                                       
                                       
                                          
                                             L
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           B
                                                                        
                                                                        
                                                                           nit
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     q
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                             =
                                             f
                                             (
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                             +
                                             
                                                
                                                   s
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     B
                                                                  
                                                                  
                                                                     nit
                                                                  
                                                               
                                                            
                                                            
                                                               (
                                                               q
                                                               )
                                                            
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            a
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      
                                                         
                                                            l
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      =
                                                      2
                                                   
                                                   
                                                      l
                                                      -
                                                      1
                                                   
                                                
                                             
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   s
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   -
                                                   1
                                                
                                             
                                             )
                                             (
                                             
                                                
                                                   ξ
                                                
                                                
                                                   1
                                                   
                                                      
                                                         nitql
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            nit
                                                         
                                                      
                                                   
                                                   
                                                      (
                                                      q
                                                      )
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (50)
                              
                                 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             nit
                                          
                                       
                                    
                                    
                                       (
                                       q
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       l
                                    
                                 
                                 +
                                 
                                    
                                       ξ
                                    
                                    
                                       1
                                       nitql
                                    
                                 
                                 ⩾
                                 0
                                 ,
                                 
                                 
                                 ∀
                                 n
                                 ,
                                 i
                                 ,
                                 t
                                 ,
                                 q
                                 ,
                                 l
                              
                           
                        
                        
                           
                              (51)
                              
                                 L
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               nkjgt
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 =
                                 f
                                 (
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             
                                                XQ
                                             
                                             
                                                nkjgt
                                             
                                          
                                       
                                       
                                          (
                                          m
                                          )
                                       
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                l
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          2
                                       
                                       
                                          l
                                          -
                                          1
                                       
                                    
                                 
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                       -
                                       1
                                    
                                 
                                 )
                                 (
                                 -
                                 
                                    
                                       ξ
                                    
                                    
                                       2
                                       
                                          
                                             nkjgtml
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       u
                                    
                                    
                                       
                                          
                                             nkjgtml
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             
                                                XQ
                                             
                                             
                                                nkjgt
                                             
                                          
                                       
                                       
                                          (
                                          m
                                          )
                                       
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (52)
                              
                                 
                                    
                                       ξ
                                    
                                    
                                       2
                                       nkjgtml
                                    
                                 
                                 ⩾
                                 
                                    
                                       
                                          
                                             XQ
                                          
                                          
                                             nkjgt
                                          
                                       
                                    
                                    
                                       (
                                       m
                                       )
                                    
                                 
                                 +
                                 M
                                 (
                                 
                                    
                                       u
                                    
                                    
                                       nkjgtml
                                    
                                 
                                 -
                                 1
                                 )
                                 ,
                                 
                                 ∀
                                 n
                                 ,
                                 k
                                 ,
                                 j
                                 ,
                                 g
                                 ,
                                 t
                                 ,
                                 m
                                 ,
                                 l
                              
                           
                        
                        
                           
                              (53)
                              
                                 
                                    
                                       
                                          
                                             XQ
                                          
                                          
                                             nkjgt
                                          
                                       
                                    
                                    
                                       (
                                       m
                                       )
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             nit
                                          
                                       
                                    
                                    
                                       (
                                       q
                                       )
                                    
                                 
                                 ,
                                 
                                    
                                       ξ
                                    
                                    
                                       1
                                       nitql
                                    
                                 
                                 ,
                                 
                                    
                                       ξ
                                    
                                    
                                       2
                                       nkjgtml
                                    
                                 
                                 ⩾
                                 0
                                 ,
                                 
                                    
                                       u
                                    
                                    
                                       nkjgtml
                                    
                                 
                                 ,
                                 
                                    
                                       τ
                                    
                                    
                                       nitq
                                    
                                 
                                 ,
                                 
                                    
                                       t
                                    
                                    
                                       nkjgtm
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                              
                           
                        And Constraints 8, (9)–(23), (29)–(31), (39)–(41), (43)
                     

In most of the previous researches, the lead time is usually assumed to be fixed. Consequently, the rational relationship between lead time and transportation mode is not taken into account, to avoid complexity in the modeling. In this research the inverse relationship between transportation cost and lead time is assumed as depicted in Fig. 4
                        .

On the other hand, our proposed model is capable of determining the vehicle type. The more expensive the selected vehicle, the shorter the lead time will be. There are also some interrelationships between the lead time and greenhouse gas emission levels; both are usually determined by some standard tables. For example if we compare aircraft and water freight as two different vehicle types, aircraft have a shorter lead time in comparison with water freight and, conversely, water freight has a lower level of greenhouse gas emissions compared to aircraft. As the model shows, the lead time is embedded as an index of period, which itself has indices of factory and supplier (or customer) in addition to the index of vehicle type.


                        Fig. 5
                         determines the greenhouse gas emission level for different vehicle types against their capacities. It is taken from the website of “Network for Transport and Environment” (NTM), which is a nonprofit organization initiated in 1993 and aimed at establishing a common base of values on how to calculate the environmental performance of various modes of transport (road, rail, sea and air).

In the first step we solve the proposed model with deterministic demand and report the solution. After that we consider a two stage stochastic programming approach to deal with demand uncertainty. In the two-stage framework, the supply, production and inventory (in factories) decisions for the current time period are made ‘here-and-now’ prior to the resolution of uncertainty, whereas the decisions for the rest of the time periods, such as distribution, shortage and inventory (in customer zones) are postponed in a ‘wait-and-see’ mode until after the uncertainties are revealed.

First-stage (FS) decision variables:
                        
                           (54)
                           
                              FS
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    SC
                                 
                                 
                                    j
                                 
                              
                              ·
                              
                                 
                                    L
                                 
                                 
                                    jt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    FC
                                 
                                 
                                    j
                                 
                              
                              ·
                              
                                 
                                    F
                                 
                                 
                                    jt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    HC
                                 
                                 
                                    j
                                 
                              
                              ·
                              
                                 
                                    H
                                 
                                 
                                    jt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       j
                                       ,
                                       t
                                    
                                 
                              
                              CI
                              
                                 
                                    1
                                 
                                 
                                    nj
                                 
                              
                              ·
                              I
                              
                                 
                                    1
                                 
                                 
                                    njt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ,
                                       j
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    TF
                                 
                                 
                                    g
                                 
                              
                              ·
                              
                                 
                                    XV
                                 
                                 
                                    kjgt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ,
                                       j
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    TV
                                 
                                 
                                    g
                                 
                              
                              d
                              
                                 
                                    1
                                 
                                 
                                    kj
                                 
                              
                              
                                 
                                    XV
                                 
                                 
                                    kjgt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       j
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    PC
                                 
                                 
                                    jt
                                 
                              
                              ·
                              
                                 
                                    Y
                                 
                                 
                                    njt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       j
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    CR
                                 
                                 
                                    jn
                                 
                              
                              ·
                              
                                 
                                    XR
                                 
                                 
                                    njt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       j
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    CO
                                 
                                 
                                    jn
                                 
                              
                              ·
                              
                                 
                                    XO
                                 
                                 
                                    njt
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       k
                                       ,
                                       j
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       1
                                    
                                    
                                       m
                                       -
                                       1
                                    
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          
                                             CM
                                          
                                          
                                             
                                                
                                                   nkm
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       -
                                       
                                          
                                             r
                                          
                                          
                                             
                                                
                                                   nkm
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       
                                          
                                             XQ
                                          
                                          
                                             
                                                
                                                   nkm
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       )
                                       
                                          
                                             
                                                
                                                   
                                                      XQ
                                                   
                                                   
                                                      nkjgt
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                L
                                                
                                                   
                                                      
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               
                                                                  
                                                                     nkm
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               XQ
                                                            
                                                            
                                                               nkjgt
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     Second-stage (SS) decision variables:
                        
                           (55)
                           
                              
                                 
                                    SS
                                 
                                 
                                    s
                                 
                              
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       i
                                       ,
                                       t
                                    
                                 
                              
                              CI
                              
                                 
                                    2
                                 
                                 
                                    ni
                                 
                              
                              ·
                              I
                              
                                 
                                    2
                                 
                                 
                                    nit
                                 
                                 
                                    s
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       ,
                                       i
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    TF
                                 
                                 
                                    g
                                 
                              
                              
                                 
                                    YV
                                 
                                 
                                    jigt
                                 
                                 
                                    s
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       ,
                                       i
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    TV
                                 
                                 
                                    g
                                 
                              
                              d
                              
                                 
                                    2
                                 
                                 
                                    ji
                                 
                              
                              ·
                              
                                 
                                    YV
                                 
                                 
                                    jigt
                                 
                                 
                                    s
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       i
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       1
                                    
                                    
                                       q
                                       -
                                       1
                                    
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          
                                             π
                                          
                                          
                                             
                                                
                                                   niq
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       -
                                       
                                          
                                             γ
                                          
                                          
                                             
                                                
                                                   niq
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       
                                          
                                             B
                                          
                                          
                                             
                                                
                                                   niq
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       )
                                       
                                          
                                             
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      nit
                                                   
                                                   
                                                      s
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       +
                                       L
                                       
                                          
                                             
                                                
                                                   
                                                      γ
                                                   
                                                   
                                                      
                                                         
                                                            niq
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     B
                                                                  
                                                                  
                                                                     nit
                                                                  
                                                                  
                                                                     s
                                                                  
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              -
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       j
                                       ,
                                       i
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    ni
                                 
                              
                              ·
                              
                                 
                                    YQ
                                 
                                 
                                    njigt
                                 
                                 
                                    s
                                 
                              
                           
                        
                     where s is the index of scenarios.

So the objective function for scenario s can be simplified as:
                        
                           (56)
                           
                              
                                 
                                    Z
                                 
                                 
                                    s
                                 
                              
                              =
                              FS
                              +
                              
                                 
                                    SS
                                 
                                 
                                    s
                                 
                              
                           
                        
                     Therefore, the two-stage stochastic optimization model is as follows:
                        
                           (57)
                           
                              Min
                              
                              Z
                              =
                              FS
                              +
                              E
                              (
                              
                                 
                                    SS
                                 
                                 
                                    s
                                 
                              
                              )
                           
                        
                     
                     
                        
                           (58)
                           
                              
                                 
                                    
                                       
                                          s
                                          .
                                          t
                                          .
                                       
                                    
                                    
                                 
                                 
                                    
                                    
                                       
                                          I
                                          
                                             
                                                2
                                             
                                             
                                                ni
                                                (
                                                t
                                                -
                                                1
                                                )
                                             
                                             
                                                s
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   ,
                                                   g
                                                
                                             
                                          
                                          
                                             
                                                YQ
                                             
                                             
                                                njig
                                                (
                                                t
                                                -
                                                LTjig
                                                )
                                             
                                             
                                                s
                                             
                                          
                                          -
                                          
                                             
                                                D
                                             
                                             
                                                nit
                                             
                                             
                                                s
                                             
                                          
                                          -
                                          
                                             
                                                B
                                             
                                             
                                                ni
                                                (
                                                t
                                                -
                                                1
                                                )
                                             
                                             
                                                s
                                             
                                          
                                          =
                                          I
                                          
                                             
                                                2
                                             
                                             
                                                nit
                                             
                                             
                                                s
                                             
                                          
                                          -
                                          
                                             
                                                B
                                             
                                             
                                                nit
                                             
                                             
                                                s
                                             
                                          
                                          
                                          ∀
                                          n
                                          ,
                                          i
                                          ,
                                          t
                                          ,
                                          s
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (59)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ,
                                       g
                                    
                                 
                              
                              
                                 
                                    XV
                                 
                                 
                                    kjgt
                                 
                              
                              ·
                              
                                 
                                    GHG
                                 
                                 
                                    g
                                 
                              
                              ·
                              d
                              
                                 
                                    1
                                 
                                 
                                    kj
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       ,
                                       g
                                    
                                 
                              
                              
                                 
                                    YV
                                 
                                 
                                    jigt
                                 
                                 
                                    s
                                 
                              
                              ·
                              
                                 
                                    GHG
                                 
                                 
                                    g
                                 
                              
                              ·
                              d
                              
                                 
                                    2
                                 
                                 
                                    ji
                                 
                              
                              ⩽
                              
                                 
                                    GHl
                                 
                                 
                                    jt
                                 
                              
                              
                              ∀
                              j
                              ,
                              t
                              ,
                              s
                           
                        
                     
                     
                        
                           (60)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    XV
                                 
                                 
                                    kjgt
                                 
                              
                              ·
                              
                                 
                                    EU
                                 
                                 
                                    g
                                 
                              
                              ·
                              d
                              
                                 
                                    1
                                 
                                 
                                    kj
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    YV
                                 
                                 
                                    jigt
                                 
                                 
                                    s
                                 
                              
                              ·
                              
                                 
                                    EU
                                 
                                 
                                    g
                                 
                              
                              ·
                              d
                              
                                 
                                    2
                                 
                                 
                                    ji
                                 
                              
                              ⩽
                              
                                 
                                    EUI
                                 
                                 
                                    j
                                 
                              
                              
                              ∀
                              j
                              ,
                              s
                           
                        
                     
                     
                        
                           (61)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                    
                                 
                              
                              I
                              
                                 
                                    2
                                 
                                 
                                    nit
                                 
                                 
                                    s
                                 
                              
                              ⩽
                              CP
                              
                                 
                                    2
                                 
                                 
                                    i
                                 
                              
                              
                              ∀
                              i
                              ,
                              t
                              ,
                              s
                           
                        
                     
                     
                        
                           (62)
                           
                              (
                              
                                 
                                    YV
                                 
                                 
                                    jigt
                                 
                                 
                                    s
                                 
                              
                              -
                              1
                              )
                              
                                 
                                    V
                                 
                                 
                                    g
                                 
                              
                              ⩽
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                    
                                 
                              
                              
                                 
                                    v
                                 
                                 
                                    n
                                 
                              
                              ·
                              
                                 
                                    YQ
                                 
                                 
                                    njigt
                                 
                                 
                                    s
                                 
                              
                              ⩽
                              
                                 
                                    YV
                                 
                                 
                                    jigt
                                 
                                 
                                    s
                                 
                              
                              
                                 
                                    V
                                 
                                 
                                    g
                                 
                              
                              
                              ∀
                              j
                              ,
                              i
                              ,
                              g
                              ,
                              t
                              ,
                              s
                           
                        
                     
                     
                        
                           (63)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       ,
                                       g
                                    
                                 
                              
                              
                                 
                                    YQ
                                 
                                 
                                    njigt
                                 
                                 
                                    s
                                 
                              
                              ⩽
                              
                                 
                                    XO
                                 
                                 
                                    njt
                                 
                              
                              +
                              
                                 
                                    XR
                                 
                                 
                                    njt
                                 
                              
                              
                              ∀
                              n
                              ,
                              j
                              ,
                              t
                              ,
                              s
                           
                        
                     
                     
                        
                           (64)
                           
                              
                                 
                                    B
                                 
                                 
                                    ni
                                    (
                                    q
                                    -
                                    1
                                    )
                                 
                              
                              
                                 
                                    τ
                                 
                                 
                                    nit
                                    (
                                    q
                                    -
                                    1
                                    )
                                 
                                 
                                    s
                                 
                              
                              ⩽
                              
                                 
                                    
                                       
                                          B
                                       
                                       
                                          nit
                                       
                                       
                                          s
                                       
                                    
                                 
                                 
                                    (
                                    q
                                    -
                                    1
                                    )
                                 
                              
                              ⩽
                              
                                 
                                    B
                                 
                                 
                                    niq
                                 
                              
                              
                                 
                                    τ
                                 
                                 
                                    nit
                                    (
                                    q
                                    -
                                    1
                                    )
                                 
                                 
                                    s
                                 
                              
                              
                              ∀
                              n
                              ,
                              i
                              ,
                              t
                              ,
                              q
                              ,
                              s
                           
                        
                     
                     
                        
                           (65)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       1
                                    
                                    
                                       q
                                       -
                                       1
                                    
                                 
                              
                              
                                 
                                    τ
                                 
                                 
                                    
                                       
                                          nitq
                                       
                                       
                                          ′
                                       
                                    
                                 
                                 
                                    s
                                 
                              
                              =
                              1
                              
                              ∀
                              n
                              ,
                              i
                              ,
                              s
                           
                        
                     
                     
                        
                           (66)
                           
                              
                                 
                                    B
                                 
                                 
                                    nit
                                 
                                 
                                    s
                                 
                              
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       1
                                    
                                    
                                       q
                                       -
                                       1
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             nit
                                          
                                          
                                             s
                                          
                                       
                                    
                                    
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                 
                              
                              
                              ∀
                              n
                              ,
                              i
                              ,
                              t
                              ,
                              s
                           
                        
                     
                     
                        
                           (67)
                           
                              L
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            nit
                                                         
                                                         
                                                            s
                                                         
                                                      
                                                   
                                                   
                                                      (
                                                      q
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                              =
                              f
                              (
                              
                                 
                                    a
                                 
                                 
                                    1
                                 
                              
                              )
                              +
                              
                                 
                                    s
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      nit
                                                   
                                                   
                                                      s
                                                   
                                                
                                             
                                             
                                                (
                                                q
                                                )
                                             
                                          
                                       
                                       -
                                       
                                          
                                             a
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       2
                                    
                                    
                                       l
                                       -
                                       1
                                    
                                 
                              
                              (
                              
                                 
                                    s
                                 
                                 
                                    
                                       
                                          l
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              -
                              
                                 
                                    s
                                 
                                 
                                    
                                       
                                          l
                                       
                                       
                                          ′
                                       
                                    
                                    -
                                    1
                                 
                              
                              )
                              
                                 
                                    
                                       
                                          
                                             ξ
                                          
                                          
                                             1
                                             
                                                
                                                   nitql
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      nit
                                                   
                                                   
                                                      s
                                                   
                                                
                                             
                                             
                                                (
                                                q
                                                )
                                             
                                          
                                       
                                       -
                                       
                                          
                                             a
                                          
                                          
                                             
                                                
                                                   l
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              ,
                              
                              ∀
                              n
                              ,
                              i
                              ,
                              t
                              ,
                              q
                              ,
                              s
                           
                        
                     
                     
                        
                           (68)
                           
                              
                                 
                                    
                                       
                                          B
                                       
                                       
                                          nit
                                       
                                       
                                          s
                                       
                                    
                                 
                                 
                                    (
                                    q
                                    )
                                 
                              
                              -
                              
                                 
                                    a
                                 
                                 
                                    l
                                 
                              
                              +
                              
                                 
                                    ξ
                                 
                                 
                                    1
                                    nitql
                                 
                                 
                                    s
                                 
                              
                              ⩾
                              0
                              ,
                              
                              ∀
                              n
                              ,
                              i
                              ,
                              t
                              ,
                              q
                              ,
                              l
                              ,
                              s
                           
                        
                     and constraints 10, (11), (12), (15), (16), (18), (21), (23), (29)–(31), (43), (51), (50)–(53)
                  

To apply the two-stage stochastic programming, the scenario-based approach is used to represent the uncertainties. To reduce the number of scenarios, we use a Monte Carlo sampling approach to generate the scenarios. Each scenario is then assigned the same probability with the sum of the probabilities for all the scenarios equal to 1. For example, if we use Monte Carlo sampling to generate 10 scenarios, the probability of each scenario is given as 0.1. The number of scenarios is determined using a statistical method to obtain solutions within specific confidence intervals for a desired level of accuracy. This method is very useful for scenario reduction, specifically for large-sized problems (see You et al., 2009).

@&#EXPERIMENTAL RESULTS@&#

A typical multi-national company is willing to plan its aggregate production planning. The planning time horizon is assumed to be six periods. The number of product families is assumed to be 4. The production and distribution network under consideration consists of three production sites F1, F2 and F3 which are spread out geographically, and three customer centers located in three different cities C1, C2 and C3. Raw materials are supplied by three suppliers located at S1, S2 and S3. We first assume that the demand is deterministic, as shown in Table 1
                     . And then solve the deterministic model accordingly. In the next step the demand is assumed to follow a normal distribution with the expected value and standard deviation equal to 400 and 100, respectively. The suppliers’ capacity is assumed to be 350. The cost items as well as the other data are presented in Tables 2–7
                     
                     
                     
                     
                     
                     . This numerical example is roughly inspired from a real case which is completely described in Mirzapour Al-e-hashem et al. (2011b).

All computations were run using IBM ILOG CPLEX 12.2 on a PC Pentium IV-2.5GHz Core 2 Duo processor and 2GB RAM DDR under win VISTA. Presented hereunder are the resulting solutions for which we have relied on a set of the above-mentioned data.

The regular time and the overtime devoted by each factory at each period to produce different product types are reported in Table 8
                     . The first column indicates the production state in regular time and overtime, the second column shows the active sites for each product, and the third one determines the product type. As shown in Table 8, type 1 products are produced only at factory 3, type 2 products are planned for factories 1 and 2, type 3 products are assigned to all factories, and type 4 products are produced at both factories 2 and 3. However, all factories have used their regular times as much as possible to produce the products, and the largest proportion of the overtime at factories 1 and 2 is assigned to type 2 products.

The interactions of supply chain components are reported in Tables 9 and 10
                     
                     . The blank cells similar to other unreported relevant data are equal to 0. In Table 9, the interaction between suppliers and factories and the transportation mode are presented: the first column indicates the supplier, and the second and third columns show which factories are served by that supplier and for which product types. For example, the second row determines that 90, 133, 117, 50 and 298 units of type 3 products are transported from supplier 1 to factory 1, at consecutive periods 1 to 6, except period 4 (i.e. at period 4, there is no interaction between supplier 1 and factory 1). Moreover, the transportation mode is also determined: for instance, the units transported from supplier 1 to factory 1 at period 2 are shipped partially by vehicle type 1 (33 units) and partially by vehicle type 2 (100 units). In Table 10 the interactions between factories and customers, as well as the preferred vehicle type, are presented and can be interpreted as in Table 9. As expected, most customer demands (factories’ requirements) are served by their closest factories (suppliers). In exceptional cases, however, shortages occur and the savings in other costs do not offset charges for disconnecting the supply chain. Table 11
                      provides an insight into each objective function component and its proportion of the total cost of the supply chain.

As seen in Table 11, the shortage cost is 1.5% of the total cost, while the transportation cost is near to 16%. This means that when the decision makers are not concerned about GHGs, the shortage cost is not particularly high in comparison with the transportation cost and the inventory cost. However, as discussed in the following section, it plays a significant role in offsetting the extra charges entailed by GHGs.

In this section we provide insights through a sensitivity analysis done for the greenhouse gas emission level against the profit of the supply chain, for the deterministic problem. We first solve the problem by relaxing the greenhouse gas emission constraint. This way, as expected, the maximum profit incurred. We then tighten the right hand side of this constraint step by step and analyze the impact of the greenhouse gas emission level on the profit as well as transportation cost. The results are depicted in Fig. 6
                        .

As seen in Fig. 6, when the GHG constraint is relaxed, the maximum profit will be gained and the worst value for GHGs will be obtained (16,648). This could be explained by the fact that the model tries to take advantage of the more spacious vehicles to combine the customers’ demands (factories’ requirements) in successive periods, to save transportation costs and avoid shortage costs. It is definitely not explained relation to the GHGs. In fact, the optimum solution is a tradeoff between the transportation and inventory cost (+production cost) on the one hand, and the lost sale and shortage cost, on the other. When we impose an upper limit for greenhouse gas emission levels (8340), as expected, the profit falls rapidly from 203,540 to 190,500 (∼6.4% reduction). It then reaches a state in which, even if the limitation is tightened, the profit and transportation cost decreases gradually with an approximately fixed slope. For instance, when the GHG upper limit is reduced from 8340 to 7900 (∼5.3%), the associated profit decreases from 190,500 to 188,540 (∼1.0% reduction). This is approximately the same as the case in which the GHG upper limit decreases more and reaches the level of 7500, where the profit decreases from 188,540 to 185,890 (∼1.4% drop). This part of the diagram may be more interesting because it prompts the decision makers to reduce GHGs considerably (∼6%) without costing so much (lower than 1.5% of the profit). This state remains unchanged until the GHG drops to 6700. Thereafter, by tightening the GHG limitation more, the transportation cost still decreases in a linear manner, but the profit decreases with an increasing slope (collapse). In fact this GHG level (6700) is a turning point for the profits, where the decreasing slope of profit reduction (before this point) changes to an increasing slope (after this point). The fact behind this is that high amounts of greenhouse gas emissions are firstly avoided by the model through proper choices such as appropriate suppliers and vehicles, where sequential orders are combined to use the advantage of quantity discount and reduce transportation frequencies to offset the extra costs. But in order to avoid more GHG emissions, these aforementioned strategies are no longer useful. This reduction will therefore be possible only if some orders are partially cancelled, which entails a high risk of unfulfilled demand. Hence, because of the nonlinear form of the shortage penalty function, there will inevitably be some essential cost for the supply chain, and consequently the profit will decrease considerably. This is why the transportation cost is still decreasing gradually even after the turning point, while the profit is rapidly collapsing.

As previously mentioned the GHG and waste limits introduced can be interpreted as an ethical boundary set by the corporate strategy or as a threshold over which the firm might pay extra taxes because of its emission ratio. This Figure can also be interpreted as a Pareto set in which the decision maker can select the most preferred solution among them, according to his/her preferences.

We also perform another sensitivity analysis for the waste: as expected, tightening the total waste restriction leads to a lower profit margin. The configuration of the production rate is changed accordingly. In other words, the production rate of the products with a higher density of waste is reduced and, conversely, the production rate of the products with a lower density of waste increases or at least remains unchanged. Fig. 7
                         compares the average production rate of the product families before and after considering the waste limitation.

The percentage of waste (wp) produced by type 1, 2, 3 and 4 products is supposed to be equal to 0.02, 0.05, 0.03 and 0.01, respectively, and the prices associated with them are assumed to be 37, 30, 44 and 26, respectively. So, in this typical example the type 2 product has the largest potential to create waste, in comparison with the other ones. On the other hand, the company is more interested in producing a type 3 product, because of the relatively higher margin it has and because its demand never decreases. Therefore, according to Fig. 7, before applying the waste upper bound limitation, roughly speaking, the model tries to meet the products’ demands regarding their margins. For example, the average production rate for a type 3 product is 336.5. When the upper limit for the total waste is applied, the proposed model tries to reduce the waste and keep the profit level unchanged as much as possible. This is why the production rate for a type 3 product is decreased to 218.72 after we limit the total waste.

In this research a scenario-based approach is selected to deal with uncertainty. One of the significant concerns in this method is how to identify the number of scenarios that meet the pre-specified confidence level. We therefore propose a statistical method to estimate the number of scenarios in the following. The number of scenarios is specified by the preferred level of accuracy of the solution, which can be calculated by the confidence interval of the expected total cost. The confidence interval can be calculated as follows. The Monte Carlo sampling variance estimator of the result for a stochastic programming problem, which is independent of the probability distribution of the uncertain parameters, is given by
                           
                              (69)
                              
                                 S
                                 (
                                 n
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   s
                                                   =
                                                   1
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             E
                                             (
                                             Z
                                             )
                                             -
                                             
                                                
                                                   Z
                                                
                                                
                                                   s
                                                
                                             
                                             
                                                
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             n
                                             -
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        where n is the number of scenarios and Z
                        
                           s
                         is the total cost of scenario s. Then the confidence interval of 1−
                        α is given as
                           
                              (70)
                              
                                 
                                    
                                       
                                          E
                                          (
                                          Z
                                          )
                                          -
                                          
                                             
                                                Φ
                                             
                                             
                                                α
                                                /
                                                2
                                             
                                          
                                          
                                             
                                                S
                                                (
                                                n
                                                )
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                
                                             
                                          
                                          ,
                                          E
                                          (
                                          Z
                                          )
                                          +
                                          
                                             
                                                Φ
                                             
                                             
                                                α
                                                /
                                                2
                                             
                                          
                                          
                                             
                                                S
                                                (
                                                n
                                                )
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where Φ
                        
                           α/2 is a quantity for which the following equation for a standard normal random variable φ
                        ≈
                        N (μ
                        =0,
                        σ
                        =1) will be satisfied.
                           
                              (71)
                              
                                 Pr
                                 (
                                 φ
                                 ⩽
                                 
                                    
                                       Φ
                                    
                                    
                                       α
                                       /
                                       2
                                    
                                 
                                 )
                                 =
                                 1
                                 -
                                 α
                                 /
                                 2
                              
                           
                        For example, for α
                        =0.05, Φ
                        
                           α/2 will be 1.96 according to the standard normal distribution tables.

On the other hand, if we are given the sampling estimator S(n) and the maximum possible error (er) for confidence level 1−
                        α/2, the minimum required number of scenarios can be determined by,
                           
                              (72)
                              
                                 
                                    
                                       n
                                    
                                    
                                       ′
                                    
                                 
                                 ⩾
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         Φ
                                                      
                                                      
                                                         α
                                                         /
                                                         2
                                                      
                                                   
                                                   S
                                                   (
                                                   n
                                                   )
                                                
                                                
                                                   er
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        Therefore, to determine the number of scenarios n′, we first solve the stochastic programming model with a small number of scenarios n (i.e. n
                        =10). To estimate the value of sampling estimator S(n) by using Eqs. (69) and (72) we can determine the required number of scenarios (n′) for a desired confidence interval.

So, we generate 10 (n
                        =10) sample scenarios to determine the required number of scenarios for confidence level 95% using Eqs. (69)–(72).

The values of objective function components for these ten scenarios are shown in Table 12
                        .


                        Table 12 shows that for each scenario different levels of profit are earned, and that the total cost components such as workforce cost, transportation cost, shortage cost, purchase cost and inventory holding cost vary among different scenarios. In fact the variability that exists in profits and costs makes the decision more complicated. For instance, in Scenario 2 the purchase cost is not very high, whereas in Scenario 1 the maximum purchase cost is obtained. The highest profit level in the scenarios generated will be in Scenario 4. The variability of the shortage, purchase and transportation costs, as well as that of the profits, is depicted in Fig. 8
                         so that they can be compared more precisely. Profit is depicted as representative of the outcomes of all interactions between supply chain components. Transportation cost is almost synonymous with GHG emissions. The shortage cost is a customer-oriented measure and shows the service level. Finally, the purchase cost is highlighted because of the discount option incorporated in the model.

Due to uncertainty and the resulting variability, the number of scenarios should be wisely designed to absorb these fluctuations and to avoid time-consuming computations.

Using Eqs. (69)–(72), and considering the desired confidence interval as 0.05×
                        E(Z), the required number of scenarios for confidence level 95%, will be roughly equal to 60. Note that, the lower the level of maximum possible error (er), the larger the number of required scenarios will be. For example, for desired confidence interval as 0.04×
                        E(Z), 0.03×
                        E(Z) and 0.02×
                        E(Z), the required number of scenarios will be equal approximately to 91, 162 and 365. In this paper we consider the confidence level and maximum possible error as 95% and 0.05×
                        E(Z), respectively. Consequently, the number of scenarios is set at 60. Hereafter, the reports are based on 60 scenarios generated, based on the normal distribution.

Due to the multiple breakpoint form of the shortage cost function, the shortage cost decreases to approximately 1.3% of the average total cost in comparison with the linear form of the shortage cost function (3%). The number of shortages mostly falls into the second interval (100<
                        B
                        
                           nit
                        
                        <500) of the cost function (see Fig. 9
                        a). The rationale behind this observation is that the nonlinear form of the shortage cost prevents the model from cancelling all orders when it is under pressure of the GHGs limitation. According to Fig. 9a, in 311 cases (46%) the number of shortages falls in the range of 100–200, and in 236 cases (35%) it falls in the range of 200–300. In 85 cases (13%), the number of shortages is less than 100 units, in 38 cases (6%) it is more than 300, and it never exceeds 500. On the other hand, the multiple breakpoint discount function causes the order quantity, released by factories, to shift up (>500). As shown in Fig. 9b, the orders larger than 500 are the most frequent ones. For instance, in 10 cases (12%) the order size is less than 100 units, in 24 cases (28%) it is less than 400 units, and in 63 cases (72%) it is more than 400 units. Note that the order size (XQ) is a first-stage decision variable and does not vary within scenarios. Therefore, it could be concluded that due to the quantity discount function considered in the proposed model, there is a trend to merge the succeeding orders to take advantage of lower purchasing costs. Note also that Fig. 9 counts the number of periods for all product types in which shortages (orders) occurred, rather than the number of scenarios.

In order to manage risk, the variance management model is usually applied, which is a straightforward approach to reduce both expected value and variance of cost, but it includes quadratic terms in the objective function (Goha et al., 2007). To manage the variability of the solutions among different scenarios, we add a new term (semivar
                        +) as a 1-norm variability index (semi-variance) to the original proposed two stage stochastic programming.


                        
                           
                              
                                 
                                    semivar
                                 
                                 
                                    s
                                 
                                 
                                    +
                                 
                              
                           
                         is also called as the ‘upper partial mean’, that is, if SS
                           s
                        is less than the E(SS
                        
                           s
                        ), the 
                           
                              
                                 
                                    semivar
                                 
                                 
                                    s
                                 
                                 
                                    +
                                 
                              
                           
                         will be zero; if SS
                           s
                         is greater than the E(SS
                        
                           s
                        ), the 
                           
                              
                                 
                                    semivar
                                 
                                 
                                    s
                                 
                                 
                                    +
                                 
                              
                           
                         will be equal to their positive difference (SS
                        
                           s
                        
                        −
                        E(SS
                        
                           s
                        )) (See Fig. 10
                        ). Therefore, the aim of the new model is to minimize the weighted sum between the expected value of the total loss and the expected variability index as follows:
                           
                              (73)
                              
                                 Min
                                 
                                 Z
                                 =
                                 FS
                                 +
                                 E
                                 (
                                 
                                    
                                       SS
                                    
                                    
                                       s
                                    
                                 
                                 )
                                 +
                                 λ
                                 ·
                                 E
                                 
                                    
                                       
                                          
                                             
                                                semivar
                                             
                                             
                                                s
                                             
                                             
                                                +
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (74)
                              
                                 
                                    
                                       
                                          
                                             s
                                             .
                                             t
                                             .
                                          
                                       
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   semivar
                                                
                                                
                                                   s
                                                
                                                
                                                   +
                                                
                                             
                                             ⩾
                                             
                                                
                                                   SS
                                                
                                                
                                                   s
                                                
                                             
                                             -
                                             E
                                             (
                                             
                                                
                                                   SS
                                                
                                                
                                                   s
                                                
                                             
                                             )
                                             ,
                                             
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (75)
                              
                                 
                                    
                                       semivar
                                    
                                    
                                       s
                                    
                                    
                                       +
                                    
                                 
                                 ⩾
                                 0
                                 ,
                                 
                                 ∀
                                 s
                              
                           
                        Constraints 10, (11), (12), (15), (16), (18), (21), (23), (29)–(31), (43), (51)–(53), (58)–(68)
                     

Where, λ is the relative weight for the variability index usually determined by the decision maker.


                        Fig. 11
                         shows the result of the sensitivity analysis which is done for the value of λ. As expected, for a higher value of λ, the expected value of the total losses increases (profit decreases) while the value of the variability index decreases. Conversely, for a lower value of λ, the expected total losses of the supply chain decreases (profit increases) while its variability increases. In other words, Fig. 11 is a Pareto curve, and the decision maker can select the desirable amount of λ according to his/her preferences. For instance, for λ
                        =1, the expected profit is approximately equal to 117,134, while the variability index is 7848. Conversely, for λ
                        =7, the expected profit is 108,043, whereas the variability index is 1939. In other words, the expected profit decreases by nearly 7.76%, while the variability index decreases by around 75%. This means that a 7.76% increase in expected profits is accessible once the decision maker can accept its higher risk.

@&#CONCLUSION@&#

In this paper a two-stage stochastic programming model is developed to deal with aggregate production–distribution planning in a green supply chain under the assumption of demand fluctuation. The proposed model considers not only most of the supply chain cost parameters, but also some more realistic cost functions such as multiple breakpoint discount function and multiple breakpoint shortage penalty function. These assumptions make the model more complicated because of their nonlinear structure. Therefore by applying some numerical and theoretical techniques, the original nonlinear model is converted to a linear one. We also consider the interrelationship between lead time and transportation costs, by considering the vehicle type selection decision variables. The model could therefore vary the vehicle type to gain more profit. On the other hand, we incorporate the green concept in transportation issues. The sensitivity analysis demonstrates that considering green logistics has a considerable effect on the configuration of the total cost components as well as the profit margin. Managing waste in the production process is moreover considered to control the production rates of the product with a higher level of waste. The proposed model is firstly solved deterministically, and then solved again under a two-stage stochastic programming scheme. The result shows that this research is a good step to develop a more comprehensive aggregate planning model for dealing with some challenging issues such as nonlinearity and uncertainty, simultaneously. Effort to implement the proposed model in real cases, considering green indicators as an additional objective function in a multi-objective scheme and also modeling the relationship between price and end customer demand are the most promising areas for future research.

Let us assume a general multiple breakpoint function of type:
                        
                           (A.1)
                           
                              f
                              (
                              X
                              )
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      1
                                                   
                                                
                                                X
                                                +
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                             
                                                if
                                                
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ⩽
                                                X
                                                ⩽
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      2
                                                   
                                                
                                                X
                                                +
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                if
                                                
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ⩽
                                                X
                                                ⩽
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      3
                                                   
                                                
                                                X
                                                +
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      3
                                                   
                                                
                                             
                                             
                                                if
                                                
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      2
                                                   
                                                
                                                ⩽
                                                X
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     This nonlinear function could be converted to a linear form with the help of the following equations:
                        
                           (A.2)
                           
                              f
                              (
                              X
                              )
                              =
                              
                                 
                                    a
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    X
                                 
                                 
                                    1
                                 
                              
                              +
                              
                                 
                                    b
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                              
                              +
                              
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    X
                                 
                                 
                                    2
                                 
                              
                              +
                              
                                 
                                    b
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              +
                              
                                 
                                    a
                                 
                                 
                                    3
                                 
                              
                              
                                 
                                    X
                                 
                                 
                                    3
                                 
                              
                              +
                              
                                 
                                    b
                                 
                                 
                                    3
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    3
                                 
                              
                           
                        
                     
                     
                        
                           (A.3)
                           
                              
                                 
                                    
                                    
                                       
                                          s
                                          .
                                          t
                                          .
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                C
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                t
                                             
                                             
                                                1
                                             
                                          
                                          ⩽
                                          
                                             
                                                X
                                             
                                             
                                                1
                                             
                                          
                                          ⩽
                                          
                                             
                                                C
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                t
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (A.4)
                           
                              
                                 
                                    C
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              ⩽
                              
                                 
                                    X
                                 
                                 
                                    2
                                 
                              
                              ⩽
                              
                                 
                                    C
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                           
                        
                     
                     
                        
                           (A.5)
                           
                              
                                 
                                    C
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    3
                                 
                              
                              ⩽
                              
                                 
                                    X
                                 
                                 
                                    3
                                 
                              
                              ⩽
                              
                                 
                                    Mt
                                 
                                 
                                    3
                                 
                              
                           
                        
                     
                     
                        
                           (A.6)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              =
                              1
                              ,
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              ∈
                              {
                              0
                              ,
                              1
                              }
                           
                        
                     
                     
                        
                           (A.7)
                           
                              X
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                              where
                              
                              M
                              
                              is
                              
                              an
                              
                              arbitrary
                              
                              large
                              
                              number
                              .
                           
                        
                     
                     
                        Proof
                        If t
                           1
                           =1 then t
                           2
                           =0, t
                           3
                           =0 and according to (A.4) and (A.5), 0⩽
                           X
                           2
                           ⩽0, 0⩽
                           X
                           3
                           ⩽0 therefore f(X) will be equal to f(X)=
                           a
                           1
                           X
                           1
                           +
                           b
                           1
                           ×1+
                           a
                           2
                           ×0+
                           b
                           2
                           ×0+
                           a
                           3
                           ×0+
                           b
                           3
                           ×0, =>f(X)=
                           a
                           1
                           X
                           1
                           +
                           b
                           1, where X is limited by constraint (A.3), C
                           0
                           ×1⩽
                           X
                           1
                           ⩽
                           C
                           1
                           ×1=>
                           C
                           0
                           ⩽
                           X
                           1 
                           ⩽
                           C
                           1
                        

If t
                           2
                           =1, in the same way as above, we have =>
                           f(X)=
                           a
                           2
                           X
                           2
                           +
                           b
                           2, C
                           1
                           ⩽
                           X
                           2
                           ⩽
                           C
                           2
                        

Finally, if t
                           3
                           =1=>
                           f(X)=
                           a
                           3
                           X
                           3
                           +
                           b
                           3, C
                           2
                           ⩽
                           X
                           3
                           ⩽
                           M,

We see that these Equations, A.2, (A.3)–(A.7) are equivalent to the original nonlinear structure (A.1).

According to the method proposed by Tsai (2007), we have:
                        
                           (B.1)
                           
                              
                                 
                                    CM
                                 
                                 
                                    nk
                                 
                              
                              (
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                              )
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       1
                                    
                                    
                                       m
                                       -
                                       1
                                    
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    
                                       
                                          nkjgtm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              (
                              
                                 
                                    CM
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    r
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              (
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                              -
                              
                                 
                                    XQ
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              )
                              )
                           
                        
                     
                     
                        
                           (B.2)
                           
                              
                                 
                                    
                                    
                                       
                                          s
                                          .
                                          t
                                          .
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   m
                                                   -
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                XQ
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                                t
                                             
                                             
                                                
                                                   
                                                      nkjgtm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          ⩽
                                          
                                             
                                                XQ
                                             
                                             
                                                nkjgt
                                             
                                          
                                          ⩽
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   m
                                                   -
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                XQ
                                             
                                             
                                                nk
                                                (
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                +
                                                1
                                                )
                                             
                                          
                                          
                                             
                                                t
                                             
                                             
                                                
                                                   
                                                      nkigtm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (B.3)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       1
                                    
                                    
                                       m
                                       -
                                       1
                                    
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    
                                       
                                          nkjgtm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              =
                              1
                           
                        
                     By substitution of Eq. (B.1) in the purchasing cost, it could be rewritten as follows:
                        
                           (B.4)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       k
                                       ,
                                       j
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    CM
                                 
                                 
                                    nk
                                 
                              
                              (
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                              )
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       k
                                       ,
                                       j
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       1
                                    
                                    
                                       m
                                       -
                                       1
                                    
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          
                                             CM
                                          
                                          
                                             
                                                
                                                   nkm
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       -
                                       
                                          
                                             r
                                          
                                          
                                             
                                                
                                                   nkjgtm
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       
                                          
                                             XQ
                                          
                                          
                                             
                                                
                                                   nkm
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       )
                                       
                                          
                                             XQ
                                          
                                          
                                             nkjgt
                                          
                                       
                                       +
                                       
                                          
                                             r
                                          
                                          
                                             
                                                
                                                   nkm
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       
                                          
                                             XQ
                                          
                                          
                                             nkjgt
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (B.5)
                           
                              
                                 
                                    
                                    
                                       
                                          s
                                          .
                                          t
                                          .
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   m
                                                   -
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                XQ
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      
                                                         
                                                            nkjgtm
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          ⩽
                                          
                                             
                                                XQ
                                             
                                             
                                                nkjgt
                                             
                                          
                                          ⩽
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   m
                                                   -
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                XQ
                                             
                                             
                                                nk
                                                (
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                +
                                                1
                                                )
                                             
                                          
                                          
                                             
                                                t
                                             
                                             
                                                
                                                   
                                                      nkjgtm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (B.6)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       1
                                    
                                    
                                       m
                                       -
                                       1
                                    
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    
                                       
                                          nkjgtm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              =
                              1
                           
                        
                     As can be seen, it has some explicit nonlinear terms (t ·XQ
                     
                        nkjgt
                     ). As Tsai (2007) proves, z
                     =
                     t·f(x);t
                     ∈{0,1} could be converted to an equivalent linear equation as follows:
                        
                           (B.7)
                           
                              f
                              (
                              x
                              )
                              -
                              (
                              1
                              -
                              t
                              )
                              M
                              ⩽
                              z
                              ⩽
                              f
                              (
                              x
                              )
                              +
                              (
                              1
                              -
                              t
                              )
                              M
                           
                        
                     
                     
                        
                           (B.8)
                           
                              -
                              tM
                              ⩽
                              z
                              ⩽
                              tM
                              ,
                              M
                              
                              is
                              
                              an
                              
                              arbitrary
                              
                              big
                              
                              number
                           
                        
                     Therefore, by considering 
                        
                           
                              
                                 
                                    (
                                    
                                       
                                          CM
                                       
                                       
                                          
                                             
                                                nkm
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    -
                                    
                                       
                                          r
                                       
                                       
                                          
                                             
                                                nkm
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    
                                       
                                          XQ
                                       
                                       
                                          
                                             
                                                nkm
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    )
                                    
                                       
                                          XQ
                                       
                                       
                                          nkjgt
                                       
                                    
                                    +
                                    
                                       
                                          r
                                       
                                       
                                          
                                             
                                                nkm
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    
                                       
                                          XQ
                                       
                                       
                                          nkjgt
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                        
                      as f(x) we have:
                        
                           (B.9)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       k
                                       ,
                                       j
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    CM
                                 
                                 
                                    nk
                                 
                              
                              (
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                              )
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       ,
                                       k
                                       ,
                                       j
                                       ,
                                       g
                                       ,
                                       t
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       1
                                    
                                    
                                       m
                                       -
                                       1
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             Z
                                          
                                          
                                             (
                                             
                                                
                                                   m
                                                
                                                
                                                   ′
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    nkjgt
                                 
                              
                           
                        
                     
                     
                        
                           (B.10)
                           
                              
                                 
                                    
                                    
                                       
                                          s
                                          .
                                          t
                                          .
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   m
                                                   -
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                XQ
                                             
                                             
                                                
                                                   
                                                      nkm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                                t
                                             
                                             
                                                
                                                   
                                                      nkjgtm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          ⩽
                                          
                                             
                                                XQ
                                             
                                             
                                                nkjgt
                                             
                                          
                                          ⩽
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   m
                                                   -
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                XQ
                                             
                                             
                                                nk
                                                (
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                +
                                                1
                                                )
                                             
                                          
                                          
                                             
                                                t
                                             
                                             
                                                
                                                   
                                                      nkjgtm
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (B.11)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       1
                                    
                                    
                                       m
                                       -
                                       1
                                    
                                 
                              
                              
                                 
                                    t
                                 
                                 
                                    
                                       
                                          nkjgtm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              =
                              1
                           
                        
                     
                     
                        
                           (B.12)
                           
                              (
                              
                                 
                                    CM
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              -
                              
                                 
                                    r
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              
                                 
                                    XQ
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              )
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                              +
                              
                                 
                                    r
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                                 
                                    2
                                 
                              
                              -
                              (
                              1
                              -
                              
                                 
                                    t
                                 
                                 
                                    
                                       
                                          nkjgtm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              )
                              M
                              ⩽
                              
                                 
                                    z
                                 
                                 
                                    
                                       
                                          nkjgtm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (B.13)
                           
                              
                                 
                                    z
                                 
                                 
                                    
                                       
                                          nkjgtm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              ⩽
                              (
                              
                                 
                                    CM
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              -
                              
                                 
                                    r
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              
                                 
                                    XQ
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              )
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                              
                              +
                              
                                 
                                    r
                                 
                                 
                                    
                                       
                                          nkm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              
                                 
                                    XQ
                                 
                                 
                                    nkjgt
                                 
                                 
                                    2
                                 
                              
                              +
                              (
                              1
                              -
                              
                                 
                                    t
                                 
                                 
                                    
                                       
                                          nkjgtm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              )
                              M
                           
                        
                     
                     
                        
                           (B.14)
                           
                              -
                              
                                 
                                    t
                                 
                                 
                                    
                                       
                                          nkjgtm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              M
                              ⩽
                              
                                 
                                    z
                                 
                                 
                                    
                                       
                                          nkjgm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              ⩽
                              
                                 
                                    t
                                 
                                 
                                    
                                       
                                          nkjgtm
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              M
                           
                        
                     
                  

@&#REFERENCES@&#

