@&#MAIN-TITLE@&#Smoothness driven frame field generation for hexahedral meshing

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose a novel algorithm to generate block-structured hexahedral meshes for any CAD domain.


                        
                        
                           
                           The proposed approach does not require a pre-meshed boundary.


                        
                        
                           
                           The frame field is built so that singularities are better positioned.


                        
                        
                           
                           A skeleton is built using the frame field.


                        
                        
                           
                           Each part defined by the skeleton can be meshed with a structured mesh.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Meshing algorithm

Hexahedra

Block-structured

Frame fields

@&#ABSTRACT@&#


               
               
                  For many years, providing an algorithm to generate hexahedral meshes that fulfill minimal geometric criteria (boundary-alignment, minimum of singularity vertices) and that is not limited to a category of geometries has been an open issue. In the past couple of years, techniques using 3D frame fields have emerged to design such meshes (Huang et al., 2011; Li et al., 2012). Those methods are based on a two-step process where a 3D frame field is built by assigning a frame to each cell of a tetrahedral mesh, then a parametrization algorithm is applied to generate a hexahedral mesh. In this work, we propose a novel algorithm to generate block-structured hexahedral meshes for any CAD domain 
                        Ω
                     . This work differs from previous ones in many points: (1) the proposed approach does not need to start from a pre-meshed quad boundary; (2) The frame field initialization does not put singularity lines around the medial object of 
                        Ω
                     ; (3) Conceptually, frames are assigned to the vertices and not to the cells of the tetrahedral mesh; (4) The parametrization process is replaced by a constructive algorithm that generates a block structure, which partitions 
                        Ω
                      in meshable regions.
               
            

@&#INTRODUCTION@&#

For some numerical simulations, engineers prefer to use hexahedral meshes than tetrahedral meshes in order to perform finite element or volume analysis. In computational fluid dynamics or for fluid–structure interactions, hexahedral meshes allow to have aligned elements along geometric boundaries. This is due to their layered structure that can be aligned along the boundary of 3D geometric domains  [1,2]. They also have interesting numerical properties, such as a reduced number of elements and a high approximation accuracy in numerous simulations in physics and mechanical engineering. However, generating high-quality hexahedral meshes is a very difficult and time-consuming task. Indeed, meshes are expected to abide by a number of rules to be of any use  [3]: (1) To align elements along the boundary and inner directional constraints. This means having hexahedra layers along each boundary or constrained surface, and rows of hexahedra along each boundary or constrained edges. (2) To maximize the hexahedra geometric quality by keeping their distortion to a minimum. The distortion of an element is evaluated by considering the min scaled Jacobian value of every single element  [4].
                        1
                     
                     
                        1
                        Perfect cubes have a value of 1, while non-convex elements have a value close to 0.
                      To achieve this, singular edges, i.e. edges with more or less than four incident hexes, have to be introduced inside the volume to reduce global distortion, while being kept at a minimum to reduce local distortion.

We consider that the automatic generation of high-quality hexahedral meshes requires to have geometric information inside the volume and not only on the boundary. Such information can be provided by a frame field, as shown in  [5–7]. In  [5], authors provide theoretical foundations to characterize frame fields that are suitable for hexahedral mesh generation but their frame field computation is generated from a meta-mesh that must be interactively built by the final user. In  [6,7], the frame field is generated by minimizing a non-linear energy function. A caveat of such methods is the impact of the initial solution that leads to a solution corresponding to local minima of the minimization function. In both works, the initial solution is obtained through a simple straightforward process that can lead to non-optimal final solution: “…propagation-based frame field initialization likely generates singular edges around the medial axis of the volume, and most of them cannot be eliminated by frame optimization”  [7]. This leads to potential high distortions for the resulting hexahedral elements, or even to unnecessary singularities. In order to overcome these limitations, we propose a novel initialization step that prevents clusters of singularities in the vicinity of the medial object of 
                        Ω
                     ;

The approach described in this paper allows us to generate block structures that can be used to generate full-hexahedral meshes. Starting from a tetrahedral mesh 
                        
                           
                              T
                           
                           
                              Ω
                           
                        
                      of a domain 
                        Ω
                      with sharp features, we build a continuous frame field 
                        
                           
                              F
                           
                           
                              Ω
                           
                        
                      on 
                        
                           
                              T
                           
                           
                              Ω
                           
                        
                      as a continuous piecewise linear frame field extending a discrete unit frame field that we compute on the vertices of 
                        
                           
                              T
                           
                           
                              Ω
                           
                        
                     . This solution differs from those proposed in  [6,7] on many points, which are the main contributions of this work: 
                        
                           1.
                           The quadrilateral mesh of the surface is not a parameter of our approach. We start from a geometrical domain 
                                 Ω
                               and a tetrahedral mesh 
                                 
                                    
                                       T
                                    
                                    
                                       Ω
                                    
                                 
                               of this domain. Both the surface and the volume mesh of 
                                 Ω
                               are generated by our approach.

Internal 3D frames are not defined by snapping the nearest 3D frame defined on 
                                 ∂
                                 Ω
                              , but by solving an iterative process, which consists in defining internal 3D frames that are in most stable areas as first. This is essential to control the location of singularities, since the optimization problem that we will consider afterward is nonlinear and the result strongly depends on the initial solution.

3D frames are not associated to tetrahedral elements but to the vertices of 
                                 
                                    
                                       T
                                    
                                    
                                       Ω
                                    
                                 
                              . As a consequence, we do not have a discrete singularity graph made of vertices and edges of 
                                 
                                    
                                       T
                                    
                                    
                                       Ω
                                    
                                 
                              , but a singularity graph, which is built by applying linear interpolation into each tetrahedron containing a singularity of the 3D frame field (see Definition 6). By this way, we avoid the topological cleaning process that is performed in  [6,7], where the lines of singularity lines are made of edges of 
                                 
                                    
                                       T
                                    
                                    
                                       Ω
                                    
                                 
                              . Sharp angles between selected edges and defaults occur and have to be removed.

We do not generate an atlas of parametrizations, which is very sensitive and expensive to compute. We use the singularity graph to define a domain partitioning and then a block structure, where each block can be easily meshed using a simple mapping algorithm.

The remainder of this paper is structured as follows: in Section  2, related works are described before giving an overview of our approach in Section  3. Section  4 provides useful definitions to handle 3D frames. Significative details of the two main stages of the proposed approach, which are the frame field generation and the singularity graph extraction, are given in Sections  5 and 6 respectively. Eventually, results and elements of discussion are given in Section  7.

@&#RELATED WORK@&#

Algorithms to generate all-hexahedral meshes have been widely studied for decades. A comprehensive survey is available in  [8]. However, automatic algorithms providing good quality meshes for any domain are yet to be designed. As a result, semi-automatic methods based on robust algorithms designed for restrictive categories of domains, like multi-sweeping  [9,10], were developed to help decomposing domains into meshable regions. Thus, the automatic generation of hexahedral meshes for any geometric 3D object is still an open problem. Starting from a pre-meshed boundary surface, pure geometric approaches like plastering  [11] or H-morph  [12] algorithms have been proposed, while some other works have been based on pure topological approaches  [13,14]. In both cases, the success was limited: some unfilled cavities remain or inverted cells and negative Jacobian cells can be generated. By relaxing the constraint of starting from a pre-meshed boundary that must be preserved, grid-based algorithms  [15,16] or unconstrained plastering  [17] provide encouraging examples of all-hexahedral meshes for arbitrary domains. Currently, grid-based  [15,16] methods offer the simplest and most robust approach, but as the PolyCube method  [18,19], it suffers from two flaws: the influence of the box orientation on the final result, leading to unpredictable results, and the location of the worst quality elements near the boundary while the quality of elements in this area is often critical for numerical approximation methods.

Many algorithms have been proposed and developed for generating quadrilateral meshes. But recently, many of those methods have been improved by using surface parametrization techniques on cross fields that are defined on a triangular surface  [20,21]. Another approach consists in using the cross field to partition the domain into quadrilateral shaped blocks  [22]. While the attempts to extend the former to hexahedral meshing have shown promising results  [5,7], a generalization of the latter to 3D has yet to be designed. The Morse–Smale complex technique  [23] provides another approach to quad meshing that has yet to be extended in a robust all-hexahedral meshing algorithm. The interested reader can see  [24] for a recent survey.

There are many ways to define frame fields in the scientific literature; for the purpose of this paper, we consider a frame to be the 3D extension of a cross, that is 3 directions orthogonal one to the other. Cross fields have been widely studied with applications to surface meshing and texture mapping. 3D Frame fields, on the other hand, have only been studied for the last few years. They are a guideline to drive meshing algorithms by providing geometric orientations inside the volume and not only on the boundary. Several papers  [5,6,25,7] provide very promising results. Nieser et al.  [5] generate a frame field based on a given meta-mesh. Huang et al.  [6,25,26] and Li et al.  [7] provide a way to smooth a given frame field by minimizing an energy function, but their methods use rough initializations that can lead to issue that cannot be removed with a smoothing step  [7]. Moreover, while this article focuses on generating full-hexahedra meshes, it should be noted that frame fields are successfully used to generate other kind of meshes, such as hex-dominant meshes  [27].

Starting from a tetrahedral mesh 
                        
                           
                              T
                           
                           
                              Ω
                           
                        
                      that discretizes a geometric domain 
                        Ω
                     , the aim of the method is to generate a smooth discrete frame field (see Eq. (6) for an expression of such smoothness) where a single 3D frame is associated to each vertex of 
                        
                           
                              T
                           
                           
                              Ω
                           
                        
                     . A block-structure is then extracted from this frame field to generate an all-hexahedral mesh. More precisely, the main steps of our algorithm, depicted in Fig. 1
                     , are the following ones: 
                        
                           1.
                           Frames are defined along geometric curves where their orientations are totally known. Let 
                                 S
                               be the set of these frames (see Fig. 1(b) where frames are represented by cubes);

Starting from the frames of 
                                 S
                              , an advancing-front algorithm is used to define a frame field on 
                                 ∂
                                 Ω
                              . During this step, frames are put in such a way that the smoothest areas of 
                                 ∂
                                 Ω
                               are filled at first. A global smoothing is then performed to get result of Fig. 1(c). The applied smoothing algorithm is an adaptation of the one done in  [7].

In a similar way, frames defined on 
                                 ∂
                                 Ω
                               are propagated into 
                                 Ω
                               (see Fig. 1(d)). Stable areas are filled in first and the smoothing algorithm provided in  [7]  is applied straightforwardly.

Singularity points located in the volume are computed first, then singularity lines that are in the volume are extracted (see Fig. 1(e)).

Boundary singularity lines are computed a second time. This process is executed on each surface patch before performing a “conforming” stage to fix potential misalignment (see Section  6.3).

Eventually, some extra lines and points are added to get a full partition corresponding to a valid block structure for hexahedral meshing. The resulting all-hexahedral mesh is given in Fig. 1(e).

In this work, a 3D frame 
                           
                              F
                           
                         is defined in a classical way, which is three unit vectors, that are orthogonal to each others forming an orthonormal right-handed basis of 
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                        . 
                           Definition 1
                           A 3D frame 
                                 
                                    F
                                 
                               is a 3-tuple 
                                 
                                    {
                                    
                                       u
                                    
                                    ,
                                    
                                       v
                                    
                                    ,
                                    
                                       w
                                    
                                    }
                                 
                              , where 
                                 
                                    u
                                 
                              , 
                                 
                                    v
                                 
                               and 
                                 
                                    w
                                 
                               three unit 3D vectors such that 
                                 
                                    u
                                 
                                 .
                                 
                                    v
                                 
                                 =
                                 0
                               and 
                                 
                                    w
                                 
                                 =
                                 
                                    u
                                 
                                 ∧
                                 
                                    v
                                 
                              .

In order to perform operations on frames, we define a group law 
                           ⊕
                         that allows us to perform linear combination of frames. In order to define this law, we represent frame by using unit quaternions  [29]. Considering 
                           
                              (
                              1
                              ,
                              
                                 i
                              
                              ,
                              
                                 j
                              
                              ,
                              
                                 k
                              
                              )
                           
                         as being a basis of 
                           
                              
                                 R
                              
                              
                                 4
                              
                           
                         such that 
                           
                              
                                 
                                    i
                                 
                              
                              
                                 2
                              
                           
                           =
                           
                              
                                 
                                    j
                                 
                              
                              
                                 2
                              
                           
                           =
                           
                              
                                 
                                    k
                                 
                              
                              
                                 2
                              
                           
                           =
                           
                              i
                           
                           
                              j
                           
                           
                              k
                           
                           =
                           −
                           1
                        , a unit quaternion 
                           
                              q
                           
                         is defined by 
                           
                              q
                           
                           =
                           w
                           +
                           x
                           
                              i
                           
                           +
                           y
                           
                              j
                           
                           +
                           z
                           
                              k
                           
                         with 
                           
                              
                                 w
                              
                              
                                 2
                              
                           
                           +
                           
                              
                                 x
                              
                              
                                 2
                              
                           
                           +
                           
                              
                                 y
                              
                              
                                 2
                              
                           
                           +
                           
                              
                                 z
                              
                              
                                 2
                              
                           
                           =
                           1
                        .
                           Definition 2
                           To any frame 
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             w
                                          
                                       
                                       
                                          i
                                       
                                    
                                    }
                                 
                               is associated the unit quaternion 
                                 
                                    
                                       
                                          q
                                       
                                    
                                    
                                       i
                                    
                                 
                               that corresponds to the rotation matrix transforming 
                                 
                                    {
                                    
                                       x
                                    
                                    
                                       (
                                       1
                                       ,
                                       0
                                       ,
                                       0
                                       )
                                    
                                    ,
                                    
                                       y
                                    
                                    
                                       (
                                       0
                                       ,
                                       1
                                       ,
                                       0
                                       )
                                    
                                    ,
                                    
                                       z
                                    
                                    
                                       (
                                       0
                                       ,
                                       0
                                       ,
                                       1
                                       )
                                    
                                    }
                                 
                               into 
                                 
                                    {
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             w
                                          
                                       
                                       
                                          i
                                       
                                    
                                    }
                                 
                              .

Let 
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       i
                                    
                                 
                               to 
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       j
                                    
                                 
                               be two frames, and 
                                 
                                    
                                       
                                          q
                                       
                                    
                                    
                                       i
                                    
                                 
                               and 
                                 
                                    
                                       
                                          q
                                       
                                    
                                    
                                       j
                                    
                                 
                               respectively two corresponding unit quaternions, the distance between 
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       i
                                    
                                 
                               and 
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       j
                                    
                                 
                              , denoted 
                                 
                                    
                                       d
                                    
                                    
                                       i
                                       j
                                    
                                 
                              , is defined by 
                                 
                                    (1)
                                    
                                       
                                          
                                             d
                                          
                                          
                                             i
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             min
                                          
                                          
                                             
                                                g
                                             
                                             ∈
                                             G
                                          
                                       
                                       1
                                       −
                                       
                                          |
                                          
                                             g
                                          
                                          .
                                          
                                             (
                                             
                                                
                                                   
                                                      q
                                                   
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            q
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                          |
                                       
                                    
                                 
                               where 
                                 
                                    g
                                 
                               is a quaternion corresponding to a rotation of 
                                 G
                              .

We can now define the law 
                           ⊕
                         which must preserve frame classes. In other words, let 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 i
                              
                           
                         and 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 j
                              
                           
                         be two frames of 
                           
                              [
                              
                                 F
                              
                              ]
                           
                        , the linear combination 
                           α
                           
                              
                                 
                                    F
                                 
                              
                              
                                 i
                              
                           
                           ⊕
                           β
                           
                              
                                 
                                    F
                                 
                              
                              
                                 j
                              
                           
                         is a component of 
                           
                              [
                              
                                 F
                              
                              ]
                           
                         too (see Fig. 2
                        ). 
                           Definition 4
                           Let 
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       i
                                    
                                 
                               and 
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       j
                                    
                                 
                               be two frames, the frame 
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 =
                                 α
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ⊕
                                 β
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       j
                                    
                                 
                              , with 
                                 α
                                 >
                                 0
                              , 
                                 β
                                 >
                                 0
                               and 
                                 α
                                 +
                                 β
                                 =
                                 1
                              , is defined by the quaternion 
                                 
                                    (2)
                                    
                                       
                                          
                                             α
                                             
                                                
                                                   
                                                      q
                                                   
                                                
                                                
                                                   i
                                                
                                             
                                             +
                                             β
                                             
                                                
                                                   
                                                      gq
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                          
                                          
                                             
                                                |
                                                α
                                                
                                                   
                                                      
                                                         q
                                                      
                                                   
                                                   
                                                      i
                                                   
                                                
                                                +
                                                β
                                                
                                                   
                                                      
                                                         gq
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                                |
                                             
                                          
                                       
                                    
                                 
                               with 
                                 
                                    
                                       
                                          g
                                       
                                    
                                    
                                       m
                                    
                                 
                               satisfying Eq. (1), and 
                                 
                                    g
                                 
                                 =
                                 
                                    
                                       
                                          g
                                       
                                    
                                    
                                       m
                                    
                                 
                               if 
                                 
                                    
                                       
                                          g
                                       
                                    
                                    
                                       m
                                    
                                 
                                 .
                                 
                                    (
                                    
                                       
                                          
                                             q
                                          
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   q
                                                
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    )
                                 
                                 >
                                 0
                              , 
                                 −
                                 
                                    
                                       
                                          g
                                       
                                    
                                    
                                       m
                                    
                                 
                               otherwise.

In this work, we also represent frames by Euler angles to perform a global smoothing of the frame field (as in  [7]). The main benefit of this representation is to intrinsically constrain solutions onto the unit sphere. On the contrary, solving systems using the 4 coordinates of the quaternions would imply using extra constraints to preserve their unit norm. In fact, those representations are complementary. Let F be a 3D frame and q its associated unit quaternion. Every unit quaternion represents a rotation that can be decomposed using Euler angles. We use an XYZ decomposition where 
                           
                              q
                           
                           =
                           
                              
                                 
                                    q
                                 
                              
                              
                                 
                                    x
                                 
                              
                              
                                 α
                              
                           
                           
                              
                                 
                                    q
                                 
                              
                              
                                 
                                    y
                                 
                              
                              
                                 θ
                              
                           
                           
                              
                                 
                                    q
                                 
                              
                              
                                 
                                    z
                                 
                              
                              
                                 γ
                              
                           
                        , with 
                           α
                         the rotation angle around axis 
                           
                              x
                           
                        , 
                           θ
                         the rotation angle around axis 
                           
                              y
                           
                         and 
                           γ
                         the rotation angle around axis 
                           
                              z
                           
                        .

Given a tetrahedral mesh 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                        , we define a discrete frame field by assigning a frame to each vertex of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         (this is the aim of the first step of our algorithm). This field can be extended to a continuous frame field on 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         as a piecewise linear interpolation in each tetrahedron of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         using Eq. (2). In such a field, the magnitude of frames can be non-unitary and singularities are located in points of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         where frame magnitude is zero. Extending a discrete unit frame field to a continuous non-unit one ensures this latter to have singularities that are gathered in a network of lines, similar to the singularity graph in  [5]. 
                           Proposition 1
                           
                              Let 
                              
                                 
                                    
                                       F
                                    
                                    
                                       D
                                    
                                 
                               
                              be a discrete frame field defined on the vertices of 
                              
                                 
                                    
                                       T
                                    
                                    
                                       Ω
                                    
                                 
                              
                              , the continuous frame field 
                              
                                 F
                               
                              on 
                              
                                 
                                    
                                       T
                                    
                                    
                                       Ω
                                    
                                 
                               
                              built by linear extrapolation of 
                              
                                 
                                    
                                       F
                                    
                                    
                                       D
                                    
                                 
                               
                              into each element of 
                              
                                 
                                    
                                       T
                                    
                                    
                                       Ω
                                    
                                 
                               
                              does not contain any isolated singularity.
                           


                        
                           Proof
                           Due to the linear interpolation process used to build frames inside tetrahedra, having a singularity inside a tetrahedron 
                                 T
                               means that one of the triangles adjacent to 
                                 T
                               contains a singularity too. The reciprocate is true. Therefore, singularities cannot be isolated and are structured in lines of singularities.□

For classical vector fields, a singularity is located where the magnitude of a vector is zero. A singularity is then characterized by an integer number, its index, which describes the behavior of the field in the vicinity. On 2-dimensional manifolds, this notion was generalized to frame-fields  [20,30] and used to show that the degree of a singularity is either equal to 3 or 5 in 4-rosy fields  [31]. 
                           Definition 5
                           The degree of a singularity in a 4-rosy field is the number of streamlines ending on it. For a 3D frame field, the degree of a singularity line is the number of orthogonal streamlines ending on any point of the singularity line.


                        
                           Proposition 2
                           
                              Considering a continuous frame field 
                              
                                 F
                               
                              on 
                              
                                 
                                    
                                       T
                                    
                                    
                                       Ω
                                    
                                 
                               
                              built from a unit frame field defined on the vertices of 
                              
                                 
                                    
                                       T
                                    
                                    
                                       Ω
                                    
                                 
                              
                              , the degree of singularity lines is either  3  or  5.
                           

As we assign frames to vertices and not to tetrahedral elements, a singularity line either ends on 
                           ∂
                           Ω
                        , inside 
                           Ω
                         or meets other singularity lines inside the volume 
                           Ω
                        . Having singularity lines that end inside 
                           Ω
                         cannot happen with the approaches of  [5–7]. Moreover, we assign frames to the vertices of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         to generate a continuous frame field over 
                           Ω
                         by piecewise linear interpolation, while tet-assigned frames are used in  [5–7] to define a discrete singularity graph composed of singular edges of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                        . As a consequence, we do not have to perform topological cleaning to get smoother singularity lines.

The first part of the proposed method consists in generating a frame field starting from a tetrahedral mesh 
                        
                           
                              T
                           
                           
                              Ω
                           
                        
                      without any quadrilateral mesh of 
                        ∂
                        Ω
                     . The proposed method generates frames along 
                        ∂
                        Ω
                      before going into 
                        Ω
                     . In both cases, we rely on the same advancing-front algorithm and the notion of frame field smoothness, which we described now.

Frames will be defined at the vertices of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         by an extrapolation process, which is local to single simplex elements. In dimension 2 (respectively 3), we can extrapolate a frame at a vertex 
                           v
                         of a triangle (resp. a tetrahedron) 
                           t
                        , if a frame is already defined for all the vertices of 
                           t
                         but 
                           v
                        . But the order in which frames will be assigned to vertices drastically impacts the location of frame field singularities. Indeed, due to the extrapolation process, singularities will tend to be close to the last defined frames. Moreover, as the energy computed in the smoothing part of the algorithm will be non-convex (see Section  5.2), the reached minima is local and not global. In practice, this means that the location of singularities will remain roughly the same after the smoothing step. In our case, we select the vertex 
                           v
                         that is located in the steadiest area of 
                           Ω
                         in the meaning of a measure of the frame field smoothness.

In the following, we denote by 
                              
                                 
                                    B
                                 
                                 
                                    v
                                    ,
                                    r
                                 
                              
                            the ball of center 
                              v
                            and radius 
                              r
                           , and by 
                              d
                              
                                 (
                                 
                                    
                                       B
                                    
                                    
                                       v
                                       ,
                                       r
                                    
                                 
                                 )
                              
                            the function 
                              
                                 (3)
                                 
                                    
                                       
                                          max
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                          ∈
                                          B
                                          
                                             (
                                             v
                                             ,
                                             r
                                             )
                                          
                                       
                                    
                                    d
                                    
                                       (
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             v
                                          
                                       
                                       )
                                    
                                 
                              
                            where 
                              
                                 
                                    
                                       F
                                    
                                 
                                 
                                    i
                                 
                              
                            is the frame assigned to the vertex 
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                            and 
                              d
                              
                                 (
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       v
                                    
                                 
                                 )
                              
                            the distance between frames 
                              
                                 
                                    
                                       F
                                    
                                 
                                 
                                    i
                                 
                              
                            and 
                              
                                 
                                    
                                       F
                                    
                                 
                                 
                                    v
                                 
                              
                            as computed using Eq. (1). Considering a discrete frame field 
                              F
                            defined on 
                              
                                 
                                    T
                                 
                                 
                                    Ω
                                 
                              
                            and 
                              R
                            the radius of the bounding box of 
                              Ω
                           , the smoothness of 
                              F
                            locally to a vertex 
                              v
                            of 
                              
                                 
                                    T
                                 
                                 
                                    Ω
                                 
                              
                            is defined by 
                              
                                 (4)
                                 
                                    
                                       
                                          ∫
                                       
                                       
                                          r
                                          =
                                          0
                                       
                                       
                                          R
                                       
                                    
                                    
                                       
                                          max
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                          ∈
                                          B
                                          
                                             (
                                             v
                                             ,
                                             r
                                             )
                                          
                                       
                                    
                                    d
                                    
                                       (
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             v
                                          
                                       
                                       )
                                    
                                    d
                                    r
                                    .
                                 
                              
                            If the field 
                              F
                            is steady on a large area around 
                              v
                           , then there exists a value 
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                            such that Eq. (3) is zero for any 
                              r
                              <
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                           . When a difference between frames happens at a distance 
                              
                                 
                                    r
                                 
                                 
                                    i
                                 
                              
                           , it contributes accordingly to the amplitude of this change. Fig. 3
                            illustrates how to interpret this quantity with two small radius balls: the green and the red balls correspond respectively to the smoothness value computed for the frame defined in vertices 
                              G
                            and 
                              B
                           . The smoothness defined for 
                              G
                            will be close to zero since all the frames defined in its ball are aligned with the frame defined in 
                              G
                           . On the contrary, the smoothness value for 
                              B
                            will be important due to numerous misalignments between frames.

In practice, computing Eq. (4) for every vertex is quite costly. Instead, we only integrate the quantity in Eq. (4) for 
                              r
                            ranging from 0 to 
                              
                                 
                                    R
                                 
                                 
                                    v
                                 
                              
                           , with 
                              
                                 
                                    R
                                 
                                 
                                    v
                                 
                              
                            being the minimal distance from 
                              v
                            to 
                              ∂
                              Ω
                           . By this way, we consider an information which is relative to geometric features that surround each vertex individually. First, we solve the Eikonal equation 
                              
                                 ‖
                                 ∇
                                 d
                                 
                                    (
                                    
                                       x
                                    
                                    )
                                 
                                 ‖
                              
                              =
                              f
                              
                                 (
                                 
                                    x
                                 
                                 )
                              
                            with 
                              
                                 
                                    d
                                 
                                 
                                    |
                                    
                                       x
                                    
                                    ∈
                                    ∂
                                    Ω
                                 
                              
                              =
                              0
                           , in the special case that 
                              f
                              =
                              1
                           . In the general form, the scalar value 
                              d
                              
                                 (
                                 
                                    x
                                 
                                 )
                              
                            represents the shortest time to go from 
                              ∂
                              Ω
                            to the point 
                              
                                 x
                              
                              ∈
                              Ω
                           . With 
                              f
                              =
                              1
                           , 
                              d
                              
                                 (
                                 
                                    x
                                 
                                 )
                              
                            means the shortest distance between 
                              ∂
                              Ω
                            and 
                              
                                 x
                              
                           . We solve it using the well-known Fast Marching Method  [32] as done in  [33]. In our implementation, distances are precomputed for every vertex 
                              v
                            so that the information is readily available. We perform this computation twice (see Fig. 4
                           ): to get the shortest distance of any vertex of 
                              ∂
                              Ω
                            to a geometric curve, and to get the shortest distance of any vertex of 
                              Ω
                            to 
                              ∂
                              Ω
                           .

Finally, we normalize the value by dividing it by 
                              
                                 
                                    R
                                 
                                 
                                    v
                                 
                              
                           , so that we can make meaningful comparisons between the obtained smoothness values. The final quantity computed for a vertex 
                              v
                            at a distance 
                              
                                 
                                    R
                                 
                                 
                                    v
                                 
                              
                            from 
                              ∂
                              Ω
                            is thus 
                              
                                 (5)
                                 
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                R
                                             
                                             
                                                v
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∫
                                       
                                       
                                          r
                                          =
                                          0
                                       
                                       
                                          
                                             
                                                R
                                             
                                             
                                                v
                                             
                                          
                                       
                                    
                                    
                                       
                                          max
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                          ∈
                                          B
                                          
                                             (
                                             v
                                             ,
                                             r
                                             )
                                          
                                       
                                    
                                    d
                                    
                                       (
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             v
                                          
                                       
                                       )
                                    
                                    d
                                    r
                                    .
                                 
                              
                            This approximation considerably diminishes the computational cost of defining the smoothness value of each vertex, without losing much accuracy in our practical experiments.

Considering this smoothness quantity, the frame field algorithm follows a traditional advancing-front pattern. Starting with a small set of vertices 
                              
                                 
                                    S
                                 
                                 
                                    I
                                 
                              
                            of 
                              
                                 
                                    T
                                 
                                 
                                    Ω
                                 
                              
                           , where frames are already assigned, the process ends when a frame is assigned to every vertex of 
                              
                                 
                                    S
                                 
                                 
                                    V
                                 
                              
                           , with 
                              
                                 
                                    S
                                 
                                 
                                    I
                                 
                              
                              ⊂
                              
                                 
                                    S
                                 
                                 
                                    V
                                 
                              
                           . Let 
                              
                                 
                                    S
                                 
                                 
                                    
                                       alive
                                    
                                 
                              
                            ​be the set of nodes, where a frame is defined and 
                              
                                 
                                    S
                                 
                                 
                                    
                                       dead
                                    
                                 
                              
                            the set of nodes where a frame is not. The set 
                              
                                 
                                    S
                                 
                                 
                                    
                                       alive
                                    
                                 
                              
                            is initialized to 
                              
                                 
                                    S
                                 
                                 
                                    I
                                 
                              
                           . While 
                              
                                 
                                    S
                                 
                                 
                                    
                                       dead
                                    
                                 
                              
                              ≠
                              0̸
                           , the algorithm proceeds as follows: 
                              
                                 1.
                                 For all the vertices of 
                                       
                                          
                                             S
                                          
                                          
                                             
                                                dead
                                             
                                          
                                       
                                    , we extract the vertices that belong to at least one simplex having all the other vertices in 
                                       
                                          
                                             S
                                          
                                          
                                             
                                                alive
                                             
                                          
                                       
                                    . Let 
                                       
                                          
                                             S
                                          
                                          
                                             c
                                          
                                       
                                     be this set of nodes;

For each vertex 
                                       c
                                     of 
                                       
                                          
                                             S
                                          
                                          
                                             c
                                          
                                       
                                    , we compute a candidate frame value by interpolating the frames (see Eq. (2)) defined at vertices of 
                                       
                                          
                                             S
                                          
                                          
                                             
                                                alive
                                             
                                          
                                       
                                     and sharing one simplex (at least) with 
                                       c
                                    ;

For each vertex 
                                       c
                                     of 
                                       
                                          
                                             S
                                          
                                          
                                             c
                                          
                                       
                                    , a smoothness value is computed using Eq. (5) but only with alive vertices;

The vertex of 
                                       
                                          
                                             S
                                          
                                          
                                             c
                                          
                                       
                                     with the smallest smoothness value is withdrawn from 
                                       
                                          
                                             S
                                          
                                          
                                             
                                                dead
                                             
                                          
                                       
                                     and put into 
                                       
                                          
                                             S
                                          
                                          
                                             
                                                alive
                                             
                                          
                                       
                                    .

The complexity time of this initialization step is at worst 
                                    O
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                  with 
                                    n
                                  the number of vertices in 
                                    
                                       
                                          T
                                       
                                       
                                          Ω
                                       
                                    
                                 , using the smoothness value described by Eq. (4). Using the smoothness value described by Eq. (5) modify the computational cost to be at worst 
                                    O
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             
                                                
                                                   5
                                                
                                                
                                                   3
                                                
                                             
                                          
                                       
                                       )
                                    
                                  (see Appendix for details). In most practical cases, the computational cost is much lower than this, since the worst case scenario only occurs for geometries such as cubes or spheres that are both of similar length in all directions and do not possess many features in their boundary.


                           Frame field generation on the surfaces. Initially, frames are fully defined for all the vertices of 
                              
                                 
                                    T
                                 
                                 
                                    Ω
                                 
                              
                            that are along the geometrical curves of 
                              Ω
                           ,
                              2
                           
                           
                              2
                              I.e. lines of boundary edges where the dihedral angle between adjacent boundary triangle is greater than a threshold.
                            and partially defined for any vertex 
                              v
                            lying onto a surfaces area of 
                              ∂
                              Ω
                           , using the usual pseudo normal at 
                              v
                           . It is meaningless to assign frames to vertices corresponding to geometric corners of 
                              Ω
                           . So, in practice we do not. In this part of the algorithm, the set 
                              
                                 
                                    S
                                 
                                 
                                    I
                                 
                              
                            is made of all the nodes classified on a geometric curves, and 
                              
                                 
                                    S
                                 
                                 
                                    V
                                 
                              
                            is the set of nodes classified on 
                              ∂
                              Ω
                           . All the distances are computed considering the pre-computed curvilinear distance. Moreover, during the step (2) of the advancing-front algorithm, the computation of a candidate frame is slightly adapted. Let 
                              c
                            be the vertex we focus on, 
                              
                                 
                                    
                                       n
                                    
                                 
                                 
                                    c
                                 
                              
                            the normal to 
                              ∂
                              Ω
                            at 
                              c
                            and 
                              
                                 
                                    
                                       F
                                    
                                 
                                 
                                    c
                                 
                              
                            the candidate frame to be computed. If 
                              
                                 (
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                            are 
                              k
                            vertices adjacent to 
                              c
                            where frames 
                              
                                 
                                    
                                       F
                                    
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          1
                                       
                                    
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    
                                       F
                                    
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                            are respectively defined, then:
                              
                                 1.
                                 First, frames 
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                     are rotated to be aligned along 
                                       
                                          
                                             
                                                n
                                             
                                          
                                          
                                             c
                                          
                                       
                                    ;

Then, 
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             c
                                          
                                       
                                     is computed as the linear combination of modified 
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                     weighted by the curvilinear distance between 
                                       c
                                     and 
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                    , for any 
                                       i
                                       ∈
                                       
                                          {
                                          1
                                          ,
                                          …
                                          ,
                                          k
                                          }
                                       
                                    . This distance was obtained by solving the Eikonal Equation on surfaces (see Fig. 6
                                    ).


                           Frame field generation in the volume. During this part of the algorithm, the set 
                              
                                 
                                    S
                                 
                                 
                                    I
                                 
                              
                            is made of all the vertices of 
                              
                                 
                                    T
                                 
                                 
                                    ∂
                                    Ω
                                 
                              
                            and 
                              
                                 
                                    S
                                 
                                 
                                    V
                                 
                              
                            is made of all the vertices of 
                              
                                 
                                    T
                                 
                                 
                                    Ω
                                 
                              
                           . The distance is the 3D Euclidean distance.

In order to improve the obtained frame field, a smoothing algorithm, similar to one done in  [7], is performed twice: after having defined frames along 
                           
                              
                                 T
                              
                              
                                 ∂
                                 Ω
                              
                           
                         and when all the frames are defined into 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                        . The smoothing process proposed in  [7] consists in minimizing a highly non-linear energy function, which strongly depends on the initial values that are assigned to each vertex of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                        . Given two frames 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 2
                              
                           
                         and their respective quaternions 
                           
                              
                                 
                                    q
                                 
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    q
                                 
                              
                              
                                 2
                              
                           
                        , the quaternion 
                           
                              q
                           
                           =
                           
                              
                                 
                                    q
                                 
                              
                              
                                 2
                              
                           
                           
                              
                                 
                                    q
                                 
                              
                              
                                 1
                              
                              
                                 −
                                 1
                              
                           
                         transforms 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 1
                              
                           
                         into 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 2
                              
                           
                        . Considering the corresponding rotation matrix 
                           
                              
                                 M
                              
                              
                                 1
                                 →
                                 2
                              
                           
                        , a measure of the closeness between 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 2
                              
                           
                         can be defined as: 
                           
                              (6)
                              
                                 
                                    
                                       E
                                    
                                    
                                       12
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                    
                                 
                                 
                                    [
                                    H
                                    
                                       (
                                       
                                          
                                             M
                                          
                                          
                                             1
                                             →
                                             2
                                          
                                       
                                       
                                          [
                                          .
                                          ,
                                          i
                                          ]
                                       
                                       )
                                    
                                    +
                                    H
                                    
                                       (
                                       
                                          
                                             M
                                          
                                          
                                             1
                                             →
                                             2
                                          
                                       
                                       
                                          [
                                          i
                                          ,
                                          .
                                          ]
                                       
                                       )
                                    
                                    ]
                                 
                              
                           
                         where 
                           
                              
                                 M
                              
                              
                                 1
                                 →
                                 2
                              
                           
                           
                              [
                              .
                              ,
                              i
                              ]
                           
                         and 
                           
                              
                                 M
                              
                              
                                 1
                                 →
                                 2
                              
                           
                           
                              [
                              i
                              ,
                              .
                              ]
                           
                         denote the 
                           i
                        th row and column vector respectively, and 
                           H
                           
                              (
                              
                                 v
                              
                              )
                           
                           =
                           
                              
                                 
                                    v
                                 
                              
                              
                                 x
                              
                              
                                 2
                              
                           
                           
                              
                                 
                                    v
                                 
                              
                              
                                 y
                              
                              
                                 2
                              
                           
                           +
                           
                              
                                 
                                    v
                                 
                              
                              
                                 y
                              
                              
                                 2
                              
                           
                           
                              
                                 
                                    v
                                 
                              
                              
                                 z
                              
                              
                                 2
                              
                           
                           +
                           
                              
                                 
                                    v
                                 
                              
                              
                                 z
                              
                              
                                 2
                              
                           
                           
                              
                                 
                                    v
                                 
                              
                              
                                 x
                              
                              
                                 2
                              
                           
                        . The function 
                           H
                         is invariant on 
                           
                              [
                              
                                 F
                              
                              ]
                           
                           [7]. This measure can be expressed on any edge 
                           
                              
                                 e
                              
                              
                                 i
                                 j
                              
                           
                         of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         between the frames of its end vertices 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 j
                              
                           
                        . We get the following energy function for the whole field: 
                           
                              (7)
                              
                                 E
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             i
                                             j
                                          
                                       
                                       ∈
                                       
                                          
                                             T
                                          
                                          
                                             Ω
                                          
                                          
                                             E
                                          
                                       
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       i
                                       j
                                    
                                 
                              
                           
                         where 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                              
                                 E
                              
                           
                         is the set of edges of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                        . Note that this closeness expression is not the same as the one expressed in Eq. (1). Eq. (1) is better suited to express the distance between frames locally and to define interpolations between a small set of frames (as in Eq. (2)), whereas this expression is more adapted to defining an energy corresponding to a fully defined frame field that can then be minimized to smooth the frame field globally. However, trying to minimize this energy right away would generate general matrices and not rotational ones. Instead of applying a post process that would consist in projecting the obtained value onto the unit sphere, and thus introducing numerical errors, we use Euler angles, as done in  [7]. Inner and boundary frames are then distinguished. An inner frame 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 i
                              
                           
                         has three degrees of freedom: each of the matrices representing it can be written as 
                           
                              
                                 
                                    
                                       M
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       R
                                    
                                    
                                       
                                          x
                                       
                                    
                                 
                                 
                                    (
                                    
                                       
                                          α
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 
                                    
                                       R
                                    
                                    
                                       
                                          y
                                       
                                    
                                 
                                 
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 
                                    
                                       R
                                    
                                    
                                       
                                          z
                                       
                                    
                                 
                                 
                                    (
                                    
                                       
                                          γ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              
                           
                         where 
                           
                              
                                 α
                              
                              
                                 i
                              
                           
                        , 
                           
                              
                                 θ
                              
                              
                                 i
                              
                           
                         and 
                           
                              
                                 γ
                              
                              
                                 i
                              
                           
                         are the rotation angle around axis 
                           
                              x
                           
                        , axis 
                           
                              y
                           
                         and axis 
                           
                              z
                           
                         respectively. A boundary frame at a vertex 
                           V
                         has only one degree of freedom 
                           θ
                        . It can be expressed as 
                           
                              
                                 
                                    {
                                    
                                       cos
                                    
                                    
                                       (
                                       θ
                                       )
                                    
                                    
                                       
                                          
                                             T
                                          
                                       
                                       
                                          
                                             1
                                          
                                       
                                    
                                    +
                                    
                                       sin
                                    
                                    
                                       (
                                       θ
                                       )
                                    
                                    
                                       
                                          
                                             T
                                          
                                       
                                       
                                          
                                             2
                                          
                                       
                                    
                                    ,
                                    −
                                    
                                       sin
                                    
                                    
                                       (
                                       θ
                                       )
                                    
                                    
                                       
                                          
                                             T
                                          
                                       
                                       
                                          
                                             1
                                          
                                       
                                    
                                    +
                                    
                                       cos
                                    
                                    
                                       (
                                       θ
                                       )
                                    
                                    
                                       
                                          
                                             T
                                          
                                       
                                       
                                          
                                             2
                                          
                                       
                                    
                                    ,
                                    
                                    
                                       N
                                    
                                    }
                                 
                              
                           
                         with 
                           
                              N
                           
                         the normal to 
                           ∂
                           Ω
                         at 
                           V
                         and 
                           
                              
                                 
                                    T
                                 
                              
                              
                                 
                                    1
                                 
                              
                           
                           ,
                           
                              
                                 
                                    T
                                 
                              
                              
                                 
                                    2
                                 
                              
                           
                         two orthogonal tangent vectors relying in the tangent plane of 
                           ∂
                           Ω
                         at 
                           V
                        . The minimization of the nonlinear function 
                           E
                         of Eq. (7) is performed using the same L-BFGS method than the one used in  [7].

Contrary to  [6,7], this process is not simply used as a final stage but it is adapted to be performed for any set of frames. In our case, it is used when all the frames of the surface and all the frames of the volume are defined. Moreover, the impact of this process on the global result is visible but not in the same proportions than in  [6]. Indeed singularities are better located with our process based on the smoothness evaluation. Consequently, E converges much quicker, in 10–25 iterations instead of several hundreds, confirming that the proposed initialization step leads to a better global solution in terms of the energy function of Eq. (7). An example of smoothing used to improve the orientations of frames on the surfaces is given in Fig. 7
                        .

The second step of our algorithm consists in extracting the topological features of the frame field to build a singularity graph. Fig. 8
                      illustrates the global process of this step that we detail in the following. We first detect and build inner singularity points 
                        
                           
                              p
                           
                           
                              1
                           
                        
                      and 
                        
                           
                              p
                           
                           
                              2
                           
                        
                      and inner singularity lines. Then, for each boundary singularity point, boundary singularity lines are spread up leading to an incomplete partitioning of 
                        ∂
                        Ω
                     . Finally, boundary singularity lines are connected and inner surface patches can be derived.

Defining a continuous frame field 
                           F
                         on 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         starting from a discrete unit frame field defined on the vertices of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         implies that we do not have any isolated singularity point. As a consequence, we can detect singularity points and lines in 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         by analyzing faces of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                        . 
                           Definition 6
                           The discrete unit frame field 
                                 F
                               is said to be regular over a mesh entity 
                                 e
                               (which can be a mesh edge, face, or tetrahedra) if it is possible to define 6 independent discrete unit vector fields over 
                                 e
                               such that, for any point 
                                 P
                               of 
                                 e
                              , the 6 vectors interpolated at 
                                 P
                               ​correspond to the value of 
                                 F
                               interpolated at 
                                 P
                              . If 
                                 F
                               is not regular over 
                                 e
                              , then it is singular over 
                                 e
                              .

To detect if a face 
                           f
                         is traversed by a singularity line, and thus singular, we consider the behavior of the frame field 
                           F
                         along the loop defined by the adjacent edges of 
                           f
                        . Let 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                        , 
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 3
                              
                           
                         ​be the three vertices of 
                           f
                         and 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                              
                           
                        , 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         and 
                           
                              
                                 
                                    F
                                 
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       3
                                    
                                 
                              
                           
                         the corresponding frames. We proceed as follows: 
                           
                              1.
                              The direction 
                                    
                                       d
                                    
                                  common to frames 
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 , 
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                  is computed;

Frames 
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 , 
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                  are rotated to be aligned along 
                                    
                                       d
                                    
                                 .


                                 
                                    
                                       d
                                    
                                 -orthogonal 2D crosses 
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                 , 
                                    
                                       
                                          c
                                       
                                       
                                          2
                                       
                                    
                                  and 
                                    
                                       
                                          c
                                       
                                       
                                          3
                                       
                                    
                                  are respectively extracted from frames 
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 , 
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                 ;

Considering crosses 
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                 , 
                                    
                                       
                                          c
                                       
                                       
                                          2
                                       
                                    
                                  and 
                                    
                                       
                                          c
                                       
                                       
                                          3
                                       
                                    
                                  and the edge path joining them a singularity index, similar to the notion of Poincaré index for vector fields, can be computed  [20,30].

Singularity lines are then built as piecewise linear lines joining two inner singularity points or an inner singularity point to 
                           ∂
                           Ω
                        . The list of points defining a singularity line 
                           
                              
                                 l
                              
                              
                                 s
                              
                           
                         is made of the intersection points between the faces of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                         and 
                           
                              
                                 l
                              
                              
                                 s
                              
                           
                        . We apply a post process smoothing algorithm to obtain smoother curves.

Once inner singularity lines are defined, boundary singularity lines can be built. Starting from each boundary singularity point 
                           
                              
                                 p
                              
                              
                                 i
                              
                           
                        , i.e. a boundary ending point of an inner singularity line, we spread up singularity lines from 
                           
                              
                                 p
                              
                              
                                 i
                              
                           
                         onto 
                           ∂
                           Ω
                        . To do it, we use the Heun’s method  [34], a simple variation of the Runge–Kutta method  [34], locally to each traversed triangle 
                           T
                           ∈
                           ∂
                           Ω
                        . Starting from a point 
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                         on the boundary of 
                           T
                        , it consists in computing an intermediate point 
                           
                              
                                 X
                              
                              
                                 i
                                 +
                                 1
                              
                              
                                 ′
                              
                           
                        : 
                           
                              (8)
                              
                                 
                                    
                                       X
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 h
                                 f
                                 
                                    (
                                    
                                       
                                          X
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              
                           
                         with 
                           f
                         the local 2D frame field that we obtain by projecting the 3D frame field 
                           F
                         onto the 2D plane that contains 
                           T
                        . Then using 
                           f
                           
                              (
                              
                                 
                                    X
                                 
                                 
                                    i
                                    +
                                    1
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                         along 
                           f
                           
                              (
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        , we compute 
                           
                              
                                 
                                    d
                                 
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        : 
                           
                              (9)
                              
                                 
                                    
                                       
                                          d
                                       
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       f
                                       
                                          (
                                          
                                             
                                                X
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       +
                                       f
                                       
                                          (
                                          
                                             
                                                X
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                         Eventually, we compute 
                           
                              
                                 X
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        : 
                           
                              (10)
                              
                                 
                                    
                                       X
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 h
                                 
                                    
                                       
                                          d
                                       
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                              
                           
                         with 
                           h
                         being the integration step. In our case, instead of picking a predefined 
                           h
                        , we compute the intersection of the line defined by the starting point and direction with the boundary of the simplicial cell (see Fig. 10
                        ). A line can thus be built using segment lines, by iterating this integration process over the successive encountered cells.

This process is used to spread all the boundary singularity lines emanating from a boundary singularity point. Such lines end up either on another boundary singularity point (like the line 
                           
                              
                                 l
                              
                              
                                 1
                              
                           
                         in Fig. 11
                        (a)) or on a geometric curve (like the line 
                           
                              
                                 l
                              
                              
                                 2
                              
                           
                         in Fig. 11(a)). If it ends in a singularity point, the line is spread again in the opposite direction and blend with the previous one to ensure that the process does not depend on the order in which singularities are treated (see Fig. 11(b) where the line 
                           
                              
                                 l
                              
                              
                                 1
                              
                           
                         is different from the one presented in (a)). Technically, when we spread a boundary line from a boundary point, it can meet another boundary point or miss it due to numerical approximations and the refinement level of 
                           
                              
                                 T
                              
                              
                                 Ω
                              
                           
                        . To be convinced, let us consider the 2D case of Fig. 12
                         where a geometric domain is slightly modified by increasing the size of the right “window hole”. Due to this modification, the generated frame field is modified and the singularity points that are connected in (a) are no more connected in the other cases.

Thus we assume that perfect alignment is not always obtained depending on the frame field. In order to get singularity lines that are suitable to generate block-structure we introduce a threshold value. Let 
                           ϵ
                           >
                           0
                         be this value, an 
                           ϵ
                        -radius ball is defined as centered on each boundary singularity point. Then, during the integration process of a singularity line 
                           
                              
                                 l
                              
                              
                                 s
                              
                           
                         on 
                           ∂
                           Ω
                        , we look for the intersection between 
                           
                              
                                 l
                              
                              
                                 s
                              
                           
                         and these balls. Let 
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                         ​be the ball of radius 
                           ϵ
                         and center a boundary singularity point 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                        . If 
                           
                              
                                 l
                              
                              
                                 s
                              
                           
                         intersects 
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                        , then we check if 
                           
                              
                                 l
                              
                              
                                 s
                              
                           
                         can connect to one of the available slots at 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                        . In Fig. 13
                        , 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                         is a singularity of degree 3, and we can connect 
                           
                              
                                 l
                              
                              
                                 s
                              
                           
                         to 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                         along 
                           
                              
                                 d
                              
                              
                                 3
                              
                           
                        .

First boundary singularity lines are spread up from boundary singularity points. Then a boundary singularity line 
                           
                              
                                 l
                              
                              
                                 s
                              
                           
                         connects boundary singularity points or reaches a geometric curve 
                           C
                         defined as a line of edges on 
                           ∂
                           Ω
                        . In this case, 
                           
                              
                                 l
                              
                              
                                 s
                              
                           
                         is propagated on the other side of 
                           C
                         or connects to a line 
                           
                              
                                 l
                              
                              
                                 s
                              
                              
                                 2
                              
                           
                         defined on the other side of 
                           C
                        . In Fig. 14
                        (a), the boundary lines defined on the two sides of 
                           C
                         are not connected. Then left lines are connected in (b) and right ones in (c).

Once all the singularity points and lines are created, some extra lines have to be added. These lines and points live in geometric areas where the frame field is stable, but they are mandatory to get quadrilateral surfaces patches and to capture non-convex geometric corners. Eventually, quadrilateral patches then hexahedral blocks are built using a simple greedy algorithm that should be improved in the future. Final meshes are obtained using simple transfinite interpolations schemes.

@&#RESULTS AND DISCUSSIONS@&#

Our approach has been evaluated on various tetrahedral meshes that discretize CAD models. There is no boundary frame field provided as an input.


                        Figs. 15 and 16
                        
                         illustrate the impact of the mesh resolution onto the algorithm. From left to right in Fig. 15, meshes have respectively 5738, 58871 and 175079 cells. We can see that the tetrahedra set containing singularity lines becomes sharper and thinner demonstrating that our method seems to converge when the geometric model is better approximated. In Fig. 16, the obtained singularity graphs are similar: the algorithm is thus robust enough as soon as the domain is sufficiently approximated.

The rough initialization process proposed by  [7] can lead to frame fields where singularity lines are along the medial object of 
                           Ω
                        . In fact, as their approach starts from a quadrilateral mesh of 
                           ∂
                           Ω
                        , the resulting singularity graph strongly depends on this boundary mesh. Left and middle of Fig. 17
                         ​show an extreme example of how singularities can be gathered around the medial object. In this case, even after a global smoothing, the obtained field has singularity lines that are too closely intertwined to be of any use. Our initialization process, on the other hand, generates singularity lines that are separated one from another (top row of Fig. 17).

We also evaluated our initialization process in 2D. The right part of Fig. 17 shows the resulting fields obtained either using our approach (top) or by assigning the vertices by only considering their distance to the boundary (bottom). In the second case, the two singularities are clustered on the medial object. While the global smoothing that follows the initialization step is able to improve the results somewhat, the resulting field is still very distorted, and the singularities are still very close one to the other. It is due to the fact that the global smoothing could only find the closest local minima of the energy function. On the other hand, our approach gives a natural placement of singularities, and provides results consistent both with the usual manual decomposition of such a domain and the results obtained through state-of-the-art algorithms  [20–22].


                        Figs. 18–20
                        
                        
                         show all-hexahedra meshes obtained for different domains. The singularity graph always defined a block structure adapted to hexahedral meshing. We can notice that the symmetry of the domains is not totally preserved in the generated frame fields. Better results could be obtained with more refined meshes.

For the last example, shown in Fig. 21
                        , we have represented different specific features of our approach. In (a), the distance function computed on the surface is represented; in (b), the frames defined on the boundary are shown using a cube representation; in (c), only the tetrahedral elements traversed by singularity lines are shown in red. Eventually, the obtained hexahedral mesh is shown in (d).


                        Fig. 22
                        (a) and (b) picture simple geometries for which our algorithm fails to find a partitioning leading to a valid hexahedral configuration. The problem arises from the fact that the frame field defined over surfaces may create patterns that do not correspond to each other, at which point internal lines of singularities will have to start from one of the face, but end up inside the volumes. Fig. 22(c) and (d), for example, show patterns of streamlines observed on the top and bottom faces of the cube in Fig. 22(a) geometry. A human would recognize this problem beforehand, and impose the pattern observed in Fig. 22(c) on the bottom face, thus allowing the lines of singularities to end on the bottom face. However, detecting such situations and modifying the field to correct the issue is a complex problem that will require further work. Note that this issue is not specific to our work: all current methods  [6,7] are faced with similar issues, and finding a solution to this problem will be necessary to generalize those methods to any geometry.

@&#CONCLUSIONS AND FUTURE WORK@&#

In this paper we presented a novel algorithm to generate block-structures that are adapted to hexahedral mesh generation. Following  [6,7], a frame field is used to guide the block-structure creation but our work is original in many aspects: (1) the proposed algorithm does not require a pre-meshed boundary or a predefined boundary cross field; (2) Using an optimized initialization step, we alleviate a drawback of  [6,7], preventing lines of singularities to be clustered around the medial object and lowering the energy value of the field; (3) We use a per-vertex formulation that allows us to generate smooth singularity graphs without performing post-process topological operations on 
                        
                           
                              T
                           
                           
                              Ω
                           
                        
                     ; (4) Instead of performing a parametrization algorithm, a block structure is built on the singularity graph of the frame field.

Improvements and future works have to be done to obtain a more robust algorithm. We consider that two main directions should be investigated. First, it would be interesting to use an adaptive process where a coarse mesh would be used to get a first estimation of the solution before refining it in the vicinity of the singularity points and lines. Such an improvement could significantly reduce the computational cost of the initialization step. Second, as we generate the frame field along the surfaces first then inside the volumes, we can meet unexpected configuration due to incompatible decisions taken on different surfaces. A major incoming improvement will be to generate the surface and volume frame field in a same process, that would only consider 3D geometric information. Eventually, the main drawback of the proposed approach is that we have no theoretical guarantee that the generated frame field corresponds to the structure of a hexahedral mesh. To achieve this, we believe that it is necessary to take into account the global structure of hexahedral meshes in the formulation of the energy to minimize, while only local line alignment is performed by now.

@&#ACKNOWLEDGMENT@&#

The authors would like to thank Y. Liu for kindly answering to their questions about  [7].

For each candidate vertex 
                           
                              
                                 S
                              
                              
                                 c
                              
                           
                        , we create a table 
                           
                              
                                 T
                              
                              
                                 c
                              
                           
                         containing two values for each entry. Each entry of 
                           
                              
                                 T
                              
                              
                                 c
                              
                           
                         ​corresponds to a vertex 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                         of 
                           
                              
                                 S
                              
                              
                                 
                                    alive
                                 
                              
                           
                        . The first value of each entry corresponds to the geometrical distance from 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                         to 
                           
                              
                                 S
                              
                              
                                 c
                              
                           
                        . The second value corresponds to the distance between the frames defined at 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                         and 
                           
                              
                                 S
                              
                              
                                 c
                              
                           
                        . Each vertex 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                         is introduced in 
                           
                              
                                 T
                              
                              
                                 c
                              
                           
                         in increasing distance from 
                           
                              
                                 S
                              
                              
                                 c
                              
                           
                        , and only if the second value for that point is superior to the second value of the previous entry. At the end of this process, the table contains a set of entries that are increasing both comparing the first and the second values. The smoothness at 
                           
                              
                                 S
                              
                              
                                 c
                              
                           
                         can then be computed, assuming 
                           n
                         entries 
                           
                              (
                              
                                 
                                    
                                       first
                                    
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    
                                       second
                                    
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         in its table, as 
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 n
                                 −
                                 1
                              
                           
                           
                              
                                 
                                    second
                                 
                              
                              
                                 i
                              
                           
                           ∗
                           
                              (
                              
                                 
                                    
                                       first
                                    
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              −
                              
                                 
                                    
                                       first
                                    
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        , which is the integration of the stair function defined by the entries of the table.

While in theory such tables can have as many entries as there are vertices in the background mesh, in practice, each table only contains a few dozen entries maximum (and if there are much more than that, it is possible to approximate the table by merging entries that are too close to each other and thus do not change the stair function by more than an 
                           ϵ
                         value). Assuming, for example, a maximum number of entries of 100, then the cost of checking if a new point needs to be introduced in the table is at most of 100 operations. Each insertion of an entry 
                           
                              (
                              f
                              ,
                              s
                              )
                           
                         is indeed executed as follows, doing at most one operation per entry of the table: 
                           
                              1.
                              compare 
                                    f
                                  with 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                    
                                 , with 
                                    
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                  the current entry in the table, starting with the first entry in the table

if 
                                    f
                                    >
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                    
                                 , increase 
                                    i
                                  (go to the next entry in the table) and go back to step 1

if 
                                    f
                                    ≤
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                    
                                  or if there are only 
                                    
                                       (
                                       i
                                       −
                                       1
                                       )
                                    
                                  entries, then if 
                                    
                                       (
                                       f
                                       ,
                                       s
                                       )
                                    
                                  is to be introduced, it is at position 
                                    i
                                 
                              

if 
                                    s
                                    >
                                    
                                       
                                          s
                                       
                                       
                                          i
                                          −
                                          1
                                       
                                    
                                  or if 
                                    i
                                    =
                                    1
                                 , then introduce 
                                    
                                       (
                                       f
                                       ,
                                       s
                                       )
                                    
                                  in the table at position 
                                    i
                                 , else, stop the verification

if 
                                    
                                       (
                                       f
                                       ,
                                       s
                                       )
                                    
                                  was introduced, for each entry in the table that follows it, suppress it if its second value is inferior to 
                                    s
                                 .

In the second case, for the table at 
                           
                              
                                 S
                              
                              
                                 c
                              
                           
                        , only the vertices that are closer to 
                           
                              
                                 S
                              
                              
                                 c
                              
                           
                         than 
                           
                              
                                 S
                              
                              
                                 c
                              
                           
                         is to the boundary are tested. On average, there will be 
                           
                              
                                 N
                              
                              
                                 
                                    
                                       2
                                    
                                    
                                       3
                                    
                                 
                              
                           
                         such vertices, instead of 
                           N
                         in the previous case, and the overall complexity thus becomes a total of maximum 
                           100
                           
                              
                                 N
                              
                              
                                 
                                    
                                       5
                                    
                                    
                                       3
                                    
                                 
                              
                           
                         operations required.

@&#REFERENCES@&#

