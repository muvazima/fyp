@&#MAIN-TITLE@&#Spitzer identity, Wiener-Hopf factorization and pricing of discretely monitored exotic options

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We deal with the finite time distribution of the discrete extrema for a Lévy process.


                        
                        
                           
                           We propose a procedure based on the combined use of Hilbert- and z-transforms.


                        
                        
                           
                           Our results solve in an efficient and accurate way a long-standing problem.


                        
                        
                           
                           Our results are relevant in many fields: Operational research, finance, insurance, engineering, physics.


                        
                        
                           
                           As a concrete application, we contribute to the option pricing literature.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Path-dependent options

Hilbert transform

Lévy process

Spitzer identity

Wiener-Hopf factorization

@&#ABSTRACT@&#


               
               
                  The Wiener-Hopf factorization of a complex function arises in a variety of fields in applied mathematics such as probability, finance, insurance, queuing theory, radio engineering and fluid mechanics. The factorization fully characterizes the distribution of functionals of a random walk or a Lévy process, such as the maximum, the minimum and hitting times. Here we propose a constructive procedure for the computation of the Wiener-Hopf factors, valid for both single and double barriers, based on the combined use of the Hilbert and the z-transform. The numerical implementation can be simply performed via the fast Fourier transform and the Euler summation. Given that the information in the Wiener-Hopf factors is strictly related to the distributions of the first passage times, as a concrete application in mathematical finance we consider the pricing of discretely monitored exotic options, such as lookback and barrier options, when the underlying price evolves according to an exponential Lévy process. We show that the computational cost of our procedure is independent of the number of monitoring dates and the error decays exponentially with the number of grid points.
               
            

@&#INTRODUCTION@&#

This paper provides a new procedure to determine the finite-time distribution of the discrete extrema and of the hitting times of one or two barriers for a process with independent and identically distributed increments, such as a Lévy process. Spitzer (1956) provided a closed formula for the z-transform (or moment generating function or discrete Laplace transform) of the characteristic function of the extrema of a random walk observed on a set of discrete dates. Up to now the concrete application of the Spitzer identity has been difficult because it requires the Wiener-Hopf (WH) factorization of a function defined in the complex plane, a mathematical problem that concerns a variety of fields in applied mathematics. Indeed, this factorization cannot be achieved analytically except in few cases, or its computation turns out to be very demanding requiring the numerical evaluation of a multidimensional integral in the complex plane. In addition, with regard to a general Lévy process, little is known for the two-barriers case.

The key contributions of our paper are the following. First of all, we provide a constructive procedure for performing the WH factorization. More precisely, we express the WH factors arising in the Spitzer identity in terms of the Plemelj–Sokhotsky relations, which allow us to compute the WH factors through the Hilbert transform. The latter is then approximated via a sinc function expansion (Stenger, 1993), which guarantees an exponential decay of the approximation error on the number of grid points.

Moreover, our methodology can deal with both a single and a double barrier. The solution in the second case is of interest in itself because it solves a long-standing problem related to an efficient computation of the WH factors in the presence of two barriers. The double-barrier case did not admit a simple feasible solution up to now, except under few special assumptions on the structure of the Lévy process. One has to solve two coupled integral equations, which can be achieved by factorizing a 2 × 2 matrix of functions, but a general analytical method for this more difficult problem has not been found yet (Jones, 1991). Here, as the second main contribution of the paper, we constructively propose a fixed-point algorithm based on an extension of the single-barrier case that achieves a fast convergence.

As a concrete application, we contribute to the mathematical finance literature related to the pricing of exotic options, such as barrier and lookback. Pricing derivatives, especially exotic options, is a challenging problem in the operations research literature (to cite a few, see Cai, Chen, & Wan, 2009; Date & Islyaev, 2015; Dingeç & Hörmann, 2012; Feng & Linetsky, 2008b; Giesecke & Smelov, 2013; Jin, Li, Tan, & Wu, 2013; Sesana, Marazzina, & Fusai, 2014; Wang & Tan, 2013). The application of transform techniques in mathematical finance is rather recent. The first and most important contributions are probably the articles by Heston (1993) and Carr and Madan (1999), where the authors show how to price European options with non-Gaussian models exploiting the Fourier transform. Similar techniques were developed later for path-dependent derivatives (e.g. Cai et al., 2009; Feng & Linetsky, 2008a; Green, Fusai, & Abrahams, 2010). Our paper provides a unified framework and a fast operational method for pricing barrier and lookback (or hindsight) options when the underlying asset evolves as an exponential Lévy process. In addition, the monitoring condition, e.g., the event that the underlying asset value falls below a given barrier for a down-and-out barrier option, is assumed to be controlled at discrete time intervals. Our procedure, based on the new WH factorization method, has a computational cost independent of the number of monitoring dates. This is possible because the inversion of the discrete Laplace transform is performed via the Euler acceleration, which bounds from above the number of WH factorizations to be computed. Moreover, at least with regard to single-barrier and lookback options, the method provides exponential order of convergence due to the fact that the factorization is performed remaining in the complex plane. The existing pricing methods are based on the backward recursive formula (e.g. Fusai, Longo, Marena, & Recchioni, 2009; Fusai, Marazzina, Marena, & Ng, 2012; Fusai & Recchioni, 2007; Jackson, Jaimungal, & Surkov, 2008; Lord, Fang, Bervoets, & Oosterlee, 2008), and on exploiting the convolution structure of the transition density of the Lévy process by performing the computations efficiently and fast using the FFT, which leads to a CPU time that grows as 
                        
                           O
                           (
                           M
                           log
                           M
                           )
                           ,
                        
                      where M is the number of grid points. However, all the above cited methods are characterized by a polynomial decay of the error with M. This order of accuracy is related to the fact that the backward procedure for barrier options involves a convolution, that can be computed in the complex plane, and a projection, which is applied in the real plane, to take into account the presence of the barrier. A noticeable exception was presented by Feng and Linetsky (2008a, 2009), who reformulated the backward procedure for barrier and lookback options in terms of the Hilbert transform, so that all steps are performed in the complex plane. Computing the Hilbert transform with a sinc function expansion, they achieved an exponential decay of the error. However, the computational cost of all these methods, including the one by Feng and Linetsky, increases linearly with the number of monitoring dates.

Finally, the factorization procedure introduced here is quite general and can also be applied, without any additional complication, to continuously-monitored contracts. Even the best available method listed above, i.e., that by Feng and Linetsky, does not have this feature.

Even if the Spitzer identity has already been used in option pricing (e.g. Atkinson & Fusai, 2007; Borovkov & Novikov, 2002; Green et al., 2010; Lewis & Mordecki, 2008) and the present paper is mainly focused on this kind of applications, our method goes well beyond option pricing and opens up the way to a more extensive use of the Spitzer identity and the WH factorization in a variety of non-financial fields; for physics, see a recent review by Bray, Majumdar, and Schehr (2013). In this regard we would like to mention the applicability to queuing theory due to the strict connection between random walks and queues, see Lindley (1952) for pioneering contributions as well as Cohen (1975), Prabhu (1974) and Asmussen (1987); 1998). Further applications include insurance (Gerber, Shiu, & Yang, 2013) and sequential testing (Siegmund, 1985). Finally, the WH factorization arises in many branches of engineering, mathematical physics and applied mathematics. This is testified by the thousands of papers published on the subject since its conception. A review of the different applications is given by Lawrie and Abrahams (2007).

The structure of the paper is the following. Section 2 introduces the Spitzer identity and its relationship with the WH factorization, proposing, via the interpretation of the Plemelj–Sokhotsky relations as Hilbert transforms, a new operational method to perform the factorization and therefore to compute the distributions of the minimum and the maximum of a Lévy process, as well as the joint distributions of the process at maturity and of its minimum or maximum over the whole time interval. Section 3 shows how the proposed general methodology can be implemented efficiently and accurately computing the Hilbert transform via a sinc expansion; we also discuss the inversion of the z-transform and its acceleration through the Euler summation rule to make the computational cost independent of the number of monitoring dates. Section 4 deals with the pricing problem for lookback and barrier options, describing how our procedure is fast as well as accurate. This is validated numerically in Section 5 with a variety of numerical experiments.

We consider a Lévy process X(t), i.e., a stochastic process with 
                        
                           X
                           (
                           0
                           )
                           =
                           0
                        
                      and independent and identically distributed increments. The Lévy–Khincine formula states that the characteristic function of the process is given by 
                        
                           Ψ
                           
                              (
                              ξ
                              ,
                              t
                              )
                           
                           =
                           E
                           
                              [
                              
                                 e
                                 
                                    i
                                    ξ
                                    X
                                    (
                                    t
                                    )
                                 
                              
                              ]
                           
                           =
                           
                              e
                              
                                 ψ
                                 (
                                 ξ
                                 )
                                 t
                              
                           
                           ,
                        
                      where ψ is the characteristic exponent of the process,

                        
                           (1)
                           
                              
                                 
                                    
                                       
                                          ψ
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          i
                                          a
                                          ξ
                                          −
                                          
                                             1
                                             2
                                          
                                          
                                             σ
                                             2
                                          
                                          
                                             ξ
                                             2
                                          
                                          +
                                          
                                             ∫
                                             R
                                          
                                          
                                             (
                                             
                                                e
                                                
                                                   i
                                                   ξ
                                                   η
                                                
                                             
                                             −
                                             1
                                             −
                                             i
                                             ξ
                                             η
                                             
                                                1
                                                
                                                   |
                                                   η
                                                   |
                                                   <
                                                   1
                                                
                                             
                                             )
                                          
                                          ν
                                          
                                             (
                                             d
                                             η
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     The Lévy–Khincine triplet (a, σ, ν) fully defines the Lévy process X(t).

In several applications in queueing theory, insurance and financial mathematics, the key point is the determination of the law of the extrema of the Lévy process observed on an equally-spaced grid 
                        
                           
                              X
                              n
                           
                           =
                           X
                           
                              (
                              n
                              Δ
                              )
                           
                           ,
                           
                           n
                           =
                           0
                           ,
                           …
                           ,
                           N
                           ,
                        
                      where Δ > 0 is the time step, i.e., the distance between two consecutive monitoring dates, which is assumed constant. We define the processes of the maximum MN
                      and of the minimum mN
                      up to the Nth monitoring date as

                        
                           (2)
                           
                              
                                 
                                    
                                       
                                          
                                             M
                                             N
                                          
                                          =
                                          
                                             max
                                             
                                                n
                                                =
                                                0
                                                ,
                                                ⋯
                                                ,
                                                N
                                             
                                          
                                          
                                             X
                                             n
                                          
                                          
                                          and
                                          
                                          
                                             m
                                             N
                                          
                                          =
                                          
                                             min
                                             
                                                n
                                                =
                                                0
                                                ,
                                                ⋯
                                                ,
                                                N
                                             
                                          
                                          
                                             X
                                             n
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     To distinguish the present case, where the above processes, albeit evolving in continuous time, are recorded only at discrete times, the terminology discrete versus continuous monitoring is used.

In particular, besides the distribution PX
                     (x, N) of the Lévy process at maturity 
                        
                           T
                           =
                           N
                           Δ
                           ,
                        
                      we will need the distributions Pm
                     (x, N) of the minimum and PM
                     (x, N) of the maximum over the whole set 
                        
                           {
                           n
                           =
                           0
                           ,
                           …
                           ,
                           N
                           }
                           ,
                        
                      as well as the joint distributions P
                     
                        X, m
                     (x, N) or P
                     
                        X, M
                     (x, N) of the process at maturity and of its minimum or maximum over the interval with respect to a lower (upper) barrier l (u), and the joint distribution of the triplet (XN, mN, MN
                     ), P
                     
                        X, m, M
                     (x, N). These distributions are defined as

                        
                           (3)
                           
                              
                                 
                                    
                                       
                                          d
                                          
                                             P
                                             X
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          =
                                          
                                             p
                                             X
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          d
                                          x
                                          =
                                          P
                                          
                                             [
                                             
                                                X
                                                N
                                             
                                             ∈
                                             
                                                [
                                                x
                                                ,
                                                x
                                                +
                                                d
                                                x
                                                )
                                             
                                             ]
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (4)
                           
                              
                                 
                                    
                                       
                                          d
                                          
                                             P
                                             m
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          =
                                          
                                             p
                                             m
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          d
                                          x
                                          =
                                          P
                                          
                                             [
                                             
                                                m
                                                N
                                             
                                             ∈
                                             
                                                [
                                                x
                                                ,
                                                x
                                                +
                                                d
                                                x
                                                )
                                             
                                             ]
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (5)
                           
                              
                                 
                                    
                                       
                                          d
                                          
                                             P
                                             M
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          =
                                          
                                             p
                                             M
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          d
                                          x
                                          =
                                          P
                                          
                                             [
                                             
                                                M
                                                N
                                             
                                             ∈
                                             
                                                [
                                                x
                                                ,
                                                x
                                                +
                                                d
                                                x
                                                )
                                             
                                             ]
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (6)
                           
                              
                                 
                                    
                                       
                                          d
                                          
                                             P
                                             
                                                X
                                                ,
                                                m
                                             
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          =
                                          
                                             p
                                             
                                                X
                                                ,
                                                m
                                             
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          d
                                          x
                                          =
                                          P
                                          
                                             [
                                             
                                                X
                                                N
                                             
                                             ∈
                                             
                                                [
                                                x
                                                ,
                                                x
                                                +
                                                d
                                                x
                                                )
                                             
                                             ,
                                             
                                                m
                                                N
                                             
                                             >
                                             l
                                             ]
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (7)
                           
                              
                                 
                                    
                                       
                                          d
                                          
                                             P
                                             
                                                X
                                                ,
                                                M
                                             
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          =
                                          
                                             p
                                             
                                                X
                                                ,
                                                M
                                             
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          d
                                          x
                                          =
                                          P
                                          
                                             [
                                             
                                                X
                                                N
                                             
                                             ∈
                                             
                                                [
                                                x
                                                ,
                                                x
                                                +
                                                d
                                                x
                                                )
                                             
                                             ,
                                             
                                                M
                                                N
                                             
                                             <
                                             u
                                             ]
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (8)
                           
                              
                                 
                                    
                                       
                                          d
                                          
                                             P
                                             
                                                X
                                                ,
                                                m
                                                ,
                                                M
                                             
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             p
                                             
                                                X
                                                ,
                                                m
                                                ,
                                                M
                                             
                                          
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          d
                                          x
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          P
                                          [
                                          
                                             X
                                             N
                                          
                                          ∈
                                          
                                             [
                                             x
                                             ,
                                             x
                                             +
                                             d
                                             x
                                             )
                                          
                                          ,
                                          
                                             m
                                             N
                                          
                                          >
                                          l
                                          ,
                                          
                                             M
                                             N
                                          
                                          <
                                          u
                                          ]
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

We define the Fourier transform of a function g(x) as

                        
                           
                              
                                 
                                    
                                       
                                          
                                             g
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          
                                             F
                                             
                                                x
                                                →
                                                ξ
                                             
                                          
                                          
                                             [
                                             g
                                             
                                                (
                                                x
                                                )
                                             
                                             ]
                                          
                                          :
                                          =
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          g
                                          
                                             (
                                             x
                                             )
                                          
                                          
                                             e
                                             
                                                i
                                                ξ
                                                x
                                             
                                          
                                          d
                                          x
                                       
                                    
                                 
                              
                           
                        
                     and its inverse with

                        
                           
                              
                                 
                                    
                                       
                                          g
                                          
                                             (
                                             x
                                             )
                                          
                                          =
                                          
                                             F
                                             
                                                ξ
                                                →
                                                x
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             [
                                             
                                                g
                                                ^
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             ]
                                          
                                          :
                                          =
                                          
                                             1
                                             
                                                2
                                                π
                                             
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             g
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          
                                             e
                                             
                                                −
                                                i
                                                x
                                                ξ
                                             
                                          
                                          d
                                          ξ
                                          .
                                       
                                    
                                 
                              
                           
                        
                     In some cases, for compatibility with previous literature, we use an upper-case letter instead of a lower-case letter with a hat, i.e., G(ξ) instead of 
                        
                           
                              g
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                        
                     . As an exception to these notations, the above defined characteristic function Ψ of the Lévy process is the Fourier transform of the probability density function f of the Lévy process,

                        
                           
                              
                                 
                                    
                                       
                                          Ψ
                                          
                                             (
                                             ξ
                                             ,
                                             Δ
                                             )
                                          
                                          =
                                          
                                             F
                                             
                                                x
                                                →
                                                ξ
                                             
                                          
                                          
                                             [
                                             f
                                             
                                                (
                                                x
                                                ,
                                                Δ
                                                )
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where the transition probability that 
                        
                           X
                           (
                           t
                           +
                           Δ
                           )
                           =
                           x
                        
                      when 
                        
                           X
                           
                              (
                              t
                              )
                           
                           =
                           
                              x
                              ′
                           
                        
                      has density 
                        
                           f
                           (
                           x
                           −
                           
                              x
                              ′
                           
                           ,
                           Δ
                           )
                        
                      for any t > 0.
                        1
                     
                     
                        1
                        We recall that 
                              
                                 
                                    p
                                    X
                                 
                                 
                                    (
                                    x
                                    ,
                                    N
                                    )
                                 
                                 =
                                 f
                                 
                                    (
                                    x
                                    ,
                                    N
                                    Δ
                                    )
                                 
                              
                            and thus 
                              
                                 
                                    
                                       p
                                       ^
                                    
                                    X
                                 
                                 
                                    (
                                    ξ
                                    ,
                                    N
                                    )
                                 
                                 =
                                 Ψ
                                 
                                    (
                                    ξ
                                    ,
                                    N
                                    Δ
                                    )
                                 
                              
                           .
                      The convolution form of the density function is due to the assumption of independent increments.

Next, we define the z-transform (or generating function) of a discrete set of functions v(x, n), 
                        
                           n
                           ∈
                           
                              N
                              0
                           
                           ,
                        
                      as

                        
                           
                              
                                 
                                    
                                       
                                          
                                             v
                                             ˜
                                          
                                          
                                             (
                                             x
                                             ,
                                             q
                                             )
                                          
                                          =
                                          
                                             Z
                                             
                                                n
                                                →
                                                q
                                             
                                          
                                          
                                             [
                                             v
                                             
                                                (
                                                x
                                                ,
                                                n
                                                )
                                             
                                             ]
                                          
                                          :
                                          =
                                          
                                             ∑
                                             
                                                n
                                                =
                                                0
                                             
                                             ∞
                                          
                                          v
                                          
                                             (
                                             x
                                             ,
                                             n
                                             )
                                          
                                          
                                             q
                                             n
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     with 
                        
                           q
                           ∈
                           C
                        
                      (in a more common definition, 
                        
                           z
                           
                              −
                              1
                           
                        
                      is used in place of q). It is a discrete version of the Laplace transform of a function c(x, t), which is obtained for Δ → 0 setting 
                        
                           q
                           =
                           
                              e
                              
                                 −
                                 s
                                 Δ
                              
                           
                           ,
                        
                     
                     
                        
                           v
                           (
                           x
                           ,
                           n
                           )
                           =
                           Δ
                           c
                           (
                           x
                           ,
                           n
                           Δ
                           )
                        
                      and 
                        
                           n
                           Δ
                           =
                           t
                        
                     . The original function v(x, n) can be recovered through the complex integral

                        
                           (9)
                           
                              
                                 
                                    
                                       
                                          v
                                          
                                             (
                                             x
                                             ,
                                             n
                                             )
                                          
                                          =
                                          
                                             Z
                                             
                                                q
                                                →
                                                n
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             [
                                             
                                                v
                                                ˜
                                             
                                             
                                                (
                                                x
                                                ,
                                                q
                                                )
                                             
                                             ]
                                          
                                          =
                                          
                                             1
                                             
                                                2
                                                π
                                                
                                                   ρ
                                                   n
                                                
                                             
                                          
                                          
                                             ∫
                                             0
                                             
                                                2
                                                π
                                             
                                          
                                          
                                             v
                                             ˜
                                          
                                          
                                             (
                                             x
                                             ,
                                             ρ
                                             
                                                e
                                                
                                                   i
                                                   u
                                                
                                             
                                             )
                                          
                                          
                                             e
                                             
                                                −
                                                i
                                                n
                                                u
                                             
                                          
                                          d
                                          u
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where ρ must be within the radius of convergence (Abate & Whitt, 1992).

Using combinatorial arguments, Spitzer (1956) derived formulas for the z-transforms of the characteristic functions of the distributions defined in Eqs. (3)–(8), the celebrated Spitzer identities. We recall them here. Let Φ
                     ± be two functions which are analytic in the overlap of two half planes including the real line such that

                        
                           (10)
                           
                              
                                 
                                    
                                       
                                          Φ
                                          (
                                          ξ
                                          ,
                                          q
                                          )
                                          :
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          1
                                          −
                                          q
                                          E
                                          [
                                          
                                             e
                                             
                                                i
                                                ξ
                                                X
                                                (
                                                Δ
                                                )
                                             
                                          
                                          ]
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          1
                                          −
                                          q
                                          Ψ
                                          
                                             (
                                             ξ
                                             ,
                                             Δ
                                             )
                                          
                                          =
                                          
                                             Φ
                                             +
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          
                                             Φ
                                             −
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                     Φ
                     ±(ξ, q) are the positive and negative WH factors of 
                        
                           1
                           −
                           q
                           Ψ
                           (
                           ξ
                           ,
                           Δ
                           )
                        
                     .
                        2
                     
                     
                        2
                        The WH factors are not uniquely defined: given a factorization 
                              
                                 Φ
                                 
                                    (
                                    ξ
                                    ,
                                    q
                                    )
                                 
                                 =
                                 
                                    Φ
                                    +
                                 
                                 
                                    (
                                    ξ
                                    ,
                                    q
                                    )
                                 
                                 
                                    Φ
                                    −
                                 
                                 
                                    (
                                    ξ
                                    ,
                                    q
                                    )
                                 
                                 ,
                              
                            also 
                              
                                 a
                                 
                                    Φ
                                    +
                                 
                                 
                                    (
                                    ξ
                                    ,
                                    q
                                    )
                                 
                              
                            and 
                              
                                 
                                    1
                                    a
                                 
                                 
                                    Φ
                                    −
                                 
                                 
                                    (
                                    ξ
                                    ,
                                    q
                                    )
                                 
                              
                            are WH factors for any constant a ≠ 0.
                      The Spitzer identities express the desired characteristic functions through the inversion of a moment-generating function involving 
                        
                           Φ
                           ,
                           
                           
                              Φ
                              +
                           
                        
                      and 
                        
                           Φ
                           −
                        
                     :

                        
                           (11)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                   ^
                                                
                                                ˜
                                             
                                             X
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             Z
                                             
                                                n
                                                →
                                                q
                                             
                                          
                                          
                                             [
                                             
                                                
                                                   p
                                                   ^
                                                
                                                X
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                n
                                                )
                                             
                                             ]
                                          
                                          =
                                          
                                             Z
                                             
                                                n
                                                →
                                                q
                                             
                                          
                                          
                                             [
                                             E
                                             
                                                (
                                                
                                                   e
                                                   
                                                      i
                                                      ξ
                                                      
                                                         X
                                                         n
                                                      
                                                   
                                                
                                                )
                                             
                                             ]
                                          
                                          =
                                          
                                             1
                                             
                                                Φ
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (12)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                   ^
                                                
                                                ˜
                                             
                                             m
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             Z
                                             
                                                n
                                                →
                                                q
                                             
                                          
                                          
                                             [
                                             
                                                
                                                   p
                                                   ^
                                                
                                                m
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                n
                                                )
                                             
                                             ]
                                          
                                          =
                                          
                                             Z
                                             
                                                n
                                                →
                                                q
                                             
                                          
                                          
                                             [
                                             E
                                             
                                                (
                                                
                                                   e
                                                   
                                                      i
                                                      ξ
                                                      
                                                         m
                                                         n
                                                      
                                                   
                                                
                                                )
                                             
                                             ]
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          1
                                          
                                             
                                                Φ
                                                +
                                             
                                             
                                                (
                                                0
                                                ,
                                                q
                                                )
                                             
                                             
                                                Φ
                                                −
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (13)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                   ^
                                                
                                                ˜
                                             
                                             M
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             Z
                                             
                                                n
                                                →
                                                q
                                             
                                          
                                          
                                             [
                                             
                                                
                                                   p
                                                   ^
                                                
                                                M
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                n
                                                )
                                             
                                             ]
                                          
                                          =
                                          
                                             Z
                                             
                                                n
                                                →
                                                q
                                             
                                          
                                          
                                             [
                                             E
                                             
                                                (
                                                
                                                   e
                                                   
                                                      i
                                                      ξ
                                                      
                                                         M
                                                         n
                                                      
                                                   
                                                
                                                )
                                             
                                             ]
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          1
                                          
                                             
                                                Φ
                                                +
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                             
                                                Φ
                                                −
                                             
                                             
                                                (
                                                0
                                                ,
                                                q
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (14)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                   ^
                                                
                                                ˜
                                             
                                             
                                                X
                                                ,
                                                m
                                             
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          =
                                          
                                             1
                                             
                                                Φ
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                          
                                          −
                                          
                                             e
                                             
                                                i
                                                l
                                                ξ
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   Φ
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          =
                                          
                                             e
                                             
                                                i
                                                l
                                                ξ
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   Φ
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  


                     
                        
                           (15)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                   ^
                                                
                                                ˜
                                             
                                             
                                                X
                                                ,
                                                M
                                             
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          =
                                          
                                             1
                                             
                                                Φ
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                          
                                          −
                                          
                                             e
                                             
                                                i
                                                u
                                                ξ
                                             
                                          
                                          
                                             
                                                
                                                   Q
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   Φ
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          =
                                          
                                             e
                                             
                                                i
                                                u
                                                ξ
                                             
                                          
                                          
                                             
                                                
                                                   Q
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   Φ
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (16)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                   ^
                                                
                                                ˜
                                             
                                             
                                                X
                                                ,
                                                m
                                                ,
                                                M
                                             
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          =
                                          
                                             1
                                             
                                                Φ
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                          
                                          −
                                          
                                             e
                                             
                                                i
                                                l
                                                ξ
                                             
                                          
                                          
                                             
                                                
                                                   J
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                Φ
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                          
                                          −
                                          
                                             e
                                             
                                                i
                                                u
                                                ξ
                                             
                                          
                                          
                                             
                                                
                                                   J
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                Φ
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where

                        
                           
                              
                                 
                                    
                                       
                                          P
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          :
                                          =
                                          
                                             
                                                e
                                                
                                                   −
                                                   i
                                                   l
                                                   ξ
                                                
                                             
                                             
                                                
                                                   Φ
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          =
                                          
                                             P
                                             +
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          +
                                          
                                             P
                                             −
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                     and

                        
                           
                              
                                 
                                    
                                       
                                          Q
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          :
                                          =
                                          
                                             
                                                e
                                                
                                                   −
                                                   i
                                                   u
                                                   ξ
                                                
                                             
                                             
                                                
                                                   Φ
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          =
                                          
                                             Q
                                             +
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          +
                                          
                                             Q
                                             −
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Notice that the joint probabilities in Eqs. (14)–(16) are given by the probability of the process at maturity, Eq. (11), minus the probability to hit a barrier; the latter vanishes if the barrier moves to ± ∞. Similar identities exist for the continuous-monitoring case too, where the quantity to be factorized becomes 
                        
                           
                              lim
                              
                                 Δ
                                 →
                                 0
                              
                           
                           Φ
                           
                              (
                              ξ
                              ,
                              q
                              )
                           
                           /
                           Δ
                           =
                           s
                           −
                           ψ
                           
                              (
                              ξ
                              )
                           
                           =
                           :
                           ϕ
                           
                              (
                              ξ
                              ,
                              s
                              )
                           
                        
                     ; see Section D of the online supplemental material. Full technical details are given in Greenwood and Pitman (1980), Kyprianou (2006) and Sato (1999).

The double-barrier problem, which is more difficult than the others, was not examined by Spitzer himself, but by Kemperman (1963). Unfortunately he did not present a constructive procedure for the determination of the quantities 
                        
                           
                              J
                              +
                           
                           
                              (
                              ξ
                              ,
                              q
                              )
                           
                        
                      and 
                        
                           
                              J
                              −
                           
                           
                              (
                              ξ
                              ,
                              q
                              )
                           
                        
                      in Eq. (16). The problem was later solved in the Gaussian case by Green et al. (2010, Section 2.4). Here we generalize the latter construction to Lévy processes. In particular, Green et al. (2010) proved that 
                        
                           
                              J
                              +
                           
                           
                              (
                              ξ
                              ,
                              q
                              )
                           
                        
                      and 
                        
                           
                              J
                              −
                           
                           
                              (
                              ξ
                              ,
                              q
                              )
                           
                        
                      are the solution of the coupled integral equations

                        
                           (17)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             
                                                
                                                   J
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   Φ
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             1
                                             
                                                2
                                                π
                                                i
                                             
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             
                                                
                                                   e
                                                   
                                                      i
                                                      
                                                         (
                                                         u
                                                         −
                                                         l
                                                         )
                                                      
                                                      
                                                         ξ
                                                         ′
                                                      
                                                   
                                                
                                                
                                                   J
                                                   +
                                                
                                                
                                                   (
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   (
                                                   ξ
                                                   −
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   )
                                                
                                                
                                                   Φ
                                                   −
                                                
                                                
                                                   (
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          d
                                          
                                             ξ
                                             ′
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                          =
                                          
                                             1
                                             
                                                2
                                                π
                                                i
                                             
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             
                                                e
                                                
                                                   −
                                                   i
                                                   l
                                                   
                                                      ξ
                                                      ′
                                                   
                                                
                                             
                                             
                                                
                                                   (
                                                   ξ
                                                   −
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   )
                                                
                                                
                                                   Φ
                                                   −
                                                
                                                
                                                   (
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          d
                                          
                                             ξ
                                             ′
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (18)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             
                                                
                                                   J
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   Φ
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             1
                                             
                                                2
                                                π
                                                i
                                             
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             
                                                
                                                   e
                                                   
                                                      i
                                                      
                                                         (
                                                         l
                                                         −
                                                         u
                                                         )
                                                      
                                                      
                                                         ξ
                                                         ′
                                                      
                                                   
                                                
                                                
                                                   J
                                                   −
                                                
                                                
                                                   (
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   (
                                                   ξ
                                                   −
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   )
                                                
                                                
                                                   Φ
                                                   +
                                                
                                                
                                                   (
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          d
                                          
                                             ξ
                                             ′
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                          =
                                          
                                             1
                                             
                                                2
                                                π
                                                i
                                             
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             
                                                e
                                                
                                                   −
                                                   i
                                                   u
                                                   
                                                      ξ
                                                      ′
                                                   
                                                
                                             
                                             
                                                
                                                   (
                                                   ξ
                                                   −
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   )
                                                
                                                
                                                   Φ
                                                   +
                                                
                                                
                                                   (
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          d
                                          
                                             ξ
                                             ′
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where Im ξ′ > Im ξ in the first equation (smile integral; Im is the imaginary part) and Im ξ′ < Im ξ in the second (frown integral).

As proved by Krein (1963), the decomposition of a complex function 
                        
                           
                              f
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                           =
                           
                              
                                 f
                                 +
                              
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                           +
                           
                              
                                 f
                                 −
                              
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                        
                      can be computed through the Cauchy-type integrals

                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                f
                                                +
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          
                                             1
                                             
                                                2
                                                π
                                                i
                                             
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             
                                                
                                                   f
                                                   ^
                                                
                                                
                                                   (
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   )
                                                
                                             
                                             
                                                ξ
                                                −
                                                
                                                   ξ
                                                   ′
                                                
                                             
                                          
                                          d
                                          
                                             ξ
                                             ′
                                          
                                          ,
                                          
                                          
                                             Im
                                          
                                          
                                          
                                             ξ
                                             ′
                                          
                                          <
                                          
                                             Im
                                          
                                          
                                          ξ
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                f
                                                −
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          
                                             1
                                             
                                                2
                                                π
                                                i
                                             
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             
                                                
                                                   f
                                                   ^
                                                
                                                
                                                   (
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   )
                                                
                                             
                                             
                                                ξ
                                                −
                                                
                                                   ξ
                                                   ′
                                                
                                             
                                          
                                          d
                                          
                                             ξ
                                             ′
                                          
                                          ,
                                          
                                          
                                             Im
                                          
                                          
                                          
                                             ξ
                                             ′
                                          
                                          >
                                          
                                             Im
                                          
                                          
                                          ξ
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Therefore Eqs. (17) and (18) can be rewritten as

                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   J
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   Φ
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                [
                                                
                                                   
                                                      
                                                         e
                                                         
                                                            i
                                                            (
                                                            u
                                                            −
                                                            l
                                                            )
                                                            ξ
                                                         
                                                      
                                                      
                                                         J
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         Φ
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                             −
                                          
                                          =
                                          
                                             
                                                [
                                                
                                                   
                                                      e
                                                      
                                                         −
                                                         i
                                                         l
                                                         ξ
                                                      
                                                   
                                                   
                                                      
                                                         Φ
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                             −
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   J
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   Φ
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                [
                                                
                                                   
                                                      
                                                         e
                                                         
                                                            i
                                                            (
                                                            l
                                                            −
                                                            u
                                                            )
                                                            ξ
                                                         
                                                      
                                                      
                                                         J
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                             +
                                          
                                          =
                                          
                                             
                                                [
                                                
                                                   
                                                      e
                                                      
                                                         −
                                                         i
                                                         u
                                                         ξ
                                                      
                                                   
                                                   
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                             +
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     or

                        
                           (19)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   J
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   Φ
                                                   −
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          =
                                          
                                             
                                                [
                                                
                                                   
                                                      
                                                         e
                                                         
                                                            −
                                                            i
                                                            l
                                                            ξ
                                                         
                                                      
                                                      −
                                                      
                                                         e
                                                         
                                                            i
                                                            (
                                                            u
                                                            −
                                                            l
                                                            )
                                                            ξ
                                                         
                                                      
                                                      
                                                         J
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         Φ
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                             −
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (20)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   J
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             
                                                
                                                   Φ
                                                   +
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                          
                                          =
                                          
                                             
                                                [
                                                
                                                   
                                                      
                                                         e
                                                         
                                                            −
                                                            i
                                                            u
                                                            ξ
                                                         
                                                      
                                                      −
                                                      
                                                         e
                                                         
                                                            i
                                                            (
                                                            l
                                                            −
                                                            u
                                                            )
                                                            ξ
                                                         
                                                      
                                                      
                                                         J
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                             +
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     The solution of Eqs. (19) and (20) is related to the difficult problem of a matrix WH factorization; a solution for the kind of matrix arising in this case has not been found yet. Therefore, we propose the following fixed-point algorithm that achieves a fast convergence: starting from a guess function 
                        
                           
                              J
                              +
                              
                                 (
                                 0
                                 )
                              
                           
                           
                              (
                              ξ
                              ,
                              q
                              )
                           
                           =
                           0
                           ,
                        
                      for 
                        
                           j
                           =
                           1
                           ,
                           …
                        
                     
                     
                        
                           (a)
                           Decompose

                                 
                                    (21)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         P
                                                         ¯
                                                      
                                                      
                                                         (
                                                         j
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                   :
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      
                                                         e
                                                         
                                                            −
                                                            i
                                                            l
                                                            ξ
                                                         
                                                      
                                                      
                                                         
                                                            Φ
                                                            −
                                                         
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            e
                                                            
                                                               i
                                                               (
                                                               u
                                                               −
                                                               l
                                                               )
                                                               ξ
                                                            
                                                         
                                                         
                                                            J
                                                            +
                                                            
                                                               (
                                                               j
                                                               −
                                                               1
                                                               )
                                                            
                                                         
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            Φ
                                                            −
                                                         
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      
                                                         P
                                                         ¯
                                                      
                                                      +
                                                      
                                                         (
                                                         j
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                   +
                                                   
                                                      
                                                         P
                                                         ¯
                                                      
                                                      −
                                                      
                                                         (
                                                         j
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              and compute 
                                 
                                    
                                       J
                                       −
                                       
                                          (
                                          j
                                          )
                                       
                                    
                                    
                                       (
                                       ξ
                                       ,
                                       q
                                       )
                                    
                                    =
                                    
                                       
                                          P
                                          ¯
                                       
                                       −
                                       
                                          (
                                          j
                                          )
                                       
                                    
                                    
                                       (
                                       ξ
                                       ,
                                       q
                                       )
                                    
                                    
                                       Φ
                                       −
                                    
                                    
                                       (
                                       ξ
                                       ,
                                       q
                                       )
                                    
                                 
                              .

Decompose

                                 
                                    (22)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         Q
                                                         ¯
                                                      
                                                      
                                                         (
                                                         j
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                   :
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      
                                                         e
                                                         
                                                            −
                                                            i
                                                            u
                                                            ξ
                                                         
                                                      
                                                      
                                                         
                                                            Φ
                                                            +
                                                         
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            e
                                                            
                                                               i
                                                               (
                                                               l
                                                               −
                                                               u
                                                               )
                                                               ξ
                                                            
                                                         
                                                         
                                                            J
                                                            −
                                                            
                                                               (
                                                               j
                                                               )
                                                            
                                                         
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            Φ
                                                            +
                                                         
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      
                                                         Q
                                                         ¯
                                                      
                                                      +
                                                      
                                                         (
                                                         j
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                   +
                                                   
                                                      
                                                         Q
                                                         ¯
                                                      
                                                      −
                                                      
                                                         (
                                                         j
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              and compute 
                                 
                                    
                                       J
                                       +
                                       
                                          (
                                          j
                                          )
                                       
                                    
                                    
                                       (
                                       ξ
                                       ,
                                       q
                                       )
                                    
                                    =
                                    
                                       
                                          Q
                                          ¯
                                       
                                       +
                                       
                                          (
                                          j
                                          )
                                       
                                    
                                    
                                       (
                                       ξ
                                       ,
                                       q
                                       )
                                    
                                    
                                       Φ
                                       +
                                    
                                    
                                       (
                                       ξ
                                       ,
                                       q
                                       )
                                    
                                    .
                                 
                              
                           

If the distance between the new and old functions 
                                 
                                    J
                                    
                                       ±
                                    
                                    
                                       (
                                       j
                                       )
                                    
                                 
                               and 
                                 
                                    J
                                    
                                       ±
                                    
                                    
                                       (
                                       j
                                       −
                                       1
                                       )
                                    
                                 
                               is greater than a given tolerance, increase j and return to Step (a), otherwise stop and set 
                                 
                                    
                                       J
                                       −
                                    
                                    =
                                    
                                       J
                                       −
                                       
                                          (
                                          j
                                          )
                                       
                                    
                                    ,
                                    
                                    
                                       J
                                       +
                                    
                                    =
                                    
                                       J
                                       +
                                       
                                          (
                                          j
                                          )
                                       
                                    
                                 
                              .

The above fixed-point algorithm will be used to price double-barrier derivatives in Section 4.3.

To make all the above expressions usable, we need to factorize (or decompose) a complex function, defined in a strip containing the real axis, into a product (or sum) of two functions which are analytic in the overlap of two half planes, including the real line, where they are defined. Once this has been done and the relevant quantities in Eqs. (11)–(16) have been obtained, we must compute numerically an inverse z-transform, followed by an inverse Fourier transform. The latter is done in a standard way using the FFT. The inversion of the z-transform is rather easy too. It has been discussed in detail by Abate and Whitt (1992), who showed that it can be well approximated by

                        
                           (23)
                           
                              
                                 
                                    
                                       
                                          v
                                          (
                                          x
                                          ,
                                          n
                                          )
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             Z
                                             
                                                q
                                                →
                                                n
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             [
                                             
                                                v
                                                ˜
                                             
                                             
                                                (
                                                x
                                                ,
                                                q
                                                )
                                             
                                             ]
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       ≈
                                    
                                    
                                       
                                          
                                             1
                                             
                                                2
                                                n
                                                
                                                   ρ
                                                   n
                                                
                                             
                                          
                                          
                                             [
                                          
                                          
                                             v
                                             ˜
                                          
                                          
                                             (
                                             x
                                             ,
                                             ρ
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          +
                                          
                                          2
                                          
                                             ∑
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                n
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                (
                                                −
                                                1
                                                )
                                             
                                             j
                                          
                                          
                                             v
                                             ˜
                                          
                                          
                                             (
                                             x
                                             ,
                                             ρ
                                             
                                                e
                                                
                                                   
                                                      i
                                                      j
                                                      π
                                                   
                                                   /
                                                   n
                                                
                                             
                                             )
                                          
                                          +
                                          
                                             
                                                (
                                                −
                                                1
                                                )
                                             
                                             n
                                          
                                          
                                             v
                                             ˜
                                          
                                          
                                             (
                                             x
                                             ,
                                             −
                                             ρ
                                             )
                                          
                                          
                                             ]
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

The more challenging part is the factorization of Φ in Eq. (10), as well as the decomposition of P and Q (
                        
                           
                              P
                              ¯
                           
                           
                              (
                              i
                              )
                           
                        
                      and 
                        
                           
                              Q
                              ¯
                           
                           
                              (
                              i
                              )
                           
                        
                      in the double-barrier case). In general, this problem can be described as follows. Given a smooth enough function 
                        
                           
                              f
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                           ,
                        
                      analytic in a strip around the real axis, we need to compute 
                        
                           
                              
                                 f
                                 ±
                              
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                        
                      such that

                        
                           (24)
                           
                              
                                 
                                    
                                       
                                          
                                             f
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          
                                             
                                                f
                                                +
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          
                                             
                                                f
                                                −
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          ;
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 f
                                 +
                              
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                        
                      is such that its inverse Fourier transform 
                        
                           
                              f
                              +
                           
                           
                              (
                              x
                              )
                           
                           =
                           0
                        
                      for x < 0, while 
                        
                           
                              
                                 f
                                 −
                              
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                        
                      is such that 
                        
                           
                              f
                              −
                           
                           
                              (
                              x
                              )
                           
                           =
                           0
                        
                      for x > 0. Taking logarithms, this can be accomplished by the decomposition

                        
                           (25)
                           
                              
                                 
                                    
                                       
                                          log
                                          
                                             f
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          log
                                          
                                             
                                                f
                                                +
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          +
                                          log
                                          
                                             
                                                f
                                                −
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     The conditions under which the above factorization or logarithmic decomposition gives proper results have been given by Krein (1963); the most important requirement is that 
                        
                           
                              f
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                        
                      is not zero anywhere.

In general neither the factorization nor the decomposition can be done analytically. With continuous monitoring, an analytical treatment becomes possible for a Brownian motion or if we impose strong restrictions on the structure of the considered Lévy process (Le Courtois & Quittard-Pinon, 2008; Rogers, 2000), such as the assumption that it is spectrally one-sided, i.e., jumps are either always up or always down. Another assumption that makes the factorization feasible is if the jumps are of phase type (Asmussen, Avram, & Pistorius, 2004), which includes the Kou double exponential jump model Kou (2002) as a special case. In these cases the WH factorization is tractable because 
                        
                           ϕ
                           (
                           ξ
                           ,
                           s
                           )
                           =
                           s
                           −
                           ψ
                           (
                           ξ
                           )
                        
                      is a rational function and its decomposition in upper/lower factors is quite immediate. For example, Jeannin and Pistorius (2009) approximate different Lévy models by the class of generalized hyper-exponential models, which have a tractable WH factorization. A similar idea is pursued by Asmussen, Madan, and Pistorius (2007) and Cai (2009). A quasi-analytical WH factorization has been achieved by Kuznetsov (2010) when the characteristic exponent is a meromorphic function. In this case, WH factors can be expressed as infinite products and require the solution of transcendental equations. Unfortunately, with discrete monitoring, even under the above assumptions the factorization is not doable analytically, because 
                        
                           Φ
                           
                              (
                              ξ
                              ,
                              q
                              )
                           
                           =
                           1
                           −
                           q
                           Ψ
                           
                              (
                              ξ
                              ,
                              Δ
                              )
                           
                           =
                           1
                           −
                           q
                           
                              e
                              
                                 ψ
                                 (
                                 ξ
                                 )
                                 Δ
                              
                           
                        
                      is not a rational function. In addition, all the above mentioned methods consider only the single-barrier case. An exception was given by Boyarchenko and Levendorskii (2002), who obtained exact analytical pricing formulae in terms of WH factors, and, under additional conditions on the process, derived simpler approximate formulae. For the general difficulty in computing the factors, with reference to the important financial engineering problem of pricing barrier options, Carr and Crosby (2010) state: “Pricing barrier options for arbitrary Lévy processes is far from trivial. There are, in principle, some results ... based on Wiener-Hopf analysis although they involve inversion of triple Laplace transforms and it is open to debate as to whether this could be done efficiently enough for use in a trading environment.” Similarly, Cont and Tankov (2004), a popular reference text for applications of Lévy processes in finance, states: “The Wiener-Hopf technique is too computationally expensive and we recommend Monte Carlo simulation or numerical solution of partial integro-differential equations.” These remarks are based on the representation of the WH factors for the continuous-monitoring case as double integrals (Cont and Tankov, 2004, Chapter 11.3). With reference to financial applications, attempts to compute the WH factors have been done by Boyarchenko and Levendorskii (2002) and Kuznetsov, Kyprianou, Pardo, and van Schaik (2011), among others.

A more convenient representation of the WH factors can be found using the Hilbert transform and the Plemelj–Sokhotsky relations (King, 2009). The Hilbert transform of a function 
                        
                           
                              f
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                        
                      is defined as

                        
                           (26)
                           
                              
                                 
                                    
                                       
                                          
                                             H
                                             ξ
                                          
                                          
                                             [
                                             
                                                f
                                                ^
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             ]
                                          
                                          =
                                          
                                             p
                                             .
                                             v
                                             .
                                          
                                          
                                          
                                             1
                                             
                                                π
                                                ξ
                                             
                                          
                                          *
                                          
                                             f
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          
                                             p
                                             .
                                             v
                                             .
                                          
                                          
                                          
                                             1
                                             π
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             
                                                
                                                   f
                                                   ^
                                                
                                                
                                                   (
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   )
                                                
                                             
                                             
                                                ξ
                                                −
                                                
                                                   ξ
                                                   ′
                                                
                                             
                                          
                                          d
                                          
                                             ξ
                                             ′
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where * denotes convolution and p.v. the Cauchy principal value,

                        
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             p
                                             .
                                             v
                                             .
                                          
                                          
                                             1
                                             π
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             
                                                
                                                   f
                                                   ^
                                                
                                                
                                                   (
                                                   
                                                      ξ
                                                      ′
                                                   
                                                   )
                                                
                                             
                                             
                                                ξ
                                                −
                                                
                                                   ξ
                                                   ′
                                                
                                             
                                          
                                          d
                                          
                                             ξ
                                             ′
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                          =
                                          
                                             lim
                                             
                                                ϵ
                                                →
                                                
                                                   0
                                                   +
                                                
                                             
                                          
                                          
                                             1
                                             π
                                          
                                          
                                             (
                                             
                                                ∫
                                                
                                                   ξ
                                                   −
                                                   1
                                                   /
                                                   ϵ
                                                
                                                
                                                   ξ
                                                   −
                                                   ϵ
                                                
                                             
                                             
                                                
                                                   
                                                      f
                                                      ^
                                                   
                                                   
                                                      (
                                                      
                                                         ξ
                                                         ′
                                                      
                                                      )
                                                   
                                                
                                                
                                                   ξ
                                                   −
                                                   
                                                      ξ
                                                      ′
                                                   
                                                
                                             
                                             d
                                             
                                                ξ
                                                ′
                                             
                                             +
                                             
                                                ∫
                                                
                                                   ξ
                                                   +
                                                   ϵ
                                                
                                                
                                                   ξ
                                                   +
                                                   1
                                                   /
                                                   ϵ
                                                
                                             
                                             
                                                
                                                   
                                                      f
                                                      ^
                                                   
                                                   
                                                      (
                                                      
                                                         ξ
                                                         ′
                                                      
                                                      )
                                                   
                                                
                                                
                                                   ξ
                                                   −
                                                   
                                                      ξ
                                                      ′
                                                   
                                                
                                             
                                             d
                                             
                                                ξ
                                                ′
                                             
                                             )
                                          
                                          ;
                                       
                                    
                                 
                              
                           
                        
                     the latter assigns a value to an improper integral which would otherwise result in the indefinite form 
                        
                           +
                           ∞
                           −
                           ∞
                        
                     . The convolution theorem

                        
                           (27)
                           
                              
                                 
                                    
                                       
                                          
                                             f
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          *
                                          
                                             g
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          
                                             F
                                             
                                                x
                                                →
                                                ξ
                                             
                                          
                                          
                                             [
                                             f
                                             
                                                (
                                                x
                                                )
                                             
                                             g
                                             
                                                (
                                                x
                                                )
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     which maps a convolution to a product via a Fourier transform, together with the inverse Fourier transform

                        
                           
                              
                                 
                                    
                                       
                                          
                                             p
                                             .
                                             v
                                             .
                                          
                                          
                                          
                                             F
                                             
                                                ξ
                                                →
                                                x
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             [
                                             
                                                1
                                                
                                                   π
                                                   ξ
                                                
                                             
                                             ]
                                          
                                          =
                                          −
                                          i
                                          
                                          
                                             sgn
                                          
                                          
                                          x
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     enables to express the Hilbert transform through an inverse Fourier transform (from 
                        
                           
                              f
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                        
                      to f(x)) and a direct Fourier transform,

                        
                           (28)
                           
                              
                                 
                                    
                                       
                                          i
                                          
                                             H
                                             ξ
                                          
                                          
                                             [
                                             
                                                f
                                                ^
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             ]
                                          
                                          =
                                          
                                             F
                                             
                                                x
                                                →
                                                ξ
                                             
                                          
                                          
                                             [
                                             
                                                sgn
                                             
                                             
                                             x
                                             
                                             f
                                             
                                                (
                                                x
                                                )
                                             
                                             ]
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Thus a fast method to compute the Hilbert transform numerically consists simply in evaluating Eq. (28) through an inverse and a direct FFT.

Define the projections of a function f(x) on the positive or the negative half-axis through the multiplication with the indicator function of that set,

                        
                           
                              
                                 
                                    
                                       
                                          
                                             P
                                             x
                                             +
                                          
                                          
                                             [
                                             f
                                             
                                                (
                                                x
                                                )
                                             
                                             ]
                                          
                                          :
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             1
                                             
                                                x
                                                >
                                                0
                                             
                                          
                                          f
                                          
                                             (
                                             x
                                             )
                                          
                                          =
                                          
                                             f
                                             +
                                          
                                          
                                             (
                                             x
                                             )
                                          
                                          ,
                                          
                                          and
                                          
                                          
                                             P
                                             x
                                             −
                                          
                                          
                                             [
                                             f
                                             
                                                (
                                                x
                                                )
                                             
                                             ]
                                          
                                          :
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             1
                                             
                                                x
                                                <
                                                0
                                             
                                          
                                          f
                                          
                                             (
                                             x
                                             )
                                          
                                          =
                                          
                                             f
                                             −
                                          
                                          
                                             (
                                             x
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Now substitute

                        
                           
                              
                                 
                                    
                                       
                                          
                                             sgn
                                          
                                          
                                          x
                                          
                                          f
                                          
                                             (
                                             x
                                             )
                                          
                                          =
                                          
                                             (
                                             
                                                1
                                                
                                                   x
                                                   >
                                                   0
                                                
                                             
                                             −
                                             
                                                1
                                                
                                                   x
                                                   <
                                                   0
                                                
                                             
                                             )
                                          
                                          f
                                          
                                             (
                                             x
                                             )
                                          
                                          =
                                          
                                             f
                                             +
                                          
                                          
                                             (
                                             x
                                             )
                                          
                                          −
                                          
                                             f
                                             −
                                          
                                          
                                             (
                                             x
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                     into Eq. (28), obtaining the remarkable property

                        
                           (29)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                f
                                                +
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          −
                                          
                                             
                                                f
                                                −
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          i
                                          
                                             H
                                             ξ
                                          
                                          
                                             [
                                             
                                                f
                                                ^
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             ]
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Together with the identity

                        
                           (30)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                f
                                                +
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          +
                                          
                                             
                                                f
                                                −
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          
                                             f
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     this allows to achieve a decomposition of a function 
                        
                           
                              f
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                           ,
                        
                      and thus a factorization of 
                        
                           exp
                           
                              f
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                           ,
                        
                      via its Hilbert transform. To this end, Eqs. (29) and (30) are conveniently rearranged to the Plemelj–Sokhotsky relations

                        
                           (31)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                f
                                                +
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             1
                                             2
                                          
                                          
                                             (
                                             
                                                f
                                                ^
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             +
                                             i
                                             
                                                H
                                                ξ
                                             
                                             
                                                [
                                                
                                                   f
                                                   ^
                                                
                                                
                                                   (
                                                   ξ
                                                   )
                                                
                                                ]
                                             
                                             )
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                f
                                                −
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             1
                                             2
                                          
                                          
                                             (
                                             
                                                f
                                                ^
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             −
                                             i
                                             
                                                H
                                                ξ
                                             
                                             
                                                [
                                                
                                                   f
                                                   ^
                                                
                                                
                                                   (
                                                   ξ
                                                   )
                                                
                                                ]
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Obtaining the WH factors of 
                        
                           exp
                           
                              f
                              ^
                           
                           
                              (
                              ξ
                              )
                           
                        
                      through Eq. (31) with the Hilbert transform computed in a straightforward way by Eq. (28) corresponds to performing in sequence an inverse Fourier transform, a projection on the positive or negative half axis and a Fourier transform,

                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                f
                                                +
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          
                                             F
                                             
                                                x
                                                →
                                                ξ
                                             
                                          
                                          
                                             [
                                             
                                                P
                                                x
                                                +
                                             
                                             
                                             
                                                F
                                                
                                                   ξ
                                                   →
                                                   x
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                f
                                                ^
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             ]
                                          
                                          ,
                                          
                                          
                                             
                                                f
                                                −
                                             
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          
                                             F
                                             
                                                x
                                                →
                                                ξ
                                             
                                          
                                          
                                             [
                                             
                                                P
                                                x
                                                −
                                             
                                             
                                             
                                                F
                                                
                                                   ξ
                                                   →
                                                   x
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                f
                                                ^
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     i.e., to the scheme

                        
                           
                              
                                 
                                    
                                       
                                          
                                             f
                                             ^
                                          
                                          
                                             ⟶
                                             
                                                F
                                                
                                                   −
                                                   1
                                                
                                             
                                          
                                          f
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                         ↗
                                                      
                                                      
                                                         P
                                                         +
                                                      
                                                   
                                                
                                             
                                             
                                                
                                             
                                             
                                                
                                                   
                                                      ↘
                                                      
                                                         
                                                            
                                                               P
                                                               −
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                      
                                                         P
                                                         −
                                                      
                                                   
                                                
                                             
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         f
                                                         +
                                                      
                                                      
                                                         ⟶
                                                         F
                                                      
                                                      
                                                         
                                                            f
                                                            +
                                                         
                                                         ^
                                                      
                                                   
                                                
                                             
                                             
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         f
                                                         −
                                                      
                                                      
                                                         ⟶
                                                         F
                                                      
                                                      
                                                         
                                                            f
                                                            −
                                                         
                                                         ^
                                                      
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     This factorization is fast because it can be accomplished numerically with two FFTs and one projection (Henery 1974 & Rino 1970). On the other hand, switching back and forth between Fourier and real space, the application of the projection causes a loss of accuracy; in the end this procedure turns out to have only quadratic accuracy.

A numerically more accurate approach consists in the computation of the Hilbert transform, and thus of the Plemelj–Sokhotsky relations, using a sinc expansion approximation to analytic functions. This approach uses two FFTs too to multiply Toeplitz matrices with vectors and thus has a computational cost of 
                        
                           O
                           (
                           M
                           log
                           M
                           )
                           ,
                        
                      but it does not leave Fourier space and its discretization error decreases exponentially with respect to M; see Section 3.1 for details.

We stress here the similarities and differences with the approach followed by Feng and Linetsky (2008a, 2009). In the mentioned papers the Hilbert transform is applied in the backward-in-time pricing procedure. In practice, the projection step is performed in Fourier space using the Hilbert transform; greater details on how this is possible are given in the online supplementary material. This transform is computed at a high degree of accuracy via sinc expansion. No direct relationship of their procedure with a WH factorization can be devised. The analogy is that we are able to express WH factors via a Hilbert transform and then we can exploit their idea of performing this transform with a sinc expansion. At the end, we are able to achieve the same accuracy as their method, but with a significant saving of computational time, because our procedure has a cost independent of the number of monitoring dates N, whilst in all existing methods, including the one by Feng and Linetsky (2008a), the cost increases linearly with N.

For the sake of truth, an advantage of the Feng and Linetsky method with respect to our procedure is that, like all backward-in-time recursive methods, it can easily deal with non-equally spaced monitoring dates. On the other side, our methodology can cope with the continuous monitoring case, as shown in the online supplementary material, whilst the Feng and Linetsky approach, and other Fourier methods, cannot.

The new approach proposed in the present paper is therefore summarized in the following procedure: (1) we perform the WH factorization through the Plemelj–Sokhotsky relations (31), and (2) we compute the Hilbert transform in Fourier space using sinc functions as described in detail in the next section. The inversion of the z-transform is performed exploiting the Euler acceleration technique. The detailed procedure is discussed in Section 3. Applications to different exotic options are considered in Section 4.

The implementation of the proposed procedure to estimate the distributions in Eqs. (3)–(8) consists of two steps: an efficient implementation of the WH factorization exploiting sinc functions, and an inverse z-transform combined with the Euler summation. The numerical implementation is detailed in this section.

The Hilbert transform can be efficiently computed using the sinc expansion approximation of analytic functions. The use of sinc functions

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                S
                                                k
                                             
                                             
                                                (
                                                z
                                                ,
                                                h
                                                )
                                             
                                             =
                                             
                                                
                                                   sin
                                                   (
                                                   π
                                                   (
                                                   z
                                                   −
                                                   k
                                                   h
                                                   )
                                                   /
                                                   h
                                                   )
                                                
                                                
                                                   π
                                                   (
                                                   z
                                                   −
                                                   k
                                                   h
                                                   )
                                                   /
                                                   h
                                                
                                             
                                             ,
                                             
                                             k
                                             ∈
                                             Z
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        has been deeply studied by Stenger (1993), who showed that a function f(z) analytic on the whole complex plane and of exponential type with parameter π/h, i.e., |f(z)| ≤ Ce
                        
                           π|z|/h
                        , can be reconstructed exactly from the knowledge of its values on an equispaced grid of step h, as f(z) admits the sinc expansion (Stenger, 1993, Theorem 1.10.1)

                           
                              
                                 
                                    
                                       
                                          
                                             f
                                             
                                                (
                                                z
                                                )
                                             
                                             =
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   −
                                                   ∞
                                                
                                                
                                                   +
                                                   ∞
                                                
                                             
                                             f
                                             
                                                (
                                                k
                                                h
                                                )
                                             
                                             
                                                S
                                                k
                                             
                                             
                                                (
                                                z
                                                ,
                                                h
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Now, as 
                           
                              
                                 F
                                 
                                    z
                                    →
                                    ζ
                                 
                              
                              
                                 [
                                 
                                    S
                                    k
                                 
                                 
                                    (
                                    z
                                    ,
                                    h
                                    )
                                 
                                 ]
                              
                              =
                              h
                              
                                 e
                                 
                                    i
                                    k
                                    h
                                    ζ
                                 
                              
                              ,
                           
                         and (Feng & Linetsky, 2008a, Corollary 6.1)

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                H
                                                z
                                             
                                             
                                                [
                                                
                                                   S
                                                   k
                                                
                                                
                                                   (
                                                   z
                                                   ,
                                                   h
                                                   )
                                                
                                                ]
                                             
                                             =
                                             
                                                
                                                   1
                                                   −
                                                   cos
                                                   (
                                                   π
                                                   (
                                                   z
                                                   −
                                                   k
                                                   h
                                                   )
                                                   /
                                                   h
                                                   )
                                                
                                                
                                                   π
                                                   (
                                                   z
                                                   −
                                                   k
                                                   h
                                                   )
                                                   /
                                                   h
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        also the Fourier and Hilbert transforms of f(z) admit the sinc expansions

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                f
                                                ^
                                             
                                             
                                                (
                                                ζ
                                                )
                                             
                                             =
                                             h
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   −
                                                   ∞
                                                
                                                
                                                   +
                                                   ∞
                                                
                                             
                                             f
                                             
                                                (
                                                k
                                                h
                                                )
                                             
                                             
                                                e
                                                
                                                   i
                                                   k
                                                   h
                                                   ζ
                                                
                                             
                                             
                                             if
                                             
                                             
                                                |
                                                ζ
                                                |
                                             
                                             <
                                             π
                                             /
                                             h
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 f
                                 ^
                              
                              
                                 (
                                 ζ
                                 )
                              
                              =
                              0
                           
                         if |ζ| ≥ π/h, as functions analytic on the whole plane and of exponential type have Fourier transforms that vanish outside of the finite interval 
                           
                              (
                              −
                              π
                              /
                              h
                              ,
                              π
                              /
                              h
                              )
                           
                         (Stenger, 1993, Theorem 1.10.1), and

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                H
                                                z
                                             
                                             
                                                [
                                                f
                                                
                                                   (
                                                   z
                                                   )
                                                
                                                ]
                                             
                                             =
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   −
                                                   ∞
                                                
                                                
                                                   +
                                                   ∞
                                                
                                             
                                             f
                                             
                                                (
                                                k
                                                h
                                                )
                                             
                                             
                                                
                                                   1
                                                   −
                                                   cos
                                                   (
                                                   π
                                                   (
                                                   z
                                                   −
                                                   k
                                                   h
                                                   )
                                                   /
                                                   h
                                                   )
                                                
                                                
                                                   π
                                                   (
                                                   z
                                                   −
                                                   k
                                                   h
                                                   )
                                                   /
                                                   h
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The integrals of f and |f|2 can be written as sinc expansions too,

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                ∫
                                                R
                                             
                                             f
                                             
                                                (
                                                x
                                                )
                                             
                                             d
                                             x
                                             =
                                             h
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   −
                                                   ∞
                                                
                                                
                                                   +
                                                   ∞
                                                
                                             
                                             f
                                             
                                                (
                                                k
                                                h
                                                )
                                             
                                             ,
                                             
                                             
                                                ∫
                                                R
                                             
                                             
                                                
                                                   |
                                                   f
                                                   
                                                      (
                                                      x
                                                      )
                                                   
                                                   |
                                                
                                                2
                                             
                                             d
                                             x
                                             =
                                             h
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   −
                                                   ∞
                                                
                                                
                                                   +
                                                   ∞
                                                
                                             
                                             
                                                
                                                   |
                                                   f
                                                   
                                                      (
                                                      k
                                                      h
                                                      )
                                                   
                                                   |
                                                
                                                2
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The above results show in particular that the trapezoidal quadrature rule with step size h is exact.

This holds true for a function f(z) that is analytic in the whole complex plane. However, this can be used also to approximate a function that is analytic only in a strip including the real axis, which is the case considered in this article. More precisely, Stenger (1993, Theorems 3.1.3, 3.1.4 and 3.2.1) states that in this case the trapezoidal approximation has an error that decays exponentially with respect to h.

The computation of the Hilbert transform via a sinc expansion can be performed using the FFT (Feng & Linetsky, 2008a, Section 6.5). A discrete Hilbert transform requires matrix-vector multiplications involving Toeplitz matrices. As is well known, this kind of multiplications can be performed exploiting the FFT, once those matrices are embedded in a circulant matrix (Feng & Linetsky, 2008a, Appendix B) (Fusai et al., 2012). In particular, Feng & Linetsky, with respect to the computation of the Hilbert transform (Feng & Linetsky, 2009, Theorem 3.3) and of the whole Plemelj–Sokhotsky formulas (31) (Feng & Linetsky, 2008a, Theorem 6.5) (Feng & Linetsky, 2009, Theorem 3.4) with sinc functions, proved the following convergence result: if a function is analytic in a suitable strip around the real axis, then the discretization error of its numerical factorization or decomposition decays exponentially with the number of grid points M. Matlab code to perform the Hilbert transform via sinc functions and therefore the WH factorization is provided in the online supplementary material.

In order to recover the probabilities in Eqs. (11)–(16) once the WH equations have been solved, we need an inverse z-transform 
                           
                              Z
                              
                                 q
                                 →
                                 n
                              
                              
                                 −
                                 1
                              
                           
                        . The latter is performed according to Eq. (23), where ρ ∈ (0, 1) is a free parameter; setting 
                           
                              ρ
                              =
                              
                                 10
                                 
                                    −
                                    6
                                 
                              
                           
                         yields a 
                           
                              10
                              
                                 −
                                 12
                              
                           
                         accuracy of the option price (Abate & Whitt, 1992; Fusai et al., 2012). Moreover, we apply the Euler summation, which is a convergence-acceleration technique well suited to evaluate alternating series (O’Cinneide, 1997). The idea of the Euler summation is to approximate 
                           
                              
                                 Z
                                 
                                    q
                                    →
                                    n
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 [
                                 
                                    v
                                    ˜
                                 
                                 
                                    (
                                    ξ
                                    ,
                                    q
                                    )
                                 
                                 ]
                              
                           
                         by the binomial average, also called Euler transform, of its partial sums bk
                         from 
                           
                              k
                              =
                              
                                 n
                                 
                                    E
                                 
                              
                           
                         to 
                           
                              k
                              =
                              
                                 n
                                 
                                    E
                                 
                              
                              +
                              
                                 m
                                 
                                    E
                                 
                              
                              ,
                           
                         i.e.,

                           
                              (32)
                              
                                 
                                    
                                       
                                          
                                             
                                                Z
                                                
                                                   q
                                                   →
                                                   n
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                [
                                                
                                                   v
                                                   ˜
                                                
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                                ]
                                             
                                             ≈
                                             
                                                1
                                                
                                                   
                                                      2
                                                      
                                                         m
                                                         
                                                            E
                                                         
                                                      
                                                   
                                                   n
                                                   
                                                      ρ
                                                      n
                                                   
                                                
                                             
                                             
                                                ∑
                                                
                                                   j
                                                   =
                                                   0
                                                
                                                
                                                   m
                                                   
                                                      E
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      m
                                                      
                                                         E
                                                      
                                                   
                                                   j
                                                
                                                )
                                             
                                             
                                                b
                                                
                                                   
                                                      n
                                                      
                                                         E
                                                      
                                                   
                                                   +
                                                   j
                                                
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                b
                                                k
                                             
                                             =
                                             
                                                ∑
                                                
                                                   j
                                                   =
                                                   0
                                                
                                                k
                                             
                                             
                                                
                                                   (
                                                   −
                                                   1
                                                   )
                                                
                                                j
                                             
                                             
                                                a
                                                j
                                             
                                             
                                             
                                                Re
                                             
                                             
                                             
                                                v
                                                ˜
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                ρ
                                                
                                                   e
                                                   
                                                      i
                                                      j
                                                      π
                                                      /
                                                      n
                                                   
                                                
                                                )
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        with 
                           
                              
                                 a
                                 0
                              
                              =
                              0.5
                              ,
                           
                        
                        
                           
                              
                                 a
                                 j
                              
                              =
                              1
                              ,
                              
                              j
                              =
                              1
                              ,
                              …
                              ,
                              
                                 n
                                 
                                    E
                                 
                              
                              +
                              
                                 m
                                 
                                    E
                                 
                              
                              ,
                           
                         and n
                        E and m
                        E are suitably chosen such that 
                           
                              
                                 n
                                 
                                    E
                                 
                              
                              +
                              
                                 m
                                 
                                    E
                                 
                              
                              <
                              n
                           
                        . Thus the number of parameters 
                           
                              q
                              =
                              ρ
                              
                                 e
                                 
                                    i
                                    j
                                    π
                                    /
                                    n
                                 
                              
                           
                         to be considered in Eq. (23) drops from 
                           
                              n
                              +
                              1
                           
                         to 
                           
                              
                                 n
                                 
                                    E
                                 
                              
                              +
                              
                                 m
                                 
                                    E
                                 
                              
                              +
                              1
                           
                        . Numerical tests suggest to set 
                           
                              
                                 n
                                 
                                    E
                                 
                              
                              =
                              12
                           
                         and 
                           
                              
                                 m
                                 
                                    E
                                 
                              
                              =
                              20
                           
                        .

In conclusion, the combined use of the numerical Hilbert transform and the numerical inverse z-transform has a computational cost of

                           
                              
                                 
                                    
                                       
                                          
                                             O
                                             (
                                             
                                                (
                                                min
                                                
                                                   {
                                                   n
                                                   ,
                                                   
                                                      n
                                                      
                                                         E
                                                      
                                                   
                                                   +
                                                   
                                                      m
                                                      
                                                         E
                                                      
                                                   
                                                   }
                                                
                                                +
                                                1
                                                )
                                             
                                             M
                                             log
                                             M
                                             )
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        and a discretization error which exponentially decays till it reaches an accuracy of about 
                           
                              10
                              
                                 −
                                 12
                              
                           
                        . This is confirmed in the numerical experiments reported in Section 5 to price derivatives. The only exception is for the double-barrier case, and therefore when we deal with the probability dP
                        
                           X, m, M
                        , where the error decay turns out to be only polynomial, due to the use of the fixed-point algorithm. On the other hand, the iterative numerical scheme solves a long-standing problem related to an efficient computation of the WH factors in the double-barrier case.

In mathematical finance Lévy processes X(t) are used to describe the evolution of an asset price S(t) according to

                        
                           
                              
                                 
                                    
                                       
                                          S
                                          
                                             (
                                             t
                                             )
                                          
                                          =
                                          
                                             S
                                             0
                                          
                                          
                                             e
                                             
                                                X
                                                (
                                                t
                                                )
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           
                              S
                              0
                           
                           =
                           S
                           
                              (
                              0
                              )
                           
                        
                      being the initial spot price. The stock price dynamics is directly specified under the so-called risk-neutral measure, so that in Eq. (1)
                     
                        
                           a
                           =
                           r
                           −
                           δ
                           −
                           
                              1
                              2
                           
                           
                              σ
                              2
                           
                           −
                           
                              ∫
                              R
                           
                           
                              (
                              
                                 e
                                 η
                              
                              −
                              1
                              −
                              η
                              
                                 1
                                 
                                    |
                                    η
                                    |
                                    <
                                    1
                                 
                              
                              )
                           
                           ν
                           
                              (
                              d
                              η
                              )
                           
                           ,
                        
                      where r is the risk-free interest rate and δ the asset dividend rate.

To price path-dependent options such as barrier and lookback options, the relevant quantities are the maximum MN
                      and the minimum mN
                      registered at discrete times 
                        
                           t
                           =
                           n
                           Δ
                           ,
                        
                     
                     
                        
                           n
                           =
                           0
                           ,
                           …
                           ,
                           N
                           ,
                        
                      up to maturity 
                        
                           N
                           Δ
                           =
                           T
                           ,
                        
                      
                     Δ being the constant time interval between two subsequent monitoring dates. For a fixed-strike lookback option we need the distribution PM
                     (x, N) of the maximum or Pm
                     (x, N) of the minimum. For a single-barrier option we need the joint distribution P
                     
                        X, M
                     (x, N) or P
                     
                        X, m
                     (x, N) of the Lévy process at T and of its maximum (up-and-out case) or minimum (down-and-out case) over all monitoring dates 
                        
                           n
                           =
                           0
                           ,
                           …
                           ,
                           N
                        
                     . For a double-barrier option we need the joint distribution P
                     
                        X, m, M
                     (x, N) of the triplet (XN, mN, MN
                     ).

In pricing the above mentioned contracts, we are interested in the truncated damped payoff for a call and a put option

                        
                           (33)
                           
                              
                                 
                                    
                                       
                                          ϕ
                                          
                                             (
                                             x
                                             )
                                          
                                          =
                                          
                                             e
                                             
                                                α
                                                x
                                             
                                          
                                          
                                             S
                                             0
                                          
                                          
                                             
                                                (
                                                
                                                   e
                                                   x
                                                
                                                −
                                                
                                                   e
                                                   k
                                                
                                                )
                                             
                                             +
                                          
                                          
                                             1
                                             
                                                x
                                                ≤
                                                u
                                             
                                          
                                          
                                          and
                                          
                                          ϕ
                                          
                                             (
                                             x
                                             )
                                          
                                          =
                                          
                                             e
                                             
                                                α
                                                x
                                             
                                          
                                          
                                             S
                                             0
                                          
                                          
                                             
                                                (
                                                
                                                   e
                                                   k
                                                
                                                −
                                                
                                                   e
                                                   x
                                                
                                                )
                                             
                                             +
                                          
                                          
                                             1
                                             
                                                x
                                                ≥
                                                l
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     respectively, where 
                        
                           k
                           =
                           log
                           (
                           K
                           /
                           
                              S
                              0
                           
                           )
                        
                      is the rescaled log-strike of the option, and 
                        
                           l
                           =
                           log
                           (
                           L
                           /
                           
                              S
                              0
                           
                           )
                        
                      and 
                        
                           u
                           =
                           log
                           (
                           U
                           /
                           
                              S
                              0
                           
                           )
                        
                      are the rescaled lower and upper log-barriers. The damping factor eαx
                      with a suitable choice of the parameter α makes the Fourier transform of the payoff well defined.

The option price is obtained discounting the expectation value of the undamped payoff with respect to the appropriate distribution; this expectation can conveniently be computed through the Parseval/Plancherel relation (Lewis, 2001) by a product in Fourier space and an inverse Fourier transform,

                        
                           (34)
                           
                              
                                 
                                    
                                       
                                          E
                                          [
                                          ϕ
                                          
                                             (
                                             x
                                             )
                                          
                                          
                                             e
                                             
                                                −
                                                α
                                                x
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          ϕ
                                          
                                             (
                                             x
                                             )
                                          
                                          
                                             e
                                             
                                                −
                                                α
                                                x
                                             
                                          
                                          p
                                          
                                             (
                                             x
                                             )
                                          
                                          d
                                          x
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             1
                                             
                                                2
                                                π
                                             
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             ϕ
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          
                                             
                                                p
                                                ^
                                             
                                             *
                                          
                                          
                                             (
                                             ξ
                                             +
                                             i
                                             α
                                             )
                                          
                                          d
                                          ξ
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             1
                                             
                                                2
                                                π
                                             
                                          
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             
                                                +
                                                ∞
                                             
                                          
                                          
                                             
                                                ϕ
                                                ^
                                             
                                             *
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          
                                             p
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             +
                                             i
                                             α
                                             )
                                          
                                          d
                                          ξ
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             F
                                             
                                                ξ
                                                →
                                                x
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             [
                                             
                                                
                                                   ϕ
                                                   ^
                                                
                                                *
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             
                                                p
                                                ^
                                             
                                             
                                                (
                                                ξ
                                                +
                                                i
                                                α
                                                )
                                             
                                             ]
                                          
                                          
                                             (
                                             0
                                             )
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           p
                           
                              (
                              x
                              )
                           
                           =
                           
                              p
                              M
                           
                           
                              (
                              x
                              ,
                              N
                              )
                           
                        
                      or pm
                     (x, N) for lookback options (to be synthetic, in the following we will consider only fixed-strike lookback options written on the minimum), 
                        
                           p
                           
                              (
                              x
                              )
                           
                           =
                           
                              p
                              
                                 X
                                 ,
                                 M
                              
                           
                           
                              (
                              x
                              ,
                              N
                              )
                           
                        
                      or p
                     
                        X, m
                     (x, N) for single-barrier options, and 
                        
                           p
                           =
                           
                              p
                              
                                 X
                                 ,
                                 m
                                 ,
                                 M
                              
                           
                           
                              (
                              x
                              ,
                              N
                              )
                           
                        
                      for double-barrier options. The introduction of a damping factor in the payoff is compensated by a shift of the Fourier transform of the probability density function.

While it is known that the Fourier transform of the truncated damped payoff for a barrier option is

                        
                           (35)
                           
                              
                                 
                                    
                                       
                                          
                                             ϕ
                                             ^
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                          =
                                          
                                             S
                                             0
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      e
                                                      
                                                         b
                                                         (
                                                         1
                                                         +
                                                         α
                                                         +
                                                         i
                                                         ξ
                                                         )
                                                      
                                                   
                                                   −
                                                   
                                                      e
                                                      
                                                         a
                                                         (
                                                         1
                                                         +
                                                         α
                                                         +
                                                         i
                                                         ξ
                                                         )
                                                      
                                                   
                                                
                                                
                                                   1
                                                   +
                                                   α
                                                   +
                                                   i
                                                   ξ
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      e
                                                      
                                                         k
                                                         +
                                                         b
                                                         (
                                                         α
                                                         +
                                                         i
                                                         ξ
                                                         )
                                                      
                                                   
                                                   −
                                                   
                                                      e
                                                      
                                                         k
                                                         +
                                                         a
                                                         (
                                                         α
                                                         +
                                                         i
                                                         ξ
                                                         )
                                                      
                                                   
                                                
                                                
                                                   α
                                                   +
                                                   i
                                                   ξ
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                     with 
                        
                           a
                           =
                           max
                           (
                           l
                           ,
                           k
                           )
                           ,
                        
                     
                     
                        
                           b
                           =
                           u
                        
                      for a call option and 
                        
                           a
                           =
                           min
                           (
                           k
                           ,
                           u
                           )
                           ,
                        
                     
                     
                        
                           b
                           =
                           l
                        
                      for a put option (Green et al., 2010, Eq. (3.26)), the main problem in evaluating path-dependent options is the computation of the characteristic functions of the (joint) probability densities defined in Eqs. (5)–(8). Here we exploit the Spitzer identity and the factorization procedure previously described. So let us assume for the moment that the quantities appearing on the right-hand side of Eqs. (12)–(16) are known; then if we take their inverse z-transform defined in Eq. (9) we finally obtain the option price through the double inverse transform

                        
                           (36)
                           
                              
                                 
                                    
                                       
                                          v
                                          
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                          =
                                          
                                             e
                                             
                                                −
                                                r
                                                T
                                             
                                          
                                          
                                             F
                                             
                                                ξ
                                                →
                                                x
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             [
                                             
                                                
                                                   ϕ
                                                   ^
                                                
                                                *
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             
                                                Z
                                                
                                                   q
                                                   →
                                                   N
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                [
                                                
                                                   
                                                      p
                                                      ^
                                                   
                                                   ˜
                                                
                                                
                                                   (
                                                   ξ
                                                   +
                                                   i
                                                   α
                                                   ,
                                                   q
                                                   )
                                                
                                                ]
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     evaluated for 
                        
                           x
                           =
                           0
                        
                     .
                        3
                     
                     
                        3
                        The Fourier transform and the z-transform, and also their inverses, can be interchanged because the z-transform is a power series in q which converges uniformly in a closed and bounded set given by the radius of convergence ρ (Fusai, Abrahams, & Sgarra, 2006). In Eq. (36) the inverse z-transform is performed before the inverse Fourier transform to minimize the computational cost. The reason is that the inversion operator 
                              
                                 Z
                                 
                                    q
                                    →
                                    N
                                 
                                 
                                    −
                                    1
                                 
                              
                            is well approximated by a sum of 
                              
                                 N
                                 +
                                 1
                              
                            terms (or 
                              
                                 
                                    n
                                    
                                       E
                                    
                                 
                                 +
                                 
                                    m
                                    
                                       E
                                    
                                 
                                 +
                                 1
                              
                            if the Euler acceleration is considered). Therefore, from a computational point of view it is advantageous to do a single inverse Fourier transform of the sum instead of a separate transform of each of the addends.
                      A few little improvements, discussed later on, can be adopted in order to enhance the numerical accuracy of the final result.

In this case, without loss of generality we consider only a fixed-strike lookback put on the minimum, where it is natural to assume K ≤ S
                        0, so that the contract can or cannot be exercised at maturity. The pricing formula (36) reads

                           
                              
                                 
                                    
                                       
                                          
                                             v
                                             
                                                (
                                                x
                                                ,
                                                N
                                                )
                                             
                                             =
                                             
                                                e
                                                
                                                   −
                                                   r
                                                   T
                                                
                                             
                                             
                                                F
                                                
                                                   ξ
                                                   →
                                                   x
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                [
                                                
                                                   
                                                      ϕ
                                                      ^
                                                   
                                                   *
                                                
                                                
                                                   (
                                                   ξ
                                                   )
                                                
                                                
                                                   Z
                                                   
                                                      q
                                                      →
                                                      N
                                                   
                                                   
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   [
                                                   
                                                      1
                                                      
                                                         
                                                            Φ
                                                            +
                                                         
                                                         
                                                            (
                                                            0
                                                            ,
                                                            q
                                                            )
                                                         
                                                         
                                                            Φ
                                                            −
                                                         
                                                         
                                                            (
                                                            ξ
                                                            +
                                                            i
                                                            α
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                   
                                                   ]
                                                
                                                ]
                                             
                                          
                                       
                                    
                                 
                              
                           
                        evaluated for 
                           
                              x
                              =
                              0
                           
                        ; however, assuming a number of monitoring dates N > 1, it is convenient to modify the above pricing formula into

                           
                              
                                 
                                    
                                       
                                          
                                             v
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                e
                                                
                                                   −
                                                   r
                                                   T
                                                
                                             
                                             
                                                F
                                                
                                                   ξ
                                                   →
                                                   x
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             [
                                             
                                                
                                                   ϕ
                                                   ^
                                                
                                                *
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             Ψ
                                             
                                                (
                                                ξ
                                                +
                                                i
                                                α
                                                ,
                                                Δ
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             ×
                                             
                                                Z
                                                
                                                   q
                                                   →
                                                   N
                                                   −
                                                   1
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                             
                                                
                                                   [
                                                   
                                                      1
                                                      
                                                         
                                                            Φ
                                                            +
                                                         
                                                         
                                                            (
                                                            0
                                                            ,
                                                            q
                                                            )
                                                         
                                                         
                                                            Φ
                                                            −
                                                         
                                                         
                                                            (
                                                            ξ
                                                            +
                                                            i
                                                            α
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                   
                                                   ]
                                                
                                                ]
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The conjugated Fourier transform of the payoff function is smoothed by the multiplication by the characteristic function Ψ, giving it the required regularity to ensure an exponential decay of the error. This procedure computes the distribution Pm
                         not starting from time 0, but moving one step forward with a convolution procedure. This corresponds to multiplying by Ψ the Fourier transform of the Dirac delta function, i.e., the value of the probability at time 0, and then applying the Spitzer identity. Indeed

                           
                              (37)
                              
                                 
                                    
                                       
                                          
                                             
                                                F
                                                
                                                   x
                                                   →
                                                   ξ
                                                
                                             
                                             
                                                [
                                                
                                                   p
                                                   m
                                                
                                                
                                                   (
                                                   x
                                                   ,
                                                   N
                                                   )
                                                
                                                ]
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                Z
                                                
                                                   q
                                                   →
                                                   N
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                [
                                                
                                                   1
                                                   
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         0
                                                         ,
                                                         q
                                                         )
                                                      
                                                      
                                                         Φ
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                Z
                                                
                                                   q
                                                   →
                                                   N
                                                   −
                                                   1
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                [
                                                
                                                   
                                                      Ψ
                                                      (
                                                      ξ
                                                      ,
                                                      Δ
                                                      )
                                                   
                                                   
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         0
                                                         ,
                                                         q
                                                         )
                                                      
                                                      
                                                         Φ
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                          
                                       
                                    
                                 
                              
                           
                        for any x < 0.
                           4
                        
                        
                           4
                           The hypothesis K ≤ S
                              0 implies that 
                                 
                                    ϕ
                                    (
                                    x
                                    )
                                    =
                                    0
                                 
                               if x ≥ 0, therefore we are only interested in the distribution of the minimum for negative values of x.
                         The algorithm can be summarized by the scheme

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                         
                                                         ϕ
                                                         
                                                            ⟶
                                                            F
                                                         
                                                         
                                                            ϕ
                                                            ^
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                
                                                
                                                   
                                                      
                                                         δ
                                                         
                                                            ⟶
                                                            F
                                                         
                                                         1
                                                         
                                                            ⟶
                                                            Ψ
                                                         
                                                         Ψ
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ↘
                                                   
                                                
                                                
                                                   
                                                      
                                                         ↗
                                                         
                                                            A
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                ⟶
                                                ZS
                                             
                                             
                                                
                                                   v
                                                   ^
                                                
                                                N
                                             
                                             
                                                ⟶
                                                
                                                   F
                                                   
                                                      −
                                                      1
                                                   
                                                
                                             
                                             
                                                v
                                                N
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where the operator 
                           ZS
                         is defined as

                           
                              
                                 
                                    
                                       
                                          
                                             ZS
                                             [
                                             
                                                ϕ
                                                ^
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             ,
                                             Ψ
                                             
                                                (
                                                ξ
                                                ,
                                                Δ
                                                )
                                             
                                             ]
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   ϕ
                                                   ^
                                                
                                                *
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             Ψ
                                             
                                                (
                                                ξ
                                                +
                                                i
                                                α
                                                ,
                                                Δ
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             ×
                                             
                                                Z
                                                
                                                   q
                                                   →
                                                   N
                                                   −
                                                   1
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                [
                                                
                                                   1
                                                   
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         0
                                                         ,
                                                         q
                                                         )
                                                      
                                                      
                                                         Φ
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         +
                                                         i
                                                         α
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The conjugate operator applied to 
                           
                              ϕ
                              ^
                           
                         is due to the Parseval relation. Therefore, the full procedure consists of the steps:

                           
                              1.
                              For each q necessary to invert the z-transform, factorize

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Φ
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      :
                                                      =
                                                      1
                                                      −
                                                      q
                                                      Ψ
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         Δ
                                                         )
                                                      
                                                      =
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      
                                                         Φ
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 and compute the Spitzer identity

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      R
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      :
                                                      =
                                                      
                                                         1
                                                         
                                                            
                                                               Φ
                                                               +
                                                            
                                                            
                                                               (
                                                               0
                                                               ,
                                                               q
                                                               )
                                                            
                                                            
                                                               Φ
                                                               −
                                                            
                                                            
                                                               (
                                                               ξ
                                                               ,
                                                               q
                                                               )
                                                            
                                                         
                                                      
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 We recall that 
                                    
                                       
                                          
                                             p
                                             ^
                                          
                                          m
                                       
                                       
                                          (
                                          ξ
                                          ,
                                          N
                                          )
                                       
                                       =
                                       
                                          Z
                                          
                                             q
                                             →
                                             N
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          [
                                          R
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          ]
                                       
                                       =
                                    
                                 
                                 
                                    
                                       Ψ
                                       
                                          (
                                          ξ
                                          ,
                                          Δ
                                          )
                                       
                                       
                                          Z
                                          
                                             q
                                             →
                                             N
                                             −
                                             1
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          [
                                          R
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          ]
                                       
                                    
                                  due to Eq. (37).

Apply the inverse z-transform 
                                    
                                       Z
                                       
                                          q
                                          →
                                          N
                                          −
                                          1
                                       
                                       
                                          −
                                          1
                                       
                                    
                                  to 
                                    
                                       R
                                       (
                                       ξ
                                       +
                                       i
                                       α
                                       ,
                                       q
                                       )
                                    
                                  and multiply the result by 
                                    
                                       
                                          
                                             ϕ
                                             ^
                                          
                                          *
                                       
                                       
                                          (
                                          ξ
                                          )
                                       
                                       Ψ
                                       
                                          (
                                          ξ
                                          +
                                          i
                                          α
                                          ,
                                          Δ
                                          )
                                       
                                       ,
                                    
                                  obtaining 
                                    
                                       
                                          v
                                          ^
                                       
                                       
                                          (
                                          ξ
                                          ,
                                          N
                                          )
                                       
                                    
                                 .

Apply the inverse Fourier transform to 
                                    
                                       
                                          v
                                          ^
                                       
                                       
                                          (
                                          ξ
                                          ,
                                          N
                                          )
                                       
                                    
                                  and pick the value for 
                                    
                                       x
                                       =
                                       0
                                       ,
                                    
                                  obtaining the option price.

A similar procedure is valid for fixed-strike lookback call options written on the maximum, where 
                           
                              
                                 
                                    
                                       p
                                       ^
                                    
                                    ˜
                                 
                                 M
                              
                              
                                 (
                                 ξ
                                 ,
                                 q
                                 )
                              
                           
                         is used in place of 
                           
                              
                                 
                                    
                                       p
                                       ^
                                    
                                    ˜
                                 
                                 m
                              
                              
                                 (
                                 ξ
                                 ,
                                 q
                                 )
                              
                           
                         and the additional hypothesis K ≤ S
                        0 is replaced by K ≥ S
                        0.

Without loss of generality, let us consider the case of a down-and-out barrier option. The pricing formula (36) reads

                           
                              
                                 
                                    
                                       
                                          
                                             v
                                             
                                                (
                                                x
                                                ,
                                                N
                                                )
                                             
                                             =
                                             
                                                e
                                                
                                                   −
                                                   r
                                                   T
                                                
                                             
                                             
                                                F
                                                
                                                   ξ
                                                   →
                                                   x
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                [
                                                
                                                   
                                                      ϕ
                                                      ^
                                                   
                                                   *
                                                
                                                
                                                   (
                                                   ξ
                                                   )
                                                
                                                
                                                   Z
                                                   
                                                      q
                                                      →
                                                      N
                                                   
                                                   
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   [
                                                   
                                                      e
                                                      
                                                         i
                                                         l
                                                         ξ
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            P
                                                            +
                                                         
                                                         
                                                            (
                                                            ξ
                                                            +
                                                            i
                                                            α
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            Φ
                                                            +
                                                         
                                                         
                                                            (
                                                            ξ
                                                            +
                                                            i
                                                            α
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                   
                                                   ]
                                                
                                                ]
                                             
                                             ;
                                          
                                       
                                    
                                 
                              
                           
                        however, assuming a number of monitoring dates N > 2, it is convenient to modify it into

                           
                              
                                 
                                    
                                       
                                          
                                             v
                                             (
                                             x
                                             ,
                                             N
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                e
                                                
                                                   −
                                                   r
                                                   T
                                                
                                             
                                             
                                                F
                                                
                                                   ξ
                                                   →
                                                   x
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             [
                                             
                                                
                                                   ϕ
                                                   ^
                                                
                                                *
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             Ψ
                                             
                                                (
                                                ξ
                                                +
                                                i
                                                α
                                                ,
                                                Δ
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             ×
                                             
                                                Z
                                                
                                                   q
                                                   →
                                                   N
                                                   −
                                                   2
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                [
                                                
                                                   e
                                                   
                                                      i
                                                      l
                                                      ξ
                                                      +
                                                      i
                                                      α
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            P
                                                            ¯
                                                         
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         +
                                                         i
                                                         α
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         +
                                                         i
                                                         α
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                             ]
                                          
                                       
                                    
                                 
                              
                           
                        where

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                P
                                                ¯
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                             :
                                             =
                                             Ψ
                                             
                                                (
                                                ξ
                                                ,
                                                Δ
                                                )
                                             
                                             
                                                
                                                   e
                                                   
                                                      −
                                                      i
                                                      l
                                                      ξ
                                                   
                                                
                                                
                                                   
                                                      Φ
                                                      −
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   P
                                                   ¯
                                                
                                                +
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                             +
                                             
                                                
                                                   P
                                                   ¯
                                                
                                                −
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        More precisely, we reduce the number of monitoring dates by one and multiply the payoff function by the characteristic function to smooth it. From a financial point of view, this is equivalent to price an option with 
                           
                              N
                              −
                              1
                           
                         monitoring dates and payoff 
                           
                              
                                 v
                                 1
                              
                              =
                              v
                              
                                 (
                                 x
                                 ,
                                 1
                                 )
                              
                              ,
                           
                         where v(x, n) is the value of the option with log-price x at time 
                           
                              (
                              N
                              −
                              n
                              )
                              Δ
                           
                        . From a technical point of view, this corresponds to applying a first step of the convolution pricing procedure; see the supplementary material, Section C.1. Then we proceed as for lookback options. Our algorithm can be summarized by the scheme

                           
                              (38)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ϕ
                                                         ≡
                                                         
                                                            v
                                                            0
                                                         
                                                         
                                                            ⟶
                                                            F
                                                         
                                                         
                                                            
                                                               v
                                                               ^
                                                            
                                                            0
                                                         
                                                         
                                                            ⟶
                                                            
                                                               Ψ
                                                               *
                                                            
                                                         
                                                         
                                                            
                                                               v
                                                               ^
                                                            
                                                            1
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               a
                                                               a
                                                               a
                                                               a
                                                               a
                                                            
                                                         
                                                         δ
                                                         
                                                            ⟶
                                                            F
                                                         
                                                         1
                                                         
                                                            ⟶
                                                            Ψ
                                                         
                                                         Ψ
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ↘
                                                   
                                                
                                                
                                                   
                                                      
                                                         ↗
                                                         
                                                            A
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                ⟶
                                                ZS
                                             
                                             
                                                
                                                   v
                                                   ^
                                                
                                                N
                                             
                                             
                                                ⟶
                                                
                                                   F
                                                   
                                                      −
                                                      1
                                                   
                                                
                                             
                                             
                                                v
                                                N
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where in this case we denote with 
                           ZS
                         the operator

                           
                              
                                 
                                    
                                       
                                          
                                             ZS
                                             
                                                [
                                                
                                                   
                                                      v
                                                      ^
                                                   
                                                   1
                                                
                                                
                                                   (
                                                   ξ
                                                   )
                                                
                                                ,
                                                Ψ
                                                
                                                   (
                                                   ξ
                                                   ,
                                                   Δ
                                                   )
                                                
                                                ]
                                             
                                             =
                                             
                                                
                                                   v
                                                   ^
                                                
                                                1
                                                *
                                             
                                             
                                                (
                                                ξ
                                                )
                                             
                                             
                                                Z
                                                
                                                   q
                                                   →
                                                   N
                                                   −
                                                   2
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                [
                                                
                                                   e
                                                   
                                                      i
                                                      l
                                                      ξ
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            P
                                                            ¯
                                                         
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         +
                                                         i
                                                         α
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         +
                                                         i
                                                         α
                                                         ,
                                                         q
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The substitution of P with 
                           
                              P
                              ¯
                           
                         is again a smoothing procedure necessary to achieve the regularity required to ensure an exponential decay of the error. This substitution is related to the procedure sketched in Eq. (38): in computing the distribution P
                        
                           X, m
                         we do not start from time 0, but we move one step forward via a convolution, which corresponds to multiplying by Ψ the Fourier transform of the Dirac delta function. Then we apply the Spitzer identity. Moreover, notice that the procedures given by Eq. (38) are performed backward and forward-in-time, as one (starting point: payoff at time T) is related to the price of the derivative, while the other (starting point: Dirac delta at time 0) to the probability distribution of the log-price.
                           5
                        
                        
                           5
                           We recall that the Fourier transform of the backward-in-time transition density is 
                                 
                                    
                                       Ψ
                                       *
                                    
                                    
                                       (
                                       ξ
                                       ,
                                       Δ
                                       )
                                    
                                    =
                                    
                                       F
                                       
                                          x
                                          →
                                          ξ
                                       
                                    
                                    
                                       [
                                       f
                                       
                                          (
                                          −
                                          x
                                          ,
                                          Δ
                                          )
                                       
                                       ]
                                    
                                    ,
                                 
                               where f(x, Δ) is the forward-in-time transition density and Ψ(ξ, Δ) its Fourier transform.
                        
                     

Therefore, for a down-and-out barrier option we perform the steps:

                           
                              1.
                              For each q necessary to invert the z-transform, factorize

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Φ
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      :
                                                      =
                                                      1
                                                      −
                                                      q
                                                      Ψ
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         Δ
                                                         )
                                                      
                                                      =
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      
                                                         Φ
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      ,
                                                   
                                                
                                             
                                          
                                       
                                    
                                 decompose

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         P
                                                         ¯
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      :
                                                      =
                                                      Ψ
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         Δ
                                                         )
                                                      
                                                      
                                                         
                                                            e
                                                            
                                                               −
                                                               i
                                                               l
                                                               ξ
                                                            
                                                         
                                                         
                                                            
                                                               Φ
                                                               −
                                                            
                                                            
                                                               (
                                                               ξ
                                                               ,
                                                               q
                                                               )
                                                            
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            P
                                                            ¯
                                                         
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      +
                                                      
                                                         
                                                            P
                                                            ¯
                                                         
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      ,
                                                   
                                                
                                             
                                          
                                       
                                    
                                 and compute the Spitzer identity

                                    
                                       (39)
                                       
                                          
                                             
                                                
                                                   
                                                      R
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      :
                                                      =
                                                      
                                                         e
                                                         
                                                            i
                                                            l
                                                            ξ
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  P
                                                                  ¯
                                                               
                                                               +
                                                            
                                                            
                                                               (
                                                               ξ
                                                               ,
                                                               q
                                                               )
                                                            
                                                         
                                                         
                                                            
                                                               Φ
                                                               +
                                                            
                                                            
                                                               (
                                                               ξ
                                                               ,
                                                               q
                                                               )
                                                            
                                                         
                                                      
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 The function R(ξ, q) is related to 
                                    
                                       
                                          
                                             
                                                p
                                                ^
                                             
                                             ˜
                                          
                                          
                                             X
                                             ,
                                             m
                                          
                                       
                                       
                                          (
                                          ξ
                                          ,
                                          q
                                          )
                                       
                                    
                                  in Eq. (12): more precisely, 
                                    
                                       
                                          Z
                                          
                                             q
                                             →
                                             N
                                             −
                                             1
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          [
                                          R
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          ]
                                       
                                       =
                                       
                                          Z
                                          
                                             q
                                             →
                                             N
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          [
                                          
                                             
                                                
                                                   p
                                                   ^
                                                
                                                ˜
                                             
                                             
                                                X
                                                ,
                                                m
                                             
                                          
                                          
                                             (
                                             ξ
                                             ,
                                             q
                                             )
                                          
                                          ]
                                       
                                       =
                                       
                                          
                                             p
                                             ^
                                          
                                          
                                             X
                                             ,
                                             m
                                          
                                       
                                       
                                          (
                                          ξ
                                          ,
                                          N
                                          )
                                       
                                    
                                 .

Apply the inverse z-transform 
                                    
                                       Z
                                       
                                          q
                                          →
                                          N
                                          −
                                          2
                                       
                                       
                                          −
                                          1
                                       
                                    
                                  and then the inverse Fourier transform, obtaining the option price from

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      v
                                                      (
                                                      x
                                                      ,
                                                      N
                                                      )
                                                   
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         e
                                                         
                                                            −
                                                            r
                                                            T
                                                         
                                                      
                                                      
                                                         F
                                                         
                                                            ξ
                                                            →
                                                            x
                                                         
                                                         
                                                            −
                                                            1
                                                         
                                                      
                                                      [
                                                      
                                                         
                                                            ϕ
                                                            ^
                                                         
                                                         *
                                                      
                                                      
                                                         (
                                                         ξ
                                                         )
                                                      
                                                      Ψ
                                                      
                                                         (
                                                         ξ
                                                         +
                                                         i
                                                         α
                                                         ,
                                                         Δ
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      ×
                                                      
                                                         Z
                                                         
                                                            q
                                                            →
                                                            N
                                                            −
                                                            2
                                                         
                                                         
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            [
                                                            
                                                               e
                                                               
                                                                  i
                                                                  l
                                                                  (
                                                                  ξ
                                                                  +
                                                                  i
                                                                  α
                                                                  )
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        P
                                                                        ¯
                                                                     
                                                                     +
                                                                  
                                                                  
                                                                     (
                                                                     ξ
                                                                     +
                                                                     i
                                                                     α
                                                                     ,
                                                                     q
                                                                     )
                                                                  
                                                               
                                                               
                                                                  
                                                                     Φ
                                                                     +
                                                                  
                                                                  
                                                                     (
                                                                     ξ
                                                                     +
                                                                     i
                                                                     α
                                                                     ,
                                                                     q
                                                                     )
                                                                  
                                                               
                                                            
                                                            ]
                                                         
                                                         ]
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 evaluated for 
                                    
                                       x
                                       =
                                       0
                                    
                                 .

For the double-barrier option pricing problem the missing piece is the computation of the factors 
                           
                              J
                              +
                           
                         and 
                           
                              J
                              −
                           
                         in Eq. (16). This requires the solution of a system of two integral equations, and we apply here the new fixed-point algorithm presented in Section 2.

Starting from Eqs. (17) and (18), as for the single-barrier case we assume a number of monitoring dates N > 2 and we move one step forward in the computation of the probability dP
                        
                           X, m, M
                         via convolution. So we replace Eqs. (19) and (20) with

                           
                              (40)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      J
                                                      −
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                                
                                                   
                                                      Φ
                                                      −
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   [
                                                   
                                                      
                                                         
                                                            e
                                                            
                                                               −
                                                               i
                                                               l
                                                               ξ
                                                            
                                                         
                                                         Ψ
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            Δ
                                                            )
                                                         
                                                         −
                                                         
                                                            e
                                                            
                                                               i
                                                               (
                                                               u
                                                               −
                                                               l
                                                               )
                                                               ξ
                                                            
                                                         
                                                         
                                                            J
                                                            +
                                                         
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            Φ
                                                            −
                                                         
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                   
                                                   ]
                                                
                                                −
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (41)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      J
                                                      +
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                                
                                                   
                                                      Φ
                                                      +
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   [
                                                   
                                                      
                                                         
                                                            e
                                                            
                                                               −
                                                               i
                                                               u
                                                               ξ
                                                            
                                                         
                                                         Ψ
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            Δ
                                                            )
                                                         
                                                         −
                                                         
                                                            e
                                                            
                                                               i
                                                               (
                                                               l
                                                               −
                                                               u
                                                               )
                                                               ξ
                                                            
                                                         
                                                         
                                                            J
                                                            −
                                                         
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            Φ
                                                            +
                                                         
                                                         
                                                            (
                                                            ξ
                                                            ,
                                                            q
                                                            )
                                                         
                                                      
                                                   
                                                   ]
                                                
                                                +
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        To compute J
                        ± we consider the iterative procedure presented in Section 2, dealing with

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                   ¯
                                                
                                                
                                                   (
                                                   j
                                                   )
                                                
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                          
                                       
                                       
                                          
                                             :
                                             =
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      e
                                                      
                                                         −
                                                         i
                                                         l
                                                         ξ
                                                      
                                                   
                                                   Ψ
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      Δ
                                                      )
                                                   
                                                
                                                
                                                   
                                                      Φ
                                                      −
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      e
                                                      
                                                         i
                                                         (
                                                         u
                                                         −
                                                         l
                                                         )
                                                         ξ
                                                      
                                                   
                                                   
                                                      J
                                                      +
                                                      
                                                         (
                                                         j
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                                
                                                   
                                                      Φ
                                                      −
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   P
                                                   ¯
                                                
                                                +
                                                
                                                   (
                                                   j
                                                   )
                                                
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                             +
                                             
                                                
                                                   P
                                                   ¯
                                                
                                                −
                                                
                                                   (
                                                   j
                                                   )
                                                
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   Q
                                                   ¯
                                                
                                                
                                                   (
                                                   j
                                                   )
                                                
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                          
                                       
                                       
                                          
                                             :
                                             =
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      e
                                                      
                                                         −
                                                         i
                                                         u
                                                         ξ
                                                      
                                                   
                                                   Ψ
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      Δ
                                                      )
                                                   
                                                
                                                
                                                   
                                                      Φ
                                                      +
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      e
                                                      
                                                         i
                                                         (
                                                         l
                                                         −
                                                         u
                                                         )
                                                         ξ
                                                      
                                                   
                                                   
                                                      J
                                                      −
                                                      
                                                         (
                                                         j
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                                
                                                   
                                                      Φ
                                                      +
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   Q
                                                   ¯
                                                
                                                +
                                                
                                                   (
                                                   j
                                                   )
                                                
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                             +
                                             
                                                
                                                   Q
                                                   ¯
                                                
                                                −
                                                
                                                   (
                                                   j
                                                   )
                                                
                                             
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        instead of Eqs. (21) and (22), respectively. Once J
                        ± are obtained via the fixed-point algorithm, we compute

                           
                              (42)
                              
                                 
                                    
                                       
                                          
                                             R
                                             
                                                (
                                                ξ
                                                ,
                                                q
                                                )
                                             
                                             :
                                             =
                                             
                                                
                                                   Ψ
                                                   (
                                                   ξ
                                                   ,
                                                   Δ
                                                   )
                                                
                                                
                                                   Φ
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             −
                                             
                                                e
                                                
                                                   i
                                                   l
                                                   ξ
                                                
                                             
                                             
                                                
                                                   
                                                      J
                                                      −
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                                
                                                   Φ
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             −
                                             
                                                e
                                                
                                                   i
                                                   u
                                                   ξ
                                                
                                             
                                             
                                                
                                                   
                                                      J
                                                      +
                                                   
                                                   
                                                      (
                                                      ξ
                                                      ,
                                                      q
                                                      )
                                                   
                                                
                                                
                                                   Φ
                                                   (
                                                   ξ
                                                   ,
                                                   q
                                                   )
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The function R(ξ, q) is related to 
                           
                              
                                 
                                    
                                       p
                                       ^
                                    
                                    ˜
                                 
                                 
                                    X
                                    ,
                                    m
                                    ,
                                    M
                                 
                              
                              
                                 (
                                 ξ
                                 ,
                                 q
                                 )
                              
                           
                         in Eq. (16): more precisely, 
                           
                              
                                 Z
                                 
                                    q
                                    →
                                    N
                                    −
                                    1
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 [
                                 R
                                 
                                    (
                                    ξ
                                    ,
                                    q
                                    )
                                 
                                 ]
                              
                              =
                              
                                 Z
                                 
                                    q
                                    →
                                    N
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 [
                                 
                                    
                                       
                                          p
                                          ^
                                       
                                       ˜
                                    
                                    
                                       X
                                       ,
                                       m
                                       ,
                                       M
                                    
                                 
                                 
                                    (
                                    ξ
                                    ,
                                    q
                                    )
                                 
                                 ]
                              
                              =
                              
                                 
                                    p
                                    ^
                                 
                                 
                                    X
                                    ,
                                    m
                                    ,
                                    M
                                 
                              
                              
                                 (
                                 ξ
                                 ,
                                 N
                                 )
                              
                           
                        .

Therefore the scheme for the computation of the option price is:

                           
                              1.
                              For each q necessary to invert the z-transform, factorize

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Φ
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      =
                                                      1
                                                      −
                                                      q
                                                      Ψ
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         Δ
                                                         )
                                                      
                                                      =
                                                      
                                                         Φ
                                                         +
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      
                                                         Φ
                                                         −
                                                      
                                                      
                                                         (
                                                         ξ
                                                         ,
                                                         q
                                                         )
                                                      
                                                      ,
                                                   
                                                
                                             
                                          
                                       
                                    
                                 and compute R(ξ, q) via the iterative scheme.

Apply the inverse z-transform 
                                    
                                       Z
                                       
                                          q
                                          →
                                          N
                                          −
                                          2
                                       
                                       
                                          −
                                          1
                                       
                                    
                                  to 
                                    
                                       R
                                       (
                                       ξ
                                       +
                                       i
                                       α
                                       ,
                                       q
                                       )
                                    
                                  and then the inverse Fourier transform, obtaining the option price in 
                                    
                                       x
                                       =
                                       0
                                    
                                  from

                                    
                                       (43)
                                       
                                          
                                             
                                                
                                                   
                                                      v
                                                      
                                                         (
                                                         x
                                                         ,
                                                         N
                                                         )
                                                      
                                                      =
                                                      
                                                         e
                                                         
                                                            −
                                                            r
                                                            T
                                                         
                                                      
                                                      
                                                         F
                                                         
                                                            ξ
                                                            →
                                                            x
                                                         
                                                         
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         [
                                                         
                                                         
                                                            
                                                               ϕ
                                                               ^
                                                            
                                                            *
                                                         
                                                         
                                                            (
                                                            ξ
                                                            )
                                                         
                                                         Ψ
                                                         
                                                            (
                                                            ξ
                                                            +
                                                            i
                                                            α
                                                            ,
                                                            Δ
                                                            )
                                                         
                                                         
                                                            Z
                                                            
                                                               q
                                                               →
                                                               N
                                                               −
                                                               2
                                                            
                                                            
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            [
                                                            R
                                                            
                                                               (
                                                               ξ
                                                               +
                                                               i
                                                               α
                                                               ,
                                                               q
                                                               )
                                                            
                                                            ]
                                                         
                                                         
                                                         ]
                                                      
                                                      .
                                                      
                                                      
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

Thus, the methodology to price a double-barrier option is close to the one proposed for single-barrier contracts and consists of the same steps as sketched in Eq. (38), with a different R(ξ, q) inside the operator 
                           
                              ZS
                              
                                 [
                                 
                                    
                                       v
                                       ^
                                    
                                    1
                                 
                                 
                                    (
                                    ξ
                                    )
                                 
                                 ,
                                 Ψ
                                 
                                    (
                                    ξ
                                    ,
                                    Δ
                                    )
                                 
                                 ]
                              
                              =
                              
                                 
                                    v
                                    ^
                                 
                                 1
                                 *
                              
                              
                                 (
                                 ξ
                                 )
                              
                              
                                 Z
                                 
                                    q
                                    →
                                    N
                                    −
                                    2
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 [
                                 R
                                 
                                    (
                                    ξ
                                    ,
                                    q
                                    )
                                 
                                 ]
                              
                              ,
                           
                         i.e. the R(ξ, q) computed from Ψ(ξ, Δ) and q via the fixed-point algorithm defined in Eq. (42) instead of the one in Eq. (39). Even if the factorization is performed with a sinc function expansion of the Hilbert transform as described in Section 3.1, our numerical experiments show that, due to the fixed-point algorithm for R(ξ, q), this pricing algorithm provides a quadratic convergence of the error instead of the exponential one of single-barrier (and lookback) options.

In this section we compare the proposed pricing techniques with others presented in the literature. We consider:

                        
                           •
                           Z-S, i.e., the new fast method presented in this article.

CONV, i.e., the convolution method of Lord et al. (2008) described in the supplementary material, Section C.1.

HILB, i.e., the recursive method of Feng and Linetsky (2008a) based on the Hilbert transform and described in the supplementary material, Section C.1.

REC-QUAD, i.e., the recursive method based on the trapezoidal quadrature rule and described in the supplementary material, Section C.2.

Z-QUAD, i.e., the method of Fusai et al. (2012) based on the z-transform and the trapezoidal quadrature rule, described in the supplementary material, Section C.3.

The Z-QUAD algorithm requires to solve several WH integral equations via quadrature formulas. Another possibility consists in relating the Spitzer-WH factorization to the solution of these integral equations. Indeed, the well-known methodology to solve a WH integral equation also requires the knowledge of the WH factors. Therefore, we also consider the following new method

                        
                           •
                           Z-WH, i.e., a new method which improves Z-QUAD exploiting WH factorization via the Hilbert transform and sinc functions; see the supplementary material, Section C.3.

All the numerical experiments have been performed with Matlab R2013b running under Windows 7 on a personal computer equipped with an Intel Core i7 Q720 1600 MHz processor and 6 GB of RAM. We would like to stress that with lookback and single-barrier options and with all Fourier-based methods we have unbounded domains. Therefore, we use a domain truncation based on a moments bound with tolerance 
                        
                           10
                           
                              −
                              8
                           
                        
                      (Fusai et al., 2012); thus the truncation error is constant, but, according to numerical experiments (Fusai et al., 2009; Fusai et al., 2012), it does not affect the first significant decimal digits.

First of all, we consider a down-and-out call barrier option assuming that the underlying asset evolves according to a Merton jump diffusion process with the same parameters as in Feng and Linetsky (2008a), including the procedure to choose the damping parameter α. The lower barrier is 
                        
                           L
                           =
                           0.8
                           ,
                        
                      the initial spot price S
                     0 and the strike price K are both set to 1, and the time to maturity is 
                        
                           T
                           =
                           1
                        
                     . The underlying asset has a dividend rate 
                        
                           δ
                           =
                           0.02
                        
                      and the risk-free interest rate is 
                        
                           r
                           =
                           0.05
                        
                     .

In Fig. 1
                     
                      we consider the case with 
                        
                           N
                           =
                           100
                        
                      and 
                        
                           N
                           =
                           252
                        
                      monitoring dates: we report in double logarithmic scale the pointwise absolute error, computed at the spot price 
                        
                           
                              S
                              0
                           
                           =
                           1
                           ,
                        
                      taking as exact solution the price computed with the HILB method and a grid of 216 points. The CONV, REC and Z-QUAD methods have a polynomial convergence; moreover the REC and the Z-QUAD algorithms show a similar polynomial accuracy. Our newly proposed methods, Z-S and Z-WH, and the HILB algorithm exhibit an exponential convergence due to the use of the sinc expansion and to the fact that all computations are performed in Fourier space, as already described by Feng and Linetsky (2008a). As expected, both the Z-S and Z-WH methods rapidly reach the maximum accuracy allowed by the approximation used to invert the z-transform, i.e., 
                        
                           10
                           
                              −
                              12
                           
                        
                     .

In Fig. 2 we report the pointwise absolute error against the CPU time necessary for the price computation for different numbers of monitoring dates. It is clear that the Z-S, the Z-WH and the HILB methods are the most accurate. Their exponential convergence enables them to be used with a limited number M of grid nodes. The Z-S and the Z-WH methods are able to compute option prices with an accuracy of 
                        
                           10
                           
                              −
                              12
                           
                        
                      in less than a quarter of a second. Notice that increasing the number of monitoring dates from 252 to 504 or 1260, the computational costs of the methods based on the z-transform do not change because of the Euler acceleration technique. From these experiments it appears that, among the methods proposed in this paper, Z-S and Z-WH are preferable when the number of dates is large. However, if a greater accuracy is necessary and the number of monitoring dates is not too large, the HILB method by Feng and Linetsky (2008a) should also be considered.

To complete the numerical tests on single-barrier options, Table 1
                     
                      shows results for a down-and-out barrier call option, assuming that the underlying asset evolves according to a NIG process with the same parameters as in Feng and Linetsky (2008a). All the other parameters are as before. These results confirm the good performance of the Z-S and Z-WH algorithms when the number of monitoring dates increases. Moreover, it is not possible to state which method between Z-S and Z-WH should be preferred, as they are comparable in accuracy and computational cost. This is not surprising, as the two algorithms are made of the same building blocks, even if they have been developed from two different relations, i.e., the Parseval equation for Z-S and the recursive approach for Z-WH.

In Fig. 3
                      we consider a double-barrier option and we plot the pointwise absolute error for the fixed-point algorithm presented in Section 4.3. We use the Kou double exponential model Kou (2002), again with the same parameters as in Feng and Linetsky (2008a). The lower (upper) barrier is 
                        
                           L
                           =
                           0.8
                        
                      (
                        
                           U
                           =
                           1.2
                        
                     ), the initial spot price is 
                        
                           
                              S
                              0
                           
                           =
                           1
                        
                      and the strike price is 
                        
                           K
                           =
                           1.1
                        
                     . A one year daily monitoring is assumed, i.e., 
                        
                           T
                           =
                           1
                        
                      and 
                        
                           N
                           =
                           252
                        
                     . The error is again computed considering as exact the solution computed with the HILB method and 
                        
                           M
                           =
                           
                              2
                              16
                           
                        
                      grid points. The numerical experiments show that the orders of convergence of the newly proposed algorithms, Z-WH and Z-S, are no more exponential as in the single-barrier case, but approximately quadratic. We would like to stress that the average number of fixed-point iterations necessary to reach a tolerance of 
                        
                           10
                           
                              −
                              12
                           
                        
                      is as low as 3. Moreover, the newly proposed methods are still slightly more accurate than the CONV, REC and Z-QUAD ones.

Finally, in Table 2 we price a fixed-strike lookback call option written on the maximum and a put option written on the minimum, both with 
                        
                           N
                           =
                           50
                        
                      monitoring dates and 
                        
                           
                              S
                              0
                           
                           =
                           K
                           =
                           1
                        
                     . We assume that the underlying asset evolves as a geometric Brownian motion with the same parameters as in Feng and Linetsky (2009), i.e., 
                        
                           σ
                           =
                           0.3
                           ,
                           
                           r
                           =
                           0.1
                           ,
                           
                           T
                           =
                           0.5
                        
                     . We report the option price and the computational cost of the Z-S approach for different numbers of grid points M. From this table we notice the same exponential convergence of the algorithm as in the single-barrier case.

@&#CONCLUSIONS@&#

In this article we presented a fast and accurate constructive procedure to perform the Wiener-Hopf factorization of a complex function. As a concrete application we considered the pricing of barrier and lookback options, when the monitoring is discrete and the underlying evolves according to an exponential Lévy process. Our procedure is based on the combined use of Hilbert and z-transforms. The numerical implementation exploits the fast Fourier transform and the Euler summation. The computational cost is independent of the number of monitoring dates. In addition, the error decays exponentially with the number of grid points. For the double-barrier case we also introduce a new iterative algorithm based on the Wiener-Hopf factorization. Applications to pricing of exotic derivatives confirm the exponential accuracy of the proposed method. Extensions to other exotic derivatives, like perpetual Bermudan, occupation time, quantile and step options are straightforward combining our method with the Wendel-Port-Dassios identity (Dassios, 1995). Applications of the proposed procedure to other fields such as insurance, queuing theory and fluid mechanics are currently under investigation.

@&#ACKNOWLEDGMENTS@&#

This original research received financial support by the Università degli Studi del Piemonte Orientale. Guido Germano benefitted from a grant by Regione Piemonte and Fondazione Cariplo. The funding of the Systemic Risk Centre by the Economic and Social Research Council (ESRC) is gratefully acknowledged (grant number ES/K002309/1).

Supplementary material associated with this article can be found, in the online version, at 10.1016/j.ejor.2015.11.027
                  


                     
                        
                           Supplementary Data S1
                           
                              Supplementary Raw Research Data. This is open data under the CC BY license http://creativecommons.org/licenses/by/4.0/
                              
                           
                           
                        
                     
                  

@&#REFERENCES@&#

