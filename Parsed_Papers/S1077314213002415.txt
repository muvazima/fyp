@&#MAIN-TITLE@&#Real-time facial shape recovery from a single image under general, unknown lighting by rank relaxation

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose a real-time facial shape recovery algorithm from a single image.


                        
                        
                           
                           An input image is a frontal face under a general, unknown lighting with cast shadow.


                        
                        
                           
                           A bilinear model is linearized by rank relaxation to reduce the time complexity.


                        
                        
                           
                           Faces are accurately reconstructed even if there is a heavy shadow.


                        
                        
                           
                           The method takes average 45ms to reconstruct a 3D face.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Facial shape recovery

Shape from shading

Statistical face model

Bilinear model

Rank relaxation

@&#ABSTRACT@&#


               
               
                  Statistical shape from shading under general light conditions can be thought of as a parameter-fitting problem to a bilinear model. Here, the parameters are personal attributes and light conditions. Parameters of a bilinear model are usually estimated using the alternating least squares method with a computational complexity of 
                        
                           O
                           (
                           
                              
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       s
                                    
                                 
                                 +
                                 
                                    
                                       n
                                    
                                    
                                       ϕ
                                    
                                 
                                 )
                              
                              
                                 2
                              
                           
                           
                              
                                 n
                              
                              
                                 p
                              
                           
                           )
                        
                     , where 
                        
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           ,
                           
                           
                              
                                 n
                              
                              
                                 ϕ
                              
                           
                        
                     , and 
                        
                           
                              
                                 n
                              
                              
                                 p
                              
                           
                        
                      are the dimensions of the light conditions, personal attributes, and face image features, respectively, for each iteration. In this paper, we propose an alternative algorithm with a computational complexity of 
                        
                           O
                           (
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           
                              
                                 n
                              
                              
                                 ϕ
                              
                           
                           )
                        
                      for each iteration. Only the initial step requires a computational complexity of 
                        
                           O
                           (
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           
                              
                                 n
                              
                              
                                 ϕ
                              
                           
                           
                              
                                 n
                              
                              
                                 p
                              
                           
                           )
                        
                     . This can be accomplished by reformulating the problem to that of a linear least squares problem, with a search space limited to a set of rank-one matrices. The rank-one condition is relaxed to obtain a possibly full-rank matrix. The algorithm then finds the best rank-one approximation of that matrix. By the Eckart–Young theorem, the best approximation is the outer product of the left and right singular vectors corresponding to the largest singular value. Since only this pair of singular vectors is needed, it is better to use the power iteration method, which has a computational complexity of 
                        
                           O
                           (
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           
                              
                                 n
                              
                              
                                 ϕ
                              
                           
                           )
                        
                      for each iteration, than calculating the full singular value decomposition. The proposed method provides accurate reconstruction results and takes approximately 45ms on a PC, which is adequate for real-time applications.
               
            

@&#INTRODUCTION@&#

Over the past two decades, model-based approaches in shape from shading (SFS) [1–11] have successfully accommodated the need for an efficient and accurate 3-D reconstruction method without any specialized hardware device. Unlike the early SFS methods [12], these approaches impose model constraints to rule out the ambiguity [13] caused by the ill-posedness of the SFS problems and guarantee a unique solution. Except for a few alternatives, such as the method based on light attenuation [14], the model-based approaches have formed the mainstream of the 3-D reconstruction methods that use a single image, and they are applied in many areas [5,15,16].

However, there are some drawbacks to the model-based approaches. Often they are either too computationally expensive or too restrictive in their application. The most prominent work that falls into the former case is the morphable model (MM) [2], which synthesizes a 3-D face shape by minimizing the difference between a face image and a pre-built statistical model of face shape and texture. The MM is an analysis-by-synthesis approach and is actively studied in the area of computer vision [5,15]. The MM-based methods can simultaneously estimate the pose and appearance of a face in an image, but they usually require heavy computation (e.g., they can take a few minutes to reconstruct a face). Many works belong to the group that are too restrictive, such as the work in [1], which was the first attempt to utilize a model-based approach for 3-D face reconstruction, but failed to achieve high reconstruction accuracy. These methods are applied to fixed-pose images under a single, known light source or a fixed light condition and are relatively faster than MM. However, they are too restrictive to use and some of them perform poorly. Reiter et al. [3] and Lei et al. [6] both find a linear mapping between image and depth, based on the features extracted using canonical correlation analysis (CCA) [17]. Lei et al. used near infrared images as input images to mitigate the effects of illumination changes. They applied N-mode singular value decomposition (SVD) [18], which is a generalization of SVD for multi-dimensional data, as an alternative feature extraction method. These methods cannot handle light variations and so require special light conditions. A statistical model of azimuthal equidistant projection of surface normals is proposed in [7] and is combined with Lambert’s law for optimization. It requires the light source to be known and is vulnerable to large albedo variations. A non-stationary stochastic filtering framework [19] is applied to estimate the albedo and illuminance of a face image in [8] as a preprocessing step for SFS algorithms. However, the original SFS algorithms [12] suffer from the ambiguity mentioned above and require that there be a single light source in an image. Kemelmacher-Shlizerman and Basri [9] proposed a novel approach that adjusts the details of a reference face shape to fit a new image. Despite the advantage that it requires only a single reference shape, its performance is poor.

To overcome these disadvantages, we proposed a tensor-based optimization approach in [10]. We formulated a bilinear model [20–23] of spherical harmonics [24] by using tensor algebra techniques, such as N-mode SVD, to handle general, unknown light conditions. The method offers high reconstruction accuracy, and takes less than half a second on a PC. As is usual for bilinear models, the fitting problem was solved by the alternating least squares (ALS) method [25]. Since each iteration is a linear least square problem in ALS, the computational complexity for each iteration is in the order of 
                        
                           O
                           (
                           
                              
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       s
                                    
                                 
                                 +
                                 
                                    
                                       n
                                    
                                    
                                       ϕ
                                    
                                 
                                 )
                              
                              
                                 2
                              
                           
                           
                              
                                 n
                              
                              
                                 p
                              
                           
                           )
                        
                     , where 
                        
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           ,
                           
                              
                                 n
                              
                              
                                 ϕ
                              
                           
                        
                     , and 
                        
                           
                              
                                 n
                              
                              
                                 p
                              
                           
                        
                      are the dimensions of light conditions, personal attributes, and face image features, respectively.

In this paper, we propose a novel algorithm with a computational complexity 
                        
                           O
                           (
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           
                              
                                 n
                              
                              
                                 ϕ
                              
                           
                           )
                        
                      for each iteration and 
                        
                           O
                           (
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           
                              
                                 n
                              
                              
                                 ϕ
                              
                           
                           
                              
                                 n
                              
                              
                                 p
                              
                           
                           )
                        
                      for the initial step. This is accomplished by reformulating the fitting problem, which becomes a linear least squares problem of a rank-one matrix. By relaxing the rank constraint on the search space, the solution matrix, which may be full rank, can be easily found, and the best rank-one approximation is calculated afterwards. This is somewhat similar to the semidefinite relaxation techniques [26], except that the search space is not limited to the set of symmetric matrices. According to the Eckart–Young theorem [27], the best rank-one approximation is given by the outer product of the right and left singular vectors corresponding to the largest singular value. Since we only need this pair of singular vectors, finding only the largest singular value and its corresponding singular vectors is preferable to calculating the full SVD. This can be done by the power iteration method [28], which is a numerical algorithm that finds the greatest absolute eigenvalue or singular value of a matrix. The computational complexity of the power iteration method is in the order of 
                        
                           O
                           (
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           
                              
                                 n
                              
                              
                                 ϕ
                              
                           
                           )
                        
                      for each iteration, which makes the algorithm more efficient. Only the initial step, which solves the least squares problem by relaxing the constraint, requires a computational complexity of 
                        
                           O
                           (
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           
                              
                                 n
                              
                              
                                 ϕ
                              
                           
                           
                              
                                 n
                              
                              
                                 p
                              
                           
                           )
                        
                     .

After finding the solution, a linear mapping is applied to calculate the corresponding depth map. The proposed method provides accurate reconstruction results and performance similar to that of the method in [10], although the computation time of the proposed method is much lower. The average reconstruction time is approximately 45ms on a PC, which is sufficient for real-time applications.

The remainder of the paper is organized as follows. The basics of tensor algebra are introduced in Section 2, and the proposed algorithm is explained in Section 3. The performance is evaluated in Section 4, and finally, the paper is concluded in Section 5.

In this paper, we use tensor algebra and explanations for standard operations, such as mode-k flattening 
                        
                           
                              
                                 A
                              
                              
                                 (
                                 k
                                 )
                              
                           
                        
                     , mode-k product 
                        
                           A
                           
                              
                                 ×
                              
                              
                                 k
                              
                           
                           M
                        
                     , and N-mode SVD, can be found in [6,18]. In this section, we explain non-standard operations that we use in the rest of the paper.

The reshaping of a tensor is denoted as
                        
                           
                              B
                              =
                              R
                              
                                 
                                    
                                       A
                                       ;
                                       
                                          
                                             n
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             N
                                             ′
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where 
                        
                           A
                           ∈
                           
                              
                                 R
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       1
                                    
                                 
                                 ×
                                 …
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       N
                                    
                                 
                              
                           
                           ,
                           B
                           ∈
                           
                              
                                 R
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 ×
                                 …
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       N
                                       ′
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                        
                     , and 
                        
                           
                              
                                 ∏
                              
                              
                                 l
                              
                              
                                 N
                              
                           
                           
                              
                                 n
                              
                              
                                 l
                              
                           
                           =
                           
                              
                                 ∏
                              
                              
                                 l
                              
                              
                                 N
                                 ′
                              
                           
                           
                              
                                 n
                              
                              
                                 l
                              
                              
                                 ′
                              
                           
                        
                     . Through the reshaping, 
                        
                           
                              
                                 B
                              
                              
                                 
                                    
                                       i
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 …
                                 
                                    
                                       i
                                    
                                    
                                       N
                                       ′
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           =
                           
                              
                                 A
                              
                              
                                 
                                    
                                       i
                                    
                                    
                                       1
                                    
                                 
                                 …
                                 
                                    
                                       i
                                    
                                    
                                       N
                                    
                                 
                              
                           
                        
                      for
                        
                           
                              1
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       N
                                       ′
                                    
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    j
                                 
                                 
                                    ′
                                 
                              
                              -
                              1
                              )
                              
                                 
                                    
                                       ∏
                                    
                                    
                                       l
                                       <
                                       j
                                    
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    l
                                 
                                 
                                    ′
                                 
                              
                              =
                              1
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    j
                                 
                              
                              -
                              1
                              )
                              
                                 
                                    
                                       ∏
                                    
                                    
                                       l
                                       <
                                       j
                                    
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    l
                                 
                              
                              .
                           
                        
                     For Nth-order tensor 
                        
                           A
                        
                     , the mode-1 or mode-N flattenings can be defined by the reshaping operator.
                        
                           
                              
                                 
                                    A
                                 
                                 
                                    (
                                    1
                                    )
                                 
                              
                              =
                              R
                              
                                 
                                    
                                       A
                                       ;
                                       
                                          
                                             n
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                ∏
                                             
                                             
                                                l
                                                >
                                                1
                                             
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             l
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     
                     
                        
                           
                              
                                 
                                    A
                                 
                                 
                                    (
                                    N
                                    )
                                 
                              
                              =
                              R
                              
                                 
                                    
                                       
                                          A
                                          ;
                                          
                                             
                                                
                                                   ∏
                                                
                                                
                                                   l
                                                   <
                                                   N
                                                
                                             
                                          
                                          
                                             
                                                n
                                             
                                             
                                                l
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                N
                                             
                                          
                                       
                                    
                                 
                                 
                                    T
                                 
                              
                              .
                           
                        
                     The vectorization operator can be defined in the following way.
                        
                           
                              vec
                              
                                 
                                    
                                       A
                                    
                                 
                              
                              =
                              R
                              
                                 
                                    
                                       A
                                       ;
                                       
                                          
                                             
                                                ∏
                                             
                                             
                                                l
                                             
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             l
                                          
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

The mode-k product of a tensor can be expressed in terms of the reshaping operator and the Kronecker product. Let
                        
                           
                              B
                              =
                              A
                              
                                 
                                    ×
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    W
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    ×
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    W
                                 
                                 
                                    2
                                 
                              
                              ,
                           
                        
                     where 
                        
                           A
                           ∈
                           
                              
                                 R
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       1
                                    
                                 
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       3
                                    
                                 
                                 ×
                                 …
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       N
                                    
                                 
                              
                           
                           ,
                           B
                           ∈
                           
                              
                                 R
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       3
                                    
                                 
                                 ×
                                 …
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       N
                                    
                                 
                              
                           
                           ,
                           
                              
                                 W
                              
                              
                                 1
                              
                           
                           ∈
                           
                              
                                 R
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       1
                                    
                                 
                              
                           
                        
                     , and 
                        
                           
                              
                                 W
                              
                              
                                 2
                              
                           
                           ∈
                           
                              
                                 R
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        
                     . Then it can be shown after some manipulation that the following relation is satisfied.
                        
                           (1)
                           
                              R
                              
                                 
                                    
                                       B
                                       ;
                                       
                                          
                                             n
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                ∏
                                             
                                             
                                                2
                                                <
                                                l
                                             
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             l
                                          
                                       
                                    
                                 
                              
                              =
                              (
                              
                                 
                                    W
                                 
                                 
                                    2
                                 
                              
                              ⊗
                              
                                 
                                    W
                                 
                                 
                                    1
                                 
                              
                              )
                              R
                              
                                 
                                    
                                       A
                                       ;
                                       
                                          
                                             n
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                ∏
                                             
                                             
                                                2
                                                <
                                                l
                                             
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             l
                                          
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

In this section, we explain the detailed procedure of our algorithm. We model a face image as a bilinear model having two parameter vectors, one for personal attributes and the other for light conditions, and the bases of the model are trained based on samples beforehand. The parameter vector for personal attributes contains abstract information about the appearance of an individual face, which is independent of light condition. After estimating the parameter vectors from an input image using our efficient rank relaxation technique, we perform a linear mapping from the personal attribute vector to the corresponding 3D depth. This linear mapping is also trained beforehand with a set of face images and depth samples. The reconstruction phase is simple enough to allow real-time reconstruction on a regular PC, even though the algorithm achieves the state-of-the-art reconstruction accuracy.

A vector corresponding to a face image in a fixed pose under general lighting can be expressed as
                           
                              
                                 I
                                 =
                                 Hs
                                 ,
                              
                           
                        where 
                           
                              I
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              ,
                              
                              H
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          p
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          s
                                       
                                    
                                 
                              
                           
                        , and 
                           
                              s
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          s
                                       
                                    
                                 
                              
                           
                         are the image vector, basis matrix, and light condition vector, respectively. Let us assume that 
                           
                              H
                           
                         is expressed as a linear model of the personal attribute vector 
                           
                              ϕ
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                    
                                 
                              
                           
                         as
                           
                              (2)
                              
                                 H
                                 =
                                 H
                                 
                                    
                                       ×
                                    
                                    
                                       3
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       T
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              H
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          p
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          s
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                    
                                 
                              
                           
                         is a third-order tensor. Then, the overall image model is expressed as
                           
                              
                                 I
                                 =
                                 
                                    
                                       
                                          H
                                          
                                             
                                                ×
                                             
                                             
                                                3
                                             
                                          
                                          
                                             
                                                ϕ
                                             
                                             
                                                T
                                             
                                          
                                       
                                    
                                 
                                 s
                                 =
                                 H
                                 
                                    
                                       ×
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       s
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       ×
                                    
                                    
                                       3
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       T
                                    
                                 
                                 .
                              
                           
                        
                     

This is a bilinear model [20] of the light condition and the personal attribute.

In order to find the personal attribute vector 
                           
                              ϕ
                           
                         corresponding to an image 
                           
                              I
                           
                        , the following optimization problem should be solved.
                           
                              
                                 
                                    
                                       minimize
                                    
                                    
                                       s
                                       ,
                                       ϕ
                                    
                                 
                                 
                                 
                                    
                                       
                                          
                                             I
                                             -
                                             H
                                             
                                                
                                                   ×
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   s
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   ×
                                                
                                                
                                                   3
                                                
                                             
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   T
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                        
                     

Since the image 
                           
                              I
                           
                         may contain noise terms, it is a good idea to cancel out the noise terms in the cost function as
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Q
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   
                                                      I
                                                      -
                                                      H
                                                      
                                                         
                                                            ×
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      
                                                         
                                                            ×
                                                         
                                                         
                                                            3
                                                         
                                                      
                                                      
                                                         
                                                            ϕ
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Q
                                                
                                                
                                                   T
                                                
                                             
                                             I
                                             -
                                             T
                                             
                                                
                                                   ×
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   s
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   ×
                                                
                                                
                                                   3
                                                
                                             
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   T
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              Q
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          p
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                           
                         (
                           
                              
                                 
                                    m
                                 
                                 
                                    p
                                 
                              
                              <
                              
                                 
                                    n
                                 
                                 
                                    p
                                 
                              
                           
                        ) is an orthogonal matrix, and 
                           
                              T
                              =
                              H
                              
                                 
                                    ×
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    T
                                 
                              
                           
                        . 
                           
                              Q
                           
                         needs to be chosen such that the first mode of 
                           
                              H
                           
                         is mainly distributed on the space spanned by the columns of 
                           
                              Q
                           
                        . We can find 
                           
                              Q
                           
                         using principal component analysis [29], SVD, or some other similar subspace analysis method.

The cost function in the above equation is a fourth-degree polynomial, and is usually solved by the ALS algorithm [10,20]. However, this can be reformulated as a second-degree polynomial if we let 
                           
                              X
                              =
                              s
                              
                                 
                                    ϕ
                                 
                                 
                                    T
                                 
                              
                           
                        , i.e.,
                           
                              (3)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   minimize
                                                
                                                
                                                   X
                                                
                                             
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               Q
                                                            
                                                            
                                                               T
                                                            
                                                         
                                                         I
                                                         -
                                                         
                                                            
                                                               T
                                                            
                                                            
                                                               (
                                                               1
                                                               )
                                                            
                                                         
                                                         vec
                                                         
                                                            
                                                               
                                                                  X
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             subject to
                                             
                                          
                                       
                                       
                                          
                                             X
                                             =
                                             s
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   T
                                                
                                             
                                             ∈
                                             
                                                
                                                   R
                                                
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   ×
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         ϕ
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          s
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                    
                                 
                              
                           
                         is the set of 
                           
                              
                                 
                                    n
                                 
                                 
                                    s
                                 
                              
                              ×
                              
                                 
                                    n
                                 
                                 
                                    ϕ
                                 
                              
                           
                         rank-one matrices. This is a linear-least-square problem with a rank constraint, to which the solution may be obtained with reduced computational complexity.


                        
                           
                              T
                           
                         is a model coefficient tensor derived from the basis matrices 
                           
                              H
                           
                         of all subjects. Possible candidates for 
                           
                              H
                           
                         are scaled surface normals or spherical harmonics [24]. However, these cannot handle cast shadows, and so an alternative basis that can deal with cast shadows is sought.

For this, 
                           
                              
                                 
                                    m
                                 
                                 
                                    s
                                 
                              
                           
                         images that contain cast shadows are rendered for each subject. Firstly, 
                           
                              
                                 
                                    m
                                 
                                 
                                    s
                                 
                              
                           
                         distinct point light sources have to be determined. The direction of each light source may be chosen randomly, but it is better to distribute the directions evenly. This can be done by evenly distributing 
                           
                              2
                              
                                 
                                    m
                                 
                                 
                                    s
                                 
                              
                           
                         points on a unit sphere, and selecting only 
                           
                              
                                 
                                    m
                                 
                                 
                                    s
                                 
                              
                           
                         points that are on the upper hemisphere. Sampling of evenly distributed points on a sphere can be done in two different ways [30]: We may randomly spread particles carrying a unit charge on a sphere with a frictional surface, and then find an equilibrium state for the particles. Or more simply, we may slightly move two particles that are the smallest distance apart in opposite directions, normalize each new position to a unit vector, and repeat this process until the particles reach an equilibrium state. After this, a light direction can be obtained from each of these points to the center of the sphere.

After sampling the light directions, we render the images containing cast shadows. Each point light source is assumed to be at infinity and have unit intensity. The depth map of each subject is differentiated, normalized, and multiplied by the corresponding albedo map to obtain the corresponding scaled surface normals, and the inner product of the scaled surface normal and the light source vector is calculated for each pixel. If the outcome of an inner product is negative, the pixel is in an attached shadow, and its value is set to zero. In order to find the pixels under cast shadows, a triangle mesh is created based on the depth map of each subject. Then, each pixel is checked to see whether it is occluded from the light source by any other triangles, and a kd-tree [31] is used to accelerate the checking process. The pixels found under cast shadows are again set to zero.

Combining all the results of the rendering process, a fourth-order tensor 
                           
                              G
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          x
                                       
                                    
                                    ×
                                    
                                       
                                          m
                                       
                                       
                                          y
                                       
                                    
                                    ×
                                    
                                       
                                          m
                                       
                                       
                                          s
                                       
                                    
                                    ×
                                    
                                       
                                          m
                                       
                                       
                                          ϕ
                                       
                                    
                                 
                              
                           
                         is created. Note that 
                           
                              
                                 
                                    m
                                 
                                 
                                    x
                                 
                              
                              
                                 
                                    m
                                 
                                 
                                    y
                                 
                              
                              =
                              
                                 
                                    m
                                 
                                 
                                    p
                                 
                              
                           
                         and 
                           
                              
                                 
                                    G
                                 
                                 
                                    ijkl
                                 
                              
                           
                         correspond to the 
                           
                              (
                              i
                              ,
                              j
                              )
                           
                        th pixel of the lth subject under the kth light direction. Since 
                           
                              G
                           
                         contains redundant information, N-mode SVD is applied to 
                           
                              G
                           
                        , and unimportant dimensions are truncated to yield
                           
                              (4)
                              
                                 G
                                 ≈
                                 C
                                 
                                    
                                       ×
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                 
                                 
                                    
                                       ×
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                 
                                 
                                    
                                       ×
                                    
                                    
                                       3
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       s
                                    
                                 
                                 
                                    
                                       ×
                                    
                                    
                                       4
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       ϕ
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              C
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          y
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          s
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                    
                                 
                              
                           
                         is the core tensor, and 
                           
                              
                                 
                                    U
                                 
                                 
                                    x
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          x
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                    
                                 
                              
                              ,
                              
                              
                                 
                                    U
                                 
                                 
                                    y
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          y
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          y
                                       
                                    
                                 
                              
                              ,
                              
                              
                                 
                                    U
                                 
                                 
                                    s
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          s
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          s
                                       
                                    
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    U
                                 
                                 
                                    ϕ
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          ϕ
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                    
                                 
                              
                           
                         are the mode matrices. Note that 
                           
                              
                                 
                                    n
                                 
                                 
                                    x
                                 
                              
                              ⩽
                              
                                 
                                    m
                                 
                                 
                                    x
                                 
                              
                              ,
                              
                                 
                                    n
                                 
                                 
                                    y
                                 
                              
                              ⩽
                              
                                 
                                    m
                                 
                                 
                                    y
                                 
                              
                              ,
                              
                                 
                                    n
                                 
                                 
                                    s
                                 
                              
                              ⩽
                              
                                 
                                    m
                                 
                                 
                                    s
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    n
                                 
                                 
                                    ϕ
                                 
                              
                              ⩽
                              
                                 
                                    m
                                 
                                 
                                    ϕ
                                 
                              
                           
                        . Based on this result, 
                           
                              H
                           
                         is calculated as
                           
                              
                                 H
                                 =
                                 R
                                 
                                    
                                       
                                          C
                                          
                                             
                                                ×
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                x
                                             
                                          
                                          
                                             
                                                ×
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                y
                                             
                                          
                                          ;
                                          
                                             
                                                m
                                             
                                             
                                                p
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                s
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                ϕ
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Note that the row vectors of 
                           
                              
                                 
                                    U
                                 
                                 
                                    s
                                 
                              
                           
                         and 
                           
                              
                                 
                                    U
                                 
                                 
                                    ϕ
                                 
                              
                           
                         correspond to the light condition vectors 
                           
                              
                                 
                                    s
                                 
                                 
                                    T
                                 
                              
                           
                         and the personal attribute vectors 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    T
                                 
                              
                           
                         for the rendered images, respectively. This process attempts to model non-local shadowing effects using statistical samples, which is somewhat related to the ‘apparent BRDF’ approach in [37].

In order to find 
                           
                              Q
                           
                         in (3), SVD is performed on 
                           
                              R
                              
                                 
                                    
                                       G
                                       ;
                                       
                                          
                                             m
                                          
                                          
                                             p
                                          
                                       
                                       ,
                                       
                                          
                                             m
                                          
                                          
                                             s
                                          
                                       
                                       
                                          
                                             m
                                          
                                          
                                             ϕ
                                          
                                       
                                    
                                 
                              
                           
                        , but it is very time consuming because the number of elements are very large (12,000×40,000 in the experiment described in Section 4). Fortunately, from (1) and (4), the approximate result of SVD can be found more easily as
                           
                              
                                 R
                                 
                                    
                                       
                                          G
                                          ;
                                          
                                             
                                                m
                                             
                                             
                                                p
                                             
                                          
                                          ,
                                          
                                             
                                                m
                                             
                                             
                                                s
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                ϕ
                                             
                                          
                                       
                                    
                                 
                                 ≈
                                 R
                                 
                                    
                                       
                                          C
                                          
                                             
                                                ×
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                x
                                             
                                          
                                          
                                             
                                                ×
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                y
                                             
                                          
                                          
                                             
                                                ×
                                             
                                             
                                                3
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                s
                                             
                                          
                                          
                                             
                                                ×
                                             
                                             
                                                4
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                ϕ
                                             
                                          
                                          ;
                                          
                                             
                                                m
                                             
                                             
                                                p
                                             
                                          
                                          ,
                                          
                                             
                                                m
                                             
                                             
                                                s
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                ϕ
                                             
                                          
                                       
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                 
                                 ⊗
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                 
                                 )
                                 R
                                 
                                    
                                       
                                          C
                                          ;
                                          
                                             
                                                n
                                             
                                             
                                                x
                                             
                                          
                                          
                                             
                                                n
                                             
                                             
                                                y
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                s
                                             
                                          
                                          
                                             
                                                n
                                             
                                             
                                                ϕ
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             U
                                          
                                          
                                             ϕ
                                          
                                       
                                       ⊗
                                       
                                          
                                             U
                                          
                                          
                                             s
                                          
                                       
                                       )
                                    
                                    
                                       T
                                    
                                 
                                 ≈
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                 
                                 ⊗
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                 
                                 )
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       Λ
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             U
                                          
                                          
                                             ϕ
                                          
                                       
                                       ⊗
                                       
                                          
                                             U
                                          
                                          
                                             s
                                          
                                       
                                       )
                                    
                                    
                                       T
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              R
                              
                                 
                                    
                                       C
                                       ;
                                       
                                          
                                             n
                                          
                                          
                                             x
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             y
                                          
                                       
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             s
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             ϕ
                                          
                                       
                                    
                                 
                              
                              ≈
                              
                                 
                                    U
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    Λ
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    V
                                 
                                 
                                    c
                                 
                                 
                                    T
                                 
                              
                           
                         is the truncated SVD, and 
                           
                              
                                 
                                    U
                                 
                                 
                                    c
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                    
                                    
                                       
                                          n
                                       
                                       
                                          y
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                           
                        . The size of 
                           
                              R
                              
                                 
                                    
                                       C
                                       ;
                                       
                                          
                                             n
                                          
                                          
                                             x
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             y
                                          
                                       
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             s
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             ϕ
                                          
                                       
                                    
                                 
                              
                           
                         is 
                           
                              
                                 
                                    n
                                 
                                 
                                    x
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    y
                                 
                              
                              ×
                              
                                 
                                    n
                                 
                                 
                                    s
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    ϕ
                                 
                              
                           
                        , which is much smaller than 
                           
                              
                                 
                                    m
                                 
                                 
                                    p
                                 
                              
                              ×
                              
                                 
                                    m
                                 
                                 
                                    s
                                 
                              
                              
                                 
                                    m
                                 
                                 
                                    ϕ
                                 
                              
                           
                        , so the calculation can be performed much faster. It is readily verified from the following relation that the mode matrix 
                           
                              (
                              
                                 
                                    U
                                 
                                 
                                    y
                                 
                              
                              ⊗
                              
                                 
                                    U
                                 
                                 
                                    x
                                 
                              
                              )
                              
                                 
                                    U
                                 
                                 
                                    c
                                 
                              
                           
                         is orthogonal.
                           
                              
                                 
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   U
                                                
                                                
                                                   y
                                                
                                             
                                             ⊗
                                             
                                                
                                                   U
                                                
                                                
                                                   x
                                                
                                             
                                             )
                                             
                                                
                                                   U
                                                
                                                
                                                   c
                                                
                                             
                                          
                                       
                                    
                                    
                                       T
                                    
                                 
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                 
                                 ⊗
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                 
                                 )
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             U
                                          
                                          
                                             y
                                          
                                       
                                       ⊗
                                       
                                          
                                             U
                                          
                                          
                                             x
                                          
                                       
                                       )
                                    
                                    
                                       T
                                    
                                 
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                 
                                 ⊗
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                 
                                 )
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                    
                                       T
                                    
                                 
                                 ⊗
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                    
                                       T
                                    
                                 
                                 )
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                 
                                 ⊗
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                 
                                 )
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                 
                                 ⊗
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                 
                                 )
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 (
                                 E
                                 ⊗
                                 E
                                 )
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       EU
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 E
                                 ,
                              
                           
                        where 
                           
                              E
                           
                         is an identity matrix. The orthogonality of 
                           
                              (
                              
                                 
                                    U
                                 
                                 
                                    ϕ
                                 
                              
                              ⊗
                              
                                 
                                    U
                                 
                                 
                                    s
                                 
                              
                              )
                              
                                 
                                    V
                                 
                                 
                                    c
                                 
                              
                           
                         can be proved similarly. Therefore, the orthogonal matrix 
                           
                              Q
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          p
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                           
                         can be set as 
                           
                              Q
                              =
                              (
                              
                                 
                                    U
                                 
                                 
                                    y
                                 
                              
                              ⊗
                              
                                 
                                    U
                                 
                                 
                                    x
                                 
                              
                              )
                              
                                 
                                    U
                                 
                                 
                                    c
                                 
                              
                           
                        .

Finally, the relation 
                           
                              T
                              =
                              H
                              
                                 
                                    ×
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    T
                                 
                              
                           
                         gives
                           
                              
                                 T
                                 =
                                 R
                                 
                                    
                                       
                                          C
                                          
                                             
                                                ×
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                x
                                             
                                          
                                          
                                             
                                                ×
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                y
                                             
                                          
                                          ;
                                          
                                             
                                                m
                                             
                                             
                                                p
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                s
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                ϕ
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       ×
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                    
                                       T
                                    
                                 
                                 ⊗
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                    
                                       T
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          R
                                          
                                             
                                                
                                                   C
                                                   ;
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         ϕ
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ×
                                             
                                             
                                                1
                                             
                                          
                                          (
                                          
                                             
                                                U
                                             
                                             
                                                y
                                             
                                          
                                          ⊗
                                          
                                             
                                                U
                                             
                                             
                                                x
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       ×
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                    
                                       T
                                    
                                 
                                 ⊗
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                    
                                       T
                                    
                                 
                                 )
                                 =
                                 R
                                 
                                    
                                       
                                          C
                                          ;
                                          
                                             
                                                n
                                             
                                             
                                                x
                                             
                                          
                                          
                                             
                                                n
                                             
                                             
                                                y
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                s
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                ϕ
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       ×
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                U
                                             
                                             
                                                c
                                             
                                             
                                                T
                                             
                                          
                                          (
                                          
                                             
                                                U
                                             
                                             
                                                y
                                             
                                             
                                                T
                                             
                                          
                                          ⊗
                                          
                                             
                                                U
                                             
                                             
                                                x
                                             
                                             
                                                T
                                             
                                          
                                          )
                                          (
                                          
                                             
                                                U
                                             
                                             
                                                y
                                             
                                          
                                          ⊗
                                          
                                             
                                                U
                                             
                                             
                                                x
                                             
                                          
                                          )
                                       
                                    
                                 
                                 =
                                 R
                                 
                                    
                                       
                                          C
                                          ;
                                          
                                             
                                                n
                                             
                                             
                                                x
                                             
                                          
                                          
                                             
                                                n
                                             
                                             
                                                y
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                s
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                ϕ
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       ×
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 .
                              
                           
                        
                     

The goal of this paper is to reconstruct a 3-D shape that corresponds to a face image, and a depth model is also needed. Let 
                           
                              D
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          x
                                       
                                    
                                    ×
                                    
                                       
                                          m
                                       
                                       
                                          y
                                       
                                    
                                    ×
                                    
                                       
                                          m
                                       
                                       
                                          ϕ
                                       
                                    
                                 
                              
                           
                         be a third-order tensor, and its element 
                           
                              
                                 
                                    D
                                 
                                 
                                    ijk
                                 
                              
                           
                         is the 
                           
                              (
                              i
                              ,
                              j
                              )
                           
                        th depth value of the kth subject. Then, by performing N-mode SVD and truncating, we have
                           
                              (5)
                              
                                 D
                                 ≈
                                 L
                                 
                                    
                                       ×
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       x
                                    
                                 
                                 
                                    
                                       ×
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       y
                                    
                                 
                                 
                                    
                                       ×
                                    
                                    
                                       3
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       ϕ
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              L
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                       
                                          ′
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          y
                                       
                                       
                                          ′
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                         is the core tensor, and 
                           
                              
                                 
                                    V
                                 
                                 
                                    x
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          x
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    V
                                 
                                 
                                    y
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          y
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          y
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    V
                                 
                                 
                                    ϕ
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          ϕ
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                         are the mode matrices. A depth vector 
                           
                              d
                           
                         is expressed as
                           
                              
                                 d
                                 =
                                 W
                                 
                                    
                                       ϕ
                                    
                                    
                                       d
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              W
                              =
                              R
                              
                                 
                                    
                                       L
                                       
                                          
                                             ×
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             V
                                          
                                          
                                             x
                                          
                                       
                                       
                                          
                                             ×
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             V
                                          
                                          
                                             y
                                          
                                       
                                       ;
                                       
                                          
                                             m
                                          
                                          
                                             p
                                          
                                       
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             ϕ
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    d
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                         is the personal attribute vector for 
                           
                              d
                           
                        . Note that each row vector of 
                           
                              
                                 
                                    V
                                 
                                 
                                    ϕ
                                 
                              
                           
                         corresponds to 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    d
                                 
                                 
                                    T
                                 
                              
                           
                         of each subject.

Because geometric normalization of images and depths is important for the accuracy of the proposed scheme, a simple affine transform or active appearance model [32] may be used. In this paper, all the images and depths are affine-transformed before the first step of the proposed scheme is performed; this would ensure that the center of each pupil and the center of the mouth are located at the designated locations in 2-D coordinates. It should be noted that the rendering process for the 
                           
                              
                                 
                                    m
                                 
                                 
                                    s
                                 
                              
                           
                         images for each training subject is done before the affine transformation. The coordinates of the center of each pupil and the center of the mouth are assumed to be known by using other feature detection tools.

Now that we have explained how to calculate all the necessary terms, we will discuss how to solve the optimization problem, (3). If the rank constraint on 
                           
                              X
                           
                         is relaxed, then the solution 
                           
                              
                                 
                                    X
                                 
                                 
                                    ∗
                                 
                              
                           
                         can be readily found as
                           
                              
                                 vec
                                 
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                ∗
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                    
                                       +
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                T
                                             
                                          
                                          I
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    T
                                 
                                 
                                    (
                                    1
                                    )
                                 
                                 
                                    +
                                 
                              
                           
                         is the Moore–Penrose pseudo-inverse of 
                           
                              
                                 
                                    T
                                 
                                 
                                    (
                                    1
                                    )
                                 
                              
                           
                        , which can be pre-computed. Here, 
                           
                              
                                 
                                    X
                                 
                                 
                                    ∗
                                 
                              
                           
                         will generally be a full-rank matrix, and 
                           
                              
                                 
                                    s
                                 
                                 
                                    ∗
                                 
                              
                           
                         and 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    ∗
                                 
                              
                           
                         can be found as the best rank-one approximation of 
                           
                              
                                 
                                    X
                                 
                                 
                                    ∗
                                 
                              
                           
                        , that is, 
                           
                              
                                 
                                    X
                                 
                                 
                                    ∗
                                 
                              
                              ≈
                              
                                 
                                    s
                                 
                                 
                                    ∗
                                 
                              
                              
                                 
                                    ϕ
                                 
                                 
                                    ∗
                                    T
                                 
                              
                           
                        .

According to the Eckart–Young theorem, 
                           
                              
                                 
                                    s
                                 
                                 
                                    ∗
                                 
                              
                           
                         and 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    ∗
                                 
                              
                           
                         are the left and right singular vectors that correspond to the largest singular value, and SVD may be performed on 
                           
                              
                                 
                                    X
                                 
                                 
                                    ∗
                                 
                              
                           
                         to find them. Nevertheless, the power iteration method is more efficient because we only need the pair of singular vectors. Therefore, the following step is repeatedly calculated until convergence, with the initial value 
                           
                              ϕ
                              ←
                              μ
                              =
                              E
                              [
                              ϕ
                              ]
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          ϕ
                                       
                                    
                                 
                              
                              
                                 
                                    U
                                 
                                 
                                    ϕ
                                 
                                 
                                    T
                                 
                              
                              1
                           
                        , where 
                           
                              1
                           
                         is a vector of ones.
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             s
                                             ←
                                             
                                                
                                                   X
                                                
                                                
                                                   ∗
                                                
                                             
                                             ϕ
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             s
                                             ←
                                             s
                                             /
                                             ‖
                                             s
                                             ‖
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ϕ
                                             ←
                                             
                                                
                                                   X
                                                
                                                
                                                   *
                                                   T
                                                
                                             
                                             s
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ϕ
                                             ←
                                             ϕ
                                             /
                                             ‖
                                             ϕ
                                             ‖
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

This iterative procedure can find 
                           
                              
                                 
                                    s
                                 
                                 
                                    ∗
                                 
                              
                           
                         and 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    ∗
                                 
                              
                           
                         up to a scale factor, and hence, we have to find a proper scale for 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    ∗
                                 
                              
                           
                        . Let us look into the covariance matrix
                           
                              
                                 
                                    
                                       S
                                    
                                    
                                       ϕ
                                    
                                 
                                 =
                                 E
                                 [
                                 ϕ
                                 
                                    
                                       ϕ
                                    
                                    
                                       T
                                    
                                 
                                 ]
                                 -
                                 E
                                 [
                                 ϕ
                                 ]
                                 E
                                 
                                    
                                       [
                                       ϕ
                                       ]
                                    
                                    
                                       T
                                    
                                 
                                 ≈
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             ϕ
                                          
                                       
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       ϕ
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       ϕ
                                    
                                 
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             ϕ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       ϕ
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       11
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       ϕ
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             ϕ
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          E
                                          -
                                          
                                             
                                                1
                                             
                                             
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ϕ
                                                   
                                                
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                ϕ
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                11
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                ϕ
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        of 
                           
                              ϕ
                           
                        . If the span of the orthogonal matrix 
                           
                              
                                 
                                    U
                                 
                                 
                                    ϕ
                                 
                              
                           
                         in (4) contains 
                           
                              1
                           
                        , then 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                U
                                             
                                             
                                                ϕ
                                             
                                             
                                                T
                                             
                                          
                                          1
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              =
                              
                                 
                                    m
                                 
                                 
                                    ϕ
                                 
                              
                           
                         and 
                           
                              
                                 
                                    S
                                 
                                 
                                    ϕ
                                 
                              
                           
                         will be singular. The face images of a subject are very similar to those of another subject; hence, the mean vector 
                           
                              μ
                           
                         of personal attributes will be the dominating component in (2). This means that 
                           
                              1
                           
                         will likely be contained in the span of 
                           
                              
                                 
                                    U
                                 
                                 
                                    ϕ
                                 
                              
                           
                        . Accordingly, the null space of 
                           
                              
                                 
                                    S
                                 
                                 
                                    ϕ
                                 
                              
                           
                         is the space spanned by the vector 
                           
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          ϕ
                                       
                                    
                                 
                              
                              
                                 
                                    U
                                 
                                 
                                    ϕ
                                 
                                 
                                    T
                                 
                              
                              1
                              =
                              μ
                           
                        , which is the mean of 
                           
                              ϕ
                           
                        . This implies that the variance of 
                           
                              ϕ
                           
                         along the 
                           
                              μ
                           
                         direction is zero, and consequently, the orthogonal projection of 
                           
                              ϕ
                           
                         on the null space of 
                           
                              
                                 
                                    S
                                 
                                 
                                    ϕ
                                 
                              
                           
                         is the same as 
                           
                              μ
                           
                        . Therefore, 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    ∗
                                 
                              
                           
                         is scaled as
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   ∗
                                                
                                             
                                             ←
                                             b
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   ∗
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             b
                                             =
                                             
                                                
                                                   
                                                      
                                                         μ
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         μ
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   
                                                      
                                                         ϕ
                                                      
                                                      
                                                         ∗
                                                      
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Likewise, 
                           
                              
                                 
                                    s
                                 
                                 
                                    ∗
                                 
                              
                           
                         is scaled as
                           
                              
                                 
                                    
                                       s
                                    
                                    
                                       ∗
                                    
                                 
                                 ←
                                 
                                    
                                       s
                                    
                                    
                                       ∗
                                    
                                 
                                 /
                                 b
                                 .
                              
                           
                        
                     

One of the advantages of the proposed algorithm is that it does not need to calculate the detailed information on the light condition of the input image for 3-D reconstruction, unlike the analysis-by-synthesis approaches such as the MM [2]. In this perspective, the proposed algorithm can be seen as a compromise between discriminative and generative approaches. Since we do not need to determine the detailed information, it can be more robust than the analysis-by-synthesis approaches which can be vulnerable to the error in light estimation. Nonetheless, if the detailed information is needed, we can find it using the linear programming. Let 
                           
                              
                                 
                                    s
                                 
                                 
                                    0
                                 
                              
                           
                         be the light intensity vector whose element is the light intensity of each light direction. Then 
                           
                              
                                 
                                    s
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    U
                                 
                                 
                                    s
                                 
                              
                              
                                 
                                    s
                                 
                                 
                                    ∗
                                 
                              
                              +
                              
                                 
                                    U
                                 
                                 
                                    s
                                 
                                 
                                    ⊥
                                 
                              
                              
                                 
                                    s
                                 
                                 
                                    ′
                                 
                              
                           
                         for an unknown vector 
                           
                              
                                 
                                    s
                                 
                                 
                                    ′
                                 
                              
                           
                        , where 
                           
                              
                                 
                                    U
                                 
                                 
                                    s
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    U
                                 
                                 
                                    s
                                 
                                 
                                    ⊥
                                 
                              
                              =
                              0
                           
                        . Since light intensity should be nonnegative, the following linear programming problem can be formulated.
                           
                              (6)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   minimize
                                                
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   U
                                                
                                                
                                                   s
                                                
                                                
                                                   ⊥
                                                
                                             
                                             
                                                
                                                   s
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             subject to
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   U
                                                
                                                
                                                   s
                                                
                                             
                                             
                                                
                                                   s
                                                
                                                
                                                   ∗
                                                
                                             
                                             +
                                             
                                                
                                                   U
                                                
                                                
                                                   s
                                                
                                                
                                                   ⊥
                                                
                                             
                                             
                                                
                                                   s
                                                
                                                
                                                   ′
                                                
                                             
                                             ⪰
                                             0
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              ⪰
                           
                         is the element-wise inequality. By pre-multiplying 
                           
                              
                                 
                                    1
                                 
                                 
                                    T
                                 
                              
                           
                         to the constraint inequality, we obtain the inequality 
                           
                              
                                 
                                    1
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    U
                                 
                                 
                                    s
                                 
                                 
                                    ⊥
                                 
                              
                              
                                 
                                    s
                                 
                                 
                                    ′
                                 
                              
                              ⩾
                              -
                              
                                 
                                    1
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    U
                                 
                                 
                                    s
                                 
                              
                              
                                 
                                    s
                                 
                                 
                                    ∗
                                 
                              
                           
                        , which is the lower bound of the object function. Since it is a linear programming problem, this implies that there exists a finite optimal solution if there is at least one feasible solution.

Let us find a linear mapping from 
                           
                              ϕ
                           
                         to 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    d
                                 
                              
                           
                        , which minimizes the following cost function:
                           
                              
                                 F
                                 =
                                 E
                                 
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ϕ
                                                         
                                                         
                                                            d
                                                         
                                                      
                                                      -
                                                      P
                                                      ϕ
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              P
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                       
                                          ′
                                       
                                    
                                    ×
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                    
                                 
                              
                           
                        . By setting the derivative of F to zero, we find the optimal solution 
                           
                              
                                 
                                    P
                                 
                                 
                                    ∗
                                 
                              
                           
                        .
                           
                              
                                 
                                    
                                       P
                                    
                                    
                                       ∗
                                    
                                 
                                 =
                                 E
                                 
                                    
                                       
                                          
                                             
                                                ϕ
                                             
                                             
                                                d
                                             
                                          
                                          
                                             
                                                ϕ
                                             
                                             
                                                T
                                             
                                          
                                       
                                    
                                 
                                 E
                                 
                                    
                                       
                                          
                                             ϕ
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   T
                                                
                                             
                                          
                                       
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       V
                                    
                                    
                                       ϕ
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       ϕ
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   U
                                                
                                                
                                                   ϕ
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   U
                                                
                                                
                                                   ϕ
                                                
                                             
                                          
                                       
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       V
                                    
                                    
                                       ϕ
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       ϕ
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       V
                                    
                                    
                                       ϕ
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       ϕ
                                    
                                 
                                 .
                              
                           
                        
                     

The overall procedure for the proposed method is composed of two parts, model building and reconstruction, which are summarized as follows:


                        [Model building]
                        
                           
                              1.
                              Sample m evenly distributed points on an upper hemisphere using the method in [30]. For each training subject and light direction, render an image containing cast shadow as described in Section 3.2. Form tensor 
                                    
                                       G
                                    
                                  with all the images.

Perform N-mode SVD on 
                                    
                                       G
                                    
                                  and truncate unimportant dimensions, as shown in (4). Again, perform SVD and truncate the unimportant dimensions, which results in 
                                    
                                       R
                                       
                                          
                                             
                                                C
                                                ;
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      y
                                                   
                                                
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      x
                                                   
                                                
                                                ,
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      s
                                                   
                                                
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ϕ
                                                   
                                                
                                             
                                          
                                       
                                       ≈
                                       
                                          
                                             U
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             Λ
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             V
                                          
                                          
                                             c
                                          
                                          
                                             T
                                          
                                       
                                    
                                 . Calculate 
                                    
                                       Q
                                       =
                                       (
                                       
                                          
                                             U
                                          
                                          
                                             y
                                          
                                       
                                       ⊗
                                       
                                          
                                             U
                                          
                                          
                                             x
                                          
                                       
                                       )
                                       
                                          
                                             U
                                          
                                          
                                             c
                                          
                                       
                                    
                                  and 
                                    
                                       T
                                       =
                                       R
                                       
                                          
                                             
                                                C
                                                ;
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      y
                                                   
                                                
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      x
                                                   
                                                
                                                ,
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      s
                                                   
                                                
                                                ,
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ϕ
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             ×
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             U
                                          
                                          
                                             c
                                          
                                          
                                             T
                                          
                                       
                                    
                                 . Find the mean 
                                    
                                       μ
                                       =
                                       
                                          
                                             1
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ϕ
                                                
                                             
                                          
                                       
                                       
                                          
                                             U
                                          
                                          
                                             ϕ
                                          
                                          
                                             T
                                          
                                       
                                       1
                                    
                                 , and pre-compute 
                                    
                                       
                                          
                                             T
                                          
                                          
                                             (
                                             1
                                             )
                                          
                                          
                                             +
                                          
                                       
                                    
                                 .

Perform N-mode SVD on the depth tensor 
                                    
                                       D
                                    
                                 , and truncate the unimportant dimensions, as shown in (5). Calculate 
                                    
                                       W
                                       =
                                       R
                                       
                                          
                                             
                                                L
                                                
                                                   
                                                      ×
                                                   
                                                   
                                                      1
                                                   
                                                
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      x
                                                   
                                                
                                                
                                                   
                                                      ×
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      y
                                                   
                                                
                                                ;
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      p
                                                   
                                                
                                                ,
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ϕ
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 .

Calculate 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             ∗
                                          
                                       
                                       =
                                       
                                          
                                             V
                                          
                                          
                                             ϕ
                                          
                                          
                                             T
                                          
                                       
                                       
                                          
                                             U
                                          
                                          
                                             ϕ
                                          
                                       
                                    
                                 .


                        [Reconstruction]
                        
                           
                              1.
                              Compute 
                                    
                                       vec
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                             
                                          
                                       
                                       =
                                       
                                          
                                             T
                                          
                                          
                                             (
                                             1
                                             )
                                          
                                          
                                             +
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      T
                                                   
                                                
                                                I
                                             
                                          
                                       
                                    
                                 .

Set initial 
                                    
                                       ϕ
                                    
                                  as 
                                    
                                       ϕ
                                       ←
                                       μ
                                    
                                 .

Update 
                                    
                                       s
                                    
                                  as 
                                    
                                       s
                                       ←
                                       X
                                       ϕ
                                    
                                  and 
                                    
                                       s
                                       ←
                                       s
                                       /
                                       ‖
                                       s
                                       ‖
                                    
                                 .

Update 
                                    
                                       ϕ
                                    
                                  as 
                                    
                                       ϕ
                                       ←
                                       
                                          
                                             X
                                          
                                          
                                             T
                                          
                                       
                                       s
                                    
                                  and 
                                    
                                       ϕ
                                       ←
                                       ϕ
                                       /
                                       
                                          
                                             
                                                ϕ
                                             
                                          
                                       
                                    
                                 .

Repeat Steps 3 and 4 until convergence.

Scale 
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             ∗
                                          
                                       
                                    
                                  as 
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             ∗
                                          
                                       
                                       ←
                                       b
                                       
                                          
                                             ϕ
                                          
                                          
                                             ∗
                                          
                                       
                                    
                                 , where 
                                    
                                       b
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         μ
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         μ
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   ϕ
                                                
                                             
                                          
                                          
                                             ∗
                                          
                                       
                                    
                                 .

The depth is calculated as 
                                    
                                       d
                                       =
                                       W
                                       
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                                ϕ
                                             
                                          
                                       
                                    
                                 .

(Optional) Scale 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ∗
                                          
                                       
                                    
                                  as 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ∗
                                          
                                       
                                       ←
                                       
                                          
                                             s
                                          
                                          
                                             ∗
                                          
                                       
                                       /
                                       b
                                    
                                 .

(Optional) Solve the linear programming problem in (6) to find the light condition 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             0
                                          
                                       
                                    
                                  of image 
                                    
                                       I
                                    
                                 .

We now focus our attention on the reconstruction procedure. Here we can see that the computational complexity of the initial step, Step 1, is 
                           
                              O
                              (
                              
                                 
                                    n
                                 
                                 
                                    s
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    ϕ
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    p
                                 
                              
                              )
                           
                        . In each iteration, Steps 3 and 4 take 
                           
                              O
                              (
                              
                                 
                                    n
                                 
                                 
                                    s
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    ϕ
                                 
                              
                              )
                           
                        . In the experiments described in Section 4, it took between 10 and 20 iterations to achieve convergence. Hence, the initial step (Step 4) takes most of the time in the reconstruction process. If ALS is used instead, then each iteration takes 
                           
                              O
                              (
                              
                                 
                                    (
                                    
                                       
                                          n
                                       
                                       
                                          s
                                       
                                    
                                    +
                                    
                                       
                                          n
                                       
                                       
                                          ϕ
                                       
                                    
                                    )
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    p
                                 
                              
                              )
                           
                        , which is much larger than the proposed algorithm. Therefore, the rank relaxation technique proposed in this paper is efficient and can hence achieve fast computation.

It is noted that 
                           
                              
                                 
                                    Q
                                 
                                 
                                    T
                                 
                              
                              I
                           
                         in Step 1 can be more efficiently calculated as
                           
                              
                                 
                                    
                                       Q
                                    
                                    
                                       T
                                    
                                 
                                 I
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       y
                                    
                                    
                                       T
                                    
                                 
                                 ⊗
                                 
                                    
                                       U
                                    
                                    
                                       x
                                    
                                    
                                       T
                                    
                                 
                                 )
                                 vec
                                 
                                    
                                       
                                          R
                                          
                                             
                                                
                                                   I
                                                   ;
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       c
                                    
                                    
                                       T
                                    
                                 
                                 vec
                                 
                                    
                                       
                                          
                                             
                                                U
                                             
                                             
                                                x
                                             
                                             
                                                T
                                             
                                          
                                          R
                                          
                                             
                                                
                                                   I
                                                   ;
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                U
                                             
                                             
                                                y
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Similarly, 
                           
                              W
                              
                                 
                                    
                                       P
                                       ϕ
                                    
                                 
                              
                           
                         in Step 7 can be calculated as
                           
                              
                                 W
                                 
                                    
                                       
                                          P
                                          ϕ
                                       
                                    
                                 
                                 =
                                 R
                                 
                                    
                                       
                                          L
                                          
                                             
                                                ×
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                V
                                             
                                             
                                                x
                                             
                                          
                                          
                                             
                                                ×
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                V
                                             
                                             
                                                y
                                             
                                          
                                          ;
                                          
                                             
                                                m
                                             
                                             
                                                p
                                             
                                          
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                ϕ
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          P
                                          ϕ
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             L
                                             
                                                
                                                   ×
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   V
                                                
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   ×
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   V
                                                
                                                
                                                   y
                                                
                                             
                                          
                                       
                                    
                                    
                                       (
                                       3
                                       )
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       
                                          P
                                          ϕ
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             L
                                             
                                                
                                                   ×
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   V
                                                
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   ×
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   V
                                                
                                                
                                                   y
                                                
                                             
                                             
                                                
                                                   ×
                                                
                                                
                                                   3
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         P
                                                         ϕ
                                                      
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                          
                                       
                                    
                                    
                                       (
                                       3
                                       )
                                    
                                    
                                       T
                                    
                                 
                                 =
                                 R
                                 
                                    
                                       
                                          
                                             
                                                
                                                   L
                                                   
                                                      
                                                         ×
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               P
                                                               ϕ
                                                            
                                                         
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ×
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                V
                                             
                                             
                                                x
                                             
                                          
                                          
                                             
                                                ×
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                V
                                             
                                             
                                                y
                                             
                                          
                                          ;
                                          
                                             
                                                m
                                             
                                             
                                                p
                                             
                                          
                                          ,
                                          1
                                       
                                    
                                 
                                 =
                                 vec
                                 
                                    
                                       
                                          
                                             
                                                V
                                             
                                             
                                                x
                                             
                                          
                                          
                                             
                                                
                                                   L
                                                   
                                                      
                                                         ×
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               P
                                                               ϕ
                                                            
                                                         
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                V
                                             
                                             
                                                y
                                             
                                             
                                                T
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Our MATLAB implementation of the proposed reconstruction method can be obtained from http://plaza4.snu.ac.kr/cutybug/rr/.

@&#EXPERIMENTAL RESULTS@&#

We used 500 samples of the Face Recognition Grand Challenge (FRGC) 2.0 Database [33] for our experiments. All the images and depths were affine-transformed based on the center of each pupil and the center of the mouth and were cropped to 
                           
                              
                                 
                                    m
                                 
                                 
                                    x
                                 
                              
                              ×
                              
                                 
                                    m
                                 
                                 
                                    y
                                 
                              
                              =
                              100
                              ×
                              120
                           
                         pixels. We denote the proposed method as “RR” (rank relaxation). The number of sample light source directions was 
                           
                              
                                 
                                    m
                                 
                                 
                                    s
                                 
                              
                              =
                              100
                           
                        . The parameters of “RR” were set as 
                           
                              
                                 
                                    n
                                 
                                 
                                    x
                                 
                              
                              =
                              30
                              ,
                              
                              
                                 
                                    n
                                 
                                 
                                    y
                                 
                              
                              =
                              40
                              ,
                              
                              
                                 
                                    n
                                 
                                 
                                    p
                                 
                              
                              =
                              200
                              ,
                              
                              
                                 
                                    n
                                 
                                 
                                    s
                                 
                              
                              =
                              10
                              ,
                              
                              
                                 
                                    n
                                 
                                 
                                    ϕ
                                 
                              
                              =
                              400
                           
                        , and 
                           
                              
                                 
                                    n
                                 
                                 
                                    ϕ
                                 
                                 
                                    ′
                                 
                              
                              =
                              200
                           
                        . Figs. 1–4
                        
                        
                        
                         show the performance for the various parameter settings. All the experiments were conducted on an Intel Xeon 2.66GHz workstation using MATLAB.

The proposed method was compared to three other methods [6,9,10]. The first scheme is “CCA” [6], which finds an optimal linear mapping between images and depths based on the features extracted by N-mode SVD. However, “CCA” is vulnerable to light variations, so “CCA” is trained based on two different set of samples: “real” and “synthetic.” For “real” samples, the images were selected from the database and were not in various light conditions. For “synthetic” samples, we used 10 synthesized images
                           1
                           In fact, we also tested 20 or 30 synthesized images for each subject, but their performances were nearly the same as the case of 10 synthesized images.
                        
                        
                           1
                         with random light conditions for each subject. The second scheme is “MOLD” [9], which alters a reference shape according to an input image. The last one is “TR” [10], which is our previous work. In these experiments, nine spherical harmonics were used for “TR,” and the depth was estimated from the model parameter using either the “direct” or the “mapping” methods proposed in [10]. The parameters for “CCA” and “TR” were tuned to provide the maximum performance, and those for “MOLD” were set as in the original paper [9].

For the FRGC 2.0 database, we evaluated the performance using 10-fold cross validation. The performance measures for the reconstructed shape were the mean absolute angle error 
                           
                              
                                 
                                    E
                                 
                                 
                                    angle
                                 
                              
                           
                         of the surface normal vectors and the mean absolute depth error 
                           
                              
                                 
                                    E
                                 
                                 
                                    depth
                                 
                              
                           
                        , defined as
                           
                              
                                 
                                    
                                       E
                                    
                                    
                                       angle
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             x
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             y
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          x
                                          ,
                                          y
                                       
                                    
                                 
                                 
                                    
                                       cos
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         r
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   (
                                                   x
                                                   ,
                                                   y
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       E
                                    
                                    
                                       depth
                                    
                                 
                                 =
                                 
                                    
                                       
                                          min
                                       
                                       
                                          
                                             
                                                d
                                             
                                             
                                                b
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      x
                                                   
                                                
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      y
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   x
                                                   ,
                                                   y
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         r
                                                      
                                                   
                                                   (
                                                   x
                                                   ,
                                                   y
                                                   )
                                                   -
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   (
                                                   x
                                                   ,
                                                   y
                                                   )
                                                   -
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         b
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Here, 
                           
                              
                                 
                                    h
                                 
                                 
                                    r
                                 
                              
                           
                         and 
                           
                              
                                 
                                    d
                                 
                                 
                                    r
                                 
                              
                           
                         are the ground truth surface normal and depth, and 
                           
                              
                                 
                                    h
                                 
                                 
                                    t
                                 
                              
                           
                         and 
                           
                              
                                 
                                    d
                                 
                                 
                                    t
                                 
                              
                           
                         are the reconstructed surface normal and depth, respectively. Note that the two measures are not necessarily proportional to each other because 
                           
                              
                                 
                                    E
                                 
                                 
                                    angle
                                 
                              
                           
                         reflects the accuracy of local details, while 
                           
                              
                                 
                                    E
                                 
                                 
                                    depth
                                 
                              
                           
                         reflects the accuracy of the global structure. A scalar value 
                           
                              
                                 
                                    d
                                 
                                 
                                    b
                                 
                              
                           
                         is introduced to eliminate the bias ambiguities in 
                           
                              
                                 
                                    d
                                 
                                 
                                    r
                                 
                              
                           
                         and 
                           
                              
                                 
                                    d
                                 
                                 
                                    t
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    d
                                 
                                 
                                    b
                                    ∗
                                 
                              
                           
                        , which minimizes 
                           
                              
                                 
                                    E
                                 
                                 
                                    depth
                                 
                              
                           
                        , is
                           
                              
                                 
                                    
                                       d
                                    
                                    
                                       b
                                       ∗
                                    
                                 
                                 =
                                 
                                    
                                       median
                                    
                                    
                                       x
                                       ,
                                       y
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                r
                                             
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          -
                                          
                                             
                                                d
                                             
                                             
                                                t
                                             
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                        because the minimizer of an 
                           
                              l
                              1
                           
                         cost function is the median of its elements.

Because the 2-D images in the FRGC 2.0 database have almost identical light conditions, random images were synthesized using the 3-D ground truth to compose four different test sets:
                           
                              1.
                              
                                 Real image set: The images in the FRGC 2.0 database.


                                 Synthetic image set 1: Synthetic images that have little shadow.


                                 Synthetic image set 2: Synthetic images that are moderately shadowed.


                                 Synthetic image set 3: Synthetic images that are heavily shadowed.

Some examples of the test images are shown in Fig. 5
                        .


                        Table 1
                         shows the experimental results. The best performance results are denoted in bold type and the standard deviations of the errors are denoted after the 
                           
                              ±
                           
                         symbols. The average time taken for “CCA” schemes is approximately 37ms, but its performance is worse than that of “RR” in all cases and deteriorates in the presence of heavy shadow. Except for the advantage that it needs only a single reference shape in advance, “MOLD” shows very poor performance in all cases, and requires the longest processing time. “TR/direct” has the best angle error, but the depth error is worse than that of “TR/mapping.” Here “RR” shows similar performance to “TR/mapping,” along with the advantage that it requires a much shorter reconstruction time (approximately 45ms). Here we can see that the standard deviations of “RR” are usually larger than those of the “TR” schemes, which is a trade off for the short processing time. Here, the reconstruction time includes the time for the affine transforms.


                        Fig. 5 shows some examples of reconstruction. The “CCA” schemes do not work well when there are heavy shadows in the images, and most of the “MOLD” results are distorted. The “TR” schemes provide good results in all cases. More specifically, “TR/direct” shows better local details, while “TR/mapping” has a more accurate global structure. “RR” shows results similar to those of “TR/mapping,” even though it takes much less time for reconstruction. Detailed graphs of the reconstructed shapes are shown in Fig. 6
                        .

The proposed method was applied to the images of some other 2-D face databases to confirm the performance. Fig. 7
                         shows two examples of the original and synthesized images, reconstructed by the proposed algorithm, in the Yale face database B [34]. Here we can see that the appearance of the reconstructed shape resembles the original images in the database quite closely. This trend is also true in Fig. 8
                        , which shows images from the Multi-PIE database [35]. Note that, in these experiments, the training samples were still from the FRGC 2.0 database, and the images in the Yale and Multi-PIE databases were used only as test samples.

In order to evaluate the accuracy for the images in a 2-D database, we selected 3200 images in various poses and light conditions from the Multi-PIE database, and compared them to the corresponding rendered images of the reconstructed shapes. We used frontal images for the input of the proposed scheme, and compared the reconstruction results to the non-frontal images with the same light conditions. The normalized square error of a rendered image was used as a performance measure, which is
                           
                              
                                 
                                    
                                       E
                                    
                                    
                                       pixel
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         I
                                                      
                                                      
                                                         r
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         I
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         I
                                                      
                                                      
                                                         r
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    I
                                 
                                 
                                    r
                                 
                              
                           
                         and 
                           
                              
                                 
                                    I
                                 
                                 
                                    t
                                 
                              
                           
                         are the ground truth and rendered images, respectively. We assumed that the images were made by orthographic projections and the 3-D shapes were transformed by similarity transforms in the Euclidean space. (See A for details.) The average normalized square errors of the rendered images based on “RR” and “TR/mapping” for the images in the Multi-PIE database are shown in Fig. 9
                        . Here the angles for both the pose and the light source are the yaw angles. The performance of “RR” and “TR” is similar. The errors are higher for larger angles.

We also applied “RR” to some celebrity images downloaded from the Web to verify that the scheme works well for common images, and the results are shown in Fig. 10
                        . From the fact that the training and test data are from different databases, we can assume that the generalization performance of the proposed method is good enough for practical applications.

@&#CONCLUSION@&#

We have proposed a fast and effective facial shape recovery algorithm that can be applied to an image under unknown light conditions. We reformulated the bilinear problem into a linear problem of finding a matrix with a rank constraint. The rank constraint is then relaxed to find a full-rank solution, and we approximate it into a rank-one matrix. This alternative procedure is more effective than the usual ALS method, because it has lower computational complexity. The retrieved attribute information is linearly mapped to find the estimated depth. We showed by experiments that the proposed algorithm provides accurate reconstruction results irrespective of light conditions, and the processing time is short enough for real-time applications.

There are two limitations for the proposed model-based approach. One is that only the frontal pose is accepted for input images, and the other is that the resolution of the reconstruction is fixed. It is left for future work to develop a method to resolve these limitations.

@&#ACKNOWLEDGMENT@&#

This work was supported by Mid-career Researcher Program through NRF Grant funded by the MEST (No. 2011-0000059).

A similarity transform that maps a reconstructed shape to a particular image was automatically found based on the center of each pupil and the center of the mouth by solving the following equation:
                        
                           (A.1)
                           
                              B
                              =
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    
                                       g
                                       RA
                                       +
                                       t
                                       
                                          
                                             1
                                          
                                          
                                             T
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where the matrix 
                        
                           A
                           ∈
                           
                              
                                 R
                              
                              
                                 3
                                 ×
                                 3
                              
                           
                        
                      is composed of the locations of the three centers of a reconstructed shape in the 3-D coordinates, and the matrix 
                        
                           B
                           ∈
                           
                              
                                 R
                              
                              
                                 2
                                 ×
                                 3
                              
                           
                        
                      is composed of the 2-D coordinates of the corresponding points in an image. Here, 
                        
                           g
                           ∈
                           R
                           ,
                           
                           R
                           ∈
                           
                              
                                 R
                              
                              
                                 3
                                 ×
                                 3
                              
                           
                        
                     , and 
                        
                           t
                           ∈
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                        
                      are the scale, rotation, and translation of the similarity transform, respectively, and 
                        
                           
                              
                                 E
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 
                                    
                                       
                                          
                                             1
                                          
                                          
                                             0
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             1
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                              
                           
                        
                     .

Since a 3-D similarity transform has 7 degrees of freedom and the actual number of equations in (A.1) is 
                        
                           2
                           ×
                           3
                           =
                           6
                        
                     , one degree of freedom remains, and fortunately, it corresponds to the third element of 
                        
                           t
                        
                     . Considering that the depth value does not appear in the 2-D image plane and that the third element of 
                        
                           t
                        
                      corresponds to the translation of the entire shape in the z-direction, the third element of 
                        
                           t
                        
                      is not important and can be set to an arbitrary value. Hence, the solution for (A.1) can be found by minimizing the following objective function:
                        
                           (A.2)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                minimize
                                             
                                             
                                                z
                                                ,
                                                g
                                                ,
                                                R
                                                ,
                                                t
                                             
                                          
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     B
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           z
                                                                        
                                                                        
                                                                           T
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            g
                                                            RA
                                                            +
                                                            t
                                                            
                                                               
                                                                  1
                                                               
                                                               
                                                                  T
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          subject to
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                R
                                             
                                             
                                                T
                                             
                                          
                                          R
                                          =
                                          E
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          det
                                          R
                                          =
                                          1
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           z
                           ∈
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                        
                      is the depth value of the similarity-transformed shape. This is a modified version of the orthogonal Procrustes problem [36]. The detailed algorithm is summarized as follows:
                        
                           1.
                           Calculate the means of the coordinates as 
                                 
                                    
                                       
                                          a
                                       
                                       
                                          ‾
                                       
                                    
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          3
                                       
                                    
                                    A
                                    1
                                 
                               and 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          ‾
                                       
                                    
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          3
                                       
                                    
                                    B
                                    1
                                 
                              . Subtract the means from the coordinates as 
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    A
                                    -
                                    
                                       
                                          a
                                       
                                       
                                          ‾
                                       
                                    
                                    
                                       
                                          1
                                       
                                       
                                          T
                                       
                                    
                                 
                               and 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    B
                                    -
                                    
                                       
                                          b
                                       
                                       
                                          ‾
                                       
                                    
                                    
                                       
                                          1
                                       
                                       
                                          T
                                       
                                    
                                 
                              .

Set 
                                 
                                    z
                                    ←
                                    
                                       
                                          1
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          B
                                       
                                       
                                          ′
                                          T
                                       
                                    
                                    1
                                 
                              .

Perform SVD on 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               B
                                                            
                                                            
                                                               
                                                                  
                                                                     ′
                                                                  
                                                                  
                                                                     T
                                                                  
                                                               
                                                            
                                                         
                                                         z
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          A
                                       
                                       
                                          ′
                                          T
                                       
                                    
                                    =
                                    U
                                    Λ
                                    
                                       
                                          V
                                       
                                       
                                          T
                                       
                                    
                                 
                              . Set 
                                 
                                    R
                                    ←
                                    
                                       
                                          UV
                                       
                                       
                                          T
                                       
                                    
                                 
                               and 
                                 
                                    g
                                    ←
                                    tr
                                    (
                                    Λ
                                    )
                                    /
                                    tr
                                    (
                                    
                                       
                                          A
                                       
                                       
                                          ′
                                          T
                                       
                                    
                                    
                                       
                                          A
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                 
                              .

Set 
                                 
                                    z
                                    ←
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  0
                                                               
                                                               
                                                                  0
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                g
                                                
                                                   
                                                      RA
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                       
                                          T
                                       
                                    
                                 
                              . Subtract the mean from 
                                 
                                    z
                                 
                               as 
                                 
                                    z
                                    ←
                                    z
                                    -
                                    
                                       
                                          1
                                       
                                       
                                          3
                                       
                                    
                                    
                                       
                                          11
                                       
                                       
                                          T
                                       
                                    
                                    z
                                 
                              .

Repeat Steps 3 and 4 until convergence.

If 
                                 
                                    det
                                    R
                                    =
                                    -
                                    1
                                 
                              , set 
                                 
                                    R
                                    ←
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      -
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    
                                    R
                                 
                              .

Set 
                                 
                                    t
                                    ←
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     b
                                                                  
                                                                  
                                                                     ‾
                                                                  
                                                               
                                                            
                                                            
                                                               T
                                                            
                                                         
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          T
                                       
                                    
                                    -
                                    g
                                    R
                                    
                                       
                                          a
                                       
                                       
                                          ‾
                                       
                                    
                                 
                              .

The above algorithm can find a similarity transform in the Euclidean space, but it is not unique. Let us denote 
                        
                           
                              
                                 R
                              
                              
                                 ′
                              
                           
                        
                      to be another rotation matrix that minimizes (A.2). Then the relation
                        
                           
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             R
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          
                                             A
                                          
                                          
                                             ′
                                          
                                       
                                       -
                                       
                                          
                                             RA
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             R
                                          
                                          
                                             ′
                                          
                                       
                                       -
                                       R
                                    
                                 
                              
                              
                                 
                                    A
                                 
                                 
                                    ′
                                 
                              
                              =
                              0
                              ,
                           
                        
                     should be satisfied. Since 
                        
                           
                              
                                 A
                              
                              
                                 ′
                              
                           
                           1
                           =
                           0
                        
                      (i.e., 
                        
                           
                              
                                 A
                              
                              
                                 ′
                              
                           
                        
                      is singular), there is a chance that 
                        
                           
                              
                                 R
                              
                              
                                 ′
                              
                           
                           -
                           R
                        
                      is not a zero matrix. Let 
                        
                           
                              
                                 a
                              
                              
                                 ′
                              
                           
                        
                      be a unit vector that corresponds to the left null space of 
                        
                           
                              
                                 A
                              
                              
                                 ′
                              
                           
                        
                     , then
                        
                           
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             R
                                          
                                          
                                             ′
                                          
                                       
                                       -
                                       R
                                    
                                 
                              
                              =
                              
                                 
                                    fa
                                 
                                 
                                    ′
                                    T
                                 
                              
                              ,
                           
                        
                     for an arbitrary two-dimensional vector 
                        
                           f
                        
                     . Note that
                        
                           
                              E
                              =
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    R
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    R
                                 
                                 
                                    ′
                                    T
                                 
                              
                              
                                 
                                    E
                                 
                                 
                                    ′
                                    T
                                 
                              
                              =
                              (
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              R
                              +
                              
                                 
                                    fa
                                 
                                 
                                    ′
                                    T
                                 
                              
                              )
                              
                                 
                                    (
                                    
                                       
                                          E
                                       
                                       
                                          ′
                                       
                                    
                                    R
                                    +
                                    
                                       
                                          fa
                                       
                                       
                                          ′
                                          T
                                       
                                    
                                    )
                                 
                                 
                                    T
                                 
                              
                              =
                              E
                              +
                              
                                 
                                    fa
                                 
                                 
                                    ′
                                    T
                                 
                              
                              
                                 
                                    R
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    E
                                 
                                 
                                    ′
                                    T
                                 
                              
                              +
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    Ra
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    f
                                 
                                 
                                    T
                                 
                              
                              +
                              
                                 
                                    ff
                                 
                                 
                                    T
                                 
                              
                              ,
                           
                        
                     and hence, 
                        
                           
                              
                                 fa
                              
                              
                                 ′
                                 T
                              
                           
                           
                              
                                 R
                              
                              
                                 T
                              
                           
                           
                              
                                 E
                              
                              
                                 ′
                                 T
                              
                           
                           +
                           
                              
                                 E
                              
                              
                                 ′
                              
                           
                           
                              
                                 Ra
                              
                              
                                 ′
                              
                           
                           
                              
                                 f
                              
                              
                                 T
                              
                           
                           +
                           
                              
                                 ff
                              
                              
                                 T
                              
                           
                           =
                           0
                        
                     . The only non-zero vector 
                        
                           f
                        
                      that satisfies this equation is 
                        
                           f
                           =
                           -
                           2
                           
                              
                                 E
                              
                              
                                 ′
                              
                           
                           
                              
                                 Ra
                              
                              
                                 ′
                              
                           
                        
                     , and therefore,
                        
                           
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    R
                                 
                                 
                                    ′
                                 
                              
                              =
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              R
                              +
                              
                                 
                                    fa
                                 
                                 
                                    ′
                                    T
                                 
                              
                              =
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              R
                              -
                              2
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    Ra
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    a
                                 
                                 
                                    ′
                                    T
                                 
                              
                              ,
                           
                        
                     which means that the first two rows of 
                        
                           
                              
                                 R
                              
                              
                                 ′
                              
                           
                        
                      are the same as those of 
                        
                           R
                           
                              
                                 
                                    E
                                    -
                                    2
                                    
                                       
                                          a
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       
                                          a
                                       
                                       
                                          ′
                                          T
                                       
                                    
                                 
                              
                           
                        
                     . Since 
                        
                           
                              
                                 R
                              
                              
                                 ′
                              
                           
                        
                      is a rotation matrix, we can find its third row by taking a cross product and multiplying it by 
                        
                           -
                           1
                        
                      if the determinant is 
                        
                           -
                           1
                        
                     . The scale 
                        
                           
                              
                                 g
                              
                              
                                 ′
                              
                           
                        
                      of this second solution is equal to g, and the translation 
                        
                           
                              
                                 t
                              
                              
                                 ′
                              
                           
                        
                      is calculated as in Step 7. Between these two solutions, we chose the solution with the smaller error.

@&#REFERENCES@&#

