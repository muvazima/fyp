@&#MAIN-TITLE@&#Recursive head reconstruction from multi-view video sequences

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A particle filter method is proposed to estimate pose and shape of faces in videos.


                        
                        
                           
                           Noisy or outlier points are handled using multi-hypotheses sampling in the filter.


                        
                        
                           
                           The approach is evaluated on synthetic data to validate the method.


                        
                        
                           
                           Comparison with the Levenberg–Marquardt optimization is performed.


                        
                        
                           
                           Visual and biometric results on real videos confirm the efficiency of our method.


                        
                     
                  
               
            

@&#KEYPHRASES@&#




                     3DMM




                  

Particle filter

Shape estimation

Facial biometry

@&#ABSTRACT@&#


               
               
                  Face reconstruction from images has been a core topic for the last decades, and is now involved in many applications such as identity verification or human–computer interaction. The 3D Morphable Model introduced by Blanz and Vetter has been widely used to this end, because its specific 3D modeling offers robustness to pose variation and adaptability to the specificities of each face.
                  To overcome the limitations of methods using a single image, and since video has become more and more affordable, we propose a new method which exploits video sequences to consolidate the 3D head shape estimation using successive frames. Based on particle filtering, our algorithm updates the model estimation at each instant and it is robust to noisy observations. A comparison with the Levenberg–Marquardt global optimization approach on various sets of data shows visual improvements both on pose and shape estimation. Biometric performances confirm this trend with a mean reduction of 10% in terms of False Rejection Rate.
               
            

@&#INTRODUCTION@&#

The recent rise of biometric techniques stimulates their use to automate the process of people recognition in a wide variety of systems, from computer locking devices to people authentication in airports. For each application, a compromise has to be found between the recognition rate of the biometric system on the one hand, and its easiness of use, cost and computation time on the other hand. The different types of biometric identifiers used for human recognition (fingerprints, iris, face, veins, etc.) have different requirements in terms of acquisition and do not lead to the same recognition accuracy.

Among all of them, facial biometry offers the advantage of being easily acquired without any contact with sensors, but suffers from specific issues of acquisition conditions (illumination, pose, facial expression). This is especially the case in video surveillance or in recognition systems designed to avoid behavior constraints in order to simplify the process from the user point of view. As such systems are not intrusive for users and due to the easiness of face acquisition, specific work has focused on face reconstruction and comparison methods. Moreover, facial biometry is sometimes the only biometric identifier available. To solve the different problems outlined above, the field of face recognition has been an active research area for many years, first on still images [30,9,5], then on video [23]. This extension is particularly interesting since video-based systems become more and more affordable, and have the advantage of increasing available observations. When people move about in uncontrolled scenarios, the information from a face observed under different poses in the sequence can be merged, and is then compared to a reference picture. Among existing face recognition algorithms, a number of methods are based on the comparison of frontal views (the reference view is generally the frontal picture on ID documents). A frontal view therefore has to be generated from the acquisitions. This can be performed via a 3D reconstruction of the face using the acquired images, from which synthesized views at any pose can be derived. Given the specificity of the face reconstruction problem (as opposed to object reconstruction without prior knowledge), model-based methods are privileged as they limit the risk of aberrant reconstruction, achieving a compromise between the information coming from the observations and the prior knowledge on the class of faces.

Most existing algorithms designed to estimate parameters of such 3D models are based on a single image input and highly depend on the quality of the observations [5,27]. Nevertheless, in order to obtain more accurate results, it is interesting to use several images to consolidate the reconstruction. In [2], the authors proposed to fuse images based on stereovision. The use of video sequences has not been widely exploited, except for structure from motion methods, where images are considered as an ensemble to estimate the model parameters [10]. In [32], the authors extend a single image based method to video sequences by fusing the estimations obtained at each instant independently, without verifying the model coherence. However, temporal constraints between states estimated at successive instants are not integrated in the process, which would improve results.

To propose a real-time working system, we have to exploit the incoming video frames on the fly. To this end, we propose a new method based on the update of a 3D head model by using a particle filter framework, which extends the work in [13], and has, to our knowledge, never been proposed. An important feature of the proposed approach is that previous observations are implicitly taken into account to estimate the model at the current instant. The key of our algorithm is to integrate the unknown shape coefficients in the particle state and to consider them as static parameters, unlike the pose which varies over time. Besides an adaptation to real data, we propose here an improved algorithm for face estimation, robust to noisy or aberrant detections thanks to multiple hypotheses handling, contrary to common gradient methods which optimize a unique solution associated with a given set of observations.

In Section 2, we first present the chosen head model, before giving an overview of methods which estimate the associated parameters, both for single and multiple input images. In Section 3, we detail how to adapt a particle filter method to handle static parameters for facial shape estimation in video sequences, and propose some alternatives to improve this static parameter estimation. Section 4 presents how the observations are exploited in the particle filter and used to generate the frontal view. Section 5 details a method which is compared to our particle filter-based method in Section 6. This alternative method is based on a Levenberg–Marquardt optimization to estimate the pose and the shape. Experiments are done on both synthetic and real data. They are first analyzed on visual illustrations, to demonstrate the improvements at the image level. Then, since our final goal is to improve facial recognition performances by improving the head reconstruction using video sequences, an evaluation based on biometric performances is also proposed, before concluding with the perspectives of our method.

The method we propose for face reconstruction from video sequences relies on a head model which is described in this section. We will then present the existing methods to estimate its parameters.

As underlined previously, many facial biometric systems must be able to work with unconstrained user behavior, which implies handling non-frontal poses in the input images.

Since most recognition algorithms are based on the comparison between frontal views, a frontal view has to be generated from the acquisitions. This can be performed via a 3D reconstruction of the face from which images at any pose can be derived.

There are many ways to reconstruct a 3D object from a set of views. We can distinguish purely geometric approaches, which can be applied to any object, from model-based methods, which use some prior information on the object to reconstruct, and are therefore specific to a class of objects. Among generic methods based on one or a set of views, the best known algorithms are based on shape from shading [35], structure from motion [35] or stereovision [6,18,4]. For the latter, an important constraint is to perform point matching between images which therefore need to be acquired under quite similar points of view. Reconstruction algorithms can also exploit other devices like 3D-scans, depth sensors [36] or structured light projectors [34]. Here, we limit our approach to image-based methods.

There exist several solutions to reconstruct a 3D object from a set of views, and we chose model-based methods to exploit prior knowledge on the object, here the face. The contribution of the prior is twofold: first, it can be used to initialize a solution corresponding to a valid shape (for instance, a mean model), then, it prevents the algorithm from delivering a solution which does not belong to the face space.

We use a 3D deformable shape model constructed in a similar way as the 3D Morphable Model (3DMM) introduced in [5]. This model has been chosen for several reasons, the first being its 3D modeling (by opposition to 2D), necessary when faces under any pose are considered (2D models learned on frontal views indeed cannot be used with non-frontal face inputs). Moreover, as the final aim is to establish a comparison score between the frontal view of the estimated face and its corresponding ID picture, it is necessary to adapt the model so that it fits the observed identity as well as possible. The 3DMM allows for this adjustment, as it describes the deformations of a mean face on two levels:
                           
                              •
                              The shape space, characterized by a mean shape 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                  and a set of deformations 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                i
                                                =
                                                1
                                                ,
                                                …
                                                ,
                                                M
                                             
                                          
                                       
                                    
                                  computed by principal component analysis over a database of aligned head scans. Each instance of this model can then be written as:
                                    
                                       (1)
                                       
                                          S
                                          =
                                          κ
                                          
                                             
                                                
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         ‾
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            M
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                i
                                                =
                                                1
                                                ,
                                                …
                                                ,
                                                M
                                             
                                          
                                       
                                    
                                  are the weighting parameters which characterize the similarity with the mean shape and 
                                    
                                       κ
                                    
                                  is a scaling factor. The mean shape 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                  is defined by a set of 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             v
                                          
                                       
                                    
                                  3D vertices, and each vector 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                       
                                    
                                  corresponds to deformations associated with this set of points. A mesh is then defined from these vertices by adding facets to describe the entire head surface.

The texture, that associates a color with each vertex of the mesh, is stored in a texture map (Fig. 1
                                 ) independently of the shape parameters.

Like the shape space, the texture space can be described by a set of texture eigenvectors 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                i
                                                =
                                                1
                                                ,
                                                …
                                                ,
                                                
                                                   
                                                      M
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                  and a mean texture map 
                                    
                                       
                                          
                                             T
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                 . Any instance of the model is then a linear combination of these vectors, so that:
                                    
                                       (2)
                                       
                                          T
                                          =
                                          
                                             
                                                T
                                             
                                             
                                                ‾
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                β
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                 where 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             ′
                                          
                                       
                                    
                                  is the number of texture eigenvectors, and 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      β
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                i
                                                =
                                                1
                                                ,
                                                …
                                                ,
                                                
                                                   
                                                      M
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                  are the weighting parameters for the texture similar to 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                    
                                  in Eq. (1) for the shape.

A probability is associated with each shape parameter value, as follows:
                           
                              (3)
                              
                                 p
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 ∼
                                 
                                    
                                       e
                                    
                                    
                                       -
                                       
                                          
                                             1
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   i
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             
                                                
                                                   σ
                                                
                                                
                                                   i
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        with 
                           
                              
                                 
                                    σ
                                 
                                 
                                    i
                                 
                              
                           
                         the 
                           
                              i
                           
                        th eigenvalue of the shape covariance matrix. A similar probability can be written for the texture parameters.

In this article, the parameter estimation focuses on the geometrical part of the model, and the texture is then estimated in a second step. Some instances of the morphable shape model are given in Fig. 2
                         illustrating its variations depending on the parameter values.

A first algorithm to estimate the shape and texture parameters of the 3DMM was proposed in the seminal paper [5]. This algorithm is based on the optimization of a similarity score between the input image and a rendered view synthesized given the estimated pose, shape and texture. In case of perfect fitting, the input image and the rendered one should be exactly the same. The optimization is performed using stochastic gradient descent, in order to speed up the process and to avoid local minima.

In [26], the authors introduced a faster method, based on Analysis-by-Synthesis as previously mentioned. The difference image (between the input image and the synthesized one) is expressed as a function of different derivative terms with respect to the unknown variables to estimate (pose, texture and shape parameters, and illumination). Because this equation is linear when some of the parameters are fixed, the proposed method first optimizes iteratively the rigid transformation, then the shape, the illumination, and finally the texture parameters. Thus, dimensions are reduced for each of these optimization steps, and most of them are linear (when estimating one set of parameters, the others are fixed). Similar results are obtained in [5], but with a computation time divided by five.

In [27], the authors add features to the cost function in order to expand the convexity domain around the optimum, and thus limit the problem of local minima. Moreover, the estimation accuracy is improved as the use of multiple features leads to a better fit between the model and the observations.

Nevertheless, even if the model fits the observations on a single image well, the 3D fitting is not guaranteed. Actually, due to the projection from the 3D world onto the image plane and the occlusions of some parts of a face in an image, some information is missing and therefore the estimation might be erroneous. This is why new algorithms based on multiple image fitting have been proposed. We present them briefly in the next subsection.

In [2], the fitting algorithm proposed in [27] was adapted to use a set of images acquired simultaneously. Besides the estimation of the pose and the model parameters, the authors also estimate the camera calibration parameters. This method improves the results of algorithms relying only on a single image, but as for previous methods, noisy observations can lead to an inaccurate estimation. When facing non-frontal poses, the extraction of features such as points of interest (eye corners, ears, etc.) might be difficult. Moreover, when using gradient based optimization methods, the final estimation highly depends on the initialization: if the starting point is too far from the real value, the solution can be stuck in a local minimum.

To fit a head model to a face seen in a video sequence, some methods simply apply an additional selection step over all available images to extract the best one according to some criteria. One of the fitting methods introduced previously can then be applied on the single chosen image [7]. In [32], two experiments were proposed; the first one consists in estimating the parameters using each frame independently before making a fusion by a linear combination of these estimations. The second one uses all input images together to optimize parameters, leading to a single estimation based on the whole sequence.

The advantage of using stereovision or video sequences is that it guarantees a better 3D estimation as the model is fitted on observations under various poses. Moreover, there is more robustness to outliers or noisy detections, because one point being badly detected on one image may be correctly detected on other ones. If the feature points used for the reconstruction are well detected in most of the images, the estimation will lead to a fitting towards the good detections. Moreover, using stereovision or video sequences allows consolidating the estimation between views under various poses. Nevertheless, no specific method has been proposed to sequentially update the model using a video sequence. Indeed, stereovision is often based on images acquired simultaneously by a set of cameras, and the video-based method proposed in [32] is applied offline. We present here a new video-based approach, using sequences acquired from a set of calibrated cameras. Unlike the previous methods, we propose updating the parameter estimation online, with each new incoming observation. Thus, at each instant, we obtain an estimation built on all previous views, which can be exploited before the end of the acquisition.

In this paper, our goal is to estimate the parameters of the shape model introduced in Section 2.2. The methods which have been presented previously iteratively update an initial estimate, and the output is a unique instance of the morphable model. Unlike these types of algorithms, we propose here representing the previous estimation as a density, which characterizes the probability of realization over the whole shape space. This allows us to cope with the inherent nature of noisy data and to maintain multiple hypotheses during the estimation process, that are reinforced or eliminated with new frames.

We rely on the Gaussian assumption made in [5] to define the prior distribution of the model shape parameters. This initial density is then updated each time new information is available. Given a new frame (or a set of frames when multiple views are available), our goal is to update the previous distribution characterizing the prior constraint and the past observations by taking the current ones into account. This can be done using a Bayesian approach, which allows a compromise between the parameter validity and the correlation with the observations.

Several declinations of the Bayesian theory for sequential updating can be cited here, such as the Kalman filter [16], the extended Kalman filter [28], the Unscented Kalman [15] and the particle filter [8]. Due to the non-linearity of the involved functions (perspective projections, projection of a 3D object leading to partial occlusions) and the multi-modal distributions we handle, we choose to work with particle filters. As developed in Section 4.1, the particle filter offers a structure that maintains multiple hypotheses over time, which is useful when feature extraction is difficult and leads to outliers.

In this work, we use a particle filter to jointly estimate the pose and the facial shape parameters over a video sequence. In the experiments, the camera extrinsic and intrinsic parameters are known, and not subject to the estimation. We first describe how to estimate dynamical states (position, pose, etc.) and then discuss how to integrate and estimate static parameters in the filter.

The particle filter algorithm [3,8] aims at filtering a hidden state x by representing it as a density updated at each instant t given the observations 
                           
                              
                                 
                                    y
                                 
                                 
                                    t
                                 
                              
                           
                        . At each time t, the hidden state 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                              
                           
                         can be derived from the previous state 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                    -
                                    1
                                 
                              
                           
                         given an evolution equation:
                           
                              (4)
                              
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 g
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       μ
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        with g a (possibly non-linear) function characterizing the system dynamics, and 
                           
                              
                                 
                                    μ
                                 
                                 
                                    t
                                 
                              
                           
                         the associated noise. The observations at time t are derived from the corresponding state 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                              
                           
                         according to the following equation:
                           
                              (5)
                              
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 h
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       η
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        with h the (possibly non-linear) observation function and 
                           
                              
                                 
                                    η
                                 
                                 
                                    t
                                 
                              
                           
                         the noise associated with the observations. The set of observations from instant 1 to t is denoted by 
                           
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    t
                                 
                              
                           
                        .

The goal is to estimate at each time t the filtering density 
                           
                              p
                              (
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    t
                                 
                              
                              )
                           
                         by a set of N elements 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                         called particles representing possible states at time t. Each particle 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                         is associated with a normalized weight 
                           
                              
                                 
                                    w
                                 
                                 
                                    t
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                         which characterizes its likelihood. The density is approximated using the Monte-Carlo method given the set of N particles 
                           
                              P
                              =
                              
                                 
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             t
                                          
                                          
                                             (
                                             i
                                             )
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             t
                                          
                                          
                                             (
                                             i
                                             )
                                          
                                       
                                       )
                                       ,
                                       
                                       i
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       N
                                    
                                 
                              
                           
                        :
                           
                              
                                 
                                    
                                       p
                                    
                                    
                                       ̃
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       :
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       t
                                    
                                    
                                       (
                                       i
                                       )
                                    
                                 
                                 
                                    
                                       δ
                                    
                                    
                                       
                                          
                                             x
                                          
                                          
                                             t
                                          
                                          
                                             (
                                             i
                                             )
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           
                        where 
                           
                              
                                 
                                    δ
                                 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          t
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                              
                              )
                              =
                              1
                           
                         if 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                              
                              =
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              ,
                              0
                           
                         elsewhere.

Given the initial particle distribution 
                           
                              {
                              (
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              ,
                              
                                 
                                    w
                                 
                                 
                                    0
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              =
                              1
                              /
                              N
                              )
                              ,
                              
                              i
                              =
                              1
                              ,
                              …
                              ,
                              N
                              }
                           
                        , the following steps will be repeated to estimate the a posteriori density at each instant:
                           
                              •
                              
                                 Prediction: each particle 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             t
                                             -
                                             1
                                          
                                          
                                             (
                                             i
                                             )
                                          
                                       
                                    
                                  moves from time 
                                    
                                       t
                                       -
                                       1
                                    
                                  to time t given the probability 
                                    
                                       p
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             t
                                          
                                       
                                       |
                                       
                                          
                                             x
                                          
                                          
                                             t
                                             -
                                             1
                                          
                                       
                                       )
                                    
                                  associated with the system dynamics (Eq. (4)).


                                 Correction: each weight 
                                    
                                       
                                          
                                             w
                                          
                                          
                                             t
                                          
                                          
                                             (
                                             i
                                             )
                                          
                                       
                                    
                                  is then updated according to the particle likelihood given the current observations 
                                    
                                       p
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             t
                                          
                                       
                                       |
                                       
                                          
                                             x
                                          
                                          
                                             t
                                          
                                          
                                             (
                                             i
                                             )
                                          
                                       
                                       )
                                    
                                 :
                                    
                                       (6)
                                       
                                          
                                             
                                                w
                                             
                                             
                                                t
                                             
                                             
                                                (
                                                i
                                                )
                                             
                                          
                                          ∝
                                          
                                             
                                                w
                                             
                                             
                                                t
                                                -
                                                1
                                             
                                             
                                                (
                                                i
                                                )
                                             
                                          
                                          p
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          
                                             
                                                x
                                             
                                             
                                                t
                                             
                                             
                                                (
                                                i
                                                )
                                             
                                          
                                          )
                                          .
                                       
                                    
                                 
                              

This likelihood score defines how probable the state represented by each particle is, taking current observations and model knowledge into account.

Finally, a resampling is performed if the particle weights are too scattered. This is characterized by the Effective Sample Size (ESS) approximated by 
                                    
                                       
                                          
                                             1
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   N
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               w
                                                            
                                                            
                                                               t
                                                            
                                                            
                                                               (
                                                               i
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 .

Let us now consider the case of filtering with unknown static parameters. This is especially useful when some parameters of the object to track are unknown, and when their values impact the evolution and observation functions. For instance, if we consider the size of the object as a parameter, it is clear that it will influence the observation function, as, the bigger it is, the larger its projection in the image for a given pose. To simplify the notations, we consider the concatenation of all unknown parameters in a vector 
                           
                              θ
                           
                         (here, the shape parameters 
                           
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                           
                         and the scale factor 
                           
                              κ
                           
                        ). As previously mentioned, the aim is to estimate sequentially the dynamic state 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                              
                           
                         (the pose) given the observations 
                           
                              (
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    t
                                 
                              
                              )
                           
                        . However, we now take into account the unknown parameters in the evolution and observation equations. The parameter 
                           
                              θ
                           
                         is a characteristic of the object and is supposed to be constant over time, but as it is unknown, it has to be estimated. We propose updating this estimation along the sequence, and we note 
                           
                              
                                 
                                    θ
                                 
                                 
                                    t
                                 
                              
                           
                         the current estimation at time t. With these notations, the previous system can be rewritten as follows:
                           
                              (7a)
                              
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 g
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       μ
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             t
                                             -
                                             1
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       μ
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (7b)
                              
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 h
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       η
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       h
                                    
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       η
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           
                        The functions g and h now depend on 
                           
                              θ
                           
                        , meaning that the hidden state evolution depends on the parameter values, as do the observations given a state. In addition to the state estimation, a second task is to determine the static parameter vector 
                           
                              θ
                           
                        .

In [17], the authors reviewed existing methods to deal with unknown parameters in particle filter algorithms. We do not hereby consider offline methods, which handle a set of observations and optimize the unknown static parameters and the poses globally. Instead, we focus on online methods which update the pose and parameter estimation recursively given the incoming observations. Thus, we can have the best estimation available at each instant, since it is computed from the previous estimations updated with the current observations. If the last computed estimation is good enough (for instance if it fits well with the observations), there is no need to continue the process. Otherwise, the last estimation is used for further improvement using new frames.

Let 
                           
                              p
                              (
                              θ
                              )
                           
                         be the prior distribution of the unknown static parameters. Our algorithm aims at estimating iteratively the vector 
                           
                              
                                 
                                    θ
                                 
                                 
                                    t
                                 
                                 
                                    ∗
                                 
                              
                           
                        , corresponding to the shape estimation at time t, and the associated pose 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                              
                           
                        . The probability of 
                           
                              
                                 
                                    θ
                                 
                                 
                                    t
                                 
                              
                           
                         at time t given the observations can be obtained by integrating over all possible values of the hidden state 
                           
                              
                                 
                                    x
                                 
                                 
                                    1
                                    :
                                    t
                                 
                              
                           
                        :
                           
                              (8)
                              
                                 p
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       :
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    ∫
                                    
                                       X
                                    
                                 
                                 p
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       1
                                       :
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       :
                                       t
                                    
                                 
                                 )
                                 
                                    
                                       dx
                                    
                                    
                                       1
                                       :
                                       t
                                    
                                 
                              
                           
                        where 
                           
                              X
                           
                         is the hidden dynamic state space. To estimate the value of 
                           
                              θ
                           
                         iteratively, this static parameter can be integrated into the hidden state, thus increasing the size of the particle state [29,22]. The joint density 
                           
                              p
                              (
                              
                                 
                                    θ
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    1
                                    :
                                    t
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    t
                                 
                              
                              )
                           
                         can then be evaluated using Monte-Carlo methods.

Recall that 
                           
                              x
                              ∈
                              X
                           
                         is the dynamic state of dimension 
                           
                              
                                 
                                    n
                                 
                                 
                                    x
                                 
                              
                           
                        , and 
                           
                              θ
                              ∈
                              Θ
                           
                         the vector of static parameters of dimension 
                           
                              
                                 
                                    n
                                 
                                 
                                    θ
                                 
                              
                           
                        . The complete vector to estimate is then 
                           
                              {
                              x
                              ,
                              θ
                              }
                              ∈
                              X
                              ×
                              Θ
                           
                        , with dimension 
                           
                              
                                 
                                    n
                                 
                                 
                                    x
                                 
                              
                              +
                              
                                 
                                    n
                                 
                                 
                                    θ
                                 
                              
                           
                        . Each particle will then be represented by a dynamic state part 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                         and a static state part 
                           
                              
                                 
                                    θ
                                 
                                 
                                    t
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                        .

The integration of static parameters into the hidden state requires the application of an artificial move on the particle static part in order to explore the associated space. By definition, since the parameters are static, the dynamic function which determines their evolution in time is the identity function. In this case, the parameters do not change, and the only values tested over the sequence are the ones sampled at the particle initialization step, as they are not modified afterward. After some resampling steps, a few or even only one values will still be represented, and this impoverishment leads to a wrong estimation of the parameter values. A workaround to this issue is to apply an artificial move on the static parameters from frame to frame. Different types of moves which are listed below have already been proposed. We also propose two variants that improve the estimation process.


                        Gaussian noise. A first method consists in considering the static parameters as dynamic ones, as in [22]. Therefore, at each time t, a Gaussian noise is added to the perturbation, which can be considered as an artificial evolution:
                           
                              (9a)
                              
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                       +
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                    
                                 
                                 +
                                 
                                    
                                       ε
                                    
                                    
                                       t
                                       +
                                       1
                                    
                                 
                              
                           
                        
                        
                           
                              (9b)
                              
                                 
                                    
                                       ε
                                    
                                    
                                       t
                                       +
                                       1
                                    
                                 
                                 ∼
                                 N
                                 (
                                 0
                                 ,
                                 W
                                 )
                              
                           
                        with W a covariance matrix characterizing the noise to add. Thanks to this step, diversification is introduced for the static part of the particle filter, and other states, than the ones initially sampled, can be evaluated.


                        Adaptive Gaussian noise depending on particle weight. With the previous move based on Gaussian noise addition, there is a loss of precision after the alteration, since good particles can be moved far away from their initial good position. To limit this effect, we propose making the covariance matrix W dependent on each particle weight 
                           
                              
                                 
                                    w
                                 
                                 
                                    t
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                        . If the weight is high (meaning that the particle is in agreement with the observations), we use a covariance matrix with small values to make a local exploration of the space. Conversely, if the weight is low, a noise with a higher covariance will be applied to the static parameters in order to move the particle in other subspaces.


                        Resample-move algorithm. In [11], each move applied on the static state is generated by a MCMC step (Monte Carlo Markov Chain). With this method, the new static states which are only generated are accepted under some likelihood conditions. This idea, called Resample-Move algorithm, has been introduced in [12]. The method works as follows: at each time t, a MCMC move is applied to each particle. This move is generated by a kernel 
                           
                              
                                 
                                    K
                                 
                                 
                                    t
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    1
                                    :
                                    t
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    ′
                                 
                              
                              |
                              
                                 
                                    x
                                 
                                 
                                    1
                                    :
                                    t
                                 
                              
                              ,
                              θ
                              )
                           
                         having 
                           
                              p
                              (
                              
                                 
                                    x
                                 
                                 
                                    1
                                    :
                                    t
                                 
                              
                              ,
                              θ
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    t
                                 
                              
                              )
                           
                         as invariant distribution. The move can be limited to the static state 
                           
                              θ
                           
                        , and can be obtained by the Metropolis–Hastings algorithm, computed in two steps:
                           
                              •
                              sample a new candidate for the static parameter: 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ′
                                          
                                       
                                       ∼
                                       p
                                       (
                                       
                                          
                                             θ
                                          
                                          
                                             ′
                                          
                                       
                                       |
                                       θ
                                       )
                                    
                                 ,

sample 
                                    
                                       v
                                       ∼
                                       
                                          
                                             U
                                          
                                          
                                             [
                                             0
                                             ,
                                             1
                                             ]
                                          
                                       
                                    
                                 , a random sample from the uniform distribution between 0 and 1. If
                                    
                                       (10)
                                       
                                          v
                                          ⩽
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   
                                                      
                                                         p
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        y
                                                                     
                                                                     
                                                                        1
                                                                        :
                                                                        t
                                                                     
                                                                  
                                                                  |
                                                                  
                                                                     
                                                                        x
                                                                     
                                                                     
                                                                        1
                                                                        :
                                                                        t
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        θ
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         p
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        y
                                                                     
                                                                     
                                                                        1
                                                                        :
                                                                        t
                                                                     
                                                                  
                                                                  |
                                                                  
                                                                     
                                                                        x
                                                                     
                                                                     
                                                                        1
                                                                        :
                                                                        t
                                                                     
                                                                  
                                                                  ,
                                                                  θ
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

By directly applying this formula, the computational cost is increased at each timestep, as more frames have to be considered for the likelihood computation. Indeed, as the static parameters are modified between frames, all likelihood values with respect to previous observations need to be recomputed. To limit this effect, we introduce a period 
                           
                              Δ
                              T
                           
                        , which defines the number of frames to be taken into account for the MCMC validation. The move is then accepted if:
                           
                              (11)
                              
                                 v
                                 ⩽
                                 
                                    min
                                 
                                 
                                    
                                       
                                          1
                                          ,
                                          
                                             
                                                p
                                                
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               t
                                                               -
                                                               Δ
                                                               T
                                                               :
                                                               t
                                                            
                                                         
                                                         |
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               t
                                                               -
                                                               Δ
                                                               T
                                                               :
                                                               t
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               θ
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                p
                                                
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               t
                                                               -
                                                               Δ
                                                               T
                                                               :
                                                               t
                                                            
                                                         
                                                         |
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               t
                                                               -
                                                               Δ
                                                               T
                                                               :
                                                               t
                                                            
                                                         
                                                         ,
                                                         θ
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        with 
                           
                              Δ
                              T
                              =
                              0
                           
                         if only the current observations are used.

For each particle, the sampling step
                           
                              (12)
                              
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                    
                                    
                                       ′
                                       (
                                       i
                                       )
                                    
                                 
                                 ∼
                                 p
                                 
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                t
                                             
                                             
                                                (
                                                i
                                                )
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                1
                                                :
                                                t
                                             
                                             
                                                (
                                                i
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        allows for a local diversification of the static parameters only. Like systematic Gaussian noise addition, we propose to evaluate another sampling step, based on the prior distribution of the static parameters, and independently of the particle current shape parameters 
                           
                              
                                 
                                    θ
                                 
                                 
                                    t
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                        . Thus, new subspaces can be explored and moves are allowed anywhere, as long as the acceptance condition in Eq. (10) is satisfied. With this method, it becomes possible to get a particle out of a local maximum. Nevertheless, if the space dimension is too high with very few areas with high likelihood, the probability to accept a move will be very low.

Particle filters that include unknown static parameters have been detailed from a theoretical point of view this past decade but very few applications have been proposed in the field of image processing. One use of such methods was nevertheless given in [22], where the authors evaluated dimensions of simple geometrical objects in video sequences, by considering these values as unknown static parameters. The relation between the unknown dimensions and the observations remains simple, and there is no correlation between the different static values.

In this paper, we want to estimate the unknown parameters of a more complex model, namely the shape coefficients 
                           
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                           
                         and the scale 
                           
                              κ
                           
                         (Eq. (1)) of the shape model presented in Section 2.2. Let us underline that the observations are highly dependent on the shape parameters, and this relation will be exploited to estimate them using the available observations. Pose and shape parameters must be estimated jointly, otherwise a pose error will be compensated by a parameter error and conversely. As illustrated in Fig. 2, due to the construction of our shape model, each parameter 
                           
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                           
                         in Eq. (1) modifies the whole face because each associated deformation eigenvector impacts all vertices. The process leading from the shape parameters to the observed image is as follows:
                           
                              1.
                              model deformation given 
                                    
                                       (
                                       
                                          
                                             α
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             α
                                          
                                          
                                             M
                                          
                                       
                                       )
                                    
                                  and the scale 
                                    
                                       κ
                                    
                                 ,

rotation and translation in the 3D world reference,

projection onto the image plane.

The dependence on 
                           
                              θ
                           
                         needs therefore to be considered when using the observation function, due to the shape parameter impact on the 3D position of each point. The global system to consider is the following:
                           
                              (13a)
                              
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 g
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       μ
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (13b)
                              
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 h
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 θ
                                 ,
                                 
                                    
                                       η
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       h
                                    
                                    
                                       θ
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       η
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           
                        
                     

For our study, instead of applying the usual prediction process of the particle filter (Eq. (13a)), we favor the use of feature points detected in the current frame to initialize the pose. Indeed, to handle low framerates, a very high number of particles would be necessary to cover the space of all possible poses, and only a few of them would be relevant. To avoid this step, we compute the particle poses directly given the current feature point detections. To this end, an initial pose 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                                 
                                    0
                                 
                              
                           
                         is estimated by fitting the mean model using the method presented in [31]. This algorithm computes the translation, the rotation and the scale which minimize the least mean square error between two sets of 3D feature points. This is done by computing the Singular Value Decomposition (SVD) of the covariance matrix of these two sets of points, which is then used to determine the pose 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                                 
                                    0
                                 
                              
                           
                        . A pose 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                         is then sampled around 
                           
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                                 
                                    0
                                 
                              
                           
                         for each particle, using a Gaussian noise (Eq. (14)).


                        Algorithm 1 presents the particle filter with two exclusive possibilities of move applied to the static parameters. In the case of Gaussian sampling, a move is automatically applied to each unknown parameter. When using MCMC, the move is applied conditionally to the gain in terms of likelihood between the previous and the new sampled states (Eq. (10)).
                           Algorithm 1
                           Static shape parameter estimation with a particle filter 
                                 
                                    
                                       
                                       
                                          
                                             Sample the shape parameters 
                                                   
                                                      θ
                                                   
                                                 from a prior Gaussian distribution to initialize the set of particles 
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     θ
                                                                  
                                                                  
                                                                     0
                                                                  
                                                                  
                                                                     (
                                                                     i
                                                                     )
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     w
                                                                  
                                                                  
                                                                     0
                                                                  
                                                                  
                                                                     (
                                                                     i
                                                                     )
                                                                  
                                                               
                                                               =
                                                               1
                                                               /
                                                               N
                                                               )
                                                               ,
                                                               
                                                               i
                                                               =
                                                               1
                                                               ,
                                                               …
                                                               ,
                                                               N
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             Define the move to apply: 
                                                   
                                                      Move
                                                      =
                                                      Gaussian
                                                      _
                                                      Sampling
                                                   
                                                 or MCMC
                                             
                                          
                                          
                                             
                                                for 
                                                
                                                   
                                                      t
                                                      =
                                                      1
                                                      →
                                                      
                                                         
                                                            N
                                                         
                                                         
                                                            frames
                                                         
                                                      
                                                   
                                                 
                                                do
                                             
                                          
                                          
                                             
                                                 Input: 2D feature point positions (possibly noisy).
                                          
                                          
                                             
                                                 Mean shape model fitting to estimate the initial pose 
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            t
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                 using the method by [31].
                                          
                                          
                                             
                                                 
                                                for 
                                                
                                                   
                                                      i
                                                      =
                                                      1
                                                      →
                                                      N
                                                   
                                                 
                                                do
                                             
                                          
                                          
                                             
                                                 – Sample around the estimated pose:
                                          
                                          
                                             
                                                
                                                   
                                                      (14)
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               t
                                                            
                                                            
                                                               (
                                                               i
                                                               )
                                                            
                                                         
                                                         =
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               t
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                         +
                                                         
                                                            
                                                               n
                                                            
                                                            
                                                               x
                                                            
                                                         
                                                         ,
                                                         
                                                         with
                                                         
                                                         
                                                            
                                                               n
                                                            
                                                            
                                                               x
                                                            
                                                         
                                                         ∼
                                                         N
                                                         (
                                                         0
                                                         ,
                                                         Σ
                                                         )
                                                         .
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                 
                                                if (
                                                   
                                                      Move
                                                      =
                                                      Gaussian
                                                      _
                                                      Sampling
                                                   
                                                ) then
                                             
                                          
                                          
                                             
                                                
                                                 Sample around the previous shape parameters: 
                                                   
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            t
                                                         
                                                         
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            t
                                                            -
                                                            1
                                                         
                                                         
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            θ
                                                         
                                                      
                                                   
                                                , with 
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            θ
                                                         
                                                      
                                                      ∼
                                                      N
                                                      
                                                         
                                                            
                                                               0
                                                               ,
                                                               
                                                                  
                                                                     1
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           w
                                                                        
                                                                        
                                                                           (
                                                                           i
                                                                           )
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                .
                                          
                                          
                                             
                                                 
                                                end if
                                             
                                          
                                          
                                             
                                                 – Update the weight with the likelihood 
                                                   
                                                      p
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     y
                                                                  
                                                                  
                                                                     t
                                                                  
                                                               
                                                               |
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     t
                                                                  
                                                                  
                                                                     (
                                                                     i
                                                                     )
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     θ
                                                                  
                                                                  
                                                                     t
                                                                  
                                                                  
                                                                     (
                                                                     i
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      :
                                                      
                                                         
                                                            w
                                                         
                                                         
                                                            t
                                                         
                                                         
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                      ∝
                                                      
                                                         
                                                            w
                                                         
                                                         
                                                            t
                                                            -
                                                            1
                                                         
                                                         
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                      p
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     y
                                                                  
                                                                  
                                                                     t
                                                                  
                                                               
                                                               |
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     t
                                                                  
                                                                  
                                                                     (
                                                                     i
                                                                     )
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     θ
                                                                  
                                                                  
                                                                     t
                                                                  
                                                                  
                                                                     (
                                                                     i
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                , as in Eq. (6), but taking the parameter values into account.
                                          
                                          
                                             
                                                 
                                                end for
                                             
                                          
                                          
                                             
                                                 Resampling
                                          
                                          
                                             
                                                 
                                                if (
                                                   
                                                      Move
                                                      =
                                                      MCMC
                                                   
                                                ) then
                                             
                                          
                                          
                                             
                                                 
                                                for 
                                                
                                                   
                                                      i
                                                      =
                                                      1
                                                      →
                                                      N
                                                   
                                                 
                                                do
                                             
                                          
                                          
                                             
                                                
                                                 Apply a MCMC move
                                          
                                          
                                             
                                                 
                                                end for
                                             
                                          
                                          
                                             
                                                 
                                                end if
                                             
                                          
                                          
                                             
                                                end for
                                             
                                          
                                       
                                    
                                 
                              
                           

In our application, each particle state is decomposed into a dynamic part (the pose 
                        
                           
                              
                                 x
                              
                              
                                 t
                              
                           
                        
                     ) and a static part (the scale 
                        
                           κ
                        
                      and shape parameters 
                        
                           
                              
                                 α
                              
                              
                                 i
                              
                           
                        
                     , such that 
                        
                           
                              
                                 θ
                              
                              
                                 t
                              
                           
                           =
                           
                              
                                 
                                    κ
                                    ,
                                    
                                       
                                          α
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          α
                                       
                                       
                                          M
                                       
                                    
                                 
                              
                           
                        
                     ) and must be updated and evaluated with the incoming observations. In this part, we detail how we use the images for these steps, and introduce a new way to handle noisy observations based on the particle filter structure. Then, we present the texture extraction process once the shape evaluation is done.

At each time t, the particle weights are updated by computing the likelihood of their states with the current images. This can be done with commonly used criteria, such as edge or silhouette scores [22], which compare the edges in the input images and the ones of the projected object, or feature point projection, to verify their proximity to the detections [25]. These feature points are also used to initialize the pose as shown in Algorithm 1, by fitting the mean model on these points. As we have to handle non-frontal views, noisy or outlier detections can happen, which impact this initial pose estimation. If this pose is wrong, all particles will be badly initialized (Eq. (14)), and further shape estimation and pose improvement will then not be possible. In this part, we focus on the first pose estimation performed at each instant, and propose to exploit the multi-hypotheses structure of the particle filter to improve this step.

Different types of detectors can be learned to detect specific feature points of the face, using approaches such as AdaBoost, RealBoost and SVM-learning or Bayesian networks, which are detailed in [33]. Unfortunately, when faces vary depending on pose and acquisition conditions in the videos, it is a challenge to perfectly detect all facial feature points of a face. Depending on the video properties, some points can be missing, while others can be badly detected, as shown in Fig. 3
                        . It is therefore important to take this uncertainty into account in order to handle outliers obtained with the feature point detectors.

In Algorithm 1, the pose for each particle is computed by adding some noise to the pose estimated from the set of detected feature points. Instead of using the same noisy pose version for all particles, we propose to exploit the property of multiple hypotheses representation of the particle filter by assigning different poses to particles, which are computed from different sets of feature points. Thus, we capitalize on the multi-hypothesis aspect of the particle filter to manage the outliers obtained with the feature point detectors, since some of the computed poses will be close to the correct one even if bad detections have been found (as all points are not necessarily used for this pose computation). More precisely, given a new frame, the pose of each particle is then computed as follows:
                           
                              1.
                              Select a set of valid points common to all particles:
                                    
                                       (a)
                                       For each feature point detected in all views of a given timestamp, compute its 3D coordinates and consider it as valid if the geometric reconstruction error considering the camera calibration parameters is below a given threshold 
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      c
                                                   
                                                
                                             
                                          . The outcome of this first step is a set of 3D feature points of the face.

Compute the pose parameters by fitting the mean 3D model on these reconstructed 3D points. This is done following the method in [31], combined with a RANSAC procedure to eliminate wrong feature points. The aim of this step is to find the 3D pose minimizing the distance between the 3D points selected at step (a) and the corresponding points in the 3D model. This distance is called geometric reconstruction error.

For each particle:
                                    
                                       (a)
                                       For each feature point not used previously, sample it given a probability 
                                             
                                                
                                                   
                                                      p
                                                   
                                                   
                                                      D
                                                   
                                                
                                             
                                           related to its detection confidence, and reconstruct the 3D point with the selected detections. Here again, the 3D point is kept only if the geometric reconstruction error is below a threshold 
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      c
                                                   
                                                
                                             
                                          .

Compute the pose parameters by fitting the deformed model (given the particle shape parameters) to the valid 3D points which have been reconstructed. No RANSAC algorithm is used at this step, as we want to see whether a pose is in accordance with the selected feature points.

The distribution 
                           
                              
                                 
                                    p
                                 
                                 
                                    D
                                 
                              
                           
                         can be learned for each detector D given its outputs over an annotated database. To estimate it, we construct a histogram for each detector over the interval of its responses, characterizing the rate: 
                           
                              (
                              Number of good detections
                              /
                              Number of detections
                              )
                           
                         for each bin. These histograms are then approximated by a density function in the form of a sigmoid function, characterizing the detector performances. Fig. 4
                         shows this rate given the detector output (horizontal axis) and the estimated sigmoid which has been fitted on these data. We can note that the curves differ from one detector to another, due to their different discriminative power (left eye and right eyebrow corner). A detection 
                           
                              
                                 
                                    o
                                 
                                 
                                    D
                                 
                              
                           
                         associated with a confidence c is then kept if 
                           
                              
                                 
                                    p
                                 
                                 
                                    D
                                 
                              
                              (
                              c
                              )
                              >
                              u
                              ,
                              u
                              ∼
                              U
                              [
                              0
                              ,
                              1
                              ]
                           
                        , where u is sampled for each particle. Fig. 5
                         shows the points selected with this sampling method for a set of 10 particles.

The advantage of this method is twofold. First, unlike the pose sampling proposed in Eq. (14) of Algorithm 1, no noise is added to an initial pose estimated with the mean model. Here, each particle pose is optimized following the method in [31] using its own shape parameters and the observations.

Secondly, instead of using the same set of feature points for all particles based on a binary decision with respect to its confidence and a fixed threshold, this method adds diversity to the sets of points. Good points having an average confidence may still be selected for some particles, and conversely, noisy detections or outliers with good confidence may also be rejected. For instance, in Fig. 5, we can see that the confidence of the right ear detection is not high enough to pass above the previously fixed threshold. Nevertheless, it is sampled for some particles, and is then used to estimate the pose. Other criteria, like edge comparison, will then differentiate the good particles from the bad ones, and assign higher weights to particles that selected the best set of feature points. Algorithm 2 summarizes the global workflow of this algorithm, taking the feature point sampling into account, unlike Algorithm 1. Only the systematic noise addition has been kept for the static parameter moves in this version.
                           Algorithm 2
                           Static shape parameter estimation with a particle filter and feature points management 
                                 
                                    
                                       
                                       
                                          
                                             Sample the shape parameters 
                                                   
                                                      θ
                                                   
                                                 from a prior Gaussian distribution to initialize the set of particles 
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              θ
                                                                           
                                                                           
                                                                              0
                                                                           
                                                                           
                                                                              (
                                                                              i
                                                                              )
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              w
                                                                           
                                                                           
                                                                              0
                                                                           
                                                                           
                                                                              (
                                                                              i
                                                                              )
                                                                           
                                                                        
                                                                        =
                                                                        1
                                                                        /
                                                                        N
                                                                     
                                                                  
                                                               
                                                               ,
                                                               
                                                               i
                                                               =
                                                               1
                                                               ,
                                                               …
                                                               ,
                                                               N
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                for 
                                                
                                                   
                                                      t
                                                      =
                                                      1
                                                      →
                                                      
                                                         
                                                            N
                                                         
                                                         
                                                            frames
                                                         
                                                      
                                                   
                                                 
                                                do
                                             
                                          
                                          
                                             
                                                 Input: noisy 2D feature point positions.
                                          
                                          
                                             
                                                 
                                                for 
                                                
                                                   
                                                      i
                                                      =
                                                      1
                                                      →
                                                      N
                                                   
                                                 
                                                do
                                             
                                          
                                          
                                             
                                                 – Sample around the previous shape parameters: 
                                                   
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            t
                                                         
                                                         
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            t
                                                            -
                                                            1
                                                         
                                                         
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            θ
                                                         
                                                      
                                                   
                                                , with 
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            θ
                                                         
                                                      
                                                      ∼
                                                      N
                                                      (
                                                      0
                                                      ,
                                                      
                                                         
                                                            Σ
                                                         
                                                         
                                                            θ
                                                         
                                                      
                                                      )
                                                   
                                                .
                                          
                                          
                                             
                                                 – Sample a subset of feature points given their confidence and fit the pose of the current shape model using the method by [31].
                                          
                                          
                                             
                                                 – Update the weight with the likelihood 
                                                   
                                                      p
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     y
                                                                  
                                                                  
                                                                     t
                                                                  
                                                               
                                                               |
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     t
                                                                  
                                                                  
                                                                     (
                                                                     i
                                                                     )
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     θ
                                                                  
                                                                  
                                                                     t
                                                                  
                                                                  
                                                                     (
                                                                     i
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                : 
                                                   
                                                      
                                                         
                                                            w
                                                         
                                                         
                                                            t
                                                         
                                                         
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                      ∝
                                                      
                                                         
                                                            w
                                                         
                                                         
                                                            t
                                                            -
                                                            1
                                                         
                                                         
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                      p
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     y
                                                                  
                                                                  
                                                                     t
                                                                  
                                                               
                                                               |
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     t
                                                                  
                                                                  
                                                                     (
                                                                     i
                                                                     )
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     θ
                                                                  
                                                                  
                                                                     t
                                                                  
                                                                  
                                                                     (
                                                                     i
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                .
                                          
                                          
                                             
                                                 
                                                end for
                                             
                                          
                                          
                                             
                                                 Resampling
                                          
                                          
                                             
                                                end for
                                             
                                          
                                       
                                    
                                 
                              
                           

For each frame and each camera, a texture map is extracted from the corresponding image to get color information on the face. For each pixel, a score is associated with this color, in order to define its quality. As the texture of the face is best viewed in a frontal view with respect to the camera optical axis, the quality is defined using a criterion expressing how frontal each facet of the model mesh is. Thus, for each pixel 
                           
                              (
                              x
                              ,
                              y
                              )
                           
                         in the texture map which is visible in the input image, its quality 
                           
                              qual
                              (
                              x
                              ,
                              y
                              )
                           
                         is computed as:
                           
                              (15)
                              
                                 qual
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      →
                                                   
                                                
                                             
                                             
                                                f
                                                (
                                                x
                                                ,
                                                y
                                                )
                                             
                                          
                                          ·
                                          
                                             
                                                z
                                             
                                             
                                                →
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    
                                       
                                          n
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    f
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                              
                           
                         is the normal to the face represented at pixel 
                           
                              (
                              x
                              ,
                              y
                              )
                           
                         and 
                           
                              
                                 
                                    z
                                 
                                 
                                    →
                                 
                              
                           
                         the direction vector of the camera optical axis.

To obtain the most complete texture map, an intermediate step of texture map fusion has to be performed. We use a linear combination of the texture maps 
                           
                              
                                 
                                    TM
                                 
                                 
                                    i
                                 
                              
                           
                         extracted from different views v 
                        
                           
                              (
                              v
                              =
                              1
                              ,
                              …
                              ,
                              V
                              )
                           
                         at time t and weighted by the criterion presented above. Each pixel 
                           
                              TM
                              (
                              x
                              ,
                              y
                              )
                           
                         of the resulting texture map is computed from the corresponding pixels in the extracted texture maps 
                           
                              
                                 
                                    TM
                                 
                                 
                                    v
                                 
                              
                           
                         as follows:
                           
                              (16)
                              
                                 TM
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                          =
                                          1
                                       
                                       
                                          V
                                       
                                    
                                 
                                 
                                    
                                       qual
                                    
                                    
                                       v
                                    
                                 
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 
                                    
                                       TM
                                    
                                    
                                       v
                                    
                                 
                                 (
                                 x
                                 ,
                                 y
                                 )
                              
                           
                        
                     

Finally, a frontal view is generated using the shape deformations and the texture map that have been computed from the video sequence. This global workflow is illustrated in Fig. 6
                        .

To evaluate the proposed particle filter, we compare it to an optimization method based on the Levenberg–Marquardt (LM) algorithm [24]. This method attempts to iteratively minimize an error defined with criteria similar to those used in the particle filter, by mixing gradient descent and Gauss–Newton algorithms. Unlike the particle filter method, this method is global, meaning that it estimates jointly the poses for all frames and the shape parameters (the same for the whole sequence). We use the levmar library available online to this end [20].

Let 
                        
                           
                              
                                 y
                              
                              
                                 1
                                 :
                                 T
                              
                           
                           =
                           
                              
                                 
                                    
                                       
                                          y
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          T
                                       
                                    
                                 
                              
                           
                        
                      be the set of observations available in the video sequence, such as feature point positions, gradients, silhouettes, and 
                        
                           u
                           =
                           
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          T
                                       
                                    
                                    ,
                                    θ
                                 
                              
                           
                        
                      the vector containing the unknown values, which are the poses and shape parameters. We apply a global optimization using all observations together. The feature points 
                        
                           
                              
                                 y
                              
                              
                                 ̃
                              
                           
                        
                      corresponding to the estimated poses and deformations 
                        
                           
                              
                                 u
                              
                              
                                 ̃
                              
                           
                        
                      can be projected in order to compare them to the feature point detections, corresponding to the observations y. The idea of the algorithm is then to minimize the error 
                        
                           ‖
                           y
                           -
                           
                              
                                 y
                              
                              
                                 ̃
                              
                           
                           
                              
                                 ‖
                              
                              
                                 2
                              
                           
                        
                     , considering the following energy:
                        
                           (17)
                           
                              
                                 
                                    E
                                 
                                 
                                    points
                                 
                              
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       t
                                       =
                                       1
                                    
                                    
                                       T
                                    
                                 
                              
                              
                                 
                                    1
                                 
                                 
                                    D
                                    (
                                    t
                                    )
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                p
                                                =
                                                1
                                             
                                             
                                                D
                                                (
                                                t
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        x
                                                                     
                                                                     
                                                                        proj
                                                                     
                                                                  
                                                                  (
                                                                  p
                                                                  ,
                                                                  t
                                                                  ,
                                                                  
                                                                     
                                                                        X
                                                                     
                                                                     
                                                                        t
                                                                     
                                                                  
                                                                  ,
                                                                  θ
                                                                  )
                                                               
                                                               
                                                                  ︸
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  y
                                                               
                                                               
                                                                  ̃
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        x
                                                                     
                                                                     
                                                                        det
                                                                     
                                                                  
                                                                  (
                                                                  p
                                                                  ,
                                                                  t
                                                                  )
                                                               
                                                               
                                                                  ︸
                                                               
                                                            
                                                         
                                                         
                                                            y
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        
                     where t is the frame index, 
                        
                           D
                           (
                           t
                           )
                        
                      is the number of detected feature points at time 
                        
                           t
                           ,
                           p
                        
                      the index of these feature points, 
                        
                           
                              
                                 x
                              
                              
                                 det
                              
                           
                           (
                           p
                           ,
                           t
                           )
                        
                      their 2D positions and 
                        
                           
                              
                                 x
                              
                              
                                 proj
                              
                           
                           (
                           p
                           ,
                           t
                           ,
                           
                              
                                 X
                              
                              
                                 t
                              
                           
                           ,
                           θ
                           )
                        
                      the projection of the corresponding points from the model in the images given the current estimation of pose 
                        
                           
                              
                                 X
                              
                              
                                 t
                              
                           
                        
                      and shape 
                        
                           θ
                        
                     . Let 
                        
                           
                              
                                 x
                              
                              
                                 2
                                 d
                              
                           
                        
                      be the 2D homogeneous coordinates of the projection; the value 
                        
                           
                              
                                 x
                              
                              
                                 proj
                              
                           
                           (
                           p
                           ,
                           t
                           ,
                           
                              
                                 X
                              
                              
                                 t
                              
                           
                           ,
                           θ
                           )
                        
                      is computed as follows:
                        
                           (18)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      2
                                                      d
                                                   
                                                
                                                =
                                                A
                                                
                                                   
                                                      
                                                         
                                                            
                                                               R
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                         κ
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        S
                                                                     
                                                                     
                                                                        ‾
                                                                     
                                                                  
                                                                  (
                                                                  p
                                                                  )
                                                                  +
                                                                  
                                                                     
                                                                        
                                                                           ∑
                                                                        
                                                                        
                                                                           i
                                                                           =
                                                                           1
                                                                        
                                                                        
                                                                           M
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        α
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        s
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  (
                                                                  p
                                                                  )
                                                               
                                                            
                                                         
                                                         +
                                                         
                                                            
                                                               T
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      proj
                                                   
                                                
                                                (
                                                p
                                                ,
                                                t
                                                ,
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      t
                                                   
                                                
                                                ,
                                                θ
                                                )
                                                =
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     2
                                                                     d
                                                                  
                                                               
                                                               [
                                                               0
                                                               ]
                                                            
                                                            
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     2
                                                                     d
                                                                  
                                                               
                                                               [
                                                               2
                                                               ]
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     2
                                                                     d
                                                                  
                                                               
                                                               [
                                                               1
                                                               ]
                                                            
                                                            
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     2
                                                                     d
                                                                  
                                                               
                                                               [
                                                               2
                                                               ]
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                (
                                                2D-coordinates after normalization
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     with 
                        
                           
                              
                                 T
                              
                              
                                 t
                              
                           
                           =
                           (
                           
                              
                                 x
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 z
                              
                              
                                 t
                              
                           
                           )
                        
                      the translation and 
                        
                           
                              
                                 R
                              
                              
                                 t
                              
                           
                        
                      the rotation matrix derived from the pose 
                        
                           
                              
                                 X
                              
                              
                                 t
                              
                           
                        
                      at time 
                        
                           t
                           ,
                           κ
                        
                      and 
                        
                           
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    i
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    M
                                 
                              
                           
                        
                     , respectively the scale and the deformation values, and A the 
                        
                           3
                           ×
                           3
                        
                      projection matrix given the intrinsic camera parameters, which are supposed to be known in our experiments.

In addition to the retroprojection criterion, other criteria are used, as the ones introduced in [25]. In our case, the error then depends on the feature point projection term, an internal edge term, a silhouette term and a validity term for the shape parameters. The associated energy is a linear combination of those terms, with weights 
                        
                           
                              
                                 η
                              
                              
                                 c
                              
                           
                           ,
                           
                              
                                 η
                              
                              
                                 s
                              
                           
                        
                      and 
                        
                           
                              
                                 η
                              
                              
                                 model
                              
                           
                        
                      which need to be empirically determined. Except for the shape validity term (
                        
                           
                              
                                 E
                              
                              
                                 model
                              
                           
                        
                     ), all terms are computed for every frame. The function to minimize is then:
                        
                           (19)
                           
                              
                                 
                                    
                                    
                                       
                                          E
                                          =
                                          
                                             
                                                1
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   t
                                                   =
                                                   1
                                                
                                                
                                                   T
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         D
                                                         (
                                                         t
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            p
                                                            =
                                                            1
                                                         
                                                         
                                                            D
                                                            (
                                                            t
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     proj
                                                                  
                                                               
                                                               (
                                                               p
                                                               ,
                                                               t
                                                               ,
                                                               
                                                                  
                                                                     X
                                                                  
                                                                  
                                                                     t
                                                                  
                                                               
                                                               ,
                                                               θ
                                                               )
                                                               -
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     det
                                                                  
                                                               
                                                               (
                                                               p
                                                               ,
                                                               t
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                          +
                                          
                                             
                                                1
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   t
                                                   =
                                                   1
                                                
                                                
                                                   T
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         η
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         t
                                                         ,
                                                         
                                                            
                                                               X
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                         ,
                                                         θ
                                                         )
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         η
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         t
                                                         ,
                                                         
                                                            
                                                               X
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                         ,
                                                         θ
                                                         )
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                          +
                                          
                                             
                                                η
                                             
                                             
                                                model
                                             
                                          
                                          
                                             
                                                E
                                             
                                             
                                                model
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     with 
                        
                           
                              
                                 d
                              
                              
                                 c
                              
                           
                        
                      and 
                        
                           
                              
                                 d
                              
                              
                                 s
                              
                           
                        
                      two distances characterizing the error between the model and the observations for the internal edges and the silhouette criteria respectively, and the last term corresponding to the realism of the face (like the associated probability proposed in Eq. (3) or a regularity criterion for the deformed mesh).

The Levenberg–Marquardt algorithm needs an initial value 
                        
                           
                              
                                 u
                              
                              
                                 0
                              
                           
                        
                      for the unknown poses and shape parameters. The deformation parameters are set to zero (mean model), the scale 
                        
                           
                              
                                 κ
                              
                              
                                 0
                              
                           
                        
                      to a mean value calculated over a database and the poses are estimated using the method in [31] combined with RANSAC. The Levenberg–Marquardt algorithm uses the Jacobian of E, with respect to the unknown variables, to optimize the output state u. If we only use the feature points and the prior criteria, an analytical expression can be computed (Appendix A). If other criteria are included, a closed form solution is no longer available, and the Jacobian must be evaluated by finite differences, which increases computing time.

@&#EVALUATION@&#

In this section, we will start by validating the proposed algorithm on a database of synthetic sequences for which the ground truth is available in terms of pose and shape parameters. After that, we will present the results of our method on real databases, both on visual aspects and biometric performances, which is the final purpose of the 3D face reconstruction in our case. Comparative results with the LM approach are presented in this second part, and show the interest of our approach.

To evaluate the different versions of the particle filter presented in Section 3.2 (systematic noise addition possibly parametrized by the weight, and MCMC with local or global sampling), we first give some convergence results on synthetic data (examples are given in Fig. 7
                           ), for which the ground truth values for the pose and the shape parameters are known.

The test faces are generated with two shape parameters sampled from the normal distribution, the pose during the sequence is similar to the one in real sequences, and the images are obtained with the same calibration parameters as the four cameras acquisition system which will be detailed in Section 6.2.

We tested the different particle filter methods on noisy data (
                              
                                 σ
                                 =
                                 2
                              
                            pixels for the feature point inputs), to simulate detector answers on real data. To illustrate the impact of the chosen standard deviation, we compare it to the distribution of the feature point positions given the morphable model and represent it in Fig. 8
                           . The distances between the eyes are 80 pixels in this figure, which can be compared to the corresponding distance in the input images, which ranges between 70 and 100 pixels. The standard deviations for each feature point are represented in Table 1
                           , and are also given relatively to a distance of 80 pixels between the eyes. This feature point information leads to an approximate pose initialization and to a score function disturbed by the addition of Gaussian noise.


                           With known dynamic state. In a first experiment, we check the convergence of the particle static states towards the correct shape parameters when the head pose is known. In this case, the only unknown variables are the two static shape parameters, and we use therefore only 100 particles. The best particle at each instant (red cross), the filter mean (dashed light blue line) and variance (dotted dark blue line) are plotted for one sequence in Fig. 9
                           . They can be compared to the ground truth values plotted with a solid green line (GT). We observe that the mean of the filter converges towards the real parameters, and that the variance decreases at the beginning of the sequence before stabilizing. In this example, even if few particles are sampled around the true first parameter at the initialization step, the whole set of particles moves towards this value over the sequence.


                           With unknown dynamic state. To simulate real data issues, in which the pose is not known, we now integrate the hidden dynamic state 
                              
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                              
                            in the estimation process. Besides the two unknown shape parameters already estimated before, there are now six more time-varying unknown variables, corresponding to the 3D position of the head and the 3 rotation angles. This explains why we use 
                              
                                 N
                                 =
                                 2500
                              
                            particles in this experiment, still conducted on synthetic data, instead of 
                              
                                 N
                                 =
                                 100
                              
                            in the previous one. The pose 
                              
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                    
                                       (
                                       i
                                       )
                                    
                                 
                              
                            of each particle is therefore generated as explained in Algorithm 1.


                           Robustness to the pose error. We initially evaluate the algorithm robustness to an initial pose error. To this end, we launch the algorithm using various input poses as initial pose estimation 
                              
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                    
                                       0
                                    
                                 
                              
                            in Eq. (14) for each time t: first the true pose, before adding various yaw angle errors (2, 4, 6, 8 and 10 degrees) to it. Particle poses are then sampled around this modified pose input. Fig. 10
                            illustrates the results, by representing for each error threshold 
                              
                                 ∊
                              
                            (X-axis), the number of sequences (Y-axis) for which the error on the first parameter is below this threshold value. It shows that for an error on the initial yaw estimation that is less than 6 degrees, the convergence results are comparable. For higher errors, too few particles are sampled around the true pose which makes the convergence more difficult. An example of a sequence for which the initial pose is poorly estimated is shown in Fig. 11
                           : given the dynamic noise 
                              
                                 
                                    
                                       n
                                    
                                    
                                       x
                                    
                                 
                              
                           , the number of particles and the initial pose error, no particle is sampled close enough to the good values to have a high likelihood. The move and resampling steps cannot be guided to the appropriate subspaces, and the convergence can, therefore, not be achieved. A higher dynamic noise 
                              
                                 
                                    
                                       n
                                    
                                    
                                       x
                                    
                                 
                              
                            in Eq. (14), associated with more particles, can be considered if larger pose errors are expected. However, increasing the noise would also lead to less accurate results in case of correct initial pose, and a compromise therefore needs to be found.


                           Gaussian noise on the static parameters. Fig. 12
                            shows the filter evolution for the same sequence as in Fig. 9, but with unknown pose parameters. The artificial dynamics are Gaussian noises with fixed covariance for all particles. We can see that the deviation of the particle distribution is larger than in the previous case. As the pose is estimated simultaneously with the parameters, the space dimension is higher, and it is difficult to differentiate particles having correct poses but wrong shape parameters from the ones having the inverse configuration. The shape parameter filtering therefore needs more time to eliminate the wrong states and to converge.


                           Adaptive noise. Fig. 13
                            shows some convergence results given input data without noise. When adding a noise of 2 pixels to the feature point positions, we get the results presented in Fig. 14
                           . Despite this observation alteration, filter means for the static parameters are close to the true values.


                           MCMC moves. This method uses a validation step before modifying the static parameters sampled for a particle. We evaluate two types of sampling: local sampling around the current value, and global sampling given the Gaussian prior. The move is only applied on the static shape parameters, thus optimizing the shape at a fixed pose. This step requires a new likelihood computation, that should theoretically be done on the whole set of observations 
                              
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                              
                           . In this case, the validity of the previously computed poses 
                              
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       i
                                       )
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                    
                                       (
                                       i
                                       )
                                    
                                 
                              
                            is not guaranteed. This is why we use 
                              
                                 
                                    
                                       Δ
                                    
                                    
                                       T
                                    
                                 
                                 =
                                 0
                              
                           , meaning that only the current view is used to compute the move acceptation. Fig. 15
                            shows the filter evolution for the two types of sampling methods, which lead to similar results.


                           Methods comparison. Let 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       GT
                                    
                                    
                                       1
                                    
                                 
                              
                            be the true value of the first shape parameter and 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       eval
                                    
                                    
                                       1
                                    
                                 
                              
                            the mean value over the particle states. To evaluate the different methods, we measure the error 
                              
                                 ∊
                                 =
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       eval
                                    
                                    
                                       1
                                    
                                 
                                 -
                                 
                                    
                                       θ
                                    
                                    
                                       GT
                                    
                                    
                                       1
                                    
                                 
                                 |
                              
                            for our 39 synthetic sequences on the last frame of the sequence. Fig. 16
                            shows that all methods provide globally similar results. Curves 3–5 present results when a noise is added on the static parameters at each instant. Using an adaptive noise (curve 4) instead of a fixed noise (curve 5) results in more accuracy thanks to a better state space exploration. We can also notice that the prior sampling of the shape parameters (normal distribution with parameters 
                              
                                 (
                                 m
                                 =
                                 0
                                 ,
                                 σ
                                 =
                                 1.0
                                 )
                              
                            for curve 3, 
                              
                                 (
                                 m
                                 =
                                 0
                                 ,
                                 σ
                                 =
                                 1.7
                                 )
                              
                            for curve 4) influences slightly the curves: if the normal distribution has a larger deviation, it becomes easier to reach large values of the parameters, as more particles will then be sampled around the true value. Conversely, for narrow initial sampling, the particles are concentrated in a smaller area, which leads to more accurate results when the parameters are close to zero. This explains why curve 3 is above the others when the error is small. The highest error is around 
                              
                                 0.6
                              
                            for 
                              
                                 σ
                                 =
                                 1.7
                              
                            (curve 4), against 
                              
                                 0.85
                              
                            using standard normal distribution (curve 5). These values can be compared to the interval covered by all 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       GT
                                    
                                    
                                       1
                                    
                                 
                              
                            values of our database, 
                              
                                 
                                    
                                       
                                          -
                                          2.97
                                          ;
                                          2.10
                                       
                                    
                                 
                              
                           , sampled from the standard normal distribution. Using the weight adaptive noise method and a large deviation for the initial parameter sampling, 87% of runs provide an error of less than 
                              
                                 0.34
                              
                            (
                              
                                 6.7
                              
                           % of the interval width).

Although MCMC moves involve a validation step using the Metropolis–Hastings algorithm, the two evaluated methods (curves 1 and 2) do not outperform the previous ones, based on a systematic noise addition. Automatic noise methods may therefore be preferred since the other methods do not provide significant accuracy improvements despite their higher computational cost.


                           Failure cases. For some sequences, the true values are never reached during the filtering process. The explanation is twofold. First, it can be due to the model prior used to initialize the static parameter particles. The more true parameters are different from zero (
                              
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       GT
                                    
                                    
                                       i
                                    
                                 
                                 |
                                 ⩾
                                 1
                              
                           ), the smaller the probability to sample particles around these true values, and the static parameter moves made afterward do not always compensate for the initialization (Fig. 11a). Secondly, the 3D pose can be poorly estimated, for instance with very noisy detections. As all particle poses are sampled around it, no poses will be close to the true one with a bad initialization. In this case, the shape optimization will not succeed, because a good pose approximation is required to estimate the parameters.

These two issues are sometimes related. When the observed face is very different from the mean shape (meaning that 
                              
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       GT
                                    
                                    
                                       i
                                    
                                 
                                 |
                                 ≫
                                 0
                              
                            for some i), the pose estimated by fitting the mean model is not accurate, as the feature point positions are not the same on the current face and on the mean one (Fig. 11b). In this case, there are few particles in the appropriate pose and shape subspaces. This is why we proposed to initialize the pose with each particle shape model in Section 4.1, at the cost of N pose fittings. The following results on real data were obtained with this improvement.

We extend now the evaluation of our algorithm on several real datasets acquired in our laboratory. The different scenarios are presented in the next section, before analyzing the visual and biometric results we obtained. The aim of this part is to evaluate the effectiveness of our method on real data, with noisy or outlier detections, and heads to be estimated which cannot be perfectly described by our head model.

The datasets used for our evaluation were acquired in our laboratory and correspond to a standard use of face recognition gates. They differ in terms of acquisition conditions (indoor or outdoor sequences, use of specific lightening system), of number of cameras (3 or 4), and of user behavior (stop during the walk through the gate). The different types of databases are listed in Table 2
                           . As illustrated by the image samples in Fig. 17
                           , the head poses seen in the camera coordinate system vary generally between half-profile and frontal pose, in addition to some pitch angle. There are no extreme poses (for instance, no profile views), as we consider the case of cooperative behavior of users who want to be recognized. Indeed, the system used to acquire these videos is an authentication system conceived to obtain good views of faces, but limiting the constraints for users during the acquisition.

No ground truth is available in terms of shape parameters and poses for these real databases, and only 2D-acquisitions are given to evaluate the quality of our results. For this reason, we propose two types of evaluation; the first one is based on visual control, to illustrate some results with the different methods implemented, and the second one is performed on biometric results.

A first analysis has been conducted on visual outputs of our algorithm, such as the mesh projections on input images, the extracted texture maps and resulting frontal views. Fig. 18
                            shows the mesh projection given the estimated pose and shape parameters at the end of the sequence. Additionally, it illustrates how the internal edges and the feature points fit to the corresponding features on the observations.

The evolution of the fitting quality between the beginning and the end of a sequence is presented in Fig. 19
                           . The improvement is especially visible on the silhouette criterion, because the mean model used at the beginning is not adapted to the observed face.


                           Comparison with the Levenberg–Marquardt method. We first present some visual results to compare the output of the Levenberg–Marquardt method versus our particle filter. Fig. 20
                            shows the mesh projections for two sequences, using the LM optimization algorithm on the one hand and the particle filter method on the other hand. We can notice that the shape estimated by the Levenberg–Marquardt method is highly distorted on the first two images, because feature points have been badly detected and miss-detections are not handled. The multiple hypotheses evaluated with the particle filter method allows us to find a better pose, and thus leads to an improved set of shape parameters. Moreover, with our online method, even if one frame has bad inputs, it will not affect the whole estimation, because improvements can be obtained with further observations. We can also note that no temporal consistency is verified when using the Levenberg–Marquardt method, while in our case, we verify that the pose estimation is consistent with the previous one for each particle. Thus, we avoid punctual aberrant poses in the trajectory. On the third image in the first line, we can see that the head pose is disturbed on the left by a bad ear detection: the head pose veered off to the left to get closer to this detection. With our method, some of the particles do not use this detection to fit the head, which leads to a better fitting regarding the different criteria. These particles will be duplicated during the resampling process, and lead to the displayed pose and shape estimation.

In order to show the impact of the proposed algorithm on face recognition systems, we also analyze its performance relatively to a biometric evaluation. There is certainly a bias using this type of validation, as we cannot perfectly measure the impact of the shape estimation on the whole face comparison algorithm. Still, better pose and shape estimations improve the frontal views used as input for the comparison step. Moreover, due to the purposes of face recognition systems, we believe that this measure is relevant.


                           Face comparison. To compare images of faces for recognition purposes, discriminative information has to be extracted from each of them. Among the existing methods used for face comparison, Gabor filters [19] or LBP [1] are the most commonly used descriptors. Once computed, these characteristics are associated and used to compute the distance between two facial feature vectors. A survey of face recognition algorithms using single images or videos is proposed in [14]. The extraction of facial specificities can be done on all images of a tracklet, or applied on a subset of images only. The output of this step is concatenated in a facial template. In our case, all templates are computed from a single image, which can be one of the input images directly, or the frontal view generated once the shape has been estimated with either our particle filter or the Levenberg–Marquardt algorithm. To establish biometric performances, we compare them to templates generated from ID picture, where the face is seen frontally with controlled illumination and neutral expression. The distance between these templates is finally related to a score which characterizes how similar the two faces are.


                           Temporal estimation improvement. The first experiment consists in studying the evolution of the face comparison score between the ID picture of the person walking through the gate, and the reconstructed frontal view at each instant. As the estimation is updated with each new incoming observation, its accuracy should be updated at each instant (at least if the acquisition conditions are constant). We evaluate the gain of our algorithm by analyzing the comparison score between the frontal view generated at each time t and the reference picture (the frontal face stored in the ID document).


                           Fig. 21
                            shows the evolution of this score for two sequences (time is on the X-axis). The red crosses correspond to frontal views generated from single images at time t, and the blue circles to views obtained after merging the texture maps in the available views at the same time, following the method described in Section 4.2. We can notice that the comparison scores are usually higher with the merged texture (especially for the I1 database), as the head is not necessarily seen frontally, and the texture map extracted in a single image is not complete. Besides, the comparison scores increase throughout the sequence on the whole. The score decrease at the end of the I1 sequence can be explained by two factors: first, in some configurations, the pose becomes less frontal when the face gets closer to the cameras. Less feature points are visible and the detection quality is lower, which leads to badly estimated poses. Secondly, the face can be over-exposed at the end when specific lights are used, which leads to less contrast or unwanted shadows over the face. Since face comparison algorithms are sensitive to the gradient positions in the face, such artifacts can modify the scores to a similar extend as modifications induced by errors on shape and pose. We therefore recommend using the estimation obtained a few images before the end with the 4-camera configuration. The comparison scores can differ from one identity to another, as they depend on the facial changes between the reference picture and the acquisitions. Indeed, if a person changed a lot between two acquisitions (ageing, make-up, etc.), the similarity score will be lower than for two images taken in a short time. This is related to the face comparison algorithms that are not necessarly robust to all these factors. This explains why the values obtained in the two curves of Fig. 21 are not the same (in addition to the difference between the two acquisition systems), because different identities have been considered.

The comparison with the LM method is shown in Fig. 22
                           , in which we can see that the face comparison score is higher with the particle filter, thanks to a better pose and shape estimation.


                           Recognition rate evaluation. Finally we analyze our reconstruction algorithm in terms of biometric performances over a full database, using DET curves (False Reject Rate versus False Acceptance Rate). With such measures, one can easily determine how many persons have been rejected for a given rate of false acceptance. The smallest the FRR, the better are the results. Indeed, a perfect system ideally rejects all false pairs (no False Acceptance) and accepts all true pairs (which corresponds to 0 False Rejection).


                           Fig. 23
                            shows the FRR performances for different values of FAR, using observations at different instants to generate the frontal view. To compute these performances, each generated frontal view for a sequence has been compared to a reference basis containing 1086 items. As frontal views obtained after texture fusion between the views of the considered instant have better scores than the ones computed from each image separately, we only use the merged frontal view. This figure illustrates the performance evolution when new frames are used to update the model. We can notice some improvement at the beginning of the sequence, because new images help to increase the parameter accuracy which results in a better shape fitting. Nevertheless, performances deteriorate slightly when adding the last images, because of the non-frontal pose and the illumination conditions. These are reflected in the quality of the texture used for the frontal view generation which is only extracted from the images corresponding to the last instant used in the estimation. This observation can be linked to the one on temporal improvement analysis, when comparison scores decrease at the end of the sequence. An additional criterion taking lighting conditions into account could therefore be interesting for choosing the appropriate images for the texture extraction.

Comparisons between the FRR-FAR performances for the LM and the PF methods are given in Table 3
                           . We report results at 
                              
                                 FAR
                                 =
                                 
                                    
                                       10
                                    
                                    
                                       -
                                       2
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       10
                                    
                                    
                                       -
                                       3
                                    
                                 
                              
                           , according to the constraints presented in [21], in terms of number of impostors tests. The estimations are computed at three instants, and with three different methods: the LM with the single frame 
                              
                                 
                                    
                                       t
                                    
                                    
                                       T
                                    
                                 
                              
                            as input, and the PF and the LM with frames 
                              
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                              
                            to 
                              
                                 
                                    
                                       t
                                    
                                    
                                       T
                                    
                                 
                              
                           . Since results are similar with the two LM methods, we only indicate the gain of our method given the ones obtained with the LM over the whole sequence. Improvements are seen for all databases, which confirms the visual results presented in Section 6.2.2. Compared with the FRR obtained with the LM method, the mean reduction of false rejections reaches 10%.

To illustrate the improvement achieved by the step of frontalization, we add the following experiment on the database I1. Instead of using different images and generating a frontal view for the coding step, we select a single image using the following criterion:
                              
                                 (20)
                                 
                                    Qual
                                    (
                                    image
                                    )
                                    =
                                    faceSize
                                    .
                                    
                                       min
                                    
                                    (
                                    leftEye
                                    .
                                    conf
                                    ,
                                    rightEye
                                    .
                                    conf
                                    )
                                 
                              
                           The best image (BI) selected with this criterion corresponds to faces with high resolution (faceSize) and good detection scores (
                              
                                 leftEye
                                 .
                                 conf
                              
                            and 
                              
                                 rightEye
                                 .
                                 conf
                              
                            are left and right eye confidence values). As our detectors were learned on frontal views, the detection confidences will be higher for such faces. We compare this method with the previous particle filter applied on a single instant corresponding to the one of the best image selected, and to the particle filter applied on the video sequence until the time associated to the best image. The improvement achieved by the use of synthetic frontal views for the coding and comparison steps is given by the relative FRR reduction of the particle filter algorithms with respect to the FRR provided by the method applied on the 2D best image only (without any frontalization) 
                              
                                 
                                    
                                       
                                          
                                             
                                                FRR
                                             
                                             
                                                PF
                                             
                                          
                                          -
                                          
                                             
                                                FRR
                                             
                                             
                                                BI
                                             
                                          
                                       
                                    
                                 
                                 /
                                 
                                    
                                       FRR
                                    
                                    
                                       BI
                                    
                                 
                              
                           :
                              
                                 •
                                 
                                    
                                       
                                          -
                                          41
                                          %
                                       
                                     on a single timestamp, 
                                       
                                          -
                                          45
                                          %
                                       
                                     on the sequence, at 
                                       
                                          FAR
                                          =
                                          
                                             
                                                10
                                             
                                             
                                                -
                                                2
                                             
                                          
                                       
                                    ;


                                    
                                       
                                          -
                                          24
                                          %
                                       
                                     on a single timestamp, 
                                       
                                          -
                                          27
                                          %
                                       
                                     on the sequence, at 
                                       
                                          FAR
                                          =
                                          
                                             
                                                10
                                             
                                             
                                                -
                                                3
                                             
                                          
                                       
                                    .

These results show that applying our particle filter algorithm to estimate the pose and shape, and using the associated frontal views has a high impact on the biometric performances. Indeed, we cannot guarantee that faces are seen frontally in the best image, thus reducing the face comparison accuracy. The use of the particle filter on several timestamps provides even better results.

We have presented a novel approach to estimation of the 3D pose and shape of a head in a video sequence. Considering the shape parameters as part of the hidden state in the particle filter algorithm, our method allows us to update the parameter distribution at each instant. Moreover, using the multi-hypothesis structure of the set of particles, we handle outliers in the set of feature points by varying the initial pose for each particle. In this way, there is also less chance of getting a solution trapped in a local maximum. Both visual and biometric results showed the interest of our particle filter-based method. In the future, we will adapt our algorithm to single camera and/or uncalibrated configurations in order to allow genericity and extend its use to new applications.

@&#ACKNOWLEDGMENTS@&#

This work has been supported in part by the National Agency for Research and Technology (ANRT). We are grateful to all people which took part in our acquisitions in the Morpho laboratory and agreed to appear in this article.

We present here the derivative computation for one point detected at time 
                        
                           
                              
                                 t
                              
                              
                                 ̃
                              
                           
                        
                      for the feature point retroprojection criterion only. Derivation with respect to the prior term is computed in the similar way, while finite differences are used for the other criteria, as the derivative expressions are not available.

The derivatives with respect to the scale parameter are given by:
                        
                           (A.1)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      κ
                                                   
                                                
                                                =
                                                
                                                   
                                                      AR
                                                   
                                                   
                                                      t
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               ‾
                                                            
                                                         
                                                         (
                                                         p
                                                         )
                                                         +
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  i
                                                                  =
                                                                  1
                                                               
                                                               
                                                                  M
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               α
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         
                                                            
                                                               s
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         (
                                                         p
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            proj
                                                         
                                                      
                                                      (
                                                      p
                                                      ,
                                                      t
                                                      ,
                                                      
                                                         
                                                            X
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      ,
                                                      θ
                                                      )
                                                   
                                                   
                                                      ∂
                                                      κ
                                                   
                                                
                                                [
                                                k
                                                ]
                                                =
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  2
                                                                  d
                                                               
                                                            
                                                            [
                                                            k
                                                            ]
                                                         
                                                         
                                                            ∂
                                                            κ
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      [
                                                      2
                                                      ]
                                                      -
                                                      
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  2
                                                                  d
                                                               
                                                            
                                                            [
                                                            2
                                                            ]
                                                         
                                                         
                                                            ∂
                                                            κ
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      [
                                                      k
                                                      ]
                                                   
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      
                                                         
                                                            [
                                                            2
                                                            ]
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                                
                                                for
                                                
                                                k
                                                =
                                                0
                                                ,
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     and the ones with respect to the shape parameter 
                        
                           
                              
                                 α
                              
                              
                                 i
                              
                           
                        
                      are:
                        
                           (A.2)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            α
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                                =
                                                κ
                                                A
                                                (
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      t
                                                   
                                                
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      i
                                                   
                                                
                                                (
                                                p
                                                )
                                                )
                                             
                                             
                                                for
                                                
                                                i
                                                =
                                                1
                                                ⋯
                                                M
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            proj
                                                         
                                                      
                                                      (
                                                      p
                                                      ,
                                                      t
                                                      ,
                                                      
                                                         
                                                            X
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      ,
                                                      θ
                                                      )
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            α
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                                [
                                                k
                                                ]
                                                =
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  2
                                                                  d
                                                               
                                                            
                                                            [
                                                            k
                                                            ]
                                                         
                                                         
                                                            ∂
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      [
                                                      2
                                                      ]
                                                      -
                                                      
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  2
                                                                  d
                                                               
                                                            
                                                            [
                                                            2
                                                            ]
                                                         
                                                         
                                                            ∂
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      [
                                                      k
                                                      ]
                                                   
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      
                                                         
                                                            [
                                                            2
                                                            ]
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                for
                                                
                                                k
                                                =
                                                0
                                                ,
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     when the model constraint is related to the parameter probability (Eq. (3)). All derivatives 
                        
                           
                              
                                 ∂
                                 E
                              
                              
                                 ∂
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                              
                           
                           ,
                           
                              
                                 ∂
                                 E
                              
                              
                                 ∂
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                              
                           
                           ,
                           
                              
                                 ∂
                                 E
                              
                              
                                 ∂
                                 
                                    
                                       z
                                    
                                    
                                       t
                                    
                                 
                              
                           
                           ,
                           
                              
                                 ∂
                                 E
                              
                              
                                 ∂
                                 
                                    
                                       rx
                                    
                                    
                                       t
                                    
                                 
                              
                           
                           ,
                           
                              
                                 ∂
                                 E
                              
                              
                                 ∂
                                 
                                    
                                       ry
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        
                      and 
                        
                           
                              
                                 ∂
                                 E
                              
                              
                                 ∂
                                 
                                    
                                       rz
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        
                      are zero if 
                        
                           
                              
                                 t
                              
                              
                                 ̃
                              
                           
                           
                           ≠
                           
                           t
                        
                     , as the projection at time 
                        
                           
                              
                                 t
                              
                              
                                 ̃
                              
                           
                        
                      only depends on the pose at this time. If 
                        
                           
                              
                                 t
                              
                              
                                 ̃
                              
                           
                           =
                           t
                        
                      (we recall that 
                        
                           
                              
                                 t
                              
                              
                                 ̃
                              
                           
                        
                      is the time at which we consider the point), the derivatives have to be computed for the translation values:
                        
                           (A.3)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                   
                                                   
                                                      δ
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                                =
                                                A
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  1
                                                               
                                                            
                                                            
                                                               
                                                                  0
                                                               
                                                            
                                                            
                                                               
                                                                  0
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            proj
                                                         
                                                      
                                                      (
                                                      p
                                                      ,
                                                      t
                                                      ,
                                                      
                                                         
                                                            X
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      ,
                                                      θ
                                                      )
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                                [
                                                k
                                                ]
                                                =
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  2
                                                                  d
                                                               
                                                            
                                                            [
                                                            k
                                                            ]
                                                         
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  t
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      [
                                                      2
                                                      ]
                                                      -
                                                      
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  2
                                                                  d
                                                               
                                                            
                                                            [
                                                            2
                                                            ]
                                                         
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  t
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      [
                                                      k
                                                      ]
                                                   
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      
                                                         
                                                            [
                                                            2
                                                            ]
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                                
                                                for
                                                
                                                k
                                                =
                                                0
                                                ,
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     respectively 
                        
                           (
                           0
                           ,
                           1
                           ,
                           0
                           )
                        
                      and 
                        
                           (
                           0
                           ,
                           0
                           ,
                           1
                           )
                        
                      for the derivatives with respect to 
                        
                           
                              
                                 y
                              
                              
                                 t
                              
                           
                        
                      and 
                        
                           
                              
                                 z
                              
                              
                                 t
                              
                           
                        
                     .

Using the derivated matrix 
                        
                           
                              
                                 R
                              
                              
                                 ψ
                              
                           
                           =
                           
                              
                                 ∂
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                              
                              
                                 ∂
                                 ψ
                              
                           
                        
                     , we get the following derivatives with respect to the angles:
                        
                           (A.4)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      ψ
                                                   
                                                
                                                =
                                                κ
                                                A
                                                
                                                   
                                                      
                                                         
                                                            
                                                               R
                                                            
                                                            
                                                               ψ
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        S
                                                                     
                                                                     
                                                                        ‾
                                                                     
                                                                  
                                                                  (
                                                                  p
                                                                  )
                                                                  +
                                                                  
                                                                     
                                                                        
                                                                           ∑
                                                                        
                                                                        
                                                                           i
                                                                           =
                                                                           1
                                                                        
                                                                        
                                                                           M
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        α
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        s
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  (
                                                                  p
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            proj
                                                         
                                                      
                                                      (
                                                      p
                                                      ,
                                                      t
                                                      ,
                                                      
                                                         
                                                            X
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      ,
                                                      θ
                                                      )
                                                   
                                                   
                                                      ∂
                                                      ψ
                                                   
                                                
                                                [
                                                k
                                                ]
                                                =
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  2
                                                                  d
                                                               
                                                            
                                                            [
                                                            k
                                                            ]
                                                         
                                                         
                                                            ∂
                                                            ψ
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      [
                                                      2
                                                      ]
                                                      -
                                                      
                                                         
                                                            ∂
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  2
                                                                  d
                                                               
                                                            
                                                            [
                                                            2
                                                            ]
                                                         
                                                         
                                                            ∂
                                                            ψ
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      [
                                                      k
                                                      ]
                                                   
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                            d
                                                         
                                                      
                                                      
                                                         
                                                            [
                                                            2
                                                            ]
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                                
                                                for
                                                
                                                k
                                                =
                                                0
                                                ,
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     and similar equations are obtained for the derivative with respect to 
                        
                           θ
                        
                      and 
                        
                           ϕ
                        
                      respectively, using 
                        
                           
                              
                                 R
                              
                              
                                 θ
                              
                           
                           =
                           
                              
                                 ∂
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                              
                              
                                 ∂
                                 θ
                              
                           
                        
                      and 
                        
                           
                              
                                 R
                              
                              
                                 ϕ
                              
                           
                           =
                           
                              
                                 ∂
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                              
                              
                                 ∂
                                 ϕ
                              
                           
                        
                     .

The lines in the jacobian 
                        
                           
                              
                                 J
                              
                              
                                 E
                              
                           
                        
                      corresponding to the 2D detection of a point at time t has the following structure (
                        
                           
                              
                                 x
                              
                              
                                 p
                              
                           
                        
                      is used in place of 
                        
                           
                              
                                 x
                              
                              
                                 proj
                              
                           
                           (
                           p
                           ,
                           t
                           ,
                           
                              
                                 X
                              
                              
                                 t
                              
                           
                           ,
                           θ
                           )
                        
                      for the sake of clarity):
                        
                           
                              
                                 
                                    
                                 
                              
                           
                        
                     
                  

@&#REFERENCES@&#

