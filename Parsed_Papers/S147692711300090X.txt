@&#MAIN-TITLE@&#Probabilistic model based error correction in a set of various mutant sequences analyzed by next-generation sequencing

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           Sequences analyzed by next-generation sequencing contain many errors.


                        
                        
                           
                           We proposed a method of error correction of heterogeneous sequences.


                        
                        
                           
                           We performed a computer experiment of error correction.


                        
                        
                           
                           We confirmed the effectiveness of our method.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Base call error

Image restoration

Quality score

Quasispecies

Sequence analysis

SMRT

@&#ABSTRACT@&#


               
               
                  To analyze the evolutionary dynamics of a mutant population in an evolutionary experiment, it is necessary to sequence a vast number of mutants by high-throughput (next-generation) sequencing technologies, which enable rapid and parallel analysis of multikilobase sequences. However, the observed sequences include many errors of base call. Therefore, if next-generation sequencing is applied to analysis of a heterogeneous population of various mutant sequences, it is necessary to discriminate between true bases as point mutations and errors of base call in the observed sequences, and to subject the sequences to error-correction processes. To address this issue, we have developed a novel method of error correction based on the Potts model and a maximum a posteriori probability (MAP) estimate of its parameters corresponding to the “true sequences”. Our method of error correction utilizes (1) the “quality scores” which are assigned to individual bases in the observed sequences and (2) the neighborhood relationship among the observed sequences mapped in sequence space. The computer experiments of error correction of artificially generated sequences supported the effectiveness of our method, showing that 50–90% of errors were removed. Interestingly, this method is analogous to a probabilistic model based method of image restoration developed in the field of information engineering.
               
            

@&#INTRODUCTION@&#

Many kinds of evolutionary experiments, by using bacteria (Barrick et al., 2009), viruses (Meyer et al., 2012) or self-replicating molecular systems (Kita et al., 2008; Ichihashi et al., 2013), have been conducted over the world, and then it becomes more and more necessary to analyze an evolutionary dynamics and statistical properties of fitness landscapes by sequencing a vast number of mutants in the evolving population (Betancourt, 2009; Pitt, and Ferr-D’Amar, 2010; Steinbruck et al., 2011; Otwinowski et al., 2013). This can be realized by high-throughput deoxyribonucleic acid (DNA) sequencing (called the “next-generation” sequencing) technologies (Eid et al., 2009; Quail et al., 2012; Liu et al., 2012), which enable rapid and parallel analysis of multikilobase sequences. However, the observed sequences include many errors of base call. Therefore, if next-generation sequencing is applied to analysis of a heterogeneous population of various mutant sequences, it is necessary to discriminate between true bases as point mutations and errors of base call in the observed sequences, and to subject the sequences to error-correction processes.

Many studies of error correction methods for next-generation sequencing have been reported (e.g. Wijaya et al., 2009; Zhao et al., 2010; Ilie et al., 2011; Yang et al., 2011). Several groups reported error correction methods of next-generation sequencing data to estimate the genetic diversity in quasispecies of viruses, that is, the occurrence-frequency distribution of mutant sequences in quasispecies (Zagordi et al., 2010a, 2011; Prosperi et al., 2011; Prosperi and Salemi, 2012; Astrovskaya et al., 2011; Skums et al., 2012). For example, in Zagordi et al. (2010b), each of the sequenced fragments (called the “reads”), which contain point mutations and base-call errors, is classified into several clusters by using a model-based probabilistic clustering algorithm. This clustering algorithm is based on a Bayesian statistics using the “Dirichlet process mixture (DPM)”. Then, the consensus sequence of each cluster represents the true (original) sequence.

We have developed a novel method of error correction based on the Potts model and a maximum a posteriori probability (MAP) estimate of its parameters corresponding to the “true sequences”. Our method of error correction utilizes (1) the “quality scores” which are assigned to individual bases in the observed sequences and (2) the neighborhood relationship among the observed sequences mapped in sequence space. The quality scores are encoded by Ascii code in FASTQ files (Cock et al., 2010). Based on the concept of sequence space (Eigen and Winkler-Oswatitsch, 1990), several mutant sequences which are similar to an arbitrary sequence X are located near the sequence X in sequence space. These mutant sequences are called the “neighborhoods” of the sequence X. Error correction of the sequence X is conducted by referring to the sequence information in the neighborhoods. For example, let us consider that a letter at the ith position on the sequence X is “A”, while letters at the same position on other sequences in the neighborhoods are “T”. If the quality score assigned to “A” takes a high value and those assigned to “T” take low values on average, the “A” is likely to be the true letter. If the quality score assigned to “A” takes a low value and those assigned to “T” take high values on average, the “A” is likely to be an error and should be replaced with “T”. The purpose of this study is to develop a method to implement these processes automatically in a rational way. A marked difference between our method and other ones resides in that our method does not perform the clustering of reads based on their similarity, but utilizes the quality scores which are transformed to the error probabilities of base call.

Our method of error correction is analogous to a probabilistic-model-based method of image restoration developed in the field of information engineering (Bilbro et al., 1992; Pryce and Bruce, 1995). Therefore, we can obtain several useful ideas from this field. To evaluate the performance of our method, we carried out computer experiments of error correction by generating 1024 artificial DNA sequences in a simulated evolving population. The results of the computer experiments supported the effectiveness of our method. This paper reports a novel approach toward a systematic error correction in a set of various mutant sequences through next-generation sequencing.

@&#METHOD@&#

We consider an evolving population of various mutant DNA sequences in an evolutionary experiment. We assume that mutational events in evolution are only base substitutions, and then the sequence lengths for all the mutants are fixed with a constant ν. Let i be the position number along each sequence (i
                        =1, 2, …, ν), and let λ
                        ≡4 be the number of available letters (=bases). Arbitrary M (=103–104) samples are picked from among the mutant population randomly, and each of them is referred with the serial number m or n (m, n
                        =1, 2, …, M). The sequence information of each sample is provided by next-generation sequencing. For mathematical formulation, three types of “sequences” are conceptually or really assigned to each of the M samples (Fig. 1
                        ):
                           
                              
                                 True sequence: the true sequence of a sample m is represented by x
                                 1(m)x
                                 2(m)…
                                 x
                                 
                                    ν
                                 (m), where x
                                 
                                    i
                                 (m) is the “true letter” at the ith position for the sample m. (We never know the true sequence.)


                                 Observed sequence: this is obtained by analyzing the true sequence through next-generation sequencing (each observed sequence is called the “read”). The observed sequence of a sample m is represented by y
                                 1(m)y
                                 2(m)…
                                 y
                                 
                                    ν
                                 (m), where y
                                 
                                    i
                                 (m) is the “observed letter” at the ith position for the sample m.


                                 Predicted sequence: this is obtained by subjecting the observed sequence to error-correction processes. The predicted sequence is the most probable candidate of the true sequence. The predicted sequence of a sample m is represented by 
                                    
                                       
                                          x
                                          ˆ
                                       
                                       1
                                    
                                    (
                                    m
                                    )
                                    
                                       
                                          x
                                          ˆ
                                       
                                       2
                                    
                                    (
                                    m
                                    )
                                    …
                                    
                                       
                                          x
                                          ˆ
                                       
                                       ν
                                    
                                    (
                                    m
                                    )
                                 , where 
                                    
                                       
                                          x
                                          ˆ
                                       
                                       i
                                    
                                    (
                                    m
                                    )
                                  is the “predicted letter” at the ith position for the sample m.

Mathematically, the sequence information of the true sequences is transformed to the observed sequences with many (apparent) substitutions caused by base-call errors. We assume that, base-call errors do not cause (apparent) insertions and deletions for simplicity. 
                           1
                        
                        
                           1
                           This assumption does not hold in real cases. Our method can be applied to DNA sequences in a protein coding region, because insertions and deletions in these sequences cause lethal proteins through the frame shift in translation. This is the limitation of the current method. See Section 4.
                         A “quality score” Q
                        
                           i
                        (m) is assigned to the observed letter y
                        
                           i
                        (m) for every position i and every sample m. The quality score Q
                        
                           i
                        (m) is transformed to the error probability p
                        
                           i
                        (m) that a base call at the ith position for a sample m results in failure. We assume that p
                        
                           i
                        (m) is given by an unique function of Q
                        
                           i
                        (m):


                        
                           
                              (1)
                              
                                 
                                    p
                                    i
                                 
                                 (
                                 m
                                 )
                                 =
                                 f
                                 (
                                 
                                    Q
                                    i
                                 
                                 (
                                 m
                                 )
                                 )
                                 
                                 
                                    for
                                    
                                    all
                                 
                                 
                                 m
                                 
                                 and
                                 
                                 i
                                 
                                 .
                              
                           
                        Namely, a base call results in


                        
                           
                              
                                 
                                    y
                                    i
                                 
                                 (
                                 m
                                 )
                                 
                                    
                                       
                                          
                                             
                                                
                                                   =
                                                   
                                                      x
                                                      i
                                                   
                                                   (
                                                   m
                                                   )
                                                   ,
                                                
                                                
                                                   
                                                      with
                                                      
                                                      probability
                                                      
                                                      of
                                                   
                                                   
                                                   1
                                                   −
                                                   
                                                      p
                                                      i
                                                   
                                                   (
                                                   m
                                                   )
                                                
                                             
                                             
                                                
                                                   ≠
                                                   
                                                      x
                                                      i
                                                   
                                                   (
                                                   m
                                                   )
                                                   ,
                                                
                                                
                                                   
                                                      with
                                                      
                                                      probability
                                                      
                                                      of
                                                   
                                                   
                                                   
                                                      p
                                                      i
                                                   
                                                   (
                                                   m
                                                   )
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        To determine the predicted sequences for the M samples through error correction, the available information is (1) a set of the observed sequences for the M samples and (2) a set of the quality scores for all letters in the observed sequences: {y
                        
                           i
                        (m), Q
                        
                           i
                        (m)|i
                        =1, 2, …, ν
                        ;
                        m
                        =1, 2, …
                        M}.

Our method of error correction is based on the spatial distribution of a mutant population in sequence space (Fig. 1b). We denote a pair of samples m and n by (m, n). Let d
                        
                           y
                        (m, n) be the Hamming distance between the observed sequences for the samples m and n:


                        
                           
                              (2)
                              
                                 
                                    d
                                    y
                                 
                                 (
                                 m
                                 ,
                                 n
                                 )
                                 ≡
                                 ν
                                 −
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    ν
                                 
                                 δ
                                 (
                                 
                                    y
                                    i
                                 
                                 (
                                 m
                                 )
                                 ,
                                 
                                    y
                                    i
                                 
                                 (
                                 n
                                 )
                                 )
                                 ,
                              
                           
                        where δ(*, *) represents the Kronecker's delta. Here, we define the “neighborhoods” of each sample in sequence space, based on the frequency distribution of the Hamming distance d
                        
                           y
                        (m, l) from a certain sample m to arbitrary samples l (Fig. 1c). Let E[d]
                           m
                         and 
                           E
                           
                              
                                 [
                                 
                                    d
                                    2
                                 
                                 ]
                              
                              m
                           
                         be the following averages of d
                        
                           y
                        (m, l)
                           b
                        :


                        
                           
                              (3)
                              
                                 E
                                 
                                    
                                       [
                                       
                                          d
                                          b
                                       
                                       ]
                                    
                                    m
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                          
                                             l
                                             ≠
                                             m
                                          
                                       
                                       
                                          d
                                          y
                                       
                                       
                                          
                                             (
                                             m
                                             ,
                                             l
                                             )
                                          
                                          b
                                       
                                    
                                    
                                       M
                                       −
                                       1
                                    
                                 
                                 
                                 (
                                 b
                                 =
                                 1
                                 ,
                                 2
                                 )
                                 ,
                              
                           
                        where ∑
                           l≠m
                         means the sum over all the samples except the sample m. The standard deviation of d
                        
                           y
                        (m, l) is given by


                        
                           
                              (4)
                              
                                 SD
                                 
                                    
                                       [
                                       d
                                       ]
                                    
                                    m
                                 
                                 ≡
                                 
                                    
                                       E
                                       
                                          
                                             [
                                             
                                                d
                                                2
                                             
                                             ]
                                          
                                          m
                                       
                                       −
                                       
                                          
                                             E
                                             
                                                
                                                   [
                                                   d
                                                   ]
                                                
                                                m
                                             
                                          
                                          2
                                       
                                    
                                 
                                 .
                              
                           
                        Then, we introduce a critical Hamming distance for a sample m as follows:


                        
                           
                              (5)
                              
                                 
                                    
                                       d
                                       ˆ
                                    
                                    m
                                 
                                 ≡
                                 E
                                 
                                    
                                       [
                                       d
                                       ]
                                    
                                    m
                                 
                                 −
                                 3
                                 ×
                                 SD
                                 
                                    
                                       [
                                       d
                                       ]
                                    
                                    m
                                 
                                 .
                              
                           
                        We define that a sample n (or m) is the “neighborhood” of the sample m (or n), if


                        
                           
                              (6)
                              
                                 
                                    d
                                    y
                                 
                                 (
                                 m
                                 ,
                                 n
                                 )
                                 ≤
                                 max
                                 {
                                 
                                    
                                       d
                                       ˆ
                                    
                                    m
                                 
                                 ,
                                 
                                    
                                       d
                                       ˆ
                                    
                                    n
                                 
                                 }
                              
                           
                        (Fig. 1c). A set of all the neighborhoods of the sample m, denoted by


                        
                           
                              (7)
                              
                                 
                                    S
                                    nei
                                 
                                 (
                                 m
                                 )
                                 ≡
                                 {
                                 n
                                 |
                                 
                                 n
                                 
                                 
                                    is
                                    
                                    a
                                    
                                    neighborhood
                                    
                                    of
                                 
                                 
                                 m
                                 
                                 }
                                 ,
                              
                           
                        is utilized in error correction of the observed sequences (Fig. 1b).

Consider that the observed sequences with the same lengths of ν for the M samples are aligned vertically with no gaps (Fig. 1). Then, this forms a M
                        ×
                        ν matrix of the observed letters. The row number m (=1, 2, …, M) represents the serial number of the samples, while the column number i (=1, 2, …, ν) represents the position number along sequences. A single error-correction process is conducted independently in every position (column). Namely, the object of a single error-correction process is the set of all M letters in every column. The complete error-correction needs ν independent processes through all the ν columns.

Hereafter, we focus on an arbitrary position i (column i) and a set of all M letters in the ith column. The set of x
                        
                           i
                        (m) (as the “true letter” at the ith position for a sample m) and the set of y
                        
                           i
                        (m) (as the “observed letter” at the ith position for a sample m) for all the M samples are denoted by x
                        
                           i
                         and y
                        
                           i
                        , respectively:


                        
                           
                              (8)
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 ≡
                                 {
                                 
                                    x
                                    i
                                 
                                 (
                                 m
                                 )
                                 |
                                 m
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 M
                                 }
                              
                           
                        
                        
                           
                              (9)
                              
                                 
                                    
                                       
                                          y
                                       
                                    
                                    i
                                 
                                 ≡
                                 {
                                 
                                    y
                                    i
                                 
                                 (
                                 m
                                 )
                                 |
                                 m
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 M
                                 }
                                 .
                              
                           
                        We call x
                        
                           i
                         and y
                        
                           i
                         the “true set” and the “observed set” for the ith position, respectively.

Here, we define the following three probabilities: Pr(y
                        
                           i
                        |x
                        
                           i
                        ), the conditional probability that a set y
                        
                           i
                         realizes when a set x
                        
                           i
                         is given; Pr(x
                        
                           i
                        ), the prior probability that a set x
                        
                           i
                         realizes; Pr(x
                        
                           i
                        |y
                        
                           i
                        ), the posterior probability that a set x
                        
                           i
                         realized when a set y
                        
                           i
                         is given. Based on the Bayes’ theorem, the Pr(x
                        
                           i
                        |y
                        
                           i
                        ) is given by


                        
                           
                              (10)
                              
                                 Pr
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 |
                                 
                                    
                                       
                                          y
                                       
                                    
                                    i
                                 
                                 )
                                 =
                                 
                                    
                                       Pr
                                       (
                                       
                                          
                                             
                                                y
                                             
                                          
                                          i
                                       
                                       |
                                       
                                          
                                             
                                                x
                                             
                                          
                                          i
                                       
                                       )
                                       
                                       Pr
                                       (
                                       
                                          
                                             
                                                x
                                             
                                          
                                          i
                                       
                                       )
                                    
                                    
                                       
                                          ∑
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                i
                                             
                                          
                                       
                                       Pr
                                       (
                                       
                                          
                                             
                                                y
                                             
                                          
                                          i
                                       
                                       |
                                       
                                          
                                             
                                                x
                                             
                                          
                                          i
                                       
                                       )
                                       
                                       Pr
                                       (
                                       
                                          
                                             
                                                x
                                             
                                          
                                          i
                                       
                                       )
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              ∑
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                              
                           
                         means the sum over all possible states of x
                        
                           i
                         (the number of all possible states of x
                        
                           i
                         is λ
                        
                           M
                        ). The set y
                        
                           i
                         is given as a result of next-generation sequencing. Since our method is based on a maximum a posteriori probability (MAP) estimation, then all we have to do is to determine a set x
                        
                           i
                         that maximizes Eq. (10) with y
                        
                           i
                         given, through all the positions (i
                        =1, 2, …, ν). The Pr(y
                        
                           i
                        |x
                        
                           i
                        ) and Pr(x
                        
                           i
                        ) in Eq. (10) are obtained in the following.

Let Pr(y
                        
                           i
                        (m)|x
                        
                           i
                        (m)) be the conditional probability that an observed letter y
                        
                           i
                        (m) realizes when a true letter x
                        
                           i
                        (m) is given for an arbitrary sample m. Assuming there is no propensity of errors, we obtain


                        
                           
                              (11)
                              
                                 Pr
                                 (
                                 
                                    y
                                    i
                                 
                                 (
                                 m
                                 )
                                 |
                                 
                                    x
                                    i
                                 
                                 (
                                 m
                                 )
                                 )
                                 =
                                 exp
                                 (
                                 ϕ
                                 (
                                 
                                    x
                                    i
                                 
                                 (
                                 m
                                 )
                                 ,
                                 
                                    y
                                    i
                                 
                                 (
                                 m
                                 )
                                 )
                                 )
                                 ,
                              
                           
                        
                        
                           
                              (12)
                              
                                 ϕ
                                 (
                                 
                                    x
                                    i
                                 
                                 (
                                 m
                                 )
                                 ,
                                 
                                    y
                                    i
                                 
                                 (
                                 m
                                 )
                                 )
                                 ≡
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ln
                                                   (
                                                   1
                                                   −
                                                   
                                                      p
                                                      i
                                                   
                                                   (
                                                   m
                                                   )
                                                   )
                                                   ,
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         x
                                                         i
                                                      
                                                      (
                                                      m
                                                      )
                                                      =
                                                      
                                                         y
                                                         i
                                                      
                                                      (
                                                      m
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   ln
                                                   (
                                                   
                                                      p
                                                      i
                                                   
                                                   (
                                                   m
                                                   )
                                                   /
                                                   (
                                                   λ
                                                   −
                                                   1
                                                   )
                                                   )
                                                   ,
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         x
                                                         i
                                                      
                                                      (
                                                      m
                                                      )
                                                      ≠
                                                      
                                                         y
                                                         i
                                                      
                                                      (
                                                      m
                                                      )
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Then, Pr(y
                        
                           i
                        |x
                        
                           i
                        ) in Eq. (10) is given by


                        
                           
                              (13)
                              
                                 Pr
                                 (
                                 
                                    
                                       
                                          y
                                       
                                    
                                    i
                                 
                                 |
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 )
                                 =
                                 
                                    ∏
                                    
                                       m
                                       =
                                       1
                                    
                                    M
                                 
                                 Pr
                                 (
                                 
                                    y
                                    i
                                 
                                 (
                                 m
                                 )
                                 |
                                 
                                    x
                                    i
                                 
                                 (
                                 m
                                 )
                                 )
                              
                           
                        
                        
                           
                              (14)
                              
                                 =
                                 exp
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                m
                                                =
                                                1
                                             
                                             M
                                          
                                          ϕ
                                          (
                                          
                                             x
                                             i
                                          
                                          (
                                          m
                                          )
                                          ,
                                          
                                             y
                                             i
                                          
                                          (
                                          m
                                          )
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                        Concerning the prior probability Pr(x
                        
                           i
                        ), we assume that if samples m and n are in the relationship of the neighborhoods, x
                        
                           i
                        (m) and x
                        
                           i
                        (n) are likely to be identical with each other. Based on this assumption, the prior probability Pr(x
                        
                           i
                        ) is mathematically modeled as follows:


                        
                           
                              (15)
                              
                                 Pr
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 )
                                 =
                                 
                                    1
                                    
                                       
                                          Z
                                          1
                                       
                                       (
                                       
                                          β
                                          i
                                       
                                       )
                                    
                                 
                                 exp
                                 
                                    
                                       
                                          
                                             
                                                
                                                   β
                                                   i
                                                
                                             
                                             2
                                          
                                          
                                             ∑
                                             
                                                m
                                                =
                                                1
                                             
                                             M
                                          
                                          
                                             ∑
                                             
                                                n
                                                ∈
                                                
                                                   S
                                                   nei
                                                
                                                (
                                                m
                                                )
                                             
                                          
                                          δ
                                          (
                                          
                                             x
                                             i
                                          
                                          (
                                          m
                                          )
                                          ,
                                          
                                             x
                                             i
                                          
                                          (
                                          n
                                          )
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (16)
                              
                                 δ
                                 (
                                 
                                    x
                                    i
                                 
                                 (
                                 m
                                 )
                                 ,
                                 
                                    x
                                    i
                                 
                                 (
                                 n
                                 )
                                 )
                                 ≡
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                   ,
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         x
                                                         i
                                                      
                                                      (
                                                      m
                                                      )
                                                      =
                                                      
                                                         x
                                                         i
                                                      
                                                      (
                                                      n
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   0
                                                   ,
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         x
                                                         i
                                                      
                                                      (
                                                      m
                                                      )
                                                      ≠
                                                      
                                                         x
                                                         i
                                                      
                                                      (
                                                      n
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where β
                        
                           i
                         is called the “hyper-parameter” for the ith position, 
                           
                              ∑
                              
                                 n
                                 ∈
                                 
                                    S
                                    nei
                                 
                                 (
                                 m
                                 )
                              
                           
                         means the sum over all the neighborhoods of the sample m, and Z
                        1(β
                        
                           i
                        ) is the normalizing constant as a function of β
                        
                           i
                        . This model (Eqs. (15) and (16)) is analogous to the Potts model in the field of statistical physics. Namely, the summation in the largest parenthesis represents “pairwise interaction (negative) energies” between x
                        
                           i
                        (m)'s and x
                        
                           i
                        (n)'s, while β
                        
                           i
                         is an inverse temperature-like parameter. Then, Eq. (15) represents the Boltzmann distribution of a given state of x
                        
                           i
                        .

By substituting Eqs. (14) and (15) into Eq. (10), we obtain


                        
                           
                              (17)
                              
                                 Pr
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 |
                                 
                                    
                                       
                                          y
                                       
                                    
                                    i
                                 
                                 )
                                 =
                                 
                                    1
                                    
                                       
                                          Z
                                          2
                                       
                                       (
                                       
                                          β
                                          i
                                       
                                       )
                                    
                                 
                                 exp
                                 
                                    
                                       
                                          F
                                          (
                                          
                                             
                                                
                                                   x
                                                
                                             
                                             i
                                          
                                          |
                                          
                                             β
                                             i
                                          
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                        where F(x
                        
                           i
                        |β
                        
                           i
                        ) is the following function of x
                        
                           i
                         with the given parameter β
                        
                           i
                        :


                        
                           
                              (18)
                              
                                 F
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 |
                                 
                                    β
                                    i
                                 
                                 )
                                 =
                                 
                                    ∑
                                    
                                       m
                                       =
                                       1
                                    
                                    M
                                 
                                 
                                    
                                       
                                          ϕ
                                          (
                                          
                                             x
                                             i
                                          
                                          (
                                          m
                                          )
                                          ,
                                          
                                             y
                                             i
                                          
                                          (
                                          m
                                          )
                                          )
                                          +
                                          
                                             
                                                
                                                   β
                                                   i
                                                
                                             
                                             2
                                          
                                          
                                             ∑
                                             
                                                n
                                                ∈
                                                
                                                   S
                                                   nei
                                                
                                                (
                                                m
                                                )
                                             
                                          
                                          δ
                                          (
                                          
                                             x
                                             i
                                          
                                          (
                                          m
                                          )
                                          ,
                                          
                                             x
                                             i
                                          
                                          (
                                          n
                                          )
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                        and Z
                        2(β
                        
                           i
                        ) is a normalizing constant. Since we use the MAP estimation, the optimal set 
                           
                              
                                 
                                    
                                       x
                                    
                                 
                                 ˆ
                              
                              i
                           
                        , which is defined as a certain x
                        
                           i
                         that maximizes Eq. (18), is the most probable candidate of x
                        
                           i
                        :


                        
                           
                              (19)
                              
                                 
                                    
                                       
                                          
                                             x
                                          
                                       
                                       ˆ
                                    
                                    i
                                 
                                 ≡
                                 
                                    arg
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          i
                                       
                                    
                                 
                                 max
                                 F
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 |
                                 
                                    β
                                    i
                                 
                                 )
                              
                           
                        
                        
                           
                              (20)
                              
                                 ≡
                                 {
                                 
                                    
                                       x
                                       ˆ
                                    
                                    i
                                 
                                 (
                                 m
                                 )
                                 |
                                 m
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 M
                                 }
                                 .
                              
                           
                        We call 
                           
                              
                                 
                                    
                                       x
                                    
                                 
                                 ˆ
                              
                              i
                           
                         the “predicted set” for the ith position. Eq. (18) means that results of the maximization are dependent on the values of β
                        
                           i
                        . If β
                        
                           i
                         takes a small enough value to neglect the second term, we obtain 
                           
                              
                                 
                                    
                                       x
                                    
                                 
                                 ˆ
                              
                              i
                           
                           =
                           
                              
                                 
                                    y
                                 
                              
                              i
                           
                        . Namely, no correction is made. If β
                        
                           i
                         takes a large enough value to neglect the first term, 
                           
                              
                                 
                                    
                                       x
                                    
                                 
                                 ˆ
                              
                              i
                           
                         is forced to be homogeneous. To obtain the optimal values of β
                        
                           i
                         is a significant issue, in which the “optimal value” means a certain value of β
                        
                           i
                         that maximizes the Correction rate defined in Eq. (22). In this paper, we firstly describe how the effectiveness of the MAP estimation is dependent on the values of β
                        
                           i
                        , and finally we refer to how to predict the optimal values of β
                        
                           i
                         prior to the MAP estimation.

The MAP estimation is conducted through all the ν positions (columns), independently. Then, we obtain a complete set of the predicted sets, 
                           {
                           
                              
                                 
                                    
                                       x
                                    
                                 
                                 ˆ
                              
                              i
                           
                           |
                           i
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           ν
                           }
                        , which corresponds to the most probable set of the true sequences for the M samples.

To examine the performance of error correction based on the MAP estimation, we performed computer experiments of error correction of observed sequences generated artificially. We generated 45
                        =1024 sequences (=true sequences) in a simulated evolving population of DNA sequences and their respective observed sequences by the following manner.

First, a single parent sequence with sequence length of ν
                           =103 was generated. Next, the parent sequence reproduced four offspring sequences with the same sequence lengths. In each offspring sequence, base substitutions as random point mutations occurred stochastically by A times on average, where we adopted A
                           =20 and A
                           =7. The evolution process consisting of reproduction and mutation was repeated through 5 generations, and then M
                           =45
                           =1024 mutant sequences were generated as the true sequences: {x
                           
                              i
                           |i
                           =1, 2, …, 103}. The resulting sequences had about 115-fold point mutations per sequence for A
                           =20 and about 37-fold point mutations per sequence for A
                           =7.

First, we assigned a “pseudo-quality score”, denoted by


                           
                              
                                 
                                    
                                       Q
                                       i
                                    
                                    (
                                    m
                                    )
                                    ∈
                                    {
                                    1
                                    ,
                                    2
                                    ,
                                    3
                                    ,
                                    …
                                    ,
                                    70
                                    }
                                    ,
                                 
                              
                           to every position i through the sequence of every mutant m. The values of pseudo-quality scores were randomly chosen from a frequency distribution of quality scores shown in Fig.S1, which was obtained from a real dataset through the SMRT (Single Molecule Real-Time) sequencing 
                              2
                           
                           
                              2
                              In SMRT sequencing, the quality scores take from a range between 1 and 70, while current convention typically assigns quality scores between 1 and 40 (Cock et al., 2010). However, this difference is not essential and does not affect our qualitative results.
                           . Next, we gave the error probability of a base call, p
                           
                              i
                           (m), at each position i through the sequence for every mutant m, by adopting the following function of Q
                           
                              i
                           (m):
                              
                                 (21)
                                 
                                    
                                       p
                                       i
                                    
                                    (
                                    m
                                    )
                                    =
                                    B
                                    ×
                                    
                                       10
                                       
                                          −
                                          
                                             Q
                                             i
                                          
                                          (
                                          m
                                          )
                                          /
                                          10
                                       
                                    
                                    ,
                                 
                              
                           where we used B
                           =1 and B
                           =0.2. Eq. (21) is an example of Eq. (1). The right-hand side with B
                           =1 in Eq. (21) obeys the definition of the PHRED quality score (Cock et al., 2010). Next, the observed sequence of each mutant was made by copying its true sequence with random letter-substitutions with probability of p
                           
                              i
                           (m). We note that the random substitutions do not mean mutations but mimic errors of base calls in the next-generation sequencing process. Then, we obtained a set of the observed sequences for the M
                           =1024 mutants: {y
                           
                              i
                           |i
                           =1, 2, …, 103}. If y
                           
                              i
                           (m)=
                           x
                           
                              i
                           (m), the letter y
                           
                              i
                           (m) is called the “correct letter”, otherwise “incorrect letter”. The average and standard deviation of the number of incorrect letters per a single observed sequence are 36.0 and 6.0, respectively, for B
                           =1, and 7.2 and 2.7, respectively, for B
                           =0.2.

With a given β
                           
                              i
                            value, the maximization of Eq. (18) was conducted by using a hill-climbing method starting from the initial condition of x
                           
                              i
                           
                           =
                           y
                           
                              i
                           . The search space is the four-valued M
                           =1024 dimensional space and then its volume is 41024
                           ≈10616. The maximization was performed position by position through all the ν
                           =103 positions, independently. Then, we obtained a complete set of the predicted sets: 
                              {
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    ˆ
                                 
                                 i
                              
                              |
                              i
                              =
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              
                                 10
                                 3
                              
                              }
                           . This calculation was implemented by the C program running in PC cluster Express5800/120Rg-1 × 128 nodes (48 GFLOPS, Intel Xeon 3GHz (Woodcrest) 2 CPU 4 core, 16GB memory per node). The operating system is SUSE Linux Enterprise Server 10. The run-time was within 10min for each case.

After error correction for the ith position, by comparing the observed set y
                           
                              i
                           
                           ≡{y
                           
                              i
                           (m)} or the predicted set 
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    ˆ
                                 
                                 i
                              
                              ≡
                              {
                              
                                 
                                    x
                                    ˆ
                                 
                                 i
                              
                              (
                              m
                              )
                              }
                            with the true set x
                           
                              i
                           
                           ≡{x
                           
                              i
                           (m)}, we counted the frequencies of typical patterns of the corrector's action. The exact definitions of the frequencies are given in Table 1
                           . Then, we define the “Correction rate”, “Recall” and “Precision” as follows:


                           
                              
                                 (22)
                                 
                                    Correction
                                    
                                    rate
                                    ≡
                                    1
                                    −
                                    
                                       
                                          
                                             N
                                             ×
                                          
                                          (
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                ˆ
                                             
                                             i
                                          
                                          )
                                       
                                       
                                          
                                             N
                                             ×
                                          
                                          (
                                          
                                             
                                                
                                                   y
                                                
                                             
                                             i
                                          
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          
                                             N
                                             
                                                ×
                                                →
                                                ∘
                                             
                                          
                                          −
                                          
                                             N
                                             
                                                ∘
                                                →
                                                ×
                                             
                                          
                                       
                                       
                                          
                                             N
                                             ×
                                          
                                          (
                                          
                                             
                                                
                                                   y
                                                
                                             
                                             i
                                          
                                          )
                                       
                                    
                                 
                              
                           
                           
                              
                                 (23)
                                 
                                    Recall
                                    ≡
                                    
                                       
                                          
                                             N
                                             
                                                ×
                                                →
                                                ∘
                                             
                                          
                                       
                                       
                                          
                                             N
                                             
                                                ×
                                                →
                                                ∘
                                             
                                          
                                          +
                                          
                                             N
                                             
                                                ×
                                                →
                                                ×
                                             
                                          
                                          +
                                          
                                             N
                                             
                                                ×
                                                →
                                                
                                                   ×
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             N
                                             
                                                ×
                                                →
                                                ∘
                                             
                                          
                                       
                                       
                                          
                                             N
                                             ×
                                          
                                          (
                                          
                                             
                                                
                                                   y
                                                
                                             
                                             i
                                          
                                          )
                                       
                                    
                                 
                              
                           
                           
                              
                                 (24)
                                 
                                    Precision
                                    ≡
                                    
                                       
                                          
                                             N
                                             
                                                ×
                                                →
                                                ∘
                                             
                                          
                                       
                                       
                                          
                                             N
                                             
                                                ×
                                                →
                                                ∘
                                             
                                          
                                          +
                                          
                                             N
                                             
                                                ×
                                                →
                                                
                                                   ×
                                                   ′
                                                
                                             
                                          
                                          +
                                          
                                             N
                                             
                                                ∘
                                                →
                                                ×
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           The denominator in Eq. (24) represents the number of cases where the corrector takes action. Note that the Correction rate, Recall and Precision were calculated position by position through the sequences.

We chose 500 mutants randomly from the 1024 mutants, and then prepared a set of 1500 sequences, which include 3 types of sequences (true-, observed- and predicted ones) for every mutant. A 1500×1500 Hamming-distance matrix for the 1500 sequences were calculated. This matrix was subjected to the principal coordinate analysis (Gower, 1986). Each sequence was mapped into 2-dimensional space by using the first and second principal coordinates. Furthermore, we optimized all the 1500 coordinates on 2D space to realize high correlation between the Euclidean distances and the Hamming distances. Details are omitted.

In this paper, the optimal value of β
                        
                           i
                         for every position i is defined as a certain value of β
                        
                           i
                         that maximizes the Correction rate defined in Eq. (22). According to the Bayesian statistics-based image restoration in the field of information engineering (Pryce and Bruce, 1995; Zhou et al., 1997), the optimal value of hyper-parameter β
                        
                           i
                         is given as a certain β
                        
                           i
                         that maximizes the following marginal likelihood


                        
                           
                              (25)
                              
                                 Pr
                                 (
                                 
                                    
                                       
                                          y
                                       
                                    
                                    i
                                 
                                 )
                                 =
                                 
                                    ∑
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          i
                                       
                                    
                                 
                                 Pr
                                 (
                                 
                                    
                                       
                                          y
                                       
                                    
                                    i
                                 
                                 |
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 )
                                 
                                 Pr
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 )
                                 ,
                              
                           
                        where 
                           
                              ∑
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                              
                           
                         means the sum over all possible states of x
                        
                           i
                         (the number of all possible states of x
                        
                           i
                         is λ
                        
                           M
                        ). Then, we define


                        
                           
                              (26)
                              
                                 
                                    
                                       β
                                       ˜
                                    
                                    i
                                 
                                 ≡
                                 
                                    arg
                                    
                                       
                                          β
                                          i
                                       
                                    
                                 
                                 max
                                 Pr
                                 (
                                 
                                    
                                       
                                          y
                                       
                                    
                                    i
                                 
                                 )
                                 .
                              
                           
                        The 
                           
                              
                                 β
                                 ˜
                              
                              i
                           
                         satisfies


                        
                           
                              (27)
                              
                                 
                                    
                                       d
                                       Pr
                                       (
                                       
                                          
                                             
                                                y
                                             
                                          
                                          i
                                       
                                       )
                                    
                                    
                                       d
                                       
                                          β
                                          i
                                       
                                    
                                 
                                 
                                    
                                       
                                          |
                                       
                                    
                                    
                                       
                                          β
                                          i
                                       
                                       =
                                       
                                          
                                             β
                                             ˜
                                          
                                          i
                                       
                                    
                                 
                                 =
                                 0
                                 .
                              
                           
                        This equation is expanded to


                        
                           
                              (28)
                              
                                 
                                    ∑
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          i
                                       
                                    
                                 
                                 G
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 )
                                 Pr
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 |
                                 
                                    
                                       
                                          y
                                       
                                    
                                    i
                                 
                                 )
                                 −
                                 
                                    ∑
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          i
                                       
                                    
                                 
                                 G
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 )
                                 Pr
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 )
                                 =
                                 0
                                 ,
                              
                           
                        where


                        
                           
                              (29)
                              
                                 G
                                 (
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                                 )
                                 ≡
                                 
                                    1
                                    2
                                 
                                 
                                    ∑
                                    
                                       m
                                       =
                                       1
                                    
                                    M
                                 
                                 
                                    ∑
                                    
                                       n
                                       ∈
                                       
                                          S
                                          nei
                                       
                                       (
                                       m
                                       )
                                    
                                 
                                 δ
                                 (
                                 
                                    x
                                    i
                                 
                                 (
                                 m
                                 )
                                 ,
                                 
                                    x
                                    i
                                 
                                 (
                                 n
                                 )
                                 )
                                 .
                              
                           
                        The value of 
                           
                              
                                 β
                                 ˜
                              
                              i
                           
                         is determined by solving Eq. (28) numerically. However, rigorous calculation of 
                           
                              ∑
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    i
                                 
                              
                           
                         in Eq. (28) is actually impossible because of the vast number of possible states. Therefore, we used the mean field approximation (MFA) method. The details of MFA are described in Appendix A.

@&#RESULTS@&#

As mentioned in Section 2.4, we examined four different cases in generating true sequences and observed sequences, by combining two parameters A in Section 2.4.1 and B in Eq. (21). The four cases are designated as “A20B1” (A
                     =20, B
                     =1), “A20B0.2” (A
                     =20, B
                     =0.2), “A7B1” (A
                     =7, B
                     =1) and “A7B0.2” (A
                     =7, B
                     =0.2). In each case, the number of mutants was M
                     =45
                     =1024 and the sequence lengths were ν
                     =103. The numbers of point mutations and errors in the resulting sequences are compiled in Table 2
                     . The computer experiment of error correction was performed for each case independently. We first mention about the number of the neighborhoods of each mutant in sequence space, next, about evaluation of the performance of error correction.

The performance of error correction is strongly dependent on the neighborhoods of each mutant in sequence space. Therefore, we first calculated the number of the neighborhoods of each mutant in sequence space, according to the definition in Section 2.2. This number corresponds to |S
                        nei(m)| in Eqs. (7) and (18). The frequency distributions of the values of |S
                        nei(m)| are shown in Fig. 2
                        . The effect of the values of |S
                        nei(m)| on the performance of our method will be discussed later.

By using the MAP estimation, we performed error correction of the M
                        =1024 observed sequences for several values of the hyper-parameter β
                        
                           i
                        . For computational convenience, first, we used common values of β
                        
                           i
                        , denoted by β, through all the 1000 positions. Then, we examined how the performance of error correction is dependent on the β values.


                        Fig. 3
                        (a) and (c) shows the average and standard deviation of N
                        ×(y
                        
                           i
                        ) and 
                           
                              N
                              ×
                           
                           (
                           
                              
                                 
                                    
                                       x
                                    
                                 
                                 ˆ
                              
                              i
                           
                           )
                         over all the 1000 positions. Fig. 3(b) and (d) shows the average and standard deviation of Correction rate over all the 1000 positions. Looking over the four figures in Fig. 3, we can see that error correction works well at the optimal values of β, where we use the “optimal β” as a specific β that maximizes the mean correction rate shown in Fig. 3(b) and (d). In cases of many mutations (A20B1 and A20B0.2), the effectiveness of this method is sensitive to the β values, while in cases of less mutations (A7B1 and A7B0.2), the effectiveness of this method is robust against the β values larger than the optimal β values
                           3
                        
                        
                           3
                           For example, in a case of A7B1, the average of 
                                 
                                    N
                                    ×
                                 
                                 (
                                 
                                    
                                       
                                          
                                             x
                                          
                                       
                                       ˆ
                                    
                                    i
                                 
                                 )
                               and that of correction rate with β
                              =104 were 7.0 and 0.81, respectively. These values are almost same as the values with β
                              =1.0.
                        . In the former cases, as the β value increases, the values of N
                        ∘→× and 
                           
                              N
                              
                                 ×
                                 →
                                 
                                    ×
                                    ′
                                 
                              
                           
                         tend to increase rapidly. Namely, a large variety of letters in the neighborhoods makes it difficult to choose a true letter from the various letters and then an error of choice increases.


                        Table 2 compiles several properties in cases where we used the optimal β values for each of the four cases. The mean precision takes 0.85–0.92, while the mean recall takes 0.56–0.95. Recall in cases of many mutations (A20B1 and A20B0.2) tends to take lower values than that in cases of less mutations (A7B1 and A7B0.2), because N
                        ×→∘ decreases, while N
                        ×→× and 
                           
                              N
                              
                                 ×
                                 →
                                 
                                    ×
                                    ′
                                 
                              
                           
                         increase. This is caused by the same reason for an error of choice.

By using the principal coordinate analysis based on the Hamming-distance matrix, three types of sequences (true-, observed- and predicted ones) for randomly chosen 500 mutants were mapped into 2-dimensional space shown in Fig. 4
                         (for A20B1 and A7B1) and Fig.S2 (for A20B0.2 and A7B0.2). The predicted sequences shown were obtained with the optimal β values. The figure for A7B1 ideally shows a feature that the spatial distribution of the predicted sequences (blue □) is superposed on that of the true sequences (green ∘), while the distribution of the observed sequences (red ×) separates from them. Looking over the four figures (Fig. 4 and Fig. S2), we can confirm that the degree of superposition and separation among the three types of sequences is consistent with the values of correction rate and recall shown in Table 2.

In the previous section, we mentioned about error correction with a common β value through all the positions. Here, we define the optimal β
                        
                           i
                         as a specific β
                        
                           i
                         that maximizes correction rate for the ith position. The most effective error correction should adopt the optimal β
                        
                           i
                         position by position. This is so called position-specific error correction. Then, we calculated the optimal values of β
                        
                           i
                         through all positions for each of the four cases, and evaluated the effectiveness of position-specific error correction in the following manner. For computational convenience, we calculated the correction rate for each position by scanning the β
                        
                           i
                         values from 0 through 1.0 at interval of 0.1, and then we determined the optimal values of β
                        
                           i
                        , which gave the highest correction rate.


                        Fig. 5
                         shows the frequency distribution of the optimal values of β
                        
                           i
                         for position-specific error correction. These values are distributed around the optimal values of β shown in Table 2. The performance of position-specific error correction is compiled in Table 3
                        . In comparison with Table 2, it is obvious that the mean correction rate increases by 0.03 for A20B1 and A7B1, and also increases by 0.11–0.13 for A20B0.2 and A7B0.2. In addition, the standard deviation of correction rate decreases slightly for three cases. These results support the high performance of position-specific error correction.

Finally, we refer to a method for prediction of the optimal values of β
                        
                           i
                         prior to the MAP estimation. By using the mean field approximation (MFA) method, we predicted the optimal values of β
                        
                           i
                         for every position i. The results are compiled in Table 4
                        . The predicted optimal values, denoted by 
                           
                              
                                 β
                                 ˜
                              
                              i
                           
                        , were calculated through all the 1000 positions according to Section 2.5 and Appendix A. Then, the values presented in Table 4 are the average and standard deviation over all the 1000 positions. In comparison with Table 3, we can see that the values of 
                           
                              
                                 β
                                 ˜
                              
                              i
                           
                         are close to the true optimal values, denoted by 
                           
                              
                                 β
                                 ˆ
                              
                              i
                           
                         in Table 3. However, extremely small deviations (0.006–0.007) presented in Table 4 suggest low resolution of the predicted values. Namely, MFA could not give sophisticated 
                           
                              
                                 β
                                 ˜
                              
                              i
                           
                         values, which are position-specific ones and should be distributed widely (see Fig. 5 and deviations of 
                           
                              
                                 β
                                 ˆ
                              
                              i
                           
                         in Table 3 (0.11–0.20)). With the predicted optimal values, the performance of error correction was 54–95% of the maximum. As a whole, the results suggest that MFA is useful for rough prediction of the suboptimal values of β
                        
                           i
                        . This issue is discussed in the next section.

@&#DISCUSSION@&#

This paper reports a novel approach toward a systematic error correction in a set of various mutant sequences through next-generation sequencing. We presented that our method of error correction works well when the hyper-parameter β
                     
                        i
                      is properly given. Roughly, 50–90% of errors were removed, although the performance is affected by several underlying conditions, such as the genetic diversity and error probability of base call. We are now planning to run on a real dataset, which is obtained from a self-replicating molecular system (Ichihashi et al., 2013) and analyzed by PacBio RS (single molecule real-time DNA sequencing system) (Eid et al., 2009).

Several critical problems remain to be resolved to establish this method and make it available on the web. The bottleneck problem is how to calculate the optimal (or suboptimal) values of the hyper-parameter β
                     
                        i
                      prior to the MAP estimation. Following the Bayesian statistics-based image restoration in the field of information engineering (Bilbro et al., 1992; Pryce and Bruce, 1995; Zhou et al., 1997), we predicted the optimal values of β
                     
                        i
                      by using the mean field approximation (MFA) method, and found that MFA is useful for rough prediction. Since our method of error correction is similar to a probabilistic-model-based method of the image restoration (Tanaka and Morita, 1995; Tanaka and Inoue, 2002), we can obtain several useful ideas from this field, which has been well established. Then, by referring to several methods in image restoration, we are now developing a sophisticated method of the hyper-parameter prediction.

The second problem is how to determine the optimal definition of the neighborhoods of each mutant in sequence space. The optimal definition is dependent on the property of a given set of mutant sequences. If a given set of mutant sequences possesses many mutations and errors, the critical Hamming distance defined in Eq. (5) should be small. The reason resides in that a large variety of letters in the neighborhoods makes it difficult to choose a true letter from the various letters and then an error of choice increases. We are now considering that the Delauney tessellation-like method conducted in sequence space may make another definition of the neighborhoods.

Several studies proposed a similar idea that sequence fragments with a given length k (called the “kmer”) are mapped in sequence space and neighborhoods among the fragments (called the “kmer neighborhood”) are defined (e.g. Yang et al., 2011, 2013). Our method is based on the assumption that evolutionally related sequences possess similar sequences. Therefore, we map complete sequences with full lengths in sequence space. We are now uncertain which is more reasonable to use full-length sequences or sequence fragments, in our method. It is however worth investigating this aspect. It is a crucial issue what the optimal value of k is and how the whole sequence is divided into fragments.

The third problem is how to determine the shape of a function in Eq. (1) to calculate the error probability p
                     
                        i
                     (m) from the quality score Q
                     
                        i
                     (m). In this study, we assumed the relationship between p
                     
                        i
                     (m) and Q
                     
                        i
                     (m) obeys Eq. (21). We are now evaluating the shape of the function by using a real dataset through PacBio RS. The resulting shape was close to Eq. (21) (data not shown). However, it is a crucial issue whether the resulting shape is universal or not within PacBio RS. If so, the third problem can be easily resolved.

The fourth problem is how to extend this method to cases where not only substitutions as errors but also insertions and deletions as errors occur in base call. This problem is so difficult to be resolved because quality scores are given to substituted or inserted letters in observed sequences, but not given to deleted letters. We are now considering that our method can be applied to DNA sequences in a protein coding region, because insertions and deletions in these sequences cause lethal proteins through the frame shift in translation. Therefore, it is necessary to perform pairwise alignment between each observed sequence and a reference sequence which is guaranteed as a true sequence. If insertions and deletions are found in the observed sequences, these are identified as the errors of base call and should be neglected.

Finally, we mention about how to develop this method. It has been recognized that error correction methods that make use of plural positions at the same time are more powerful (Macalalad et al., 2012; McElroy et al., 2013). Therefore, it may be effective to perform error correction by using a sliding window including plural positions. The window size may be a crucial parameter. This issue seems to be related to the reads-clustering problem (e.g. (Zagordi et al., 2010b)). Therefore, we expect that our method may be improved by combining with the clustering method using the Dirichlet process mixture (DPM).

@&#ACKNOWLEDGEMENTS@&#

We are grateful for the support of the Cybermedia Center at Osaka University.

Eq. (28) is expanded to


                     
                        
                           (30)
                           
                              
                                 ∑
                                 
                                    m
                                    =
                                    1
                                 
                                 M
                              
                              
                                 ∑
                                 
                                    n
                                    ∈
                                    
                                       S
                                       nei
                                    
                                    (
                                    m
                                    )
                                 
                              
                              
                                 ∑
                                 
                                    
                                       x
                                       i
                                    
                                    (
                                    m
                                    )
                                    ∈
                                    {
                                    A
                                    ,
                                    T
                                    ,
                                    G
                                    ,
                                    C
                                    }
                                 
                              
                              
                                 ∑
                                 
                                    
                                       x
                                       i
                                    
                                    (
                                    n
                                    )
                                    ∈
                                    {
                                    A
                                    ,
                                    T
                                    ,
                                    G
                                    ,
                                    C
                                    }
                                 
                              
                              δ
                              (
                              
                                 x
                                 i
                              
                              (
                              m
                              )
                              ,
                              
                                 x
                                 i
                              
                              (
                              n
                              )
                              )
                              Pr
                              (
                              
                                 x
                                 i
                              
                              (
                              m
                              )
                              ,
                              
                                 x
                                 i
                              
                              (
                              n
                              )
                              |
                              
                                 
                                    
                                       y
                                    
                                 
                                 i
                              
                              )
                              =
                              
                                 ∑
                                 
                                    m
                                    =
                                    1
                                 
                                 M
                              
                              
                                 ∑
                                 
                                    n
                                    ∈
                                    
                                       S
                                       nei
                                    
                                    (
                                    m
                                    )
                                 
                              
                              
                                 ∑
                                 
                                    
                                       x
                                       i
                                    
                                    (
                                    m
                                    )
                                    ∈
                                    {
                                    A
                                    ,
                                    T
                                    ,
                                    G
                                    ,
                                    C
                                    }
                                 
                              
                              
                                 ∑
                                 
                                    
                                       x
                                       i
                                    
                                    (
                                    n
                                    )
                                    ∈
                                    {
                                    A
                                    ,
                                    T
                                    ,
                                    G
                                    ,
                                    C
                                    }
                                 
                              
                              δ
                              (
                              
                                 x
                                 i
                              
                              (
                              m
                              )
                              ,
                              
                                 x
                                 i
                              
                              (
                              n
                              )
                              )
                              Pr
                              (
                              
                                 x
                                 i
                              
                              (
                              m
                              )
                              ,
                              
                                 x
                                 i
                              
                              (
                              n
                              )
                              )
                              ,
                           
                        
                     where Pr(x
                     
                        i
                     (m), x
                     
                        i
                     (n)|y
                     
                        i
                     ) and Pr(x
                     
                        i
                     (m), x
                     
                        i
                     (n)) are the marginal probabilities derived from Pr(x
                     
                        i
                     |y
                     
                        i
                     ) and Pr(x
                     
                        i
                     ), respectively. For example, Pr(x
                     
                        i
                     (m), x
                     
                        i
                     (n)) is a probability that a certain state of x
                     
                        i
                     (m) and x
                     
                        i
                     (n) realizes with no other conditions.

Hereafter, we use the mean field approximation (MFA) method. First, we focus on the left-hand side of Eq. (30). We introduce a marginal probability ρ
                     
                        m
                     (x) that a true letter x
                     
                        i
                     (m) is identified as a certain letter x
                     ∈{A, T, G, C} when y
                     
                        i
                      is given. Note that ∑
                        x∈{A,T,G,C}
                     ρ
                     
                        m
                     (x)=1. The exact probabilities are approximated by


                     
                        
                           (31)
                           
                              Pr
                              (
                              
                                 
                                    
                                       x
                                    
                                 
                                 i
                              
                              |
                              
                                 
                                    
                                       y
                                    
                                 
                                 i
                              
                              )
                              ≈
                              
                                 ∏
                                 
                                    m
                                    =
                                    1
                                 
                                 M
                              
                              
                                 ρ
                                 m
                              
                              (
                              
                                 x
                                 i
                              
                              (
                              m
                              )
                              )
                           
                        
                     
                     
                        
                           (32)
                           
                              Pr
                              (
                              
                                 x
                                 i
                              
                              (
                              m
                              )
                              ,
                              
                                 x
                                 i
                              
                              (
                              n
                              )
                              |
                              
                                 
                                    
                                       y
                                    
                                 
                                 i
                              
                              )
                              ≈
                              
                                 ρ
                                 m
                              
                              (
                              
                                 x
                                 i
                              
                              (
                              m
                              )
                              )
                              
                              
                                 ρ
                                 n
                              
                              (
                              
                                 x
                                 i
                              
                              (
                              n
                              )
                              )
                              .
                           
                        
                     In the MFA method, the ρ
                     
                        m
                     (x) is given by


                     
                        
                           (33)
                           
                              
                                 ρ
                                 m
                              
                              (
                              x
                              )
                              =
                              
                                 
                                    exp
                                    (
                                    
                                       E
                                       m
                                    
                                    (
                                    x
                                    )
                                    )
                                 
                                 
                                    
                                       ∑
                                       
                                          w
                                          ∈
                                          {
                                          A
                                          ,
                                          T
                                          ,
                                          G
                                          ,
                                          C
                                          }
                                       
                                    
                                    exp
                                    (
                                    
                                       E
                                       m
                                    
                                    (
                                    w
                                    )
                                    )
                                 
                              
                              
                              (
                              x
                              ∈
                              {
                              A
                              ,
                              T
                              ,
                              G
                              ,
                              C
                              }
                              )
                           
                        
                     
                     
                        
                           (34)
                           
                              
                                 E
                                 m
                              
                              (
                              x
                              )
                              ≡
                              ϕ
                              (
                              x
                              ,
                              
                                 y
                                 i
                              
                              (
                              m
                              )
                              )
                              +
                              
                                 β
                                 i
                              
                              
                                 ∑
                                 
                                    n
                                    ∈
                                    
                                       S
                                       nei
                                    
                                    (
                                    m
                                    )
                                 
                              
                              
                                 ∑
                                 
                                    w
                                    ∈
                                    {
                                    A
                                    ,
                                    T
                                    ,
                                    G
                                    ,
                                    C
                                    }
                                 
                              
                              δ
                              (
                              x
                              ,
                              w
                              )
                              
                                 ρ
                                 n
                              
                              (
                              w
                              )
                           
                        
                     
                     
                        
                           (35)
                           
                              =
                              ϕ
                              (
                              x
                              ,
                              
                                 y
                                 i
                              
                              (
                              m
                              )
                              )
                              +
                              
                                 β
                                 i
                              
                              
                                 ∑
                                 
                                    n
                                    ∈
                                    
                                       S
                                       nei
                                    
                                    (
                                    m
                                    )
                                 
                              
                              
                                 ρ
                                 n
                              
                              (
                              x
                              )
                              .
                           
                        
                     The values of ρ
                     
                        m
                     (x)'s are determined by iterative calculation of Eqs. (33) and (35). From an arbitrary set of initial values of ρ
                     
                        m
                     (x)'s, for example ρ
                     
                        m
                     (x)=1/4 for all m's and x's, a set of E
                     
                        m
                     (x)'s is calculated, and the iterative calculation continues until it reaches a convergence state. After determining the values of ρ
                     
                        m
                     (x)'s for all m's and x's, the left-hand side of Eq. (30) can be calculated by the following approximation:


                     
                        
                           (36)
                           
                              ≈
                              
                                 ∑
                                 
                                    m
                                    =
                                    1
                                 
                                 M
                              
                              
                                 ∑
                                 
                                    n
                                    ∈
                                    
                                       S
                                       nei
                                    
                                    (
                                    m
                                    )
                                 
                              
                              
                                 ∑
                                 
                                    x
                                    ∈
                                    {
                                    A
                                    ,
                                    T
                                    ,
                                    G
                                    ,
                                    C
                                    }
                                 
                              
                              
                                 ∑
                                 
                                    w
                                    ∈
                                    {
                                    A
                                    ,
                                    T
                                    ,
                                    G
                                    ,
                                    C
                                    }
                                 
                              
                              δ
                              (
                              x
                              ,
                              w
                              )
                              
                                 ρ
                                 m
                              
                              (
                              x
                              )
                              
                                 ρ
                                 n
                              
                              (
                              w
                              )
                           
                        
                     
                     
                        
                           (37)
                           
                              =
                              
                                 ∑
                                 
                                    m
                                    =
                                    1
                                 
                                 M
                              
                              
                                 ∑
                                 
                                    n
                                    ∈
                                    
                                       S
                                       nei
                                    
                                    (
                                    m
                                    )
                                 
                              
                              
                                 ∑
                                 
                                    x
                                    ∈
                                    {
                                    A
                                    ,
                                    T
                                    ,
                                    G
                                    ,
                                    C
                                    }
                                 
                              
                              
                                 ρ
                                 m
                              
                              (
                              x
                              )
                              
                                 ρ
                                 n
                              
                              (
                              x
                              )
                              .
                           
                        
                     Similarly, the right-hand side of Eq. (30) can be calculated by using the above method except that Eq. (35) is replaced by


                     
                        
                           (38)
                           
                              
                                 E
                                 m
                              
                              (
                              x
                              )
                              =
                              
                                 β
                                 i
                              
                              
                                 ∑
                                 
                                    n
                                    ∈
                                    
                                       S
                                       nei
                                    
                                    (
                                    m
                                    )
                                 
                              
                              
                                 ρ
                                 n
                              
                              (
                              x
                              )
                              .
                           
                        
                     Finally, by solving Eq. (30) numerically, the value of 
                        
                           
                              β
                              ˜
                           
                           i
                        
                      is determined as a certain β
                     
                        i
                      value that satisfies Eq. (30). Note that this calculation is performed position by position.

Supplementary data associated with this article can be found, in the online version, at http://dx.doi.org/10.1016/j.compbiolchem.2013.09.006.

The following are the supplementary data to this article: 
                        
                           
                        
                     
                  

@&#REFERENCES@&#

