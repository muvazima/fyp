@&#MAIN-TITLE@&#High-order mesh curving by distortion minimization with boundary nodes free to slide on a 3D CAD representation

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We present a method to generate curved high-order meshes for industrial applications.


                        
                        
                           
                           The method is based on the minimization of a single and global objective function.


                        
                        
                           
                           The objective function is defined as the distortion of the volume mesh.


                        
                        
                           
                           To enlarge the feasible region, boundary nodes are free to slide on the CAD model.


                        
                        
                           
                           A block iterative implementation of the global objective function is presented.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Curved high-order meshing

Mesh smoothing

Mesh untangling

Mesh quality

CAD interpolation

Hierarchical minimization

@&#ABSTRACT@&#


               
               
                  We propose a 3D mesh curving method that converts a straight-sided mesh to an optimal-quality curved high-order mesh that interpolates a CAD boundary representation. The main application of this method is the generation of discrete approximations of curved domains that are valid for simulation analysis with unstructured high-order methods. We devise the method as follows. First, the boundary of a straight-sided high-order mesh is curved to match the curves and surfaces of a CAD model. Second, the method minimizes the volume mesh distortion with respect to the coordinates of the inner nodes and the parametric coordinates of the curve and surface nodes. The proposed minimization features untangling capabilities and therefore, it repairs the invalid elements that may arise from the initial curving step. Compared with other mesh curving methods, the only goal of the proposed residual system is to minimize the volume mesh distortion. Furthermore, it is less constrained since the boundary nodes are free to slide on the CAD curves and surfaces. Hence, the proposed method is well suited to generate curved high-order meshes of optimal quality from CAD models that contain thin parts or high-curvature entities. To illustrate these capabilities, we generate several curved high-order meshes from CAD models with the implementation detailed in this work. Specifically, we detail a node-by-node non-linear iterative solver that minimizes the proposed objective function in a block Gauss–Seidel manner.
               
            

@&#INTRODUCTION@&#

In the last decade, unstructured high-order methods  [1–5] have been proved to be well suited to perform high-fidelity simulations on complex domains. First, they are ready to approximate complex curved domains. Second, they feature low numerical dissipation and dispersion. Third, they are faster than low-order methods in several applications  [6–12], specially for problems that require high-accuracy and implicit time stepping. Finally, they favor dense floating-point operations that can be efficiently implemented in current computing architectures. A key ingredient to meet all these practical advantages is the generation of curved high-order discretizations of the simulation domain.

In the most common framework, curved high-order meshes are generated using an a posteriori approach referred as mesh curving  [13–22]. First, an initial linear mesh that features the element size and stretching required by the simulation is generated. For instance, the mesh may present higher resolution in the regions of interest, and highly stretched elements to capture the boundary layers or shocks in the solution. Then, the linear mesh is converted to a straight-sided high-order mesh by introducing additional nodes. Finally, the straight-sided high-order mesh is curved to match the corresponding CAD model boundary.

Typically, the mesh curving is performed in two steps. First, the high-order nodes at the mesh boundary are relocated on the CAD boundary entities to ensure that the corresponding surface elements are smooth and valid. This curving of the mesh boundary may introduce inverted volume elements. Then, the boundary nodes are fixed and the inner high-order nodes are relocated (smoothing) to accommodate the curved boundary and repair the invalid elements (untangling). However, the fixed coordinates of the boundary nodes may excessively constrain the volume mesh and therefore, low-quality or inverted volume elements could be obtained for specific configurations, specially for those configurations that present high-curvature entities, thin regions, or opposite curves and surfaces meshed with the same topology of structured elements.

To overcome this issue, we propose an untangling and smoothing process based on minimizing a global objective function defined only in terms of the distortion of the volume mesh  [23], that takes the coordinates of the high-order nodes as arguments [22,24–26]. The novelty of the approach is that we consider a single target objective function (mesh distortion) where all the nodes, except the nodes located on the geometry vertices, are free to move on the corresponding container CAD entity. Thus, we directly improve the quality of the volume mesh in a single step, instead of first relocating the boundary elements, according to a given surface curving criteria, and then improving the inner elements, according to a different volume curving criteria.

It is important to point out that our method targets the quality of the volume mesh, which is critical in the simulation analysis. That is, low-quality meshes may hinder the accuracy of the simulation approximation to the solution. Furthermore, if the quality of the volume mesh is optimal, then the quality of the boundary mesh is high. Counter-wise, optimal surface meshes can determine the boundary of low-quality or even invalid volume meshes. That is, the reciprocal, the case for standard mesh curving methods, is not true in general.

Although the objective function is globally defined for all the nodes, we propose to optimize it using a hierarchical approach in three stages. First, we improve the quality of the volume mesh by moving the curve nodes along the CAD curves. Second, we improve the quality of the volume mesh by moving the surface nodes on the CAD surfaces. Finally, we improve the quality of the volume mesh moving the interior nodes. During the first two steps of the proposed method, we have to ensure that the boundary nodes are located on the corresponding curves and surfaces. To this end, we consider the parameterization of curves and surfaces provided by the CAD model. Specifically, the unknowns that correspond to the curve and surface nodes are determined by their parametric coordinates on the CAD entities as in  [27,28]. Following this approach, we ensure that the nodes lie on the corresponding entity, and we avoid expensive and non-robust projections of the nodes onto the boundary.

The main advantage of the proposed approach is that we only take into account the quality of the volume mesh. Moreover, the location of the curve and surface nodes is not fixed. This results in an optimization process that is less constrained than the standard approach (fixed boundary nodes) and therefore, a better configuration of nodes can be achieved. It is important to point out that the node type (vertex, curve, surface or volume) is assigned during the hierarchical meshing process. That is, when the curve, surface and volume meshes are generated, the corresponding nodes are marked with the appropriate type.

The remaining of the paper is structured as follows. In Section  2, we review the existing literature related to the presented work. In Section  3, we present a simple two-dimensional example to illustrate the objectives of this work. In Section  4 we present the scope of this work, the statement of the problem we aim to solve, and the selected approach. In Section  5, we show the proposed formulation for the optimization process. In Section  6, we present the proposed hierarchical optimization approach. Then, in Section  7, we present several examples in order to show that the proposed method is able to untangle inverted elements and improve the overall mesh quality. Finally, in Section  8, we present the concluding remarks and the future work.

@&#RELATED WORK@&#

Refs.  [29–31], introduce a framework to define element quality and distortion measures for linear elements. These measures can be written in terms of the Jacobian of the mapping between an ideal and a physical element. Thereafter, these measures were extended to quantify the quality of high-order elements  [18,22,24–26]. Using these algebraic distortion measures, several authors proposed to perform an optimization process to compute the optimal node position that minimizes the mesh distortion, see [31–35] for linear elements and  [22,24–26] for high-order elements. The minimization process can be performed globally or locally. In the global approach, an objective function has to be minimized for all the nodes at the same time. In the local approach, all the free nodes are smoothed sequentially until the objective function is optimized.

The objective functions introduced by Knupp present asymptotes (barriers) when inverted elements appear in the mesh. For this reason, when tangled elements are present, the optimization process is not able to recover a valid configuration of the nodes to obtain untangled elements. To overcome this drawback, in [31,34], a two-stage smoothing process is proposed. In the first stage, an objective function to untangle the inverted elements is used. In the second stage, a different objective function to improve the quality is used. That is, the optimization process is driven by two objective functions: the first one to untangle the mesh, and the second one to smooth the mesh. Other authors used the log-barrier method in order to avoid tangled elements, see  [21,36,37]. A different approach to avoid the singularities, is to consider a regularized version of the distortion of the linear volume (boundary) elements surrounding an inner (boundary) node. In this manner, specific-purpose untangling and smoothing techniques using the shape distortion measure for triangular  [38] and tetrahedral  [39] meshes have been proposed. Note that we also consider the same regularization of the shape distortion measure. However, in our method the shape distortion measure is evaluated in a point-wise manner instead of considering the elements surrounding a node. Specifically, we consider a single target objective function that corresponds to the squared norm of the shape distortion measure of the whole high-order volume mesh.

Several algorithms deal with mesh smoothing on parameterized surfaces. These algorithms could be classified as indirect or direct. The indirect algorithms first compute the ideal position of a node and then they project back the node to the surface, see [38,40–43]. On the other hand, direct methods express the objective function in terms of the parametric coordinates of the nodes  [24,44–47]. Thus, there is no need to project the nodes back to the surface. Note that these techniques are typically used during the process of obtaining a valid volume mesh. First, a smoothing of the boundary mesh is carried out to obtain valid boundary elements and then, a smoothing of the interior nodes is performed to improve the quality of the whole mesh. Note that two different objective functions are used: one for the boundary nodes, and a different one for the interior nodes. The former is expressed in terms of the distortion of the boundary surface mesh, and the latter is expressed in terms of the distortion of the volume mesh. On the contrary, we consider the same objective function for the whole smoothing process. Specifically, our objective function has a single target that measures the distortion of the volume mesh. This single target formulation allows untangling and smoothing the whole mesh by moving at the same time the volume and surface nodes instead of using two specific-purpose stages for surface and volume meshes.

Different methods have been proposed to improve the quality of the volume mesh by moving the inner and boundary nodes. Note that the main issue is to impose that the boundary nodes should approximate the geometry boundary. To this end, it is possible to include a penalty term in the objective function that enforces that the corresponding nodes move close to the boundary  [48]. It is also possible to impose that the nodes are strictly on the geometry boundary. In  [49] the authors proposed a mesh quality improvement method that relocates the volume and surface nodes, but not the curve nodes. In some applications, such as curved high-order mesh generation or structured meshing, it could be also required to move the curve nodes. In  [21] a method to smooth and untangle curved high-order meshes using the parametric coordinates of the surface and curve nodes was proposed. Specifically, they minimize an objective function that penalizes both large deformations and small values of the determinant of the iso-parametric mapping. In Ref.  [50], the authors showed a smoothing method to increase the quality of iso-geometric meshes by moving the nodes on curves and surfaces. In our work, we also propose to move the nodes on the curves and surfaces based on their parametric coordinates. The difference here is that our goal is to minimize a regularized distortion measure of the volume mesh.

@&#MOTIVATION@&#

To highlight the importance of moving the boundary nodes during an untangling and smoothing process, we show a simple linear quadrilateral mesh for a test geometry. Fig. 1
                     (a) presents the initial mesh generated using the submapping method. Note that the initial geometry is composed of four curves. Due to the curve curvature, when the boundary curves are discretized using intervals of the same length, the inner mesh contains inverted elements. When we apply a smoothing technique to improve the mesh quality, the method is not able to obtain a valid mesh even when the boundary is discretized using high-quality elements, see Fig. 1(b). The objective of this work is to develop a smoother that is able to move the interior nodes as well as the boundary nodes according to the distortion measure of the volume elements. Using this procedure, a high-quality mesh is obtained, even when the boundary discretization constrains the quality of the whole mesh, see Fig. 1(c).

Our input data is a linear mesh, 
                           
                              
                                 M
                              
                              
                                 1
                              
                              
                           
                        , with the boundary nodes located on the corresponding CAD entities. We assume that the linear mesh is valid and its elements have the correct size and shape. We also assume that the entities of the geometry boundary, 
                           
                              
                                 Σ
                              
                              
                                 j
                              
                           
                        , for 
                           j
                           =
                           1
                           ,
                           …
                           ,
                           N
                         are parameterized by a continuously differentiable and invertible mapping (diffeomorphism) in such a way that:
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   φ
                                                
                                             
                                             
                                                j
                                             
                                          
                                          :
                                          
                                          
                                             
                                                U
                                             
                                             
                                                j
                                             
                                          
                                          ⊂
                                          
                                             
                                                R
                                             
                                             
                                                
                                                   
                                                      d
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          ⟶
                                          
                                             
                                                Σ
                                             
                                             
                                                j
                                             
                                          
                                          ⊂
                                          
                                             
                                                R
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             u
                                          
                                          =
                                          
                                             (
                                             
                                                
                                                   u
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   u
                                                
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                          ⟼
                                          
                                             x
                                          
                                          =
                                          
                                             
                                                
                                                   φ
                                                
                                             
                                             
                                                j
                                             
                                          
                                          
                                             (
                                             
                                                u
                                             
                                             )
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                         where 
                           
                              
                                 
                                    φ
                                 
                              
                              
                                 j
                              
                           
                         and 
                           
                              
                                 d
                              
                              
                                 j
                              
                           
                         are the parameterization and the dimension of entity 
                           
                              
                                 Σ
                              
                              
                                 j
                              
                           
                        , and 
                           
                              
                                 U
                              
                              
                                 j
                              
                           
                         is the parametric space. In our applications, we use the Open CASCADE library  [51] to obtain the parameterizations of the geometrical entities.

The output is a high-order mesh, 
                           
                              
                                 M
                              
                              
                                 p
                              
                              
                           
                        , of polynomial degree 
                           p
                         with all the boundary nodes located on the corresponding CAD entity, and composed of valid elements that have a shape and size close to the corresponding element in the initial linear mesh, 
                           
                              
                                 M
                              
                              
                                 1
                              
                              
                           
                        .

@&#METHODOLOGY@&#

The proposed approach is composed of the following four steps.
                           
                              1.
                              
                                 Generate a linear mesh of the geometry. Using any established linear mesh generator, we create a mesh with elements of the desired shape and size. Note that our approach requires the physical coordinates of all the nodes, and the parametric coordinates of the boundary nodes on the geometrical entity where they are located. This information is assigned while the mesh is generated hierarchically. That is, when the curve, surface and volume meshes are generated, the nodes store the entity where they belong to.


                                 Set the ideal mesh. We increase the polynomial degree of the initial linear mesh on the physical space and we set this straight-sided high-order mesh as the ideal configuration in our optimization procedure. Note that this mesh is of the desired polynomial degree and, at the same time, has elements of the desired size and shape.


                                 Set the initial curved high-order mesh. We define a distribution of nodes of degree 
                                    p
                                  on the straight-sided elements. For elements adjacent to the boundary, we bend the element edges and faces to match the geometry. Specifically, we use the Legendre–Gauss–Lobatto distribution of nodes  [52] along the edges of the mesh. Then, the inner nodes of the mesh faces and cells are redistributed by means of the blending presented in  [52]. Note that the boundary nodes are created on the parametric space of all the curves and surfaces that contain each node. Thus, we generate a mesh with the boundary nodes on the corresponding CAD entities and, for this reason, the mesh interpolates the geometry. The high-order meshes obtained after these operations may contain tangled elements, specially if high-curvature curves or surfaces are present in the geometry. These inverted elements appear due to two main issues. First, the a posteriori curving of the elements to match the geometry boundary can lead to element auto-intersections. Second, a valid high-order distribution of nodes in the parametric space can be invalid once it is mapped into the physical space due to low-quality parameterizations of the boundary.


                                 Obtain a valid curved configuration of the high-order mesh. We optimize the location of the nodes in order to minimize the distortion of the high-order volume mesh. We point out that the boundary nodes are moved on the parametric space of the geometrical entity where they are located. Thus, the position in the physical space of the boundary nodes is defined using the parameterization of its corresponding geometrical entity.

According to  [29,30], the shape distortion measure for a linear element is 
                           
                              (1)
                              
                                 
                                    
                                       η
                                    
                                    
                                 
                                 
                                    (
                                    
                                       D
                                    
                                    
                                       ϕ
                                    
                                    
                                       (
                                       
                                          y
                                       
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                |
                                                
                                                   D
                                                
                                                
                                                   ϕ
                                                
                                                
                                                   (
                                                   
                                                      y
                                                   
                                                   )
                                                
                                                |
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       n
                                       
                                          
                                             σ
                                             
                                                (
                                                
                                                   D
                                                
                                                
                                                   ϕ
                                                
                                                
                                                   (
                                                   
                                                      y
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                          
                                             2
                                             /
                                             n
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              y
                           
                         is a point of the ideal element, 
                           
                              ϕ
                           
                         is the mapping between an ideal element and the physical element, 
                           
                              D
                           
                           
                              ϕ
                           
                         is the Jacobian of 
                           
                              ϕ
                           
                        , 
                           σ
                           
                              (
                              ⋅
                              )
                           
                         is the determinant, 
                           n
                         is the space dimension and 
                           
                              |
                              ⋅
                              |
                           
                           =
                           
                              
                                 
                                    (
                                    ⋅
                                    ,
                                    ⋅
                                    )
                                 
                              
                           
                         is the Frobenius norm, being 
                           
                              (
                              ⋅
                              ,
                              ⋅
                              )
                           
                         a dot product for matrices, defined as 
                           
                              
                                 
                                    (
                                    
                                       A
                                    
                                    ,
                                    
                                       B
                                    
                                    )
                                 
                                 =
                                 
                                    tr
                                 
                                 
                                    (
                                    
                                       
                                          
                                             A
                                          
                                       
                                       
                                          
                                             T
                                          
                                       
                                    
                                    
                                       B
                                    
                                    )
                                 
                                 .
                              
                           
                         We note that this distortion measure is invariant to translation and rotations, and equals 1 when the two elements only differ by a scale factor, and tends to 
                           ∞
                         when 
                           
                              
                                 e
                              
                              
                                 P
                              
                           
                         becomes degenerate. The distortion measure can be used to improve the mesh quality by means of a minimization process, see  [31–35]. However, the shape distortion measure presents asymptotes when 
                           σ
                           
                              (
                              
                                 D
                              
                              
                                 ϕ
                              
                              
                                 (
                                 
                                    y
                                 
                                 )
                              
                              )
                           
                           =
                           0
                        . This prevents the use of this distortion measure in a continuous optimization procedure. To overcome this drawback, in Ref.  [39] a regularization of Eq. (4) is introduced as 
                           
                              (2)
                              
                                 
                                    
                                       η
                                    
                                    
                                       δ
                                    
                                 
                                 
                                    (
                                    
                                       D
                                    
                                    
                                       ϕ
                                    
                                    
                                       (
                                       
                                          y
                                       
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                |
                                                
                                                   D
                                                
                                                
                                                   ϕ
                                                
                                                
                                                   (
                                                   
                                                      y
                                                   
                                                   )
                                                
                                                |
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       n
                                       
                                          
                                             
                                                
                                                   σ
                                                
                                                
                                                   δ
                                                
                                             
                                             
                                                (
                                                
                                                   D
                                                
                                                
                                                   ϕ
                                                
                                                
                                                   (
                                                   
                                                      y
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                          
                                             2
                                             /
                                             n
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              (3)
                              
                                 
                                    
                                       σ
                                    
                                    
                                       δ
                                    
                                 
                                 
                                    (
                                    
                                       D
                                    
                                    
                                       ϕ
                                    
                                    
                                       (
                                       
                                          y
                                       
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    σ
                                    +
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          4
                                          
                                             
                                                δ
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         The 
                           δ
                         parameter is defined as a small parameter, and its value depends on the problem. For a further analysis on the selection of 
                           δ
                         for high-order meshes, see  [22,24,47,53]. In the case of linear meshes, the 
                           δ
                         parameter can be chosen according to  [38,39,54].

Given an initial domain, 
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 I
                              
                           
                        , we want to characterize a physical domain, 
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 P
                              
                           
                        , in terms of a diffeomorphism 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 ∗
                              
                           
                           ∈
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                           
                              (
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                    
                                 
                                 
                                    I
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                    
                                 
                                 
                                    P
                                 
                              
                              )
                           
                        . To determine the desired diffeomorphism 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 ∗
                              
                           
                        , we consider to use a distortion measure  [22] of mapping 
                           
                              ϕ
                           
                         defined in terms of the regularized point-wise shape distortion measure  [29,30]. That is, 
                           
                              (4)
                              
                                 M
                                 
                                    ϕ
                                 
                                 
                                    (
                                    
                                       y
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       η
                                    
                                    
                                       δ
                                    
                                 
                                 
                                    (
                                    
                                       D
                                    
                                    
                                       ϕ
                                    
                                    
                                       (
                                       
                                          y
                                       
                                       )
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     

In contrast with  [22], where the optimal mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 ∗
                              
                           
                         is prescribed at boundary of the physical domain (i.e. the boundary mesh is fixed), we allow different diffeomorphisms candidates 
                           
                              ϕ
                           
                         as long as 
                           
                              ϕ
                           
                           
                              (
                              ∂
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                    
                                 
                                 
                                    I
                                 
                              
                              )
                           
                           =
                           ∂
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 P
                              
                           
                        . That is, we allow any mapping 
                           
                              ϕ
                           
                         that maps the boundary of the initial domain onto the boundary of the physical domain. Recall that in the standard approach the mapping 
                           
                              ϕ
                           
                         is known at the domain boundary which, is a particular case of the mappings we allow. Accordingly, our method can explore more valid diffeomorphisms and therefore, can obtain volume meshes with a smaller distortion.

We assume that both the initial domain and the physical domain, 
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 I
                              
                           
                         and 
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 P
                              
                           
                        , respectively, are composed of the union of a set of sub-entities (namely, the vertices, curves, surfaces and volumes): 
                           
                              
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                       
                                    
                                    
                                       I
                                    
                                 
                                 =
                                 
                                    
                                       ⋃
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       Ω
                                    
                                    
                                       I
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                       
                                    
                                    
                                       P
                                    
                                 
                                 =
                                 
                                    
                                       ⋃
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       Ω
                                    
                                    
                                       P
                                    
                                    
                                       k
                                    
                                 
                                 ,
                              
                           
                         where 
                           N
                         is the number of sub-entities contained in each domain. Fig. 2
                         shows an initial domain, 
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 I
                              
                           
                        , composed of four vertices, five curves and two surfaces, and a mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 ∗
                              
                           
                         that converts the initial domain into the physical domain, 
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 P
                              
                           
                        . Note that, in addition, each sub-entity of the initial domain, 
                           
                              
                                 Ω
                              
                              
                                 I
                              
                              
                                 k
                              
                           
                        , has to be mapped into the corresponding sub-entity of the physical domain, 
                           
                              
                                 Ω
                              
                              
                                 P
                              
                              
                                 k
                              
                           
                        . That is, 
                           
                              
                                 
                                    
                                       
                                          ϕ
                                       
                                    
                                    
                                       ∗
                                    
                                 
                              
                              
                           
                           
                              (
                              
                                 
                                    Ω
                                 
                                 
                                    I
                                 
                                 
                                    k
                                 
                              
                              )
                           
                           =
                           
                              
                                 Ω
                              
                              
                                 P
                              
                              
                                 k
                              
                           
                        , for 
                           k
                           =
                           1
                           ,
                           …
                           ,
                           N
                        . The main idea is that the mapping 
                           
                              ϕ
                           
                         has to convert the vertices, edges, faces and volumes of the initial domain into the corresponding counterpart in the physical domain.

The continuous problem consists on finding a diffeomorphism 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 ∗
                              
                           
                           ∈
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                           
                              (
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                    
                                 
                                 
                                    I
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                    
                                 
                                 
                                    P
                                 
                              
                              )
                           
                         such that the distortion measure is ideal and it maps each sub-entity of the initial domain, 
                           
                              
                                 Ω
                              
                              
                                 I
                              
                              
                                 k
                              
                           
                        , into the corresponding sub-entity of the physical domain, 
                           
                              
                                 Ω
                              
                              
                                 P
                              
                              
                                 k
                              
                           
                        . Specifically, 
                           
                              
                                 
                                    M
                                    
                                       
                                          
                                             ϕ
                                          
                                       
                                       
                                          ∗
                                       
                                    
                                    =
                                    1
                                    ,
                                    ∀
                                    
                                       y
                                    
                                    ∈
                                    
                                       
                                          
                                             
                                                Ω
                                             
                                             
                                          
                                       
                                       
                                          I
                                       
                                    
                                    ,
                                 
                              
                              
                                 (5)
                                 
                                    
                                       
                                          
                                             ϕ
                                          
                                       
                                       
                                          ∗
                                       
                                    
                                    
                                       (
                                       
                                          
                                             Ω
                                          
                                          
                                             I
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          Ω
                                       
                                       
                                          P
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    ∀
                                    
                                       
                                          Ω
                                       
                                       
                                          I
                                       
                                       
                                          k
                                       
                                    
                                    ∈
                                    
                                       
                                          
                                             
                                                Ω
                                             
                                             
                                          
                                       
                                       
                                          I
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

We consider that the domain 
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 I
                              
                           
                         is approximated by a mesh 
                           
                              
                                 M
                              
                              
                                 I
                              
                              
                           
                         in such a way that each sub-entity of the initial domain, 
                           
                              
                                 Ω
                              
                              
                                 I
                              
                              
                                 k
                              
                           
                        , is approximated by a sub-mesh of 
                           
                              
                                 M
                              
                              
                                 I
                              
                              
                           
                        , denoted as 
                           
                              
                                 M
                              
                              
                                 I
                              
                              
                                 k
                              
                           
                        . That is, each geometrical entity is discretized using the corresponding mesh, see Fig. 3
                        . Note that this is the case of a standard hierarchical mesh generator. The three-dimensional mesh approximates the domain volumes, and the sub-meshes approximate the curves and surfaces that compose the CAD model. In this setting, we seek for an optimal element-wise local diffeomorphism, 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                              
                                 ∗
                              
                           
                           ∈
                           
                              
                                 C
                              
                              
                                 0
                              
                           
                           
                              (
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                    
                                 
                                 
                                    I
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                    
                                 
                                 
                                    P
                                 
                              
                              )
                           
                        , such that the physical mesh 
                           
                              
                                 M
                              
                              
                                 P
                              
                              
                           
                         has an ideal distortion measure. In addition, we also require that the set of mesh nodes of each sub-entity in the ideal configuration, 
                           V
                           
                              (
                              
                                 
                                    M
                                 
                                 
                                    I
                                 
                                 
                                    k
                                 
                              
                              )
                           
                        , is mapped into the corresponding sub-entity of the physical domain. That is, we impose that the nodes of the physical mesh interpolate the sub-entities of the physical domain. Specifically, 
                           
                              
                                 (6)
                                 
                                    M
                                    
                                       
                                          
                                             ϕ
                                          
                                       
                                       
                                          h
                                       
                                       
                                          ∗
                                       
                                    
                                    =
                                    1
                                    ,
                                    ∀
                                    
                                       y
                                    
                                    ∈
                                    
                                       
                                          M
                                       
                                       
                                          I
                                       
                                       
                                    
                                    ,
                                 
                              
                              
                                 (7)
                                 
                                    V
                                    
                                       (
                                       
                                          
                                             M
                                          
                                          
                                             P
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          
                                             ϕ
                                          
                                       
                                       
                                          h
                                       
                                       
                                          ∗
                                       
                                    
                                    
                                       (
                                       V
                                       
                                          (
                                          
                                             
                                                M
                                             
                                             
                                                I
                                             
                                             
                                                k
                                             
                                          
                                          )
                                       
                                       )
                                    
                                    ∈
                                    
                                       
                                          Ω
                                       
                                       
                                          P
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    ∀
                                    
                                       
                                          M
                                       
                                       
                                          I
                                       
                                       
                                          k
                                       
                                    
                                    ∈
                                    
                                       
                                          M
                                       
                                       
                                          I
                                       
                                       
                                    
                                    .
                                 
                              
                           
                         Since we are looking for a conformal mesh, we seek the mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                              
                                 ∗
                              
                           
                         in the space of vector functions 
                           
                              
                                 U
                                 =
                                 
                                    {
                                    
                                       u
                                    
                                    ∈
                                    
                                       
                                          
                                             [
                                             
                                                
                                                   C
                                                
                                                
                                                   0
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      M
                                                   
                                                   
                                                      I
                                                   
                                                   
                                                
                                                )
                                             
                                             ]
                                          
                                       
                                       
                                          d
                                       
                                    
                                      such that  
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          |
                                          
                                             
                                                e
                                             
                                             
                                                I
                                             
                                          
                                       
                                    
                                    ∈
                                    
                                       
                                          
                                             [
                                             
                                                
                                                   P
                                                
                                                
                                                   p
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      I
                                                   
                                                
                                                )
                                             
                                             ]
                                          
                                       
                                       
                                          d
                                       
                                    
                                    ,
                                    
                                    ∀
                                    
                                       
                                          e
                                       
                                       
                                          I
                                       
                                    
                                    ∈
                                    
                                       
                                          M
                                       
                                       
                                          I
                                       
                                       
                                    
                                    }
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 P
                              
                              
                                 p
                              
                           
                           
                              (
                              
                                 
                                    e
                                 
                                 
                                    I
                                 
                              
                              )
                           
                         is the space of polynomials on 
                           
                              
                                 e
                              
                              
                                 I
                              
                           
                         of degree at most 
                           p
                        . This corresponds to the standard function space for continuous Galerkin methods, determined by element-wise polynomials of degree at most 
                           p
                         and continuous at the element interfaces. Note that for a given initial mesh, 
                           
                              
                                 M
                              
                              
                                 I
                              
                              
                           
                        , and a configuration of the physical domain, 
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 P
                              
                           
                        , it may not exist a mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                              
                                 ∗
                              
                           
                         such that Eqs. (6) and (7) are verified. For this reason, we impose the optimality condition in a least-squares sense: 
                           
                              (8)
                              
                                 
                                    
                                       
                                          ϕ
                                       
                                    
                                    
                                       h
                                    
                                    
                                       ∗
                                    
                                 
                                 =
                                 
                                    
                                       argmin
                                       
                                          
                                             1
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                ϕ
                                             
                                          
                                          
                                             h
                                          
                                       
                                       ∈
                                       
                                          
                                             U
                                          
                                          
                                             D
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          M
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                h
                                             
                                          
                                          −
                                          1
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 
                                    
                                       U
                                    
                                    
                                       D
                                    
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             ϕ
                                          
                                       
                                       
                                          h
                                       
                                    
                                    ∈
                                    U
                                      such that  
                                    
                                       (
                                       M
                                       
                                          
                                             
                                                ϕ
                                             
                                          
                                          
                                             h
                                          
                                       
                                       −
                                       1
                                       )
                                    
                                    ∈
                                    
                                       
                                          L
                                       
                                       
                                          2
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                             
                                          
                                          
                                             I
                                          
                                       
                                       )
                                    
                                    ,
                                    and  
                                    
                                       
                                          
                                             ϕ
                                          
                                       
                                       
                                          h
                                       
                                    
                                    
                                       (
                                       V
                                       
                                          (
                                          
                                             
                                                M
                                             
                                             
                                                I
                                             
                                             
                                                k
                                             
                                          
                                          )
                                       
                                       )
                                    
                                    ∈
                                    
                                       
                                          Ω
                                       
                                       
                                          P
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                    ∀
                                    
                                       
                                          M
                                       
                                       
                                          I
                                       
                                       
                                          k
                                       
                                    
                                    ∈
                                    
                                       
                                          M
                                       
                                       
                                          I
                                       
                                       
                                    
                                    }
                                 
                                 .
                              
                           
                         That is, we seek the mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                              
                                 ∗
                              
                           
                         in the set of functions that have a finite distortion measure in the sense of the 
                           
                              
                                 L
                              
                              
                                 2
                              
                           
                         norm (it is a valid mapping) and, in addition, map the nodes of each sub-mesh of the initial domain into the corresponding entity of the physical domain (the nodes interpolate the boundary).

In Eq. (8), we define the norms: 
                           
                              
                                 (9)
                                 
                                    
                                       
                                          
                                             ‖
                                             f
                                             ‖
                                          
                                       
                                       
                                          
                                             
                                                M
                                             
                                             
                                                I
                                             
                                             
                                          
                                       
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   〈
                                                   f
                                                   ,
                                                   f
                                                   〉
                                                
                                             
                                             
                                                
                                                   
                                                      M
                                                   
                                                   
                                                      I
                                                   
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                              
                                 (10)
                                 
                                    
                                       
                                          
                                             ‖
                                             f
                                             ‖
                                          
                                       
                                       
                                          
                                             
                                                e
                                             
                                             
                                                I
                                             
                                          
                                       
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   〈
                                                   f
                                                   ,
                                                   f
                                                   〉
                                                
                                             
                                             
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      I
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                         being the inner product of scalar functions 
                           f
                         and 
                           g
                         in 
                           
                              
                                 M
                              
                              
                                 I
                              
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       
                                          〈
                                          f
                                          ,
                                          g
                                          〉
                                       
                                    
                                    
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             I
                                          
                                       
                                       ∈
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          〈
                                          f
                                          ,
                                          g
                                          〉
                                       
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             I
                                          
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          〈
                                          f
                                          ,
                                          g
                                          〉
                                       
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             I
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             I
                                          
                                       
                                    
                                 
                                 f
                                 
                                    (
                                    
                                       y
                                    
                                    )
                                 
                                 
                                 g
                                 
                                    (
                                    
                                       y
                                    
                                    )
                                 
                                 
                                 d
                                 
                                    y
                                 
                                 .
                              
                           
                         This is the classical inner product of functions in the 
                           
                              
                                 L
                              
                              
                                 2
                              
                           
                           
                              (
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                    
                                 
                                 
                                    I
                                 
                              
                              )
                           
                         function space, and it induces the norm of functions introduced in Eq. (9). When the optimal mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                              
                                 ∗
                              
                           
                         is found, the physical mesh is characterized as 
                           
                              
                                 M
                              
                              
                                 P
                              
                              
                           
                           =
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                              
                                 ∗
                              
                           
                           
                              (
                              
                                 
                                    M
                                 
                                 
                                    I
                                 
                                 
                              
                              )
                           
                        . In addition, the meshes that approximate the different sub-entities of the physical domain are defined as 
                           
                              
                                 M
                              
                              
                                 P
                              
                              
                                 k
                              
                           
                           =
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                              
                                 ∗
                              
                           
                           
                              (
                              
                                 
                                    M
                                 
                                 
                                    I
                                 
                                 
                                    k
                                 
                              
                              )
                           
                        , for 
                           k
                           =
                           1
                           ,
                           …
                           ,
                           N
                        . Note that in contrast with the classical approaches, the boundary mesh is not fixed, and is the mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                              
                                 ∗
                              
                           
                         ​that determines the boundary mesh. Specifically, the boundary nodes are free to slide on the corresponding domain sub-entities.

The distortion measure of a given element, 
                           
                              
                                 e
                              
                              
                                 P
                              
                           
                        , is defined as 
                           
                              (11)
                              
                                 
                                    
                                       η
                                    
                                    
                                 
                                 
                                    (
                                    
                                       
                                          e
                                       
                                       
                                          P
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                ‖
                                                M
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      h
                                                   
                                                
                                                ‖
                                             
                                          
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   I
                                                
                                             
                                          
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                ‖
                                                1
                                                ‖
                                             
                                          
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   I
                                                
                                             
                                          
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                         being 
                           
                              
                                 e
                              
                              
                                 I
                              
                           
                        , the corresponding ideal element. Note that 
                           
                              
                                 
                                    ‖
                                    1
                                    ‖
                                 
                              
                              
                                 
                                    
                                       e
                                    
                                    
                                       I
                                    
                                 
                              
                              
                           
                         is the measure of the ideal element. Then, the quality measure of an element, 
                           
                              
                                 e
                              
                              
                                 P
                              
                           
                        , can be defined as the inverse of the distortion 
                           
                              (12)
                              
                                 q
                                 
                                    (
                                    
                                       
                                          e
                                       
                                       
                                          P
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             η
                                          
                                          
                                       
                                       
                                          (
                                          
                                             
                                                e
                                             
                                             
                                                P
                                             
                                          
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

The minimization problem stated in (8) can be expressed in terms of elemental contributions, by using Eqs. (9) and (10), in the following manner: 
                           
                              
                                 
                                    
                                       
                                          ‖
                                          M
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                h
                                             
                                          
                                          −
                                          1
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             I
                                          
                                       
                                       ∈
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          M
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                h
                                             
                                          
                                          −
                                          1
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             I
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                         In the case of nodal high-order elements, the mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                           
                         depends on the physical coordinates of the nodes. Thus, the distortion of a mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                           
                         can be written in terms of the physical coordinates of the nodes 
                           
                              (13)
                              
                                 
                                    
                                       f
                                    
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             x
                                          
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          M
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                h
                                             
                                          
                                          
                                             (
                                             
                                                y
                                             
                                             ;
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                          −
                                          1
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 n
                              
                              
                                 t
                              
                           
                         is the total number of nodes of the high-order mesh. For this reason, the computation of 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                              
                                 ∗
                              
                           
                         in Eq. (8) is equivalent to determine the position of the physical nodes that minimize the distortion of the mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                           
                        . In our setup, we assume that the mapping 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 h
                              
                              
                                 ∗
                              
                           
                         has the form: 
                           
                              
                                 
                                    
                                       
                                          ϕ
                                       
                                    
                                    
                                       h
                                    
                                    
                                       ∗
                                    
                                 
                                 
                                    (
                                    
                                       y
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                       
                                       ∈
                                       V
                                       
                                          (
                                          
                                             
                                                M
                                             
                                             
                                                P
                                             
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       v
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    
                                       y
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 
                                    x
                                 
                              
                              
                                 v
                              
                           
                         are the physical coordinates of node 
                           v
                        , and 
                           
                              
                                 
                                    {
                                    
                                       
                                          N
                                       
                                       
                                          v
                                       
                                    
                                    }
                                 
                              
                              
                                 v
                                 ∈
                                 V
                                 
                                    (
                                    
                                       
                                          M
                                       
                                       
                                          P
                                       
                                       
                                    
                                    )
                                 
                              
                           
                         is a Lagrange polynomial basis of shape functions.

Note that the nodes of the physical mesh can be divided into the set of free nodes that are able to be moved in order to optimize the objective function, and the set of fixed nodes that are not able to be moved. Thus, we can write the function 
                           
                              (14)
                              
                                 
                                    
                                       f
                                    
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             x
                                          
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                f
                                             
                                          
                                       
                                    
                                    ;
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          M
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                h
                                             
                                          
                                          −
                                          1
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 n
                              
                              
                                 f
                              
                           
                         is the number of free nodes, and 
                           
                              
                                 n
                              
                              
                                 p
                              
                           
                         is the number of prescribed nodes, and 
                           
                              
                                 n
                              
                              
                                 f
                              
                           
                           +
                           
                              
                                 n
                              
                              
                                 p
                              
                           
                           =
                           
                              
                                 n
                              
                              
                                 t
                              
                           
                        . In our case, the only fixed nodes are the ones that belong to the vertices of the geometry.

According to Eq. (7), we need to impose that the boundary nodes in the physical mesh belong to the corresponding geometrical entity of the physical domain. To avoid non-robust and expensive projections from the computational point of view, we describe the objective function (14) in terms of the parametric coordinates of the boundary nodes. That is: 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                j
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   φ
                                                
                                             
                                             
                                                j
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      u
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             )
                                          
                                          ,
                                       
                                       
                                          j
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                s
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                k
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   γ
                                                
                                             
                                             
                                                k
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   k
                                                
                                             
                                             )
                                          
                                          ,
                                       
                                       
                                          k
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          
                                             
                                                n
                                             
                                             
                                                c
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                         where 
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                         and 
                           
                              
                                 n
                              
                              
                                 c
                              
                           
                         are the number of mesh points on the surfaces and curves of the geometry, respectively, 
                           
                              
                                 
                                    u
                                 
                              
                              
                                 j
                              
                           
                         and 
                           
                              
                                 t
                              
                              
                                 k
                              
                           
                         are the parametric coordinates of surface and curve nodes, respectively, and 
                           
                              
                                 
                                    φ
                                 
                              
                              
                                 j
                              
                           
                         and 
                           
                              
                                 
                                    γ
                                 
                              
                              
                                 k
                              
                           
                         the parameterizations of the geometric entity where they belong. Using the parametric coordinates of the boundary nodes, the global objective function can be expressed as: 
                           
                              (15)
                              
                                 
                                    
                                       f
                                    
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             x
                                          
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                s
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                c
                                             
                                          
                                       
                                    
                                    ;
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          M
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                h
                                             
                                          
                                          −
                                          1
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 n
                              
                              
                                 i
                              
                           
                         is the number of inner nodes, and 
                           
                              
                                 n
                              
                              
                                 i
                              
                           
                           +
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           +
                           
                              
                                 n
                              
                              
                                 c
                              
                           
                           =
                           
                              
                                 n
                              
                              
                                 f
                              
                           
                        . Eq. (15) describes a global objective function that depends on the position of all the mesh nodes, and it is optimized by moving the location of the inner nodes, the location of the surface nodes and the location of the curve nodes, while keeping fixed the position of vertex nodes.

We have deduced a global objective function that depends on the coordinates of all the free mesh nodes. Since we use nodal elements, we can deduce a local objective function that only depends on the coordinates of one specific node, see details in  [22]. Thus, the local objective function allows the implementation of a non-linear Gauss–Seidel procedure. The local objective function for a single node, 
                           v
                        , is defined as the addition of the elemental contributions of the adjacent elements: 
                           
                              (16)
                              
                                 
                                    
                                       f
                                    
                                    
                                       v
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             I
                                          
                                       
                                       ∈
                                       
                                          
                                             M
                                          
                                          
                                             v
                                          
                                          
                                       
                                    
                                 
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          M
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                h
                                             
                                          
                                          −
                                          1
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             I
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 M
                              
                              
                                 v
                              
                              
                           
                         is the set of elements adjacent to node 
                           v
                        , and 
                           
                              
                                 
                                    ϕ
                                 
                              
                              
                                 
                                    
                                       e
                                    
                                    
                                       I
                                    
                                 
                              
                              
                                 ∗
                              
                           
                         is the mapping between the ideal element, 
                           
                              
                                 e
                              
                              
                                 I
                              
                           
                        , and the physical element, 
                           e
                        .

We need to impose that the curve nodes in the smoothed mesh are located on the boundary curves. To this end, we rewrite the objective function (16) in terms of the parametric coordinates of the boundary nodes. Given a parametric curve, 
                           
                              γ
                           
                           
                              (
                              t
                              )
                           
                        , and a node on the curve, 
                           v
                        , the corresponding objective function is expressed as the composition of functions: 
                           
                              (17)
                              
                                 
                                    
                                       f
                                    
                                    
                                       
                                          γ
                                       
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    
                                       f
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    
                                       γ
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    )
                                 
                                 .
                              
                           
                         The derivatives of the objective function (17) with respect to the parametric coordinate 
                           t
                         can be expressed in terms of Function (16) and the curve parameterization, 
                           
                              γ
                           
                           
                              (
                              t
                              )
                           
                        , by means of the chain rule. That is, 
                           
                              (18)
                              
                                 ∇
                                 
                                    
                                       f
                                    
                                    
                                       
                                          γ
                                       
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 ∇
                                 
                                    
                                       f
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    
                                       γ
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    )
                                 
                                 ⋅
                                 
                                    
                                       
                                          γ
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                              
                           
                         and 
                           
                              (19)
                              
                                 H
                                 
                                    
                                       f
                                    
                                    
                                       
                                          γ
                                       
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   γ
                                                
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ⋅
                                 ∇
                                 
                                    
                                       f
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    
                                       γ
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    )
                                 
                                 ⋅
                                 
                                    
                                       
                                          γ
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 +
                                 ∇
                                 
                                    
                                       f
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    
                                       γ
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    )
                                 
                                 ⋅
                                 
                                    
                                       
                                          γ
                                       
                                    
                                    
                                       ″
                                    
                                 
                                 .
                              
                           
                         The derivatives of the curve parameterization, 
                           
                              γ
                           
                        , are provided by the CAD engine. In our applications we use Open CASCADE as the geometric engine  [51]. Note that we only need to compute the derivatives of the objective function (16) to restrict the movement of a node on a curve, since the derivatives of the curve parameterization are provided by the CAD engine. For this reason, given a generic objective function, it is straightforward to obtain a new one for a node that belongs to a curve.

Given a node on a surface, 
                           v
                        , we define the corresponding objective function by composing (16) with the surface parameterization, 
                           
                              φ
                           
                           
                              (
                              
                                 u
                              
                              )
                           
                        . That is: 
                           
                              (20)
                              
                                 
                                    
                                       f
                                    
                                    
                                       
                                          φ
                                       
                                    
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       f
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    
                                       φ
                                    
                                    
                                       (
                                       
                                          u
                                       
                                       )
                                    
                                    )
                                 
                                 .
                              
                           
                         The derivatives of the objective function (20) with respect to coordinates 
                           
                              u
                           
                         are deduced by means of the chain rule. That is, 
                           
                              (21)
                              
                                 ∇
                                 
                                    
                                       f
                                    
                                    
                                       
                                          φ
                                       
                                    
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 =
                                 
                                    D
                                 
                                 
                                    φ
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 ⋅
                                 ∇
                                 
                                    
                                       f
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    
                                       φ
                                    
                                    
                                       (
                                       
                                          u
                                       
                                       )
                                    
                                    )
                                 
                                 ,
                              
                           
                         and 
                           
                              (22)
                              
                                 H
                                 
                                    
                                       f
                                    
                                    
                                       
                                          φ
                                       
                                    
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 =
                                 H
                                 
                                    φ
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 :
                                 ∇
                                 
                                    
                                       f
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    
                                       φ
                                    
                                    
                                       (
                                       
                                          u
                                       
                                       )
                                    
                                    )
                                 
                                 +
                                 
                                    
                                       
                                          (
                                          
                                             D
                                          
                                          
                                             φ
                                          
                                          
                                             (
                                             
                                                u
                                             
                                             )
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ⋅
                                 ∇
                                 
                                    
                                       f
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    
                                       φ
                                    
                                    
                                       (
                                       
                                          u
                                       
                                       )
                                    
                                    )
                                 
                                 ⋅
                                 
                                    D
                                 
                                 
                                    φ
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           H
                           
                              φ
                           
                           
                              (
                              
                                 u
                              
                              )
                           
                         is a third order tensor whose components are defined as 
                           
                              
                                 
                                    
                                       
                                          [
                                          H
                                          
                                             φ
                                          
                                          
                                             (
                                             
                                                u
                                             
                                             )
                                          
                                          ]
                                       
                                    
                                    
                                       i
                                       j
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                φ
                                             
                                          
                                          
                                             k
                                          
                                       
                                       
                                          (
                                          
                                             u
                                          
                                          )
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             u
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             u
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          [
                                          H
                                          
                                             φ
                                          
                                          
                                             (
                                             
                                                u
                                             
                                             )
                                          
                                          :
                                          ∇
                                          
                                             
                                                f
                                             
                                             
                                                v
                                             
                                          
                                          
                                             (
                                             
                                                φ
                                             
                                             
                                                (
                                                
                                                   u
                                                
                                                )
                                             
                                             )
                                          
                                          ]
                                       
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             f
                                          
                                          
                                       
                                       
                                          (
                                          
                                             φ
                                          
                                          
                                             (
                                             
                                                u
                                             
                                             )
                                          
                                          )
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                φ
                                             
                                          
                                          
                                             k
                                          
                                       
                                       
                                          (
                                          
                                             u
                                          
                                          )
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             u
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             u
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 .
                              
                           
                         Similar to the curve nodes case, we only need to compute the derivatives of the original objective function, because the derivatives of the surface parameterization are provided by the CAD engine.

In this section, we detail the optimization approach to obtain the new position of the nodes that untangles the mesh and improves the element quality. It is important to highlight that only a single distortion measure, the mesh volume distortion, is used in the whole process. The method is devised as an iterative process that minimizes the objective function (15), moving one node at a time, see Algorithm 1. The nodes are divided into three sets, according to their location. First, we smooth the curve nodes, prescribing the position of all the other nodes, Lines 5–9. Second, we smooth the surface nodes by assuming that the positions of the remaining nodes are fixed, Lines 10–14. Third, we smooth the interior nodes fixing the position of all the other nodes, Lines 15–19. For each node, 
                           v
                        , the appropriate objective function is used, depending on its location. The process is iterated until the maximum displacement of the nodes is below a threshold prescribed by the user, Line 20. Accordingly, the number of times the optimization process cycles through curves, surfaces, and volumes, depends on the prescribed maximum displacement. That is, the nodes on each curve, surface and volume are relocated several times until global convergence is achieved.

Note that in Algorithm 1 we update the location of one node at a time, and it is computed taking into account the new location of the previously relocated nodes. In addition, nodes are processed according to the entity they belong to: first, we move the curve nodes; second, the surface nodes; and third, the volume nodes. Thus, the proposed implementation of the minimization process can be understood as a non-linear Gauss–Seidel procedure by blocks (curves, surfaces, and volumes).


                        
                           
                              
                           
                        
                     


                        
                           
                              
                           
                        
                     

The new position of a node is computed using a line-search iterative process. Let 
                           
                              
                                 
                                    x
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 k
                              
                           
                         be the position of node 
                           v
                         that belongs to domain 
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 i
                              
                           
                         at iteration 
                           k
                        . Note that 
                           
                              
                                 
                                    x
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 k
                              
                           
                         may refer to the position of a node in the physical space, 
                           
                              
                                 
                                    x
                                 
                              
                              
                                 v
                              
                           
                        , the parametric coordinates of a node in a surface 
                           
                              
                                 
                                    u
                                 
                              
                              
                                 v
                              
                           
                        , or the parametric coordinates of a node in a curve, 
                           
                              
                                 t
                              
                              
                                 v
                              
                           
                        . The new position at iteration 
                           k
                           +
                           1
                         is defined as 
                           
                              (23)
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                             
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                             
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 
                                    
                                       α
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         is an advancing direction and 
                           
                              
                                 α
                              
                              
                                 k
                              
                           
                         is a step length. To compute both the advancing direction and the step length, there are several methods, like the steepest descent or the Newton–Raphson methods, see  [55]. Algorithm 2 details our particular implementation of the backtracking line-search method. The inputs of the method are the coordinates of a node 
                           v
                         in a domain 
                           
                              
                                 
                                    
                                       Ω
                                    
                                    
                                 
                              
                              
                                 i
                              
                           
                         at iteration 
                           k
                        , 
                           
                              
                                 
                                    x
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 k
                              
                           
                        , and the corresponding objective function to minimize for the node, 
                           
                              
                                 f
                              
                              
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                              
                           
                        . Note that 
                           
                              
                                 f
                              
                              
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                              
                           
                         has to match the type of the current node. Therefore, we use 
                           
                              
                                 f
                              
                              
                                 
                                    γ
                                 
                              
                           
                         for curve nodes, 
                           
                              
                                 f
                              
                              
                                 
                                    φ
                                 
                              
                           
                         for surface nodes, and 
                           
                              
                                 f
                              
                              
                                 v
                              
                           
                         for the inner nodes. The line-search method is performed in two steps. First, we compute an advancing direction using the Newton–Raphson method, Lines 2 and 3. Note that to apply this algorithm, the first and second derivatives of the objective function may be needed, and they are detailed in Appendix A. Second, to compute the step length, we use the Wolfe conditions to ensure that a sufficient decrease in the objective function is achieved, Lines 4–8. The parameter values of the backtracking method, Line 4, are defined as detailed in Ref.  [55].

In this section, we present several examples that illustrate the advantages of the proposed method to untangle and smooth high-order tetrahedral meshes. For each example we show the CAD model, the initial mesh, the inverted elements of the initial mesh and the smoothed mesh. In addition, for each example we also present a detailed view of the initial linear mesh and the final curved high-order mesh. Finally, we present a table that summarizes the shape quality, see Eq. (12), statistics of the mesh elements. Specifically, we provide the number of tangled elements, and the minimum, the maximum, the mean and the standard deviation of the element quality. We highlight that in all cases the smoothed mesh increases the minimum and mean values of the mesh quality and decreases its standard deviation. Note that the proposed objective function corresponds to an 
                        
                           
                              L
                           
                           
                              2
                           
                        
                      norm and therefore, it improves the average element distortion. The objective function penalizes, by construction, the highly distorted elements. This is in agreement with the obtained quality statistics, since the average and minimum quality increase. In addition, note that the maximum quality may decrease to accommodate the improvement of the whole mesh.

This example presents a tetrahedral mesh of polynomial degree six for a ratchet gear, shown in Fig. 4
                        (a). Note that this geometry contains high-curvature surfaces that compromise the generation of a valid high-order mesh. Specifically, there are several fillets and, in addition, the inner holes and the central hole contain curved surfaces. The initial curved high-order mesh is shown in Fig. 4(b). This mesh is not valid since it contains a large number of inverted elements around the curved surfaces, see Fig. 4(c). When we apply the proposed hierarchical smoother, we obtain a high-quality mesh without inverted elements, see Fig. 4(d). To highlight the benefits of the high-order discretization, Fig. 5
                        (a) shows a detail of the initial linear mesh and Fig. 5(b) shows the corresponding high-order curved mesh. Note that the latter better approximates the curved curves and surfaces of the geometry, because of the higher polynomial degree used to interpolate the geometry.


                        Table 1
                         shows the element quality statistics of the initial and smoothed high-order meshes. The high-order mesh contains 10 324 elements, and 825 of them are inverted. Thus, the minimum element quality of the mesh is 0. When we apply the hierarchical smoother, the final mesh does not contain any inverted element. The minimum quality is 0.40, and both the maximum and mean quality are increased while the standard deviation is decreased. Thus, the smoothed high-order mesh contains better quality elements than the original mesh.

In this example, we generate a high-order mesh of polynomial degree five for a break disk, shown in Fig. 6
                        (a). This geometry is very thin and, for this reason, the smoothing process of a high-order mesh may fail because the feasible region of the nodes is small. Note that this mesh contains between one and two layers of elements almost everywhere, but around the high-curvature surfaces that define the holes. If a classical approach is applied, where first each surface is smoothed separately, since the opposing surfaces are very close, it may not be possible to generate a valid mesh. The proposed hierarchical approach deals with this kind of situations by taking into account only the quality of the volume mesh, even for the nodes that are on the boundary. The initial curved high-order mesh contains inverted elements and, for this reason, it is not valid for simulation purposes, see Fig. 6(b). The inverted elements are located around the surfaces of the domain, see Fig. 6(c). After applying the proposed hierarchical smoothing, we obtain a high-order mesh without any inverted element, see Fig. 6(d). In this example we have also applied the standard smoothing approach in which first the boundary nodes are moved by taking into account the quality of the boundary triangles and then the inner nodes are moved taking into account the quality of the tetrahedral elements. Note that in this case, a valid high-order mesh has not been obtained because the boundary elements constrain the quality of the whole mesh. Fig. 7
                        (a) and (b) show the inverted elements and the element quality after applying the standard smoothing approach, respectively. In addition, Fig. 8
                        (a) and (b) show a detailed view of the initial linear mesh and the final high-order curved mesh for the disk.


                        Table 1 presents the statistical information of the element quality for the meshes of this example. The original mesh is composed of 40 330 elements and contains 1313 inverted elements thus, the minimum quality is 0. After applying the hierarchical smoother, the high-order mesh does not contain any inverted elements. The minimum quality of the smoothed mesh has been increased to 0.50. In addition, the maximum quality has almost retained the same value and the mean quality has been increased from 0.89 to 0.95. Note that the mesh obtained after applying the standard smoothing approach contains 10 508 inverted elements. Thus, the minimum quality is 0 and an invalid mesh is obtained.

The last example shows the mesh generated of polynomial degree three for both the exterior domain and the interior domain of a five-bladed propeller, see Fig. 9
                        (a). The initial curved high-order mesh, see Fig. 9(b) contains inverted elements in both volumes, see Fig. 9(c). In this example, instead of applying the hierarchical smoother to each volume separately, we apply it to the global mesh, composed of the mesh for each volume. In this way, the objective function of the nodes that belong to the interface takes into account the quality of all surrounding elements, even when they belong to different volume meshes. The smoothed mesh, shown in Fig. 9(d) does not contain any inverted element. Fig. 10
                        (a) and (b) compare the initial linear and high-order curved meshes generated for the propeller. Note that the high-order curved mesh better reproduces the geometry because of the higher polynomial degree of the shape functions.


                        Table 1 shows the statistical information for the meshes presented in this example. The initial mesh contains 338 192 elements, both in the inner and the outer part of the geometry. In addition, 266 elements are inverted and, for this reason, the minimum quality is 0. When the hierarchical smoother is applied, we obtain a high-quality mesh without inverted elements, in which the minimum quality is 0.18. In this case, the maximum quality, the mean quality and the standard deviation are about the same for the initial and the smoothed meshes. Note however, that the initial mesh cannot be used for simulation purposes because it contains inverted elements.

@&#CONCLUSIONS@&#

We have presented a novel untangling and smoothing method to curve high-order meshes. The untangling and smoothing process is accomplished by optimizing a single objective function defined in terms of a regularized distortion measure of the volume mesh. The main contribution is that we use a single target objective function in the whole process. On the contrary, the standard mesh curving approaches apply two separate curving methods with their corresponding associated residual systems. The first stage takes into account curving criteria for surface meshes, while the second one takes into account curving criteria for volume meshes. In our approach, the target of the proposed objective function is the distortion of the volume mesh. Thus, we are able to obtain meshes composed of better quality elements, specially when the boundary mesh constrains the quality of the whole mesh, like in thin regions of the geometry. However, in order to obtain a mesh without inverted elements, we need to move the interior nodes of the mesh, as well as the boundary nodes. With this objective in mind, we have deduced an objective function that takes the physical coordinates of the inner nodes and the parametric coordinates of the boundary nodes as input parameters. Finally, it is worth to notice that the proposed hierarchical approach can be directly applied to meshes of assembly models, composed of several volumes. Accordingly, the objective function for the nodes on the interface between volumes takes into account the quality of the all the surrounding elements, even when they are located in different volumes.

Although we have deduced a global objective function, for implementation purposes we have adopted a local optimization approach. That is, instead of moving all the nodes at the same time, we perform a node-by-node iteration until convergence is achieved. This allows to perform a hierarchical smoothing approach which is divided into three stages. First, we move the nodes on the curves; second, we move the nodes on the surfaces; and third, we move the inner nodes. Since we did not prove that the proposed objective function is convex, there is no convergence guarantee. In practical applications, we use backtracking line search to improve the global convergence features of the implementation. It is important to point out that with all the tested examples we have converged to a local minima that provides a valid mesh, and we did not experience non-convergent or oscillatory behavior during the optimization process.

The proposed method is in general terms more expensive than standard smoothing approaches (without untangling) implemented in a hierarchical manner. For instance, the proposed implementation of our method is more expensive than standard node-by-node Laplacian smoothing. That is, the cost of moving a node is also proportional to the number of neighbors, but there are more floating operations involved. Nevertheless, our implementation scales as the node-by-node Laplacian method up to an implementation constant. Note that our formulation may need several smoothing cycles to achieve the minimum of the objective function. On the contrary, standard hierarchical approaches only require one smoothing cycle: first, curve meshes are smoothed while the limiting vertex nodes are fixed; second, surface meshes are smoothed while the boundary curve nodes are fixed; finally, the volume mesh is smoothed while the boundary nodes are fixed. Nevertheless, we highlight that the overhead of our method pays off in those applications where a valid mesh cannot be obtained with a standard hierarchical smoothing method.

We consider that our method is a relevant alternative over the standard hierarchical approach to curve high-order meshes. Specifically, by smoothing and untangling simultaneously boundary and inner nodes we can generate curved high-order meshes in geometries where other methods fail. Specially, in geometries that feature thin regions or high-curvature values where fixing the boundary nodes may add artificial constraints that impede obtaining a valid mesh. These concerns are properly corroborated by the examples presented in this work.

We have restricted ourselves to geometries delimited by parameterized curves and surfaces, since CAD models are the preferred representation for industrial applications. Accordingly, the algorithm in its current form requires the utilization of a CAD engine that provides the evaluation of the parameterizations and their first and second derivatives. However, there are several applications where the geometry is enclosed by a non-parameterized representation such as a triangular mesh. To extend our method to deal with these non-parameterized representations of the geometry, it would be required to obtain a local parameterization that provides the required derivatives for the optimization method of choice. We point out that this extension would not be straight forward since obtaining such parameterizations is still an open problem and an active area of research.

Several aspects of the algorithm can be extended in the near future. The proposed approach is an optimization based method with untangling capabilities constrained to move the nodes on the CAD entities. Hence, it requires more floating point operations per node than other methods, e.g. Laplacian smoothing. It would be interesting to explore additional techniques to reduce the computational cost of smoothing a given mesh. For instance, we could use a parallel version of the presented algorithm to reduce the time to smooth a mesh. With this objective in mind, we need to partition properly the mesh nodes to avoid that different processors access and modify the same node position at the same time. In addition, we have chosen to implement the global function in a node-by-node manner to simplify the solver implementation, reduce the memory footprint, and exploit the local behavior of the objective function. However, we need to explore additional minimization approaches in order to investigate the robustness and the performance of different solvers. One of the most interesting approaches is to consider a global solver, in which all the nodes are moved at the same time. It is important to point out that the global implementation could lead to an ill-conditioned Hessian matrix since the scales of motion in the curves, surfaces, and volumes are different. This could require to scale the optimization variables to improve the conditioning as proposed in  [21].

@&#ACKNOWLEDGMENTS@&#

This research was partially supported by CONACYT-SENER (“Fondo Sectorial CONACYT SENER HIDROCARBUROS”, grant contract 163723) and by the Spanish Ministerio de Economía y Competitividad under grant CTM2014-55014-C3-3-R. The work of the second author was partially supported by the Boeing Co. and US Air Force Office of Scientific Research and European Commission through the Boeing–MIT Alliance and Computational Math Program and Marie Skłodowska-Curie Actions (HiPerMeGaFlows project), respectively.

In this appendix, we detail the first and second derivatives of the objective function for a given node, 
                        
                           
                              f
                           
                           
                              v
                           
                        
                     , see Eq. (16). We express the derivatives of the objective function in terms of the derivatives of the modified distortion measure, 
                        
                           
                              η
                           
                           
                              δ
                           
                        
                     . That is: 
                        
                           (A.1)
                           
                              
                                 
                                    ∂
                                    
                                       
                                          f
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    e
                                    ∈
                                    
                                       
                                          M
                                       
                                       
                                          v
                                       
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       〈
                                       
                                          
                                             ∂
                                             
                                                
                                                   η
                                                
                                                
                                                   δ
                                                
                                             
                                             
                                                (
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             ∂
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             η
                                          
                                          
                                             δ
                                          
                                       
                                       
                                          (
                                          
                                             D
                                          
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                e
                                             
                                             
                                                ∗
                                             
                                          
                                          )
                                       
                                       −
                                       1
                                       〉
                                    
                                 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          I
                                       
                                       
                                    
                                 
                              
                              ,
                           
                        
                      and 
                        
                           (A.2)
                           
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          f
                                       
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          x
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    e
                                    ∈
                                    
                                       
                                          M
                                       
                                       
                                          v
                                       
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       〈
                                       
                                          
                                             
                                                
                                                   ∂
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   η
                                                
                                                
                                                   δ
                                                
                                             
                                             
                                                (
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             ∂
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∂
                                             
                                                
                                                   x
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             η
                                          
                                          
                                             δ
                                          
                                       
                                       
                                          (
                                          
                                             D
                                          
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                e
                                             
                                             
                                                ∗
                                             
                                          
                                          )
                                       
                                       −
                                       1
                                       〉
                                    
                                 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          I
                                       
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    
                                       〈
                                       
                                          
                                             ∂
                                             
                                                
                                                   η
                                                
                                                
                                                   δ
                                                
                                             
                                             
                                                (
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             ∂
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             ∂
                                             
                                                
                                                   η
                                                
                                                
                                                   δ
                                                
                                             
                                             
                                                (
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             ∂
                                             
                                                
                                                   x
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                       〉
                                    
                                 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          I
                                       
                                       
                                    
                                 
                              
                              .
                           
                        
                      We only need to deduce the first and second derivatives of the modified distortion measure, 
                        
                           
                              η
                           
                           
                              δ
                           
                        
                     , see Eq. (2). Applying the chain rule, it can be shown that the first derivative is 
                        
                           (A.3)
                           
                              
                                 
                                    ∂
                                    
                                       
                                          η
                                       
                                       
                                          δ
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              =
                              2
                              
                                 
                                    η
                                 
                                 
                                    δ
                                 
                              
                              
                                 [
                                 
                                    
                                       
                                          (
                                          
                                             
                                                ∂
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                             
                                             
                                                ∂
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             D
                                          
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                e
                                             
                                             
                                                ∗
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          (
                                          
                                             D
                                          
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                e
                                             
                                             
                                                ∗
                                             
                                          
                                          ,
                                          
                                             D
                                          
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                e
                                             
                                             
                                                ∗
                                             
                                          
                                          )
                                       
                                    
                                 
                                 −
                                 
                                    
                                       
                                          
                                             ∂
                                             σ
                                          
                                          
                                             ∂
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                    
                                       n
                                       
                                          (
                                          2
                                          
                                             
                                                σ
                                             
                                             
                                                δ
                                             
                                          
                                          −
                                          σ
                                          )
                                       
                                    
                                 
                                 ]
                              
                              ,
                           
                        
                      and the second derivative is 
                        
                           (A.4)
                           
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          η
                                       
                                       
                                          δ
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          x
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          η
                                       
                                       
                                          δ
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    
                                       
                                          η
                                       
                                       
                                          δ
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    
                                       
                                          η
                                       
                                       
                                          δ
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          x
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              +
                              2
                              
                                 
                                    η
                                 
                                 
                                    δ
                                 
                              
                              
                                 [
                                 
                                    
                                       
                                          (
                                          
                                             
                                                ∂
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                             
                                             
                                                ∂
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                ∂
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                             
                                             
                                                ∂
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          (
                                          
                                             D
                                          
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                e
                                             
                                             
                                                ∗
                                             
                                          
                                          ,
                                          
                                             D
                                          
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                e
                                             
                                             
                                                ∗
                                             
                                          
                                          )
                                       
                                    
                                 
                                 −
                                 
                                    
                                       
                                          (
                                          
                                             
                                                ∂
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                             
                                             
                                                ∂
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             D
                                          
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                e
                                             
                                             
                                                ∗
                                             
                                          
                                          )
                                       
                                       
                                          (
                                          
                                             
                                                ∂
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                             
                                             
                                                ∂
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             D
                                          
                                          
                                             
                                                
                                                   ϕ
                                                
                                             
                                             
                                                e
                                             
                                             
                                                ∗
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                                ,
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       ∂
                                       σ
                                    
                                    
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∂
                                       σ
                                    
                                    
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 
                                    
                                       σ
                                    
                                    
                                       n
                                       
                                          
                                             
                                                (
                                                2
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      δ
                                                   
                                                
                                                −
                                                σ
                                                )
                                             
                                          
                                          
                                             3
                                          
                                       
                                    
                                 
                                 ]
                              
                              .
                           
                        
                     
                  

@&#REFERENCES@&#

