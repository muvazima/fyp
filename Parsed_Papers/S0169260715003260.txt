@&#MAIN-TITLE@&#A markerless system based on smartphones and webcam for the measure of step length, width and duration on treadmill

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A markerless low cost system for the estimation of some spatial-temporal parameters of human gait.


                        
                        
                           
                           A system usable on not-instrumented treadmill.


                        
                        
                           
                           A system characterized by a very high level of automation.


                        
                        
                           
                           A system can be used to analyze up to one hundred steps.


                        
                        
                           
                           A system with precision comparable with the gold standard.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Triaxial accelerometer

Markerless system

Stride length

Stride width

Homographic transformation

@&#ABSTRACT@&#


               
               
                  Background and objective
                  A markerless low cost prototype has been developed for the determination of some spatio-temporal parameters of human gait: step-length, step-width and cadence have been considered. Only a smartphone and a high-definition webcam have been used.
               
               
                  Methods
                  The signals obtained by the accelerometer embedded in the smartphone are used to recognize the heel strike events, while the feet positions are calculated through image processing of the webcam stream. Step length and width are computed during gait trials on a treadmill at various speeds (3, 4 and 5km/h).
               
               
                  Results
                  Six subjects have been tested for a total of 504 steps. Results were compared with those obtained by a stereo-photogrammetric system (Elite, BTS Engineering). The maximum average errors were 3.7cm (5.36%) for the right step length and 1.63cm (15.16%) for the right step width at 5km/h. The maximum average error for step duration was 0.02s (1.69%) at 5km/h for the right steps.
               
               
                  Conclusion
                  The system is characterized by a very high level of automation that allows its use by non-expert users in non-structured environments. A low cost system able to automatically provide a reliable and repeatable evaluation of some gait events and parameters during treadmill walking, is relevant also from a clinical point of view because it allows the analysis of hundreds of steps and consequently an analysis of their variability.
               
            

@&#INTRODUCTION@&#

The use of treadmill to measure spatio-temporal gait parameters allows the collection of a large number of walking steps that may result very useful in rehabilitation context for evaluation purposes. Several papers showed results obtained by different systems (opto-electronic system, instrumented walkway) related to spatial and temporal gait parameters on treadmill for healthy [1–5], and pathological subjects [6–8].

In papers [9–11] stereo-photogrammetric systems are adopted to calculate spatial parameters on treadmill gait, using different foot landmarks. Generally, the results reported in literature show the variability of such parameters with respect to age, walking speed, pathological or experimental (over ground versus treadmill) conditions. In Owing's papers [1,2] the focus was on the variability of step width and length with respect to age of subjects and walking speed. The results obtained in both these studies, at normal speed, showed that step width variability of older adults was significantly larger than that of young adults. They found that step length and related variability were not age-dependent. In Stolze and co-workers [4] study, the influence of treadmill on gait parameters with respect to the overground walking condition was examined between children and adults at their preferred speed. They found that step length significantly reduced in treadmill condition while step width significantly increased both for adults and children group. Temporal-spatial gait parameters were estimated in 39 healthy adults while walking over an instrumented walkway (GAITRite) and an instrumented treadmill system at matched speed in Wearing et al. paper [3]. For treadmill condition, parameters were not comparable with those obtained by the instrumented walkway because of different spatial resolution of both systems: step length was significantly lower in treadmill trials for both legs. Zeni and Higginson [5] examined familiarization time required to reach a steady-state gait on treadmill. They found a significant difference among trials with respect to step width with a decreasing trend over the first five trials. In the last years, the use of smart technologies such as accelerometers and webcams to evaluate gait and related parameters is growing, helped also by the rapid development of these technologies and their use embedded in devices commonly used such as smartphones. 3-D accelerometers and webcams are assuming an increasing interest for the ambulatory assessment of human motion, particularly for the extraction of spatio-temporal parameters of gait, but also for a simplified analysis of motor tasks deemed clinically significant for the functional evaluation of motor disabilities [12–16]. Literature reports many attempts to use accelerometers for gait analysis, often embedded in more complex measurement systems [12–14,17,18]. They provides estimates of stride or step duration and walking cadence even if their estimation is often affected by a rather high incertitude [12]. The problem can be solved using expensive commercial systems based on inertial measurement units. Other video systems based on webcams are characterized by a limited accuracy in the estimation of temporal gait parameters due to their low frame rate but can give satisfactory accuracy in the determination of spatial gait parameters. The use of passive markers placed on anatomical landmarks, has the advantage of simplifying the image data elaboration but requires specialized operator for their determination [19].

The approach followed in this paper relies on the integration of accelerometer and image data in a unique system, very cheap, completely automatic and suitable to be used in non-structured environments like ambulatory settings by non-expert users. In this study, the use of markers is avoided: in order to recognize feet position while the subject is walking on a treadmill, he/she has to wear just white socks. This system represents the evolution of previous works [20,21] that, on the contrary, were marker-based.

The system uses the accelerometer embedded in a smartphone and a high definition (HD) webcam. The accelerometer data are used mainly for timing measurement and for properly selecting the specific webcam frames that have to be processed, thus minimizing the overall computation time [20]. The HD-webcam allows the estimation of feet positions on a plane: in the present paper the plane is the rolling plane of a treadmill. The prototype described in this paper uses only one smartphone, placed on the fixed lateral part of the treadmill structure, and a webcam placed laterally. The system can record and automatically analyze hundreds of steps. Results obtained with this system were compared with those obtained by a 3D optoelectronic stereo-photogrammetric system. This latter is the gold-standard for gait analysis but is very expensive and requires structured environments and expert users. Nonetheless the errors in the spatio-temporal parameters measured by this prototype system with respect to those obtained by the gold-standard system, resulted quite small.

Aim of this study is to develop a reliable system that can be used in ambulatory, non-structured environments, for the analysis of human gait on treadmill. It is based on the use of a webcam and of a 3D accelerometer embedded in a smartphone placed on the treadmill. Tough in the present application its use is limited only to the estimation of step length, width and step duration, possible future development can take into account the estimation of further significant gait parameters and events exploiting a method based on photogrammetric recordings [22].

@&#METHODS@&#

Six healthy subjects have been tested (3 male and 3 female, 21±2 year old, 170±2cm height, 68±3kg weight). All subjects signed informed consent. All subjects had similar anthropometric dimensions and wore white socks and their usual clothing (Fig. 1
                        ). They were tested walking on the treadmill at three different speeds: 3, 4, and 5km/h, respectively. Before each test, and for every walking speed, all subjects walked at least for 3min on the treadmill to familiarize with the instrumentation and with the experimental condition. No slipping was noticed during walking for the use of the socks. The choice of these treadmill speeds was done in order to have a range for gait speeds that could be considered slow, normal and fast, respectively, thus allowing to analyze the influence of walking speed on the accuracy of the prototype system in the estimate of some gait parameters.

A total of 504 steps were analyzed. Step length, width and duration obtained by the system have been compared with those obtained by a stereo-photogrammetric system (6 infrared cameras, Elite BTS Engineering, 100Hz). Before each experimental session the stereophotogrammetric system was calibrated with an average resulting accuracy of 1.04mm (±0.91mm). For this marker-based system, two markers were positioned on each foot, one attached on the heel and the other on the metatarsal head (first or fifth depending from the right or left foot).

The system is constituted by a laptop that can control up to three Android smartphones, one HD-webcam (Logitech HD Pro C920) and an optional Wi-Fi access point. For last generation smartphones this latter is not strictly necessary, as any smartphone can act as a router and as a sensor as well. The system architecture is shown in Fig. 2
                        .

A suitable app collects all the inertial data from the internal sensors (3-axis accelerometer K330 ST, gyroscope K330, and YAS532 magnetic sensor) and sends them, in Wi-Fi modality, to the laptop. The data transmission protocol is UDP. The acquisition frequency is in the average 50.3 (±5)Hz: it is not constant because the sampling frequency depends on the real-time characteristics of the Android operating system. In order to know exactly the time instant of the sensor data acquisition, the app associates to each data-packet the absolute system time before sending it to the laptop. In the worst case, when the sampling frequency was 45Hz, given that, the main use of the accelerometer was to identify the frame associated to the heel strike event, the committed error was in any case lower due to the lower sampling frequency of webcam (30Hz).

The data acquired from the smartphones are shown graphically on the laptop in real time. In this work, we used only one smartphone positioned on the fixed lateral part of the treadmill structure. The treadmill used was a motorized, non-instrumented treadmill (High Power, Miami 2012, dimension: 160cm×70cm×130cm).

The capture rate of the webcam is 30fps and maximum resolution of 1920×1080 pixels. The webcam was positioned on the left side of the treadmill in order to have a measurement field 2m wide. In particular, it was positioned at a height of 53cm from the rolling surface of the treadmill, and at a distance of 46cm from the nearest lateral side of the treadmill. After each acquisition, the system automatically splits the video into frames and synchronizes the inertial sensor data with the webcam frames.

The purpose of the acceleration measurement is to know when heel strikes occur: these events give rise to well defined peaks of the accelerometer signal. The processing of the accelerometer trace is much faster than video frames processing: the knowledge of the time instant in which the heel impacts the treadmill surface allows to speed up the successive video analysis because it is necessary to analyze only one video frame per step. Thus, assuming a mean step duration of 0.5s, and a capture rate of 30fps, the identification of the frame corresponding to the heel strike allows to speed-up 15 times the processing time required if all the video frames were analyzed.

In order to identify the peaks on the accelerometer signal, the norm of a linear combination of the acceleration components is computed and analyzed by a double threshold algorithm. Fig. 1A shows in blue signal obtained by the linear combination of the three acceleration components: the vertical component is multiplied by a factor of 3 while the anterior-posterior and medial-lateral components by a factor of 1. The elaboration of the blue signal by a double threshold algorithm produces the green signal (Fig. 1A) where the peaks identify the heel strike events.

The purpose of the photogrammetric data elaboration is the measurement of step length and width. To measure these parameters on a moving reference frame like the surface of a treadmill, assuming unknown its rotation speed, it is necessary to identify a single and suitable frame (i.e. the heel strike frame, HSF). In the HSF both feet have to touch on the treadmill plane: the forward foot with the heel, and the backward foot with the forefoot.

In the identified HSF, an image processing algorithm, described in Section 2.3.3, identifies the contour of the white socks of both feet. On each sock contour, some specific foot landmarks have to be automatically recognized: for the forward foot, the heel (H); for the rear foot, the first metatarsal head (M1) in the case of the left foot (Fig. 3
                           ), or the fifth metatarsal head (M5) in the case of the right foot (Fig. 4
                           ).

This is due to the fact that the webcam is positioned on the left side of the treadmill. The obtained landmarks are defined in the webcam image frame reference system (FRS, Fig. 5
                           ). A homographic transformation, described in Section 2.3.4, is adopted to obtain the coordinates of H (X
                           
                              h
                           ,Y
                           
                              h
                           ), M1 (X
                           
                              m1,Y
                           
                              m1) and M5 (X
                           
                              m5,Y
                           
                              m5) in the treadmill reference system (TRF, Fig. 6
                           ). Then the right and left step width and length can be calculated in the TRF as follows.

The right and left step width are computed according to (1):
                              
                                 (1)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      r
                                                      
                                                         sw
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            Y
                                                            h
                                                         
                                                         −
                                                         
                                                            Y
                                                            
                                                               m
                                                               5
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      l
                                                      
                                                         sw
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            Y
                                                            h
                                                         
                                                         −
                                                         
                                                            Y
                                                            
                                                               m
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where:
                              
                                 •
                                 
                                    r
                                    sw and l
                                    sw are the right and left step width respectively.

(X
                                    
                                       h
                                    , Y
                                    
                                       h
                                    ), (X
                                    
                                       m1, Y
                                    
                                       m1), (X
                                    
                                       m5, Y
                                    
                                       m5) are the TRF coordinates of heel (H), first metatarsal head (M1), and fifth metatarsal head (M5), respectively.

The step length is usually defined as the distance by which one foot moves forward in front of the other one [23]. Usually it can be computed as the distance between the right and left heels in correspondence of successive heel strike events. In the case of treadmill walking, this procedure cannot be applied because two successive heel strikes occur in two different time instants and consequently in two different webcam image frames. Meanwhile, the TRF is translated by an unknown quantity with respect to an external fixed observer: this displacement is assumed unknown because the speed of the treadmill plane is not known accurately. It is therefore necessary to define a method that uses just one frame. At the HSF only one heel lies on the treadmill plane while the other one is raised up (Figs. 3 and 4). As explained in Section 2.3.4, the homographic transformation allows to estimate only the TRF coordinates of points that belong to the treadmill plane. Consequently, step lengths are calculated adding a constant (hl
                           left or hl
                           right for the right or left step, respectively) to the distance between heel (H) and the metatarsal head (M1 or M5 depending if the rear foot is right or left). These two constants, hl
                           left (Fig. 4) or hl
                           right (Fig. 3), represent the distance between the metatarsal head and the heel and must be preventively measured off-line for the left and right feet, respectively.

Consequently, the step length is computed according to (2):
                              
                                 (2)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      r
                                                      
                                                         sl
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            X
                                                            h
                                                         
                                                         −
                                                         
                                                            X
                                                            
                                                               m
                                                               5
                                                            
                                                         
                                                      
                                                   
                                                   +
                                                   h
                                                   
                                                      l
                                                      
                                                         left
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      l
                                                      
                                                         sl
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            X
                                                            h
                                                         
                                                         −
                                                         
                                                            X
                                                            
                                                               m
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   +
                                                   h
                                                   
                                                      l
                                                      
                                                         right
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where:
                              
                                 •
                                 
                                    r
                                    sl and l
                                    sl are the right and left step length respectively.


                                    hl
                                    left and hl
                                    right are the distance between the M5 metatarsal head and the heel of the left backward foot, and the distance between the M1 metatarsal head and the heel of the right backward foot, respectively.

The use of the constant hl (right or left, respectively) is justified by the fact that the backward foot, at the heel strike instant of the forward foot, rests on its forefoot, and by the fact that the distance between the metatarsal head and the heel of the same foot is invariant if the heel is raised from, or lies on the treadmill plane.

For each HSF the algorithm searches all pixels that belong to a previously defined set of colours. The colours of this set are identified through an appropriate colour sampling done by the user on the user interface: the user chooses on a frame three different points of the white socks characterized by different white colour tones. The system stores these colour samples and, taking into account a colour tolerance threshold adjustable by the user, determines the RGB range within which the colour of the socks must belong in all the frames (Fig. 1B).

The HSF is then processed comparing the colour of each pixel with the colour set. If the colour of the pixel belongs to the set, this pixel is coloured in black, if not in white. The HSF is thus transformed in a 2D black and white map. The 2D map is associated to a 3D-surface where the third coordinate is the spatial density of the black pixels. The density is calculated for each point of the map, by the number of the black pixels contained inside a circular area centred in the point. The maximum value of the density depends by the radius of the circular range. In fact when all the points inside the circle are black the density reaches its maximum value. The radius of the circular area used was set to 5 pixels. The 3D-surface thus generated appears characterized by steep hills with flat top. An example of this 3D-surface is shown in the bottom of Fig. 5 B.

Because the use of the prototype system has been thought for not structured environments, there could be, in the background, various objects having colours belonging to the chosen reference set of colours. Consequently, in the 3D-map, there should appear many hills and not just two, corresponding to the two white socks. Only the two hills with the larger surface of the flat top will be automatically selected by the system software.

The base contour of each selected hill is then segmented in two lines (red and blue lines in Fig. 5A). The red lines correspond to the socks’ lower part and are processed as follows:
                              
                                 1.
                                 The centroid of the whole sock contour is calculated for both feet (yellow point inside the contour in Fig. 5A).

The forward foot, on the left-most part of the frame, is identified as the one characterized by the minimum value of the centroid horizontal image coordinate in the FRS (Fig. 5A, label FL). This assumption is due to the fact that, in the image frame, the subject is seen walking from right to left.

The right foot is identified as the one characterized by the minimum of the centroid vertical coordinate in the FRS (Fig. 5A).

The red curve on the contour of the forward foot is analyzed from left to right looking for the point where the curve has its last increasing trend. This point is identified as the heel of the forward foot (H label in Fig. 5A).

The red curve on the contour of the backward foot (Fig. 5A), is analyzed from left to right looking for the point where the curve has its first increasing trend. This point is identified as metatarsus: M1 for the right foot, or M5 for the left foot, respectively (Figs. 3 and 4).

All the points previously identified and labelled automatically as H, M1 and M5 belong to the treadmill plane. This condition is required to transform the image frame coordinate of a point into the corresponding TRF coordinates by means of the homographic transformation.

The correspondence between the pixel coordinates 
                              p
                           
                           
                              i
                           
                           =(x
                           
                              i
                           ,y
                           
                              i
                           ) and the TRF plane coordinates of a point 
                              P
                           
                           
                              i
                           
                           =(X
                           
                              i
                           ,Y
                           
                              i
                           ) as seen by the webcam, is a projective homographic transformation that, in homogeneous coordinates, can be modelled as:
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      x
                                                      i
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               11
                                                            
                                                         
                                                         
                                                            X
                                                            i
                                                         
                                                         +
                                                         
                                                            p
                                                            
                                                               12
                                                            
                                                         
                                                         
                                                            Y
                                                            i
                                                         
                                                         +
                                                         
                                                            p
                                                            
                                                               13
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            p
                                                            
                                                               31
                                                            
                                                         
                                                         
                                                            X
                                                            i
                                                         
                                                         +
                                                         
                                                            p
                                                            
                                                               32
                                                            
                                                         
                                                         
                                                            Y
                                                            i
                                                         
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      y
                                                      i
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               21
                                                            
                                                         
                                                         
                                                            X
                                                            i
                                                         
                                                         +
                                                         
                                                            p
                                                            
                                                               22
                                                            
                                                         
                                                         
                                                            Y
                                                            i
                                                         
                                                         +
                                                         
                                                            p
                                                            
                                                               23
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            p
                                                            
                                                               31
                                                            
                                                         
                                                         
                                                            X
                                                            i
                                                         
                                                         +
                                                         
                                                            p
                                                            
                                                               32
                                                            
                                                         
                                                         
                                                            Y
                                                            i
                                                         
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Dividing the first and second equations by the third one, it follows:
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         λ
                                                         
                                                            x
                                                            i
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         λ
                                                         
                                                            y
                                                            i
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      λ
                                                   
                                                
                                             
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               11
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               12
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               13
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               21
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               22
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               23
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               31
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               32
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            X
                                                            i
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            Y
                                                            i
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Multiplying the two members of the above equations by the same denominator and writing the two resulting equations in matrix form, one obtains:
                              
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             i
                                          
                                       
                                       
                                          v
                                       
                                       =
                                       
                                          
                                             b
                                          
                                          i
                                       
                                    
                                 
                              
                           where:
                              
                                 
                                    
                                       
                                          
                                             A
                                          
                                          i
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            X
                                                            i
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            Y
                                                            i
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      
                                                         −
                                                         
                                                            x
                                                            i
                                                         
                                                         
                                                            X
                                                            i
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         −
                                                         
                                                            x
                                                            i
                                                         
                                                         
                                                            Y
                                                            i
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      
                                                         
                                                            X
                                                            i
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            Y
                                                            i
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      
                                                         −
                                                         
                                                            y
                                                            i
                                                         
                                                         
                                                            X
                                                            i
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         −
                                                         
                                                            y
                                                            i
                                                         
                                                         
                                                            Y
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 
                                    
                                       
                                          
                                             b
                                          
                                          i
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                            i
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            y
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                        
                                       and
                                        
                                       
                                          v
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     11
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     12
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     13
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     31
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     32
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     21
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     22
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     23
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          T
                                       
                                    
                                 
                              
                           
                        

The eight parameters of the projective transformation can be estimated by a least squared method if one disposes of at least four markers of known TRF coordinates. The estimate of the unknown vector v is given by:
                              
                                 
                                    
                                       
                                          v
                                       
                                       =
                                       
                                          
                                             (
                                             
                                                
                                                   A
                                                
                                                T
                                             
                                             
                                                A
                                             
                                             )
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             A
                                          
                                          T
                                       
                                       
                                          B
                                       
                                    
                                 
                              
                           where:
                              
                                 
                                    
                                       
                                          A
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               A
                                                            
                                                            1
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               A
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               A
                                                            
                                                            n
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       ,
                                        
                                       
                                          B
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            1
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            n
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                        
                                       and
                                        
                                       n
                                       ≥
                                       4
                                       .
                                    
                                 
                              
                           
                        

Once estimated the eight projective parameters, the TRF coordinates of point P
                           
                              i
                            can be computed solving the following equation system:
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            X
                                                            i
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            Y
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     11
                                                                  
                                                               
                                                               −
                                                               
                                                                  p
                                                                  
                                                                     22
                                                                  
                                                               
                                                               
                                                                  x
                                                                  i
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     12
                                                                  
                                                               
                                                               −
                                                               
                                                                  p
                                                                  
                                                                     23
                                                                  
                                                               
                                                               
                                                                  x
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     31
                                                                  
                                                               
                                                               −
                                                               
                                                                  p
                                                                  
                                                                     22
                                                                  
                                                               
                                                               
                                                                  y
                                                                  i
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                                  
                                                                     32
                                                                  
                                                               
                                                               −
                                                               
                                                                  p
                                                                  
                                                                     23
                                                                  
                                                               
                                                               
                                                                  y
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                            i
                                                         
                                                         −
                                                         
                                                            p
                                                            
                                                               13
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            y
                                                            i
                                                         
                                                         −
                                                         
                                                            p
                                                            
                                                               21
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

The four markers utilized for the homographic transformation are shown in Fig. 6. Their TRF coordinates are inserted in the user interface in appropriate fields of the calibration window (in the tab homography of Fig. 1B). Clicking in the centre of the cross of the four reference markers, will allow the system to acquire their pixel coordinates (x
                           
                              i
                           ,y
                           
                              i
                           , i
                           =1, 2, …, 4, in the tab homography of Fig. 1B).

@&#RESULTS@&#

Both photographic systems were synchronized by visual inspection in order to individuate an initial time instant so that the corresponding two frames identify the same heel strike (assumed as zero-event). Starting from this zero-event, common to both systems, the time instants associated to the successive heel strikes are measured by each system in an independent manner. The first analysis performed on the acquired data was related to the missed events, i.e. to the identification of heel strike events not recognized by the markerless system. Table 1
                      shows the number of wrong detected heel strikes and the relative percentage error with respect to the total number of detected heel strikes at various treadmill speeds.


                     Table 2
                      shows mean step length, width, and duration measured at three different treadmill speeds for the left and right steps obtained by the markerless system compared with the corresponding measures obtained by the stereophotogrammetric one. Data are reported as mean±standard deviation (SD). The Lilliefors test was used to evaluate the hypothesis that each data vector had a normal distribution. Comparisons between both the different measurement methods were performed by means of a repeated measure within subjects and between trials non-parametric test (Mann–Whitney U test). Statistical significance was set at 5%. Both left and right step length and duration resulted non-statistically significant for each speed. Right and left step width resulted statistically significant for all speeds.


                     Table 3
                      shows, for the three different speeds, the mean error for the right and left step length, width and duration, computed as the difference between the values obtained by the markerless system and by the reference stereophotogrammetric system. The table shows also the percentage error computed as the percentage ratio between the mean error and the corresponding mean value obtained by the stereophotogrammetric system.

@&#DISCUSSION@&#

In this paper some spatio-temporal gait parameters during treadmill walking are obtained through a markerless system composed by a webcam and by a 3D accelerometer on-board of a smartphone. The system provides step length and width during walking on treadmill as well as step duration. The accelerometer is exclusively used to recognize the heel strike events and, consequently, step duration. The vertical component of acceleration is analyzed by the software and the heel strike events related to each foot are automatically detected. The information obtained in such a manner is then fused by an image processing algorithm that analyses each frame to automatically recognize and classify right and left foot and, for each foot, to detect the specific anatomical landmarks. Step length and width are estimated on the basis of these anatomical landmarks and then compared with those obtained by a stereo-photogrammetric system.

Treadmill training has recently emerged as an effective gait rehabilitation practice. Then a low cost system able to automatically provide a reliable and repeatable evaluation of some gait events and parameters during treadmill walking, appears relevant also from a clinical point of view because it allows the analysis of hundreds of steps and consequently an analysis of their variability.

Results of this study showed that a satisfactory accuracy in some spatio-temporal gait parameters estimation can be reached, if compared with those obtainable through a sophisticated and expensive system like the optoelectronic one.


                     Table 1 shows that the higher percentage error in heel strike determination, was obtained for lower speeds. This is due to the fact that for increasing treadmill speeds, acceleration signals are higher and consequently more easily detected.

Values of stride length and width shown in Table 2 have not been normalized with respect to the height of the subjects because the six subject population had very similar anthropometric characteristics. In particular Table 2 shows that the average step length for both legs calculated by the markerless system resulted non-statistically significant at a 0.05 significance level compared with the gold standard results. The same was true for the left and right step duration. This means that step length and duration can be measured by the proposed system in a reliable manner as well as by the stereophotogrammetric one. This is not true for the step width that, on the contrary, gave rise to statistically significant differences when estimated by the two systems. This problem that affects the depth direction is probably due to a less efficient space calibration performed by the markerless system with respect to the stsreophotogrammetric one. For the markerless system the calibration was based on a homographic transformation whose parameters have been estimated by the minimum number (four) of control points; for the stereophotogrammetric system, the 6 cameras cover the whole measurement volume from all directions and a more accurate volume calibration has been performed.


                     Table 3 shows that the mean errors in step length are always lower for the left leg than for the right one; this is because the webcam is closer to the left leg than to the right one. Indeed, the errors in the XY-coordinates of a point in the treadmill plane depend in a direct manner on its distance from the camera. Table 3 shows also the percentage error computed as the percentage ratio between the error and the corresponding mean value obtained by the stereophotogrammetric system. The percentage errors of the step length resulted lower with respect to the step width. This is probably due to two reasons: the first one is because step length is much longer than step width; the other one is because the depth direction, that is the one where step width is computed, is less accurately defined than lateral direction where step length is determined.


                     Table 3 shows also that the percentage mean error of the step length increases as the speed increases. This is because the X-coordinate of the contact point at the heel strike on the treadmill plane, is affected by a higher error. In fact, with respect to walking on a firm surface, the treadmill moves the supporting foot with respect to the webcam so that the position of the heel contact point translates with the same speed of the treadmill mat. This involves motion blur that affects the webcam images (see for instance Fig. 3A). In fact, the limited sensibility of the webcam CMOS sensor, the low light conditions and the high frame rate for the webcam impose a higher open shutter time interval with consequent blurry images.

Results shown in this paper indicate that the system can be usefully adopted for the estimation of step length and duration during treadmill walking. It is less accurate in the determination of step width though a maximum average error of 1.63cm for the right step width at 5km/h could be tolerated for some applications. The system does not require markers on the subject's body, or specific technical competence for its use. Associated with a not-instrumented treadmill it can record hundreds of steps for both legs so that it would be possible to analyze the variability of the spatial-temporal parameters under different testing conditions. This aspect can constitute a relevant characteristic for the use of the system in a clinical context. Possible limitation of the system could be related to inaccuracy of the system in some limit conditions such as at very low or very high speeds. In the first case because the system could fail to accurately recognize the heel strike event (due to the low peak of accelerometer signal). In the second case, the blurring effect in the video frames of the feet images, due to the characteristics of the webcam, may not allow the system to be performant. Moreover, the use of shoes has not been considered in this work: though the use of uniformly coloured shoes should not change dramatically the results accuracy, the performance of the system for the analysis of subjects wearing general footwear should be taken in consideration.

@&#REFERENCES@&#

