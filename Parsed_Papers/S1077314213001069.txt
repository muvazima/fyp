@&#MAIN-TITLE@&#Flexible calibration of structured-light systems projecting point patterns

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose an automated calibration of structured-light systems projecting points.


                        
                        
                           
                           We obtained a flexible calibration since no dedicated positioning device is needed.


                        
                        
                           
                           We successfully tested the method for very different projector types.


                        
                        
                           
                           We applied the calibration to patterns with very different shapes and point number.


                        
                        
                           
                           The calibration algorithm can be used both for industrial and medical applications.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Structured-light systems

Point patterns

3D point reconstruction

Flexible projector calibration

Projector parameter optimization

Directed Hausdorff distance

3D image mosaicing

@&#ABSTRACT@&#


               
               
                  Structured-light systems (SLSs) are widely used in active stereo vision to perform 3D modelling of a surface of interest. We propose a flexible method to calibrate SLSs projecting point patterns. The method is flexible in two respects. First, the calibration is independent of the number of points and their spatial distribution inside the pattern. Second, no positioning device is required since the projector geometry is determined in the camera coordinate system based on unknown positions of the calibration board. The projector optical center is estimated together with the 3D rays originating from the projector using a numerical optimization procedure. We study the 3D point reconstruction accuracy for two SLSs involving a laser based projector and a pico-projector, respectively, and for three point patterns. We finally illustrate the potential of our active vision system for a medical endoscopy application where a 3D cartography of the inspected organ (a large field of view surface also including image textures) can be reconstructed from a video acquisition using the laser based SLS.
               
            

@&#INTRODUCTION@&#

Structured-light systems (SLSs) are used to perform three-dimensional (3D) measurement in various computer vision fields such as robotic guidance [1], medical endoscopy [2–4], virtual environment construction [5], and dimensional analysis of manufactured parts [6]. A basic SLS consists of a camera and a structured-light projector rigidly fixed with respect to the camera. A known pattern of light is projected onto the scene and the camera acquires images of the pattern modulated by the depth of objects in the field of view (FOV).

The shape of the projected pattern particularly depends on the application needs. On the one hand, a pattern of stripes enables dense 3D reconstruction [7–9]. However, stripe patterns are mainly used for 3D object modeling, e.g. for profilometry. On the other hand, projecting a set of points [10,11] can be a solution for very different computer vision tasks. When projecting a dense point set, surfaces can be very accurately constructed with high 3D resolution. On the contrary, when projecting a sparse point set, both 3D information and 2D image texture are available. Although the 3D point resolution is lower, it can be sufficient for applications where textures have to be preserved. For instance, in medical 3D-endoscopy, it is of great interest to reconstruct a 3D textured wide FOV of organs. When a 3D-endoscope acquires, from different viewpoints, small FOV images and some 3D points are placed at the periphery of the FOV, it is possible to compute textured surfaces [12]. These textured surfaces cannot be obtained with patterns of stripes or with dense point patterns [2].

Whatever the projected pattern, the SLS must first be fully calibrated before performing any 3D measurement. The SLS calibration usually consists of two successive steps, namely the camera and projector calibration. The former step is a standard problem in computer vision [13]. In this paper, we focus on the latter step. We pay special attention to the calibration of SLS projecting different kinds of point patterns. Usually, the SLS calibration is based on the mathematical modeling of the projection of a light pattern in the space, the model being expressed in the camera coordinate system. In the literature, there are mainly two approaches. The first is based on the pinhole model: a camera projects a set of 3D points in the scene into a set of 2D points located on the image plane. On the contrary, the principle of a projector is to project a set of 2D points (located on the projector focal plane) into the scene. A projector can therefore be considered as a projective reverse camera [14,15]. In the second approach, the trajectory of each pattern element is modeled in the 3D space. The projection of a set of stripes generates a set of planes, and the calibration amounts to determining the plane equations. To do so, many authors [7,9,16,17] have exploited the cross ratio geometric property to calibrate their SLSs equipped by a stripe projector. This property enables one to compute the 3D coordinates of the projected pattern onto a calibration piece.

Unlike for patterns of stripes, few works are dedicated to the calibration of SLSs equipped by a point pattern projector [18,19]. The SLSs proposed in [10,20,11] project a grid of points onto a known surface using a laser beam and optics required for generating the grid. The projection angle between each laser point trajectory and the central projection axis is fixed and known. To calibrate the system, dedicated equipment is used to place a calibration board perfectly orthogonal to the main projection axis and to displace it very precisely to known positions. From the projector calibration methods presented so far, we notice that they usually involve expensive equipments such as three orthogonal planes [17] or dedicated and precise positioning devices [10,20,11]. In addition to their expensive cost and their lack of flexibility, the performance of these methods heavily depends on the precision of the required calibration equipment.

We present an automated, flexible, point number independent and accurate SLS calibration method that does not involve any positioning device nor precise calibration pieces. Our method requires a planar calibration board only, which is a paper sheet with circular control disks attached to a planar PolyMethyl MethAcrylate (PMMA) surface. A preliminary version of this active vision system calibration method was sketched in the conference paper [21]. In this paper, we show how the calibration can be extended to other systems projecting different patterns, i.e., with a variable number of points and various spatial distributions of the points depending on the application. Our method is generic: it is able to calibrate projectors using different kinds of point patterns. The calibration method does not depend on the number, color and spatial distribution of the projected points.

The rest of this paper is organized as follows. In Section 2, we detail our calibration method for a laser based SLS projecting sparse point sets. We first describe the experimental setup and then we focus on the projector calibration method itself consisting of a pipeline of several algorithms. Finally, we briefly present the 3D point reconstruction principle using the calibrated laser SLS. Section 3 shows that the calibration method described for sparse point sets can also be used to calibrate SLSs working with a larger set of points and with various spatial distributions of the points composing the pattern. In this section, the patterns are obtained with a pico-projector. Again, the experimental set-up is described. Then, the procedure of Section 2 is slightly adapted. This adaptation is related to 3D point reconstruction but the calibration method remains unchanged. In Section 4, the calibration method is validated from the metrological point of view for both the laser (sparse point set) and the pico-projector SLSs. For the latter SLS, two point patterns are utilized. The number of points is increased and the spatial distribution also differs with respect to the original laser based SLS. Although a simple test object is used to compare the reconstruction accuracy of both SLSs, the calibration method can be used for various applications like dimensional analysis of manufactured parts or medical applications. Section 5 illustrates the potential of the calibrated laser SLS in a medical application: 3D endoscopy of bladder organs. We show that our SLS prototype makes it possible to reconstruct a 3D large FOV surface of the internal bladder wall including textures from a video acquisition. Moreover, this SLS can be implemented on an endoscope [22], and the surface representation facilitates bladder cancer detection [23].

Our sparse point SLS is composed of a CCD camera and a laser projector being all rigidly fixed on a metallic plate (see Fig. 1
                        ). The projector to camera angle is approximately equal to 30°. The camera is a Basler Scout model equipped with a wide angle lens (6mm focal length) and acquires images with 768×576pixels. The structured-light is generated by a green laser collimated source and a holographic binary phase lens (diffractive optics). The laser beam passes through the holographic lens and diffracts itself in eight new laser rays located on a cone in the 3D space. The eight points are lying on a circle, but the algorithm described in this section remains appropriate for other pattern geometries.

Because the camera and projector constitute a complete active vision system, we start by describing the camera calibration method. Then we will move onto the projection calibration which is our main contribution. Although the camera calibration is a classical task, the calibration method is worth being summarized for two reasons. This will allow us (1) to specify the complete projective system geometry and (2) to introduce the projective transformations that are involved when a 2D image of a 3D scene is acquired by the camera. All these notations and equations will be used later in the projector calibration algorithm.

The pinhole camera model involves two sets of parameters. The extrinsic parameters describe the 3D rigid transformation relating the 
                           w
                        
                        P
                        3D
                        
                        =(
                           w
                        
                        x
                        3D
                        ,
                        
                           w
                        
                        y
                        3D
                        , 
                           w
                        
                        z
                        3D
                        )
                           T
                         point in a world {w} coordinate system 
                           
                              
                                 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             w
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   →
                                                
                                             
                                          
                                          
                                             w
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   y
                                                
                                                
                                                   →
                                                
                                             
                                          
                                          
                                             w
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   →
                                                
                                             
                                          
                                          
                                             w
                                          
                                       
                                    
                                 
                              
                           
                         to the same point 
                           c
                        
                        P
                        3D
                        
                        =(
                           c
                        
                        x
                        3D
                        ,
                        
                           c
                        
                        y
                        3D
                        ,
                        
                           c
                        
                        z
                        3D
                        )
                           T
                         expressed in the camera {c} coordinate system 
                           
                              (
                              
                                 
                                    O
                                 
                                 
                                    C
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          y
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          z
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    c
                                 
                              
                              )
                           
                         taking the camera optical center as origin. This transformation involves a 3×3 rotation matrix 
                           R
                         and a 3D translation vector 
                           t
                        :
                           
                              (1)
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                 
                                 =
                                 R
                                 
                                    
                                    
                                       w
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                 
                                 +
                                 t
                              
                           
                        
                     

The intrinsic parameters are related to the 2D projection onto the camera image plane. This projection is modeled by three successive steps. First, 
                           c
                        
                        P
                        3D
                         is projected onto the image plane yielding a distortion free point 
                           c P
                        
                           u
                        
                        =(x
                        
                           u
                        ,
                        y
                        
                           u
                        )
                           T
                         according to:
                           
                              (2)
                              
                                 
                                    
                                       x
                                    
                                    
                                       u
                                    
                                 
                                 =
                                 f
                                 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             3
                                             D
                                          
                                       
                                    
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             z
                                          
                                          
                                             3
                                             D
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       y
                                    
                                    
                                       u
                                    
                                 
                                 =
                                 f
                                 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             y
                                          
                                          
                                             3
                                             D
                                          
                                       
                                    
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             z
                                          
                                          
                                             3
                                             D
                                          
                                       
                                    
                                 
                              
                           
                        where f refers to the focal length. The second step models the radial lens distortion according to a polynomial model [24, p. 191] in r, where r is the distance from 
                           c P
                        
                           u
                         to the projection of the optical center on the image plane. Following [25], we use a fourth order polynomial obtained by removing the monomials of larger degrees:
                           
                              (3)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         d
                                                      
                                                   
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         u
                                                      
                                                   
                                                   (
                                                   1
                                                   +
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         4
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         d
                                                      
                                                   
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         u
                                                      
                                                   
                                                   (
                                                   1
                                                   +
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         4
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   r
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               u
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         +
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               u
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           c
                        
                        P
                        
                           d
                        
                        =(x
                        
                           d
                        ,
                        y
                        
                           d
                        )
                           T
                         stands for the observed (distorted) point, and k
                        1 and k
                        2 are radial distortion coefficients. This model is well suited to camera optics involving strong barrel distortion [25]. The last step brings 
                           c
                        
                        P
                        
                           d
                         in the image coordinate system 
                           
                              (
                              
                                 
                                    O
                                 
                                 
                                    im
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    im
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          y
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    im
                                 
                              
                              )
                           
                         taking the upper left corner of the image as origin (see Fig. 3). This step involves the (x
                        
                           C
                        ,
                        y
                        
                           C
                        ) coordinates of the focal point projection on the image plane and the pixel side lengths along the x and y axes, called S
                        
                           x
                         and S
                        
                           y
                        , respectively:
                           
                              (4)
                              
                                 
                                    
                                       x
                                    
                                    
                                       im
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             d
                                          
                                       
                                    
                                    
                                       
                                          
                                             S
                                          
                                          
                                             x
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       x
                                    
                                    
                                       C
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       y
                                    
                                    
                                       im
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             y
                                          
                                          
                                             d
                                          
                                       
                                    
                                    
                                       
                                          
                                             S
                                          
                                          
                                             y
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       y
                                    
                                    
                                       C
                                    
                                 
                                 .
                              
                           
                        
                     

To calibrate the camera in a complete manner, we use the planar calibration board of Fig. 2a
                         including hundreds of small circular disks and we apply Zhang’s method [27]: the camera acquires several images of the calibration board, manually placed at different positions. Due to the perspective geometry, the circular disks become elliptically shaped in the images acquired by the camera. These ellipses are segmented in each image using the method described in [26] (see Fig. 2b). The ellipse centers being now available for all viewpoints, Zhang’s method allows us to recover both the extrinsic and intrinsic camera parameters (including the distortion coefficients) from the knowledge of the real positions of the disk centers on the calibration board [27]. In the following subsections, we will only exploit the intrinsic camera parameters for the projector calibration.

Because our projector calibration method also involves a planar calibration board, we demonstrate how to automatically determine the calibration plane equation from the images acquired by the camera. This task is a prerequisite to the projector calibration algorithm which will be fully presented in Section 2.4.

Our planar calibration board differs from the camera calibration board of Fig. 2 as it contains four control disks only, placed in the calibration board corners. We make this choice so that the calibration disks do not occupy the whole acquired image but only a limited part of it (for reasons which will become clear in Section 2.4). Our projector calibration method requires the acquisition of at least two images of the calibration board, manually set to different positions k
                        ∈{1,…,
                        K} with K
                        ⩾2 while the camera is fixed (unlike the methods [10,20,11], the calibration board displacement is done manually and approximately with a rough translation along the camera 
                           
                              
                                 
                                    
                                       
                                          z
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    c
                                 
                              
                           
                         axis). For each position k, we define a related “world coordinate system” 
                           
                              {
                              
                                 
                                    w
                                 
                                 
                                    k
                                 
                              
                              }
                              =
                              (
                              
                                 
                                    O
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          y
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          z
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                              )
                           
                         using three control disk centers (CDC) among the four in such a way that 
                           
                              
                                 
                                    
                                       
                                          z
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                           
                         is orthogonal to the calibration plane (see Fig. 3
                        ). We denote by 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                    ,
                                    k
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             3
                                             D
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                       ,
                                       
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             y
                                          
                                          
                                             3
                                             D
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                       ,
                                       
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             z
                                          
                                          
                                             3
                                             D
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                    
                                 
                              
                              ,
                              
                              i
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              4
                              }
                           
                         the CDC positions in the camera coordinate system. When expressed in the world coordinate system, the CDC coordinates do not depend on k because {w
                        
                           k
                        } is local to the calibration board. Therefore, we use the simplified notation 
                           
                              
                                 
                                 
                                    w
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                           
                        . For any 
                           
                              i
                              ,
                              
                              
                                 
                                 
                                    w
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                           
                         is known and we have 
                           
                              
                                 
                                 
                                    w
                                 
                              
                              
                                 
                                    z
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                              =
                              0
                           
                        . To determine the calibration board position in the (fixed) camera coordinate system {c}, we first remove the radial distortion from the observed images [24, pp. 189–191]. Then, we segment the CDC in the corrected images [26] yielding estimates of the 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    2
                                    D
                                 
                                 
                                    i
                                    ,
                                    k
                                 
                              
                           
                         positions. Finally, their corresponding world coordinate positions 
                           
                              
                                 
                                 
                                    w
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                           
                         are used together with the intrinsic camera parameters to define a system whose unknowns include the extrinsic parameters 
                           R
                        
                        
                           k
                         and 
                           t
                        
                        
                           k
                         linking the camera coordinate system to the world coordinate system representing the calibration plane. Specifically, combining Eqs. 1, 2 and 4 yields the projective model in the matrix form:
                           
                              (5)
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         2
                                                         D
                                                      
                                                      
                                                         
                                                         i
                                                         ,
                                                         k
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 K
                                 
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       C
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                                 
                                 =
                                 
                                 K
                                 
                                 
                                    
                                       
                                          
                                             
                                                R
                                             
                                             
                                                k
                                             
                                          
                                          
                                             
                                             
                                                w
                                             
                                          
                                          
                                             
                                                C
                                             
                                             
                                                3
                                                D
                                             
                                             
                                                i
                                             
                                          
                                          +
                                          
                                             
                                                t
                                             
                                             
                                                k
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where the camera matrix 
                           
                              K
                           
                         gathers the intrinsic parameters:
                           
                              (6)
                              
                                 K
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   f
                                                   /
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   0
                                                
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         C
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   f
                                                   /
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         C
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Following [28, Section 1.5], we rewrite (5) by remarking that 
                           
                              
                                 
                                 
                                    w
                                 
                              
                              
                                 
                                    z
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    
                                    i
                                 
                              
                              =
                              0
                           
                        :
                           
                              (7)
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         2
                                                         D
                                                      
                                                      
                                                         i
                                                         ,
                                                         k
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         2
                                                         D
                                                      
                                                      
                                                         i
                                                         ,
                                                         k
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 K
                                 
                                    
                                       
                                          
                                             
                                                
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         R
                                                      
                                                      
                                                         1
                                                         :
                                                         2
                                                         ,
                                                         k
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         3
                                                         D
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         3
                                                         D
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (8)
                              
                                 =
                                 
                                    
                                       α
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     1
                                                                     ,
                                                                     k
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     2
                                                                     ,
                                                                     k
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     3
                                                                     ,
                                                                     k
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     4
                                                                     ,
                                                                     k
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     5
                                                                     ,
                                                                     k
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     6
                                                                     ,
                                                                     k
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     7
                                                                     ,
                                                                     k
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     8
                                                                     ,
                                                                     k
                                                                  
                                                               
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             ︸
                                          
                                       
                                    
                                    
                                       
                                          
                                             H
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         3
                                                         D
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         3
                                                         D
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where the 3×2 matrix 
                           R
                        
                        1:2,k
                         gathers the first two columns of 
                           R
                        
                        
                           k
                         and 
                           
                              
                                 
                                    H
                                 
                                 
                                    k
                                 
                              
                           
                         is a 3×3 matrix. At this point, we notice that 
                           
                              
                                 
                                    H
                                 
                                 
                                    k
                                 
                              
                           
                         is a projective transformation relating the 2D points 
                           
                              (
                              
                                 
                                 
                                    w
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                 
                                    w
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                           
                        ) located on the calibration plane to their projection on the camera image plane. The entry h
                        9,k
                         is set to 1 up to the introduction of the scale factor α
                        
                           k
                         in (8).

In the homogeneous system (8), the 
                           
                              
                                 
                                    H
                                 
                                 
                                    k
                                 
                              
                           
                         parameters are unknown together with α
                        
                           k
                         and 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    z
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                    ,
                                    k
                                 
                              
                           
                        . Advantageously, (8) can be recast [28, Section 1.5] in the inhomogeneous system (9), where the only unknown parameters are the 
                           
                              
                                 
                                    H
                                 
                                 
                                    k
                                 
                              
                           
                         parameters (α
                        
                           k
                         and 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    z
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                    ,
                                    k
                                 
                              
                           
                         do not appear anymore). For each i
                        ∈{1,…,4}, (8) rereads as a system of two linear equations in the eight 
                           
                              
                                 
                                    H
                                 
                                 
                                    k
                                 
                              
                           
                         unknowns:
                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         1
                                                         ,
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         3
                                                         D
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         2
                                                         ,
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         3
                                                         D
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         3
                                                         ,
                                                         k
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  h
                                                               
                                                               
                                                                  7
                                                                  ,
                                                                  k
                                                               
                                                            
                                                            
                                                               
                                                               
                                                                  w
                                                               
                                                            
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  3
                                                                  D
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  h
                                                               
                                                               
                                                                  8
                                                                  ,
                                                                  k
                                                               
                                                            
                                                            
                                                               
                                                               
                                                                  w
                                                               
                                                            
                                                            
                                                               
                                                                  y
                                                               
                                                               
                                                                  3
                                                                  D
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         2
                                                         D
                                                      
                                                      
                                                         i
                                                         ,
                                                         k
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         2
                                                         D
                                                      
                                                      
                                                         i
                                                         ,
                                                         k
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         4
                                                         ,
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         3
                                                         D
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         5
                                                         ,
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         3
                                                         D
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         6
                                                         ,
                                                         k
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  h
                                                               
                                                               
                                                                  7
                                                                  ,
                                                                  k
                                                               
                                                            
                                                            
                                                               
                                                               
                                                                  w
                                                               
                                                            
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  3
                                                                  D
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  h
                                                               
                                                               
                                                                  8
                                                                  ,
                                                                  k
                                                               
                                                            
                                                            
                                                               
                                                               
                                                                  w
                                                               
                                                            
                                                            
                                                               
                                                                  y
                                                               
                                                               
                                                                  3
                                                                  D
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         2
                                                         D
                                                      
                                                      
                                                         i
                                                         ,
                                                         k
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         2
                                                         D
                                                      
                                                      
                                                         i
                                                         ,
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Moreover, (9) reads as a standard linear system of equations depending on the unknown parameters in 
                           
                              
                                 
                                    H
                                 
                                 
                                    k
                                 
                              
                           
                        . Since each 
                           
                              
                                 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             C
                                          
                                          
                                             2
                                             D
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                       ,
                                       
                                       
                                          
                                          
                                             w
                                          
                                       
                                       
                                          
                                             C
                                          
                                          
                                             3
                                             D
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                              
                           
                         correspondence provides two equations and the CDC are non-collinear, four correspondences i
                        ∈{1,…,4} are enough to solve for the eight degrees of freedom of 
                           
                              
                                 
                                    H
                                 
                                 
                                    k
                                 
                              
                           
                         
                        [28]. Knowing 
                           
                              K
                           
                         and 
                           
                              
                                 
                                    H
                                 
                                 
                                    k
                                 
                              
                           
                        , we can deduce 
                           R
                        
                        1:2,k
                        , 
                           t
                        
                        
                           k
                         and the scale factor α
                        
                           k
                         since the columns of 
                           R
                        
                        1:2,k
                         are of unit norm. The third column of 
                           R
                        
                        
                           k
                         is determined by computing the cross product of its first and second columns. Finally, 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                    ,
                                    k
                                 
                              
                           
                         are obtained by applying (1) to 
                           
                              
                                 
                                 
                                    w
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                           
                         using 
                           R
                        
                        
                           k
                         and 
                           t
                        
                        
                           k
                        .

As the four 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                    ,
                                    k
                                 
                              
                           
                         points are now perfectly known for acquisition k, we can easily deduce the calibration plane equation in the camera coordinate system {c} by solving an over-determined system of four equations in three unknowns.

The projector can be seen as a projective reverse camera without distortion because a diffractive lens does not induce any image deformation. We use the same calibration board images as in Section 2.3 (see Fig. 3) positioned with manual displacements. The acquired images not only include the four calibration disks but also some green laser points originating from the projector. In Section 2.3, these calibration planes were numerically computed in the camera coordinate system. We therefore consider that they are known.

On Fig. 3, the main laser ray is diffracted from a particular point called projector optical center O
                        
                           P
                        , yielding N laser rays D
                        
                           j
                         with j
                        ∈{1,…,
                        N}. The laser rays intersect each calibration plane yielding a set of 3D points called 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                    ,
                                    k
                                 
                              
                           
                         
                        
                           
                              
                                 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             3
                                             D
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                    
                                 
                              
                           
                         is the ith laser point projected onto the kth plane, expressed in the camera coordinate system) whose projections onto the camera image plane are denoted by 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    2
                                    D
                                 
                                 
                                    i
                                    ,
                                    k
                                 
                              
                           
                        . Physically, a laser spot is projected from the projector optical center onto the calibration board, and then onto the camera image plane while the image is recorded.

The projector calibration is as follows. Starting from the K observed images, we estimate the projector parameters, namely the O
                        
                           P
                         optical center and the D
                        
                           j
                         laser ray equations in four steps:
                           
                              1.
                              Segment the laser points (i.e., blobs of connected greenish pixels) in the images and compute their centers 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                             D
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                   
                                                      c
                                                   
                                                
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      2
                                                      D
                                                   
                                                   
                                                      i
                                                      ,
                                                      k
                                                   
                                                
                                                ,
                                                
                                                   
                                                   
                                                      c
                                                   
                                                
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      2
                                                      D
                                                   
                                                   
                                                      i
                                                      ,
                                                      k
                                                   
                                                
                                             
                                          
                                       
                                    
                                 .

Calculate the 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             3
                                             D
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                    
                                  coordinates.

For all i
                                 ∈{1,…,
                                 N} and k
                                 ∈{1,…,
                                 K}, match the obtained 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             3
                                             D
                                          
                                          
                                             i
                                             ,
                                             k
                                          
                                       
                                    
                                  points to their corresponding laser rays D
                                 
                                    j
                                 . To calculate D
                                 
                                    j
                                 , one needs to estimate the O
                                 
                                    P
                                  position. However, the point-to-ray matching can be done based on the approximate knowledge of O
                                 
                                    P
                                 .

Determine all D
                                 
                                    j
                                  laser ray equations and refine the O
                                 
                                    P
                                  position estimation in the camera coordinate system.

We now elaborate each step.

The acquired images are first preprocessed in order to remove the distortion [24, p. 191]. The distortion removal is based on the knowledge of the calibrated camera parameters (see Eqs. (3) and (4)). For our SLS prototype, the structured light is greenish and well contrasted with the background colors (gray and black). Therefore, we can automatically segment the green laser points 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       2
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            by thresholding the images in the Hue-Saturation-Value (HSV) color domain. Specifically, the images are recorded in the RGB format, and they are converted to the HSV domain. Because the green color yields a hue value equal to 120°, the basic idea is to keep the pixels whose hue value is close to 120. However, the other gray (background) or dark (calibration control disks) pixels in the image do not have a significant hue value since they are gray level pixels. Thus, a single thresholding in the hue domain may result in false detection of some gray level pixels together with the green pixels. To overcome this problem, we perform another thresholding in the saturation domain, as the saturation of a pure color (green) pixel is maximum while a gray level pixel has a close to zero saturation. These two image thresholding operations afford us to correctly segment the green pixels. We refer the reader to the Pratt’s book [29] for further details about the HSV format.

Once the green pixels have been detected, we apply an erosion procedure to compute the center of the areas where the neighboring green pixels have been detected. Fig. 4
                            shows an example of the segmentation results where the control disks are segmented as well. As mentioned earlier, the latter are only used to determine the calibration plane equation in the camera coordinate system for each viewpoint.

The resulting set of 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       2
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            laser point centers will be used in the next step to compute the 3D position of each laser point 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            in the camera coordinate system.

The intrinsic camera parameters are used to project the 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       2
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            points in the 3D space, yielding a set of R
                           
                              i,k
                            camera rays all passing through O
                           
                              C
                            (see Fig. 3). Finally, the 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            coordinates are determined by computing the intersection of each R
                           
                              i,k
                            camera ray with the corresponding plane k.

Although the 3D laser points 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            are now available, they are not yet matched to their respective laser rays. For each calibration plane k, we need to associate each 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            point (i
                           =1,…,
                           N) to some laser ray D
                           
                              j
                            originating from the projector optical center O
                           
                              P
                           . Moreover and importantly, O
                           
                              P
                            also needs to be estimated in the camera coordinate system.

This matching step is based on the following idea. Assume that O
                           
                              P
                            is perfectly known. Firstly, we remark that D
                           
                              j
                            are all passing through O
                           
                              P
                           , and the K points to be matched to a given D
                           
                              j
                            ray are the K closest points to D
                           
                              j
                           . Secondly, for a given calibration board pose k (e.g., for k
                           =1), we remark that D
                           
                              j
                            are the N rays joining O
                           
                              P
                            and 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                                 ,
                                 
                                 i
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 N
                              
                           . From this definition of the D
                           
                              j
                            rays, the O
                           
                              P
                            position is optimized in such a way that N groups of K points are all simultaneously close to the N D
                           
                              j
                            rays. In the following, we use the 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       j
                                       ,
                                       1
                                    
                                 
                              
                            notation to indicate that the 3D points of the first calibration plane are already associated to their corresponding D
                           
                              j
                            lines, and we keep the 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            notation for the other calibration planes k
                           >1 because we must establish a one-to-one correspondence between each 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            and some D
                           
                              j
                            ray.

In computer vision, the directed Hausdorff distance (DHD) is an efficient measure to register points on 3D surfaces [30–32]. We estimate a first (coarse) O
                           
                              P
                            position, denoted by 
                              
                                 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       P
                                    
                                 
                              
                           , by minimizing the DHD between the laser rays and the 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            laser points:
                              
                                 (10)
                                 
                                    
                                       
                                          
                                             
                                                O
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          P
                                       
                                    
                                    =
                                    arg
                                    
                                       
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   O
                                                
                                                
                                                   P
                                                
                                             
                                          
                                       
                                    
                                    DHD
                                    
                                       
                                          
                                             D
                                             ,
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                         
                                                            c
                                                         
                                                      
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            3
                                                            D
                                                         
                                                         
                                                            i
                                                            ,
                                                            k
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 D
                              
                            gathers the set of laser rays D
                           
                              j
                            passing through O
                           
                              P
                            and 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       j
                                       ,
                                       1
                                    
                                 
                              
                            (j
                           =1,…,
                           N). The DHD is defined as [30]:
                              
                                 (11)
                                 
                                    DHD
                                    
                                       
                                          
                                             D
                                             ,
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                         
                                                            c
                                                         
                                                      
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            3
                                                            D
                                                         
                                                         
                                                            i
                                                            ,
                                                            k
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             max
                                          
                                          
                                             i
                                             ∈
                                             {
                                             1
                                             ,
                                             …
                                             ,
                                             N
                                             }
                                             k
                                             ∈
                                             {
                                             2
                                             ,
                                             …
                                             ,
                                             K
                                             }
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      min
                                                   
                                                   
                                                      j
                                                      ∈
                                                      {
                                                      1
                                                      ,
                                                      …
                                                      ,
                                                      N
                                                      }
                                                   
                                                
                                             
                                             d
                                             
                                                
                                                   
                                                      
                                                         
                                                         
                                                            c
                                                         
                                                      
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            3
                                                            D
                                                         
                                                         
                                                            i
                                                            ,
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            D
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where d stands for the Euclidean distance between a point and a 3D line. In words, using the DHD ensures that the K 
                           
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            points matched with a given ray D
                           
                              j
                            are indeed the K closest points to D
                           
                              j
                           . We use the simplex optimization algorithm [33,34] since the cost function (11) is not analytically differentiable. At each iteration, the O
                           
                              P
                            position is updated and the D
                           
                              j
                            lines are updated accordingly. Fig. 5
                           a and b illustrates the initial simplex and the simplex evolution while converging to the optimal position of the projector optical center. Since (10) is a 3D optimization problem, the simplex is a tetrahedron region [34]. By construction of the active vision system, we approximately know the relative position of the diffractive lens (i.e., that of O
                           
                              P
                           ) with respect of the camera optical center O
                           
                              C
                           . Thus, we can define the initial tetrahedron in such a way that O
                           
                              P
                            is close to a tetrahedron edge. The tetrahedron of Fig. 5a is centered on the camera optical center and the edge lengths are set to the camera to projector distance (≈100mm). The iterations of the simplex algorithm are stopped when the tetrahedron volume is below a given threshold which is chosen small enough for the coarse estimation of 
                              
                                 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       P
                                    
                                 
                              
                           .

When the optimization stage is completed, each 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            has been assigned to its respective laser ray D
                           
                              j
                           : D
                           
                              j
                            is set to the closest ray to 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                           . In the following, with a slight abuse of notations, we rename 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            by 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       j
                                       ,
                                       k
                                    
                                 
                              
                            to express that for a given calibration board k, there is a one to one correspondence between i and j.

In the previous step, the D
                           
                              j
                            rays were constrained to pass through the 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       j
                                       ,
                                       1
                                    
                                 
                              
                            laser points of the first calibration plane. Here, we improve the D
                           
                              j
                            estimation by relaxing this constraint and taking all 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                              
                            positions into account (for k
                           ⩾1). This improvement also yields a finer estimation of O
                           
                              P
                           .

To decrease the error 
                              
                                 d
                                 
                                    
                                       
                                          
                                             
                                             
                                                c
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                3
                                                D
                                             
                                             
                                                j
                                                ,
                                                k
                                             
                                          
                                          ,
                                          
                                             
                                                D
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                              
                           , we impose that D
                           
                              j
                            passes through O
                           
                              P
                            and the center of mass (i.e., the mean position over k) 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       j
                                    
                                 
                              
                            of all 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       j
                                       ,
                                       k
                                    
                                 
                              
                            points matched to D
                           
                              j
                           . The center of mass is ideally located on D
                           
                              j
                            when 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       j
                                       ,
                                       k
                                    
                                 
                              
                            are exactly known and there is no numerical error. Since the 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       j
                                    
                                 
                              
                            points are known and independent of O
                           
                              P
                           ,O
                           
                              P
                            is the only remaining unknown parameter. O
                           
                              P
                            is estimated as the position minimizing the sum of Euclidean distances between all 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       j
                                       ,
                                       k
                                    
                                 
                              
                            points and their related D
                           
                              j
                            ray:
                              
                                 (12)
                                 
                                    
                                       
                                          O
                                       
                                       
                                          P
                                       
                                    
                                    =
                                    arg
                                    
                                       
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   O
                                                
                                                
                                                   P
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             =
                                             1
                                          
                                          
                                             K
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    d
                                    
                                       
                                          
                                             
                                                
                                                
                                                   c
                                                
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   3
                                                   D
                                                
                                                
                                                   j
                                                   ,
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   D
                                                
                                                
                                                   j
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            P
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                         
                                                            c
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  P
                                                               
                                                               
                                                                  ¯
                                                               
                                                            
                                                         
                                                         
                                                            3
                                                            D
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           Again, we use the simplex algorithm. To initialize the algorithm, we use the 
                              
                                 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       P
                                    
                                 
                              
                            position already obtained in step 3. This starting position is close to the final (expected) position of the projector optical center.

We consider a single acquisition of some unknown surface (which is not necessarily planar) using our calibrated projective system. This yields an image of the surface containing the N projected laser rays 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    2
                                    D
                                 
                                 
                                    i
                                 
                              
                           
                         as well. We show that our calibration method enables the reconstruction of the N laser points (named 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                           
                        ) that are being projected onto the imaged surface. The 3D reconstruction in the camera coordinate system is done as follows:
                           
                              1.
                              Remove the radial distortion from the 2D acquired image [24, pp. 189–191].

Segment the laser points in the image and compute their centers 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                             D
                                          
                                          
                                             i
                                          
                                       
                                    
                                 .

Use the intrinsic camera parameters to project 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                             D
                                          
                                          
                                             i
                                          
                                       
                                    
                                  into the 3D space, yielding a set of camera rays R
                                 
                                    i
                                 , i
                                 =1,…, N.

Match each camera ray R
                                 
                                    i
                                  to its corresponding laser ray D
                                 
                                    j
                                 . Towards this end, we exploit that the projection of some laser ray D
                                 
                                    j
                                  onto the camera image yields an epipolar line [28, Section 1.10] on which 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                             D
                                          
                                          
                                             i
                                          
                                       
                                    
                                  should lay. We remark that the epipolar geometry between two cameras is unchanged when considering a camera and a projector seen as a reverse camera (see Fig. 6
                                 ). As the number of epipolar lines is limited (we set N
                                 =8 in practice), we assign each 
                                    
                                       
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                             D
                                          
                                          
                                             i
                                          
                                       
                                    
                                  point to the closest epipolar line, leading to the matching of each camera ray R
                                 
                                    i
                                  with some projector ray D
                                 
                                    j
                                 .

Regarding the last step, both camera and laser rays are theoretically passing through the same 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                           
                         point located on the 3D surface, thus 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                           
                         may be reconstructed by intersecting both lines R
                        
                           i
                         and D
                        
                           j
                        . In practice, R
                        
                           i
                         and D
                        
                           j
                         are likely to not exactly intersect, thus we estimate 
                           
                              
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    3
                                    D
                                 
                                 
                                    i
                                 
                              
                           
                         as the midpoint of the smallest segment joining both lines, as shown in Fig. 6.

Our second SLS (see Fig. 7
                        a) is composed of a JAI camera of resolution 1920×1080pixels. The same 6mm objective as for the sparse point laser SLS is mounted on the camera. A digital light processing (DLP) pico-projector (Optoma PK 301) is used to illuminate the scene with a larger number of points. The constant angle between the camera and the pico-projector remains equal to about 30°. Two different patterns are calibrated in separate procedures: a color coded pattern of 24×15 squares and a monochrome random pattern of 58 green squares (see Fig. 7b and c). It is worth noticing that no color or other code is used during the calibration step. This information may be required for the 3D-point reconstruction after SLS calibration depending on the density of points.

To calibrate the SLS, the planar board of Figs. 2 and 7a is again manually placed into the scene. For a given calibration board position, two images are systematically acquired. The first is acquired with the room light switched on and without pattern projection. This image contains only the disk matrix as shown in Fig. 7a. For the second image, the room light is switched off and a pattern is projected onto the calibration board. Now, the disks of Fig. 7a are invisible while the structured light appears as in Figs. 7b and c.

The camera is calibrated as described in Section 2.2 with the disk matrix images and using Zhang’s algorithm [27]. The four steps described for the sparse point projector calibration in Section 2.4 remain unchanged when calibrating the pico-projector SLS (projected point segmentation, 3D point reconstruction, matching of 3D-points to their projector rays, and refinement of the projector parameters). The only small difference with the sparse laser point set SLS occurs during the computation of calibration board planes. Instead of using the four control disks of Fig. 4, all disk centers of the camera calibration board of Fig. 7a are now used to estimate the plane poses. The plane computation method of Section 2.3 remains unchanged.

We actually simplified the laser based SLS calibration described in Section 2 involving two calibration boards. In this procedure, different poses were used for the camera and the projector. Here, the pico-projector SLS is calibrated with a unique calibration board and two acquired images per board position. This facilitates the practical positioning of the board by reducing the number of board displacements. Because they are common to both the camera and projector calibrations, these displacements are done only once. The use of single calibration board can also be applied in the calibration procedure of the sparse point set SLS of Section 2. Conversely, the calibration board with four control disks (Fig. 4) could be used to calibrate the pico-projector.

The reconstruction method of Section 2.5 has been slightly modified to cope with the color coded pattern because there is a larger number of points. The only step to be adapted is the matching of the points in the acquired images to their projector rays. For the sparse point SLS, this matching is possible without ambiguities using solely the epipolar geometry. For the pico-projector SLS, the epipolar geometry alone may not be systematically sufficient for the matching step. For the color coded pattern, the M-array (also called perfect map [35]) of 24×15 points was built with the method described in [36] maximizing the Hamming distance. A given color code can only appear once in the 3×3 point neighborhoods of the M-array.

We evaluate the 3D point reconstruction accuracy of the laser (Section 4.1) and pico-projector (Section 4.2) SLSs by acquiring images of a simple 3D object whose geometry is precisely known. This test allows for comparison of the results obtained for both SLSs and a discussion on the adequacy of the calibration method to different active vision systems.

The test object is a “3D step” composed of two parallel half-planes π
                           1 and π
                           2 laying at a distance h
                           =21.95mm (see Fig. 8
                           a). The step shape is inspired by the SLS prototype evaluation of Chan et al. [20]. Our complete data acquisition procedure includes two steps:
                              
                                 1.
                                 Acquisition of P
                                    =120 images of the 3D object using the active vision system (see Fig. 8b). These images are split into two groups of 60 images. For the first 60 acquisitions, the camera 
                                       
                                          
                                             
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      →
                                                   
                                                
                                             
                                             
                                                c
                                             
                                          
                                       
                                     axis is maintained orthogonal to the object surface and the camera to object distance varies in between 150 and 300mm. For the other 60 acquisitions, the camera to object distance is set to 250mm while the viewing angle varies from −60° to 60°.

Acquisition of K
                                    ⩾2 images of the calibration board of Fig. 4a leading to the active system calibration. For each acquisition, the calibration board is manually maintained in front of the camera without accurately controlling its distance and orientation with respect to the SLS.

For each image p
                           ∈{1,…,
                           P}, N
                           =8 laser points 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                              
                            (i
                           ∈{1,…,
                           N}) are being reconstructed according to the procedure described in Section 2.5. The image acquisitions are done in such a way that four laser points are projected on each half-plane π
                           1 and π
                           2 (see Fig. 8b). Therefore, each half plane equation can be reconstructed from the four related points. The orientation angle θ
                           
                              p
                            between both half planes and their relative distance h
                           
                              p
                            are being evaluated subsequently (ideally, we have h
                           
                              p
                           
                           =
                           h and θ
                           
                              p
                           
                           =0° since the planes are parallel). These two criteria allow us to assess the accuracy of our method to preserve the shape and dimension of a scene. In addition, we define the 3D reconstruction error as follows. For each acquisition p and each reconstructed point i, we compute the Euclidean distance (denoted by ε
                           
                              i,p
                           ) between 
                              
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                       D
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                              
                            and its corresponding half plane. The mean error is defined by:
                              
                                 (13)
                                 
                                    
                                       
                                          
                                             
                                                ε
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          laser
                                       
                                    
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          NP
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             p
                                             =
                                             1
                                          
                                          
                                             P
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          ε
                                       
                                       
                                          i
                                          ,
                                          p
                                       
                                    
                                 
                              
                           We also define the normalized error as the ratio 
                              
                                 
                                    
                                       ε
                                    
                                    
                                       %
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                                 =
                                 
                                    
                                       ε
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                                 /
                                 
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                              
                            where 
                              c
                           
                           z
                           
                              i,p
                            is the depth of the reconstructed point with respect to the camera device. Again, we define the mean normalized error 
                              
                                 
                                    
                                       
                                          
                                             ε
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       %
                                    
                                    
                                       laser
                                    
                                 
                              
                            by averaging 
                              
                                 
                                    
                                       ε
                                    
                                    
                                       %
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                              
                            over both i and p.

We define the calibration robustness as the 3D point reconstruction accuracy with respect to the number K of calibration images. To assess the robustness, we perform three tests by setting K to 2, 10 and 20 images, respectively. For each test, P evaluations of θ
                           
                              p
                            and h
                           
                              p
                            are performed in addition to the 
                              
                                 
                                    
                                       
                                          
                                             ε
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       laser
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       
                                          
                                             ε
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       %
                                    
                                    
                                       laser
                                    
                                 
                              
                            evaluations. Moreover, for a given value of K, we study the precision of reconstruction by keeping the camera to object distance constant while varying the viewing angle, and conversely, varying the camera to object distance while maintaining the camera 
                              
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       c
                                    
                                 
                              
                            axis orthogonal to the object surface.

The calibration robustness results are gathered in Table 1
                           . We observe that the reconstruction errors are small whatever the number K of calibration images: 
                              
                                 
                                    
                                       
                                          
                                             ε
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       laser
                                    
                                 
                              
                            is equal to 0.15mm while 
                              
                                 
                                    
                                       
                                          
                                             ε
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       %
                                    
                                    
                                       laser
                                    
                                 
                              
                            amounts to 0.07%. The mean values of h
                           
                              p
                            are very close to h while the θ
                           
                              p
                            values tend towards θ
                           =0°. Again, these values do not depend on K. These results indicate that the robustness sensitivity is very low. We emphasize that the calibration is flexible, as the calibration plane is approximately positioned perpendicular to the camera 
                              
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       c
                                    
                                 
                              
                            axis. In our tests, no particular attention was paid to the calibration board position when holding it in front of the camera as long as it is approximately perpendicular to the camera axis. Because two image acquisitions are enough for accurate calibration, we will always set K
                           =2 in the following precision evaluation tests.

We first evaluate the point reconstruction accuracy with respect to the camera to object distance. Here, the camera 
                              
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       c
                                    
                                 
                              
                            axis is orthogonal to the 3D step half-planes and the camera to object distance lays in the interval [150,300] mm. The 60 acquisition distances are regularly spaced in this interval. The mean error on h
                           
                              p
                            is sub-millimetric (0.22mm) and the related standard deviation is equal to 0.29mm. The average angle θ
                           
                              p
                            is equal to 0.26° and the related standard deviation is equal to 1.06°. We note that both errors on h
                           
                              p
                            and θ
                           
                              p
                            slightly increase with the camera to object distance.

We now assess the accuracy with respect to the viewing angle which is defined as follows. The viewing angle is set to 0° when the camera 
                              
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       c
                                    
                                 
                              
                            axis is orthogonal to the object surface, and to the projector to camera angle (≈+30°) when the laser rays are orthogonal to the object surface. Fig. 9
                            gathers the h
                           
                              p
                            and θ
                           
                              p
                            evaluations obtained for different viewing angles ranging from −60° to 60°. It is noticeable that the h
                           
                              p
                            values are often slightly underestimated and that the least errors on θ are obtained when the camera axis is orthogonal to the half planes. The errors are gradually increasing with the viewing angle but they remain limited (lower than 1.5mm and 1.5°, respectively). Therefore, the shape (here keeping parallel planes) of the 3D step can be accurately restored even for large viewing angles. Let us stress that the maximum viewing angle configuration (60°) is extreme and unrealistic in many applications, as in medical endoscopy where the endoscope is often orthogonal to the surface being imaged; see Section 5. Similarly, large angles are usually avoided in dimensional analysis of manufactured parts for which the acquisition conditions can be controlled. In these applications, the 3D point reconstruction is very accurate. While being more flexible, the related reconstruction errors are of same magnitude as those reported in [10,20].

In addition to the above results, we tested the sensibility of the simplex algorithm with respect to the initial solution for steps 3 and 4 of the calibration process. Regarding step 3, we experimentally verified that the same O
                           
                              P
                            solution is reached when initializing the simplex with a regular tetrahedron centered on the optical center of the camera while varying the tetrahedron edge lengths. When the edge length is large enough to approximately cover the camera to projector distance, the simplex algorithm systematically converges to the same solution. The optimization process of step 4 is always completed within a few iterations since the 
                              
                                 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       P
                                    
                                 
                              
                            position yielded by step 3, which is used as starting position, is very close to the expected position of the projector optical center.

We repeat the same experiment as in Section 4.1.1 for (i) the monochrome random pattern and (ii) the color coded pattern. Let us briefly recall this procedure. For each pattern, the reconstruction accuracy of the calibrated pico-projector SLS is tested using the step edge of Fig. 8a. Again, the projected points are equally spread over the half planes π
                           1 and π
                           2. Three images are acquired for camera/object distances of about 20, 30 and 40cm. The step edge orientations are arbitrary (see Fig. 10
                           ).

It is noticeable that our algorithm only takes the (radial) distortions due to the camera into account, but not the projector distortions. The point reconstruction accuracy confirms that the latter distortions can potentially be neglected (according to the application requirements). However, correcting the distortions due to the pico-projector may help to further improve the reconstruction accuracy when high precision is required.

The edge height h
                           =21.95mm and the angle θ
                           =0° are again ground truth values used for the reconstruction result assessment. Moreover, for each pattern, the Euclidean distances ε
                           
                              i,p
                            between the ith reconstructed 3D point of acquisition p and its corresponding half-plane are used to compute the mean reconstruction error
                              
                                 (14)
                                 
                                    
                                       
                                          
                                             
                                                ε
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          pico
                                       
                                    
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          NP
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             p
                                             =
                                             1
                                          
                                          
                                             P
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          ε
                                       
                                       
                                          i
                                          ,
                                          p
                                       
                                    
                                 
                              
                           where p
                           ∈{1,2,3} (P
                           =3) and the point index i belongs to {1,…,
                           N}. The number of points is equal to N
                           =58 and 360=24×15, respectively for the monochrome random pattern and the color coded pattern.

@&#RESULTS AND DISCUSSION@&#


                           Fig. 10a and b shows the step edge acquired with the color coded and the monochrome random patterns, respectively. Fig. 10c and d represents the corresponding reconstructed points on the step. The point to half-plane distance is in average equal to a quarter of a millimeter for both patterns. Table 2
                            gives the mean h
                           it p and θ
                           
                              p
                            measured values which are ideally equal to h and θ
                           =0°, respectively. The edge heights are measured with sub-millimeter error and the two half planes are almost parallel considering the small θ
                           
                              p
                            angles computed with the reconstructed points. The shape and dimensions of the step edge can be recovered with both patterns with similar accuracy.

Both laser based and pico-projector SLSs exhibit accurate reconstruction results. Tables 1 and 2 show that the reconstructed points are very close to the planes for both SLSs. This accuracy is of the same order of magnitude as that of other reference calibration methods dealing with point pattern projectors [2,3].

In conclusion, we have demonstrated that our calibration method is applicable to very different kinds of projectors. Moreover, it can handle various point densities: very sparse patterns with 8 laser points, monochrome random patterns with 58 points, and color coded patterns with 360 points. Calibration methods for point pattern projectors are often conceived for a given number of points. They are based on a specific (known) spatial distribution of the points in the images, which is exploited to find the correspondance between the points composing the pattern and their projection in the images. On the contrary, the proposed method is generic. The projected points in the calibration images are automatically grouped (Eq. (10)) and then associated to the corresponding projector rays (Eq. (12)).

Dense point SLSs are widely used in industrial applications e.g., for quality control or dimensional analysis of manufactured parts. On the contrary, the use of a sparse point SLSs is less frequent. The goal of this section is to illustrate by means of a medical application that a sparse point SLS can be of high interest when 3D textured large FOVs have to be built. In this medical application, surfaces must not be constructed with high accuracy since only global shapes matter. Moreover, the surfaces in the images have not to be hidden by dense point clouds during the acquisitions. These constraints justify the choice of a sparse point SLS.

Medical video-endoscopic imaging systems are essential for minimal invasive surgery (laparoscopy) [37] or for cancer diagnosis in hollow organs, e.g., in the bladder in the case of cystoscopy [23]. For a cystoscopic examination, the endoscope (cystoscope) is close to the internal bladder wall so that each image of the video-sequence, taken individually, visualizes only a small area of the surface of interest. Cancers being spread over a large area of the bladder epithelium, the clinician (urologist or surgeon) has to mentally reconstruct large 3D FOVs. This facilitates neither the diagnosis nor the follow-up of lesion evolution. For these reasons, it is most useful to numerically reconstruct a 3D image with a large FOV of the inspected organ from the individual images acquired by the camera. This image is also called a mosaic or panoramic image. Although for underground inspection, 3D mosaicing algorithms have been proposed for spherical scanning devices acquiring large FOV images (the camera captures all areas around the optical center within 360° horizontally and 60° vertically) [6], 3D mosaicing remains an open problem in medical endoscopy where the images cover a local FOV. However, mosaicing algorithms have been proposed in 2D for the bladder [23,38–40]. In the past, different authors have shown that 3D information can be recovered with active vision endoscopes. In [2], a two channel endoscope was used, the first channel being dedicated to the structured light projector while the second was used for image acquisition. In laparoscopy [3], an active vision method was designed to reconstruct 3D information in the abdominal cavity. Specifically, the structured light is projected through the operative channel and the images are acquired through the endoscope channel. In [2,3], only surfaces can be reconstructed because the projected pattern is dense, so it is superimposed to the image texture which is lost.
                           2
                           When only few pixels are covered by the laser points, the color of homologous pixels from other images in the sequence can be used to replace the laser pixels by “real” texture when the mosaic is constructed. This is not possible for dense point sets. Moreover, 3D mosaicing algorithms fail when too much pixel texture is lost due to pattern projection.
                        
                        
                           2
                         The implementation (miniaturization) of the active vision principle of the laser based SLS on an endoscope is currently in progress in our laboratory. Although the size of the prototype of Fig. 1 is much larger than that of real medical endoscopes, the following experiments allow us to validate the potential of the sparse point SLS for medical endoscopy.

Using two phantoms of known geometry, we show that our SLS affords us to reconstruct 3D large FOV textured surfaces of the bladder. The phantoms representing surfaces with realistic bladder textures are shown on Fig. 11
                        a and b. The first phantom is a cylinder of radius 19cm. This simple phantom is designed to verify that our SLS makes it possible to restore the surface curvature of a cylinder. The second phantom is a more complex (non-convex) “wave” surface for which the viewing angle (the camera to surface angle) is varying depending on the local curvature of the surface. The wave period is equal to 8cm and the wave depth, i.e., the difference between the minimal and maximal surface depths, is equal to 2cm. The curvature variations are actually extreme in comparison with those of a bladder surface whose shape is approximately ellipsoidal. Indeed, the bladder is filled with a saline solution during its examination, and a period of the wave phantom simulates the bladder deformation due to a neighboring organ. Using the laser SLS, we capture a video sequence for each phantom, each acquisition corresponding to an image including a 2D local view of the surface texture and the N
                        =8 reconstructed laser point positions on the surface, expressed in the camera coordinate system. For bladder endoscopy, when the endoscope to bladder surface distance is 1cm, each acquired image scans a local surface area of a few square centimeters. Although the dimensions of both the laser SLS prototype and surface phantoms are unrealistic for bladder endoscopy, we keep the ratio viewing distance vs area of local scanned surface constant to show the feasibility for bladder endoscopy. We refer the reader to Fig. 13a–c which displays the local imaged area and the corresponding acquired images of the wave phantom for three acquisitions.

Because the SLS moves inside the phantom, the camera coordinate system position is changing. Therefore, it is necessary to determine the 3D rigid transformation linking two consecutive SLS positions in order to position the points corresponding to the acquisition frame p
                        +1 into the camera coordinate system of frame p. This surface construction problem is not obvious because the 3D points computed for two consecutive acquisition times do not correspond to homologous positions on the object surface. In [12], we proposed an optimization algorithm which iteratively finds the 3D rigid transformation giving the SLS displacement between two image acquisitions. The optimization process is guided by the registration of both acquired images p and p
                        +1. By repeatedly applying this algorithm to each pair of consecutive images, we reconstruct a 3D panoramic view of the imaged surface by placing all N
                        ×
                        P 3D points in a common coordinate system, where P denotes the number of camera acquisitions. These points are then used to reconstruct a mesh surface on which the data image textures can be projected knowing the camera calibration parameters.

In order to validate the potential of the sparse point SLS for medical endoscopy, we show a qualitative display of the 3D reconstructed points together with the textured images. For the cylinder phantom experiment, the displacement of the SLS prototype inside the phantom is a combination of translations, rotations and scale changes. Fig. 12
                         represents all 3D points, placed in the camera coordinate system of the first acquisition (p
                        =1). These results are in good agreement with the surface shape as all reconstructed points lay very close to the cylinder surface. The placement of the points of the camera coordinate system for viewpoint p
                        +1 in that of acquisition p is done with an average error equal to 0.06mm. Regarding the wave surface, Fig. 13 displays a few images illustrating the whole textured surface reconstruction process.
                           3
                           A video showing the construction of the textured wave phantom surface is provided to the reviewers as a Supplementary material.
                        
                        
                           3
                         
                        Fig. 13a–c includes the current viewpoint and the current FOV of the camera for three acquisitions, together with the 3D reconstructed points in the coordinate system of the first acquisition. Progressive stages of the textured surface construction are illustrated on Fig. 13
                        d and e. The partial and complete 3D panoramic images are displayed under two different viewpoints for better visualization of the surface curvatures. We conclude that the reconstructed shapes are in good agreement with the wave surface geometry. Moreover, the 2D textures in the panoramic image are spatially continuous and correctly superimposed to the 3D reconstructed surface.

Although the panoramic surface (and image) reconstruction is not the main purpose of the present paper, we quantify the surface reconstruction error by evaluating the mean error (over N) done while positioning the N laser points of acquisition p
                        +1 in the camera coordinate system of acquisition p. Actually, this error is the conjunction of two errors, namely the calibration errors by our active vision system (algorithm of Section 2.5) and the movement error related to the placement of points of image frame p
                        +1 in the camera coordinate system of acquisition p (mosaicing algorithm). The overall error amounts to 0.06 and 0.30mm for the cylinder and wave phantoms, respectively. This error is mostly due to the endoscope movement error: it is related to a limitation of the mosaicing algorithm which makes the assumption that the local imaged area acquired by the endoscope are almost planar. This assumption is clearly not met for the wave phantom acquisitions. This mosaicing error source is discussed in details in [12]. Note also that for bladder endoscopy, the goal is to reconstruct realistic surface shapes with textures but it does not make sense to perform surface reconstruction with sub-millimeter precision, because the bladder is an elastic organ that is prone to deformations (these deformations are limited because the bladder is filled with an isotonic saline solution during the examination).

@&#CONCLUSION@&#

The proposed calibration method for point based SLSs is flexible for two main reasons.

Firstly, it requires neither any expensive equipment nor precise positioning devices. A simple planar board is manually placed in the frustum of the SLS while the operator interventions are minimized. It has been shown that two acquisitions are sufficient to calibrate the projector and a single board can be used to calibrate both the projector and the camera.

Secondly, there is no constraint regarding the number of points in the pattern, their color, their spatial distribution, and the nature of the information (coded or random pattern). Such flexibility is interesting for both industrial and medical applications. This flexibility is not obtained at the expense of accuracy since the reconstruction results presented in this paper are as precise as other SLS systems [2,3].

By showing that our calibration method works with two very different projectors, we prove that it is well suited to different applications. For instance, a sparse point SLS may be useful for touchless testing of industrial materials, since it would provide textures of the inspected material which are complementary to the metrological surface measurements [41,42]. We showed that constructing surfaces with textures is enabled in medical endoscopy (cystoscopy). In this application, the textures have to be preserved while only a sparse set of points is reconstructed for each endoscope viewpoint (the video-sequence includes many images). By placing all points in a common coordinate system, a textured 3D large FOV is obtained and bladder cancer diagnosis is facilitated.The construction of a 3D cystoscope prototype is currently in progress in our laboratory. Preliminary results with the proposed calibration method show that the 3D point reconstruction remains possible with sub-millimetric accuracy although the 3mm baseline (distance between the camera and projector optical centres) is smaller.

In the proposed method, the camera and projector are sequentially calibrated. Because the camera calibration errors propagate to the projector calibration, one perspective is to test a two-step refinement algorithm as proposed in [43] to compensate these propagation errors. The first step consists in the sequential camera and projector calibration we have proposed. The second step is a joint projector and camera parameter adjustment improving the 3D point reconstruction accuracy. Regarding data distortion, only the barrel distortion due to the camera optics was corrected. Another perspective of this work is to take into account distortions into the projector model. With the laser based projector, no distortion can occur. With digital light processing projectors, integrating distortion parameters into the projector model can be interesting to test whether the reconstruction accuracy can be improved. In our distortion free projector model, all pico-projector rays are projected from a same point, namely the optical centre of the projector optics. In practice, due to the distortions, each projector line originates from different points in the space. Our small reconstruction errors seem to indicate that these points are close to the optical centre. However, this assumption and its impact on the reconstruction accuracy have to be analyzed by testing a projector model with rays originating from different points.

@&#ACKNOWLEDGMENTS@&#

To simulate quite realistic bladder textures, we used pictures acquired for fresh pig bladders kindly provided by the Centre Hospitalier Universitaire (CHU) Nancy-Brabois. This work was sponsored by the Région Lorraine and the Centre National de la Recherche Scientifique (CNRS) under contract PEPS Biotechno et Imagerie de la Santé (2010–2011).

Supplementary data associated with this article can be found, in the online version, at http://dx.doi.org/10.1016/j.cviu.2013.06.002.


                     
                        
                           Supplementary material
                           
                        
                     
                  

@&#REFERENCES@&#

