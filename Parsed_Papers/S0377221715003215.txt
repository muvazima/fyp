@&#MAIN-TITLE@&#Simulation-optimization approaches for water pump scheduling and pipe replacement problems

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose new approaches for water pump scheduling and pipe replacement problems.


                        
                        
                           
                           Optimization models are developed for both problems.


                        
                        
                           
                           EPANET simulator is used to enforce hydraulic feasibility.


                        
                        
                           
                           Numerical testing is conducted on two real water networks.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Pump scheduling

Pipe replacement

Water networks

Integer programming

@&#ABSTRACT@&#


               
               
                  Network operation and rehabilitation are major concerns for water utilities due to their impact on providing a reliable and efficient service. Solving the optimization problems that arise in water networks is challenging mainly due to the nonlinearities inherent in the physics and the often binary nature of decisions. In this paper, we consider the operational problem of pump scheduling and the design problem of leaky pipe replacement. New approaches for these problems based on simulation-optimization are proposed as solution methodologies. For the pump scheduling problem, a novel decomposition technique uses solutions from a simulation-based sub-problem to guide the search. For the leaky pipe replacement problem a knapsack-based heuristic is applied. The proposed solution algorithms are tested and detailed results for two networks from the literature are provided.
               
            

@&#INTRODUCTION@&#

The aging infrastructure of water networks is a growing concern for water utilities which are continuously facing complex decisions related to the optimal investment and operation of the water systems. As pipe networks reach the end of their useable life, operational costs increase due to inefficiencies and to water leaks in the network. For instance, in 2011 the city of Houston reported that 18 billion gallons of water were lost due to water leakages in the network with an estimated cost of over 10 million dollars (Horswell, 2011). Thus, maintaining a reliable infrastructure within sustainable costs is a major challenge given the increasing demand for water which is expected to double by the year 2035 (National Geographic, 2013).

The research literature is rich with approaches to optimize investment and operational decisions on water networks. These problems are challenging because of the need to model the physics of water flow and because many of the decisions considered have a binary character which leads to mixed integer programming models that are hard to solve to optimality. Problems have been addressed in reliability (Sherali, Smith, & Kim, 1996), network operations (Nitivattananon, Sadowski, & Quimpo, 1996), and network design which includes pipe sizing (Bragalli, D’Ambrosio, Lee, Lodi, & Toth, 2012; Eiger, Shamir, & Ben-Tal, 1994) and network expansion (Sherali, Subramanian, & Loganathan, 2001). As reviewed later, a wide variety of solution approaches have been proposed including exact algorithms for optimally solving nonlinear models, heuristic approaches to obtain feasible solutions without optimality guarantees, and hybrid methods.

In this paper, we consider two challenging problems in water networks that involve binary decisions. First, we consider the operational problem of scheduling pumps to minimize energy cost. In finding on/off pump schedules, we take into account temporal variations in water demand and electricity costs. Secondly, we consider the design problem of deciding which leaky pipes to replace in order to minimize pressure driven leakage within a given budget. While both optimization problems are challenging to solve due to the binary decisions and underlying nonlinearity, simulation can be easily applied to evaluate a particular network setup in terms of feasibility and associated cost.

Many methods which couple an optimization method (especially heuristics) with a simulator have been reported in the literature. In comparison to existing approaches the contributions of the present work are (a) a novel decomposition technique for the pump scheduling problem, and (b) a knapsack-based heuristic applied to the leaky pipe replacement problem.

The remainder of the paper is organized as follows. Section 2 presents a literature review of prior research on optimizing water networks. The proposed simulation-optimization approaches for the pump scheduling and pipe replacement problems are presented in Section 3. Computational results are presented in Section 4. Finally, Section 5 summarizes our findings and illustrates future research directions.

@&#LITERATURE REVIEW@&#

Optimization problems arising in water networks have been studied extensively in the literature especially in the recent years due to several factors that include advancements in optimization methods, mainly nonlinear optimization, as well as the increasing need from a practical perspective for improved decision support analytics for operating and managing water networks.

The solution approaches that were proposed in the literature are divided into two categories; the first focuses on metaheuristics to find good quality solutions while the second includes exact solution methods through the use of nonlinear optimization techniques.

Heuristics such as genetic algorithms have been used to find good quality solutions for problems arising in water networks. In the context of pipe replacement, Halhal, Walters, Ouazar, and Savic (1997) proposed a genetic algorithm to solve a multiobjective pipe replacement problem that minimizes the replacement cost and maximizes the hydraulic performance of the network. Dandy and Engelhardt (2001) proposed a genetic algorithm that accounts for capital cost, pipe replacement costs, and damage cost to find pipe replacement schedules. In the context of pump scheduling, Mackle, Savic, and Walters (1995) presented a genetic algorithm and conducted experiments on a system that contains a single reservoir and three pumps. The same approach was extended by Goldman and Mays (1999) to include water quality constraints. Due to the large solution space of potential pump schedules and the computational requirements of the hydraulic simulator that evaluates each potential solution, the proposed genetic algorithm is only applicable to networks of relatively small sizes. McCormick and Powell (2004) proposed to speed up the solution evaluation process by using a relaxed linear program and presented a simulated annealing heuristic to explore the solution space. In order to reduce the search space, rather than modeling the pump schedules as on/off binary decisions, López-Ibáñez, Prasad, and Paechter (2008) proposed to use the number of hours that a particular pump stays on as a decision variable and then presented an ant colony metaheuristic as a search procedure. The computational experiments showed that the proposed ant colony approach outperforms genetic algorithms applied to the case where binary decisions are used to model the pump schedules. While a large majority of the literature focuses on computationally efficient algorithms for deterministic pipe replacement and pump scheduling problems that do not consider uncertainty, we note that uncertainty is important in real world planning problems and there has been several approaches to evaluate the effect of uncertainty on the planning decisions (Wang & Huang, 2015). Particularly, Wang and Huang (2011) propose an approach that incorporates an interactive fuzzy resolution method within an inexact two-stage stochastic programming framework to handle the uncertainty. In Wang and Huang (2013), a scenario-based solution method is proposed that takes into account different attitudes of decision makers towards the objective function and the constraints, while Wang and Huang (2014) propose an approach based on statistical experimental design to find solutions with different risk levels of constraint violation.

The challenge in applying exact optimization techniques is twofold. Real networks that are of interest in practice are large, thus scalable optimization methods are essential. Furthermore, the head-loss equation used to model water flow in pipes leads to nonlinear nonconvex optimization problems that are very challenging to solve (D’Ambrosio, Lodi, Wiese, & Bragalli, in press) to optimality and typically heuristics can be used to find feasible solutions without optimality guarantees. The equation below represents the difference between the hydraulic heads hi
                         and hj
                         of two nodes i and j that are connected by a pipe p sustaining a flow qij
                        
                        
                           
                              (1)
                              
                                 
                                    
                                       h
                                       i
                                    
                                    −
                                    
                                       h
                                       j
                                    
                                    =
                                    
                                       Φ
                                       p
                                    
                                    
                                       (
                                       
                                          q
                                          
                                             i
                                             j
                                          
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

In hydraulics, components of the fluid’s energy are scaled by the weight of the fluid to form a quantity called the head. The hydraulic head is the sum of the fluid elevation and the water pressure head. As is customary in water network analysis, the kinetic energy (velocity head) is neglected in the energy balance equation (1). The explicit form for Φp
                        (qij
                        ) is given by the Hazen–Willliams equation

                           
                              (2)
                              
                                 
                                    
                                       Φ
                                       p
                                    
                                    
                                       (
                                       
                                          q
                                          
                                             i
                                             j
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          10.67
                                          ×
                                          sign
                                          
                                          
                                             (
                                             
                                                q
                                                
                                                   i
                                                   j
                                                
                                             
                                             )
                                          
                                          
                                             
                                                |
                                                
                                                   q
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                |
                                             
                                             
                                                1.852
                                             
                                          
                                          
                                             L
                                             p
                                          
                                       
                                       
                                          
                                             k
                                             p
                                             
                                                1.852
                                             
                                          
                                          
                                             D
                                             p
                                             
                                                4.87
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        or the Darcy–Weisbach equation

                           
                              (3)
                              
                                 
                                    
                                       Φ
                                       p
                                    
                                    
                                       (
                                       
                                          q
                                          
                                             i
                                             j
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          8
                                          ×
                                          sign
                                          
                                          
                                             (
                                             
                                                q
                                                
                                                   i
                                                   j
                                                
                                             
                                             )
                                          
                                          
                                             q
                                             
                                                i
                                                j
                                             
                                             2
                                          
                                          
                                             L
                                             p
                                          
                                          
                                             f
                                             p
                                          
                                          
                                             (
                                             
                                                q
                                                
                                                   i
                                                   j
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             π
                                             2
                                          
                                          g
                                          
                                             D
                                             p
                                             5
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where Lp
                         is the length of pipe p, kp
                         is the roughness coefficient, Dp
                         is the diameter, fp
                        (qij
                        ) is the friction factor, and g is the gravitational acceleration.

Several approaches have been proposed to handle the difficulties that are due to the nonlinear nonconvex optimization models. Yu, Powell, and Sterling (1994) presented an optimization algorithm that uses the generalized reduced gradient method coupled with sensitivity analysis to find optimal pump schedules; this algorithm needs a feasible starting point and iterates so that all the interim points are feasible. Sherali and Smith (1997) used the Reformulation-Linearization Technique to construct a tight linear programming relaxation of the pump scheduling problem and then used a branch-and-bound algorithm to obtain global optimal solutions. In Bragalli et al. (2012), the pipe sizing problem is considered and a mixed integer nonlinear programming model is proposed and solved. In Gleixner, Held, Huang, and Vigerske (2012), the nonconvex mixed integer nonlinear programming model is solved using SCIP solver while in Verleye and Aghezzaf (2013), the nonlinear equations are approximated using piecewise linear functions and a mixed integer linear solver is used to solve the resulting problem. An outer approximation approach is also exploited in Raghunathan (2013) to solve the nonlinear model. Extensive details on the application of optimization techniques to water network problems are presented in the surveys (D’Ambrosio et al., in press; De Corte & Sörensen, 2013).

In this section, we propose new approaches to solve the pump scheduling problem and leaky pipe replacement problem in water networks. As discussed, the main challenges are nonlinearity and binary decisions. Both proposed approaches rely on a hydraulic simulator to enforce nonlinear constraints in the problem and evaluate feasibility. The well known EPANET simulator (EPANET (v. 2), 2008) is applied for the pump scheduling problem. For the leaky pipe replacement problem, an adaptation of the EPANET simulator to model leaking pipes was developed by the authors.

Pump scheduling is an operational problem that requires modeling the dynamics of the water network by including the changing demand patterns and typically the changing energy price patterns. Increasingly complex tariff structures for electricity allow water utilities to realize considerable savings by pumping at different times. The approach developed here considers a water network with constant speed centrifugal pumps and at least one storage tank. Within a given time period each pump in the network may have a status of on or off.

In order to model the dynamics, the time horizon is discretized into T time periods and water demand and electricity prices are set for each discrete time period t ∈ {1,…, T}. A typical planning horizon is one day and is divided into 24 hourly periods. Since in Europe the electricity tariffs are usually given in discrete periods of 15 minutes, then 96 time periods are considered. The time dependency of the variables coupled with the nonlinearities and the nonconvexity that are due to Eq. (1) make the pump scheduling challenging even when a piecewise linear approximation or a quadratic approximation is used for the head-loss functions (Ghaddar, Naoum-Sawaya, Kishimoto, Taheri, & Eck, 2015). As detailed in Ghaddar et al. (2015), the following parameters and decision variables are introduced to formulate the pump scheduling problem:


                        
                           
                              
                                 
                                 
                                 
                                    
                                       
                                          Parameters:
                                       
                                       
                                          Sets:
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                C
                                                t
                                             
                                          : Electricity cost in time period 
                                             t
                                          
                                       
                                       
                                          
                                             N
                                          : The set of pipes
                                    
                                    
                                       
                                          
                                             γ
                                          : Specific weight of water
                                       
                                          
                                             P
                                          : The set of pipes that contain pumps
                                    
                                    
                                       
                                          
                                             
                                                η
                                                
                                                   i
                                                   j
                                                
                                             
                                          : Efficiency of pump installed on pipe 
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                          
                                       
                                       
                                          
                                             K
                                          : The set of tanks
                                    
                                    
                                       
                                          
                                             
                                                Q
                                                
                                                   i
                                                   j
                                                
                                                U
                                             
                                          : Maximum rate of flow through pipe 
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                          
                                       
                                       
                                          
                                             J
                                          : The set of junctions
                                    
                                    
                                       
                                          
                                             
                                                D
                                                
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                          : Demand at junction 
                                             j
                                           in period 
                                             t
                                          
                                       
                                       
                                          
                                             T
                                          : The set of time periods
                                    
                                    
                                       
                                          
                                             
                                                E
                                                i
                                             
                                          : Elevation of node 
                                             i
                                          
                                       
                                       
                                    
                                    
                                       
                                          
                                             
                                                P
                                                j
                                                L
                                             
                                          : Minimum water level in tank 
                                             j
                                          
                                       
                                       
                                    
                                    
                                       
                                          
                                             
                                                P
                                                j
                                                U
                                             
                                          : Maximum water level in tank 
                                             j
                                          
                                       
                                       
                                    
                                    
                                       
                                          
                                             
                                                A
                                                j
                                             
                                          : Surface area of tank 
                                             j
                                          
                                       
                                       
                                    
                                    
                                       
                                          
                                             
                                                Δ
                                                T
                                             
                                          : Length of each time period
                                       
                                    
                                 
                              
                           
                        
                     


                        Decision variables:
                        
                           
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                q
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             
                                             :
                                             
                                             Flow
                                             
                                             rate
                                             
                                             of
                                             
                                             link
                                             
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             
                                             in
                                             
                                             time
                                             
                                             period
                                             
                                             t
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                                h
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             
                                             :
                                             
                                             Head-loss
                                             
                                             in
                                             
                                             link
                                             
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             
                                             in
                                             
                                             time
                                             
                                             period
                                             
                                             t
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                                p
                                                
                                                   i
                                                   ,
                                                   t
                                                
                                             
                                             
                                             :
                                             
                                             Pressure
                                             
                                             at
                                             
                                             node
                                             
                                             i
                                             
                                             in
                                             
                                             time
                                             
                                             period
                                             
                                             t
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     1
                                                                     
                                                                     if
                                                                     
                                                                     the
                                                                     
                                                                     pump
                                                                     
                                                                     of
                                                                     
                                                                     link
                                                                     
                                                                     (
                                                                     i
                                                                     ,
                                                                     j
                                                                     )
                                                                     
                                                                     is
                                                                     
                                                                     on
                                                                     
                                                                     in
                                                                     
                                                                     period
                                                                     
                                                                     t
                                                                     ,
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     0
                                                                     
                                                                     otherwise
                                                                     .
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

We note that a link (i, j) denotes an arc between i and j (i.e. the flow rate variables are positive variables). The Mixed-Integer Non-linear Programming formulation of the pump scheduling problem is as follows:

                           
                              (4)
                              
                                 
                                    
                                       
                                       
                                          
                                             [PS0]:
                                             
                                             min
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   t
                                                
                                                T
                                             
                                             
                                                ∑
                                                
                                                   (
                                                   i
                                                   ,
                                                   j
                                                   )
                                                   ∈
                                                   P
                                                
                                             
                                             
                                                
                                                   γ
                                                   
                                                      C
                                                      t
                                                   
                                                   
                                                      Δ
                                                      T
                                                   
                                                
                                                
                                                   η
                                                   
                                                      i
                                                      j
                                                   
                                                
                                             
                                             
                                                h
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             
                                                q
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (5)
                              
                                 
                                    
                                       
                                       
                                          s.t.
                                       
                                       
                                          
                                             
                                                q
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≤
                                             
                                                Q
                                                
                                                   i
                                                   j
                                                
                                                U
                                             
                                             
                                             ∀
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             ∈
                                             N
                                             /
                                             P
                                             ,
                                             
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                q
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≤
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             
                                                Q
                                                
                                                   i
                                                   j
                                                
                                                U
                                             
                                             
                                             ∀
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             ∈
                                             P
                                             ,
                                             
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (7)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                                i
                                             
                                             
                                                q
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             −
                                             
                                                ∑
                                                k
                                             
                                             
                                                q
                                                
                                                   j
                                                   k
                                                   ,
                                                   t
                                                
                                             
                                             =
                                             
                                                D
                                                
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             
                                             ∀
                                             j
                                             ∈
                                             J
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (8)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                q
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             
                                                (
                                                
                                                   (
                                                   
                                                      p
                                                      
                                                         i
                                                         ,
                                                         t
                                                      
                                                   
                                                   +
                                                   
                                                      E
                                                      i
                                                   
                                                   )
                                                
                                                −
                                                
                                                   (
                                                   
                                                      p
                                                      
                                                         j
                                                         ,
                                                         t
                                                      
                                                   
                                                   +
                                                   
                                                      E
                                                      j
                                                   
                                                   )
                                                
                                                −
                                                
                                                   h
                                                   
                                                      i
                                                      j
                                                      ,
                                                      t
                                                   
                                                
                                                )
                                             
                                             ≥
                                             0
                                             
                                             ∀
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             ∈
                                             N
                                             /
                                             P
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (9)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                (
                                                
                                                   p
                                                   
                                                      i
                                                      ,
                                                      t
                                                   
                                                
                                                +
                                                
                                                   E
                                                   i
                                                
                                                )
                                             
                                             −
                                             
                                                (
                                                
                                                   p
                                                   
                                                      j
                                                      ,
                                                      t
                                                   
                                                
                                                +
                                                
                                                   E
                                                   j
                                                
                                                )
                                             
                                             −
                                             
                                                h
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≤
                                             0
                                             
                                             ∀
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             ∈
                                             N
                                             /
                                             P
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (10)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             
                                                (
                                                
                                                   (
                                                   
                                                      p
                                                      
                                                         i
                                                         ,
                                                         t
                                                      
                                                   
                                                   +
                                                   
                                                      E
                                                      i
                                                   
                                                   )
                                                
                                                −
                                                
                                                   (
                                                   
                                                      p
                                                      
                                                         j
                                                         ,
                                                         t
                                                      
                                                   
                                                   +
                                                   
                                                      E
                                                      j
                                                   
                                                   )
                                                
                                                −
                                                
                                                   h
                                                   
                                                      i
                                                      j
                                                      ,
                                                      t
                                                   
                                                
                                                )
                                             
                                             =
                                             0
                                             
                                             ∀
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             ∈
                                             P
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (11)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                h
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             =
                                             
                                                (
                                                
                                                   a
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                
                                                   q
                                                   
                                                      i
                                                      j
                                                      ,
                                                      t
                                                   
                                                   2
                                                
                                                +
                                                
                                                   b
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                
                                                   q
                                                   
                                                      i
                                                      j
                                                      ,
                                                      t
                                                   
                                                
                                                +
                                                
                                                   c
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                )
                                             
                                             
                                             ∀
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             ∈
                                             N
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                P
                                                
                                                   j
                                                   ,
                                                   t
                                                
                                                L
                                             
                                             ≤
                                             
                                                p
                                                
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≤
                                             
                                                P
                                                
                                                   j
                                                   ,
                                                   t
                                                
                                                U
                                             
                                             
                                             ∀
                                             j
                                             ∈
                                             K
                                             ,
                                             
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                p
                                                
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             =
                                             
                                                p
                                                
                                                   j
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      ∑
                                                      i
                                                   
                                                   
                                                      q
                                                      
                                                         i
                                                         j
                                                         ,
                                                         t
                                                         −
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      ∑
                                                      k
                                                   
                                                   
                                                      q
                                                      
                                                         j
                                                         k
                                                         ,
                                                         t
                                                         −
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      Δ
                                                      T
                                                   
                                                   
                                                      A
                                                      j
                                                   
                                                
                                             
                                             
                                             ∀
                                             j
                                             ∈
                                             K
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (14)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                q
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≥
                                             0
                                             ,
                                             
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The objective function (4) minimizes the power consumption where Ct
                         is the electricity cost in time period t, ΔT
                         is the length of each time period, and ηij
                         is the efficiency of the pump that is installed on pipe (i, j). Constraints (5) enforce an upper bound on the rate of water flow in each of the pipes, and constraints (6) ensure that a pump must be on for the water to flow in the corresponding pipe. Constraints (7) model the conservation of water flow where D
                        
                           j, t
                         is the demand at node j at time period t. Constraints (8)–(11) are conservation of energy constraints based on the hydraulic properties of water networks where h
                        
                           ij, t
                         models the head-loss which is the difference in heads between two nodes i and j that are connected by a pipe (i, j) containing a flow q
                        
                           ij, t
                        . Constraints (8) and (10) are only enforced when the corresponding q
                        
                           ij, t
                         variables are positive and are otherwise redundant. As shown in Eq. (11), the pipe head-loss equation is assumed to follow a quadratic function where aij
                         and bij
                         are the resistance coefficients and cij
                         is the shutoff head (see Eck & Mevissen, 2014; Giacomello, Kapelan, & Nicolini, 2012 for details regarding the quadratic approximation of the pipe head-loss function). Constraints (12) set the minimum and the maximum tank levels, which are enforced to ensure a reliable water levels in the tanks. Constraints (13) are the tank mass balance equation where Aj
                         is the surface area of tank j. Finally, constraints (14) denote the binary and non-negativity conditions.

Besides satisfying the constraints that are related to the dynamics of the water network, pump schedules need to be practical for implementation. In particular, schedules should not contain frequent pump switching, because frequent activation and deactivation of pumps reduces their lifetime and adds little benefit in lowering the energy cost. Typically, the following set of constraints needs to be enforced for practical implementation:

                           
                              •
                              Once switched ON, a pump should remain ON for a minimum amount of time τ
                                 1.

Once switched OFF, a pump should remain OFF for a minimum amount of time τ
                                 2.

A pump cannot be switched ON more than a maximum number of times N
                                 max  during the planning horizon.

In order to enforce the above conditions, the following binary variables are defined:

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                y
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             =
                                          
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  1
                                                                  
                                                                  if
                                                                  
                                                                  the
                                                                  
                                                                  pump
                                                                  
                                                                  on
                                                                  
                                                                  pipe
                                                                  
                                                                  (
                                                                  i
                                                                  ,
                                                                  j
                                                                  )
                                                                  
                                                                  is
                                                                  
                                                                  turned
                                                                  
                                                                  ON
                                                                  
                                                                  at
                                                                  
                                                                  period
                                                                  
                                                                  t
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  0
                                                                  
                                                                  otherwise
                                                                  ,
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                z
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             =
                                          
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  1
                                                                  
                                                                  if
                                                                  
                                                                  the
                                                                  
                                                                  pump
                                                                  
                                                                  on
                                                                  
                                                                  pipe
                                                                  
                                                                  (
                                                                  i
                                                                  ,
                                                                  j
                                                                  )
                                                                  
                                                                  is
                                                                  
                                                                  turned
                                                                  
                                                                  OFF
                                                                  
                                                                  at
                                                                  
                                                                  period
                                                                  
                                                                  t
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  0
                                                                  
                                                                  otherwise
                                                                  .
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        The following constraints ensure that the operational requirements are met:

                           
                              (15)
                              
                                 
                                    
                                       
                                       
                                          
                                             −
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             +
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             −
                                             
                                                y
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≤
                                             0
                                             ,
                                             
                                          
                                       
                                       
                                          
                                             ∀
                                             (
                                             i
                                             ,
                                             j
                                             )
                                             ∈
                                             P
                                             ,
                                             
                                             ∀
                                             t
                                             >
                                             0
                                             ,
                                             
                                             t
                                             ∈
                                             T
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (16)
                              
                                 
                                    
                                       
                                       
                                          
                                             −
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   
                                                      t
                                                      ′
                                                   
                                                
                                             
                                             +
                                             
                                                y
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≤
                                             0
                                             ,
                                             
                                          
                                       
                                       
                                          
                                             ∀
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             ∈
                                             P
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                             ,
                                             
                                             ∀
                                             
                                                t
                                                ′
                                             
                                             ∈
                                             T
                                             :
                                             t
                                             ≤
                                             
                                                t
                                                ′
                                             
                                             ≤
                                             t
                                             +
                                             
                                                τ
                                                1
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (17)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             −
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             −
                                             
                                                z
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≤
                                             0
                                             ,
                                             
                                          
                                       
                                       
                                          
                                             ∀
                                             (
                                             i
                                             ,
                                             j
                                             )
                                             ∈
                                             P
                                             ,
                                             
                                             ∀
                                             t
                                             >
                                             0
                                             ,
                                             t
                                             ∈
                                             T
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (18)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   
                                                      t
                                                      ′
                                                   
                                                
                                             
                                             +
                                             
                                                z
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≤
                                             1
                                             ,
                                             
                                          
                                       
                                       
                                          
                                             ∀
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             ∈
                                             P
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                             ,
                                             ∀
                                             
                                                t
                                                ′
                                             
                                             ∈
                                             T
                                             :
                                             t
                                             ≤
                                             
                                                t
                                                ′
                                             
                                             ≤
                                             t
                                             +
                                             
                                                τ
                                                2
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (19)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                t
                                             
                                             
                                                y
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≤
                                             
                                                N
                                                max
                                             
                                             ,
                                             
                                          
                                       
                                       
                                          
                                             ∀
                                             (
                                             i
                                             ,
                                             j
                                             )
                                             ∈
                                             P
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Constraints (15) force y
                        
                           ij, t
                         to take a value of 1 if the pump on link (i, j) is turned ON at period t, and constraints (16) force the pump to remain ON for at least τ
                        1 time periods after it is switched ON. Constraints (17) force z
                        
                           ij, t
                         to take a value of 1 if the pump on link (i, j) is turned OFF at period t, and constraints (18) force the pump to remain OFF for at least τ
                        2 time periods after it is switched OFF. Finally, constraints (19) set an upper bound on the maximum number of times each pump can be switched ON during the planning horizon.

As discussed in Ghaddar et al. (2015), solving problem [PS0] is computationally challenging even for small networks.
                        
                         Alternatively, given a pump schedule that is feasible to constraints (15)–(19), EPANET can be called to verify the hydraulic feasibility of the schedule and calculate the energy cost. In other words, when fixing all the binary decisions in [PS0] (i.e. when a pump schedule is given), the remaining nonlinear program is either infeasible or has a unique solution. Thus, if feasible, the values of the remaining continuous variables can either be found by solving the nonlinear problem using a nonlinear optimization solver or using a simulation tool as done in this paper using EPANET. The proposed approach is hence an exact optimization approach for solving problem [PS0].

Finding a schedule that is feasible to constraints (15)–(19) can be done by solving the following feasibility problem which is a mixed integer linear program
                        
                        
                           
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             [PS1]:
                                             
                                             min
                                             
                                             0
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             s.t
                                             
                                             (
                                             15
                                             )
                                             ,
                                             
                                             (
                                             16
                                             )
                                             ,
                                             
                                             (
                                             17
                                             )
                                             ,
                                             
                                             (
                                             18
                                             )
                                             ,
                                             
                                             (
                                             19
                                             )
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             ,
                                             
                                             
                                                y
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             ,
                                             
                                             
                                                z
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             ,
                                             
                                             ∀
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             ∈
                                             P
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Problem [PS1] can be easily solved using mixed integer linear programming solvers such as CPLEX (IBM ILOG CPLEX Optimization Studio, 2013). Thus, given a solution of [PS1], EPANET is called to verify hydraulic feasibility. If the current solution of [PS1] is infeasible to EPANET, then the solution is eliminated by adding the following cut to [PS1]

                           
                              (20)
                              
                                 
                                    
                                       ∑
                                       
                                          
                                             (
                                             i
                                             j
                                             ,
                                             t
                                             )
                                          
                                          :
                                          
                                             
                                                s
                                                ˜
                                             
                                             
                                                i
                                                j
                                                ,
                                                t
                                             
                                          
                                          =
                                          0
                                       
                                    
                                    
                                       s
                                       
                                          i
                                          j
                                          ,
                                          t
                                       
                                    
                                    +
                                    
                                       ∑
                                       
                                          
                                             (
                                             i
                                             j
                                             ,
                                             t
                                             )
                                          
                                          :
                                          
                                             
                                                s
                                                ˜
                                             
                                             
                                                i
                                                j
                                                ,
                                                t
                                             
                                          
                                          =
                                          1
                                       
                                    
                                    
                                       (
                                       1
                                       −
                                       
                                          s
                                          
                                             i
                                             j
                                             ,
                                             t
                                          
                                       
                                       )
                                    
                                    ≥
                                    1
                                 
                              
                           
                        which indicates that at least one of the pumps in the current solution 
                           
                              s
                              ˜
                           
                         must change status in order for the solution to become feasible. Since EPANET reports the period 
                           
                              T
                              ˜
                           
                         at which the simulation becomes infeasible then constraint (20) can be further strengthened by forcing one of the pumps to change status before period 
                           
                              
                                 T
                                 ˜
                              
                              +
                              1
                           
                         and thus instead of (20), the following cut is added to [PS1]

                           
                              (21)
                              
                                 
                                    
                                       ∑
                                       
                                          
                                             (
                                             i
                                             j
                                             ,
                                             t
                                             ≤
                                             
                                                T
                                                ˜
                                             
                                             )
                                          
                                          :
                                          
                                             
                                                s
                                                ˜
                                             
                                             
                                                i
                                                j
                                                ,
                                                t
                                             
                                          
                                          =
                                          0
                                       
                                    
                                    
                                       s
                                       
                                          i
                                          j
                                          ,
                                          t
                                       
                                    
                                    +
                                    
                                       ∑
                                       
                                          
                                             (
                                             i
                                             j
                                             ,
                                             t
                                             ≤
                                             
                                                T
                                                ˜
                                             
                                             )
                                          
                                          :
                                          
                                             
                                                s
                                                ˜
                                             
                                             
                                                i
                                                j
                                                ,
                                                t
                                             
                                          
                                          =
                                          1
                                       
                                    
                                    
                                       (
                                       1
                                       −
                                       
                                          s
                                          
                                             i
                                             j
                                             ,
                                             t
                                          
                                       
                                       )
                                    
                                    ≥
                                    1
                                    .
                                 
                              
                           
                        Since infeasibility is often due to tanks being run below the minimum level or overfilled above the maximum allowable level, then stronger cuts compared to (21) can be obtained in those cases. If a tank is below the minimum allowable level by period 
                           
                              T
                              ˜
                           
                         then a pump must be turned on before period 
                           
                              
                                 T
                                 ˜
                              
                              +
                              1
                           
                         and the following cut is added to [PS1]

                           
                              (22)
                              
                                 
                                    
                                       ∑
                                       
                                          
                                             (
                                             i
                                             j
                                             ,
                                             t
                                             ≤
                                             
                                                T
                                                ˜
                                             
                                             )
                                          
                                          :
                                          
                                             
                                                s
                                                ˜
                                             
                                             
                                                i
                                                j
                                                ,
                                                t
                                             
                                          
                                          =
                                          0
                                       
                                    
                                    
                                       s
                                       
                                          i
                                          j
                                          ,
                                          t
                                       
                                    
                                    ≥
                                    1
                                    .
                                 
                              
                           
                        Similarly, if the infeasibility is due to a tank being overfilled above the allowable level by period 
                           
                              T
                              ˜
                           
                         then a pump must be turned off before period 
                           
                              
                                 T
                                 ˜
                              
                              +
                              1
                           
                         and the following cut is added to [PS1]

                           
                              (23)
                              
                                 
                                    
                                       ∑
                                       
                                          
                                             (
                                             i
                                             j
                                             ,
                                             t
                                             ≤
                                             
                                                T
                                                ˜
                                             
                                             )
                                          
                                          :
                                          
                                             
                                                s
                                                ˜
                                             
                                             
                                                i
                                                j
                                                ,
                                                t
                                             
                                          
                                          =
                                          1
                                       
                                    
                                    
                                       (
                                       1
                                       −
                                       
                                          s
                                          
                                             i
                                             j
                                             ,
                                             t
                                          
                                       
                                       )
                                    
                                    ≥
                                    1
                                    .
                                 
                              
                           
                        We note that the proposed algorithm can be seen as a combinatorial Benders decomposition (Codato & Fischetti, 2006; Naoum-Sawaya & Elhedhli, 2010) where the subproblem is a simulation. The master problem [PS1] finds potential schedules while the simulation eliminates infeasibilities by returning combinatorial Benders cuts of the form (21)–(23).

Alternatively, given a solution of [PS1] that is feasible to EPANET, the corresponding energy cost is reported by EPANET thus giving an upper bound on the optimum minimum cost. Subsequently, a cut of the form (20) is added to [PS1] to force the problem to find an alternative schedule with potentially lower energy cost. Additionally, in subsequent iterations, EPANET is set to return an error indicating a cost violation at time period 
                           
                              T
                              ˜
                           
                         whenever a feasible schedule is obtained with a corresponding cost exceeding the currently best available cost. In such a case, cuts of the form (21) are added thus eliminating pump schedules that have a cost that is higher than the current best. The algorithm is then stopped when [PS1] becomes infeasible. The current best solution is hence a provably optimal solution. Thus, the proposed simulation based iterative approach avoids the computational burden of solving the large scale non-linear problem [PS0], however we note that a computational bottleneck remains at the level of solving [PS1] which is NP-hard in general. We note that model [PS0] considers fixed speed pumps. In the case of variable speed pumps, the pump status is not a binary ON/OFF status but instead a continuous setting between a minimum and a maximum value. The presented approach would need to be extended to accommodate this additional degree of freedom.
                        
                     

Instead of setting the objective function of [PS1] to 0, alternative objective functions can be used to guide the search quicker towards good quality feasible solutions. Besides the 0 objective, the following two different objective functions were attempted. The first objective minimizes the distance to the currently best feasible solution 
                           
                              
                                 s
                                 ¯
                              
                              
                                 i
                                 j
                                 ,
                                 t
                              
                           
                        
                        
                           
                              (24)
                              
                                 
                                    min
                                    
                                    
                                       ∑
                                       
                                          i
                                          j
                                          ,
                                          t
                                       
                                    
                                    
                                       |
                                       
                                          s
                                          
                                             i
                                             j
                                             ,
                                             t
                                          
                                       
                                       −
                                       
                                          
                                             s
                                             ¯
                                          
                                          
                                             i
                                             j
                                             ,
                                             t
                                          
                                       
                                       |
                                    
                                    .
                                 
                              
                           
                        The intuition is that it is expected that feasible schedules can be found by little modification to the currently available feasible one. In practice, typically the schedule that is being used is a good starting point and can be used as 
                           
                              
                                 s
                                 ¯
                              
                              
                                 i
                                 j
                                 ,
                                 t
                              
                           
                         and later updated as the iterative algorithm finds better schedules. In the case where no feasible schedule is available, an objective of 0 is used until a feasible one is found. The second possible objective function is
                        
                        
                           
                              (25)
                              
                                 
                                    min
                                    
                                    
                                       ∑
                                       
                                          i
                                          j
                                          ,
                                          t
                                       
                                    
                                    
                                       p
                                       t
                                    
                                    
                                       s
                                       
                                          i
                                          j
                                          ,
                                          t
                                       
                                    
                                 
                              
                           
                        
                     

where pt
                         is the electricity tariff at period t. The intuition being that lower cost schedules are more likely to be obtained if pumps are turned on in cheaper cost periods and thus objective function (25) favors the search for such solutions.

In the following section, we describe a simulation-optimization approach for the pipe replacement problem.

The tendency of aging water systems to experience background leakage is well documented. Background leakage refers to leakage that happens all the time and is pressure driven as opposed to event driven such as leakage that is due to pipe bursts. Water lost to leakage carries costs for treatment, distribution, and increasingly public perception. Nonetheless, only a few strategies are available to manage these real losses including pressure management, active leakage control, and pipe repair or replacement (Lambert, 2001). Here we focus on the pipe replacement strategy, applying a heuristic technique to support the decision of which pipes to replace. In this formulation, replacing a pipe means installing a new pipe having the same length and diameter as the original pipe, but with improved leakage properties.

Utilities often face the challenge of deciding on which parts of the network to rehabilitate given a limited budget. Given a budget constraint, the pipe replacement model finds the optimal pipes to replace by minimizing the total leakage over a planning horizon while ensuring the hydraulic feasibility of the resulting network. The leakage lij
                         for the pipe that connects nodes i and j is modeled as a function of the average pressure on the pipe (Germanopoulos, 1985) as follows:

                           
                              (26)
                              
                                 
                                    
                                       l
                                       
                                          i
                                          j
                                       
                                    
                                    =
                                    
                                       β
                                       
                                          i
                                          j
                                       
                                    
                                    
                                       L
                                       
                                          i
                                          j
                                       
                                    
                                    
                                       
                                          (
                                          max
                                          
                                             {
                                             
                                                
                                                   
                                                      p
                                                      i
                                                   
                                                   +
                                                   
                                                      p
                                                      j
                                                   
                                                
                                                2
                                             
                                             ,
                                             0
                                             }
                                          
                                          )
                                       
                                       
                                          α
                                          
                                             i
                                             j
                                          
                                       
                                    
                                 
                              
                           
                        where βij
                         is the leakage coefficient of the pipe that connects nodes i and j, Lij
                         is its length, αij
                         is the leakage exponent, and pi
                         and pj
                         are the pressures at nodes i and j, respectively. For ease of modeling, leakage which occurs in a pipe (i, j) is transferred to the nodes by assuming that half of the leakage lij
                         occurs at node i while the other half occurs at node j (Giustolisi, Brunone, Savic, & Walski, 2013). Thus, the total demand at each node j is the system demand Dj
                         in addition to the total leakage 
                           
                              
                                 ∑
                                 
                                    {
                                    i
                                    |
                                    (
                                    i
                                    ,
                                    j
                                    )
                                    ∈
                                    N
                                    /
                                    P
                                    }
                                 
                              
                              
                                 
                                    
                                       β
                                       
                                          i
                                          j
                                       
                                    
                                    
                                       L
                                       
                                          i
                                          j
                                       
                                    
                                 
                                 2
                              
                              
                                 
                                    (
                                    max
                                    
                                       {
                                       
                                          
                                             
                                                p
                                                i
                                             
                                             +
                                             
                                                p
                                                j
                                             
                                          
                                          2
                                       
                                       ,
                                       0
                                       }
                                    
                                    )
                                 
                                 
                                    α
                                    
                                       i
                                       j
                                    
                                 
                              
                           
                         that is due to the leakage in all the pipes that connect to node j.
                     

In order to model the pipe replacement problem, the following parameters are introduced:

                           
                              Cw
                              :
                           
                              
water cost

leakage coefficient of the current pipe that connects nodes i and j
                              

leakage coefficient of the new pipe that connects nodes i and j
                              

cost of replacing pipe (i, j)

maximum budget for replacing pipes

Thus the pipe replacement problem is formulated as follows:
                        
                           
                              (27)
                              
                                 
                                    
                                       
                                       
                                          
                                             [PR0]:
                                             
                                             min
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   t
                                                
                                                T
                                             
                                             
                                                ∑
                                                
                                                   (
                                                   i
                                                   ,
                                                   j
                                                   )
                                                   ∈
                                                   N
                                                   /
                                                   P
                                                
                                             
                                             
                                                C
                                                w
                                             
                                             
                                                l
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (28)
                              
                                 
                                    
                                       
                                       
                                          s.t.
                                       
                                       
                                          
                                             (
                                             5
                                             )
                                             --
                                             (
                                             6
                                             )
                                             ,
                                             (
                                             8
                                             )
                                             --
                                             (
                                             13
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (29)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                                i
                                             
                                             
                                                q
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             −
                                             
                                                ∑
                                                k
                                             
                                             
                                                q
                                                
                                                   j
                                                   k
                                                   ,
                                                   t
                                                
                                             
                                             =
                                             
                                                D
                                                
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             +
                                             
                                                ∑
                                                
                                                   {
                                                   i
                                                   |
                                                   (
                                                   i
                                                   ,
                                                   j
                                                   )
                                                   ∈
                                                   N
                                                   /
                                                   P
                                                   }
                                                
                                             
                                             
                                                l
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             
                                             ∀
                                             j
                                             ∈
                                             J
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (30)
                              
                                 
                                    
                                       
                                          
                                             l
                                             
                                                i
                                                j
                                                ,
                                                t
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                (
                                                
                                                   β
                                                   
                                                      i
                                                      j
                                                   
                                                   n
                                                
                                                
                                                   y
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                +
                                                
                                                   β
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                
                                                   (
                                                   1
                                                   −
                                                   
                                                      y
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                )
                                             
                                             
                                                L
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                
                                                   (
                                                   max
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               p
                                                               
                                                                  i
                                                                  ,
                                                                  t
                                                               
                                                            
                                                            +
                                                            
                                                               p
                                                               
                                                                  j
                                                                  ,
                                                                  t
                                                               
                                                            
                                                         
                                                         2
                                                      
                                                      ,
                                                      0
                                                      }
                                                   
                                                   )
                                                
                                                
                                                   α
                                                   
                                                      i
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             ×
                                             
                                             ∀
                                             (
                                             i
                                             ,
                                             j
                                             )
                                             ∈
                                             N
                                             /
                                             P
                                             ,
                                             
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (31)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   (
                                                   i
                                                   ,
                                                   j
                                                   )
                                                   ∈
                                                   N
                                                   /
                                                   P
                                                
                                             
                                             
                                                W
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                y
                                                
                                                   i
                                                   j
                                                
                                             
                                             ≤
                                             B
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (32)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                l
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ,
                                             
                                                q
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ≥
                                             0
                                             ,
                                             
                                             
                                                y
                                                
                                                   i
                                                   j
                                                
                                             
                                             ,
                                             
                                                s
                                                
                                                   i
                                                   j
                                                   ,
                                                   t
                                                
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The objective function (27) minimizes the cost of water leakage. Constraints (28) model the dynamics of water flow exactly as in the pump scheduling problem. Constraints (29) model the conservation of water flow taking into account water leakages which are defined by Eq. (30). We note that leakage in each pipe is dependent on the time period since water leakage is due to water pressures which change between the time periods due to pump operations and the varying water levels in the tanks. Finally, constraint (31) sets a maximum budget B for replacing pipes.

Solving the pipe replacement problem [PR0] is computationally challenging. Even when the pump schedules are fixed (by solving the pump scheduling problem independently as discussed earlier), the pipe replacement problem remains computationally intractable to solve to optimality due to the nonlinearities caused by the leakage equations in addition to the hydraulic equations that model water flow. Alternatively, as discussed earlier, a water network simulator can be used to verify hydraulic feasibility and calculate the water leakage and the energy cost. Thus, a simulation based heuristic for the pipe replacement problem is presented next. The heuristic assumes priorly obtained fixed pump schedules, so the remaining problem is to find pipe replacements to minimize the total water leakage. For that, we state the pipe replacement problem as follows:

                           
                              (33)
                              
                                 
                                    
                                       
                                       
                                          
                                             [PR1]:
                                             
                                             min
                                             
                                          
                                       
                                       
                                          
                                             Water
                                             
                                             leakage
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (34)
                              
                                 
                                    
                                       
                                       
                                          
                                             s.t
                                             
                                          
                                       
                                       
                                          
                                             Total
                                             
                                             cost
                                             
                                             of
                                             
                                             pipe
                                             
                                             replacements
                                             ≤
                                             B
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The objective function minimizes the total water leakage. The constraint limits the amount of investment in pipe replacement to a maximum budget B. While developing the explicit mathematical formulation of the total water leakage and applying a nonlinear optimization solver is intractable, finding the total water leakage after fixing a pipe replacement plan through a simulator such as EPANET is computationally tractable and thus an approach that iteratively modifies pipe replacements and evaluates the resulting design through simulation is possible. Problem [PR1] resembles to a knapsack problem where the objective function is evaluated through a simulator. Thus a knapsack type solution approach is proposed. Particularly, the pipe replacement is performed through a heuristic inspired from the profit-to-cost approach that is typically used to find good solutions for the 0–1 knapsack problem (Dantzig, 1957). As a first step, the heuristic arranges the pipes by a decreasing order of the profit-to-cost ratio. The profit for a particular pipe is the total background leakage for this pipe while its cost is the cost of replacing this pipe by a newer one. Then starting with the pipe with the highest profit-to-cost ratio and while enough remaining budget is available, the pipes are replaced. Since the exact impact of pipe replacement on the operation of the system cannot be known without a simulation, after each pipe replacement the new network is simulated and the pipe is replaced only if the new leakage volume is less than the currently best found leakage. The steps of the pipe replacement algorithm are as follows:
                     

In the following section we provide numerical results to demonstrate the performance of the proposed pump scheduling and pipe replacement algorithms.
                        
                     

This section presents results for numerical experiments that were conducted on two networks. We call the first network Poormond (Fig. 1). Poormond is based on a real water distribution system in the United Kingdom. It consists of one reservoir, seven pumps, and five tanks (47 nodes and 44 pipes). The Poormond network is adapted from the Richmond water distribution network that is used in the literature (Giacomello et al., 2012). The Richmond network (available online (Network, 2013)) was modified to the Poormond network considered here by

                        
                           1.
                           removing Tank E to avoid use of an implied control valve;

lowering the elevation of seven nodes having zero demand by 10 meters to avoid errors due to negative pressures.

The second network is C-TOWN (Fig. 2) which is a larger network containing one reservoir, 11 pumps, and 7 tanks (388 nodes and 432 pipes). The C-TOWN network is available online and the full details can be obtained from Giustolisi et al. (2013).

The proposed approaches for pump scheduling and pipe replacements were implemented in C and EPANET (EPANET (v. 2), 2008) is used as a hydraulic and water network simulator while CPLEX 12.6 is used as optimization solver to solve problem [PS1]. The computations were performed on a Red Hat Linux blade server with a 3.5 gigahertz processor.

In this section, we evaluate the pump scheduling algorithm that is proposed in Section 3.1. The scheduling horizon is set to 24 hours, and the decisions to turn a pump ON or OFF are made at 15-minute intervals (96 periods). Although a scheduling decision can be made every 15 minutes, the operational constraints (15)–(19) are required in practice to avoid frequent pump switching that shortens the life of the pumps. For example, in our implementation, pumps are required to stay on for at least 1 hour (4 periods) when switched ON. Furthermore pumps are required to stay off for at least 30 minutes (2 periods) when switched OFF. We also require that each pump is switched ON a maximum of 6 times during the 24-hour planning horizon. At the end of the scheduling horizon, the final water level in the tanks is also required to be at least the starting level, to ensure terminal conditions. These conditions are based on discussions with our industry partners and the approach that they currently use for the operation of their pumps. We note that the terminal conditions on the tanks are enforced at the level of the hydraulic simulator which returns infeasible if the terminal conditions are not satisfied.

As discussed in Section 3.1, the pump scheduling algorithm is considered with 3 different settings related to the objective function of problem [PS1]. The first setting considers a zero value for all the coefficients of the objective function, the second minimizes the distance to the current solution as shown in Eq. (24), and the third setting considers the electricity tariff for the period as shown in Eq. (25). A computational time limit of 1 hour is set after which the algorithm is stopped and the best solution is reported. For each network, 5 different sets of energy prices are used. The prices are based on the real energy prices that occurred on May 21–25, 2013 and can be obtained from Single Electricity Market Operator (2013).

The results which are displayed in Table 1 show the value of the best solution that is found within a time limit of 3600 seconds of computational time. Using the minimum distance objective function (Eq. (24)) as detailed in Section 3.1 achieves the best performance. This indicates that once a feasible schedule is found, alternative feasible schedules with lower objectives can be found with small changes in the pump schedules. The improvement of the overall objective function for May 21 prices is illustrated in Fig. 3. For the Poormond network, the first feasible solution is found in 0.89 seconds while the best feasible solution is found at 12.93 seconds. For the larger C-TOWN network, the first feasible pump schedule is found in 696.15 seconds while the best feasible schedule is found at 2821.31 seconds. We note that in the presented experiments, the algorithm does not stop before reaching the time limit and thus the presented solutions are not provably optimal. Figs. 4 and 5 illustrate the computed pump schedules and resulting tank levels for the Poormond May 21 instance. Similarly, Figs. 6 and 7 illustrate the computed pump schedules and resulting tank levels for the C-TOWN May 21 instance. As desired, the status of each pump is never switched more than 6 times during the 24 hours period and the minimum and maximum levels of the tanks are never violated.

The results that are obtained using the proposed approach are compared to those that have been found in Ghaddar et al. (2015) which proposed a Lagrangian decomposition approach to obtain good quality solutions for the Poormond network. As shown in Table 2, for the Poormond network the proposed approach found better solutions than the ones obtained in Ghaddar et al. (2015) for all the instances except for May 23 where a solution of 140.59 is obtained compared to 140.2 which was found in Ghaddar et al. (2015). For the May 22 case, the proposed approach reduced the cost by 6 percent from 139.4 to 131.39. Furthermore, compared to the lower bounds that are obtained in Ghaddar et al. (2015), the solutions that are found for the Poormond network have a gap between 5 percent (May 21) and 16 percent (May 25).

In this section, we evaluate the proposed pipe replacement algorithm on the Poormond and the C-TOWN networks. The goal is to minimize the total volume of leaked water given a pipe. As shown in Eq. (26), leakage through a pipe is dependent on the leakage coefficient that is typically a function of the pipe age. We assume that the newly replaced pipes have a leakage coefficient equal to 20 percent of the coefficient of the old pipes. The cost of replacing each pipe is set as a function of the pipe diameter and pipe length as summarized in Table 3. The experiments are conducted over different budgets ranging from 10 percent to 90 percent of the total cost for replacing all the pipes of the corresponding water network. The results that are summarized in Table 4 show the number of pipes that are replaced in each case along with the resulting total leakage and the corresponding leakage reduction. We notice that the computational time of the pipe replacement algorithm is small for Poormond network while it increases with the budget in the case of the larger C-TOWN network. We also notice a decreasing leakage reduction benefit on the investment where leakage is reduced by around 50 percent given a budget equal to 40 percent of the cost for replacing all the pipes of the network. Increasing the budget to 90 percent leads to a 76 percent and 77 percent leakage reduction for the Poormond and C-Town networks, respectively. Figs. 8(a) and 9(a) show the varying intensity of leakage in each pipe in terms of liters of leaked water per meter of pipe length. The pipes that are replaced given each amount of budget are also shown in Figs. 8 and 9. We notice that for low budget the replacements occur at the branches of the network since typically pipes that are in the branches are smaller pipes in terms of length and diameter and thus are cheap to replace. As budget increases, the pipes that are in the main line which are typically long and of larger diameters start being replaced. The main pipes are much more expensive to replace compared to pipes at the branches.

@&#CONCLUSION@&#

This paper presents simulation-optimization approaches to solve pump scheduling and pipe replacement problems that occur in water network design. These problems can be formulated as mixed integer nonlinear programs. However, due to the nonlinearities and the scale of the networks, these problems are difficult to solve using current optimization solvers. Hence in this paper, we provide solution approaches based on the combination of simulation and optimization to tackle these two problems. Particularly, rather than maintaining hydraulic feasibility using nonlinear equations in the optimization model, a simulator is used to enforce feasibility. The proposed solution approaches for pump scheduling and pipe replacement are implemented and tested on two water networks from the literature. The proposed pump scheduling approach with the minimum distance objective function obtained improving results compared to those that were obtained using the Lagrangian decomposition approach (Ghaddar et al., 2015), while reducing the computational overhead. The pipe replacement results show a decreasing benefit in leakage reduction with respect to an increase in budget. For low budgets, the pipes in the periphery of the network tend to be replaced first while for larger budgets, pipes belonging to the main lines which are typically more expensive begin to be replaced.

In future research, we plan to investigate the application of simulation-optimization approaches for other problems that arise in water network design. Particularly, pumps that are controlled by tank levels are common in water networks and optimizing the controls for such pumps is of interest. We also note that since uncertainty is inherent in real-world problems, extending the presented approaches to account for uncertainty is necessary to allow decision makers to easily use the results of the optimization approaches. Particularly, performing scenario analysis to evaluate the robustness of the solutions to data variations is necessary for implementation in practice.

@&#ACKNOWLEDGMENTS@&#

We greatly thank two anonymous referees for their valuable feedback and comments that helped improve the content of the paper.

@&#REFERENCES@&#

