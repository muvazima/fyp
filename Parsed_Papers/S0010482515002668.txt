@&#MAIN-TITLE@&#Differential cryptanalysis of a medical image cryptosystem with multiple rounds

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Differential cryptanalysis proves that the security of Fu׳s cryptosystem only depends on permutation key.


                        
                        
                           
                           Propose double differential cryptanalysis comparison method to analyze multiple round Fu׳s cryptosystem.


                        
                        
                           
                           Simulation results demonstrate the effectiveness of our differential attacks.


                        
                        
                           
                           Point out the other defects of the cryptosystem.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Chaos-based image encryption

Differential cryptanalysis

Permutation–substitution architecture

Discrete cat map

@&#ABSTRACT@&#


               
               
                  Recently, Fu et al. proposed a chaos-based medical image encryption scheme that has permutation–substitution architecture. The authors believe that the scheme with bit-level cat map shuffling can be achieved at high level of security even if it is only applied with a few encryption rounds. However, we find that the scheme cannot resist differential cryptanalysis. The differential cryptanalysis shows that the security of the original scheme depends only on permutation key instead of on all of the keys. Moreover, 17 chosen plain-images can reveal equivalent permutation key for 1-round and 2-round encryption. We propose a novel analysis method called double differential cryptanalysis comparison (DDCC) that is valid to break multi-round encryption with 
                        16
                        
                           
                              N
                           
                           2
                        
                        +
                        1
                      chosen plain-images, where 
                        
                           
                              N
                           
                           2
                        
                      is the size of the image. We also point out several weaknesses of the cryptosystem. The theoretical analysis and simulation results indicate that the encryption scheme is insecure.
               
            

@&#INTRODUCTION@&#

With the rapid development of computer technology, a variety of medical images, such as Computed Tomography (CT), Magnetic Resonance Imaging (MRI) images, are processed, delivered and stored in digital format. Security of digital medical images becomes critical since these images contain patients׳ personal information which could be very sensitive. Any compromise of the security of this kind of data could result in leakage of patient׳s health information with serious privacy consequence. Thus, it is essential to investigate secure encryption algorithms for digital medical images.

The conventional block ciphers, such as the Data Encryption Standard (DES), the Advanced Encryption Standard (AES) and the International Data Encryption Algorithm (IDEA), etc., are usually used to protect textual data. However, they are not suitable for encrypting medical images with large data capacity and high redundancy because they require a large computational time in practical applications. Thus, a number of image encryption schemes have been proposed, especially chaos-based algorithms. The characteristics of chaotic systems, such as sensitive to initial conditions and system parameters, ergodicity and randomness property, have similarities with essential design principles of a cryptosystem. So far, many scholars have designed image encryption schemes based on chaotic maps [1–11]. In 1998, Fridrich [1] suggested that a chaos-based image encryption algorithm should be composed of two processes: one phase is to permute image pixels and another phase to alter the pixel values. This architecture is called as permutation–diffusion, permutation–substitution or Fridrich׳s architecture. Subsequently, many chaos-based algorithms utilize this structure [2,4,5,7,8]. These algorithms use sorting of chaotic sequences [5] and chaotic maps as permutation methods, such as Arnold cat map [2,8], baker map and standard map [4]. Similarly, non-linear function [4], chaotic keystream [2,5,7,8], etc., can be applied to substitution process. In [2,5], both of them use the Chen׳s system to generate chaotic sequences in substitution process, this hyper-chaotic system can obtain large key space. In [7], logistic maps is applied in both permutation and substitution process, but the key will be changed in each round to achieve high security. Further, Pareek et al. [3] propose a scheme based on 16-pixel blocks. Each block contains eight types of encryption operations, one of which is determined by the outcome of the logistic map. In [6], Huang et al. introduce pixel-chaotic-shuffle (PCS) method combined with four differential chaotic systems, which can achieve a good confusion effect. Fu et al. [8] propose a medical image encryption scheme with bit-level permutation and further substitution for achieving high level of security. In this paper, we call this image cipher Fu׳s scheme. Recently, Wang et al. [9] present an image encryption based on dynamic S-boxes, which are constructed by the logistic map and the Kent map. The pixels of plain-image are substituted by S-boxes for encryption. In addition, Zhou et al. [10] and Som et al. [11] have proposed selective encryption schemes that only encrypt part of a plain image and improve encryption speed.

However, some chaos-based image algorithms have been analyzed and found to be insecure from the viewpoint of modern cryptology [12–18]. Li et al. [12] point out that for a permutation-only image cipher, it is possible to reconstruct the permutation matrix by comparing a number of the known plain-images and the corresponding cipher-images. This is because the pixel values before and after the permutation are unchanged. They consider that the permutation-only image cipher is vulnerable against known/chosen-plaintext attacks in the sense that only 
                        O
                        (
                        
                           
                              log
                           
                           
                              L
                           
                        
                        (
                        M
                        N
                        )
                        )
                      known/chosen plain-images are enough to break the ciphers, where 
                        M
                        N
                      is the size of the image and 
                        L
                      is the number of different pixel values. Also, they find that the attack complexity is 
                        O
                        (
                        
                           
                              log
                           
                           
                              L
                           
                        
                        (
                        M
                        N
                        )
                        
                           
                              (
                              M
                              N
                              )
                           
                           2
                        
                        )
                     . Li et al. [13] optimize the analysis above by a binary tree classification method and a multi-branch tree classification method, and the corresponding spatial complexity and computational complexity are only 
                        O
                        (
                        M
                        N
                        )
                      and 
                        O
                        (
                        
                           
                              log
                           
                           
                              L
                           
                        
                        (
                        M
                        N
                        )
                        M
                        N
                        )
                     , respectively.

Li et al and Li and Lo [12,13] have demonstrated that the permutation-only schemes are insecure, but their cryptanalysises cannot apply to the permutation–diffusion (permutation–substitution) encryption type [1]. Rhouma et al. [14] and Çokal et al. [15] analyze permutation–diffusion image encryption algorithms [5,2], respectively. But their cryptanalysises only focus on one-round encryption rather than multi-round cases. Solak et al. [16] propose a chosen-cipher text attack method and broke multi-round encryption of Fridrich׳s algorithm. However, the difficulty of their analysis method is increasing with higher encryption rounds. If the number of rounds is enough, the attack method proposed is infeasible. Recently, Zhang et al. [18] have analyzed the security of Fu׳s scheme with one-round encryption by using similar analysis method of Refs. [14] and [15], and proposed an improved version of Fu׳s scheme. They only change the structure from permutation–substitution to permutation–substitution–permutation. In other words, they simply add another permutation process. We find that their improved scheme is still insecure, it cannot resist differential attacks. In this paper, we also analyze Fu׳s scheme by using differential cryptanalysis with chosen-plaintexts. We propose a new analysis method called double differential cryptanalysis comparison (DDCC). This method is feasible for multi-round encryption.

The rest of the paper is organized as follows. Section 2 introduces some preliminaries about cat map and the properties of modular arithmetic. Section 3 briefly describes the original medical image encryption scheme. In Section 4, we analyze the security of this scheme by differential cryptanalysis in detail, and simulation results are presented in Section 5. In Section 6, we point out the defects of the cryptosystem. Finally, we conclude this paper.

The discrete cat map is usually used in permutation operation for image encryption and denoted by
                           
                              (1)
                              
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                   ′
                                                
                                             
                                          
                                          
                                             
                                                
                                                   y
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                p
                                             
                                          
                                          
                                             
                                                q
                                             
                                             
                                                
                                                   p
                                                   q
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    [
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             
                                                y
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                 mod
                                 
                                 N
                                 ,
                              
                           
                        where 
                           p
                           ,
                           q
                           ∈
                           [
                           1
                           ,
                           N
                           −
                           1
                           ]
                        , and 
                           (
                           x
                           ,
                           y
                           )
                         and 
                           (
                           x
                           ′
                           ,
                           y
                           ′
                           )
                         are the pixel positions of an original image and its permutated image, respectively.

To further shuffle pixel positions, Eq. (1) is iterated 
                           m
                         times and it yields
                           
                              (2)
                              
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                   ′
                                                
                                             
                                          
                                          
                                             
                                                
                                                   y
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   p
                                                
                                             
                                             
                                                
                                                   q
                                                
                                                
                                                   
                                                      p
                                                      q
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    m
                                 
                                 
                                    [
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             
                                                y
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 mod
                                 
                                 N
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                a
                                             
                                             
                                                b
                                             
                                          
                                          
                                             
                                                c
                                             
                                             
                                                d
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    [
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             
                                                y
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                 mod
                                 
                                 N
                                 ,
                              
                           
                        where 
                           a
                           ,
                           b
                           ,
                           c
                           ,
                           d
                           ∈
                           [
                           1
                           ,
                           N
                           −
                           1
                           ]
                        .

Assume that 
                           A
                        , 
                           B
                         and 
                           N
                         are integers. The modular arithmetic between them has the following properties.
                           Property 1
                           
                              
                                 
                                    (
                                    
                                       A
                                       ×
                                       B
                                    
                                    )
                                 
                                 
                                 mod
                                 
                                 N
                                 =
                                 
                                    [
                                    
                                       
                                          (
                                          
                                             A
                                             
                                             mod
                                             
                                             N
                                          
                                          )
                                       
                                       ×
                                       
                                          (
                                          
                                             B
                                             
                                             mod
                                             
                                             N
                                          
                                          )
                                       
                                    
                                    ]
                                 
                                 
                                 mod
                                 
                                 N
                                 .
                              
                           


                              
                                 
                                    (
                                    
                                       A
                                       −
                                       B
                                    
                                    )
                                 
                                 
                                 mod
                                 
                                 N
                                 =
                                 
                                    [
                                    
                                       
                                          (
                                          
                                             A
                                             
                                             mod
                                             
                                             N
                                          
                                          )
                                       
                                       −
                                       
                                          (
                                          
                                             B
                                             
                                             mod
                                             
                                             N
                                          
                                          )
                                       
                                    
                                    ]
                                 
                                 
                                 mod
                                 
                                 N
                                 .
                              
                           

For an equation 
                                 A
                                 x
                                 =
                                 B
                                 
                                 mod
                                 
                                 N
                              , if and only if 
                                 gcd
                                 (
                                 A
                                 ,
                                 N
                                 )
                               divides 
                                 B
                              , the equation must have a solution or multiple solutions, and the number of solutions is equal to 
                                 gcd
                                 (
                                 A
                                 ,
                                 N
                                 )
                              , where 
                                 gcd
                                 (
                                 A
                                 ,
                                 N
                                 )
                               is the greatest common divisor of 
                                 A
                               and 
                                 N
                              . The unique solution 
                                 x
                                 ≡
                                 
                                    
                                       A
                                    
                                    
                                       ϕ
                                       (
                                       N
                                       )
                                       −
                                       1
                                    
                                 
                                 B
                                 
                                 mod
                                 
                                 N
                              , where 
                                 ϕ
                                 (
                                 N
                                 )
                               is Euler׳s totient function.

Known two pairs of permutation relationship of Eq. (2), 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 )
                               mapping to 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 )
                               and 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 )
                               mapping to 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              , a limited number of solutions, 
                                 a
                                 ,
                                 b
                                 ,
                                 c
                               and 
                                 d
                              , can be determined.

Proof. According to Eq. (2) we have the following formulas:
                                 
                                    (3a)
                                    
                                       
                                          
                                             x
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       a
                                       
                                          
                                             x
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       b
                                       
                                          
                                             y
                                          
                                          
                                             1
                                          
                                       
                                       
                                       mod
                                       
                                       N
                                       ,
                                    
                                 
                              
                              
                                 
                                    (3b)
                                    
                                       
                                          
                                             y
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       c
                                       
                                          
                                             x
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       d
                                       
                                          
                                             y
                                          
                                          
                                             1
                                          
                                       
                                       
                                       mod
                                       
                                       N
                                       ,
                                    
                                 
                              
                              
                                 
                                    (4a)
                                    
                                       
                                          
                                             x
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       a
                                       
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       b
                                       
                                          
                                             y
                                          
                                          
                                             2
                                          
                                       
                                       
                                       mod
                                       
                                       N
                                       ,
                                    
                                 
                              
                              
                                 
                                    (4b)
                                    
                                       
                                          
                                             y
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       c
                                       
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       d
                                       
                                          
                                             y
                                          
                                          
                                             2
                                          
                                       
                                       
                                       mod
                                       
                                       N
                                       .
                                    
                                 
                              
                           

We subtract Eq. (4a) multiplied by 
                           
                              
                                 y
                              
                              
                                 1
                              
                           
                         from Eq. (3a) multiplied by 
                           
                              
                                 y
                              
                              
                                 2
                              
                           
                        , according to Property 1 and Property 2 we have
                           
                              (5)
                              
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 −
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 
                                 mod
                                 
                                 N
                                 =
                                 a
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 −
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 
                                 mod
                                 
                                 N
                                 .
                              
                           
                        
                     

Due to Property 3, we can solve the parameter 
                           a
                         of Eq. (5). The parameter 
                           a
                         may have either one solution or a limited number of solutions. For the latter case, we utilize the other mapping relationship that satisfies Eq. (2) to further confirm the right parameter.

Converting Eqs. (3) and (4) into different forms, we have
                           
                              (6)
                              
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 −
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 
                                 mod
                                 
                                 N
                                 =
                                 b
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 
                                 mod
                                 
                                 N
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 −
                                 
                                    
                                       y
                                       ′
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 
                                 mod
                                 
                                 N
                                 =
                                 c
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 −
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 
                                 mod
                                 
                                 N
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 −
                                 
                                    
                                       y
                                       ′
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 
                                 mod
                                 
                                 N
                                 =
                                 d
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 
                                 mod
                                 
                                 N
                                 .
                              
                           
                        
                     

Same as Eq. (5), we can solve the parameters 
                           b
                           ,
                           c
                         and 
                           d
                        .

The original medical image cryptosystem is a permutation–substitution architecture [8], shown in 
                     Fig. 1. In Fig. 1, the permutation process is based on bit-level permutations one of which uses different permutation keys, and then all bit-planes are combined again. Bit-level permutation uses discrete cat map with 
                        m
                      round iterations, i.e., Eq. (2) with 
                        m
                        ≥
                        1
                     . The substitution process is a pixel-level substitution. The whole permutation and substitution process has 
                        n
                      rounds, 
                        n
                        ≥
                        1
                     . Both permutation key and substitution key are unchanged in each round. In Fig. 1, 
                        M
                      is a plain-image, 
                        
                           
                              C
                           
                           
                              (
                              n
                              )
                           
                        
                      its output encrypted image, and 
                        
                           
                              P
                           
                           
                              (
                              t
                              )
                           
                        
                      and 
                        
                           
                              C
                           
                           
                              (
                              t
                              )
                           
                        
                      are the 
                        t
                        −
                        th
                      round permutation-image and substitution-image, respectively, 
                        t
                        =
                        1
                        ,
                        2
                        ,
                        …
                        ,
                        n
                     . Throughout the paper, we adopt uppercase symbols stand for images. For example, an image 
                        
                           
                              P
                           
                           
                              (
                              t
                              )
                           
                        
                      of size 
                        N
                        ×
                        N
                     , its pixel values can be written as one-dimensional array 
                        
                           
                              p
                           
                           
                              (
                              t
                              )
                           
                        
                        (
                        j
                        )
                     , 
                        j
                        =
                        0
                        ,
                        1
                        ,
                        …
                        ,
                        
                           
                              N
                           
                           2
                        
                        −
                        1
                     , or two-dimensional array 
                        
                           
                              p
                           
                           
                              (
                              t
                              )
                           
                        
                        (
                        
                           
                              j
                           
                           
                              1
                           
                        
                        ,
                        
                           
                              j
                           
                           
                              2
                           
                        
                        )
                     , 
                        
                           
                              j
                           
                           
                              1
                           
                        
                        ,
                        
                           
                              j
                           
                           
                              2
                           
                        
                        =
                        0
                        ,
                        1
                        ,
                        …
                        ,
                        N
                        −
                        1
                     .

Assume that a plain-image 
                           M
                         is an eight-bit gray image of size 
                           N
                           ×
                           N
                        . The detailed permutation process is described in the following three steps.
                           
                              Step 1. The plain-image 
                                    M
                                  is separated into 8 independent bit-planes, one of which is a binary image, i.e., its pixel values are 0 or 1.

Step 2. Each of eight bit-planes is shuffled by using Eq. (2) with different parameters 
                                    
                                       
                                          p
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                    i
                                    =
                                    0
                                    ,
                                    1
                                    ,
                                    …
                                    ,
                                    7
                                 . These parameters are secret permutation key. According to Eq. (2) known the parameters 
                                    
                                       
                                          p
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    m
                                  and the parameters 
                                    
                                       
                                          a
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          d
                                       
                                       
                                          i
                                       
                                    
                                  are equivalent for the permutation process, so 
                                    
                                       
                                          a
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          d
                                       
                                       
                                          i
                                       
                                    
                                  are called as the equivalent permutation key.

Step 3. The permutation-image 
                                    P
                                  is obtained by combining all the eight shuffled bit-planes together.

The pixel-level substitution process consists of the following three steps:
                           
                              Step 1. Iterate logistic map and generate chaotic sequence
                                    
                                       (7)
                                       
                                          z
                                          (
                                          j
                                          )
                                          =
                                          μ
                                          z
                                          (
                                          j
                                          −
                                          1
                                          )
                                          
                                             (
                                             
                                                1
                                                −
                                                z
                                                (
                                                j
                                                −
                                                1
                                                )
                                             
                                             )
                                          
                                          ,
                                          z
                                          (
                                          j
                                          )
                                          ∈
                                          
                                             [
                                             
                                                0
                                                ,
                                                1
                                             
                                             ]
                                          
                                          ,
                                          μ
                                          ∈
                                          
                                             [
                                             
                                                3.57
                                                ,
                                                4
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 where the initial value 
                                    z
                                    (
                                    0
                                    )
                                  and the parameter 
                                    μ
                                  are the substitution key.

Step 2. The keystream sequence 
                                    k
                                    (
                                    j
                                    )
                                  is generated by
                                    
                                       (8)
                                       
                                          k
                                          (
                                          j
                                          )
                                          =
                                          f
                                          l
                                          o
                                          o
                                          r
                                          
                                             (
                                             
                                                z
                                                (
                                                j
                                                )
                                                ×
                                                
                                                   
                                                      10
                                                   
                                                   
                                                      14
                                                   
                                                
                                             
                                             )
                                          
                                          
                                          mod
                                          
                                          256
                                          ,
                                          
                                          j
                                          =
                                          0
                                          ,
                                          1
                                          ,
                                          2
                                          ,
                                          …
                                          ,
                                          
                                             
                                                N
                                             
                                             2
                                          
                                          −
                                          1
                                          ,
                                       
                                    
                                 where the operation of 
                                    f
                                    l
                                    o
                                    o
                                    r
                                    
                                       (
                                       x
                                       )
                                    
                                  denotes the largest integer not larger than 
                                    x
                                 .

Step 3. Encrypt the pixel values of the image 
                                    P
                                  from left to right, from top to bottom, and generate a cipher-image 
                                    C
                                 . The pixel values 
                                    c
                                    (
                                    j
                                    )
                                  of 
                                    C
                                  and 
                                    p
                                    (
                                    j
                                    )
                                  of 
                                    P
                                  satisfy
                                    
                                       (9)
                                       
                                          c
                                          (
                                          j
                                          )
                                          =
                                          p
                                          (
                                          j
                                          )
                                          ⊕
                                          k
                                          (
                                          j
                                          )
                                          ⊕
                                          c
                                          (
                                          j
                                          −
                                          1
                                          )
                                          ,
                                          
                                          j
                                          =
                                          0
                                          ,
                                          1
                                          ,
                                          …
                                          ,
                                          
                                             
                                                N
                                             
                                             2
                                          
                                          −
                                          1
                                          ,
                                       
                                    
                                 where the symbol 
                                    ⊕
                                  denotes bitwise XOR and 
                                    c
                                    (
                                    −
                                    1
                                    )
                                  is a constant.

In this section, we first present the differential cryptanalysis of the whole cryptosystem. The analysis shows that any cipher-images can be successfully recovered by an equivalent permutation key, when a plain image and its cipher-image are known. Our goal of cryptanalysis is to get the equivalent permutation key. We will present how to obtain it by using differential cryptanalysis at three different encryption rounds: 
                        n
                        =
                        1
                     , 
                        n
                        =
                        2
                      and 
                        n
                        ≥
                        3
                     .

In this subsection, we will analyze the whole cryptosystem by differential cryptanalysis. First, we consider a situation with one-round encryption, i.e., 
                           n
                           =
                           1
                        . Take two plain-images 
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 2
                              
                           
                        , and obtain corresponding cipher-images 
                           
                              
                                 C
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         and 
                           
                              
                                 C
                              
                              
                                 2
                              
                              
                                 (
                                 1
                                 )
                              
                           
                        . According to Eq. (9) we have the following pixel values
                           
                              (10)
                              
                                 
                                    
                                       c
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 =
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 −
                                 1
                                 )
                                 ⊕
                                 …
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 0
                                 )
                                 ⊕
                                 k
                                 (
                                 j
                                 )
                                 ⊕
                                 k
                                 (
                                 j
                                 −
                                 1
                                 )
                                 ⊕
                                 …
                                 ⊕
                                 k
                                 (
                                 0
                                 )
                                 ⊕
                                 c
                                 (
                                 −
                                 1
                                 )
                                 ,
                                 j
                                 =
                                 0
                                 ,
                                 1
                                 ,
                                 …
                                 ,
                                 
                                    
                                       N
                                    
                                    2
                                 
                                 −
                                 1
                                 .
                              
                           
                        
                     

We calculate the differential image 
                           Δ
                           
                              
                                 C
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           =
                           
                              
                                 C
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           ⊕
                           
                              
                                 C
                              
                              
                                 2
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         and its pixel values 
                           Δ
                           
                              
                                 c
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           (
                           j
                           )
                           =
                           
                              
                                 c
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           (
                           j
                           )
                           ⊕
                           
                              
                                 c
                              
                              
                                 2
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           (
                           j
                           )
                        . Inserting Eq. (10) into the equality above yields
                           
                              (11)
                              
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 =
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 −
                                 1
                                 )
                                 ⊕
                                 …
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 0
                                 )
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 −
                                 1
                                 )
                                 ⊕
                                 …
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 0
                                 )
                                 .
                              
                           
                        
                     

We define the permutation operation as the following form 
                           
                              
                                 P
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           =
                           
                              
                                 F
                              
                              
                                 p
                              
                           
                           (
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                           )
                           =
                           
                              
                                 F
                              
                              
                                 p
                                 8
                              
                           
                           (
                           
                              
                                 M
                              
                              
                                 1
                                 −
                                 8
                              
                           
                           )
                           
                              ‖
                              
                                 
                                    
                                       F
                                    
                                    
                                       p
                                       7
                                    
                                 
                                 (
                                 
                                    
                                       M
                                    
                                    
                                       1
                                       −
                                       7
                                    
                                 
                                 )
                                 
                                    ‖
                                    
                                       …
                                       
                                          ‖
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   p
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   M
                                                
                                                
                                                   1
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        , where 
                           
                              
                                 M
                              
                              
                                 1
                                 −
                                 i
                              
                           
                         and 
                           
                              
                                 F
                              
                              
                                 p
                                 i
                              
                           
                           (
                           
                              
                                 M
                              
                              
                                 1
                                 −
                                 i
                              
                           
                           )
                         stand for the 
                           i
                           th
                         bit plane of the image 
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                         and its permutation plane, the symbol 
                           ‖
                         a concatenation of different bit-planes. Define the differential of two permutation-images 
                           
                              
                                 P
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         and 
                           
                              
                                 P
                              
                              
                                 2
                              
                              
                                 (
                                 1
                                 )
                              
                           
                        , 
                           Δ
                           
                              
                                 P
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           =
                           
                              
                                 P
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           ⊕
                           
                              
                                 P
                              
                              
                                 2
                              
                              
                                 (
                                 1
                                 )
                              
                           
                        , so
                           
                              (12)
                              
                                 Δ
                                 
                                    
                                       P
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       F
                                    
                                    
                                       p
                                       8
                                    
                                 
                                 (
                                 Δ
                                 
                                    
                                       M
                                    
                                    
                                       −
                                       8
                                    
                                 
                                 )
                                 
                                    ‖
                                    
                                       
                                          
                                             F
                                          
                                          
                                             p
                                             7
                                          
                                       
                                       (
                                       Δ
                                       
                                          
                                             M
                                          
                                          
                                             −
                                             7
                                          
                                       
                                       )
                                    
                                 
                                 
                                    ‖
                                    
                                       …
                                       
                                          ‖
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   p
                                                   1
                                                
                                             
                                             (
                                             Δ
                                             
                                                
                                                   M
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 ,
                              
                           
                        where 
                           Δ
                           M
                           =
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                           ⊕
                           
                              
                                 M
                              
                              
                                 2
                              
                           
                           =
                           Δ
                           
                              
                                 M
                              
                              
                                 −
                                 8
                              
                           
                           
                              ‖
                              
                                 Δ
                                 
                                    
                                       M
                                    
                                    
                                       −
                                       7
                                    
                                 
                              
                           
                           
                              ‖
                              
                                 …
                                 
                                    ‖
                                    
                                       Δ
                                       
                                          
                                             M
                                          
                                          
                                             −
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        . The pixel values of 
                           Δ
                           
                              
                                 P
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         are written as
                           
                              (13)
                              
                                 
                                    
                                       
                                          
                                             Δ
                                             
                                                
                                                   p
                                                
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                             (
                                             j
                                             )
                                             =
                                             Δ
                                             
                                                
                                                   m
                                                
                                                
                                                   −
                                                   8
                                                
                                             
                                             (
                                             
                                                
                                                   i
                                                
                                                
                                                   8
                                                   ,
                                                   j
                                                
                                             
                                             )
                                             
                                                ‖
                                                
                                                   Δ
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         −
                                                         7
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         i
                                                      
                                                      
                                                         7
                                                         ,
                                                         j
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                ‖
                                                
                                                   …
                                                   
                                                      ‖
                                                      
                                                         Δ
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               −
                                                               1
                                                            
                                                         
                                                         (
                                                         
                                                            
                                                               i
                                                            
                                                            
                                                               1
                                                               ,
                                                               j
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             Δ
                                             
                                                
                                                   p
                                                
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                             (
                                             j
                                             −
                                             1
                                             )
                                             =
                                             Δ
                                             
                                                
                                                   m
                                                
                                                
                                                   −
                                                   8
                                                
                                             
                                             (
                                             
                                                
                                                   i
                                                
                                                
                                                   8
                                                   ,
                                                   j
                                                   −
                                                   1
                                                
                                             
                                             )
                                             
                                                ‖
                                                
                                                   Δ
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         −
                                                         7
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         i
                                                      
                                                      
                                                         7
                                                         ,
                                                         j
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                ‖
                                                
                                                   …
                                                   
                                                      ‖
                                                      
                                                         Δ
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               −
                                                               1
                                                            
                                                         
                                                         (
                                                         
                                                            
                                                               i
                                                            
                                                            
                                                               1
                                                               ,
                                                               j
                                                               −
                                                               1
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             …
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             Δ
                                             
                                                
                                                   p
                                                
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                             (
                                             0
                                             )
                                             =
                                             Δ
                                             
                                                
                                                   m
                                                
                                                
                                                   −
                                                   8
                                                
                                             
                                             (
                                             
                                                
                                                   i
                                                
                                                
                                                   8
                                                   ,
                                                   0
                                                
                                             
                                             )
                                             
                                                ‖
                                                
                                                   Δ
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         −
                                                         7
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         i
                                                      
                                                      
                                                         7
                                                         ,
                                                         0
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                ‖
                                                
                                                   …
                                                   
                                                      ‖
                                                      
                                                         Δ
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               −
                                                               1
                                                            
                                                         
                                                         (
                                                         
                                                            
                                                               i
                                                            
                                                            
                                                               1
                                                               ,
                                                               0
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

From Eq. (13) we can see that the different positions of eight bit-planes map to a same position after bit-plane permutations.

Considered Eqs. (12) and (13), Eq. (11) is converted to the following form:
                           
                              (14)
                              
                                 
                                    
                                       
                                          Δ
                                          
                                             c
                                             
                                                (
                                                1
                                                )
                                             
                                          
                                          (
                                          j
                                          )
                                          =
                                          Δ
                                          
                                             m
                                             
                                                −
                                                8
                                             
                                          
                                          (
                                          
                                             i
                                             
                                                8
                                                ,
                                                j
                                             
                                          
                                          )
                                          ⊕
                                          Δ
                                          
                                             m
                                             
                                                −
                                                8
                                             
                                          
                                          (
                                          
                                             i
                                             
                                                8
                                                ,
                                                j
                                                −
                                                1
                                             
                                          
                                          )
                                          ⊕
                                          …
                                          ⊕
                                          Δ
                                          
                                             m
                                             
                                                −
                                                8
                                             
                                          
                                          (
                                          
                                             i
                                             
                                                8
                                                ,
                                                0
                                             
                                          
                                          )
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          Δ
                                          
                                             m
                                             
                                                −
                                                7
                                             
                                          
                                          (
                                          
                                             i
                                             
                                                7
                                                ,
                                                j
                                             
                                          
                                          )
                                          ⊕
                                          Δ
                                          
                                             m
                                             
                                                −
                                                7
                                             
                                          
                                          (
                                          
                                             i
                                             
                                                7
                                                ,
                                                j
                                                −
                                                1
                                             
                                          
                                          )
                                          ⊕
                                          …
                                          ⊕
                                          Δ
                                          
                                             m
                                             
                                                −
                                                7
                                             
                                          
                                          (
                                          
                                             i
                                             
                                                7
                                                ,
                                                0
                                             
                                          
                                          )
                                          ‖
                                          
                                       
                                    
                                    
                                       
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          …
                                          …
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          
                                          Δ
                                          
                                             m
                                             
                                                −
                                                1
                                             
                                          
                                          (
                                          
                                             i
                                             
                                                1
                                                ,
                                                j
                                             
                                          
                                          )
                                          ⊕
                                          Δ
                                          
                                             m
                                             
                                                −
                                                1
                                             
                                          
                                          (
                                          
                                             i
                                             
                                                1
                                                ,
                                                j
                                                −
                                                1
                                             
                                          
                                          )
                                          ⊕
                                          …
                                          ⊕
                                          Δ
                                          
                                             m
                                             
                                                −
                                                1
                                             
                                          
                                          (
                                          
                                             i
                                             
                                                1
                                                ,
                                                0
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                 
                              
                           
                        
                     

Reshaping Eq. (14), we have
                           
                              (15)
                              
                                 Δ
                                 
                                    C
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 =
                                 Δ
                                 
                                    C
                                    
                                       −
                                       8
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 ‖
                                 Δ
                                 
                                    C
                                    
                                       −
                                       7
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 ‖
                                 …
                                 …
                                 ‖
                                 Δ
                                 
                                    C
                                    
                                       −
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 
                                 =
                                 
                                    g
                                    
                                       p
                                       8
                                    
                                 
                                 (
                                 Δ
                                 
                                    M
                                    
                                       −
                                       8
                                    
                                 
                                 )
                                 ‖
                                 
                                    g
                                    
                                       p
                                       7
                                    
                                 
                                 (
                                 Δ
                                 
                                    M
                                    
                                       −
                                       7
                                    
                                 
                                 )
                                 ‖
                                 …
                                 …
                                 ‖
                                 
                                    g
                                    
                                       p
                                       1
                                    
                                 
                                 (
                                 Δ
                                 
                                    M
                                    
                                       −
                                       1
                                    
                                 
                                 )
                              
                           
                        where the function defined 
                           
                              
                                 g
                              
                              
                                 p
                                 i
                              
                           
                           (
                           ⋅
                           )
                         is an operation related to the permutation of the 
                           i
                           th
                         bit-plane. From Eqs. (14) and (15) we can see the differential cipher-image 
                           Δ
                           
                              
                                 C
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         is completely irrelevant to the keystream sequence 
                           k
                           (
                           j
                           )
                        , and only determined by the differential plain-image 
                           Δ
                           M
                        .

Second, we analyze two-round encryption, i.e., 
                           n
                           =
                           2
                        . We calculate the differential image 
                           Δ
                           
                              
                                 C
                              
                              
                                 (
                                 2
                                 )
                              
                           
                           =
                           
                              
                                 C
                              
                              
                                 1
                              
                              
                                 (
                                 2
                                 )
                              
                           
                           ⊕
                           
                              
                                 C
                              
                              
                                 2
                              
                              
                                 (
                                 2
                                 )
                              
                           
                         and its pixel values 
                           Δ
                           
                              
                                 c
                              
                              
                                 (
                                 2
                                 )
                              
                           
                           (
                           j
                           )
                         by
                           
                              (16)
                              
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 =
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 (
                                 j
                                 −
                                 1
                                 )
                                 ⊕
                                 …
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 (
                                 0
                                 )
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 (
                                 j
                                 −
                                 1
                                 )
                                 ⊕
                                 …
                                 ⊕
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 (
                                 0
                                 )
                                 .
                              
                           
                        
                     

Defining the differential 
                           Δ
                           
                              
                                 P
                              
                              
                                 (
                                 2
                                 )
                              
                           
                           =
                           
                              
                                 P
                              
                              
                                 1
                              
                              
                                 (
                                 2
                                 )
                              
                           
                           ⊕
                           
                              
                                 P
                              
                              
                                 2
                              
                              
                                 (
                                 2
                                 )
                              
                           
                        , from Eq. (12) we have
                           
                              (17)
                              
                                 Δ
                                 
                                    
                                       P
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       F
                                    
                                    
                                       p
                                       8
                                    
                                 
                                 (
                                 Δ
                                 
                                    
                                       C
                                    
                                    
                                       −
                                       8
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 )
                                 
                                    ‖
                                    
                                       
                                          
                                             F
                                          
                                          
                                             p
                                             7
                                          
                                       
                                       (
                                       Δ
                                       
                                          
                                             C
                                          
                                          
                                             −
                                             7
                                          
                                          
                                             (
                                             1
                                             )
                                          
                                       
                                       )
                                    
                                 
                                 
                                    ‖
                                    
                                       …
                                       
                                          ‖
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   p
                                                   1
                                                
                                             
                                             (
                                             Δ
                                             
                                                
                                                   C
                                                
                                                
                                                   −
                                                   1
                                                
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 .
                              
                           
                        
                     

Considering Eqs. (16) and (17), we have the following equation similar to Eq. (14)
                        
                           
                              (18)
                              
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 =
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       −
                                       8
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       8
                                       ,
                                       j
                                    
                                 
                                 )
                                 ⊕
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       −
                                       8
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       8
                                       ,
                                       j
                                       −
                                       1
                                    
                                 
                                 )
                                 ⊕
                                 …
                                 ⊕
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       −
                                       8
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             i
                                          
                                          
                                             8
                                             ,
                                             0
                                          
                                       
                                       )
                                    
                                    ‖
                                 
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       −
                                       7
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       7
                                       ,
                                       j
                                    
                                 
                                 )
                                 ⊕
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       −
                                       7
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       7
                                       ,
                                       j
                                       −
                                       1
                                    
                                 
                                 )
                                 ⊕
                                 …
                                 ⊕
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       −
                                       7
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       7
                                       ,
                                       0
                                    
                                 
                                 )
                                 
                                    ‖
                                    
                                       .....
                                       .
                                    
                                    ‖
                                 
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       −
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       1
                                       ,
                                       j
                                    
                                 
                                 )
                                 ⊕
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       −
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       1
                                       ,
                                       j
                                       −
                                       1
                                    
                                 
                                 )
                                 ⊕
                                 …
                                 ⊕
                                 Δ
                                 
                                    
                                       c
                                    
                                    
                                       −
                                       1
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       1
                                       ,
                                       0
                                    
                                 
                                 )
                              
                           
                        
                     

Same as Eq. (15), we also have
                           
                              (19)
                              
                                 Δ
                                 
                                    
                                       C
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 =
                                 Δ
                                 
                                    
                                       C
                                    
                                    
                                       −
                                       8
                                    
                                    
                                       (
                                       2
                                       )
                                    
                                 
                                 
                                    ‖
                                    
                                       Δ
                                       
                                          
                                             C
                                          
                                          
                                             −
                                             7
                                          
                                          
                                             (
                                             2
                                             )
                                          
                                       
                                       
                                          ‖
                                          
                                             …
                                             …
                                             
                                                ‖
                                                
                                                   Δ
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                      
                                                         (
                                                         2
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       g
                                    
                                    
                                       p
                                       8
                                    
                                 
                                 (
                                 Δ
                                 
                                    
                                       C
                                    
                                    
                                       −
                                       8
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 )
                                 
                                    ‖
                                    
                                       
                                          
                                             g
                                          
                                          
                                             p
                                             7
                                          
                                       
                                       (
                                       Δ
                                       
                                          
                                             C
                                          
                                          
                                             −
                                             7
                                          
                                          
                                             (
                                             1
                                             )
                                          
                                       
                                       )
                                       
                                          ‖
                                          
                                             …
                                             …
                                             
                                                ‖
                                                
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         p
                                                         1
                                                      
                                                   
                                                   (
                                                   Δ
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                      
                                                         (
                                                         1
                                                         )
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       g
                                    
                                    
                                       p
                                       8
                                    
                                 
                                 (
                                 
                                    
                                       g
                                    
                                    
                                       p
                                       8
                                    
                                 
                                 (
                                 Δ
                                 
                                    
                                       M
                                    
                                    
                                       −
                                       8
                                    
                                 
                                 )
                                 )
                                 
                                    ‖
                                    
                                       
                                          
                                             g
                                          
                                          
                                             p
                                             7
                                          
                                       
                                       (
                                       
                                          
                                             g
                                          
                                          
                                             p
                                             7
                                          
                                       
                                       (
                                       Δ
                                       
                                          
                                             M
                                          
                                          
                                             −
                                             7
                                          
                                       
                                       )
                                       )
                                       
                                          ‖
                                          
                                             …
                                             …
                                             
                                                ‖
                                                
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         p
                                                         1
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         p
                                                         1
                                                      
                                                   
                                                   (
                                                   Δ
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       g
                                    
                                    
                                       p
                                       8
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 Δ
                                 
                                    
                                       M
                                    
                                    
                                       −
                                       8
                                    
                                 
                                 )
                                 
                                    ‖
                                    
                                       
                                          
                                             g
                                          
                                          
                                             p
                                             7
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       Δ
                                       
                                          
                                             M
                                          
                                          
                                             −
                                             7
                                          
                                       
                                       )
                                       
                                          ‖
                                          
                                             …
                                             …
                                             
                                                ‖
                                                
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         p
                                                         1
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   (
                                                   Δ
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

From Eq. (19) we can see the differential cipher-image 
                           Δ
                           
                              
                                 C
                              
                              
                                 (
                                 2
                                 )
                              
                           
                         is a result of differential plain-image 
                           Δ
                           M
                        .

Similarly for 
                           n
                           =
                           1
                         and 
                           n
                           =
                           2
                        , the differential cipher-image 
                           Δ
                           
                              
                                 C
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         for n-round encryption is denoted by
                           
                              (20)
                              
                                 Δ
                                 
                                    
                                       C
                                    
                                    
                                       (
                                       n
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       g
                                    
                                    
                                       p
                                       8
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 Δ
                                 
                                    
                                       M
                                    
                                    
                                       −
                                       8
                                    
                                 
                                 )
                                 
                                    ‖
                                    
                                       
                                          
                                             g
                                          
                                          
                                             p
                                             7
                                          
                                          
                                             n
                                          
                                       
                                       (
                                       Δ
                                       
                                          
                                             M
                                          
                                          
                                             −
                                             7
                                          
                                       
                                       )
                                       
                                          ‖
                                          
                                             …
                                             …
                                             
                                                ‖
                                                
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         p
                                                         1
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                   (
                                                   Δ
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

From Eq. (20) we can draw the following three conclusions:
                           
                              (i)
                              Operation on each bit-plane of a differential cipher-image is independent, thus can be analyzed independently even with eight bit-planes.

The differential cipher-image is completely irrelevant to the keystream sequence, which means no correlation between the differential cipher-image and the substitution key. Thus we do not need to consider the substitution key, which make it possible to greatly reduce the key space of the cryptosystem. This is the key point we want to emphasize in our cryptanalysis.

The differential cipher-image is a result of the differential plain-image 
                                    Δ
                                    M
                                  and the operation 
                                    
                                       
                                          g
                                       
                                       
                                          p
                                          i
                                       
                                    
                                    (
                                    ⋅
                                    )
                                 . If 
                                    
                                       
                                          M
                                       
                                       
                                          2
                                       
                                    
                                  is a blank image all pixel values of which are zero, the differential cipher-image is only dependent on 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                  and the permutation key. By choosing special 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 , we may find the permutation key.

Through the conclusion (ii), we know that the differential cipher-image of the cryptosystem only depends on the permutation key instead of on the substitution key. Assuming an attacker knows the permutation key, a plain-image 
                           
                              
                                 M
                              
                              
                                 2
                              
                           
                         and its cipher-image 
                           
                              
                                 C
                              
                              
                                 2
                              
                              
                                 (
                                 n
                                 )
                              
                           
                        , any cipher-image 
                           
                              
                                 C
                              
                              
                                 1
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         can be recovered as the following:
                           
                              Step 1. Calculate the differential 
                                    Δ
                                    
                                       
                                          C
                                       
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          1
                                       
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                    ⊕
                                    
                                       
                                          C
                                       
                                       
                                          2
                                       
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 .

Step 2. Reconstruct 
                                    Δ
                                    
                                       
                                          P
                                       
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                  from 
                                    Δ
                                    
                                       
                                          C
                                       
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 . According to Eq. (9) we have
                                    
                                       (21)
                                       
                                          Δ
                                          
                                             
                                                c
                                             
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                          (
                                          j
                                          )
                                          =
                                          Δ
                                          
                                             
                                                p
                                             
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                          (
                                          j
                                          )
                                          ⊕
                                          Δ
                                          
                                             
                                                c
                                             
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                          (
                                          j
                                          −
                                          1
                                          )
                                          ,
                                          
                                          j
                                          =
                                          0
                                          ,
                                          1
                                          ,
                                          …
                                          ,
                                          
                                             
                                                N
                                             
                                             2
                                          
                                          −
                                          1
                                       
                                    
                                 and it leads to
                                    
                                       (22)
                                       
                                          Δ
                                          
                                             
                                                p
                                             
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                          (
                                          j
                                          )
                                          =
                                          Δ
                                          
                                             
                                                c
                                             
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                          (
                                          j
                                          )
                                          ⊕
                                          Δ
                                          
                                             
                                                c
                                             
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                          (
                                          j
                                          −
                                          1
                                          )
                                          ,
                                          
                                          j
                                          =
                                          0
                                          ,
                                          1
                                          ,
                                          …
                                          ,
                                          
                                             
                                                N
                                             
                                             2
                                          
                                          −
                                          1
                                          .
                                       
                                    
                                 
                              

Reshape the sequence 
                                    Δ
                                    
                                       
                                          p
                                       
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                    (
                                    j
                                    )
                                  and obtain 
                                    Δ
                                    
                                       
                                          P
                                       
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 .

Step 3. Compute 
                                    Δ
                                    
                                       
                                          C
                                       
                                       
                                          (
                                          n
                                          −
                                          1
                                          )
                                       
                                    
                                  by the inverse permutation of Eq. (2) with the permutation key or its equivalent key.

Step 4. Repeat the steps 2 and 3 
                                    n
                                  time and get the final differential image 
                                    Δ
                                    M
                                 . Since the differential 
                                    Δ
                                    M
                                    =
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                    ⊕
                                    
                                       
                                          M
                                       
                                       
                                          2
                                       
                                    
                                 , the original plain-image can be recovered as the form 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    Δ
                                    M
                                    ⊕
                                    
                                       
                                          M
                                       
                                       
                                          2
                                       
                                    
                                 .

Throughout the analysis above, we can conclude that once the permutation key or its equivalent key is obtained, the cryptosystem is fully broken. In Section 5, we will give a simulation result. Our next focus is how to obtain the equivalent permutation key at different round encryption.

First choose two plain-images 
                           
                              
                                 M
                              
                              
                                 0
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                        , 
                           Δ
                           M
                           =
                           
                              
                                 M
                              
                              
                                 0
                              
                           
                           ⊕
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                        , obtain the corresponding cipher-images 
                           
                              
                                 C
                              
                              
                                 0
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         and 
                           
                              
                                 C
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                        , and their differential image 
                           Δ
                           
                              
                                 C
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           =
                           
                              
                                 C
                              
                              
                                 0
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           ⊕
                           
                              
                                 C
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                        . We restructure the differential permutation image 
                           Δ
                           
                              
                                 P
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           =
                           
                              
                                 P
                              
                              
                                 0
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           ⊕
                           
                              
                                 P
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         through Eq. (22). Comparing 
                           Δ
                           
                              
                                 P
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         and 
                           Δ
                           M
                        , we will find the possible permutation relationship of Eq. (2).

Here, we give an example, 
                           
                              
                                 M
                              
                              
                                 0
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                         are two special images. 
                           
                              
                                 M
                              
                              
                                 0
                              
                           
                         is a blank image and 
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                         a blank image with only one nonzero pixel 
                           
                              
                                 m
                              
                              
                                 1
                              
                           
                           (
                           0
                           ,
                           1
                           )
                           =
                           1
                         such that we only focus on the lowest bit-plane. Obviously, there is only a nonzero pixel in 
                           Δ
                           
                              
                                 P
                              
                              
                                 (
                                 1
                                 )
                              
                           
                        , which can be computed through 
                           Δ
                           
                              
                                 C
                              
                              
                                 (
                                 1
                                 )
                              
                           
                        . Assuming that the nonzero pixel 
                           Δ
                           
                              
                                 p
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           (
                           l
                           )
                           =
                           Δ
                           
                              
                                 p
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           )
                        , 
                           l
                           =
                           
                              
                                 x
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           ×
                           N
                           +
                           
                              
                                 y
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                        , we establish one mapping relationship of Eq. (2), i.e., from 
                           (
                           0
                           ,
                           1
                           )
                         to 
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           )
                        . We solve Eq. (2), and obtain 
                           
                              
                                 b
                              
                              
                                 0
                              
                           
                           =
                           
                              
                                 x
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 d
                              
                              
                                 0
                              
                           
                           =
                           
                              
                                 y
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                        . If we take another blank plain-image 
                           
                              
                                 M
                              
                              
                                 2
                              
                           
                         with one nonzero pixel 
                           
                              
                                 m
                              
                              
                                 2
                              
                           
                           (
                           1
                           ,
                           0
                           )
                           =
                           1
                        , we have 
                           Δ
                           
                              
                                 p
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                           )
                           =
                           1
                        , so 
                           
                              
                                 a
                              
                              
                                 0
                              
                           
                           =
                           
                              
                                 x
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                        , 
                           
                              
                                 c
                              
                              
                                 0
                              
                           
                           =
                           
                              
                                 y
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                        .

To obtain the permutation parameters of all bit-planes, we may choose special nonzero pixel values, 
                           
                              
                                 m
                              
                              
                                 1
                              
                           
                           (
                           0
                           ,
                           1
                           )
                           =
                           
                              
                                 2
                              
                              i
                           
                        , 
                           
                              
                                 m
                              
                              
                                 2
                              
                           
                           (
                           1
                           ,
                           0
                           )
                           =
                           
                              
                                 2
                              
                              i
                           
                        , 
                           i
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           7
                        . Using the differential analysis above, we further get the other bit-plane permutation parameters 
                           
                              
                                 a
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 c
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 d
                              
                              
                                 i
                              
                           
                        . To extract all the permutation parameters, we need only 17 trials (17 chosen plain-images) and that will be less time consuming.

In this case, we adopt two-way differential comparison, forward differential and backward differential analysis, to obtain the equivalent permutation key.

We take two special plain-images, a blank image 
                           
                              
                                 M
                              
                              
                                 0
                              
                           
                         and a blank image 
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                        with one nonzero pixel 
                           
                              
                                 m
                              
                              
                                 1
                              
                           
                           (
                           0
                           ,
                           1
                           )
                           =
                           1
                        , and obtain their cipher-images 
                           
                              
                                 C
                              
                              
                                 0
                              
                              
                                 (
                                 2
                                 )
                              
                           
                         and 
                           
                              
                                 C
                              
                              
                                 1
                              
                              
                                 (
                                 2
                                 )
                              
                           
                        , respectively. Then we construct the backward differential image 
                           Δ
                           
                              
                                 P
                              
                              
                                 (
                                 2
                                 )
                              
                           
                         from Eq. (22).

From Eq. (9) we calculate the forward differentials 
                           Δ
                           
                              
                                 c
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           (
                           j
                           )
                           =
                           
                              
                                 c
                              
                              
                                 0
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           (
                           j
                           )
                           ⊕
                           
                              
                                 c
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           (
                           j
                           )
                         by
                           
                              (23)
                              
                                 Δ
                                 
                                    c
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 =
                                 
                                    p
                                    0
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 0
                                 )
                                 ⊕
                                 
                                    p
                                    1
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 0
                                 )
                                 ⊕
                                 
                                    p
                                    0
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 1
                                 )
                                 ⊕
                                 
                                    p
                                    1
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 1
                                 )
                                 ⊕
                                 …
                                 ⊕
                                 
                                 
                                    p
                                    0
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 ⊕
                                 
                                    p
                                    1
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 j
                                 )
                                 .
                              
                           
                        
                     

Due to chosen 
                           
                              
                                 M
                              
                              
                                 0
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                        , note that the permutation images 
                           
                              
                                 P
                              
                              
                                 0
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         and 
                           
                              
                                 P
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         are a blank image and a blank image with one nonzero pixel, respectively. Assume that the nonzero pixel of 
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                         is mapped to 
                           
                              
                                 p
                              
                              
                                 1
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           )
                        , 
                           l
                           =
                           N
                           ×
                           
                              
                                 x
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           +
                           
                              
                                 y
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                        , where 
                           l
                           =
                           0
                           ,
                           1
                           ,
                           ..
                           .
                           ,
                           
                              
                                 N
                              
                              2
                           
                           −
                           1
                        . From Eq. (23) we conclude that the differential sequence is
                           
                              (24)
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                Δ
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      (
                                                      1
                                                      )
                                                   
                                                
                                                (
                                                j
                                                )
                                                =
                                                0
                                                ,
                                             
                                          
                                          
                                             
                                                j
                                                =
                                                0
                                                ,
                                                1
                                                ,
                                                …
                                                ,
                                                l
                                                −
                                                1
                                                ,
                                             
                                          
                                       
                                       
                                          
                                             
                                                Δ
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      (
                                                      1
                                                      )
                                                   
                                                
                                                (
                                                j
                                                )
                                                =
                                                1
                                                ,
                                             
                                          
                                          
                                             
                                                j
                                                =
                                                l
                                                ,
                                                l
                                                +
                                                1
                                                ,
                                                …
                                                ,
                                                
                                                   
                                                      N
                                                   
                                                   2
                                                
                                                −
                                                1
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Since the permutation operation of the cat map does not change the number of the pixel value differential “0” in 
                           Δ
                           
                              
                                 P
                              
                              
                                 (
                                 2
                                 )
                              
                           
                         and 
                           Δ
                           
                              
                                 C
                              
                              
                                 (
                                 1
                                 )
                              
                           
                        , we obtain the number 
                           l
                         from 
                           Δ
                           
                              
                                 P
                              
                              
                                 (
                                 2
                                 )
                              
                           
                        , and further the position
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           )
                         by the equality 
                           l
                           =
                           N
                           ×
                           
                              
                                 x
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           +
                           
                              
                                 y
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                        . Finally we establish one mapping relationship from 
                           (
                           1
                           ,
                           0
                           )
                         to 
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                           )
                         in Eq. (2). By choosing another plain-image 
                           
                              
                                 M
                              
                              
                                 2
                              
                           
                         with one nonzero pixel 
                           
                              
                                 m
                              
                              
                                 2
                              
                           
                           (
                           1
                           ,
                           0
                           )
                           =
                           1
                         and by obtaining the corresponding equality 
                           l
                           ′
                           =
                           N
                           ×
                           
                              
                                 x
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                           +
                           
                              
                                 y
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                        , we have another mapping relationship from 
                           (
                           1
                           ,
                           0
                           )
                         to 
                           (
                           
                              
                                 x
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                           )
                        . According to the two mapping relationships above, we extract four parameters 
                           
                              
                                 a
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 b
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 c
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 d
                              
                              
                                 0
                              
                           
                        . As the same in Section 4.2, we use 17 chosen plain-images to get all permutation parameters.

If the encryption rounds 
                           n
                           ≥
                           3
                        , the differential cryptanalyses in Sections 4.2 and 4.3 are useless. Therefore, we propose an analysis method called double differential cryptanalysis comparison (DDCC). To facilitate the following analysis, we define two sets of special plain images 
                           
                              
                                 M
                              
                              
                                 α
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 β
                              
                           
                        , each of which has 
                           
                              
                                 N
                              
                              2
                           
                         images. 
                           
                              
                                 M
                              
                              
                                 α
                              
                           
                           =
                           {
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 0
                              
                           
                           ,
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 
                                    
                                       N
                                    
                                    2
                                 
                                 −
                                 1
                              
                           
                           }
                        , 
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 0
                              
                           
                           =
                           (
                           1
                           ,
                           0
                           ,
                           0
                           ,
                           …
                           ,
                           0
                           )
                        , 
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 1
                              
                           
                           =
                           (
                           0
                           ,
                           1
                           ,
                           0
                           ,
                           0
                           ,
                           …
                           ,
                           0
                           )
                        ,…, 
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 
                                    
                                       N
                                    
                                    2
                                 
                                 −
                                 1
                              
                           
                           =
                           (
                           0
                           ,
                           0
                           ,
                           …
                           ,
                           0
                           ,
                           1
                           )
                        .
                           
                              
                                 M
                              
                              
                                 β
                              
                           
                           =
                           {
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 0
                              
                           
                           ,
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 
                                    
                                       N
                                    
                                    2
                                 
                                 −
                                 1
                              
                           
                           }
                        , 
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 0
                              
                           
                           =
                           (
                           1
                           ,
                           1
                           ,
                           …
                           ,
                           1
                           )
                        , 
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 1
                              
                           
                           =
                           (
                           0
                           ,
                           1
                           ,
                           1
                           ,
                           …
                           ,
                           1
                           )
                        , 
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 2
                              
                           
                           =
                           (
                           0
                           ,
                           0
                           ,
                           1
                           ,
                           1
                           ,
                           …
                           ,
                           1
                           )
                        , …, 
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 
                                    
                                       N
                                    
                                    2
                                 
                                 −
                                 1
                              
                           
                           =
                           (
                           0
                           ,
                           0
                           ,
                           …
                           0
                           ,
                           1
                           )
                        . Define a blank image 
                           
                              
                                 M
                              
                              
                                 0
                              
                           
                        . After 1-round encryption, the corresponding cipher-images for the two plain-images 
                           
                              
                                 M
                              
                              
                                 0
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                         are 
                           
                              
                                 C
                              
                              
                                 0
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         and 
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 1
                                 )
                              
                           
                        , 
                           0
                           ≤
                           i
                           ≤
                           
                              N
                              2
                           
                           -
                           1
                           .
                        
                     

Using the forward differential analysis of Eq. (23), we compute 
                           Δ
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           =
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 1
                                 )
                              
                           
                           ⊕
                           
                              
                                 C
                              
                              
                                 0
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         and it leads to
                           
                              (25)
                              
                                 Δ
                                 
                                    
                                       C
                                    
                                    
                                       α
                                       ,
                                       i
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       M
                                    
                                    
                                       β
                                       ,
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       M
                                    
                                    
                                       β
                                       ,
                                       j
                                    
                                 
                                 ⊕
                                 
                                    
                                       M
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 Δ
                                 
                                    
                                       M
                                    
                                    
                                       β
                                       ,
                                       j
                                    
                                 
                                 ,
                                 
                                 0
                                 ≤
                                 i
                                 ,
                                 j
                                 ≤
                                 
                                    
                                       N
                                    
                                    2
                                 
                                 −
                                 1
                                 .
                              
                           
                        
                     

Note that 
                           Δ
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 1
                                 )
                              
                           
                         must be equal to one of 
                           Δ
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                        , 
                           j
                           ∈
                           [
                           0
                           ,
                           
                              
                                 N
                              
                              2
                           
                           −
                           1
                           ]
                        , and this is a basis for the DDCC method to be used. If knowing the indexes 
                           i
                         and 
                           j
                         in Eq. (25), similar to the analysis of Section 4.3 we would establish one mapping relationship of Eq. (2). However, the problem is that the relationship between 
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                         is uncertain. To find the relationships, the characteristics of corresponding available cipher-images differentials would be analyzed.

Here, we use DDCC method to extract the fixed relationships of 
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                        . First we compute two cipher-image differential sets. Taking 
                           
                              
                                 M
                              
                              
                                 0
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                        , we calculate 
                           n
                           -
                           r
                           o
                           u
                           n
                           d
                         cipher-image differentials 
                           Δ
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 n
                                 )
                              
                           
                           =
                           
                              
                                 C
                              
                              
                                 0
                              
                              
                                 (
                                 n
                                 )
                              
                           
                           ⊕
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 n
                                 )
                              
                           
                        , 
                           i
                           =
                           0
                           ,
                           1
                           ,
                           ..
                           .
                           ,
                           
                              
                                 N
                              
                              2
                           
                           −
                           1
                        . Similarly, 
                           Δ
                           
                              
                                 C
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                           =
                           
                              
                                 C
                              
                              
                                 0
                              
                              
                                 (
                                 n
                                 )
                              
                           
                           ⊕
                           
                              
                                 C
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         for 
                           
                              
                                 M
                              
                              
                                 0
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 i
                              
                           
                        , 
                           j
                           =
                           0
                           ,
                           1
                           ,
                           ..
                           .
                           ,
                           
                              
                                 N
                              
                              2
                           
                           −
                           1
                           .
                         Due to Eq. (25) and unchanged permutation and substitution keys, the differentials 
                           Δ
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 t
                                 )
                              
                           
                           =
                           Δ
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 t
                                 )
                              
                           
                           ⊕
                           Δ
                           
                              
                                 C
                              
                              
                                 0
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         and 
                           Δ
                           
                              
                                 C
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 t
                                 )
                              
                           
                           =
                           Δ
                           
                              
                                 C
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 t
                                 )
                              
                           
                           ⊕
                           Δ
                           
                              
                                 C
                              
                              
                                 0
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         have the following relationships
                           
                              (26)
                              
                                 
                                    
                                       
                                          
                                             Δ
                                             
                                                
                                                   C
                                                
                                                
                                                   α
                                                   ,
                                                   i
                                                
                                                
                                                   (
                                                   2
                                                   )
                                                
                                             
                                             ≜
                                             Δ
                                             
                                                
                                                   C
                                                
                                                
                                                   β
                                                   ,
                                                   j
                                                
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             Δ
                                             
                                                
                                                   C
                                                
                                                
                                                   α
                                                   ,
                                                   i
                                                
                                                
                                                   (
                                                   3
                                                   )
                                                
                                             
                                             ≜
                                             Δ
                                             
                                                
                                                   C
                                                
                                                
                                                   β
                                                   ,
                                                   j
                                                
                                                
                                                   (
                                                   2
                                                   )
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             ..
                                             .
                                          
                                       
                                    
                                    
                                       
                                          
                                             Δ
                                             
                                                
                                                   C
                                                
                                                
                                                   α
                                                   ,
                                                   i
                                                
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                             ≜
                                             Δ
                                             
                                                
                                                   C
                                                
                                                
                                                   β
                                                   ,
                                                   j
                                                
                                                
                                                   (
                                                   n
                                                   −
                                                   1
                                                   )
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where the symbol 
                           ≜
                         denotes completely equivalent relationship. We can obtain the differential 
                           Δ
                           
                              
                                 C
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 -
                                 1
                                 )
                              
                           
                         from 
                           Δ
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         through Eq. (26) and the differential 
                           Δ
                           
                              
                                 P
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         from 
                           Δ
                           
                              
                                 C
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         by Eq. (22). In addition, since the permutation process from 
                           Δ
                           
                              
                                 C
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 -
                                 1
                                 )
                              
                           
                         to 
                           Δ
                           
                              
                                 P
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         does not change the numbers of differentials “0” and “1”, we may detect the permutation relationship of Eq. (2). Next we will give the detailed steps.

First, construct the differentials 
                           Δ
                           
                              
                                 P
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         from 
                           Δ
                           
                              
                                 C
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         
                        
                           i
                           =
                           0
                           ,
                           1
                           .
                           ,
                           …
                           ,
                           
                              
                                 N
                              
                              2
                           
                           −
                           1
                        . Second, compare the differentials 
                           Δ
                           
                              
                                 P
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         to 
                           Δ
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 n
                                 )
                              
                           
                        , and then classify 
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                         from 
                           Δ
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                         from 
                           Δ
                           
                              
                                 P
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                        . Let 
                           
                              
                                 l
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                         and 
                           
                              
                                 l
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                         stand for the numbers of the pixel differentials “0” in
                           Δ
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         and 
                           Δ
                           
                              
                                 P
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                        , respectively. 
                           
                              
                                 L
                              
                              
                                 α
                              
                           
                           =
                           {
                           
                              
                                 l
                              
                              
                                 α
                                 ,
                                 0
                              
                           
                           ,
                           
                              
                                 l
                              
                              
                                 α
                                 ,
                                 1
                              
                           
                           ,
                           
                              
                                 l
                              
                              
                                 α
                                 ,
                                 2
                              
                           
                           ,
                           …
                           }
                        , 
                           
                              
                                 L
                              
                              
                                 β
                              
                           
                           =
                           {
                           
                              
                                 l
                              
                              
                                 β
                                 ,
                                 0
                              
                           
                           ,
                           
                              
                                 l
                              
                              
                                 β
                                 ,
                                 1
                              
                           
                           ,
                           
                              
                                 l
                              
                              
                                 β
                                 ,
                                 2
                              
                           
                           ,
                           …
                           }
                        , where 
                           0
                           ≤
                           
                              
                                 l
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                           ,
                           
                              
                                 l
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                           ≤
                           
                              
                                 N
                              
                              2
                           
                           −
                           1
                        . 
                           
                              
                                 L
                              
                              
                                 α
                              
                           
                           ≡
                           
                              
                                 L
                              
                              
                                 β
                              
                           
                           .
                         Since the numbers of the pixel differential value “0” in 
                           Δ
                           
                              
                                 C
                              
                              
                                 α
                                 ,
                                 i
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         and 
                           Δ
                           
                              
                                 P
                              
                              
                                 β
                                 ,
                                 j
                              
                              
                                 (
                                 n
                                 )
                              
                           
                         remain unchanged, if 
                           
                              
                                 l
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                           =
                           
                              
                                 l
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                         and they are unique in the sets of 
                           
                              
                                 L
                              
                              
                                 α
                              
                           
                         and 
                           
                              
                                 L
                              
                              
                                 β
                              
                           
                        , a one-to-one relationship between 
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                         is established. Third, based on 
                           
                              
                                 M
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                         and
                           
                              
                                 M
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                         above and Eq. (24), one mapping relationship of Eq. (2) is found. Usually we can find several pairs of 
                           
                              
                                 l
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                         and 
                           
                              
                                 l
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                         such that 
                           
                              
                                 l
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                           =
                           
                              
                                 l
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                         are unique in the sets of 
                           
                              
                                 L
                              
                              
                                 α
                              
                           
                         and 
                           
                              
                                 L
                              
                              
                                 β
                              
                           
                        . After having enough one-to-one pairs of 
                           
                              
                                 l
                              
                              
                                 α
                                 ,
                                 i
                              
                           
                         and 
                           
                              
                                 l
                              
                              
                                 β
                                 ,
                                 j
                              
                           
                        , we will extract all the parameters 
                           
                              
                                 a
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 b
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 c
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 d
                              
                              
                                 0
                              
                           
                        . In Section 5, simulation examples will be given.

In the sets of 
                           
                              
                                 M
                              
                              
                                 α
                              
                           
                         and 
                           
                              
                                 M
                              
                              
                                 β
                              
                           
                        , if we change the nonzero pixel values from 1 to 
                           
                              
                                 2
                              
                              i
                           
                        , 
                           i
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           7
                        , using DDCC we can extract the secret permutation parameters of the ith independent bit-plane, i.e., 
                           
                              
                                 a
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 c
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 d
                              
                              
                                 i
                              
                           
                        . This double differential analysis need 
                           16
                           
                              
                                 N
                              
                              2
                           
                           +
                           1
                         image trials, usually smaller than that of brute force attack 
                           
                              
                                 N
                              
                              
                                 16
                              
                           
                        . If 
                           N
                           =
                           512
                        , the difficulty of DDCC is 
                           
                              
                                 2
                              
                              
                                 22
                              
                           
                           +
                           1
                        , much less than that of brute force attack 
                           
                              
                                 2
                              
                              
                                 144
                              
                           
                        .

In this section, first we will simulate how to find the equivalent permutation key of Eq. (2) by DDCC method. Second, we will present how a cipher-image can be recovered if we know the equivalent permutation key.

The parameters of the original cryptosystem serve as
                        
                           (27)
                           
                              n
                              =
                              20
                              ,
                              
                              m
                              =
                              13
                              ,
                              
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              =
                              11
                              ,
                              
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                              =
                              59
                              ,
                              
                              μ
                              =
                              3.97986509862838
                              ,
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              =
                              0.64246417998982
                              .
                           
                        
                     
                  

Choosing 
                        128
                        ×
                        128
                      images, we will test 
                        
                           
                              2
                           
                           
                              15
                           
                        
                        +
                        1
                      images to extract the equivalent permutation key of the lowest bit-plane. Adopting the parameters of Eqs. (27) and (2) leads to
                        
                           (28)
                           
                              
                                 
                                    [
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                
                                                   11
                                                
                                             
                                          
                                          
                                             
                                                
                                                   59
                                                
                                             
                                             
                                                
                                                   650
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    13
                                 
                              
                              
                              mod
                              
                              128
                              =
                              
                                 [
                                 
                                    
                                       
                                          
                                             
                                                113
                                             
                                          
                                          
                                             
                                                123
                                             
                                          
                                       
                                       
                                          
                                             
                                                43
                                             
                                          
                                          
                                             
                                                74
                                             
                                          
                                       
                                    
                                 
                                 ]
                              
                           
                        
                     
                  

After 
                        
                           
                              2
                           
                           
                              15
                           
                        
                        +
                        1
                      plain-mages, i.e., 
                        
                           
                              2
                           
                           
                              14
                           
                        
                      
                     
                        
                           
                              M
                           
                           
                              α
                              ,
                              i
                           
                        
                     , 
                        
                           
                              2
                           
                           
                              14
                           
                        
                      
                     
                        
                           
                              M
                           
                           
                              β
                              ,
                              i
                           
                        
                      and 
                        
                           
                              M
                           
                           
                              0
                           
                        
                     , utilizing DDCC method we can find 50 one-to-one relationships between 
                        
                           
                              M
                           
                           
                              α
                              ,
                              i
                           
                        
                      and 
                        
                           
                              M
                           
                           
                              β
                              ,
                              i
                           
                        
                     , as shown in 
                     Table 1. We take two pairs of them and have the following mapping relationship, from 
                        (
                        
                           79
                           ,
                           68
                        
                        )
                      of 
                        
                           
                              M
                           
                           
                              α
                              ,
                              10180
                           
                        
                      to 
                        (
                        
                           11
                           ,
                           109
                        
                        )
                      of 
                        
                           
                              M
                           
                           
                              β
                              ,
                              1517
                           
                        
                     , from 
                        (
                        
                           5
                           ,
                           113
                        
                        )
                      of 
                        
                           
                              M
                           
                           
                              α
                              ,
                              753
                           
                        
                      to 
                        (
                        
                           0
                           ,
                           1
                        
                        )
                      of 
                        
                           
                              M
                           
                           
                              β
                              ,
                              1
                           
                        
                     . By Property 3 of Section 2, we know that the parameter 
                        
                           
                              a
                           
                           
                              0
                           
                        
                      has 
                        gcd
                        
                           (
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    2
                                 
                              
                              −
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    1
                                 
                              
                              )
                              ,
                              N
                           
                           )
                        
                      solutions. As 
                        gcd
                        
                           (
                           
                              (
                              79
                              ×
                              113
                              −
                              5
                              ×
                              68
                              )
                              ,
                              128
                           
                           )
                        
                        =
                        1
                     , only one unique solution exists and it is
                        
                           (29)
                           
                              
                                 
                                    a
                                 
                                 
                                    0
                                 
                              
                              ≡
                              
                                 
                                    (
                                    
                                       79
                                       ×
                                       113
                                       −
                                       5
                                       ×
                                       68
                                    
                                    )
                                 
                                 
                                    63
                                 
                              
                              ×
                              
                                 (
                                 
                                    11
                                    ×
                                    113
                                    −
                                    5
                                    ×
                                    68
                                 
                                 )
                              
                              
                              mod
                              
                              128
                              =
                              113
                              .
                           
                        
                     
                  

Adopting the mapping relationship above, we recover four parameters of Eq. (2), 
                        
                           
                              a
                           
                           
                              0
                           
                        
                        =
                        113
                     , 
                        
                           
                              b
                           
                           
                              0
                           
                        
                        =
                        123
                     , 
                        
                           
                              c
                           
                           
                              0
                           
                        
                        =
                        43
                      and 
                        
                           
                              d
                           
                           
                              0
                           
                        
                        =
                        74
                     , which coincide with formula (28).

To show the generality of the simulation above, we repeated the experiments for other different parameters. 
                     Table 2 lists the number of one-to-one mapping relationship between 
                        
                           
                              M
                           
                           
                              α
                              ,
                              i
                           
                        
                      and 
                        
                           
                              M
                           
                           
                              β
                              ,
                              j
                           
                        
                      for different parameters 
                        
                           
                              p
                           
                           
                              0
                           
                        
                     , 
                        
                           
                              q
                           
                           
                              0
                           
                        
                     , 
                        n
                      and 
                        m
                     . The simulation results show that our DDCC method is effective.

Next, we will present how a cipher-image can be recovered if we know the equivalent permutation key, one plain-image and its cipher-image. Use the same parameters of Eq. (27) for all bit-planes for simplicity. Two plain-images 
                        
                           
                              M
                           
                           
                              1
                           
                        
                      and 
                        
                           
                              M
                           
                           
                              2
                           
                        
                     , and the corresponding cipher-image 
                        
                           
                              C
                           
                           
                              1
                           
                           
                              (
                              20
                              )
                           
                        
                      and 
                        
                           
                              C
                           
                           
                              2
                           
                           
                              (
                              20
                              )
                           
                        
                      are shown in 
                     Fig. 2 (a), (b), (c) and (d), respectively, where 
                        
                           
                              M
                           
                           
                              1
                           
                        
                      is unknown and 
                        
                           
                              M
                           
                           
                              2
                           
                        
                      known. First, compute the cipher-image differential 
                        Δ
                        
                           
                              C
                           
                           
                              (
                              20
                              )
                           
                        
                        =
                        
                           
                              C
                           
                           
                              1
                           
                           
                              (
                              20
                              )
                           
                        
                        ⊕
                        
                           
                              C
                           
                           
                              2
                           
                           
                              (
                              20
                              )
                           
                        
                     , as shown in Fig. 2 (e). Restructure 
                        Δ
                        
                           
                              P
                           
                           
                              (
                              20
                              )
                           
                        
                      from 
                        Δ
                        
                           
                              C
                           
                           
                              (
                              20
                              )
                           
                        
                      by Eq. (22), and then determine 
                        Δ
                        
                           
                              C
                           
                           
                              (
                              19
                              )
                           
                        
                      by the inverse permutation of Eq. (2) with the recovered parameters Eq. (28). Similarly repeating the process above 20 times, we finally obtain the differential plain-image 
                        Δ
                        M
                        =
                        
                           
                              M
                           
                           
                              1
                           
                        
                        ⊕
                        
                           
                              M
                           
                           
                              2
                           
                        
                      from 
                        Δ
                        
                           
                              P
                           
                           
                              (
                              1
                              )
                           
                        
                      by the inverse permutation of Eq. (2), as shown in Fig. 2(f). Known 
                        
                           
                              M
                           
                           
                              2
                           
                        
                     , the cipher-image 
                        
                           
                              C
                           
                           
                              1
                           
                           
                              (
                              20
                              )
                           
                        
                      is correctly recovered, as shown in Fig. 2(g).

According to the design principle of confusion and diffusion for encryption algorithms, a bit-level cat map shuffling algorithm proposed by Fu et al. can achieve good confusion effect, compared to a pixel-level cat map shuffling algorithm. However, Fu׳s cryptosystem cannot resist against differential cryptanalysis, and the weaknesses of the scheme are as follows. (i) In the permutation process, the bit-level shuffling of 8-bit planes is independent, which does not achieve good confusion effect between bit-planes. (ii) The diffusion effect of the algorithm mainly depends on the substitution process, and previous cipher-pixel only affects subsequent cipher-pixels through Eq. (9). Utilizing Eq. (9), it is easy to get the differential permutation-image of the last encryption round through the differential cryptanalysis of Eqs. (10)–(12). (iii) The algorithm uses same secret key in each round, including the permutation and the substitution keys. Unchanged round-key leads to similar diffusion and confusion effect. (iv) The diffusion rule of Eq. (9) in substitution process is quite vulnerable to differential cryptanalysis, as differential cipher-images eliminate the keystream component. This problem makes the key space of the cryptosystem greatly reduced.

In addition, the authors do not consider that the cat map of Eq. (2) has the following adverse features. The pixel point (0, 0) always maps to itself, which is bad for confusion effect. The iteration number of the cat map has periodicity, thus it is necessary to choose an appropriate iteration. The cycle length is related to the image size and the parameters 
                        p
                      and 
                        q
                     . In 
                     Table 3, we list some cycle lengths for different image sizes.

@&#CONCLUSION@&#

In this paper, we analyze the security of a medical image encryption scheme with permutation–substitution type. We demonstrate that the original cryptosystem is vulnerable against the differential attack, and the differential cryptanalysis shows that the security of the original scheme only depends on permutation key instead of on all of the keys, thus the key space is greatly reduced. Adopting 17 chosen plain-images can break 1-round and 2-round encryption system and all the secret permutation parameters can be revealed by differential cryptanalysis. More importantly, we choose two special plain-image sets and propose the DDCC method that extracts the equivalent permutation key with 
                        16
                        
                           
                              N
                           
                           2
                        
                        +
                        1
                      plain-images, where 
                        
                           
                              N
                           
                           2
                        
                      is the size of images. Simulation results confirm the effectiveness of the DDCC method for breaking multi-round encryption and show that any cipher-image can be recovered by the equivalent permutation key when a plain image and its cipher-image are known. Finally we summarize the security vulnerabilities of the cryptosystem. A secure cryptosystem not only has good statistical properties, such as histogram, information entropy and correlation of adjacent pixels, but also resists all kinds of attacks.

The authors declared that they have no conflicts of interest in this work.

@&#REFERENCES@&#

