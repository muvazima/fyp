@&#MAIN-TITLE@&#Local histogram specification for face recognition under varying lighting conditions

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We improve the TT preprocessing method using local histogram specification.


                        
                        
                           
                           Our methods can remove both the low and high frequency illuminations on face images.


                        
                        
                           
                           Our methods can enhance face features lying in the low frequency part of face images.


                        
                        
                           
                           We report the recognition rate of 81.6% on the CAS-PEAL-R1 database.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Local histogram specification

Local histogram statistics

Face recognition

High frequency illumination

Low frequency face features

@&#ABSTRACT@&#


               
               
                  High frequency illumination and low frequency face features bring difficulties for most of the state-of-the-art face image preprocessors. In this paper, we propose two methods based on Local Histogram Specification (LHS) to preprocess face images under varying lighting conditions. The proposed methods are able to significantly remove both the low and high frequency parts of illumination on face images, as well as enhance face features lying in the low frequency part. Specifically, we first apply a high-pass filter on a face image to filter the low frequency illumination. Then, local histograms and local histogram statistics are learned from normal lighting images. In our first method, LHS is applied on the entire image. By contrast, in the second method, the regions contain high frequency illumination and weak face features on a face image are identified by local histogram statistics, before LHS is applied on these regions to eliminate high frequency illumination and enhance weak face features. Experimental results on the CMU PIE, Extended Yale B and CAS-PEAL-R1 databases demonstrate the effectiveness and efficiency of our methods.
               
            

@&#INTRODUCTION@&#

Face recognition is one of the most popular issues in the area of pattern recognition, computer vision, etc. Making face images robust to illumination variations is one of the most challenging and crucial problems in the field of face recognition, and it has been proven that the variation caused by illumination is more significant than the intrinsic face features among individuals [1]. To address this problem, many approaches against varying lighting conditions have been proposed for face recognition during the past few decades. These methods can be briefly divided into three categories: appearance-based ones, normalization-based ones and illumination-insensitive extraction based ones.

The appearance-based ones aim to represent the original images in a subspace that is robust to illumination variations, such as dimensionality reduction (DR) methods: eigenfaces [2], fisherfaces [3], laplacianfaces [4], etc. However, these methods are general DR methods, and are not specific tactics to tackle illumination variations. To analyze illumination variations, Belhumeur and Kriegman [5] proved that a convex object with a Lambertian reflectance function, illuminated by an arbitrary number of point light sources at infinity, forms an illumination cone. In Ref. [6], Chen et al. proved that illumination invariants do not exist for an object with Lambertian reflectance. Based on the illumination cone models, Georghiades et al. [7] reconstructed the shape and albedo of a face using a generalized bas-relief (GBR) transformation [8], and the construction, in turn, could be used to synthesize images of the face in novel poses and illumination conditions. By representing lighting using spherical harmonics, Basri and Jacobs [9] proved that images of Lambertian objects under a wide variety of lighting conditions lie close to a 9D linear subspace. Ramamoorthi [10] showed, under appropriate assumptions, that the principal components of the images produced by an object are identical to the spherical harmonics. Zhang and Samaras [11] proposed two methods for face recognition under arbitrary unknown lighting. The first method estimated the spherical harmonic basis images from just one image taken under arbitrary illumination conditions by learning a statistical model based on a collection of 2D basis images. The second method combined the spherical harmonic illumination representation and a 3D morphable model [12] of human faces to recover basis images from images across both poses and illumination. The above-mentioned methods either need a number of training images under various lighting conditions to construct basis images spanning the illumination space for an object, or require the 3D information to estimate the albedo of a face image. However, gathering face images under various lighting conditions is difficult in practice and collecting the 3D scans of a face increases the cost of a practical face recognition system.

The normalization-based ones try to adjust the images to a normal lighting condition. Histogram Equalization (HE) [13] and Histogram Specification/Matching (HS/HM) [13] are two basic methods in this category. HE aims to transform the histogram of an input image to have the uniform distribution, while HS attempts to transform the histogram of an input image to a specified shape. However, in the discrete case, HS cannot produce exact histograms. The exact histogram specification (EHS) [14] and its variants [15–17] are proposed to transform the histogram of the original image exactly to a desired shape. Compared to global HE and HS, the Local/Adaptive HE (LHE/AHE) [13,18] and Local HS/HM (LHS/LHM) [13,19–24] are more powerful and flexible. Villegas et al. [21,22] applied the LHS, LHM, and Local Normal Distribution (LNORM) to preprocess face images prior to feature extraction. In LHM [21,22], histograms of local regions of a well illuminated average face are used as the specified histograms, and all the pixels in each sliding window need to be transformed. Besides, Wang et al. [25] proposed the Self-Quotient Image (SQI), where a weighted Gaussian filter is designed to filter the low frequency part of an image by referencing one smoothed image. Chen et al. [26] proposed the LTV model to further improve SQI by enhancing its edge-preserving ability and lessening its parameter selection problem. Lee et al. [27] proposed the Oriented Local Histogram Equalization (OLHE) for illumination compensation in face recognition. Instead of transforming the central pixel in each sliding window in LHE, OLHE transforms the pixels along the eight directions around the central pixel in the sliding window. OLHE can catch the edge orientations of face images. However, due to the drawbacks of HE, such as noise amplification, OLHE is not able to deal with face images under extreme lighting conditions very well (see Fig. 11 IV).

The illumination-insensitive extraction based ones extract the outline of a face image, such as geometrical or derivative features, e.g., the Local Binary Patterns (LBP) [28,29], Gabor features [30–33], etc. The TT [34] proposed by Tan and Triggs, the Retina filter [35] and the natural delighting filters (NDF) [36] are effective methods which belong to this category, providing the state-of-the-art recognition rates on some standard illumination variation datasets. TT and the Retina filter both employ the Difference of Gaussian (DoG) filter to eliminate low frequency illumination. NDF is based on Wiener filter in the frequency domain to best separate the illumination-invariant features from an image. However, as stated in Ref. [34], although TT significantly reduces the influence of lighting variations, it cannot completely remove the effects of hard shadowing, because some face features, that are originally supposed to lie in the high frequency part of the spectrum, may be severely compressed due to extreme lighting conditions so that they distribute in the low frequency part (see Fig. 1(a)). This is also supported by the recently proposed [36,37]. Therefore, when DoG is performed on such images, these face features might be impaired or even filtered. Moreover, illumination may exist in the high frequency part of the spectrum of face images (e.g. the obvious boundaries between dark and bright regions of the original images). Fig. 1(b) shows an image preprocessed by TT. Remarkably, there are two evident zero-crossing impulses on the TT-preprocessed image (see the white box in Fig. 1(b)). Because DoG tends to let the high frequency signal pass, the obvious boundaries between dark and bright regions of original images will always result in evident zero-crossing impulses on the processed images. As a result, it is the fact that face features have weak low frequencies and illumination has weak high frequencies that bring about the difficulty to design methods robust to illumination variations.

This paper is an extended version of Ref. [24] and mainly deals with face recognition under varying lighting conditions. To this end, we try to eliminate both the low frequency and the high frequency illumination, and enhance the weak features on face images. We have three main contributions in this paper:
                        
                           1)
                           We apply local histograms specification for local illumination normalization on face images.

We introduce the local histogram statistics to detect the high frequency illumination and low frequency face features on face images.

We report the state-of-the-art recognition rate of 81.6% on the CAS-PEAL-R1 database under the standard experimental protocol [38].

Since TT is able to remove low frequency part of illumination, we first adopt TT to preprocess the images to filter low frequency illumination. Then, local histograms and local histogram statistics are learned from the ideal face images (face images captured under the controlled normal lighting conditions). In our first proposed method, LHS is applied on the entire image using the learned local histograms as the specified histograms. By contrast, in the second method, the regions contain high frequency illumination and weak face features on a face image are identified by the local histogram statistics, before LHS is applied on these regions to eliminate high frequency illumination and enhance the weak face features. The two main benefits of our methods are that: 1) both the low and high frequency parts of illumination on face images are dramatically reduced; and 2) intrinsic face features lying in the low frequency part of face images can also be enhanced. Experimental results on the CMU PIE [39], Extended Yale B [40] and CAS-PEAL-R1 databases [38] demonstrate the effectiveness and efficiency of our methods.

In the rest of this paper, we review histogram specification (HS) in Section 2. In Sections 3 and 4, we introduce the two versions of our proposed methods. Section 5 discusses some issues on the ideal face images. Experimental results are presented in Section 6 and finally we draw some conclusions in Section 7.

Histogram specification (HS) [13] is an effective image enhancement technique. Let u
                     ={u
                     
                        ij
                     } be a H
                     ×
                     W discrete input digital image with L gray levels, and let 
                        
                           L
                        
                     
                     ={0,1,…,
                     L
                     −1}. The histogram or gray level probability density of an image is defined by
                        
                           (1)
                           
                              
                                 
                                    p
                                    u
                                 
                                 
                                    l
                                 
                                 =
                                 
                                    
                                       N
                                       l
                                    
                                    N
                                 
                                 ,
                                 
                                 ∀
                                 l
                                 ∈
                                 L
                              
                           
                        
                     where N
                     =
                     H
                     ×
                     W, and N
                     
                        l
                      is the number of pixels that have gray level l. The cumulative distribution function (CDF) of p
                     
                        u
                      is given by
                        
                           (2)
                           
                              
                                 
                                    P
                                    u
                                 
                                 
                                    x
                                 
                                 =
                                 
                                    
                                       ∑
                                       
                                          k
                                          =
                                          0
                                       
                                       x
                                    
                                    
                                 
                                 
                                 
                                    p
                                    u
                                 
                                 
                                    k
                                 
                                 ,
                                 
                                 ∀
                                 x
                                 ∈
                                 L
                                 .
                              
                           
                        
                     
                  

Let P
                     
                        v
                     (y),∀
                     y
                     ∈
                     
                        
                           L
                        
                     , be the specified CDF. HS attempts to find a transformation function y
                     =
                     F(x) to map the gray level x in the original image to y so that the transformed image could have the similar histogram as the specified one. In order to preserve the intrinsic information of the original image, function F should be the monotonically increasing function. Such a function can be found by the following equation:
                        
                           (3)
                           
                              
                                 
                                    P
                                    v
                                 
                                 
                                    y
                                 
                                 =
                                 
                                    P
                                    u
                                 
                                 
                                    x
                                 
                                 .
                              
                           
                        
                     
                  

Hence, the mapped gray level y can be obtained by:
                        
                           (4)
                           
                              
                                 y
                                 =
                                 
                                    P
                                    v
                                    
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       
                                          P
                                          u
                                       
                                       
                                          x
                                       
                                    
                                 
                                 .
                              
                           
                        
                     where P
                     
                        v
                     
                     −1 denotes the inverse function of P
                     
                        v
                     . Thus, the transformation function is F(⋅)=
                     P
                     
                        v
                     
                     −1[P
                     
                        u
                     (⋅)].

In the discrete case, the inverse function of P
                     
                        v
                      typically does not exist. Eqs. (3) and (4) are usually replaced by the following optimal objective function to approximate y for a particular gray level x:
                        
                           (5)
                           
                              
                                 y
                                 =
                                 arg
                                 
                                    min
                                    k
                                 
                                 |
                                 
                                    P
                                    u
                                 
                                 
                                    x
                                 
                                 −
                                 
                                    P
                                    v
                                 
                                 
                                    k
                                 
                                 |
                                 .
                              
                           
                        
                     
                  

With such a transformation rule, each gray level x is able to be mapped to y. Thus, the mapped image would have the histogram close to a desired one.

In this section, we propose the Local Histogram Specification using Learned local histograms (LHS-L) from the ideal face images for face recognition. Since TT is able to remove the low frequency part of illumination, we first adopt TT to eliminate the low frequency illumination on face images.

As LHS-L is performed on local regions of an image, the size of a window will be (2r
                        +1)×(2r
                        +1) if we name r the “radius” of the window. Such a window will not be too small, so the borders of an image should not be neglected. In this paper, we address this problem by attaching borders to the images. The attached borders are filled by the pixels of the inner borders (see Fig. 2(a) for details). Note that the size of the bordered image is (H
                        +2r)×(W
                        +2r), and in the bordered image, the coordinates range in (1−
                        r,
                        H
                        +
                        r) vertically and (1−
                        r,
                        W
                        +
                        r) horizontally, where H and W denote the height and width of the original image, respectively.

In LHS-L, each standard histogram corresponding to each window of the face images needs to be specified. These histograms could be learned from the ideal face images.

Given a set of ideal face images I
                        ={I
                        1,
                        I
                        2,…,
                        I
                        
                           n
                        } and I
                        
                           k
                        
                        ∈
                        
                           
                              L
                           
                        
                        
                           H
                           ×
                           W
                        ,
                        k
                        =1,2,…,
                        n, we use the method described in the previous subsection to get their bordered images X
                        ={X
                        1,
                        X
                        2,…,
                        X
                        
                           n
                        }, X
                        
                           k
                        
                        ∈
                        
                           
                              L
                           
                        
                        (H
                           +2r)×(W
                           +2r), and k
                        =1,2,…,
                        n. Thus, the window centered at (i,
                        j) with a radius r in image X
                        
                           k
                         can be expressed as X
                        
                           ij
                        
                        (k)
                        =
                        X
                        
                           k
                        (i
                        −
                        r
                        :
                        i
                        +
                        r,
                        j
                        −
                        r
                        :
                        j
                        +
                        r) and 
                           
                              
                                 i
                                 j
                              
                              ∈
                              A
                              ≡
                              
                                 1
                                 2
                                 …
                                 H
                              
                              ×
                              
                                 1
                                 2
                                 …
                                 W
                              
                           
                        . Let 
                           
                              B
                           
                        
                        ={1−
                        r,…,
                        H
                        +
                        r}×{1−
                        r,…,
                        W
                        +
                        r} be the set of coordinates of the bordered image. The set of coordinates within a window centered at (i,
                        j) with a radius r is given by:
                           
                              (6)
                              
                                 
                                    
                                       S
                                       ij
                                       r
                                    
                                    =
                                    
                                       
                                          
                                             u
                                             v
                                          
                                          |
                                          
                                             u
                                             v
                                          
                                          ∈
                                          B
                                          ∧
                                          |
                                          u
                                          −
                                          i
                                          |
                                          ≤
                                          r
                                          ∧
                                          |
                                          v
                                          −
                                          j
                                          |
                                          ≤
                                          r
                                       
                                    
                                    ~~
                                    (
                                    i
                                    ,
                                    j
                                    )
                                    ∈
                                    A
                                    .
                                 
                              
                           
                        
                     

Apparently, 
                           
                              |
                              
                                 S
                                 ij
                                 r
                              
                              |
                              =
                              
                                 
                                    
                                       2
                                       r
                                       +
                                       1
                                    
                                 
                                 2
                              
                           
                        . Note that, for a set, |⋅| denotes the cardinality of the set. The histogram of window X
                        
                           ij
                        
                        (k) is defined as
                           
                              (7)
                              
                                 
                                    
                                       h
                                       ij
                                       
                                          k
                                       
                                    
                                    
                                       l
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   u
                                                   v
                                                
                                                |
                                                
                                                   u
                                                   v
                                                
                                                ∈
                                                
                                                   S
                                                   ij
                                                   r
                                                
                                                ∧
                                                
                                                   x
                                                   uv
                                                   
                                                      k
                                                   
                                                
                                                =
                                                l
                                             
                                          
                                       
                                       
                                          
                                             S
                                             ij
                                             r
                                          
                                       
                                    
                                    ,
                                    
                                    ∀
                                    l
                                    ∈
                                    L
                                    .
                                 
                              
                           
                        
                     

The local normalized histogram h
                        
                           ij
                        
                        ={h
                        
                           ij
                        (0),
                        h
                        
                           ij
                        (1),…,
                        h
                        
                           ij
                        (L
                        −1)} of a local region of all the ideal face images is learned by
                           
                              (8)
                              
                                 
                                    
                                       h
                                       ij
                                    
                                    
                                       l
                                    
                                    =
                                    
                                       1
                                       n
                                    
                                    
                                       
                                          ∑
                                          
                                             k
                                             =
                                             1
                                          
                                          n
                                       
                                       
                                    
                                    
                                    
                                       h
                                       ij
                                       
                                          k
                                       
                                    
                                    
                                       l
                                    
                                    ,
                                    
                                    ∀
                                    l
                                    ∈
                                    L
                                    .
                                 
                              
                           
                        
                     

It can be verified that Σ
                        
                           l
                           =0
                        
                           L
                           −1
                        h
                        
                           ij
                        (l)=1.

Essentially, h
                        
                           ij
                        (l) is the frequency of gray level l in a local region of the ideal face images. Therefore, h
                        
                           ij
                         reflects the distribution of the gray values in a particular region of the face images as well as the lighting condition. We regard these learned histograms as local specified histograms. We calculate the histogram h
                        
                           ij
                         of each location (i,
                        j) of the ideal face images in advance and store them.

Once the local histograms of the ideal images are learned, they are used as the specified histograms. Given a test image Y
                        ∈
                        
                           
                              L
                           
                        
                        
                           H
                           ×
                           W
                        , the processing steps are summarized as follows:
                           
                              Step 1
                              Attach borders to image Y
                                 ∈
                                 
                                    
                                       L
                                    
                                 
                                 
                                    H
                                    ×
                                    W
                                  to get its bordered image Z
                                 ∈
                                 
                                    
                                       L
                                    
                                 
                                 (H
                                    +2r)×(W
                                    +2r).

For each sub-image Z
                                 
                                    ij
                                 
                                 =
                                 Z(i
                                 −
                                 r
                                 :
                                 i
                                 +
                                 r,
                                 j
                                 −
                                 r
                                 :
                                 j
                                 +
                                 r) centered at (i,
                                 j) (i
                                 =1,…,
                                 H and j
                                 =1,…,
                                 W) with radius r, perform HS on Z
                                 
                                    ij
                                  using the learned histogram h
                                 
                                    ij
                                  described in Section 2, but only the central pixel Z(i,
                                 j) is transformed.

The preprocessed image is Z
                                 :=
                                 Z(1:
                                 H,1:
                                 W).

Finally, the processed image is adjusted to have the lighting condition analogous to those of training ones. Fig. 3(a) and (b) illustrates the images preprocessed by TT and LHS-L. Compared to TT, LHS-L is able to significantly reduce the high frequency part of illumination (Fig. 3(a) III), and enhance intrinsic face features lying in the low frequency part of an image (Fig. 3(b) III). Histograms in Fig. 3 indicate that LHS-L processed images have lighting conditions closer to those of ideal images.

The window size is determined by the radius r defined in Section 3.1. Such an r is a crucial parameter in LHS-L. If r is too small, the window will not reflect the intrinsic information of a face. In this case, when applying LHS-L to an image, such an image will be transformed similarly to the average face of the training set, which is contrary to our motivation that we hope only the lighting condition of the test image is transformed close to those of ideal images. Besides, a too small r will lead to over-enhancement. Conversely, a larger r would bring about a higher computational complexity. Fortunately, an appropriate radius is not difficult to find, because the recognition rates grow sharply as r increases at the beginning, but later, the recognition rates remain almost stable (see Fig. 2(b)). Such a good quality allows us to easily choose a good r. In our experiments, r is set to 10.

HS is a simple, effective, and efficient image enhancement technique, but it often leads to over-enhancement. In fact, the exact HS methods [14–17] can be used in LHS-L. However, when applied on local regions, they become very time-consuming because all the pixels in each sliding window need to be sorted. For a practical face recognition system, we do not hope that the preprocessing procedure takes up too much time.

In this section, we utilize the statistical information of histograms for image enhancement. With histogram statistics [13], we propose a flexible version of the LHS-L method named f-LHS-L. Let us consider the mean and the variance of a window centered at (i,
                     j) with a radius w on an image:
                        
                           (9)
                           
                              
                                 
                                    
                                       
                                          m
                                          ij
                                       
                                       =
                                       
                                          1
                                          
                                             
                                                S
                                                ij
                                                w
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                             
                                                
                                                   u
                                                   v
                                                
                                                ∈
                                                
                                                   S
                                                   ij
                                                   w
                                                
                                             
                                          
                                          
                                       
                                       
                                       
                                          x
                                          uv
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                σ
                                                ij
                                             
                                          
                                          2
                                       
                                       =
                                       
                                          1
                                          
                                             
                                                S
                                                ij
                                                w
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                             
                                                
                                                   u
                                                   v
                                                
                                                ∈
                                                
                                                   S
                                                   ij
                                                   w
                                                
                                             
                                          
                                          
                                       
                                       
                                       
                                          
                                             
                                                
                                                   x
                                                   uv
                                                
                                                −
                                                
                                                   m
                                                   ij
                                                
                                             
                                          
                                          2
                                       
                                       .
                                    
                                 
                              
                           
                        
                     
                  

We are interested in the mean and variance or standard deviation of a local region on an image, because the mean reflects the average gray level of the region, and the variance or standard deviation represents the average contrast of the image [13]. Specifically, if m
                     
                        ij
                      is too small (out of normal range of the local region on a face, similarly hereinafter), then the region may be too dark; otherwise, it may be too bright. For σ
                     
                        ij
                     , if it is too small (except the case of constant areas, which will be discussed separately below), then the local region of an image would have low contrast, therefore it needs to be enhanced; if it is too large, the region may be over-enhanced or it may contain a two dimensional zero-crossing signal.

Based on the above analysis, we hope to enhance the areas that the means and standard deviations are out of the normal range, while leaving other areas where the image quality acceptable untransformed. We define the normal ranges of m
                     
                        ij
                      and σ
                     
                        ij
                      as follows:
                        
                           (10)
                           
                              
                                 
                                    m
                                    ij
                                    min
                                 
                                 ≤
                                 
                                    m
                                    ij
                                 
                                 ≤
                                 
                                    m
                                    ij
                                    max
                                 
                                 
                                 and
                                 
                                 
                                    σ
                                    ij
                                    min
                                 
                                 ≤
                                 
                                    σ
                                    ij
                                 
                                 ≤
                                 
                                    σ
                                    ij
                                    max
                                 
                                 .
                              
                           
                        
                     
                  

Since it is a problem for HS to enhance constant areas, whose standard deviation is zero, we set a lower bound for σ
                     
                        ij
                     , signifying that pixel x
                     
                        ij
                      does not need to be enhanced, by requiring that:
                        
                           (11)
                           
                              
                                 
                                    σ
                                    ij
                                    2
                                 
                                 ≤
                                 ϵ
                                 
                                    
                                       
                                          2
                                          w
                                          +
                                          1
                                       
                                    
                                    2
                                 
                              
                           
                        
                     where ϵ is a very small positive constant, and (2w
                     +1)2 is the area of a window. In our method, we set ϵ=0.01. By combining Eqs. (10) and (11), we give the following condition:
                        
                           (12)
                           
                              
                                 
                                    
                                       
                                          m
                                          ij
                                          min
                                       
                                       ≤
                                       
                                          m
                                          ij
                                       
                                       ≤
                                       
                                          m
                                          ij
                                          max
                                       
                                       
                                       and
                                       
                                       
                                          σ
                                          ij
                                          min
                                       
                                       ≤
                                       
                                          σ
                                          ij
                                       
                                       ≤
                                       
                                          σ
                                          ij
                                          max
                                       
                                    
                                 
                                 
                                 or
                                 
                                 
                                    σ
                                    ij
                                    2
                                 
                                 ≤
                                 ϵ
                                 
                                    
                                       
                                          2
                                          w
                                          +
                                          1
                                       
                                    
                                    2
                                 
                                 .
                              
                           
                        
                     
                  

If the local mean m
                     
                        ij
                      and standard deviation σ
                     
                        ij
                      satisfy Eq. (12), then the central pixel x
                     
                        ij
                      of this region does not need to be transformed. Otherwise it needs to be transformed using HS, or other sophisticated HS methods. By doing this we have two merits:
                        
                           1)
                           Pixels that have good quality are less likely to be over-enhanced by HS.

It will be more efficient in comparison with transforming all the pixels of the image.

In this subsection, we try to estimate the bounds m
                        
                           ij
                        
                        min, m
                        
                           ij
                        
                        max, σ
                        
                           ij
                        
                        min, and σ
                        
                           ij
                        
                        max for each local region using learned local histogram statistics from ideal images. Let M
                        
                           ij
                         and S
                        
                           ij
                        , respectively, denote random variables representing the mean value and the standard deviation of the region X(i
                        −
                        w
                        :
                        i
                        +
                        w,
                        j
                        −
                        w
                        :
                        j
                        +
                        w) centered at (i,
                        j) with a radius w of the ideal face images. Since we need to find the lower and upper bounds for m
                        
                           ij
                         and σ
                        
                           ij
                        , without knowing the true distribution of M
                        
                           ij
                         and S
                        
                           ij
                        , a viable way is to estimate the expectation 
                           
                              E
                              
                                 ⋅
                              
                           
                         and variance 
                           
                              D
                              
                                 ⋅
                              
                           
                         for both M
                        
                           ij
                         and S
                        
                           ij
                        . Let
                           
                              (13)
                              
                                 
                                    
                                       
                                          
                                             μ
                                             ij
                                             M
                                          
                                          =
                                          E
                                          
                                             
                                                M
                                                ij
                                             
                                          
                                          ,
                                          
                                          
                                             
                                                
                                                   σ
                                                   ij
                                                   M
                                                
                                             
                                             2
                                          
                                          =
                                          D
                                          
                                             
                                                M
                                                ij
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             μ
                                             ij
                                             S
                                          
                                          =
                                          E
                                          
                                             
                                                S
                                                ij
                                             
                                          
                                          ,
                                          
                                          
                                             
                                                
                                                   σ
                                                   ij
                                                   S
                                                
                                             
                                             2
                                          
                                          =
                                          D
                                          
                                             
                                                S
                                                ij
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     

The above four statistics can be estimated by using ideal face images:
                           
                              (14)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                   ^
                                                
                                                ij
                                                M
                                             
                                          
                                          =
                                          
                                             1
                                             n
                                          
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                          
                                          
                                          
                                             m
                                             ij
                                             
                                                k
                                             
                                          
                                          ,
                                          
                                          
                                             
                                                
                                                   σ
                                                   ^
                                                
                                                ij
                                                M
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      1
                                                      n
                                                   
                                                   
                                                      
                                                         ∑
                                                         
                                                            k
                                                            =
                                                            1
                                                         
                                                         n
                                                      
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               m
                                                               ij
                                                               
                                                                  k
                                                               
                                                            
                                                            −
                                                            
                                                               
                                                                  
                                                                     μ
                                                                     ^
                                                                  
                                                                  ij
                                                                  M
                                                               
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                   ^
                                                
                                                ij
                                                S
                                             
                                          
                                          =
                                          
                                             1
                                             n
                                          
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                          
                                          
                                          
                                             σ
                                             ij
                                             
                                                k
                                             
                                          
                                          ,
                                          
                                          
                                             
                                                
                                                   σ
                                                   ^
                                                
                                                ij
                                                S
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   1
                                                   n
                                                
                                                
                                                   
                                                      ∑
                                                      
                                                         k
                                                         =
                                                         1
                                                      
                                                      n
                                                   
                                                   
                                                
                                                
                                                
                                                   
                                                      
                                                         
                                                            σ
                                                            ij
                                                            
                                                               k
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               
                                                                  μ
                                                                  ^
                                                               
                                                               ij
                                                               S
                                                            
                                                         
                                                      
                                                   
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where m
                        
                           ij
                        
                        (k) and σ
                        
                           ij
                        
                        (k) are defined like Eq. (9) but denote the mean and the standard deviation of the local region of the k-th image.

Let 
                           
                              
                                 
                                    μ
                                    ^
                                 
                                 M
                              
                           
                        , 
                           
                              
                                 
                                    σ
                                    ^
                                 
                                 M
                              
                           
                        , 
                           
                              
                                 
                                    μ
                                    ^
                                 
                                 S
                              
                           
                        , and 
                           
                              
                                 
                                    σ
                                    ^
                                 
                                 S
                              
                           
                         be the H
                        ×
                        W matrices with 
                           
                              
                                 
                                    
                                       
                                          
                                             μ
                                             ^
                                          
                                          M
                                       
                                    
                                 
                                 ij
                              
                              =
                              
                                 
                                    
                                       μ
                                       ^
                                    
                                    ij
                                    M
                                 
                              
                           
                        , 
                           
                              
                                 
                                    
                                       
                                          
                                             σ
                                             ^
                                          
                                          M
                                       
                                    
                                 
                                 ij
                              
                              =
                              
                                 
                                    
                                       σ
                                       ^
                                    
                                    ij
                                    M
                                 
                              
                           
                        , 
                           
                              
                                 
                                    
                                       
                                          
                                             μ
                                             ^
                                          
                                          S
                                       
                                    
                                 
                                 ij
                              
                              =
                              
                                 
                                    
                                       μ
                                       ^
                                    
                                    ij
                                    S
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    
                                       
                                          
                                             σ
                                             ^
                                          
                                          S
                                       
                                    
                                 
                                 ij
                              
                              =
                              
                                 
                                    
                                       σ
                                       ^
                                    
                                    ij
                                    S
                                 
                              
                           
                        . Fig. 4
                         shows the 
                           
                              
                                 
                                    μ
                                    ^
                                 
                                 M
                              
                           
                        , 
                           
                              
                                 
                                    σ
                                    ^
                                 
                                 M
                              
                           
                        , 
                           
                              
                                 
                                    μ
                                    ^
                                 
                                 S
                              
                           
                        , and 
                           
                              
                                 
                                    σ
                                    ^
                                 
                                 S
                              
                           
                         learned from all the images in the gallery set of the CAS-PEAL-R1 database. With the estimated 
                           
                              
                                 
                                    μ
                                    ^
                                 
                                 ij
                                 M
                              
                           
                        , 
                           
                              
                                 
                                    σ
                                    ^
                                 
                                 ij
                                 M
                              
                           
                        , 
                           
                              
                                 
                                    μ
                                    ^
                                 
                                 ij
                                 S
                              
                           
                        , and 
                           
                              
                                 
                                    σ
                                    ^
                                 
                                 ij
                                 S
                              
                           
                        , we give the lower bounds m
                        
                           ij
                        
                        min and σ
                        
                           ij
                        
                        min, and the upper bounds m
                        
                           ij
                        
                        max and σ
                        
                           ij
                        
                        max for m
                        
                           ij
                         and σ
                        
                           ij
                         as follows:
                           
                              (15)
                              
                                 
                                    
                                       
                                          
                                             m
                                             ij
                                             min
                                          
                                          =
                                          max
                                          
                                             
                                                0
                                                ,
                                                
                                                   
                                                      
                                                         μ
                                                         ^
                                                      
                                                      ij
                                                      M
                                                   
                                                
                                                −
                                                α
                                                
                                                   
                                                      
                                                         σ
                                                         ^
                                                      
                                                      ij
                                                      M
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                          
                                             m
                                             ij
                                             max
                                          
                                          =
                                          
                                             
                                                
                                                   μ
                                                   ^
                                                
                                                ij
                                                M
                                             
                                          
                                          +
                                          α
                                          
                                             
                                                
                                                   σ
                                                   ^
                                                
                                                ij
                                                M
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             σ
                                             ij
                                             min
                                          
                                          =
                                          max
                                          
                                             
                                                0
                                                ,
                                                
                                                   
                                                      
                                                         μ
                                                         ^
                                                      
                                                      ij
                                                      S
                                                   
                                                
                                                −
                                                α
                                                
                                                   
                                                      
                                                         σ
                                                         ^
                                                      
                                                      ij
                                                      S
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                          
                                             σ
                                             ij
                                             max
                                          
                                          =
                                          
                                             
                                                
                                                   μ
                                                   ^
                                                
                                                ij
                                                S
                                             
                                          
                                          +
                                          α
                                          
                                             
                                                
                                                   σ
                                                   ^
                                                
                                                ij
                                                S
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where α is a user defined parameter for all local regions. The bounds are defined as α-standard-deviation away from the mean. If α
                        =0, then this flexible method f-LHS-L overwhelmingly degenerates to LHS-L proposed in the previous section. In our experiments, we investigate the performance of f-LHS-L with respect to (w.r.t.) α
                        =0,1,…,7. Next, we define f(⋅) to indicate whether a pixel 
                           
                              
                                 x
                                 ij
                              
                              ,
                              
                                 i
                                 j
                              
                              ∈
                              A
                           
                        , needs to be enhanced:
                           
                              (16)
                              
                                 
                                    f
                                    
                                       
                                          x
                                          ij
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                   
                                                   
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         if
                                                         
                                                         
                                                            
                                                               
                                                                  m
                                                                  ij
                                                                  min
                                                               
                                                               ≤
                                                               
                                                                  m
                                                                  ij
                                                               
                                                               ≤
                                                               
                                                                  m
                                                                  ij
                                                                  max
                                                               
                                                               
                                                               and
                                                               
                                                               
                                                                  σ
                                                                  ij
                                                                  min
                                                               
                                                               ≤
                                                               
                                                                  σ
                                                                  ij
                                                               
                                                               ≤
                                                               
                                                                  σ
                                                                  ij
                                                                  max
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         or
                                                         
                                                         
                                                            σ
                                                            ij
                                                            2
                                                         
                                                         ≤
                                                         ϵ
                                                         
                                                            
                                                               
                                                                  2
                                                                  w
                                                                  +
                                                                  1
                                                               
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         otherwise
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        
                     


                        Fig. 5
                         shows the effectiveness of the proposed method. The zero-crossing signals on the TT-processed image can be detected by the f(⋅) function. Fig. 6
                         provides a flow chart for our proposed LHS-L and f-LHS-L. Part of the process of f-LHS-L is in the dotted box in this figure.

After HS is performed on local regions of images, there may exist some over-enhanced pixels. These pixels tend to be the salt and pepper noises. Thus, we use the median filter to smooth all the pixels that have been processed by HS. The set of the coordinates of these pixels is given by:
                           
                              (17)
                              
                                 
                                    
                                       S
                                       med
                                    
                                    =
                                    
                                       
                                          
                                             i
                                             j
                                          
                                          |
                                          
                                             i
                                             j
                                          
                                          ∈
                                          A
                                          ∧
                                          f
                                          
                                             
                                                x
                                                ij
                                             
                                          
                                          =
                                          1
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

In our method, an image to be preprocessed is segmented into two parts (see Fig. 5(d)). After LHS is applied on the poor quality part, there will be an obvious boundary between the two parts. The boundary is a high frequency signal, therefore a mean filter is proper to eliminate this signal. So, we apply a mean filter on these candidate pixels that are on the boundaries between the two regions. Let 
                           
                              S
                              ij
                              d
                           
                         denote the coordinates within the mean filter window centered at (i,
                        j) with a radius d. We define the set of the coordinates of the candidate pixels as follows:
                           
                              (18)
                              
                                 
                                    
                                       S
                                       mean
                                    
                                    =
                                    
                                       
                                          
                                             i
                                             j
                                          
                                          |
                                          
                                             i
                                             j
                                          
                                          ∈
                                          A
                                          ∧
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         
                                                            u
                                                            v
                                                         
                                                         ∈
                                                         
                                                            S
                                                            ij
                                                            d
                                                         
                                                         ∩
                                                         A
                                                      
                                                   
                                                   
                                                
                                                f
                                                
                                                   
                                                      x
                                                      uv
                                                   
                                                
                                             
                                          
                                          ∉
                                          
                                             
                                                0
                                                ,
                                                |
                                                
                                                   S
                                                   ij
                                                   d
                                                
                                                ∩
                                                A
                                                |
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

If 
                           
                              
                                 
                                    ∑
                                    
                                       
                                          u
                                          v
                                       
                                       ∈
                                       
                                          S
                                          ij
                                          d
                                       
                                       ∩
                                       A
                                    
                                 
                                 
                              
                              
                              f
                              
                                 
                                    x
                                    uv
                                 
                              
                              =
                              0
                           
                        , or 
                           
                              
                                 
                                    ∑
                                    
                                       
                                          u
                                          v
                                       
                                       ∈
                                       
                                          S
                                          ij
                                          d
                                       
                                       ∩
                                       A
                                    
                                 
                                 
                              
                              
                              f
                              
                                 
                                    x
                                    uv
                                 
                              
                              =
                              |
                              
                                 S
                                 ij
                                 d
                              
                              ∩
                              A
                              |
                           
                        , then it means that pixel x
                        
                           ij
                         is at least d-pixel distance away from any boundary. So, 
                           
                              S
                              mean
                           
                         defined above is the set of pixels that are d-pixel distance within the boundaries on the original image. These pixels need to be smoothed using the mean filter.

In our methods LHS-L and f-LHS-L, the standard histograms and histogram statistics need to be learned from the ideal face images. In this section, we shall discuss some issues on the ideal face images, including 1) the acquisition of these images, 2) the number of these images required for learning the standard histograms and histogram statistics, and 3) the robustness of the ideal images to face detection error.

The ideal face images could be regarded as the face images captured under controlled normal lighting conditions. For example, on the CMU PIE and the Extended Yale B databases, the images illuminated by the light from the most frontal light source are chosen as the ideal face images (see Fig. 7(a) and (b)). On the CAS-PEAL-R1 database, the images from the gallery set are regarded as the ideal face images (see Fig. 7(c)). For a practical face recognition system, face images enrolled in the system generally have normal lighting conditions. Therefore, these face images could be chosen as the ideal face images.

As each location on a face image has its own standard histogram and histogram statistics, transferring the standard histograms and histogram statistics across different databases should follow two rules: 1) the image size on different databases should be the same; and 2) the locations of the eye centers of the images on different databases should be the same, since eye features are very important features on a face [41]. Because histograms of most regions on TT-preprocessed images tend to have Laplace distribution except the eye regions, for face images with expression, pose, age variations, as long as they are cropped and aligned according to the above two rules, the histograms and histogram statistics learned on other databases could be applied to these images. Therefore, LHS-L and f-LHS-L are robust to variations, such as expression, pose, age variations, on face images following the above two rules.

Firstly, we try to estimate how many ideal images are required for learning the standard histograms. We achieve this goal by comparing the differences between the histograms learned from n ideal images and n
                        −1 ideal images. Let [h
                        
                           ij
                        ]
                           n
                         and [h
                        
                           ij
                        ]
                           n
                           −1 denote the histograms of the window centered at (i,
                        j) learned from n and n
                        −1 ideal images, respectively. We define the Average Histogram Increment (AHI) by:
                           
                              (19)
                              
                                 
                                    AHI
                                    
                                       n
                                    
                                    =
                                    
                                       1
                                       HW
                                    
                                    
                                       
                                          ∑
                                          
                                             i
                                             =
                                             1
                                          
                                          H
                                       
                                       
                                    
                                    
                                    
                                       
                                          ∑
                                          
                                             j
                                             =
                                             1
                                          
                                          W
                                       
                                       
                                    
                                    
                                    
                                       χ
                                       2
                                    
                                    
                                       
                                          
                                             
                                                h
                                                ij
                                             
                                          
                                          n
                                       
                                       
                                          
                                             
                                                h
                                                ij
                                             
                                          
                                          
                                             n
                                             −
                                             1
                                          
                                       
                                    
                                    ,
                                    
                                    n
                                    ≥
                                    3
                                 
                              
                           
                        where χ
                        2(⋅,⋅) is the histogram distance defined by χ
                        2(a,
                        b)=∑
                        
                           l
                           ∈
                        
                        
                           
                              
                                 
                                 L
                              
                           
                        
                        (a
                        
                           l
                        
                        −
                        b
                        
                           l
                        )2/(a
                        
                           l
                        
                        +
                        b
                        
                           l
                        ) [28]. AHI measures the average distance between the local histograms learned from n and n
                        −1 ideal face images. Fig. 8(a) plots the AHI w.r.t. n on CMU PIE, Extended Yale B, and CAS-PEAL-R1 databases. Although the ideal images of the three databases belong to different individuals and the image sizes of the three databases are also different, the AHI curves of three databases coincide perfectly. This demonstrates the robustness of the AHI measurement. In Fig. 8(a), as n increases from 3 to 20, the AHI curves drop dramatically. When n is larger than 20, the values of AHI are close to 0. Fig. 8(b) plots the recognition rates of the CMU PIE database and the Extended Yale B subsets. Therefore, according to Fig. 8(a) and (b), the minimum number of ideal face images for learning the standard histograms is empirically set to 20.

Next, we investigate the number of ideal images required for learning the histogram statistics. Let 
                           
                              
                                 
                                    
                                       
                                          
                                             μ
                                             ^
                                          
                                          M
                                       
                                    
                                 
                                 n
                              
                              
                                 
                                    
                                       
                                          
                                             σ
                                             ^
                                          
                                          M
                                       
                                    
                                 
                                 n
                              
                              
                                 
                                    
                                       
                                          
                                             μ
                                             ^
                                          
                                          S
                                       
                                    
                                 
                                 n
                              
                              
                                 
                                    
                                       
                                          
                                             σ
                                             ^
                                          
                                          S
                                       
                                    
                                 
                                 n
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          
                                             μ
                                             ^
                                          
                                          M
                                       
                                    
                                 
                                 
                                    n
                                    −
                                    1
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             σ
                                             ^
                                          
                                          M
                                       
                                    
                                 
                                 
                                    n
                                    −
                                    1
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             μ
                                             ^
                                          
                                          S
                                       
                                    
                                 
                                 
                                    n
                                    −
                                    1
                                 
                              
                              
                                 
                                    
                                       
                                          σ
                                          ^
                                       
                                       S
                                    
                                 
                                 
                                    n
                                    −
                                    1
                                 
                              
                           
                         denote the sets of histogram statistics learned from n and n
                        −1 ideal face images, respectively. Similar to the definition of AHI, we define the Average Statistics Increment (ASI) as follows:
                           
                              (20)
                              
                                 
                                    
                                       
                                          ASI
                                          
                                             n
                                          
                                          =
                                          
                                             1
                                             
                                                4
                                                HW
                                             
                                          
                                          (
                                          |
                                          |
                                          
                                             
                                                
                                                   
                                                      
                                                         μ
                                                         ^
                                                      
                                                      M
                                                   
                                                
                                             
                                             n
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      
                                                         μ
                                                         ^
                                                      
                                                      M
                                                   
                                                
                                             
                                             
                                                n
                                                −
                                                1
                                             
                                          
                                          |
                                          |
                                          
                                             
                                             F
                                             2
                                          
                                          +
                                          |
                                          |
                                          
                                             
                                                
                                                   
                                                      
                                                         σ
                                                         ^
                                                      
                                                      M
                                                   
                                                
                                             
                                             n
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      
                                                         σ
                                                         ^
                                                      
                                                      M
                                                   
                                                
                                             
                                             
                                                n
                                                −
                                                1
                                             
                                          
                                          |
                                          |
                                          
                                             
                                             F
                                             2
                                          
                                       
                                    
                                    
                                       
                                          +
                                          |
                                          |
                                          
                                             
                                                
                                                   
                                                      
                                                         μ
                                                         ^
                                                      
                                                      S
                                                   
                                                
                                             
                                             n
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      
                                                         μ
                                                         ^
                                                      
                                                      S
                                                   
                                                
                                             
                                             
                                                n
                                                −
                                                1
                                             
                                          
                                          |
                                          |
                                          
                                             
                                             F
                                             2
                                          
                                          +
                                          |
                                          |
                                          
                                             
                                                
                                                   
                                                      
                                                         σ
                                                         ^
                                                      
                                                      S
                                                   
                                                
                                             
                                             n
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      
                                                         σ
                                                         ^
                                                      
                                                      S
                                                   
                                                
                                             
                                             
                                                n
                                                −
                                                1
                                             
                                          
                                          |
                                          |
                                          
                                             
                                             F
                                             2
                                          
                                          )
                                          ,
                                          
                                          n
                                          ≥
                                          3
                                       
                                    
                                 
                              
                           
                        where ||⋅||
                           F
                         denotes the Frobenius norm. ASI measures the average distance between the histogram statics learned from n and n
                        −1 ideal face images. Fig. 9(a) plots the ASI w.r.t. n on the CAS-PEAL-R1 database. As n grows from 3 to 50, the ASI curve declines steeply from approximately 23 to near 0, and when n continues growing, the ASI curve remains stable and is almost 0. The recognition rate on the CAS-PEAL-R1 database achieved by f-LHS-L shown in Fig. 9(b) is consistent with the ASI curve. The recognition rate grows sharply as n increases from 3 to 50, where the recognition rate is 75.0%. When n is larger than 50, the recognition rate remains stable, being no less than 75.0%. As a result, the minimum number of ideal face images for learning the histogram statistics can be set to 50.

In this subsection, we shall discuss the robustness of learning the standard histograms and histogram statistics to detection error, generally several pixels' misalignment. When we wish to calculate the standard histogram of a window centered at (i,
                        j) on an ideal face image, due to detection error, the ground truth center of this window may be several pixels away from (i,
                        j). Denote by (i′,
                        j′) the random vector representing the ground truth center of the window which should be centered at (i,
                        j) (see Fig. 10
                        ). Let Δ
                           x
                        
                        =|j
                        −
                        j′| and Δ
                           y
                        
                        =|i
                        −
                        i′| denoting the random variables signifying the absolute offsets of ground truth center (i′,
                        j′) from (i,
                        j) along the horizontal and vertical directions, respectively.

Let A be the random variable denoting the area of non-overlapping area of the two windows, one centered at (i,
                        j) and the other centered at (i′,
                        j′) (the shadowed area in Fig. 10). Therefore, A is the function of Δ
                           x
                         and Δ
                           y
                        . Let A
                        =
                        g(Δ
                           x
                        ,Δ
                           y
                        ), and g(⋅,⋅) is defined as follows:
                           
                              
                                 
                                    g
                                    
                                       x
                                       y
                                    
                                    =
                                    
                                       
                                          
                                             
                                                0
                                                ,
                                                
                                                if
                                                
                                                x
                                                <
                                                0
                                                
                                                or
                                                
                                                y
                                                <
                                                0
                                             
                                          
                                          
                                             
                                                2
                                                
                                                   
                                                      
                                                         
                                                            2
                                                            r
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            x
                                                            +
                                                            y
                                                         
                                                      
                                                      −
                                                      xy
                                                   
                                                
                                                ,
                                                
                                                if
                                                
                                                0
                                                ≤
                                                x
                                                ≤
                                                2
                                                r
                                                +
                                                1
                                                
                                                and
                                                
                                                0
                                                ≤
                                                y
                                                ≤
                                                2
                                                r
                                                +
                                                1
                                             
                                          
                                          
                                             
                                                2
                                                
                                                   
                                                      
                                                         2
                                                         r
                                                         +
                                                         1
                                                      
                                                   
                                                   2
                                                
                                                ,
                                                
                                                otherwise
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Let A 
                        (k) be the random variable denoting the same area as A does, but for the k-th ideal image. Since the detection error for each image is independent, A, A
                        (1), …, A
                        (n) are i.i.d. random variables. Denote by 
                           
                              h
                              
                                 
                                    i
                                    ′
                                 
                                 
                                    j
                                    ′
                                 
                              
                           
                         and h
                        
                           ij
                         the ground truth standard histogram and the actually learned histogram, respectively. The upper bound of the ℓ
                        1-norm distance between 
                           
                              h
                              
                                 
                                    i
                                    ′
                                 
                                 
                                    j
                                    ′
                                 
                              
                           
                         and h
                        
                           ij
                         can be calculated as follows:
                           
                              (21)
                              
                                 
                                    
                                       
                                          |
                                          |
                                          
                                             h
                                             ij
                                          
                                          −
                                          
                                             h
                                             
                                                
                                                   i
                                                   ′
                                                
                                                
                                                   j
                                                   ′
                                                
                                             
                                          
                                          |
                                          |
                                          
                                             
                                             1
                                          
                                          =
                                          
                                             
                                                ∑
                                                
                                                   l
                                                   ∈
                                                   L
                                                
                                             
                                             
                                          
                                          
                                          |
                                          
                                             1
                                             n
                                          
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                          
                                          
                                          
                                             h
                                             ij
                                             
                                                k
                                             
                                          
                                          
                                             l
                                          
                                          −
                                          
                                             1
                                             n
                                          
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                          
                                          
                                          
                                             h
                                             
                                                
                                                   i
                                                   ′
                                                
                                                
                                                   j
                                                   ′
                                                
                                             
                                             
                                                k
                                             
                                          
                                          
                                             l
                                          
                                          |
                                       
                                    
                                    
                                       
                                          
                                          ≤
                                          
                                             1
                                             n
                                          
                                          
                                             
                                                ∑
                                                
                                                   l
                                                   ∈
                                                   L
                                                
                                             
                                             
                                          
                                          
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                          
                                          
                                          |
                                          
                                             h
                                             ij
                                             
                                                k
                                             
                                          
                                          
                                             l
                                          
                                          −
                                          
                                             h
                                             
                                                
                                                   i
                                                   ′
                                                
                                                
                                                   j
                                                   ′
                                                
                                             
                                             
                                                k
                                             
                                          
                                          
                                             l
                                          
                                          |
                                       
                                    
                                    
                                       
                                          
                                          ≤
                                          
                                             1
                                             n
                                          
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                          
                                          
                                          
                                             
                                                A
                                                
                                                   k
                                                
                                             
                                             
                                                
                                                   
                                                      2
                                                      r
                                                      +
                                                      1
                                                   
                                                
                                                2
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                          =
                                          
                                             1
                                             
                                                
                                                   
                                                      2
                                                      r
                                                      +
                                                      1
                                                   
                                                
                                                2
                                             
                                          
                                          
                                             1
                                             n
                                          
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                          
                                          
                                          
                                             A
                                             
                                                k
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     

Since the detection error is only several pixels in general, the expectation of A (
                           
                              E
                              
                                 A
                              
                           
                        ) exists. Recall that A, A
                        (1), …, A
                        (n) are i.i.d. random variables. According to Kolmogorov's strong law of large numbers [42], we have:
                           
                              (22)
                              
                                 
                                    P
                                    
                                       
                                          
                                             lim
                                             
                                                n
                                                →
                                                ∞
                                             
                                          
                                          
                                             1
                                             n
                                          
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                          
                                          
                                          
                                             A
                                             
                                                k
                                             
                                          
                                          =
                                          E
                                          
                                             A
                                          
                                       
                                    
                                    =
                                    1
                                    .
                                 
                              
                           
                        
                     

Further, we have:
                           
                              (23)
                              
                                 
                                    P
                                    
                                       
                                          
                                             sup
                                             
                                                n
                                                →
                                                ∞
                                             
                                          
                                          |
                                          |
                                          
                                             h
                                             ij
                                          
                                          −
                                          
                                             h
                                             
                                                
                                                   i
                                                   ′
                                                
                                                
                                                   j
                                                   ′
                                                
                                             
                                          
                                          |
                                          |
                                          
                                             
                                             1
                                          
                                          =
                                          
                                             
                                                E
                                                
                                                   A
                                                
                                             
                                             
                                                
                                                   
                                                      2
                                                      r
                                                      +
                                                      1
                                                   
                                                
                                                2
                                             
                                          
                                       
                                    
                                    =
                                    1
                                    .
                                 
                              
                           
                        
                     

Eq. (23) means that the upper bound of 
                           
                              |
                              |
                              
                                 h
                                 ij
                              
                              −
                              
                                 h
                                 
                                    
                                       i
                                       ′
                                    
                                    
                                       j
                                       ′
                                    
                                 
                              
                              |
                              |
                              
                                 
                                 1
                              
                           
                         converges to 
                           
                              E
                              
                                 A
                              
                              /
                              
                                 
                                    
                                       2
                                       r
                                       +
                                       1
                                    
                                 
                                 2
                              
                           
                         with probability 1. Therefore, the larger r, the smaller difference between the ground truth histogram 
                           
                              h
                              
                                 
                                    i
                                    ′
                                 
                                 
                                    j
                                    ′
                                 
                              
                           
                         and the learned histogram h
                        
                           ij
                        . Generally, 
                           
                              E
                              
                                 A
                              
                              ≪
                              
                                 
                                    
                                       2
                                       r
                                       +
                                       1
                                    
                                 
                                 2
                              
                           
                         for detection error, therefore, the learned histogram h
                        
                           ij
                         is robust to minor misalignment.

Next, we shall discuss the robustness of the histogram statistics 
                           
                              
                                 
                                    
                                       μ
                                       ^
                                    
                                    M
                                 
                              
                              ,
                              
                                 
                                    
                                       σ
                                       ^
                                    
                                    M
                                 
                              
                              ,
                              
                                 
                                    
                                       μ
                                       ^
                                    
                                    S
                                 
                              
                              ,
                              
                                 
                                    
                                       σ
                                       ^
                                    
                                    S
                                 
                              
                           
                         to detection error. From Fig. 4(a) and (b), we find that the 
                           
                              
                                 
                                    μ
                                    ^
                                 
                                 M
                              
                           
                         is very smooth, and the corresponding standard deviation image 
                           
                              
                                 
                                    σ
                                    ^
                                 
                                 M
                              
                           
                         is very dark, suggesting that its intensities are very small. This implies that the mean images, {m
                        (k)}
                           k
                           =1
                        
                           n
                         with size of m
                        (k) being H
                        ×
                        W and (m
                        (k))
                           ij
                        
                        =
                        m
                        
                           ij
                        
                        (k), of the ideal images are very close to 
                           
                              
                                 
                                    μ
                                    ^
                                 
                                 M
                              
                           
                        , and further suggests that mean images {m
                        (k)}
                           k
                           =1
                        
                           n
                         are also very smooth. Therefore, several pixels away from the ground truth will not impact 
                           
                              
                                 
                                    
                                       μ
                                       ^
                                    
                                    M
                                 
                              
                              ,
                              
                                 
                                    
                                       σ
                                       ^
                                    
                                    M
                                 
                              
                           
                         much. The same analysis could also be applied to 
                           
                              
                                 
                                    
                                       μ
                                       ^
                                    
                                    S
                                 
                              
                              ,
                              
                                 
                                    
                                       σ
                                       ^
                                    
                                    S
                                 
                              
                           
                        . Hence, the histogram statistics 
                           
                              
                                 
                                    
                                       μ
                                       ^
                                    
                                    M
                                 
                              
                              ,
                              
                                 
                                    
                                       σ
                                       ^
                                    
                                    M
                                 
                              
                              ,
                              
                                 
                                    
                                       μ
                                       ^
                                    
                                    S
                                 
                              
                              ,
                              
                                 
                                    
                                       σ
                                       ^
                                    
                                    S
                                 
                              
                           
                         are not sensitive to minor misalignment.

@&#EXPERIMENTAL RESULTS@&#

In the experiments, we compare our proposed methods with: LHM [21,22], SQI [25], OLHE-
                           
                              O
                              3
                              c
                           
                         
                        [27], OLHE-
                           
                              O
                              3
                              a
                           
                         
                        [27], TT [34] and NDF [36] on three databases: the CMU PIE database [39], the Extended Yale B database [40] and the CAS-PEAL-R1 database [38]. As we adopt TT to preprocess the images before LHM, LHS-L and f-LHS-L, all the parameters in TT are set the same as in [34]. We set the window size of LHM to 21×21. For our LHS-L and f-LHS-L, we set the parameter r to 10, and the sizes of the median filter and the mean filter in our methods are both set to 3×3 in all the experiments. For f-LHS-L, we vary α
                        =0,1,…,7 and w
                        =2,3,4,5 in the experiments.

The CMU PIE database [39] contains 68 individuals. Each person has 21 images under varying illuminations. In our experiments, the images are cropped to 132×120pixels with left eye center (35, 28) and right eye center (35, 92). We use the neutral lighting image (taken by camera c27 with flash f11 [39]) as the training image for each subject (one image per person), and the rest 20 images as the test images. The training images are used as the ideal images. We use 1-NN classifier for classification, as well as 4 different distance metrics: Distance Transformation (DT) [43], χ
                           2 histogram distance (Chi-2) [28,29], correlation and cosine, to verify the effectiveness and stability of the methods. In our settings, λ
                           
                              x
                            and λ
                           
                              y
                            in NDF are searched as 0.3 and 0.8 respectively according to its highest recognition rate in correlation distance on this database. Table 1
                            reports the experimental results.

From the results listed in Table 1, it can be seen that in all the 4 different metrics, our proposed LHS-L gets the best recognition rates on this dataset, all 100%. Recognition rates of LHM and TT in correlation and cosine distances are slightly less than those of LHS-L. This indicates that in some simple similarity metrics, LHM and TT are not as good as LHS-L, and further means that LHS-L is able to obtain better holistic face features. The recognition rates of NDF vary greatly when different metrics are used, with 100% in correlation distance but 40.16% in Chi-2 distance, which implies that there are considerable within-individual histogram differences among the images preprocessed by NDF. Images processed by NDF have different luminance magnitudes even in the same parameter settings on the same dataset. This can be verified by the NDF-processed images shown in Fig. 11 V.

The Extended Yale B database [40] contains 38 subjects under 9 poses and 64 different illumination conditions. In our experiments, these images are cropped to 192×168. We use the neutral lighting images (one image per person), whose file names contain ‘A+000E+00’, for training, and the 5 subsets as the test sets. Again, the training images are used as the ideal images. The distance metrics and the classifier are the same as used in the CMU PIE database. We search the best λ
                           
                              x
                            and λ
                           
                              y
                            (λ
                           
                              x
                           
                           =0.27, λ
                           
                              y
                           
                           =0.01) for NDF according to its highest recognition rate in correlation distance on subset 1, and apply them on the other subsets.


                           Table 1 presents the recognition rates on the five subsets of this database. As the illumination of the subsets gets increasingly hard (from top to bottom), the merits of LHS-L become more and more obvious. On all the five subsets, LHS-L outperforms LHM in all the four metrics. Because LHS-L uses all the ideal images to estimate the local histograms instead of only one well illuminated average face used in LHM. So, LHS-L obtains more statistical information than LHM. This table also reflects that the most suitable metric for LHS-L and LHM is Chi-2, which agrees with the mechanisms of LHS-L, LHM and the Chi-2 distance metric. In essence, LHS-L and LHM try to adjust the local histograms of the test image to approach the training ones', and Chi-2 distance measures the similarities of the local histograms among the LBP images. Hence, the starting point of LHS-L and LHM is in accordance with the Chi-2 distance metric. Notably, as the lighting conditions of the subsets get increasingly hard, the performances of OLHE-
                              
                                 O
                                 3
                                 c
                              
                            and OLHE-
                              
                                 O
                                 3
                                 a
                              
                            decline greatly. From the last two images shown in Fig. 11(b) IV processed by OLHE-
                              
                                 O
                                 3
                                 a
                              
                            we find that OLHE-
                              
                                 O
                                 3
                                 a
                              
                            does not do a good job to normalize illumination on face images under difficult lighting conditions.

In normal lighting conditions, such as on subset 1, LHS-L does not get the best performance. As the simple HS is adopted in LHS-L rather than the exact HS methods for the sake of efficiency, over-enhancement is the biggest drawback of LHS-L. For an image in normal lighting condition, LHS-L will over-enhance the image thereby producing a worse image quality compared with other methods. Nonetheless, LHS-L gets competitive results with TT in Chi-2 distance in the normal lighting conditions (see the results on subset 1).

As a consequence, although in some moderate lighting conditions, LHS-L will not always achieve its best performance, the proposed LHS-L is the most effective and stable method in various similarity metrics in comparison with other methods.

The CAS-PEAL-R1 database [38] contains 30,900 images of 1040 subjects. Like [34], we use the gallery, the training set, and the lighting probe in our experiments, and all the images from the gallery are used as the ideal images. The lighting conditions on this database is not that extreme as those in the Extended Yale B subset 5, but the shadows are much sharper (see Fig. 11(c) I), thereby making it harder for the high frequency filters such as DoG to remove lighting variations.

For fair comparison, in our experiments, we use the same features and the same recognition method as in [34], i.e. the Kernel Linear Discriminant Analysis (KLDA [44]) is applied for dimensionality reduction (DR) on the LBP features [28,29] and Gabor features [30–33]. We rerun the code of TT and report the experimental results. Besides, in order to further improve the recognition rate on this database, we also use the recently proposed feature extraction approach: Monogenic Binary Coding (MBC) [45]. We extract the MBC with the code map for orientation (MBC-O) on face images. Since it has been verified that the block-based Fisher's linear discriminant (BFLD) [46] is good for MBC-O features [45], we apply BFLD on MBC-O features. For all the dimensionality reduced LBP, Gabor, and MBC-O features, the cosine distance matrices are calculated for them separately, and fused using the simple sum rule [34]. For our f-LHS-L, we vary α and w in our experiments. The λ
                           
                              x
                            and λ
                           
                              y
                            in NDF are set to 0.82 and 0.57, respectively. Table 2
                            reports the experimental results on this dataset.

It can be seen from Table 2 that when LBP+Gabor features are used, f-LHS-L gets the recognition rate 75.2%, which is 2.5% higher than previous best result of 72.7% [34] reported on this database using the same features and DR method. This shows the effectiveness of f-LHS-L. For LHS-L, the recognition rate is only 53.0% using Gabor features and 64.4% using LBP+Gabor features. This is because the Gabor features are very sensitive to the high frequency signals. Even a little over-enhancement will lead to significant influences on Gabor features. Therefore, LHS-L is not appropriate for Gabor features, and so are the local HS/HE based methods: LHM, OLHE-
                              
                                 O
                                 3
                                 c
                              
                            and OLHE-
                              
                                 O
                                 3
                                 a
                              
                           . By fusing LBP, Gabor, and MBC-O features, SQI, TT, NDF, LHS-L and f-LHS-L all get recognition rates over 76%. Among them, f-LHS-L achieves the highest result: 81.6%, which improves 8.9% compared to the previous best result of 72.7% reported in [34]. There are two main reasons for this. Firstly, the Gabor transformation generally extracts 5-scale and 8-orientation Gabor features of a face image, whereas MBC is based on monogenic signal representation [47] which is able to decompose an image into amplitude, phase, and orientation components. The MBC-O is the code map for orientation component representing the geometric information of a face image. Therefore, the signal decomposition strategies of Gabor transformation and monogenic signal representation are completely different. Secondly, the DR methods for Gabor features and the MBC-O features are different. The KLDA utilizes the kernel trick to cope with the manifold structures among face images, while BFLD is applied on each block of faces, hence more robust to expression variations. Consequently, the combination of heterogeneous face descriptors and subspace learning methods improves the recognition rates of various preprocessing methods significantly.


                           Fig. 12(a) shows the recognition rates of NDF, TT, LHS-L and f-LHS-L using LBP+Gabor features, w.r.t. the variation of α and w in f-LHS-L. From this figure we find that f-LHS-L is not sensitive to w, and when α is from 4 to 7, the recognition rates of f-LHS-L are all over 74.0%. f-LHS-L reaches its highest recognition rate 75.2% at α
                           =5 and w
                           =4.


                           Fig. 11 compares some images from three databases processed by different methods. From this figure, we find that images processed by NDF have different luminance magnitudes. See row 1,4 in Fig. 11(c) V for comparison. So, Chi-2 distance is not suitable for NDF-processed images. From row 1,2 of Fig. 11(b) VI and row 1-3 of Fig. 11(c) VI, we can see obvious drawbacks of TT. TT-processed face images are ruined by two-dimensional zero-crossing signals. Because DoG tends to let the high frequency signal pass, the obvious boundaries between dark and bright regions of the original images (see the corresponding images in Fig. 11 I) will always result in evident zero-crossing impulses on the processed images. Such high frequency signals also bring effects on the SQI-processed images (see Fig. 11 III). By contrast, LHS-L and f-LHS-L are able to reduce such signals significantly, yielding better image quality. See rows 1–2 of Fig. 11(b) VII and rows 1–3 of Fig. 11(c) VII. Moreover, the last 3 rows in Fig. 11(c) VI show that some face features have been impaired by TT, especially the eye features which are important features for face recognition, but such features can be enhanced by f-LHS-L (see the last 3 rows in Fig. 11(c) VII). Even though LHM is also able to eliminate illumination variations on face images (Fig. 11 II), images processed by LHM tend to have low contrast, and some facial details, such as the beard or the moles, are weakened.

As a consequence, based on the analysis, the proposed LHS-L and f-LHS-L provide recognition rates and image qualities competitive with or better than the state-of-the-art methods.

For a face recognition system, we do not hope that the preprocessing procedure takes up too much time. So we investigate the efficiency of different methods. For our LHS-L and f-LHS-L the core codes are implemented in C. All the experiments are carried out on a PC with an Intel(R) Core (TM)2 Quad 2.83GHz CPU with 8GB memory.


                           Table 3
                            presents the learning time on three databases: CMU PIE, Extended Yale B and the CAS-PEAL-R1 databases. The time consumption of learning local histogram statistics is less than that of learning local histograms. In this table, t1 and t2 are both related to image size. For example, the size of each image on the Extended Yale B database is about twice as many as that of each image on the CMU PIE database. In Table 3, the t1 and t2 of the Extended Yale B database are also approximately twice as much as those of the CMU PIE database. In Section 5, we have studied that 50 ideal images are enough for LHS-L and f-LHS-L to produce good results. Thus, the required total time consumption of learning the local histograms and histogram statistics is less than 1.0s. Furthermore, learning the local histograms and local histogram statistics is an offline process. For a particular database, the local histograms and local histogram statistics are learned in advance and used directly during the face recognition procedure. Fig. 12(b) depicts the learning time of local histogram statistics w.r.t. the variation of window radius w. As w increases, the learning time grows linearly. Even at w
                           =5, the learning time is approximately 2.75ms per 192×168 image. Thus, the offline learning of LHS-L and f-LHS-L is efficient.

The processing time of NDF, TT, LHS-L and f-LHS-L are shown in Fig. 13
                           . According to this figure, the most efficient method is NDF, followed by TT. For LHS-L, time consumptions are 16.3ms and 29ms for the 128×128 (the CAS-PEAL-R1 database) and 192×168 (the Extended Yale B database) images, respectively. When α is larger than 3, f-LHS-L processes a 128×128 image within 10ms and a 192×168 image within 20ms. Moreover, the smaller w, the less time f-LHS-L needs. Therefore, the efficiency of LHS-L and f-LHS-L is acceptable.

@&#CONCLUSIONS AND FUTURE WORK@&#

To eliminate high frequency illumination and enhance low frequency face features on face images are two most difficult problems and have been overlooked by most of the state-of-the-art face image preprocessors. In this paper, we try to address the two problems based on LHS. With the local histograms and local histogram statistics learned from the ideal face images, the proposed LHS-L and its flexible version f-LHS-L are able to significantly remove both the low and high frequency parts of illumination on face images, as well as enhance face features lying in the low frequency part. The ideal face images are face images captured under normal lighting conditions, and we suggest that the minimum numbers of ideal face images required for learning local histograms and histogram statistics be 20 and 50, respectively.

The preprocessed face images show that LHS-L and f-LHS-L are able to produce better image qualities than the state-of-the-art methods. The recognition rates show that LHS-L is competitive with or better than the state-of-the-art methods even using the simple χ
                     2 distance metric. By combining multiple face descriptors LBP, Gabor, and MBC-O, and fusing feature extraction methods KLDA and BFLD, we show that significant improvement could be achieved owing to the combination of the heterogeneous features and feature extractions methods.

In the future work, we will try to use some sophisticated histogram specification methods and apply the local histogram specification method directly on the original images.

@&#ACKNOWLEDGMENTS@&#

The authors would like to thank the editor and anonymous reviewers for their valuable comments and suggestions to improve the quality of this paper, Prof. Xiaoyang Tan for providing us the code for face image preprocessing and recognition, and Dr. Qinfeng Shi for helpful discussions. This work is supported in part by the National Natural Science Foundation of China under Grant Nos. 61272222 and 61003116, the Natural Science Foundation of Jiangsu Province of China under No. BK2011782, and Key (Major) Program of Natural Science Foundation of Jiangsu Province of China under No. BK2011005.

@&#REFERENCES@&#

