@&#MAIN-TITLE@&#On the verification of architectural reconfigurations

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           Describes approach to ensure fundamental principles of a system in reconfigurations.


                        
                        
                           
                           Specifies principles as constraints in an architectural description language.


                        
                        
                           
                           Translates constraints into a two-layer graded hybrid logic.


                        
                        
                           
                           Derives interpretation models from specifications of architectures and reconfigurations.


                        
                        
                           
                           Provides equivalence and refinement notions to compare reconfigurations.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Architectural reconfiguration

Architectural description language

Modal logic

Graded hybrid logic

@&#ABSTRACT@&#


               
               
                  In a reconfigurable system, the response to contextual or internal change may trigger reconfiguration events which, on their turn, activate scripts that change the system׳s architecture at runtime. To be safe, however, such reconfigurations are expected to obey the fundamental principles originally specified by its architect. This paper introduces an approach to ensure that such principles are observed along reconfigurations by verifying them against concrete specifications in a suitable logic. Architectures, reconfiguration scripts, and principles are specified in Archery, an architectural description language with formal semantics. Principles are encoded as constraints, which become formulas of a two-layer graded hybrid logic, where the upper layer restricts reconfigurations, and the lower layer constrains the resulting configurations. Constraints are verified by translating them into logic formulas, which are interpreted over models derived from Archery specifications of architectures and reconfigurations. Suitable notions of bisimulation and refinement, to which the architect may resort to compare configurations, are given, and their relationship with modal validity is discussed.
               
            

@&#INTRODUCTION@&#

The purpose of dynamic architectural reconfiguration [1] is to maintain the quality level of a system as contextual or internal conditions vary. This is primarily achieved through a combination of sensors, which somehow measure the system, and actuators, i.e., scripts which modify the system׳s architecture under specified situations. Reconfigurations, however, may disrupt the basic design principles, originally fixed by the architectural patterns in use. Therefore, a mechanism is required to ensure that emerging reconfigurations conform to the design principles, regardless of how they take place.

This paper introduces an approach to provide such a mechanism. It focuses on reconfigurations that constitute undesired sequences of change, or that lead to forbidden configurations. Design principles are specified as formulas in a modal logic, and then are verified against models of reconfigurations. For this, we extend an architectural description language (ADL) [2] called Archery
                     
                     [3,4], which is a domain specific language 
                     [5] used to animate, analyse and verify system׳s architectures. It is organized as a core and a number of modules. The core is for modelling architectures in terms of architectural patterns, and the modules are for specifying constraints and reconfiguration scripts. A constraint restricts either structure, behaviour or possible reconfigurations of a system. Reconfiguration scripts are executed by a configuration manager when conditions, specified as constraints, hold. The language semantics is given by a translation into a process algebra [3], for the behavioural part, and by an encoding into bigraphical reactive systems [4], for the structural part. Constraints are translated into a modal logic and are verified against models derived from architectural specifications [6–8]. We extend Archery׳s syntax and the underlying mathematical framework to support models and properties of reconfigurations.

The underlying logic proposed here is a two-layer graded hybrid logic. As usual in modal logic, models are relational structures over a state space (whose elements are called worlds, states, or points). Being hybrid, the logic is equipped with both nominals and a reference operator. The former is a proposition that is only satisfied at the world it identifies. The latter constrains a formula to hold at the world named by a specified nominal. Together they make possible to express, for instance, that two worlds are identical, or that their relationship is irreflexive. Other features of the logic are its hierarchical character [9], which enforce two layers of description, the use of graded modalities to describe the cardinality of relations, and operations to select and iterate over a set of relations. Hierarchical formulas allow us to describe models organized into layers of abstraction, which result from the common practice of refining a world into a more elaborated model. Data parameters are also allowed in relations.

Notions of simulation and bisimulation are introduced for models of this logic. They provide refinement and equivalence relations, respectively, in order to discuss whether a script can replace, or be interchanged, with another.

Global properties of the logic are studied. Reconfiguration scripts are said to be equivalent if, and only if, they satisfy the same formulas. Preservation of modal equivalence by bisimilarity is proved, and a full Hennessy–Milner like theorem arises for the non-graded fragment.

In this context, the contributions of the article are an ADL to define two-level constraints whose first level describes reconfigurations and the second, the resulting configurations; the characterization of the associated logic as well as of suitable notions of model bisimulation and refinement; a derivation of models from architectural specifications; and finally a translation that takes constraints and yields a formula in the two-layer graded hybrid logic. Behavioural constraints and triggers are not dealt here; the interested reader is referred to the first author forthcoming thesis [10].

The approach proposed here is illustrated with a fragment of the blood transfusion process, the architecture of a medical procedure which is critical in the sense that it may involve risk to patients [11]. In particular, it requires ensuring blood compatibility between the donor and the patient, since an incompatible transfusion can cause a reaction with fatal consequences. A major source of these incidents is misidentification, which might occur at stages of the process that require checking patient׳s identity, or handling material with patient identification data. Architectural principles are laid down to prevent misidentification, and the approach is used to verify them.


                     Organization: After describing the blood transfusion example in Section 2, a background summary of the Archery
                     language is provided in Section 3, Section 4 presents the logic, introduces bisimulation and refinement relations, and studies their properties. Section 5 introduces the derivation of models, the translation of constraints, and illustrates the approach with the verification of some constraints from the example. Then Section 6 describes related work, and Section 7 sums up and mentions ongoing and future work.

The example process starts after a blood transfusion is prescribed to a patient and ends when the patient is discharged. The procedure is supported by a software system, accessed through mobile devices by the involved staff that includes a physician, nurses, and the administration. It requires collecting a blood sample from the patient, establishing blood group and factor, selecting suitable blood units, performing the actual transfusion, and monitoring the patient for a given period of time. The patient is discharged when such period ends without any adverse reaction being observed. Fig. 1
                      depicts an example configuration using an informal notation, in which white rectangles represent components, small grey rectangles, ports, and arrows, interactions. It includes a patient (pat), a physician (phy), two nurses (n1 and n2), and the administration (adm).

The staff, however, may change during the procedure. Nurses can enter (leave, resp.) the ward, and can be assigned (unassigned, resp.) to (from, resp.) a blood transfusion patient. These changes must avoid configurations in which a misidentification is more likely to occur, and proceed under the supervision of the administration.

Consider, for instance, the sequence of reconfigurations represented by the transition system on the left of Fig. 2
                      that substitutes nurse n2 with n3. We focus on configurations 
                        
                           
                              c
                           
                           
                              0
                           
                        
                     , 
                        
                           
                              c
                           
                           
                              3
                           
                        
                     , 
                        
                           
                              c
                           
                           
                              5
                           
                        
                     , and c
                     7, which are refined into (informal) architectural diagrams on the right. Configuration c
                     0 is similar to that described in Fig. 1. In configuration c
                     3, a nurse (n3) has entered the ward and checked in with administration, the latter represented by the two connections between n3 and adm. Then, nurse n2 is unassigned from patient pat, which is represented in c
                     5 by the absence of connections between them. Subsequently, nurse n3 is assigned to the patient and the result is shown in configuration c
                     7. The sequence finalizes with nurse n2 leaving the ward (removed from the configuration).

Several architectural principles are defined to prevent configurations in which a misidentification might occur. It is requested that a physician and at least two nurses are assigned to each patient undergoing a blood transfusion. The physician orders and monitors the procedure, one nurse leads it, and the other assists the former to prevent a misidentification. Then, it must be kept invariant in every configuration that any patient must have (S1) a designated physician; and (S2) at least two nurses assigned. Changes, on the other hand, must observe the following constraints: (R1) upon entering a ward, a nurse must check-in with administration before receiving any patient assignment; (R2 ) a nurse cannot be unassigned from a patient if less than two nurses are left assigned; and (R3) a nurse must have no assignments before checking out with administration and leaving.

In the example, configuration c
                     5 does not satisfy S2. We use reconfiguration constraints to ensure that changes observe these requirements, and avoid error-prone situations.

The specification of an architecture comprises one or more (architectural) patterns, a main architecture, and data specifications. A pattern defines (architectural) elements (components and connectors) and might have associated constraints (see syntax in Fig. 3
                        ). For instance, pattern Ward defines elements Patient, Physician, Nurse, and Administration in Listing 1 to represent configurations that carry out blood transfusions.
                           Listing 1
                           Blood transfusion pattern. 
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Each element includes an interface that contains one or more ports, each of which is defined by a polarity, a port type, and a name. The polarity indicates how communication among attached ports flows, and can be either in
                        or out. Ports are synchronous: actually a suitable process algebra expression can be used to emulate any other port behaviour. The port type indicates how many participants are necessary for a communication to take place, and can be either and, xor, or or. While an and
                        port requires all attached participants to synchronise, a xor
                        port requires exactly one. In between, an interaction with an or
                        port requires at least one, but it may include any number of participants. For instance, the interface of Administration defines xor
                        ports patI and patO. An element can optionally include a behaviour: a set of actions, and a set of process descriptions expressed in a subset of the 
                           mCRL
                           2
                         process algebra. The sequel focuses on the structural dimension and excludes such behavioural specifications.

Instances – architectures and element instances – are defined according to the syntax in Fig. 4
                        . They are stored in variables that are defined by an identifier and a type that must match an element or pattern name. See, for instance, line 1 of Listing 2. Allowed values are instances of a type (element or pattern), that do not necessarily need to match the variable׳s own type. 
                           Listing 2
                           A configuration for performing a blood transfusion. 
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

An architecture describes the configuration a set of instances adopt. It contains a token that must match a pattern name, a set of variables, an optional set of attachments, and an optional interface. The type of each variable in the set is limited to an element in the pattern the architecture is instance of. An attachment indicates which output port communicates with which input port; each includes port references to an output and to an input port. A port reference is an ordered pair of identifiers: the first one matching a variable identifier, and the second matching a port of the variable׳s instance. For instance, the attachments in the example configuration connect two nurses with a patient and the administration. The architecture interface is a set of one or more port renamings. Each port renaming contains a port reference and a token with the external name of the port. Ports not included in this set are not visible from the outside. An architecture can have associated constraints, which are defined as described in Section 3.3.

Reconfiguration scripts are sequences of operations that affect the structure of architectures. Configuration managers execute them when the associated triggering conditions are met. They also have the ability to stop, reconfigure, and restart architectures from a given state.

Reconfiguration operations are devoted to the creation and removal of instances, attachments, renamings and variables, as well as to the movement of instances. Table 1
                         shows name, format, and a brief description of them.

Scripts that change configurations by performing a blood transfusion are shown in Listing 3. Moving a Nurse (instance) into a Ward (configuration) represents allowing the nurse in. Attaching a Nurse to Administration materializes checking the nurse in. Similarly, if the attachment is to a Patient, it represents assigning the nurse to the patient. These scripts are triggered by constraints that describe behaviour the participants show.
                           Listing 3
                           Reconfiguration scripts for nurse management. 
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

For instance, the sequence of reconfigurations shown in Fig. 2 is the result of executing such scripts as follows:
                           
                              •
                              
                                 enter(w,n3) lets nurse n3 in,


                                 checkIn(n3,adm) checks n3 in (conf. c
                                 3),


                                 unassign(pat,n2) unassigns nurse n2 from the patient (conf. c
                                 5),


                                 assign(pat,n2) assigns n2 to the patient (conf. c
                                 5), and


                                 leave(n2) lets nurse n2 out of the ward.

The constraint language allows us to precisely describe design decisions by associating constraints to a pattern, or to a pattern instance [7]. A constraint restricts design dimensions – structure, behaviour, or reconfigurations – through one or more formula declarations (see Fig. 5
                        ).

The language for declaring formulas is defined generically. The actual languages are instances of it, obtained by making constructs specific to the design dimension that is intended to be restricted. We present the generic language and instances for specifying both (i) constraints over structure; and (ii) two-layer constraints whose upper and lower layers restrict reconfigurations and obtained structures.

A formula is interpreted from a local and internal point of view over a model 
                              M
                            – a labelled graph whose nodes W are called worlds. Each edge is labelled by a modal symbol M, taken from a set Mod. A modal symbol identifies an accessibility relation 
                           
                              R
                              [
                              M
                              ]
                            in 
                              W
                              ×
                              W
                           , where an ordered pair 
                              (
                              
                                 
                                    w
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    w
                                 
                                 
                                    2
                                 
                              
                              )
                            indicates that it is possible to access w
                           2 from w
                           1 through an edge with label M. Formulas are interpreted at a specific world within 
                              M
                           . But note that in a two-layer model 
                              M
                           , there is a model 
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                            associated to each w in 
                              M
                           .

Actual models are derived from specifications of architectures and their reconfigurations. The resulting graphs correspond to a metamodel given by the dimension being restricted [12]. The two corresponding metamodels are presented as a class diagram, and define the structure of such graphs. The diagrams present the types of nodes and how their instances are related. Modal symbols (relation labels in the diagram) name relations between either constituents of an architecture, or two configurations, where the second is obtained upon executing an operation to the first, in a reconfiguration sequence. In the latter case, a syntax for the structure of symbols, which represent the execution of reconfiguration operations, is also provided.

The language provides symbol terms 
                           
                              
                                 
                                    SymT
                                 
                              
                            to match symbols according to their structure. They are built upon atomic symbols and filters. A filter is either a path identifying a configuration variable, a configuration variable type, a variable for configuration variables, or a port identifier. Actual atomic symbols and filter combinations depend on the language instantiation.


                           Symbol formulas 
                           
                              
                                 
                                    SymF
                                 
                              
                            allow for selecting and operating upon sets of symbols, and binding variables in symbol terms (see Fig. 6
                           ). A symbol formula can be either a symbol term, a constant, a negated symbol formula, a conjunction, a disjunction, or a quantifier. Constants 
                              
                                 
                                    true
                                 
                              
                            and 
                              
                                 
                                    false
                                 
                              
                            represent the universe (Mod) and the empty sets, respectively. Negation, conjunction and disjunction represent the corresponding set operations of complement, intersection and union. Quantifiers bind configuration variables in filters. A type in a filter is a simplified version of an existential quantifier. The relations that a 
                              
                                 
                                    SymF
                                 
                              
                            selects are called 
                              
                                 
                                    SymF
                                 
                              
                              -
                              relations
                           .

Formula declarations consist of an identifier, optional configuration parameters, and a formula (see Fig. 7
                           ). Configuration parameters are used to let pass identifiers of configuration variables to a formula.

A formula 
                           
                              
                                 
                                    F
                                 
                              
                            is either a propositional formula, a modal formula, a graded modality formula, a hybrid formula, a quantifier, or a nested formula. Propositional, modal, and graded formulas describe the model in terms of the underlying metamodel. A proposition characterizes a feature in a given world. Modal and graded operators scan worlds according to accessibility relations passed as a parameter in the form of a relation formula 
                              
                                 
                                    RelF
                                 
                              
                           .


                           Relation formulas combine relations. A relation formula 
                              
                                 
                                    RelF
                                 
                              
                            is either a symbol formula, a concatenation, a union, or an iteration. A concatenation returns the composition of two relations, and a union their union. An iteration is the successive concatenation of relations defined by a relation formula. There are two types: one that admits the absence of the relation, and one that requires at least one occurrence of it.

In a modal formula, a possibly formula 
                           
                              〈
                              
                                 
                                    RelF
                                 
                              
                              〉
                            
                           
                              
                                 
                                    F
                                 
                              
                            indicates that the present world is 
                              
                                 
                                    RelF
                                 
                              
                              -
                              related
                            with another world satisfying (formula) 
                              
                                 
                                    F
                                 
                              
                           , whereas a necessarily formula 
                           
                              [
                              
                                 
                                    RelF
                                 
                              
                              ]
                            
                           
                              
                                 
                                    F
                                 
                              
                            indicates that any 
                              
                                 
                                    RelF
                                 
                              
                              -
                              relationship
                            from the present world leads to a world satisfying 
                              
                                 
                                    F
                                 
                              
                           .

Similarly, graded modality formulas come in two flavours as well. An at least formula 
                           
                              〈
                              
                                 n
                              
                              ,
                              
                                 
                                    RelF
                                 
                              
                              〉
                              
                                 
                                    F
                                 
                              
                            that is satisfied at worlds where 
                              
                                 
                                    F
                                 
                              
                            holds in at least n+1 
                           
                              
                                 
                                    RelF
                                 
                              
                              -
                              related
                            worlds, and an all but formula 
                           
                              [
                              
                                 n
                              
                              ,
                              
                                 
                                    RelF
                                 
                              
                              ]
                            
                           
                              
                                 
                                    F
                                 
                              
                            that describes worlds where 
                              
                                 
                                    F
                                 
                              
                            holds in all but at most n 
                           
                              
                                 
                                    RelF
                                 
                              
                              -
                              related
                            worlds.


                           Hybrid formulas are built of a nominal 
                           
                              
                                 
                                    I
                                 
                              
                           , which is satisfied if the current world is the unique world referenced by such 
                              
                                 
                                    I
                                 
                              
                           , and of a reference operator 
                           
                              
                                 
                                    at
                                 
                              
                            
                           
                              
                                 
                                    I
                                 
                              
                            
                           
                              
                                 
                                    F
                                 
                              
                           , satisfied if at the world named by 
                              
                                 
                                    I
                                 
                              
                           , 
                              
                                 
                                    F
                                 
                              
                            is.

A nested formula consists of an identifier, and actual configuration parameters, and describes nested models. The usage of configuration parameters by nested constraints depends on the restricted dimension. Language instances vary in the constructs they offer, as it is indicated on their introduction.

Models for interpreting structural constraints are derived from architectures, according to the metamodel shown in Fig. 8
                           . Worlds are instances, ports, actions, variables, port references, attachments, names, and renamings. The relationships among worlds conform the relations in function R, and their labels become plain atomic modal symbols ASYM. For convenience, the extra symbols attd
                           and evt
                           are also included. The former identifies the relationship between two worlds representing variables connected through an attachment. It is obtained as 
                              R
                              
                                 
                                    [
                                    
                                       vref
                                    
                                    ]
                                 
                                 
                                    ○
                                 
                              
                              ○
                              R
                              
                                 
                                    [
                                    
                                       strt
                                    
                                    ]
                                 
                                 
                                    ○
                                 
                              
                              ○
                              R
                              [
                              
                                 end
                              
                              ]
                              ○
                              R
                              [
                              
                                 vref
                              
                              ]
                           , where 
                              R
                              
                                 
                                    [
                                    s
                                    ]
                                 
                                 
                                    ○
                                 
                              
                            denotes the converse of a relation. The latter is obtained as 
                              R
                              [
                              
                                 prt
                              
                              ]
                              ∪
                              R
                              [
                              
                                 act
                              
                              ]
                           .

Propositions are classified as follows: (a) Naming propositions that hold when evaluated at a (world) w representing an action or port with their name. They exist for each name used in actions and ports. (b) Meta-type propositions that hold when w belongs to a specific participant set, e.g., PatternInstance. (c) Emptiness proposition (namely Empty) that holds when w is a variable with no associated instance. (d) Type propositions that test if w is an instance or a variable of a type in the specification. For example, the Ward pattern generates propositions Ward, Physician, Patient, Nurse, and Administration.

Each variable in an architectural specification defines a nominal in the set Nom. Each nominal holds exactly at the world that represents the corresponding variable. In addition, they are also included in a subset Nom
                           
                              TYPE
                           , depending on the variable׳s type. Variables and parameters in formulas are bound to nominals.

Structural constraints that specify requirements S1 and S2 are shown in Listing 4. In both cases, a parameter p receives a nominal referencing (a world that represents) a patient. The first constraint requires the specific patient to have an attached physician. It uses a reference operator that holds if the rest of the constraint holds at the patient. This happens when a physician is attached to the patient in the configuration, which is indicated with a possibly operator for the relation that attachments in configurations give rise to. The second constraint requires the patient to have at least two nurses assigned. The at least operator is used in this case to indicate that a number of nurses, greater than one, are expected to be attached to the patient. 
                              Listing 4
                              Nurses per patient. 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

Interpretation models for reconfiguration constraints have two layers. Each world represents a configuration and has an associated model for interpreting nested structural constraints. Relationships represent reconfiguration operations.

The metamodel for reconfigurations consists of a single type and a reflexive relation (see Fig. 9
                           ). The type represents configurations that an architecture may adopt, and the reflexive relation stands for a family of relations among configurations. An ordered pair of configurations is in one of such relations whenever a reconfiguration operation leads from the first to the second configuration. Relation labels vary according to the operation and to its parameters. Then, worlds and symbols of the model correspond to configurations and reconfiguration operations, respectively.

Reconfiguration constraints exclude nominals, and redefine symbol terms to yield symbols that represent actual reconfiguration operations. Symbol terms consist of an operation name and filters, according to the syntax shown in Fig. 10
                           , allowing us to match operation invocations (see Table 1).

The reconfiguration constraint in Listing 5 specifies restriction R1 that ensures that a nurse first checks-in and then receives patient assignments. Assume the initial configuration in Listing 2, and a nurse in a variable n3. A sequence of script executions will not satisfy the constraint if it allows the nurse in, and assigns the nurse to a patient, without checking the nurse in. 
                              Listing 5
                              No assignment before check-in. 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

Reconfiguration constraint in Listing 6 specifies R2. It ensures that any sequence of scripts that unassigns a nurse leaves enough assigned. Again, assume that a sequence of scripts are triggered replacing nurse n2 with nurse n3 in the initial configuration, such as in Fig. 2. Since the sequence executes the unassignmet first, it fails to satisfy the constraint, because it leaves the patient with only nurse n1 assigned. Note that the nested constraint only checks the situation of the patient whom nurse has been unassigned.
                              Listing 6
                              All unassigments leave enough nurses assigned to patients. 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

Reconfiguration constraint in Listing 7 checks restriction R3, which ensures that any checkout takes place if the nurse has no patient assigned. It fails if, for instance, in a reconfiguration sequence such as the one in Fig. 2, nurse n2 is checked out without unassigning the patient first.
                              Listing 7
                              No assignments before checking-out. 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

Under some circumstances it is interesting to relax structural constraints during the execution of a sequence of scripts, as long as they hold in the final configuration. For instance, when a patient enters, it may initially not have a physician and nurses assigned to him. The constraint in Listing 8 establishes that properties S1 and S2 must hold whenever a sequence of scripts cannot progress.
                              Listing 8
                              Patients safe configurations. 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

Underlying the semantics of architectural descriptions and reconfigurations in Archery, is a powerful logic enabling the description of two-layer models, the reference to possible states (i.e. configurations) as well as to relations between them and their cardinality. As usual, such relations are denoted by modal symbols.

Formulas are called state formulas and are built upon regular formulas that define strings of modal symbols, which in turn are taken from sets given by symbol formulas. Their designation comes from their interpretation as (the) sets of states (in which they hold).

Symbol formulas, on the other hand, are interpreted as sets of modal symbols, and built as described in Definition 1. Modal symbols may take a data expression as a parameter, which is either a variable v or a function f with data expressions 
                           e
                           ,
                           …
                           ,
                           e
                         as parameters. Symbol formulas represent sets as follows: an atomic modal symbol m is a singleton set 
                           {
                           m
                           }
                        ; the symbol 
                           ⊤
                         is the set Sym of all atomic modal symbols in the model; the negation 
                           ¬
                           α
                         is the complement of the set given by α; the conjunction 
                           α
                           ∧
                           
                              
                                 α
                              
                              
                                 ′
                              
                           
                         is the intersection of the sets given by α and 
                           
                              
                                 α
                              
                              
                                 ′
                              
                           
                        ; an atomic modal symbol with a data parameter m(e) is the singleton set 
                           {
                           m
                           (
                           a
                           )
                           }
                        , where a is the value obtained upon evaluating e; and the universal quantifier 
                           ∀
                           v
                           
                           :
                           
                           D
                           .
                           α
                         is the union of the sets obtained upon replacing v with each possible a in the set given by α.
                           Definition 1
                           Symbol formulas


                           Let 
                                 DVar
                               and 
                                 Func
                               be disjoint sets of variables and function symbols, respectively. The set Exp of data expressions is recursively defined by 
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       ∋
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             f
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                              for 
                                 k
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                               where 
                                 
                                    
                                       v
                                    
                                    
                                       k
                                    
                                 
                                 ∈
                                 
                                    
                                       DVar
                                    
                                    
                                       k
                                    
                                 
                               has a type D
                              
                                 k
                              , and 
                                 
                                    
                                       f
                                    
                                    
                                       k
                                    
                                 
                                 ∈
                                 
                                    
                                       Func
                                    
                                    
                                       k
                                    
                                 
                               has type 
                                 
                                    
                                       D
                                    
                                    
                                       k
                                    
                                 
                                 ×
                                 …
                                 ×
                                 
                                    
                                       D
                                    
                                    
                                       k
                                    
                                 
                                 →
                                 
                                    
                                       D
                                    
                                    
                                       k
                                    
                                 
                              . Let Sym be a set of atomic modal symbols. The set MForm of symbol formulas is recursively defined, for 
                                 k
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                              , by 
                                 
                                    
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       ∋
                                       
                                          
                                             m
                                          
                                          
                                             k
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             ⊤
                                          
                                          
                                             k
                                          
                                       
                                       
                                       ∣
                                       
                                       ¬
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       ∧
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             m
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       e
                                       )
                                       
                                       ∣
                                       
                                       ∀
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       
                                       :
                                       
                                       
                                          
                                             D
                                          
                                          
                                             k
                                          
                                       
                                       .
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              where 
                                 
                                    
                                       m
                                    
                                    
                                       k
                                    
                                 
                                 ∈
                                 
                                    
                                       Sym
                                    
                                    
                                       k
                                    
                                 
                              .□

For simplicity, a single data parameter is used in formulas. Multiple data parameters are obtained through projections of a composite data sort. At each level, the following operators are given by abbreviation: 
                           
                              
                                 ⊥
                                 =
                                 ¬
                                 ⊤
                                 ,
                                 
                                 α
                                 ∨
                                 α
                                 =
                                 ¬
                                 (
                                 ¬
                                 α
                                 ∧
                                 ¬
                                 α
                                 )
                                 ,
                                 
                                 ∃
                                 v
                                 
                                 :
                                 
                                 D
                                 .
                                 α
                                 =
                                 ¬
                                 ∀
                                 v
                                 
                                 :
                                 
                                 D
                                 .
                                 ¬
                                 α
                                 .
                              
                           
                        
                     

Regular formulas are defined according to the grammar in Definition 2. At both levels, their constructs are concatenation (
                           β
                           .
                           β
                        ), sum (
                           β
                           +
                           β
                        ) and iteration (
                           
                              
                                 β
                              
                              
                                 ⁎
                              
                           
                        ), which are interpreted as relational composition, union and transitive reflexive closure, respectively. Additionally, the transitive closure β
                        + is given by 
                           β
                           .
                           
                              
                                 β
                              
                              
                                 ⁎
                              
                           
                        . 
                           Definition 2
                           Regular formulas


                           The set RForm of regular formulas is recursively defined by 
                                 
                                    
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       ∋
                                       
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       .
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                          
                                             ⁎
                                          
                                       
                                    
                                 
                              for 
                                 k
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                               where 
                                 
                                    
                                       α
                                    
                                    
                                       k
                                    
                                 
                                 ∈
                                 MForm
                              .□

State formulas are formed according to the grammar in Definition 3. At both levels, a formula is either a nominal (i), a proposition (p), a negation (
                           ¬
                           φ
                        ), a conjunction (
                           φ
                           ∧
                           φ
                        ), a possibility (
                           〈
                           β
                           〉
                           φ
                        ), a graded possibility (
                           〈
                           n
                           ,
                           β
                           〉
                           φ
                        ), or local reference (
                           
                              
                                 @
                              
                              
                                 i
                              
                           
                           φ
                        ) to a state I. State formulas describe two-layer models by allowing basic constructs φ
                        
                           b
                        
                        1 at level 0.
                           Definition 3
                           State formulas


                           A signature is an n-family of disjoint, possibly empty, sets of symbols 
                                 Δ
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             Prop
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             Nom
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                              . The set 
                                 SForm
                                 (
                                 Δ
                                 )
                               of state formulas is recursively defined as 
                                 
                                    
                                       
                                          
                                             φ
                                          
                                          
                                             0
                                          
                                       
                                       ∋
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                          
                                             b
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             i
                                          
                                          
                                             0
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             p
                                          
                                          
                                             0
                                          
                                       
                                       
                                       ∣
                                       
                                       ¬
                                       
                                          
                                             φ
                                          
                                          
                                             0
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             0
                                          
                                       
                                       ∧
                                       
                                          
                                             φ
                                          
                                          
                                             0
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             〈
                                             β
                                             〉
                                          
                                          
                                             0
                                          
                                       
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             0
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             〈
                                             n
                                             ,
                                             β
                                             〉
                                          
                                          
                                             0
                                          
                                       
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             0
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             @
                                          
                                          
                                             
                                                
                                                   i
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                              and
                                 
                                    
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                          
                                             b
                                          
                                       
                                       ∋
                                       
                                          
                                             p
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             i
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             〈
                                             β
                                             〉
                                          
                                          
                                             1
                                          
                                       
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             〈
                                             n
                                             ,
                                             β
                                             〉
                                          
                                          
                                             1
                                          
                                       
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             @
                                          
                                          
                                             
                                                
                                                   i
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                       ∋
                                       
                                          
                                             i
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             p
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ∣
                                       
                                       ¬
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                       ∧
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             〈
                                             β
                                             〉
                                          
                                          
                                             1
                                          
                                       
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             〈
                                             n
                                             ,
                                             β
                                             〉
                                          
                                          
                                             1
                                          
                                       
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ∣
                                       
                                       
                                          
                                             @
                                          
                                          
                                             
                                                
                                                   i
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                              where 
                                 
                                    
                                       p
                                    
                                    
                                       k
                                    
                                 
                                 ∈
                                 
                                    
                                       Prop
                                    
                                    
                                       k
                                    
                                 
                              , and 
                                 
                                    
                                       i
                                    
                                    
                                       k
                                    
                                 
                                 ∈
                                 
                                    
                                       Nom
                                    
                                    
                                       k
                                    
                                 
                               for 
                                 k
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                              .□

Additionally, at both levels, the following constructs are defined by abbreviation:
                           
                              
                                 
                                 ⊥
                                 =
                                 ¬
                                 ⊤
                                 ,
                                 
                                 
                                    
                                       φ
                                    
                                    
                                       1
                                    
                                 
                                 ∨
                                 
                                    
                                       φ
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 ¬
                                 (
                                 ¬
                                 
                                    
                                       φ
                                    
                                    
                                       1
                                    
                                 
                                 ∧
                                 ¬
                                 
                                    
                                       φ
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 
                                    
                                       φ
                                    
                                    
                                       1
                                    
                                 
                                 →
                                 
                                    
                                       φ
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 ¬
                                 
                                    
                                       φ
                                    
                                    
                                       1
                                    
                                 
                                 ∨
                                 
                                    
                                       φ
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       φ
                                    
                                    
                                       1
                                    
                                 
                                 ↔
                                 
                                    
                                       φ
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       φ
                                    
                                    
                                       1
                                    
                                 
                                 →
                                 
                                    
                                       φ
                                    
                                    
                                       2
                                    
                                 
                                 ∧
                                 
                                    
                                       φ
                                    
                                    
                                       2
                                    
                                 
                                 →
                                 
                                    
                                       φ
                                    
                                    
                                       1
                                    
                                 
                                 
                                 [
                                 β
                                 ]
                                 φ
                                 =
                                 ¬
                                 〈
                                 β
                                 〉
                                 ¬
                                 φ
                                 ,
                                 
                                 ¬
                                 〈
                                 n
                                 ,
                                 β
                                 〉
                                 φ
                                 =
                                 [
                                 n
                                 ,
                                 β
                                 ]
                                 ¬
                                 φ
                              
                           
                        
                     


                        
                           Definition 4
                           2-layer model


                           A 2-layer model 
                                 M
                                 ∈
                                 Model
                                 (
                                 Δ
                                 )
                               is a tuple 
                                 M
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             W
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               recursively defined as follows:
                                 
                                    •
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      W
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                             
                                                k
                                                ∈
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                          
                                        are disjoint sets;


                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                             
                                                k
                                                ∈
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                          
                                        are predicates with 
                                          
                                             
                                                Q
                                             
                                             
                                                0
                                             
                                          
                                          ⊆
                                          
                                             
                                                W
                                             
                                             
                                                0
                                             
                                          
                                        and 
                                          
                                             
                                                Q
                                             
                                             
                                                1
                                             
                                          
                                          ⊆
                                          
                                             
                                                W
                                             
                                             
                                                0
                                             
                                          
                                          ×
                                          
                                             
                                                W
                                             
                                             
                                                1
                                             
                                          
                                        such that 
                                          
                                             
                                                
                                                   
                                                      W
                                                   
                                                   
                                                      1
                                                   
                                                
                                                =
                                                {
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      1
                                                   
                                                
                                                :
                                                ∃
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      W
                                                   
                                                   
                                                      0
                                                   
                                                
                                                .
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      0
                                                   
                                                
                                                (
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      0
                                                   
                                                
                                                )
                                                ∧
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      1
                                                   
                                                
                                                (
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ,
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      1
                                                   
                                                
                                                )
                                                }
                                                ;
                                             
                                          
                                       
                                    


                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      k
                                                   
                                                
                                                :
                                                
                                                   
                                                      Mod
                                                   
                                                   
                                                      k
                                                   
                                                
                                                →
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ×
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                             
                                                k
                                                ∈
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                          
                                        is a pair of functions; and


                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      Prop
                                                   
                                                
                                                ,
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      Nom
                                                   
                                                
                                                )
                                             
                                             
                                                k
                                                ∈
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                          
                                        are pairs of functions:
                                          
                                             ○
                                             
                                                
                                                   
                                                      
                                                         V
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         Prop
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         Prop
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   →
                                                   P
                                                   (
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   )
                                                 and 
                                                   
                                                      
                                                         V
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         Prop
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         Prop
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ×
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   →
                                                   P
                                                   (
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                , and


                                                
                                                   
                                                      
                                                         V
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         Nom
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         Nom
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   →
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                 and 
                                                   
                                                      
                                                         V
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         Nom
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         Nom
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   →
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                .

Let us fix the following notation: expression 
                           m
                           [
                           d
                           ↦
                           r
                           ]
                         denotes a map 
                           
                              
                                 m
                              
                              
                                 ′
                              
                           
                         in which 
                           
                              
                                 m
                              
                              
                                 ′
                              
                           
                           (
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                           )
                           =
                           m
                           (
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                           )
                         for all 
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                           ≠
                           d
                         and 
                           
                              
                                 m
                              
                              
                                 ′
                              
                           
                           (
                           d
                           )
                           =
                           r
                         otherwise; 
                           supp
                           (
                           m
                           )
                         denotes the set of values mapped by 
                           m
                         and is called its support.
                           Definition 5
                           Satisfaction


                           Let 
                                 D
                               denote the set of values of a variable v of type D, and let 
                                 v
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               be a pair of data environments. The value of a data expression is given by a pair of interpretation functions 
                                 
                                    
                                       (
                                       〚
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       :
                                       Exp
                                       →
                                       
                                          
                                             D
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               given by 
                                 
                                    
                                       〚
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       ,
                                       
                                       〚
                                       
                                          
                                             f
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       …
                                       
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       
                                          
                                             f
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       〚
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ,
                                       …
                                       ,
                                       〚
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       )
                                       ,
                                    
                                 
                              parametric on a data environment 
                                 
                                    
                                       v
                                    
                                    
                                       k
                                    
                                 
                                 :
                                 
                                    
                                       DVar
                                    
                                    
                                       k
                                    
                                 
                                 →
                                 
                                    
                                       D
                                    
                                    
                                       k
                                    
                                 
                               that assigns a value to a variable, and such that 
                                 var
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                                 )
                                 ⊆
                                 supp
                                 (
                                 
                                    
                                       v
                                    
                                    
                                       k
                                    
                                 
                                 )
                              , where 
                                 var
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                                 )
                               denotes the variables occurring in an expression e
                              
                                 k
                              .

The interpretation of a symbol formula is given by a pair of functions 
                                 
                                    
                                       (
                                       〚
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       :
                                       MForm
                                       →
                                       
                                          
                                             Mod
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               defined inductively as
                                 
                                    
                                       
                                       〚
                                       
                                          
                                             m
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       {
                                       
                                          
                                             m
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       〚
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       )
                                       }
                                       ,
                                       
                                       〚
                                       
                                          
                                             ⊤
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       
                                          
                                             Mod
                                          
                                          
                                             k
                                          
                                       
                                       〚
                                       ¬
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       
                                          
                                             Mod
                                          
                                          
                                             k
                                          
                                       
                                       ⧹
                                       〚
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ,
                                       
                                       〚
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       ∧
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       〚
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ∩
                                       〚
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       〚
                                       ∀
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       
                                       :
                                       
                                       
                                          
                                             D
                                          
                                          
                                             k
                                          
                                       
                                       .
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       
                                          
                                             ⋂
                                          
                                          
                                             a
                                             :
                                             
                                                
                                                   D
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       〚
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             〛
                                          
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       ,
                                    
                                 
                              where 
                                 
                                    
                                       v
                                    
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       v
                                    
                                    
                                       k
                                    
                                 
                                 [
                                 v
                                 ↦
                                 a
                                 ]
                              .

The interpretation of a regular formula is given by a pair of functions 
                                 
                                    
                                       (
                                       ∥
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       :
                                       RForm
                                       →
                                       
                                          
                                             Rel
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               defined inductively as follows:
                                 
                                    
                                       
                                       ∥
                                       α
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       {
                                       (
                                       w
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       :
                                       (
                                       w
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       ∈
                                       R
                                       [
                                       s
                                       ]
                                       
                                       for
                                       
                                       some
                                       
                                       s
                                       ∈
                                       〚
                                       α
                                       
                                          
                                             〛
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       }
                                       ∥
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       .
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       ∥
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ○
                                       ∥
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ∥
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       ∥
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ∪
                                       ∥
                                       
                                          
                                             β
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ∥
                                       
                                          
                                             β
                                          
                                          
                                             ⁎
                                          
                                       
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       ≜
                                       ∥
                                       β
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                          
                                             ⁎
                                          
                                       
                                    
                                 
                              where 
                                 
                                    
                                       Rel
                                    
                                    
                                       k
                                    
                                 
                               is the set of all relations in 
                                 
                                    
                                       Q
                                    
                                    
                                       k
                                    
                                 
                                 ×
                                 
                                    
                                       Q
                                    
                                    
                                       k
                                    
                                 
                              , 
                                 ∥
                                 
                                    
                                       β
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       ∥
                                    
                                    
                                       k
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 ○
                                 ∥
                                 
                                    
                                       β
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       ∥
                                    
                                    
                                       k
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                               is a concatenation, and 
                                 ∥
                                 β
                                 
                                    
                                       ∥
                                    
                                    
                                       k
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       ⁎
                                    
                                 
                               is a transitive reflexive closure.

Let 
                                 M
                               be a 2-layer model. The satisfaction of state formulas w.r.t. a data environment 
                                 v
                               is given by a pair of relations 
                                 
                                    
                                       (
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               defined as follows:
                                 
                                    (1)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             0
                                          
                                       
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                          
                                             b
                                          
                                       
                                       
                                       iff
                                       
                                       
                                          
                                             M
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                          
                                             b
                                          
                                       
                                       
                                       and
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       
                                       for
                                       
                                       some
                                       
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       ∈
                                       
                                          
                                             W
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (2)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                       
                                          
                                             i
                                          
                                          
                                             k
                                          
                                       
                                       
                                       iff
                                       
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       =
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                          
                                             Nom
                                          
                                       
                                       (
                                       
                                          
                                             i
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                              
                              
                                 
                                    (3)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             0
                                          
                                       
                                       
                                       
                                          
                                             p
                                          
                                          
                                             0
                                          
                                       
                                       
                                       iff
                                       
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                       
                                       ∈
                                       
                                          
                                             V
                                          
                                          
                                             0
                                          
                                          
                                             Prop
                                          
                                       
                                       (
                                       
                                          
                                             p
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                 
                              
                              
                                 
                                    (4)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             1
                                          
                                       
                                       
                                       
                                          
                                             p
                                          
                                          
                                             1
                                          
                                       
                                       
                                       iff
                                       
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       ∈
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                          
                                             Prop
                                          
                                       
                                       (
                                       
                                          
                                             p
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                       
                                       )
                                       
                                       and
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                              
                              
                                 
                                    (5)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                       
                                       ∧
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       
                                       iff
                                       
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                       
                                       
                                       and
                                       
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (6)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                       ¬
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                       
                                       
                                       iff
                                       
                                       it
                                       
                                       is
                                       
                                       false
                                       
                                       that
                                       
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (7)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                       
                                          
                                             〈
                                             β
                                             〉
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                       
                                       
                                       iff
                                       
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                       
                                       
                                       for
                                       
                                       some
                                       
                                       
                                          
                                             v
                                          
                                          
                                             r
                                          
                                       
                                       ∈
                                       
                                          
                                             W
                                          
                                          
                                             r
                                          
                                       
                                       ,
                                       r
                                       ∈
                                       {
                                       0
                                       ,
                                       …
                                       ,
                                       k
                                       }
                                       
                                       such
                                       
                                       that
                                       
                                       (
                                       (
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       ,
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       )
                                       ∈
                                       ∥
                                       β
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (8)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                       
                                          
                                             〈
                                             n
                                             ,
                                             β
                                             〉
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                       
                                       
                                       iff
                                       
                                       n
                                       <
                                       |
                                       {
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       :
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                       
                                       
                                       for
                                       
                                       some
                                       
                                       
                                          
                                             v
                                          
                                          
                                             r
                                          
                                       
                                       ∈
                                       
                                          
                                             W
                                          
                                          
                                             r
                                          
                                       
                                       ,
                                       r
                                       ∈
                                       {
                                       0
                                       ,
                                       …
                                       ,
                                       k
                                       }
                                       
                                       such
                                       
                                       that
                                       
                                       (
                                       (
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       ,
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       )
                                       ∈
                                       ∥
                                       β
                                       
                                          
                                             ∥
                                          
                                          
                                             k
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       }
                                       |
                                    
                                 
                              
                              
                                 
                                    (9)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                       
                                          
                                             @
                                          
                                          
                                             
                                                
                                                   i
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                       
                                       
                                       iff
                                       
                                       
                                          
                                             M
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                          
                                             Nom
                                          
                                       
                                       (
                                       
                                          
                                             i
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              for 
                                 k
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                              , and each 
                                 
                                    
                                       w
                                    
                                    
                                       r
                                    
                                 
                                 ∈
                                 
                                    
                                       W
                                    
                                    
                                       r
                                    
                                 
                                 ,
                                 r
                                 ∈
                                 {
                                 0
                                 ,
                                 …
                                 ,
                                 k
                                 }
                               with 
                                 
                                    
                                       Q
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                 
                                 )
                              .□

Bisimulation offers a basic, actually quite strong, form of equivalence between models of the logic proposed in this section, and consequently between Archery
                        configurations. This section introduces suitable notions of bisimulation and refinement and explores their relationship with logical satisfaction. This leads to a Hennessy–Milner like theorem of broad relevance. We start by recalling what a bisimulation is in the standard (one layer) hybrid modal logic:


                        
                           Definition 6
                           Bisimulation


                           Let 
                                 M
                                 =
                                 (
                                 W
                                 ,
                                 R
                                 ,
                                 V
                                 )
                               and 
                                 
                                    
                                       M
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       W
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       V
                                    
                                    
                                       ′
                                    
                                 
                                 )
                               be two hybrid models over the same signature. A bisimulation between 
                                 M
                               and 
                                 
                                    
                                       M
                                    
                                    
                                       ′
                                    
                                 
                               consists of a relation 
                                 
                                    
                                       Z
                                       ⊆
                                       W
                                       ×
                                       
                                          
                                             W
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              such that
                                 
                                    (Nom)
                                    for any 
                                          i
                                          ∈
                                          Nom
                                       , 
                                          V
                                          (
                                          i
                                          )
                                          
                                          Z
                                          
                                          
                                             
                                                V
                                             
                                             
                                                ′
                                             
                                          
                                          (
                                          i
                                          )
                                       ,

for any 
                                          σ
                                          ∈
                                          Prop
                                          ∪
                                          NOM
                                       , 
                                          w
                                          ∈
                                          V
                                          (
                                          σ
                                          )
                                          
                                          iff
                                          
                                          
                                             
                                                w
                                             
                                             
                                                ′
                                             
                                          
                                          ∈
                                          
                                             
                                                V
                                             
                                             
                                                ′
                                             
                                          
                                          (
                                          σ
                                          )
                                       ;

for any positive n, for each 
                                          m
                                          ∈
                                          Sym
                                        and for any n distinct 
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                          
                                          ∈
                                          W
                                       , 
                                          k
                                          ∈
                                          0
                                          ,
                                          …
                                          ,
                                          n
                                        such 
                                          (
                                          w
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                          
                                          )
                                          ∈
                                          R
                                          [
                                          m
                                          ]
                                       , there are n distinct 
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                          ∈
                                          
                                             
                                                W
                                             
                                             
                                                ′
                                             
                                          
                                       , 
                                          k
                                          ∈
                                          1
                                          ,
                                          …
                                          ,
                                          n
                                       , such that 
                                          (
                                          
                                             
                                                w
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                ′
                                             
                                          
                                          [
                                          m
                                          ]
                                        with 
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                          
                                          
                                          Z
                                          
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                        for any 
                                          k
                                          ∈
                                          0
                                          ,
                                          …
                                          ,
                                          n
                                       .

for any positive n, for each 
                                          m
                                          ∈
                                          Sym
                                        and for any n distinct 
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                          ∈
                                          
                                             
                                                W
                                             
                                             
                                                ′
                                             
                                          
                                       , 
                                          k
                                          ∈
                                          0
                                          ,
                                          …
                                          ,
                                          n
                                        such 
                                          (
                                          
                                             
                                                w
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                ′
                                             
                                          
                                          [
                                          m
                                          ]
                                       , there are n distinct 
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                          
                                          ∈
                                          W
                                       , 
                                          k
                                          ∈
                                          1
                                          ,
                                          …
                                          ,
                                          n
                                       , such that 
                                          (
                                          w
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                          
                                          )
                                          ∈
                                          R
                                          [
                                          m
                                          ]
                                        with 
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                          
                                          
                                          Z
                                          
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                        for any 
                                          k
                                          ∈
                                          0
                                          ,
                                          …
                                          ,
                                          n
                                       .

A hierarchical bisimulation between two hierarchical models 
                                 M
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             W
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               and 
                                 
                                    
                                       M
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             W
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               consists of a family of relations 
                                 
                                    
                                       (
                                       
                                          
                                             Z
                                          
                                          
                                             k
                                          
                                       
                                       ⊆
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       ×
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                              , such that
                                 
                                    •
                                    for any 
                                          k
                                          ∈
                                          {
                                          0
                                          ,
                                          1
                                          }
                                       , Z
                                       
                                          k
                                        is a bisimulation,

for any 
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                          
                                          ,
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                             
                                                ′
                                             
                                          
                                        such that 
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                Z
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                             
                                                ′
                                             
                                          
                                       ,
                                          
                                             (i)
                                             and for each w
                                                1 such that and 
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                 there is a 
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                 such that 
                                                   
                                                      (10)
                                                      
                                                         (
                                                         
                                                            
                                                               w
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               w
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                         )
                                                         
                                                            
                                                               Z
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                         (
                                                         
                                                            
                                                               w
                                                            
                                                            
                                                               0
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               w
                                                            
                                                            
                                                               1
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             

and each 
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                 such that and 
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                 there is a w
                                                1 such that (10)
                                             

The following result establishes bisimulation invariance with respect to the proposed logic.
                           Theorem 1
                           
                              Let Z be a bisimulation between the hierarchical models 
                              
                                 M
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             W
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               
                              and 
                              
                                 
                                    
                                       M
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             W
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                                 ,
                               
                              and 
                              
                                 w
                                 ∈
                                 W
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 ∈
                                 
                                    
                                       W
                                    
                                    
                                       ′
                                    
                                 
                               
                              two states such that 
                              
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 
                                    
                                       Z
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       0
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              . Then, for any data environment 
                              
                                 v
                               
                              and for any formula φ, we have that 
                              
                                 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             1
                                          
                                       
                                       φ
                                       
                                       iff
                                       
                                       
                                          
                                             M
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             1
                                          
                                       
                                       φ
                                    
                                 
                              
                           

We start observing that, since both Z
                              1 and Z
                              0 are bisimulations, the invariance of 0-sentences across Z
                              0 and the invariance of 1-sentences across Z
                              1, with the exception of sentences φ
                              
                                 b
                              
                              1, can be proved as in the standard hybrid modal logic with graded modalities (e.g. 
                              [13,14]), by induction over the structure of the sentences. The preservation of the latter comes as follows:
                                 
                                    
                                       
                                       
                                          
                                             M
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                          
                                             b
                                          
                                       
                                       ≡
                                       {
                                       defn
                                       .
                                       
                                       of
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       }
                                       
                                       
                                          
                                             M
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                          
                                             b
                                          
                                       
                                       
                                       for
                                       
                                       some
                                       
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       
                                       such
                                       
                                       that
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       ≡
                                       {
                                       step
                                       
                                       ⋆
                                       }
                                       
                                       
                                          
                                             M
                                          
                                          
                                             0
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                          
                                             b
                                          
                                       
                                       
                                       for
                                       
                                       some
                                       
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       
                                       such
                                       
                                       that
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       (
                                       
                                          
                                             w
                                          
                                          
                                             0
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       ≡
                                       {
                                       defn
                                       .
                                       
                                       of
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             k
                                          
                                       
                                       }
                                       
                                       
                                          
                                             M
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                          
                                             b
                                          
                                       
                                    
                                 
                              For step ⋆ note that items (i) and (ii) in Definition 7 assure the existence of 
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 
                                    
                                       W
                                    
                                    
                                       1
                                    
                                 
                               and 
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 ∈
                                 
                                    
                                       W
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                               such that 
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 
                                    
                                       Z
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       0
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              . Hence, the equivalence is justified by the invariance result for of hybrid logics with graded modalities.□

The existence of a Hennessy–Milner like theorems for the logic is now discussed. For this, let us consider that a hierarchical model 
                           M
                         is image-finite when each of its outer and inner accessibility relations are image-finite, i.e., for each 
                           w
                           ∈
                           
                              
                                 W
                              
                              
                                 k
                              
                           
                         and 
                           m
                           ∈
                           
                              
                                 Sym
                              
                              
                                 k
                              
                           
                        , the sets 
                           {
                           
                              
                                 w
                              
                              
                                 ′
                              
                           
                           :
                           (
                           w
                           ,
                           
                              
                                 w
                              
                              
                                 ′
                              
                           
                           )
                           ∈
                           R
                           
                              
                                 [
                                 m
                                 ]
                              
                              
                                 k
                              
                           
                           }
                        , 
                           k
                           ∈
                           {
                           0
                           ,
                           1
                           }
                        , are finite.

Actually, for any two image-finite models 
                           M
                         and 
                           
                              
                                 M
                              
                              
                                 ′
                              
                           
                         and for any 
                           w
                           ∈
                           W
                         and 
                           
                              
                                 w
                              
                              
                                 ′
                              
                           
                           ∈
                           
                              
                                 W
                              
                              
                                 ′
                              
                           
                         we can prove the equivalence of statements: 
                           (i)
                           
                              
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          ⊨
                                       
                                       
                                          1
                                       
                                    
                                    φ
                                    
                                    iff
                                    
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          1
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       
                                          ⊨
                                       
                                       
                                          1
                                       
                                    
                                    φ
                                 
                              

There is a bisimulation 
                                    Z
                                    ⊆
                                    W
                                    ×
                                    
                                       
                                          W
                                       
                                       
                                          ′
                                       
                                    
                                  between 
                                    M
                                  and 
                                    
                                       
                                          M
                                       
                                       
                                          ′
                                       
                                    
                                 .

Finally we observe that the recent work [15] presents a description logic with graded modalities that is endowed with a bisimulation notion satisfying a Henessy–Milner property. Its ZIG-ZAG correspondence, however, is established by a bijective relation, which is a very strong condition in view of our purposes.

We introduce, in this section, a property preserving relation between hierarchical models.
                           Definition 8
                           Let 
                                 M
                                 =
                                 (
                                 W
                                 ,
                                 R
                                 ,
                                 V
                                 )
                               and 
                                 
                                    
                                       M
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       W
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       V
                                    
                                    
                                       ′
                                    
                                 
                                 )
                               be two hybrid models over the same signature. A simulation between 
                                 M
                               and 
                                 
                                    
                                       M
                                    
                                    
                                       ′
                                    
                                 
                               consists of a relation 
                                 S
                                 ⊆
                                 W
                                 ×
                                 
                                    
                                       W
                                    
                                    
                                       ′
                                    
                                 
                               such that
                                 
                                    (Nom)
                                    for any 
                                          i
                                          ∈
                                          Nom
                                       , 
                                          V
                                          (
                                          i
                                          )
                                          
                                          Z
                                          
                                          
                                             
                                                V
                                             
                                             
                                                ′
                                             
                                          
                                          (
                                          i
                                          )
                                       ,

for any 
                                          σ
                                          ∈
                                          Prop
                                          ∪
                                          NOM
                                       , if 
                                          w
                                          ∈
                                          V
                                          (
                                          σ
                                          )
                                        then 
                                          
                                             
                                                w
                                             
                                             
                                                ′
                                             
                                          
                                          ∈
                                          
                                             
                                                V
                                             
                                             
                                                ′
                                             
                                          
                                          (
                                          σ
                                          )
                                       ;

for any positive n, for each 
                                          m
                                          ∈
                                          Sym
                                        and for any n distinct 
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                          
                                          ∈
                                          W
                                       , 
                                          k
                                          ∈
                                          0
                                          ,
                                          …
                                          ,
                                          n
                                        such 
                                          (
                                          w
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                          
                                          )
                                          ∈
                                          R
                                          [
                                          m
                                          ]
                                       , there are n distinct 
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                          ∈
                                          
                                             
                                                W
                                             
                                             
                                                ′
                                             
                                          
                                       , 
                                          k
                                          ∈
                                          1
                                          ,
                                          …
                                          ,
                                          n
                                       , such that 
                                          (
                                          
                                             
                                                w
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                ′
                                             
                                          
                                          [
                                          m
                                          ]
                                        with 
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                          
                                          
                                          S
                                          
                                          
                                             
                                                v
                                             
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                        for any 
                                          k
                                          ∈
                                          0
                                          ,
                                          …
                                          ,
                                          n
                                       .

A hierarchical refinement between two hierarchical models 
                                 M
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             W
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               and 
                                 
                                    
                                       M
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             W
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               consists of a family of relations 
                                 
                                    
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             k
                                          
                                       
                                       ⊆
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       ×
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                              , such that
                                 
                                    •
                                    for any 
                                          k
                                          ∈
                                          {
                                          0
                                          ,
                                          1
                                          }
                                       , S
                                       
                                          k
                                        is a simulation,

for any 
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                          
                                       , 
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                             
                                                ′
                                             
                                          
                                        such that 
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                S
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                             
                                                ′
                                             
                                          
                                       , and for each w
                                       1 such that and 
                                          
                                             
                                                Q
                                             
                                             
                                                1
                                             
                                          
                                          (
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                          
                                          ,
                                          
                                             
                                                w
                                             
                                             
                                                1
                                             
                                          
                                          )
                                        there is a 
                                          
                                             
                                                w
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                        such that 
                                          (
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                          
                                          ,
                                          
                                             
                                                w
                                             
                                             
                                                1
                                             
                                          
                                          )
                                          
                                             
                                                S
                                             
                                             
                                                1
                                             
                                          
                                          (
                                          
                                             
                                                w
                                             
                                             
                                                0
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                w
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          .
                                       
                                    

Next theorem establishes the preservation of properties over across. The proof is omitted since it can be directly derived from the one of Theorem 1. Note however that, since the refinement relation just imposes the directional preservation of the propositions and atomic formulas, the preservation of negation, and consequently of boxes, is lost. Hence,
                           Theorem 2
                           
                              Let S be a refinement relation between the hierarchical models 
                              
                                 M
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             W
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               
                              and 
                              
                                 
                                    
                                       M
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             W
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       k
                                       ∈
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 
                               
                              and 
                              
                                 w
                                 ∈
                                 W
                              , 
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 ∈
                                 
                                    
                                       W
                                    
                                    
                                       ′
                                    
                                 
                               
                              two states such that 
                              
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 
                                    
                                       Z
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       0
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              . Then, for any data environment 
                              
                                 v
                               
                              and for any formula φ without diamonds and negations, we have that 
                              
                                 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             1
                                          
                                       
                                       φ
                                       
                                       implies
                                       
                                       
                                          
                                             M
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          
                                             ⊨
                                          
                                          
                                             1
                                          
                                       
                                       φ
                                       .
                                    
                                 
                              
                           

Verifying a constraint over a specification requires deriving an interpretation model 
                        M
                      and then translating the constraint into the corresponding logic. The derivation of interpretation models for structural constraints is detailed in Appendix A. On the other hand, the derivation of two-layer models can be found in [10],

Reconfiguration constraints become formulas of a 2-layer modal logic. Translations differ on how variables are treated. In structural constraints, variables are bound to nominals. Then, the meaning of 
                        
                           
                              forall
                           
                        
                        
                        
                           x
                        
                        :
                        
                           TYPEID
                        
                      is the conjunction of formulas 
                        
                           
                              at
                           
                        
                        
                        
                           x
                        
                        
                        
                           
                              F
                           
                        
                      
                     
                        [
                        
                           x
                        
                        /
                        i
                        ]
                     , for each 
                        i
                        ∈
                        
                           
                              Nom
                           
                           
                              var
                              :
                              TYPEID
                           
                        
                     , where 
                        [
                        x
                        /
                        i
                        ]
                      denotes the substitution of x by i in 
                        
                           
                              F
                           
                        
                     . Dually, the meaning of 
                        
                           
                              exists
                           
                        
                        
                        
                           x
                        
                        :
                        
                           TYPEID
                        
                        
                        
                           
                              F
                           
                        
                      is a disjunction of formulas 
                        
                           
                              at
                           
                        
                        
                        
                           x
                        
                        
                        
                           
                              F
                           
                        
                        
                        [
                        x
                        /
                        i
                        ]
                     , for each 
                        i
                        ∈
                        
                           
                              Nom
                           
                           
                              TYPEID
                           
                        
                     . Note that in reconfiguration constraints, variables become data variables. The types that a pattern defines become data sorts, configuration variables become values of such sorts, and ports become values of a port data sort. Appendix B provides the precise definition of the translations.

To illustrate our approach, we verify now the constraint safeUnassign (in Listing 6) over the sequence of script executions that replaces a nurse, shown in Fig. 2.

First, it is shown that the initial configuration satisfies the nested structural constraint enoughNurses (see Listing 4). The result of translating the Archery
                     specification of the initial configuration into an interpretation model is shown in Fig. 11
                     . It is partial since instances of administration and physician are omitted. In addition, names (see the metamodel) and their relationships are also dropped. Each node in the graph represents a world and includes an identifier in the first line; the satisfied propositions in the second line; and the satisfied nominals in the third line. A short code is used for the propositions that depend on the pattern: N (Nurse) and Pat (Patient). A short symbol is used to avoid using the longer symbols of propositions: V (Variable), PI (PatternInstance), EI (ElementInstance), P (Port), I (In), O (Out), A (Attachment), R (Renaming), PR (PortReference), Act (Action), and N (Name).

The resulting model is simplified into the model shown in Fig. 12
                     (a), by considering the relation attd, which is the only one present in the formula. It does not show worlds representing instances in variables, ports, and attachments.

The nested constraint is translated into formula 
                        
                           
                              @
                              pat
                              
                              〈
                              1
                              ,
                              attd
                              〉
                              
                              Nurse
                              .
                           
                        
                     with the parameter bound to pat, the unique patient in the initial configuration. Its verification proceeds as follows:
                        
                           
                              
                              @
                              pat
                              
                              〈
                              1
                              ,
                              attd
                              〉
                              
                              Nurse
                              =
                              {
                              by
                              
                              
                                 (4)
                              
                              }
                              
                              @
                              pat
                              
                              〈
                              1
                              ,
                              attd
                              〉
                              {
                              
                                 
                                    w
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    w
                                 
                                 
                                    4
                                 
                              
                              }
                              =
                              {
                              by
                              
                              
                                 (8)
                              
                              }
                              
                              @
                              pat
                              
                              {
                              
                                 
                                    w
                                 
                                 
                                    3
                                 
                              
                              }
                              =
                              {
                              by
                              
                              
                                 (9)
                              
                              }
                              
                              W
                           
                        
                     The formula is satisfied by the initial configuration.

In contrast, configuration c
                     5 in Fig. 2 does not. Nurse n2 was unassigned before assigning n3. The derived model is shown in Fig. 12(b) and the verification is as follows:
                        
                           
                              
                              @
                              pat
                              
                              〈
                              1
                              ,
                              attd
                              〉
                              
                              Nurse
                              =
                              {
                              by
                              
                              
                                 (4)
                              
                              }
                              
                              @
                              pat
                              
                              〈
                              1
                              ,
                              attd
                              〉
                              {
                              
                                 
                                    w
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    w
                                 
                                 
                                    4
                                 
                              
                              ,
                              
                                 
                                    w
                                 
                                 
                                    5
                                 
                              
                              }
                              =
                              {
                              by
                              
                              
                                 (8)
                              
                              }
                              
                              @
                              pat
                              
                              ∅
                              =
                              {
                              by
                              
                              
                                 (9)
                              
                              }
                              
                              ∅
                           
                        
                     
                  

The model for the sequence of script executions, which is referred as subs0 in the sequel, is partially shown in Fig. 13
                     . Its first level consists of the primitives that result from the execution of subs0, and it shows the nested models for the initial configuration c
                     0 and for the configuration upon the unassignment of the nurse c
                     5.

The translation of the reconfiguration constraint safeUnassign, shown in Listing 6, yields formula 
                        
                           
                              [
                              
                                 
                                    ⊤
                                 
                                 
                                    ⁎
                                 
                              
                              .
                              detach
                              (
                              pat
                              ,
                              nurO
                              ,
                              n
                              2
                              ,
                              patI
                              )
                              ]
                              
                              ψ
                              (
                              pat
                              )
                              ,
                           
                        
                     where ψ stands for the formula of constraint enoughNurses. The symbol term is replaced by the only symbol that matches the criteria within the necessity operator. Likewise, the parameter of the nested constraint is fixed to the unique variable of type Patient in the successive configurations. The formula is verified as follows:
                        
                           
                              
                              [
                              
                                 
                                    ⊤
                                 
                                 
                                    ⁎
                                 
                              
                              .
                              detach
                              (
                              pat
                              ,
                              nurO
                              ,
                              n
                              2
                              ,
                              patI
                              )
                              ]
                              
                              ψ
                              (
                              pat
                              )
                              =
                              {
                              by
                              
                              [
                              β
                              ]
                              φ
                              =
                              ¬
                              〈
                              β
                              〉
                              ¬
                              φ
                              }
                              
                              ¬
                              〈
                              
                                 
                                    ⊤
                                 
                                 
                                    ⁎
                                 
                              
                              .
                              detach
                              (
                              pat
                              ,
                              nurO
                              ,
                              n
                              2
                              ,
                              patI
                              )
                              〉
                              
                              ¬
                              ψ
                              (
                              pat
                              )
                              =
                              {
                              by
                              
                              
                                 (1)
                              
                              }
                              
                              ¬
                              〈
                              
                                 
                                    ⊤
                                 
                                 
                                    ⁎
                                 
                              
                              .
                              detach
                              (
                              pat
                              ,
                              nurO
                              ,
                              n
                              2
                              ,
                              patI
                              )
                              〉
                              
                              ¬
                              (
                              W
                              ⧹
                              {
                              
                                 
                                    c
                                 
                                 
                                    5
                                 
                              
                              }
                              )
                              =
                              {
                              by
                              
                              
                                 (6)
                              
                              }
                              
                              ¬
                              〈
                              
                                 
                                    ⊤
                                 
                                 
                                    ⁎
                                 
                              
                              .
                              detach
                              (
                              pat
                              ,
                              nurO
                              ,
                              n
                              2
                              ,
                              patI
                              )
                              〉
                              
                              {
                              
                                 
                                    c
                                 
                                 
                                    5
                                 
                              
                              }
                              =
                              {
                              by
                              
                              
                                 (7)
                              
                              
                              and
                              
                              〈
                              β
                              .
                              
                                 
                                    β
                                 
                                 
                                    ′
                                 
                              
                              〉
                              =
                              〈
                              β
                              〉
                              〈
                              
                                 
                                    β
                                 
                                 
                                    ′
                                 
                              
                              〉
                              }
                              
                              ¬
                              〈
                              
                                 
                                    ⊤
                                 
                                 
                                    ⁎
                                 
                              
                              〉
                              
                              {
                              
                                 
                                    c
                                 
                                 
                                    4
                                 
                              
                              }
                              =
                              {
                              by
                              
                              
                                 (7)
                              
                              
                              and
                              
                              〈
                              β
                              .
                              
                                 
                                    β
                                 
                                 
                                    ′
                                 
                              
                              〉
                              =
                              〈
                              β
                              〉
                              〈
                              
                                 
                                    β
                                 
                                 
                                    ′
                                 
                              
                              〉
                              
                              four
                              
                              times
                              }
                              
                              ¬
                              {
                              
                                 
                                    c
                                 
                                 
                                    0
                                 
                              
                              }
                              =
                              {
                              set
                              
                              complement
                              }
                              
                              W
                              ⧹
                              {
                              
                                 
                                    c
                                 
                                 
                                    0
                                 
                              
                              }
                           
                        
                     
                  

Since the result excludes the initial configuration, reconfigurations subs0 fail to satisfy the constraint. On the other hand, the reconfigurations in Fig. 14
                     (a), subs1 in the sequel, satisfy it, as they assign the patient to n3 before unassigning n2. Reconfigurations subs0 and subs1 are not bisimilar, and none of them are refinement of the other.

Consider now reconfiguration subs2 in Fig. 14(b). It proceeds as subs1, but offers an optional sequence of operations that the configuration manager can perform. Nurse n4 is let in, and checked in by such additional operations. Reconfigurations subs2 and subs1 are not bisimilar, but subs2 is a refinement of subs1. The relation that satisfies Definition 9 contains pairs 
                        (
                        
                           
                              c
                           
                           
                              j
                           
                        
                        ,
                        
                           
                              c
                           
                           
                              j
                           
                           
                              ′
                           
                        
                        )
                      where c
                     
                        j
                      and 
                        
                           
                              c
                           
                           
                              j
                           
                           
                              ′
                           
                        
                      are in the interpretation models of subs1 and subs2, respectively, and 
                        j
                        ∈
                        {
                        0
                        …
                        10
                        }
                     . Since subs2 is a refinement of subs1, Theorem 2 can be applied to avoid verifying constraints already valid in subs1. However, since the constraint we are studying includes diamonds, it is out of the scope of such a theorem, and the verification on subs2 is still required.

@&#RELATED WORK@&#

An architectural description language ADL provides a number of typical abstractions to model software architectures. Reference [2] identifies components, connectors, and configurations as essential elements in such a description. In addition, the concept of architectural pattern (or style) [16,17] facilitates the development of specifications since it allows abstracting recurring forms. ACME [18], Darwin [19–21], Wright [22,23], and ADR [24] are among the languages that support these abstractions.

ADLs with formal semantics provide a sound foundation for the tool-supported development of dynamically reconfigurable architectural models. It is possible to distinguish among languages precisely defined upon process algebras and graphical theories [25]. While Darwin [19] and Wright [23] are examples of the former, ADR [24] combines both. Archery
                     
                     [4] models the behavioural part of software architectures with process algebras [26], and the structural part with bigraphical reactive systems [27].

These languages represent and analyse dynamic reconfigurable architectures in different ways [19,23,28]. They enforce architectural principles in a pattern either by construction or by restriction. The former requires defining pattern-specific reconfiguration operations that can only produce correct configurations according to design principles [29]. Then, design decisions are left implicit in these operations. ADR [24] uses this mechanism. The latter approach requires the explicit specification of constraints that prevent generic (re)configuration operations leading to incorrect configurations. Archery
                     follows this approach. ADLs Darwin [20] and ACME [30] also follow this approach by providing a translation into the Alloy language [31], which is based on a first-order relational logic and is supported by a bounded model checker implemented upon a SAT solver.

The approach proposed in this paper has connections to the one documented in [32], which is based on a layered approach for addressing dynamic reconfiguration. It includes a layer where properties about configurations are specified using first order logic, a layer where reconfiguration events can be related to configuration properties, another one that restricts the way configuration properties appear in traces, and, finally, a layer that describes valid combinations of reconfiguration events and traces of configurations, specified in a linear temporal logic.

An ADL for reasoning about behavioural constraints, expressed in a combination of first order and temporal logic, in the presence of dynamic reconfiguration is proposed in [33]. The concept of an architectural reconfiguration contract [34] relates the behaviour of a system and its dynamic reconfigurations. It establishes at which states a configuration can be replaced by another one, and the states at which the new configuration can be safely left. Archery׳s support for this concept is part of ongoing work.

@&#CONCLUSIONS AND FUTURE WORK@&#

This paper proposes the use of hierarchical constraints to ensure that architectural reconfigurations on a system proceed as expected. Resulting configurations respect system׳s architectural principles, as inherited from the specific architectural pattern adopted or originally fixed by the software architect. The Archery
                     language is used to specify architectures, reconfigurations and constraints. Translations into a two-layer graded hybrid logic are presented, which enable the formal verification of constraints. The approach is illustrated with the verification of architectural principles that must be respected by (re)configurations of a service architecture for the blood transfusion procedure.

Ongoing work is concerned with the specification of nested behavioural constraints, the usage of constraints for triggering reconfiguration scripts, and the provision of tool-support for a fragment of the language that excludes nesting, i.e., constraints that can be translated into a graded hybrid logic. Future work, on the other hand, includes the study of tool-support for the whole constraint language, and the development of a comprehensive case study in the context of electronic government.

@&#ACKNOWLEDGEMENTS@&#

This work is funded by ERDF - European Regional Development Fund through the COMPETE Programme (operational programme for competitiveness) and by National Funds through FCT, the Portuguese Foundation for Science and Technology, within project FCOMP-01-0124-FEDER-028923. The second author is also supported by the FCT grant SFRH/BPD/103004/2014.

As a convention, the expression 
                        m
                        [
                        l
                        ⇉
                        u
                        ]
                      denotes 
                        m
                        [
                        l
                        ↦
                        m
                        (
                        l
                        )
                        ∪
                        u
                        ]
                      if u is a set, and 
                        m
                        [
                        l
                        ↦
                        m
                        (
                        l
                        )
                        ∪
                        {
                        u
                        }
                        ]
                      otherwise.
                        Definition 10
                        Model derivation for structural constraints


                        Let 
                              W
                              :
                              Part
                              →
                              W
                            be a function that yields a world that represents a participant in an architecture, where 
                              Part
                              =
                              Var
                              ⊎
                              ElemInst
                              
                              ⊎
                              PatInst
                              
                              ⊎
                              Att
                              
                              ⊎
                              PortRef
                              
                              ⊎
                              Ren
                              
                              ⊎
                              Id
                              
                              ⊎
                              Act
                           , let 
                              
                                 
                                    Model
                                 
                                 
                                    S
                                 
                              
                            be the set of models for 
                              
                                 
                                    M
                                 
                                 
                                    S
                                 
                              
                           , and let 
                              N
                              :
                              TYPE
                              →
                              P
                              (
                              Nom
                              )
                            be a map that yields, for a type defined by a pattern, the nominals representing variables of such type in a given architecture. The derivation is given by a function 
                              I
                              :
                              Var
                              ×
                              W
                              ×
                              
                                 
                                    Model
                                 
                                 
                                    S
                                 
                              
                              ×
                              N
                              
                              →
                              
                                 
                                    Model
                                 
                                 
                                    S
                                 
                              
                              ×
                              N
                            which is inductively defined as follows:
                              
                                 
                                    I
                                    (
                                    v
                                    =
                                    (
                                    id
                                    
                                    type
                                    
                                    inst
                                    )
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          v
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    =
                                    
                                    I
                                    (
                                    inst
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ∪
                                    {
                                    
                                       
                                          w
                                       
                                       
                                          v
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    }
                                    ,
                                    R
                                    [
                                    hlds
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          v
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ]
                                    ,
                                    V
                                    [
                                    V
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          v
                                       
                                    
                                    ]
                                    [
                                    type
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          v
                                       
                                    
                                    ]
                                    )
                                    ,
                                    
                                    N
                                    [
                                    type
                                    ⇉
                                    id
                                    ]
                                    )
                                    ,
                                    
                                    where
                                    
                                    
                                       
                                          w
                                       
                                       
                                          v
                                       
                                    
                                    =
                                    W
                                    (
                                    v
                                    )
                                    
                                    and
                                    
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    W
                                    (
                                    inst
                                    )
                                    I
                                    (
                                    inst
                                    =
                                    (
                                    type
                                    
                                    ports
                                    
                                    acts
                                    )
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    
                                    =
                                    I
                                    (
                                    ports
                                    
                                    acts
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    [
                                    type
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ]
                                    [
                                    EI
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ]
                                    )
                                    ,
                                    N
                                    )
                                    I
                                    (
                                    port
                                    =
                                    (
                                    id
                                    
                                    dir
                                    
                                    ptype
                                    )
                                    
                                    ports
                                    
                                    acts
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    
                                    =
                                    I
                                    (
                                    ports
                                    
                                    acts
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ∪
                                    {
                                    
                                       
                                          w
                                       
                                       
                                          port
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          id
                                       
                                    
                                    }
                                    ,
                                    
                                    R
                                    [
                                    prt
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          port
                                       
                                    
                                    )
                                    ]
                                    [
                                    name
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          port
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          id
                                       
                                    
                                    )
                                    ]
                                    ,
                                    
                                    V
                                    [
                                    P
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          port
                                       
                                    
                                    ]
                                    [
                                    dir
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          port
                                       
                                    
                                    ]
                                    [
                                    id
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          port
                                       
                                    
                                    ]
                                    [
                                    ptype
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          port
                                       
                                    
                                    ]
                                    [
                                    N
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          id
                                       
                                    
                                    ]
                                    )
                                    ,
                                    N
                                    )
                                    
                                    where
                                    
                                    
                                       
                                          w
                                       
                                       
                                          port
                                       
                                    
                                    =
                                    W
                                    (
                                    port
                                    )
                                    
                                    and
                                    
                                    
                                       
                                          w
                                       
                                       
                                          id
                                       
                                    
                                    =
                                    W
                                    (
                                    id
                                    )
                                    I
                                    (
                                    [
                                    
                                    ]
                                    
                                    acts
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    =
                                    I
                                    (
                                    acts
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    I
                                    (
                                    act
                                    =
                                    id
                                    
                                    acts
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    
                                    =
                                    I
                                    (
                                    acts
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ∪
                                    {
                                    
                                       
                                          w
                                       
                                       
                                          act
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          id
                                       
                                    
                                    }
                                    ,
                                    R
                                    [
                                    act
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          act
                                       
                                    
                                    )
                                    ]
                                    [
                                    name
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          act
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          id
                                       
                                    
                                    )
                                    ]
                                    ,
                                    
                                    V
                                    [
                                    Act
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          act
                                       
                                    
                                    ]
                                    [
                                    N
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          id
                                       
                                    
                                    ]
                                    )
                                    ,
                                    N
                                    )
                                    ,
                                    
                                    where
                                    
                                    
                                       
                                          w
                                       
                                       
                                          act
                                       
                                    
                                    =
                                    W
                                    (
                                    act
                                    )
                                    I
                                    (
                                    [
                                    
                                    ]
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    =
                                    (
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    I
                                    (
                                    inst
                                    =
                                    (
                                    type
                                    
                                    vs
                                    
                                    atts
                                    
                                    rens
                                    )
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    
                                    =
                                    I
                                    (
                                    vs
                                    
                                    atts
                                    
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    [
                                    type
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ]
                                    [
                                    PI
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ]
                                    )
                                    ,
                                    N
                                    )
                                    I
                                    (
                                    v
                                    
                                    vs
                                    
                                    atts
                                    
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    
                                    =
                                    I
                                    (
                                    vs
                                    
                                    atts
                                    
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    
                                       
                                          W
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    
                                       
                                          R
                                       
                                       
                                          ′
                                       
                                    
                                    [
                                    ⋅
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          v
                                       
                                    
                                    )
                                    ]
                                    ,
                                    
                                       
                                          V
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          N
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    
                                    where
                                    
                                    (
                                    (
                                    
                                       
                                          W
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    
                                       
                                          R
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    
                                       
                                          V
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          N
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    =
                                    I
                                    (
                                    v
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          v
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    I
                                    (
                                    [
                                    
                                    ]
                                    
                                    atts
                                    
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    =
                                    I
                                    (
                                    atts
                                    
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    I
                                    (
                                    att
                                    =
                                    (
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          o
                                       
                                    
                                    ,
                                    
                                       
                                          port
                                       
                                       
                                          o
                                       
                                    
                                    )
                                    ,
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          t
                                       
                                    
                                    ,
                                    
                                       
                                          port
                                       
                                       
                                          t
                                       
                                    
                                    )
                                    )
                                    
                                    atts
                                    
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    
                                    =
                                    I
                                    (
                                    atts
                                    
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ∪
                                    {
                                    
                                       
                                          w
                                       
                                       
                                          att
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                o
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    }
                                    ,
                                    
                                    R
                                    [
                                    att
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          att
                                       
                                    
                                    )
                                    ]
                                    [
                                    strt
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          att
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                o
                                             
                                          
                                       
                                    
                                    )
                                    ]
                                    [
                                    end
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          att
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    )
                                    ]
                                    
                                    [
                                    vref
                                    ⇉
                                    {
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                o
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                o
                                             
                                          
                                       
                                    
                                    )
                                    ,
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    )
                                    }
                                    ]
                                    
                                    [
                                    pref
                                    ⇉
                                    {
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                o
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                port
                                             
                                             
                                                o
                                             
                                          
                                       
                                    
                                    )
                                    ,
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                port
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    )
                                    }
                                    ]
                                    ,
                                    
                                    V
                                    [
                                    A
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          att
                                       
                                    
                                    ]
                                    [
                                    PR
                                    ⇉
                                    {
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                o
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    }
                                    ]
                                    )
                                    ,
                                    N
                                    )
                                    
                                    where
                                    
                                    
                                       
                                          w
                                       
                                       
                                          att
                                       
                                    
                                    =
                                    W
                                    (
                                    att
                                    )
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                o
                                             
                                          
                                       
                                    
                                    =
                                    W
                                    (
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          o
                                       
                                    
                                    ,
                                    
                                       
                                          port
                                       
                                       
                                          o
                                       
                                    
                                    )
                                    )
                                    
                                    and
                                    
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                PR
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    =
                                    W
                                    (
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          t
                                       
                                    
                                    ,
                                    
                                       
                                          port
                                       
                                       
                                          t
                                       
                                    
                                    )
                                    )
                                    I
                                    (
                                    [
                                    
                                    ]
                                    
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    =
                                    I
                                    (
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    I
                                    (
                                    ren
                                    =
                                    (
                                    (
                                    v
                                    ,
                                    port
                                    )
                                    ,
                                    id
                                    )
                                    
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    
                                    =
                                    I
                                    (
                                    rens
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ∪
                                    {
                                    
                                       
                                          w
                                       
                                       
                                          ren
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          PR
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          id
                                       
                                    
                                    }
                                    ,
                                    
                                    R
                                    [
                                    ren
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          ren
                                       
                                    
                                    )
                                    ]
                                    [
                                    rend
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          ren
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          PR
                                       
                                    
                                    )
                                    ]
                                    
                                    [
                                    vref
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          PR
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          v
                                       
                                    
                                    )
                                    ]
                                    [
                                    pref
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          PR
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          port
                                       
                                    
                                    )
                                    ]
                                    
                                    [
                                    prt
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          ren
                                       
                                    
                                    )
                                    ]
                                    [
                                    name
                                    ⇉
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          ren
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          id
                                       
                                    
                                    )
                                    ]
                                    ,
                                    
                                    V
                                    [
                                    R
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          ren
                                       
                                    
                                    ]
                                    [
                                    PR
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          PR
                                       
                                    
                                    ]
                                    [
                                    N
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          id
                                       
                                    
                                    ]
                                    [
                                    id
                                    ⇉
                                    
                                       
                                          w
                                       
                                       
                                          ren
                                       
                                    
                                    ]
                                    )
                                    ,
                                    N
                                    )
                                    
                                    where
                                    
                                    
                                       
                                          w
                                       
                                       
                                          ren
                                       
                                    
                                    =
                                    W
                                    (
                                    ren
                                    )
                                    
                                    and
                                    
                                    
                                       
                                          w
                                       
                                       
                                          PR
                                       
                                    
                                    =
                                    W
                                    (
                                    (
                                    v
                                    ,
                                    port
                                    )
                                    )
                                    I
                                    (
                                    [
                                    
                                    ]
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    (
                                    W
                                    ,
                                    R
                                    ,
                                    V
                                    )
                                    ,
                                    N
                                    )
                                    =
                                    
                                       
                                          (
                                          (
                                          W
                                          ,
                                          R
                                          ,
                                          V
                                          )
                                          ,
                                          N
                                          )
                                       
                                       
                                          □
                                       
                                    
                                 
                              
                           
                        

The translation of a set of constraints yields a formula map that returns, for a given identifier, the corresponding constraint translated into a modal formula. The function in Definition 11 takes a structural constraint and a formula environment and yields a new formula environment that includes the translation of the constraint. A notational convention adopted to present the translation is to consider terminals and non-terminals of the syntax as sets. For instance, 
                        f
                        ∈
                        F
                      is used to indicate that expression 
                        f
                      is built according to non-terminal 
                        F
                     . 
                        Definition 11
                        Translation: structural constraints


                        Let 
                              f
                            be a formula map with type 
                              FM
                              =
                              ID
                              →
                              SForm
                           . Given 
                              f
                           , a structural constraint in 
                              SConst
                            is translated into a state formula of the graded hybrid logic by function 
                              
                                 
                                    T
                                 
                                 
                                    S
                                 
                              
                              :
                              SConst
                              ×
                              FM
                              →
                              FM
                            inductively defined as 
                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    fd
                                    
                                    fds
                                    ,
                                    f
                                    )
                                    =
                                    f
                                    [
                                    id
                                    ↦
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    fds
                                    ,
                                    f
                                    )
                                    )
                                    ]
                                 
                              
                           where 
                              fd
                              ∈
                              FDecl
                           , 
                              fds
                              ∈
                              
                                 
                                    FDecl
                                 
                                 
                                    ⁎
                                 
                              
                           , 
                              id
                              ∈
                              ID
                           , 
                              f
                              ∈
                              F
                           , and 
                              
                                 
                                    F
                                 
                                 
                                    S
                                 
                              
                              :
                              F
                              ×
                              FM
                              →
                              SForm
                            is defined as
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    true
                                    ,
                                    f
                                    )
                                    =
                                    ⊤
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    false
                                    ,
                                    f
                                    )
                                    =
                                    ⊥
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    p
                                    ,
                                    f
                                    )
                                    =
                                    p
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    not
                                    
                                    f
                                    ,
                                    f
                                    )
                                    =
                                    ¬
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    
                                    or
                                    
                                    g
                                    ,
                                    f
                                    )
                                    =
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    ∨
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    g
                                    ,
                                    f
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    
                                    and
                                    
                                    g
                                    ,
                                    f
                                    )
                                    =
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    ∧
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    g
                                    ,
                                    f
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    
                                    implies
                                    
                                    g
                                    ,
                                    f
                                    )
                                    =
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    →
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    g
                                    ,
                                    f
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    
                                    iff
                                    
                                    g
                                    ,
                                    f
                                    )
                                    =
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    ↔
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    g
                                    ,
                                    f
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          [
                                          r
                                          ]
                                          
                                          f
                                          ,
                                          f
                                          )
                                          =
                                          
                                             
                                                [
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      S
                                                   
                                                
                                                (
                                                r
                                                )
                                                ]
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                F
                                             
                                             
                                                S
                                             
                                          
                                          (
                                          f
                                          ,
                                          f
                                          )
                                          
                                             
                                                F
                                             
                                             
                                                S
                                             
                                          
                                          (
                                          [
                                          n
                                          ,
                                          r
                                          ]
                                          f
                                          ,
                                          f
                                          )
                                          =
                                          [
                                          n
                                          ,
                                          
                                             
                                                R
                                             
                                             
                                                S
                                             
                                          
                                          (
                                          r
                                          )
                                          ]
                                       
                                       
                                          0
                                       
                                    
                                    
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          〈
                                          r
                                          〉
                                          f
                                          ,
                                          f
                                          )
                                          =
                                          
                                             
                                                〈
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      S
                                                   
                                                
                                                (
                                                r
                                                )
                                                〉
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                F
                                             
                                             
                                                S
                                             
                                          
                                          (
                                          f
                                          ,
                                          f
                                          )
                                          
                                             
                                                F
                                             
                                             
                                                S
                                             
                                          
                                          (
                                          〈
                                          n
                                          ,
                                          r
                                          〉
                                          f
                                          ,
                                          f
                                          )
                                          =
                                          〈
                                          n
                                          ,
                                          
                                             
                                                R
                                             
                                             
                                                S
                                             
                                          
                                          (
                                          r
                                          )
                                          〉
                                       
                                       
                                          0
                                       
                                    
                                    
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    id
                                    
                                    
                                       
                                          a
                                       
                                       
                                          1
                                       
                                    
                                    …
                                    
                                       
                                          a
                                       
                                       
                                          n
                                       
                                    
                                    ,
                                    f
                                    )
                                    =
                                    f
                                    (
                                    id
                                    )
                                    [
                                    
                                       
                                          f
                                       
                                       
                                          1
                                       
                                    
                                    …
                                    
                                       
                                          f
                                       
                                       
                                          n
                                       
                                    
                                    /
                                    
                                       
                                          a
                                       
                                       
                                          1
                                       
                                    
                                    …
                                    
                                       
                                          a
                                       
                                       
                                          n
                                       
                                    
                                    ]
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    i
                                    ,
                                    f
                                    )
                                    =
                                    i
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    at
                                    
                                    i
                                    ,
                                    f
                                    )
                                    =
                                    
                                       
                                          @
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    cvar
                                    ,
                                    f
                                    )
                                    =
                                    cvar
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    at
                                    
                                    cvar
                                    ,
                                    f
                                    )
                                    =
                                    
                                       
                                          @
                                       
                                       
                                          cvar
                                       
                                    
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    exists
                                    
                                    cvar
                                    
                                    :
                                    
                                    type
                                    .
                                    f
                                    ,
                                    f
                                    )
                                    =
                                    
                                       
                                          ⋁
                                       
                                       
                                          i
                                          ∈
                                          
                                             
                                                Nom
                                             
                                             
                                                type
                                             
                                          
                                       
                                    
                                    
                                       
                                          @
                                       
                                       
                                          i
                                       
                                    
                                    
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    [
                                    cvar
                                    /
                                    i
                                    ]
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    exists
                                    
                                    cvar
                                    .
                                    f
                                    ,
                                    f
                                    )
                                    =
                                    
                                       
                                          ⋁
                                       
                                       
                                          i
                                          ∈
                                          Nom
                                       
                                    
                                    
                                       
                                          @
                                       
                                       
                                          i
                                       
                                    
                                    
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    [
                                    cvar
                                    /
                                    i
                                    ]
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    forall
                                    
                                    cvar
                                    
                                    :
                                    
                                    type
                                    .
                                    f
                                    ,
                                    f
                                    )
                                    =
                                    
                                       
                                          ⋀
                                       
                                       
                                          i
                                          ∈
                                          
                                             
                                                Nom
                                             
                                             
                                                type
                                             
                                          
                                       
                                    
                                    
                                       
                                          @
                                       
                                       
                                          i
                                       
                                    
                                    
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    [
                                    cvar
                                    /
                                    i
                                    ]
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    forall
                                    
                                    cvar
                                    .
                                    f
                                    ,
                                    f
                                    )
                                    =
                                    
                                       
                                          ⋀
                                       
                                       
                                          i
                                          ∈
                                          Nom
                                       
                                    
                                    
                                       
                                          @
                                       
                                       
                                          i
                                       
                                    
                                    
                                    
                                       
                                          F
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    [
                                    cvar
                                    /
                                    i
                                    ]
                                 
                              
                           where 
                              p
                            is a proposition, 
                              g
                              ∈
                              F
                           , 
                              r
                              ∈
                              RelF
                           , 
                              n
                              ∈
                              N
                           , 
                              
                                 
                                    a
                                 
                                 
                                    1
                                 
                              
                              …
                              
                                 
                                    a
                                 
                                 
                                    n
                                 
                              
                            are actual parameters, 
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              …
                              
                                 
                                    f
                                 
                                 
                                    n
                                 
                              
                            are formal parameters, 
                              i
                              ∈
                              Nom
                           , 
                              cvar
                            is a variable, 
                              type
                            is a type defined by a pattern, and with function 
                              
                                 
                                    R
                                 
                                 
                                    S
                                 
                              
                              :
                              RelF
                              →
                              RForm
                            inductively defined as
                              
                                 
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    s
                                    )
                                    =
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    s
                                    )
                                    ,
                                    
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    .
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    )
                                    .
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    )
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    ,
                                    
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          r
                                       
                                       
                                          ⁎
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    
                                       
                                          (
                                          r
                                          )
                                       
                                       
                                          ⁎
                                       
                                    
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          r
                                       
                                       
                                          +
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          R
                                       
                                       
                                          S
                                       
                                    
                                    
                                       
                                          (
                                          r
                                          )
                                       
                                       
                                          +
                                       
                                    
                                 
                              
                           with 
                              s
                              ∈
                              SymF
                           , 
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              ∈
                              RelF
                           , and 
                              
                                 
                                    M
                                 
                                 
                                    S
                                 
                              
                              :
                              SymF
                              →
                              MForm
                            is defined as
                              
                                 
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    m
                                    )
                                    =
                                    m
                                    ,
                                    
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    not
                                    
                                    s
                                    )
                                    =
                                    ¬
                                    
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    s
                                    )
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    true
                                    )
                                    =
                                    ⊤
                                    ,
                                    
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    false
                                    )
                                    =
                                    ⊥
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          1
                                       
                                    
                                    
                                    and
                                    
                                    
                                       
                                          s
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          1
                                       
                                    
                                    )
                                    ∧
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    ,
                                    
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          1
                                       
                                    
                                    
                                    or
                                    
                                    
                                       
                                          s
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          1
                                       
                                    
                                    )
                                    ∨
                                    
                                       
                                          M
                                       
                                       
                                          S
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                              
                           for 
                              m
                            an atomic modal symbol, and 
                              
                                 
                                    s
                                 
                                 
                                    1
                                 
                              
                           , 
                              
                                 
                                    s
                                 
                                 
                                    2
                                 
                              
                              ∈
                              SymF
                           .□

Given a formula map 
                              f
                           , a reconfiguration constraint in 
                              RConst
                            is translated into a state formula of the 2-layer graded hybrid logic by functions
                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          R
                                       
                                    
                                    :
                                    RConst
                                    ×
                                    FM
                                    →
                                    FM
                                    ,
                                    
                                    
                                       
                                          F
                                       
                                       
                                          R
                                       
                                    
                                    :
                                    F
                                    ×
                                    FM
                                    →
                                    SForm
                                    ,
                                    
                                       
                                          R
                                       
                                       
                                          R
                                       
                                    
                                    :
                                    RelF
                                    →
                                    RForm
                                    ,
                                    
                                    and
                                    
                                    
                                       
                                          M
                                       
                                       
                                          R
                                       
                                    
                                    :
                                    SymF
                                    →
                                    MForm
                                    .
                                 
                              
                           The clauses of 
                              
                                 
                                    T
                                 
                                 
                                    R
                                 
                              
                            coincide with the clauses of 
                              
                                 
                                    T
                                 
                                 
                                    S
                                 
                              
                           . The clauses of 
                              
                                 
                                    F
                                 
                                 
                                    R
                                 
                              
                            coincide with the clauses of 
                              
                                 
                                    F
                                 
                                 
                                    S
                                 
                              
                            with the exceptions as follows: clauses that translate hybrid features, which are elided; clauses that translate quantifiers, which are replaced by clauses
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          R
                                       
                                    
                                    (
                                    exists
                                    
                                    cvar
                                    
                                    :
                                    
                                    type
                                    .
                                    f
                                    ,
                                    f
                                    )
                                    =
                                    ∃
                                    
                                    cvar
                                    
                                    :
                                    
                                    type
                                    .
                                    
                                       
                                          F
                                       
                                       
                                          R
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          R
                                       
                                    
                                    (
                                    exists
                                    
                                    cvar
                                    .
                                    f
                                    ,
                                    f
                                    )
                                    =
                                    ∃
                                    
                                    cvar
                                    .
                                    
                                       
                                          F
                                       
                                       
                                          R
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          R
                                       
                                    
                                    (
                                    forall
                                    
                                    cvar
                                    
                                    :
                                    
                                    type
                                    .
                                    f
                                    ,
                                    f
                                    )
                                    =
                                    ∀
                                    
                                    cvar
                                    
                                    :
                                    
                                    type
                                    .
                                    
                                       
                                          F
                                       
                                       
                                          R
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          R
                                       
                                    
                                    (
                                    forall
                                    
                                    cvar
                                    .
                                    f
                                    ,
                                    f
                                    )
                                    =
                                    ∀
                                    
                                    cvar
                                    .
                                    
                                       
                                          F
                                       
                                       
                                          R
                                       
                                    
                                    (
                                    f
                                    ,
                                    f
                                    )
                                    ;
                                 
                              
                           and an added clause for translating nested constraints 
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          R
                                       
                                    
                                    (
                                    nest
                                    
                                    id
                                    ,
                                    f
                                    )
                                    =
                                    f
                                    (
                                    id
                                    )
                                    .
                                 
                              
                           Function 
                              
                                 
                                    R
                                 
                                 
                                    R
                                 
                              
                            coincides with function 
                              
                                 
                                    R
                                 
                                 
                                    S
                                 
                              
                           . The clauses of function 
                              
                                 
                                    M
                                 
                                 
                                    R
                                 
                              
                            coincide with the clauses of 
                              
                                 
                                    M
                                 
                                 
                                    S
                                 
                              
                            with the addition of a clause for translating structured symbols in Fig. 10 matching reconfiguration operations as follows: 
                              
                                 
                                    
                                       
                                          M
                                       
                                       
                                          R
                                       
                                    
                                    (
                                    m
                                    [
                                    
                                       
                                          a
                                       
                                       
                                          1
                                       
                                    
                                    …
                                    
                                       
                                          a
                                       
                                       
                                          n
                                       
                                    
                                    ]
                                    ,
                                    f
                                    )
                                    =
                                    m
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          1
                                       
                                    
                                    …
                                    
                                       
                                          a
                                       
                                       
                                          n
                                       
                                    
                                    )
                                    .
                                 
                              
                           where 
                              m
                              ∈
                            ASYM and 
                              
                                 
                                    a
                                 
                                 
                                    j
                                 
                              
                              ∈
                            Filter.□

@&#REFERENCES@&#

