@&#MAIN-TITLE@&#Bézier extraction and adaptive refinement of truncated hierarchical NURBS

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Bézier extraction of truncated hierarchical 
                                 B
                              -splines and the application of the approach to adaptive isogeometric analysis are presented.


                        
                        
                           
                           An explicit computation of the truncation is avoided.


                        
                        
                           
                           A strict element viewpoint is adopted in the refinement algorithms which facilitates the application of standard procedures of adaptive finite element analysis.


                        
                        
                           
                           Numerical examples demonstrate optimal convergence rates for problems that involve singularities and strong gradients.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Hierarchical 




                        B




                     -splines

Bézier extraction

Isogeometric analysis

Adaptivity

Phase-field modelling

@&#ABSTRACT@&#


               
               
                  This contribution presents Bézier extraction of truncated hierarchical 
                        B
                     -splines and the application of the approach to adaptive isogeometric analysis. The developed procedures allow for the implementation of hierarchical 
                        B
                     -splines and NURBS without the need for an explicit truncation of the basis. Moreover, standard procedures of adaptive finite element analysis for error estimation and marking of elements are directly applicable due to the strict use of an element viewpoint.
                  Starting from a multi-level nested mesh that results from uniform 
                        h
                     -refinement, standard Bézier extraction is applied to active elements that contribute to the hierarchical approximation. This results in a multi-level system of equations without communication between individual hierarchy levels. A hierarchical subdivision operator is developed to recover this communication by transforming the multi-level system of equations into a hierarchical system of equations. It is demonstrated that this approach implicitly defines the truncated hierarchical basis in terms of a simple matrix multiplication. In this way, the implementation effort is reduced to a minimum as shape function routines and Bézier extraction procedures remain unchanged compared to standard isogeometric analysis.
                  The convergence and the computational efficiency of the approach are examined in three different demonstration problems of heat conduction, linear elasticity, and the phase-field modelling of brittle fracture.
               
            

@&#INTRODUCTION@&#

Isogeometric Analysis (IGA)  [1] has been a major step to overcome the disjunction between a computational geometry model, commonly described by Non-Uniform Rational B-Splines (NURBS), and a finite element (FE) model based on Lagrangian polynomial approximations of the geometry and the field variables. In IGA the same 
                        B
                     -spline basis functions which represent the geometry are used to approximate the field variables in the numerical model. In this way, the geometric discretisation errors that result from the approximation of the computational geometry by Lagrangian polynomials are eliminated.

Consequently, IGA is an ideal discretisation technique to be combined with adaptive mesh refinement as already the coarsest mesh provides an exact geometry representation which is preserved during refinement. Tedious interactions with an underlying geometry model are avoided. However, if 
                        B
                     -splines or NURBS are considered as a basis, their tensor product nature will prohibit a truly local refinement within a single NURBS patch. Local refinement with these bases would require the subdivision of the analysis domain into several patches which can then be refined uniformly  [2,3].

Various approaches have been developed to overcome the restrictive tensor product structure: 
                        
                           1.
                           
                              T-splines introduced by Sederberg  [4,5] result from the insertion of extra vertices into the tensor product mesh. This produces so called 
                                 T
                              -junctions which are comparable to hanging nodes in the standard finite element method. 
                                 T
                              -splines enable the representation of complex geometries in a single continuous patch as well as its local refinement. Bazilevs et al.  [6] introduced 
                                 T
                              -splines into IGA. Recent contributions have focused on the linear independence of the basis  [7–10] and on local refinement strategies  [11,12].


                              Locally Refined (LR) 
                              
                                 B
                              
                              -splines have been presented by Dokken et al.  [13]. They are in some way dual to 
                                 T
                              -splines, i.e. tensor product 
                                 B
                              -splines are locally refined by the insertion of knot line segments instead of extra vertices. The properties of LR-
                                 B
                              -splines have been analysed  [14] and first applications to adaptive IGA can be found in  [15].


                              Hierarchical (H) 
                              
                                 B
                              
                              -splines use basis functions defined by knot vectors of different levels of nested meshes that result from successive uniform 
                                 h
                              -refinement. They were introduced by Forsey and Bartels  [16] already in 1988. Hierarchical 
                                 B
                              -splines have been further developed  [17–21] to meet the requirements of IGA.


                              Truncated hierarchical (TH) 
                              
                                 B
                              
                              -splines introduced by Giannelli et al.  [22] are an improved hierarchical 
                                 B
                              -spline basis that recovers the partition-of-unity property and reduces the interaction between basis functions of different refinement levels. Properties of TH
                                 B
                              -splines are studied in  [23,24] and a possible data structure for the construction of TH
                                 B
                              -splines based on quad-trees is provided in  [25].


                              Hierarchical 
                              
                                 T
                              
                              -splines have been presented by Evans et al.  [26] and combine the strictly localised refinement possibilities of hierarchical 
                                 B
                              -splines with the geometrical representation capabilities of 
                                 T
                              -splines.

Local mesh refinement using 
                        T
                     -splines and H
                        B
                     -splines is illustrated in Fig. 1
                      for the benchmark case of a sharp internal layer. It is noted that the 
                        T
                     -spline-based refinement is not as local as with hierarchical 
                        B
                     -splines  [11,26]. The refinement propagates along the parametric directions as a consequence of the restrictions imposed by the required analysis suitability, i.e. the linear independence of the basis. LR-
                        B
                     -splines can overcome this propagation of the refinement. However, a formal proof of the linear independence is still lacking  [24]. Johannessen et al.  [24] and Schillinger et al.  [19] have compared HB- and TH
                        B
                     -splines. They verified the assumption that TH
                        B
                     -splines improve the conditioning and reduce the bandwidth as well as the total number of non-zero entries in the system matrices.

In this contribution, an adaptive isogeometric analysis framework based on TH
                        B
                     -splines is presented. The strict use of an element viewpoint allows for the application of standard adaptive finite element procedures. Different from a direct implementation of the hierarchical basis, standard Bézier extraction  [27] is used on different levels of the hierarchical mesh. It will be shown that this approach produces TH
                        B
                     -splines [22] without the need for an explicit truncation of basis functions.

The paper is organised as follows: basics of 
                        B
                     -splines and Bézier extraction are reviewed in Section  2. In Section  3 the implementation of TH
                        B
                     -splines based on Bézier extraction is outlined. This includes the introduction of the multi-level basis and of the associated data structures. The element-based procedure for the selection of active basis functions, the application of multi-level Bézier extraction, the definition of a hierarchical subdivision operator and the final construction of the hierarchical system of equations are explained. Eventually, the numerical properties of the adaptive approach are analysed for different problems of linear elasticity, heat conduction, and the phase-field modelling of brittle fracture in Section  4.

In this section an overview on the used basis functions as well as Bézier extraction is given. Only properties and concepts that are necessary to explain and understand the remainder of this paper are briefly outlined.

Below, all univariate functions will be introduced with respect to a dimensionless parameter coordinate 
                           ξ
                        . Univariate 
                           B
                        -spline basis functions 
                           
                              N
                           
                           
                              (
                              ξ
                              )
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       
                                          N
                                       
                                       
                                          I
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                    }
                                 
                              
                              
                                 I
                                 =
                                 1
                              
                              
                                 n
                              
                           
                         of order 
                           p
                         are defined by a knot vector 
                           
                              Ξ
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       
                                          ξ
                                       
                                       
                                          I
                                       
                                    
                                    }
                                 
                              
                              
                                 I
                                 =
                                 1
                              
                              
                                 m
                              
                           
                         which contains 
                           I
                           =
                           1
                           …
                           m
                         non-decreasing coordinates 
                           
                              
                                 ξ
                              
                              
                                 I
                              
                           
                        , 
                           ξ
                           ≥
                           0
                         in the parameter domain 
                           
                              
                                 Ω
                              
                              
                                 P
                              
                           
                        . From the 
                           m
                         elements of the knot vector a set of 
                           n
                           =
                           m
                           −
                           p
                           −
                           1
                        
                        
                           B
                        -spline basis functions can be computed according to the Cox–de Boor recursion formula 
                           
                              
                                 (1)
                                 
                                    
                                       
                                          N
                                       
                                       
                                          I
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                    =
                                    
                                       
                                          ξ
                                          −
                                          
                                             
                                                ξ
                                             
                                             
                                                I
                                             
                                          
                                       
                                       
                                          
                                             
                                                ξ
                                             
                                             
                                                I
                                                +
                                                p
                                             
                                          
                                          −
                                          
                                             
                                                ξ
                                             
                                             
                                                I
                                             
                                          
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          I
                                          ,
                                          p
                                          −
                                          1
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                    +
                                    
                                       
                                          
                                             
                                                ξ
                                             
                                             
                                                I
                                                +
                                                p
                                                +
                                                1
                                             
                                          
                                          −
                                          ξ
                                       
                                       
                                          
                                             
                                                ξ
                                             
                                             
                                                I
                                                +
                                                p
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                ξ
                                             
                                             
                                                I
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          I
                                          +
                                          1
                                          ,
                                          p
                                          −
                                          1
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                    
                                    for
                                    
                                    p
                                    ≥
                                    1
                                 
                              
                              
                                 (2)
                                 
                                    
                                       
                                          N
                                       
                                       
                                          I
                                          ,
                                          0
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                1
                                             
                                             
                                                  if  
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      I
                                                   
                                                
                                                ≤
                                                ξ
                                                <
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      I
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                otherwise .
                                             
                                          
                                       
                                    
                                 
                              
                           
                         Univariate 
                           B
                        -spline basis function have a support defined by 
                           
                              (3)
                              
                                 supp
                                 
                                    
                                       N
                                    
                                    
                                       I
                                       ,
                                       p
                                    
                                 
                                 =
                                 
                                    {
                                    ξ
                                    :
                                    
                                       
                                          N
                                       
                                       
                                          I
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                    ≠
                                    0
                                    ∧
                                    ξ
                                    ∈
                                    
                                       
                                          Ω
                                       
                                       
                                          P
                                       
                                    
                                    }
                                 
                                 .
                              
                           
                        
                     

Since 
                           B
                        -spline basis functions are piecewise polynomials, shapes like circles and ellipses cannot be modelled exactly. This can be achieved by geometric representations in terms of NURBS basis functions 
                           
                              R
                           
                           
                              (
                              ξ
                              )
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       
                                          R
                                       
                                       
                                          I
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                    }
                                 
                              
                              
                                 I
                                 =
                                 1
                              
                              
                                 n
                              
                           
                         that are weighted (weights 
                           
                              
                                 w
                              
                              
                                 I
                              
                           
                        ) rational 
                           B
                        -spline basis functions of the same order 
                           p
                        
                        
                           
                              (4)
                              
                                 
                                    
                                       R
                                    
                                    
                                       I
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    ξ
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             I
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          ξ
                                          )
                                       
                                       
                                          
                                             w
                                          
                                          
                                             I
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             J
                                             =
                                             1
                                          
                                          
                                             n
                                          
                                       
                                       
                                          
                                             N
                                          
                                          
                                             J
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          ξ
                                          )
                                       
                                       
                                          
                                             w
                                          
                                          
                                             J
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             I
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          ξ
                                          )
                                       
                                       
                                          
                                             w
                                          
                                          
                                             I
                                          
                                       
                                    
                                    
                                       W
                                       
                                          (
                                          ξ
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                         Multi-variate functions are constructed from tensor products of 
                           k
                           =
                           1
                           ,
                           …
                           ,
                           
                              
                                 d
                              
                              
                                 P
                              
                           
                         univariate sets of 
                           B
                        -spline or NURBS basis functions where 
                           
                              
                                 d
                              
                              
                                 P
                              
                           
                         is the dimension of the parametric domain. The tensor product space 
                           N
                         is spanned by 
                           n
                           =
                           
                              
                                 n
                              
                              
                                 1
                              
                           
                           ×
                           ⋯
                           ×
                           
                              
                                 n
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       P
                                    
                                 
                              
                           
                         multi-variate basis functions 
                           
                              (5)
                              
                                 
                                    
                                       N
                                    
                                    
                                       A
                                       
                                          (
                                          
                                             
                                                I
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      d
                                                   
                                                   
                                                      P
                                                   
                                                
                                             
                                          
                                          )
                                       
                                       ,
                                       
                                          p
                                       
                                    
                                 
                                 
                                    (
                                    
                                       ξ
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       ∏
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             d
                                          
                                          
                                             P
                                          
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       
                                          
                                             I
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             p
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ξ
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                              
                           
                         with the map 
                           A
                           
                              (
                              
                                 
                                    I
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    I
                                 
                                 
                                    2
                                 
                              
                              )
                           
                           =
                           
                              
                                 n
                              
                              
                                 1
                              
                           
                           
                              (
                              
                                 
                                    I
                                 
                                 
                                    2
                                 
                              
                              −
                              1
                              )
                           
                           +
                           
                              
                                 I
                              
                              
                                 1
                              
                           
                         for 
                           
                              
                                 d
                              
                              
                                 P
                              
                           
                           =
                           2
                         and 
                           A
                           
                              (
                              
                                 
                                    I
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    I
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    I
                                 
                                 
                                    3
                                 
                              
                              )
                           
                           =
                           
                              
                                 n
                              
                              
                                 1
                              
                           
                           
                              
                                 n
                              
                              
                                 2
                              
                           
                           
                              (
                              
                                 
                                    I
                                 
                                 
                                    3
                                 
                              
                              −
                              1
                              )
                           
                           +
                           
                              
                                 n
                              
                              
                                 1
                              
                           
                           
                              (
                              
                                 
                                    I
                                 
                                 
                                    2
                                 
                              
                              −
                              1
                              )
                           
                           +
                           
                              
                                 I
                              
                              
                                 1
                              
                           
                         for 
                           
                              
                                 d
                              
                              
                                 P
                              
                           
                           =
                           3
                         and 
                           
                              p
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       
                                          p
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          p
                                       
                                       
                                          
                                             
                                                d
                                             
                                             
                                                P
                                             
                                          
                                       
                                    
                                    }
                                 
                              
                              
                                 T
                              
                           
                         and 
                           
                              
                                 
                                    {
                                    
                                       
                                          N
                                       
                                       
                                          
                                             
                                                I
                                             
                                             
                                                k
                                             
                                          
                                          ,
                                          
                                             
                                                p
                                             
                                             
                                                k
                                             
                                          
                                       
                                       
                                          k
                                       
                                    
                                    }
                                 
                              
                              
                                 
                                    
                                       I
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 1
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       k
                                    
                                 
                              
                           
                         the 
                           
                              
                                 n
                              
                              
                                 k
                              
                           
                         univariate basis functions in parametric direction 
                           k
                        .

According to the concept of isogeometric analysis both, the representation of the geometry and the approximation of field quantities 
                           
                              
                                 (6)
                                 
                                    
                                       x
                                    
                                    
                                       (
                                       
                                          ξ
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          A
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                A
                                             
                                          
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          A
                                          ,
                                          
                                             p
                                          
                                       
                                    
                                    
                                       (
                                       
                                          ξ
                                       
                                       )
                                    
                                    
                                       
                                          
                                             P
                                          
                                       
                                       
                                          A
                                       
                                    
                                    =
                                    
                                       
                                          
                                             P
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       N
                                    
                                    
                                       (
                                       
                                          ξ
                                       
                                       )
                                    
                                 
                              
                              
                                 (7)
                                 
                                    
                                       ψ
                                    
                                    
                                       (
                                       
                                          ξ
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          A
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                A
                                             
                                          
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          A
                                          ,
                                          
                                             p
                                          
                                       
                                    
                                    
                                       (
                                       
                                          ξ
                                       
                                       )
                                    
                                    
                                       
                                          
                                             ψ
                                          
                                       
                                       
                                          A
                                       
                                    
                                    =
                                    
                                       
                                          
                                             ψ
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       N
                                    
                                    
                                       (
                                       
                                          ξ
                                       
                                       )
                                    
                                 
                              
                           
                         are accomplished in terms of the same multi-variate 
                           B
                        -spline basis functions 
                           
                              
                                 N
                              
                              
                                 A
                                 ,
                                 
                                    p
                                 
                              
                           
                           
                              (
                              
                                 ξ
                              
                              )
                           
                        , and a corresponding number of control points with control values 
                           
                              P
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       
                                          
                                             P
                                          
                                       
                                       
                                          A
                                       
                                    
                                    }
                                 
                              
                              
                                 A
                                 =
                                 1
                              
                              
                                 n
                              
                           
                        , and 
                           
                              ψ
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       
                                          
                                             ψ
                                          
                                       
                                       
                                          A
                                       
                                    
                                    }
                                 
                              
                              
                                 A
                                 =
                                 1
                              
                              
                                 n
                              
                           
                        , respectively. They take the role of nodes in the standard finite element method. In the following it is assumed that 
                           
                              
                                 p
                              
                              
                                 k
                              
                           
                         is the same for all parametric directions. It will therefore be omitted in the remainder.

The introduced 
                           B
                        -spline basis functions are defined globally over an entire patch, Fig. 2
                        . Different from that, the standard finite element approach is based on the same set of shape functions for each element in the domain. The central idea of Bézier extraction is to represent the globally defined 
                           B
                        -spline basis functions by Bernstein element shape functions. As a result, every existing FE code can be enhanced with isogeometric analysis features using Bézier extraction. It can be applied to 
                           B
                        -splines, NURBS, and 
                           T
                        -splines and therefore represents a canonical approach to the implementation of IGA. In this contribution we will employ Bézier extraction to implement the truncated hierarchical basis.

To obtain elements in isogeometric analysis, the patch spanned by knot vectors 
                           
                              
                                 
                                    Ξ
                                 
                              
                              
                                 k
                              
                           
                         in the parametric domain is divided into non-zero sub-domains 
                           
                              [
                              
                                 
                                    ξ
                                 
                                 
                                    
                                       
                                          I
                                       
                                       
                                          1
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              
                              
                                 
                                    ξ
                                 
                                 
                                    
                                       
                                          I
                                       
                                       
                                          1
                                       
                                    
                                    +
                                    1
                                 
                                 
                                    1
                                 
                              
                              ]
                           
                           ×
                           ⋯
                           ×
                           
                              [
                              
                                 
                                    ξ
                                 
                                 
                                    
                                       
                                          I
                                       
                                       
                                          
                                             
                                                d
                                             
                                             
                                                P
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          d
                                       
                                       
                                          P
                                       
                                    
                                 
                              
                              
                              
                                 
                                    ξ
                                 
                                 
                                    
                                       
                                          I
                                       
                                       
                                          
                                             
                                                d
                                             
                                             
                                                P
                                             
                                          
                                       
                                    
                                    +
                                    1
                                 
                                 
                                    
                                       
                                          d
                                       
                                       
                                          P
                                       
                                    
                                 
                              
                              ]
                           
                        . These 
                           e
                           =
                           1
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 e
                              
                           
                         sub-domains, denoted by 
                           
                              
                                 Ω
                              
                              
                                 P
                              
                              
                                 e
                              
                           
                        , are referred to as Bézier elements, Fig. 2.

Bézier extraction is essentially based on knot insertion which will therefore be briefly outlined for the univariate case in the following. A new knot 
                           
                              
                                 ξ
                              
                              
                                 ˆ
                              
                           
                           ∈
                           
                              [
                              
                                 
                                    ξ
                                 
                                 
                                    I
                                 
                              
                           
                           ,
                           
                              
                                 ξ
                              
                              
                                 I
                                 +
                                 1
                              
                           
                           
                              [
                           
                         can be inserted into the open knot vector 
                           
                              Ξ
                           
                         which is hence altered to 
                           
                              
                                 
                                    Ξ
                                 
                              
                              
                                 ˆ
                              
                           
                           =
                           
                              {
                              
                                 
                                    ξ
                                 
                                 
                                    1
                                 
                              
                              
                              …
                              
                              
                                 
                                    ξ
                                 
                                 
                                    I
                                 
                              
                              
                              
                                 
                                    ξ
                                 
                                 
                                    ˆ
                                 
                              
                              
                              
                                 
                                    ξ
                                 
                                 
                                    I
                                    +
                                    1
                                 
                              
                              
                              …
                              
                              
                                 
                                    ξ
                                 
                                 
                                    n
                                    +
                                    p
                                    +
                                    1
                                 
                              
                              }
                           
                        , (
                           p
                           <
                           I
                           <
                           n
                           +
                           1
                        ), and results in a set of new basis functions. In order to retain the geometry or approximation while changing the parametrisation of the basis, new control point values 
                           
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          J
                                       
                                    
                                    }
                                 
                              
                              
                                 J
                                 =
                                 1
                              
                              
                                 m
                              
                           
                         have to be computed from the original control points 
                           
                              
                                 
                                    {
                                    
                                       
                                          
                                             P
                                          
                                       
                                       
                                          J
                                       
                                    
                                    }
                                 
                              
                              
                                 J
                                 =
                                 1
                              
                              
                                 n
                              
                           
                         according to 
                           
                              
                                 (8)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          J
                                       
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                             
                                                J
                                                =
                                                1
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      J
                                                   
                                                
                                                
                                                   
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      J
                                                   
                                                
                                                +
                                                
                                                   (
                                                   1
                                                   −
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         J
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      J
                                                      −
                                                      1
                                                   
                                                
                                             
                                             
                                                1
                                                <
                                                J
                                                <
                                                m
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      n
                                                   
                                                
                                             
                                             
                                                J
                                                =
                                                m
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 (9)
                                 
                                    
                                       
                                          α
                                       
                                       
                                          J
                                       
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                1
                                             
                                             
                                                1
                                                ≤
                                                J
                                                ≤
                                                I
                                                −
                                                p
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            J
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            J
                                                            +
                                                            p
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            J
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                I
                                                −
                                                p
                                                +
                                                1
                                                ≤
                                                J
                                                ≤
                                                I
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                J
                                                ≥
                                                I
                                                +
                                                1
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

To obtain the Bernstein basis functions 
                           
                              
                                 B
                              
                              
                                 I
                                 ,
                                 p
                              
                           
                           
                              (
                              ξ
                              )
                           
                        , knot insertion is applied to all knots in 
                           
                              Ξ
                           
                         until the multiplicity of each internal knot equals the polynomial degree 
                           p
                        . The new set of so called Bézier control points 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 ˆ
                              
                           
                         is computed from 
                           B
                        -spline control points 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 ˆ
                              
                           
                           =
                           
                              
                                 
                                    C
                                 
                              
                              
                                 T
                              
                           
                           
                              P
                           
                        .

Recalling that the geometry has to remain unchanged during knot insertion, i.e.  
                           
                              (10)
                              
                                 
                                    x
                                 
                                 
                                    (
                                    ξ
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    N
                                 
                                 
                                    (
                                    ξ
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                P
                                             
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    B
                                 
                                 
                                    (
                                    ξ
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   C
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             P
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    B
                                 
                                 
                                    (
                                    ξ
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    C
                                 
                                 
                                    B
                                 
                                 
                                    (
                                    ξ
                                    )
                                 
                                 ,
                              
                           
                         the relation 
                           
                              (11)
                              
                                 
                                    N
                                 
                                 
                                    (
                                    ξ
                                    )
                                 
                                 =
                                 
                                    C
                                 
                                 
                                    B
                                 
                                 
                                    (
                                    ξ
                                    )
                                 
                              
                           
                         between the globally defined 
                           B
                        -spline basis 
                           
                              N
                           
                           
                              (
                              ξ
                              )
                           
                         and the element-local Bernstein shape functions 
                           
                              B
                           
                           
                              (
                              ξ
                              )
                           
                         is found. The linear operator 
                           
                              C
                           
                         is called Bézier extraction operator and maps the piecewise 
                           
                              
                                 C
                              
                              
                                 0
                              
                           
                        -continuous Bernstein polynomials onto the 
                           B
                        -spline basis of arbitrary continuity, Fig. 3
                        .

In order to allow for a strictly element-based implementation, Bézier extraction operators 
                           
                              
                                 
                                    C
                                 
                              
                              
                                 e
                              
                           
                         are extracted from 
                           
                              C
                           
                         for each Bézier element. Basis functions 
                           
                              N
                           
                           
                              (
                              ξ
                              )
                           
                           
                              
                                 |
                              
                              
                                 
                                    
                                       Ω
                                    
                                    
                                       P
                                    
                                    
                                       e
                                    
                                 
                              
                           
                         with support in this element are expressed by 
                           
                              (12)
                              
                                 
                                    N
                                 
                                 
                                    (
                                    ξ
                                    )
                                 
                                 
                                    
                                       |
                                    
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                             P
                                          
                                          
                                             e
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          N
                                       
                                    
                                    
                                       e
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ξ
                                       
                                       
                                          ̄
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          C
                                       
                                    
                                    
                                       e
                                    
                                 
                                 
                                    B
                                 
                                 
                                    (
                                    
                                       
                                          ξ
                                       
                                       
                                          ̄
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         The univariate Bézier element shape functions 
                           
                              (13)
                              
                                 
                                    
                                       B
                                    
                                    
                                       I
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ξ
                                       
                                       
                                          ̄
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             2
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                       
                                          I
                                          −
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          (
                                          1
                                          −
                                          
                                             
                                                ξ
                                             
                                             
                                                ̄
                                             
                                          
                                          )
                                       
                                    
                                    
                                       p
                                       −
                                       
                                          (
                                          I
                                          −
                                          1
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          (
                                          1
                                          +
                                          
                                             
                                                ξ
                                             
                                             
                                                ̄
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          (
                                          I
                                          −
                                          1
                                          )
                                       
                                    
                                 
                              
                           
                         with the binomial coefficient 
                           
                              
                                 
                                    p
                                 
                                 
                                    I
                                    −
                                    1
                                 
                              
                           
                           =
                           
                              
                                 p
                                 !
                              
                              
                                 
                                    (
                                    I
                                    −
                                    1
                                    )
                                 
                                 !
                                 
                                    (
                                    p
                                    +
                                    1
                                    −
                                    I
                                    )
                                 
                                 !
                              
                           
                         and 
                           1
                           ≤
                           I
                           ≤
                           p
                           +
                           1
                         are conveniently formulated in terms of the parent element coordinates 
                           
                              
                                 ξ
                              
                              
                                 ̄
                              
                           
                           =
                           
                              [
                              −
                              1
                              ,
                              1
                              ]
                           
                         used for numerical integration. Hence, the basis of each Bézier element is defined by the same set of basis functions. Multi-variate Bézier extraction operators 
                           
                              
                                 
                                    C
                                 
                              
                              
                                 e
                              
                           
                           =
                           
                              
                                 
                                    C
                                 
                              
                              
                                 1
                              
                              
                                 e
                              
                           
                           ⊗
                           ⋯
                           ⊗
                           
                              
                                 
                                    C
                                 
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       P
                                    
                                 
                              
                              
                                 e
                              
                           
                         follow from the successive computation of univariate extraction operators 
                           
                              
                                 
                                    C
                                 
                              
                              
                                 k
                              
                              
                                 e
                              
                           
                        .

Note also that exactly the same Bézier extraction procedure can be applied to NURBS basis functions 
                           
                              (14)
                              
                                 
                                    
                                       
                                          R
                                       
                                    
                                    
                                       e
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ξ
                                          
                                       
                                       
                                          ̄
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          W
                                       
                                    
                                    
                                       e
                                    
                                 
                                 
                                    
                                       
                                          C
                                       
                                    
                                    
                                       e
                                    
                                 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   ξ
                                                
                                             
                                             
                                                ̄
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          
                                             W
                                          
                                          
                                             e
                                          
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   ξ
                                                
                                             
                                             
                                                ̄
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                         with the weight function 
                           
                              (15)
                              
                                 
                                    
                                       W
                                    
                                    
                                       e
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ξ
                                          
                                       
                                       
                                          ̄
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          w
                                       
                                    
                                    
                                       e
                                       T
                                    
                                 
                                 
                                    
                                       
                                          C
                                       
                                    
                                    
                                       e
                                    
                                 
                                 
                                    B
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ξ
                                          
                                       
                                       
                                          ̄
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         the element weight vector 
                           
                              
                                 
                                    w
                                 
                              
                              
                                 e
                              
                           
                        , and the diagonal matrix of element weights 
                           
                              
                                 
                                    W
                                 
                              
                              
                                 e
                              
                           
                        . For more details on the method and an efficient algorithm to compute the element-local Bézier extraction operators we refer to the work Borden et al.  [27].

In this section the adaptive local refinement based on truncated hierarchical 
                        B
                     -splines will be outlined. For the selection of active basis functions an element based approach similar to  [20] is applied that would result in the hierarchical basis presented by Vuong et al.  [18]. Afterwards, the application of Bézier extraction on a multi-level basis to assemble a global system of equations is explained. This global system of equations is referred to as multi-level system because entries resulting from different refinement levels do not communicate with each other. The introduction of the hierarchical subdivision operator will recover this communication and a matrix multiplication is used to obtain the final system of equations which we call hierarchical. It will be shown that this novel procedure produces the truncated hierarchical basis of Giannelli et al.  [22]. Explanations are given for univariate 
                        B
                     -splines. Due to the tensor product structure of the basis, the generalisation to multi-variate 
                        B
                     -splines is straight forward and will be highlighted where required. Also the generalisation from 
                        B
                     -splines to NURBS will be addressed.

Different from many works, an element viewpoint is adopted in the following. This is a natural choice in the Bézier extraction framework and allows for the identification of the required basis functions by marking elements as it is typical in adaptive finite element analysis. The hierarchical basis consists of 
                           B
                        -splines with the same polynomial degree 
                           p
                         over all hierarchical levels. Strong conditions on the boundaries of different hierarchy levels are assumed  [18], i.e. elements of two consecutive levels are not allowed to overlap which ensures a tree-like hierarchical element structure.

Consider a hierarchy of 
                              L
                            knot vectors 
                              
                                 
                                    
                                       Ξ
                                    
                                 
                                 
                                    ℓ
                                 
                              
                              ,
                              ℓ
                              =
                              0
                              …
                              L
                              −
                              1
                            created by successive uniform knot insertion (
                              h
                           -refinement) within the univariate parametric domain 
                              
                                 
                                    Ω
                                 
                                 
                                    P
                                 
                              
                            starting from the knot vector 
                              
                                 
                                    
                                       Ξ
                                    
                                 
                                 
                                    0
                                 
                              
                            of the coarsest level (
                              ℓ
                              =
                              0
                           ). The resulting knot vectors are nested, i.e.  
                              
                                 
                                    
                                       Ξ
                                    
                                 
                                 
                                    ℓ
                                 
                              
                              ⊂
                              
                                 
                                    
                                       Ξ
                                    
                                 
                                 
                                    ℓ
                                    +
                                    1
                                 
                              
                           . Each knot vector 
                              
                                 
                                    
                                       Ξ
                                    
                                 
                                 
                                    ℓ
                                 
                              
                            defines a set of 
                              B
                           -spline basis functions 
                              
                                 
                                    
                                       N
                                    
                                 
                                 
                                    ℓ
                                 
                              
                              =
                              
                                 
                                    
                                       {
                                       
                                          
                                             N
                                          
                                          
                                             I
                                          
                                          
                                             ℓ
                                          
                                       
                                       }
                                    
                                 
                                 
                                    I
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ℓ
                                       
                                    
                                 
                              
                            of degree 
                              p
                           . These sets of 
                              B
                           -spline basis functions span the approximation spaces 
                              
                                 
                                    N
                                 
                                 
                                    ℓ
                                 
                              
                            of each corresponding level and are nested, 
                              
                                 
                                    N
                                 
                                 
                                    ℓ
                                 
                              
                              ⊂
                              
                                 
                                    N
                                 
                                 
                                    ℓ
                                    +
                                    1
                                 
                              
                           . They are referred to as the multi-level basis. An exemplary univariate three-level basis is illustrated in Fig. 4
                            for the case 
                              p
                              =
                              2
                           .

In addition to the basis functions, the nested knot vectors of the multi-level basis define a tree-like hierarchical element structure. According to the framework of Bézier extraction, cf. Section  2.2, a number of 
                              e
                              =
                              1
                              ,
                              
                              .
                              .
                              .
                              ,
                              
                              
                                 
                                    n
                                 
                                 
                                    e
                                 
                                 
                                    ℓ
                                 
                              
                            elements with domain 
                              
                                 
                                    Ω
                                 
                                 
                                    P
                                 
                                 
                                    e
                                    ,
                                    ℓ
                                 
                              
                            are defined by non-zero intervals of the knot vectors on the individual hierarchy levels 
                              ℓ
                           . The union of elements on each level covers the analysis domain 
                              
                                 
                                    Ω
                                 
                                 
                                    P
                                 
                              
                              =
                              
                                 
                                    ⋃
                                 
                                 
                                    e
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          e
                                       
                                       
                                          ℓ
                                       
                                    
                                 
                              
                              
                                 
                                    Ω
                                 
                                 
                                    P
                                 
                                 
                                    e
                                    ,
                                    ℓ
                                 
                              
                           . Assuming that two consecutive levels result from a uniform 
                              h
                           -refinement, splitting each coarse knot interval into two fine scale intervals, a hierarchy of nested elements is obtained. In this tree structure each parent element on level 
                              ℓ
                            possesses e.g. two children on level 
                              ℓ
                              +
                              1
                            for the univariate case, Fig. 4. Every element on level 
                              ℓ
                            is associated to 
                              p
                              +
                              1
                            basis functions in 
                              
                                 
                                    N
                                 
                                 
                                    ℓ
                                 
                              
                            which will facilitate an element-based definition of different function sets and of the hierarchical basis.

As a consequence of the nestedness, any 
                              B
                           -spline function in the space 
                              
                                 
                                    N
                                 
                                 
                                    ℓ
                                 
                              
                            can be represented as a linear combination of basis functions in the refined space 
                              
                                 
                                    N
                                 
                                 
                                    ℓ
                                    +
                                    1
                                 
                              
                           
                           
                              
                                 (16)
                                 
                                    
                                       
                                          
                                             N
                                          
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       
                                          
                                             M
                                          
                                       
                                       
                                          ℓ
                                          ,
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    
                                       
                                          
                                             N
                                          
                                       
                                       
                                          ℓ
                                          +
                                          1
                                       
                                    
                                 
                              
                            with 
                              
                                 M
                              
                            the subdivision or refinement operator  [12,19]. The individual entries of the subdivision operator are the coefficients of the linear combination and can be computed from the two-scale relation 
                              
                                 (17)
                                 
                                    
                                       
                                          N
                                       
                                       
                                          I
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                    =
                                    
                                       
                                          2
                                       
                                       
                                          −
                                          p
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          =
                                          0
                                       
                                       
                                          p
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          
                                             p
                                             +
                                             1
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       
                                          N
                                       
                                       
                                          I
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       (
                                       2
                                       ξ
                                       −
                                       t
                                       Δ
                                       ξ
                                       )
                                    
                                    ,
                                 
                              
                            with 
                              Δ
                              ξ
                            the interval of the uniform knot vector and the binomial coefficient 
                              
                                 (18)
                                 
                                    
                                       (
                                       
                                          
                                             p
                                             +
                                             1
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          
                                             (
                                             p
                                             +
                                             1
                                             )
                                          
                                          !
                                       
                                       
                                          t
                                          !
                                          
                                             (
                                             p
                                             +
                                             1
                                             −
                                             t
                                             )
                                          
                                          !
                                       
                                    
                                    .
                                 
                              
                            The functions 
                              
                                 
                                    N
                                 
                                 
                                    I
                                 
                                 
                                    ℓ
                                 
                              
                              
                                 (
                                 2
                                 ξ
                                 −
                                 t
                                 Δ
                                 ξ
                                 )
                              
                            are dilated and translated copies of the original function 
                              
                                 
                                    N
                                 
                                 
                                    I
                                 
                                 
                                    ℓ
                                 
                              
                              
                                 (
                                 ξ
                                 )
                              
                            but can be also interpreted as the functions from the next finer hierarchical level 
                              
                                 
                                    N
                                 
                                 
                                    J
                                 
                                 
                                    ℓ
                                    +
                                    1
                                 
                              
                              
                                 (
                                 ξ
                                 )
                              
                           . Accordingly, Fig. 5
                           (a) shows uniform 
                              B
                           -spline basis functions of two consecutive levels 
                              ℓ
                            and 
                              ℓ
                              +
                              1
                           . A basis function from level 
                              ℓ
                            is represented by a linear combination of basis functions from level 
                              ℓ
                              +
                              1
                           . The coefficients of the linear combination result from the two scale relation (17). However, Eq. (17) does not hold for open, non-uniform knot vectors. For this reason Casciola and Romani  [28] developed an efficient algorithm to compute the subdivision operator for general endpoint-interpolating 
                              B
                           -splines of arbitrary order. As an example, Fig. 5(b) shows non-uniform 
                              B
                           -spline basis functions. Two of them are represented by a linear combination of refined basis functions where the coefficients are obtained from the algorithm presented in  [28].

Subdivision operators for two non-consecutive levels are obtained from 
                              
                                 (19)
                                 
                                    
                                       
                                          
                                             N
                                          
                                       
                                       
                                          I
                                       
                                    
                                    =
                                    
                                       
                                          
                                             M
                                          
                                       
                                       
                                          I
                                          ,
                                          J
                                       
                                    
                                    
                                       
                                          
                                             N
                                          
                                       
                                       
                                          J
                                       
                                    
                                    =
                                    
                                       
                                          ∏
                                       
                                       
                                          ℓ
                                          =
                                          I
                                       
                                       
                                          J
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          
                                             M
                                          
                                       
                                       
                                          ℓ
                                          ,
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    
                                       
                                          
                                             N
                                          
                                       
                                       
                                          J
                                       
                                    
                                    .
                                 
                              
                           
                        

The relations between basis functions translate directly into transformation rules for control values 
                              
                                 P
                              
                            if the same geometry 
                              
                                 x
                              
                            is to be represented in terms of a refined basis 
                              
                                 
                                    (20)
                                    
                                       
                                          x
                                       
                                       =
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          
                                             
                                                M
                                             
                                          
                                          
                                             ℓ
                                             ,
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       
                                       
                                          
                                             
                                                N
                                             
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                    
                                 
                                 
                                    (21)
                                    
                                       
                                          
                                             
                                                P
                                             
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       =
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         M
                                                      
                                                   
                                                   
                                                      ℓ
                                                      ,
                                                      ℓ
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          
                                             
                                                P
                                             
                                          
                                          
                                             ℓ
                                          
                                       
                                       .
                                    
                                 
                              
                           
                        

The generalisation to a multi-variate subdivision operator 
                              
                                 
                                    
                                       M
                                    
                                 
                                 
                                    ℓ
                                    ,
                                    ℓ
                                    +
                                    1
                                 
                              
                            of dimension 
                              
                                 
                                    d
                                 
                                 
                                    P
                                 
                              
                            is obtained from the Kronecker product 
                              
                                 
                                    
                                       M
                                    
                                 
                                 
                                    ℓ
                                    ,
                                    ℓ
                                    +
                                    1
                                 
                              
                              =
                              
                                 
                                    
                                       M
                                    
                                 
                                 
                                    1
                                 
                                 
                                    ℓ
                                    ,
                                    ℓ
                                    +
                                    1
                                 
                              
                              ⊗
                              
                              ⋯
                              
                              ⊗
                              
                                 
                                    
                                       M
                                    
                                 
                                 
                                    
                                       
                                          d
                                       
                                       
                                          P
                                       
                                    
                                 
                                 
                                    ℓ
                                    ,
                                    ℓ
                                    +
                                    1
                                 
                              
                            of univariate subdivision operators 
                              
                                 
                                    
                                       {
                                       
                                          
                                             
                                                M
                                             
                                          
                                          
                                             k
                                          
                                          
                                             ℓ
                                             ,
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       }
                                    
                                 
                                 
                                    k
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          d
                                       
                                       
                                          P
                                       
                                    
                                 
                              
                           .

For a generalisation to NURBS, the subdivision operator has to be modified to interact between rational basis functions 
                              
                                 
                                    
                                       {
                                       
                                          
                                             R
                                          
                                          
                                             I
                                          
                                          
                                             ℓ
                                          
                                       
                                       }
                                    
                                 
                                 
                                    I
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ℓ
                                       
                                    
                                 
                              
                           , and 
                              
                                 
                                    
                                       {
                                       
                                          
                                             R
                                          
                                          
                                             J
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       }
                                    
                                 
                                 
                                    J
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ℓ
                                          +
                                          1
                                       
                                    
                                 
                              
                            of two consecutive levels. It is noted that the denominator of 
                              
                                 
                                    R
                                 
                                 
                                    J
                                 
                                 
                                    ℓ
                                    +
                                    1
                                 
                              
                            will remain unchanged during the refinement process 
                              
                                 (22)
                                 
                                    
                                       
                                          R
                                       
                                       
                                          J
                                       
                                       
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                    =
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                J
                                             
                                             
                                                ℓ
                                                +
                                                1
                                             
                                          
                                          
                                             
                                                N
                                             
                                             
                                                J
                                             
                                             
                                                ℓ
                                                +
                                                1
                                             
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                       
                                       
                                          
                                             
                                                W
                                             
                                             
                                                ℓ
                                                +
                                                1
                                             
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                J
                                             
                                             
                                                ℓ
                                                +
                                                1
                                             
                                          
                                          
                                             
                                                N
                                             
                                             
                                                J
                                             
                                             
                                                ℓ
                                                +
                                                1
                                             
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                       
                                       
                                          
                                             
                                                W
                                             
                                             
                                                ℓ
                                             
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                       
                                    
                                 
                              
                            for a fixed geometry  [19]. Substituting Eq. (16) in 
                              
                                 
                                    R
                                 
                                 
                                    I
                                 
                                 
                                    ℓ
                                 
                              
                              
                                 (
                                 ξ
                                 )
                              
                           , and replacing 
                              
                                 
                                    N
                                 
                                 
                                    J
                                 
                                 
                                    ℓ
                                    +
                                    1
                                 
                              
                              
                                 (
                                 ξ
                                 )
                              
                            in terms of Eq. (22), a two-scale relation for rational 
                              B
                           -splines is given by 
                              
                                 (23)
                                 
                                    
                                       
                                          R
                                       
                                       
                                          I
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                    =
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                I
                                             
                                             
                                                ℓ
                                             
                                          
                                          
                                             
                                                N
                                             
                                             
                                                I
                                             
                                             
                                                ℓ
                                             
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                       
                                       
                                          
                                             
                                                W
                                             
                                             
                                                ℓ
                                             
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                I
                                             
                                             
                                                ℓ
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                J
                                             
                                          
                                          
                                             
                                                M
                                             
                                             
                                                I
                                                J
                                             
                                             
                                                ℓ
                                                ,
                                                ℓ
                                                +
                                                1
                                             
                                          
                                          
                                             
                                                N
                                             
                                             
                                                J
                                             
                                             
                                                ℓ
                                                +
                                                1
                                             
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                       
                                       
                                          
                                             
                                                W
                                             
                                             
                                                ℓ
                                             
                                          
                                          
                                             (
                                             ξ
                                             )
                                          
                                       
                                    
                                    =
                                    
                                       
                                          w
                                       
                                       
                                          I
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          J
                                       
                                    
                                    
                                       
                                          
                                             
                                                M
                                             
                                             
                                                I
                                                J
                                             
                                             
                                                ℓ
                                                ,
                                                ℓ
                                                +
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                w
                                             
                                             
                                                J
                                             
                                             
                                                ℓ
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    
                                       
                                          R
                                       
                                       
                                          J
                                       
                                       
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       ξ
                                       )
                                    
                                 
                              
                            with the rational subdivision operator 
                              
                                 (24)
                                 
                                    
                                       
                                          
                                             
                                                M
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          I
                                          J
                                       
                                       
                                          ℓ
                                          ,
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                I
                                             
                                             
                                                ℓ
                                             
                                          
                                       
                                       
                                          
                                             
                                                w
                                             
                                             
                                                J
                                             
                                             
                                                ℓ
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    
                                       
                                          M
                                       
                                       
                                          I
                                          J
                                       
                                       
                                          ℓ
                                          ,
                                          ℓ
                                          +
                                          1
                                       
                                    
                                 
                              
                            that replaces the standard subdivision operator 
                              
                                 
                                    
                                       M
                                    
                                 
                                 
                                    ℓ
                                    ,
                                    ℓ
                                    +
                                    1
                                 
                              
                           .

In the hierarchical approach to local refinement, basis functions from the approximation spaces of different levels 
                              
                                 
                                    N
                                 
                                 
                                    ℓ
                                 
                              
                            are combined to span the hierarchical basis space 
                              A
                           . However, building the hierarchical basis cannot be achieved by simply adding basis functions from finer hierarchy levels to the coarse scale basis. This would result in the loss of linear independence, because coarse level basis functions are linear combinations of the fine-scale functions according to Eq. (16). A corresponding element-based approach to the proper selection of active basis functions will be outlined in the following. In this way, typical finite element procedures for error estimation and marking elements for refinement, respectively, can be seamlessly transferred to the framework of isogeometric analysis.

The element-based selection of basis functions contributing to the hierarchical approximation uses two essential definitions which are exemplarily illustrated in Fig. 6
                            for the three-level basis of Fig. 4: 
                              
                                 1.
                                 
                                    Active elements: By some marking criterion elements 
                                       
                                          
                                             E
                                          
                                          
                                             e
                                          
                                          
                                             ℓ
                                          
                                       
                                       ≔
                                       
                                          
                                             Ω
                                          
                                          
                                             P
                                          
                                          
                                             e
                                             ,
                                             ℓ
                                          
                                       
                                     of different hierarchy levels have to be chosen to discretise the analysis domain. These elements 
                                       
                                          
                                             E
                                          
                                          
                                             e
                                          
                                          
                                             ℓ
                                          
                                       
                                     define sets 
                                       
                                          
                                             M
                                          
                                          
                                             ℓ
                                          
                                       
                                       =
                                       
                                          
                                             ⋃
                                          
                                          
                                             e
                                          
                                       
                                       
                                          
                                             E
                                          
                                          
                                             e
                                          
                                          
                                             ℓ
                                          
                                       
                                    . They are called active elements and cover the domain 
                                       
                                          
                                             Ω
                                          
                                          
                                             P
                                          
                                       
                                       =
                                       
                                          
                                             ⋃
                                          
                                          
                                             ℓ
                                             =
                                             0
                                          
                                          
                                             L
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             M
                                          
                                          
                                             ℓ
                                          
                                       
                                     without any overlap. This can be seen in Fig. 6 where active elements are indicated in green. Additionally, a set 
                                       
                                          
                                             M
                                          
                                          
                                             +
                                          
                                          
                                             ℓ
                                          
                                       
                                       =
                                       
                                          
                                             ⋃
                                          
                                          
                                             I
                                             =
                                             ℓ
                                             +
                                             1
                                          
                                          
                                             L
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                       
                                     contains all active elements on finer hierarchy levels than 
                                       ℓ
                                     and 
                                       
                                          
                                             M
                                          
                                          
                                             −
                                          
                                          
                                             ℓ
                                          
                                       
                                       =
                                       
                                          
                                             ⋃
                                          
                                          
                                             I
                                             =
                                             0
                                          
                                          
                                             ℓ
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                       
                                     comprises all active elements on coarser hierarchy levels.


                                    Active basis functions: Every active element is associated to a number of 
                                       p
                                       +
                                       1
                                     basis functions in the multi-level basis. The union of these basis functions on each level 
                                       ℓ
                                     forms a set 
                                       
                                          (25)
                                          
                                             
                                                
                                                   A
                                                
                                                
                                                   ℓ
                                                
                                             
                                             =
                                             
                                                {
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      I
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                                :
                                                
                                                supp
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      I
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                                ∩
                                                
                                                   
                                                      M
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                                ≠
                                                0̸
                                                }
                                             
                                          
                                       
                                     and is plotted in colour in Fig. 6(a). However, to ensure a linearly independent basis not all of these functions can contribute to the hierarchical approximation, i.e. attention has to be paid to basis functions whose support overlaps with the domains of active elements on finer or coarser hierarchy levels. In this context, the definition of two subsets is convenient: 
                                       
                                          (a)
                                          
                                             Basis function set 
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      +
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                             : Basis functions in 
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                              with support in the domains of active elements on finer hierarchy levels form the set 
                                                
                                                   (26)
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         
                                                            +
                                                         
                                                         
                                                            ℓ
                                                         
                                                      
                                                      =
                                                      
                                                         {
                                                         
                                                            
                                                               N
                                                            
                                                            
                                                               I
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                         ∈
                                                         
                                                            
                                                               A
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                         :
                                                         
                                                         supp
                                                         
                                                            
                                                               N
                                                            
                                                            
                                                               I
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                         ∩
                                                         
                                                            
                                                               M
                                                            
                                                            
                                                               +
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                         ≠
                                                         0̸
                                                         }
                                                      
                                                   
                                                
                                              and contribute actively to the hierarchical approximation. Corresponding functions are indicated in Fig. 6(a) by dashed coloured lines.


                                             Basis function set 
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      −
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                             : To ensure a linearly independent hierarchical approximation, basis functions of 
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                              with support in the domain of active elements on coarser levels cannot contribute to the hierarchical basis. Functions belonging to these sets 
                                                
                                                   (27)
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         
                                                            −
                                                         
                                                         
                                                            ℓ
                                                         
                                                      
                                                      =
                                                      
                                                         {
                                                         
                                                            
                                                               N
                                                            
                                                            
                                                               I
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                         ∈
                                                         
                                                            
                                                               A
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                         :
                                                         
                                                         supp
                                                         
                                                            
                                                               N
                                                            
                                                            
                                                               I
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                         ∩
                                                         
                                                            
                                                               M
                                                            
                                                            
                                                               −
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                         ≠
                                                         0̸
                                                         }
                                                      
                                                   
                                                
                                              are plotted by dotted coloured lines in Fig. 6(a).

In the preceding section, procedures for selecting the elements and basis functions that contribute to the hierarchical approximation have been introduced. In the following, an implementation of truncated hierarchical 
                           B
                        -splines will be outlined which does not require to carry out the truncation operations explicitly. Instead, the basis is obtained from Bézier extraction performed for all active elements 
                           
                              
                                 M
                              
                              
                                 ℓ
                              
                           
                         of each level 
                           ℓ
                        . The required truncation is eventually achieved in terms of a hierarchical subdivision operator. This procedure consists of three steps: 
                           
                              1.
                              At first the element matrices of all active elements are computed without considering information on whether the basis function contributes to the hierarchical basis or not. This ensures the applicability of standard Bézier extraction.

Once element matrices for all active elements of one level 
                                    ℓ
                                  have been obtained, they are assembled to form sub-systems for each hierarchy level.

Finally, these sub-systems are combined to form the global system of equations. This process is achieved by a transformation matrix 
                                    
                                       
                                          
                                             M
                                          
                                       
                                       
                                          h
                                       
                                    
                                  which can be identified as a hierarchical subdivision operator, i.e. simple matrix multiplication ensures that only basis functions in 
                                    A
                                  contribute to the approximation.

The operations carried out in steps (1) and (2) are standard procedures in isogeometric analysis. Using Bézier extraction outlined in Section  2.2 the 
                              B
                           -spline basis functions of the multi-level-basis are mapped onto a unique set of Bernstein polynomials which act as shape functions of the Bézier elements. Then numerical quadrature is applied on the parent element to obtain the coefficient matrices of all active elements. The matrices of active elements of each hierarchy level 
                              ℓ
                            are assembled into sub-systems of equations 
                              
                                 (30)
                                 
                                    
                                       
                                          
                                             K
                                          
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          ℓ
                                       
                                    
                                 
                              
                            with 
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    ℓ
                                 
                              
                            and 
                              
                                 
                                    
                                       F
                                    
                                 
                                 
                                    ℓ
                                 
                              
                            column vectors containing the control values of generalised degrees of freedom and the associated generalised forces. Their length is 
                              
                                 
                                    n
                                 
                                 
                                    ℓ
                                 
                              
                              ⋅
                              
                                 
                                    n
                                 
                                 
                                    DOF
                                 
                              
                            where 
                              
                                 
                                    n
                                 
                                 
                                    ℓ
                                 
                              
                            is the total number of basis functions or control points on level 
                              ℓ
                           , and 
                              
                                 
                                    n
                                 
                                 
                                    DOF
                                 
                              
                            is the degree of freedom at each control point. Consequently, 
                              
                                 
                                    
                                       K
                                    
                                 
                                 
                                    ℓ
                                 
                              
                            is a square matrix of size 
                              
                                 [
                                 
                                    
                                       n
                                    
                                    
                                       ℓ
                                    
                                 
                                 ⋅
                                 
                                    
                                       n
                                    
                                    
                                       DOF
                                    
                                 
                                 ×
                                 
                                    
                                       n
                                    
                                    
                                       ℓ
                                    
                                 
                                 ⋅
                                 
                                    
                                       n
                                    
                                    
                                       DOF
                                    
                                 
                                 ]
                              
                           . The sub-systems of the individual levels 
                              ℓ
                            can be arranged into a global system of equations 
                              
                                 (31)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   [
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     K
                                                                  
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               0
                                                            
                                                         
                                                         
                                                            …
                                                         
                                                         
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     K
                                                                  
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                         
                                                         
                                                         
                                                      
                                                      
                                                         
                                                            ⋮
                                                         
                                                         
                                                         
                                                            ⋱
                                                         
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                         
                                                         
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     K
                                                                  
                                                               
                                                               
                                                                  L
                                                                  −
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ]
                                                
                                             
                                             ︸
                                          
                                       
                                       
                                          
                                             K
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   [
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     u
                                                                  
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     u
                                                                  
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            ⋮
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     u
                                                                  
                                                               
                                                               
                                                                  L
                                                                  −
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ]
                                                
                                             
                                             ︸
                                          
                                       
                                       
                                          
                                             u
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   [
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     F
                                                                  
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     F
                                                                  
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            ⋮
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     F
                                                                  
                                                               
                                                               
                                                                  L
                                                                  −
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ]
                                                
                                             
                                             ︸
                                          
                                       
                                       
                                          
                                             F
                                          
                                       
                                    
                                    .
                                 
                              
                            In the multi-level system of Eq. (31) there is no communication between individual levels as observed in the sparsity pattern of 
                              
                                 K
                              
                            in Fig. 7
                           (a) generated for the hierarchical basis in Fig. 6. Empty spaces in the characteristic band structure result from inactive elements on each level.

This interconnection will be introduced in the following in terms of the hierarchical refinement operator 
                              
                                 
                                    
                                       M
                                    
                                 
                                 
                                    h
                                 
                              
                           . It acts as a transformation matrix on the multi-level system 
                              
                                 
                                    (32)
                                    
                                       
                                          
                                             
                                                K
                                             
                                          
                                          
                                             h
                                          
                                       
                                       =
                                       
                                          
                                             
                                                M
                                             
                                          
                                          
                                             h
                                          
                                       
                                       
                                          K
                                       
                                       
                                          
                                             
                                                M
                                             
                                          
                                          
                                             h
                                          
                                          
                                             T
                                          
                                       
                                    
                                 
                                 
                                    (33)
                                    
                                       
                                          
                                             
                                                F
                                             
                                          
                                          
                                             h
                                          
                                       
                                       =
                                       
                                          
                                             
                                                M
                                             
                                          
                                          
                                             h
                                          
                                       
                                       
                                          F
                                       
                                    
                                 
                              
                            which results in the hierarchical system of equations 
                              
                                 (34)
                                 
                                    
                                       
                                          
                                             K
                                          
                                       
                                       
                                          h
                                       
                                    
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          h
                                       
                                    
                                    =
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          h
                                       
                                    
                                    .
                                 
                              
                            The sparsity pattern of the subdivision operator 
                              
                                 
                                    
                                       M
                                    
                                 
                                 
                                    h
                                 
                              
                            is shown in Fig. 7(b) while the population of the resulting coefficient matrix 
                              
                                 
                                    
                                       K
                                    
                                 
                                 
                                    h
                                 
                              
                            is plotted in Fig. 7(c). It is noted that in order to reduce memory requirements, efficient matrix libraries with adjusted indexing should be used to avoid zero rows and columns in the multi-level as well as the hierarchical system matrices and in the subdivision operator. A more efficient, condensed matrix representation is illustrated in Fig. 7(d).

The hierarchical subdivision operator 
                              
                                 
                                    
                                       M
                                    
                                 
                                 
                                    h
                                 
                              
                            is an upper triangular matrix with elements 
                              
                                 (35)
                                 
                                    
                                       
                                          
                                             M
                                          
                                       
                                       
                                          h
                                       
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         I
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               M
                                                            
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      0
                                                      ,
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               M
                                                            
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      0
                                                      ,
                                                      2
                                                   
                                                
                                             
                                             
                                                …
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               M
                                                            
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      0
                                                      ,
                                                      L
                                                      −
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         I
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               M
                                                            
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                      ,
                                                      2
                                                   
                                                
                                             
                                             
                                                …
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               M
                                                            
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                      ,
                                                      L
                                                      −
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         I
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                …
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               M
                                                            
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                      ,
                                                      L
                                                      −
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   0
                                                
                                             
                                             
                                             
                                                ⋱
                                             
                                             
                                          
                                          
                                             
                                             
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         I
                                                      
                                                   
                                                   
                                                      L
                                                      −
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    .
                                 
                              
                            It has to transfer the contributions from all active shape functions of the multi-level to the hierarchical system of equations. This is accomplished in terms of an activity indicator matrix 
                              
                                 
                                    
                                       I
                                    
                                 
                                 
                                    ℓ
                                 
                              
                            for each level 
                              
                                 (36)
                                 
                                    
                                       
                                          I
                                       
                                       
                                          
                                             (
                                             I
                                             I
                                             )
                                          
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                1
                                             
                                             
                                                for
                                                
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      I
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      a
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                else
                                             
                                          
                                       
                                    
                                    
                                    and
                                    
                                    
                                       
                                          I
                                       
                                       
                                          I
                                          J
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    0
                                    
                                    for
                                    
                                    I
                                    ≠
                                    J
                                    .
                                 
                              
                            In addition, it can be observed that basis functions belonging to active elements but not to the hierarchical basis, i.e. the functions in the sets 
                              
                                 
                                    A
                                 
                                 
                                    −
                                 
                                 
                                    k
                                 
                              
                           , have been used during the integration of the coefficient matrices of hierarchy levels 
                              k
                              >
                              0
                            in the previous section. Hence, contributions of basis functions of 
                              
                                 
                                    A
                                 
                                 
                                    −
                                 
                                 
                                    k
                                 
                              
                            have to be transferred to active basis functions of level 
                              ℓ
                              <
                              k
                           , particularly to those in the set 
                              
                                 
                                    A
                                 
                                 
                                    +
                                 
                                 
                                    ℓ
                                 
                              
                           . The relation between these shape functions is given in terms of the subdivision operator according to Eqs. (16) and (19), respectively. Since these are the only transformations required, a modified subdivision operator 
                              
                                 (37)
                                 
                                    
                                       
                                          
                                             
                                                M
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          I
                                          J
                                       
                                       
                                          ℓ
                                          ,
                                          k
                                       
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      M
                                                   
                                                   
                                                      I
                                                      J
                                                   
                                                   
                                                      ℓ
                                                      ,
                                                      k
                                                   
                                                
                                             
                                             
                                                for
                                                
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      I
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      +
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                                ∧
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      J
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      −
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                else
                                             
                                          
                                       
                                    
                                 
                              
                            is used in 
                              
                                 
                                    
                                       M
                                    
                                 
                                 
                                    h
                                 
                              
                           . In the appendix, a pseudo code illustrates a possible computational implementation of the hierarchical subdivision operator 
                              
                                 
                                    
                                       M
                                    
                                 
                                 
                                    h
                                 
                              
                            as well as the needed basis function sets 
                              
                                 
                                    A
                                 
                                 
                                    +
                                 
                                 
                                    ℓ
                                 
                              
                           , 
                              
                                 
                                    A
                                 
                                 
                                    −
                                 
                                 
                                    ℓ
                                 
                              
                            and 
                              
                                 
                                    A
                                 
                                 
                                    a
                                 
                                 
                                    ℓ
                                 
                              
                            from Section  3.1.4.

Although the hierarchical basis is never computed explicitly in the present approach, it can be shown that the resulting approximation is identical to the truncated hierarchical basis [22], cf. Fig. 8
                           (b). This basis varies from the hierarchical set of basis functions, Fig. 6(a), in terms of the contribution of active basis functions in the sets 
                              
                                 
                                    A
                                 
                                 
                                    +
                                 
                                 
                                    ℓ
                                 
                              
                           , i.e. the functions plotted as dashed coloured lines in Figs. 6 and 8.

The correspondence of the present approach and the truncated basis in  [22] results from the procedure used to compute the coefficient matrices and from the mapping of contributions of basis functions in 
                              
                                 
                                    A
                                 
                                 
                                    −
                                 
                                 
                                    ℓ
                                    +
                                    1
                                 
                              
                            to those in 
                              
                                 
                                    A
                                 
                                 
                                    +
                                 
                                 
                                    ℓ
                                 
                              
                           . In order to understand this effect, the basis functions 
                              
                                 
                                    N
                                 
                                 
                                    3
                                 
                                 
                                    0
                                 
                              
                            and 
                              
                                 
                                    N
                                 
                                 
                                    4
                                 
                                 
                                    0
                                 
                              
                            according to Fig. 6 are considered as an illustrative example, Fig. 8.

During the multi-level Bézier extraction, standard extraction operators are computed for each active element and numerical integration is carried out subsequently. This has two major implications: 
                              
                                 1.
                                 All basis functions supported in an active element will be considered during quadrature irrespectively of the fact if they are part of the hierarchical basis.

The contribution of basis functions on level 
                                       ℓ
                                     is limited to the domains of active elements, i.e. the integrated domain.

Eventually, the hierarchical subdivision operator will account for the activity of the basis functions and recover the correct support of active basis functions. The matrix elements resulting from 
                              
                                 
                                    N
                                 
                                 
                                    5
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    N
                                 
                                 
                                    6
                                 
                                 
                                    1
                                 
                              
                            are mapped onto those related to 
                              
                                 
                                    N
                                 
                                 
                                    3
                                 
                                 
                                    0
                                 
                              
                            and 
                              
                                 
                                    N
                                 
                                 
                                    4
                                 
                                 
                                    0
                                 
                              
                           . In this way the contribution of the active basis functions 
                              
                                 
                                    N
                                 
                                 
                                    3
                                 
                                 
                                    0
                                 
                              
                            and 
                              
                                 
                                    N
                                 
                                 
                                    4
                                 
                                 
                                    0
                                 
                              
                            in the domains 
                              
                                 
                                    Ω
                                 
                                 
                                    P
                                 
                                 
                                    5
                                    ,
                                    1
                                 
                              
                            and 
                              
                                 
                                    Ω
                                 
                                 
                                    P
                                 
                                 
                                    6
                                    ,
                                    1
                                 
                              
                            is taken into account. As the support of 
                              
                                 
                                    N
                                 
                                 
                                    5
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    N
                                 
                                 
                                    6
                                 
                                 
                                    1
                                 
                              
                            is limited to these two active elements on level 
                              ℓ
                              =
                              1
                           , the support domain of 
                              
                                 
                                    N
                                 
                                 
                                    4
                                 
                                 
                                    0
                                 
                              
                            is truncated. The result is identical to the proposal in  [22]. Therefore, the presented approach provides approximations that possess the partition-of-unity property and a reduced interaction of basis functions between different refinement levels.

In the previous section, the implicit implementation of the truncated hierarchical basis was outlined. The application of the basis to adaptive isogeometric analysis follows the standard procedure of adaptive finite element analysis: 
                           
                              
                                 S1
                              
                              
                                 Solve the model problem,


                                 Estimate the error of the approximation,


                                 Mark elements for refinement using quantities of S2, and


                                 Refine the marked elements and go back to S1.

The marking (S3) and activation of elements (S4) are subjected to restrictions that ensure a well defined basis: 
                              
                                 1.
                                 
                                    Restriction: Due to the definition of the 
                                       B
                                    -spline basis functions in Eq. (1), the refinement of a single element on level 
                                       ℓ
                                     creates two active child elements on level 
                                       ℓ
                                       +
                                       1
                                    , cf. Fig. 9
                                    (a). However, it leads only to basis functions 
                                       
                                          
                                             N
                                          
                                          
                                             I
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       ∈
                                       
                                          
                                             A
                                          
                                          
                                             −
                                          
                                          
                                             ℓ
                                          
                                       
                                     which improve the integration but do not enlarge the approximation space 
                                       A
                                     of the hierarchical basis. This can be overcome by marking groups of 
                                       p
                                     elements as shown in Fig. 9(b) for the univariate case and 
                                       p
                                       =
                                       2
                                    .


                                    Restriction: Adjacent elements are forced to be from the same or at most from two consecutive levels 
                                       ℓ
                                       ,
                                       ℓ
                                       +
                                       1
                                    . This restriction reduces widespread interactions of basis functions and hence improves the condition and bandwidth of the hierarchical coefficient matrix 
                                       
                                          
                                             
                                                K
                                             
                                          
                                          
                                             h
                                          
                                       
                                    .

Numerical investigations have demonstrated that a violation of the first restriction does not affect the computations and optimal convergence rates are obtained nevertheless. In addition, the marking of a single element on level 
                              ℓ
                            according to Fig. 9(a) is also acceptable in the case of multiple refinement steps, 
                              
                                 
                                    h
                                 
                                 
                                    
                                       max
                                    
                                 
                              
                              >
                              1
                           , as a re-selection of its child elements on level 
                              ℓ
                              +
                              1
                            will lead to well defined basis functions on level 
                              ℓ
                              +
                              2
                           , Fig. 9(c). Note also that the second restriction is applied in Fig. 9(c) and therefore adjacent elements of the marked element on level 
                              ℓ
                            have been refined.

The control values 
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    h
                                 
                              
                            at control points that correspond to the hierarchical basis 
                              A
                            are obtained by solving the hierarchical system of equations (34). The application of adaptive local refinement algorithms to non-linear problems requires a mapping of the solution vector to provide initial values for the newly activated elements.

Assume a solution 
                              
                                 
                                 
                                    t
                                 
                              
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    h
                                 
                              
                            has been computed for the time increment 
                              t
                            using the hierarchical basis 
                              
                                 
                                 
                                    t
                                 
                              
                              A
                           . For the subsequent increment 
                              t
                              +
                              Δ
                              t
                           , certain elements will be marked for refinement. This results in the activation or deactivation of elements and their associated basis functions and control points. Therefore, the solution 
                              
                                 
                                 
                                    t
                                 
                              
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    h
                                 
                              
                            has to be mapped to the new hierarchical basis 
                              
                                 
                                 
                                    t
                                    +
                                    Δ
                                    t
                                 
                              
                              A
                            in order to generate a new initial solution vector 
                              
                                 
                                 
                                    0
                                 
                                 
                                    t
                                    +
                                    Δ
                                    t
                                 
                              
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    h
                                 
                              
                            for the subsequent time step. Consequently, new control variables are computed from 
                              
                                 (38)
                                 
                                    
                                       
                                          
                                       
                                       
                                          0
                                       
                                       
                                          t
                                          +
                                          Δ
                                          t
                                       
                                    
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   
                                                      
                                                         
                                                            M
                                                         
                                                      
                                                      
                                                         ̃
                                                      
                                                   
                                                
                                                
                                                   ℓ
                                                   ,
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          
                                       
                                       
                                          t
                                       
                                    
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          ℓ
                                       
                                    
                                 
                              
                            with the modified subdivision operator according to Eq. (16)
                           
                              
                                 (39)
                                 
                                    
                                       
                                          
                                             
                                                M
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          I
                                          J
                                       
                                       
                                          ℓ
                                          ,
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                0
                                             
                                             
                                                for
                                                
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      J
                                                   
                                                   
                                                      ℓ
                                                      +
                                                      1
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      a
                                                   
                                                   
                                                      ℓ
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      M
                                                   
                                                   
                                                      I
                                                      J
                                                   
                                                   
                                                      ℓ
                                                      ,
                                                      ℓ
                                                      +
                                                      1
                                                   
                                                
                                             
                                             
                                                else
                                             
                                          
                                       
                                    
                                 
                              
                            in order to avoid overwriting of existing solutions 
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    h
                                 
                                 
                                    ℓ
                                 
                              
                           . In this way, control values for all children in the element tree of an active element are provided. If the hierarchical basis 
                              
                                 
                                 
                                    t
                                    +
                                    Δ
                                    t
                                 
                              
                              A
                            results from a refinement of 
                              
                                 
                                 
                                    t
                                 
                              
                              A
                           , this mapping will always be exact because the fine scale basis functions are able to exactly represent the coarse scale solution.

In this section three numerical examples are considered to analyse the numerical properties of the presented approach to TH
                        B
                     -splines. The results of the adaptive local refinement algorithm are compared with results obtained from globally refined NURBS. The first two examples are problems of heat conduction and linear elasticity with given analytical solutions that are commonly used as benchmarks in adaptive IGA  [11,18,29,30]. In the third demonstration problem, the phase-field approach to brittle fracture is combined with adaptive mesh refinement in the vicinity of the crack tip to simulate crack propagation in a single-edge notched shear test.

In this example the Laplace problem 
                           
                              (40)
                              
                                 Δ
                                 u
                                 =
                                 0
                                 
                                 in
                                 
                                 Ω
                                 ,
                                 
                                 
                                    
                                       u
                                    
                                    
                                       ̄
                                    
                                 
                                 =
                                 0
                                 
                                 on
                                 
                                 
                                    
                                       Γ
                                    
                                    
                                       D
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             u
                                          
                                          
                                             ̄
                                          
                                       
                                    
                                    
                                       ∂
                                       n
                                    
                                 
                                 =
                                 g
                                 
                                 on
                                 
                                 
                                    
                                       Γ
                                    
                                    
                                       N
                                    
                                 
                                 ,
                              
                           
                         is solved for the temperature 
                           u
                         on a two-dimensional 
                           L
                        -shaped domain 
                           Ω
                        . The exact solution of the problem is given by 
                           
                              (41)
                              
                                 
                                    
                                       u
                                    
                                    
                                       ̄
                                    
                                 
                                 =
                                 
                                    
                                       r
                                    
                                    
                                       
                                          
                                             3
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 sin
                                 
                                    
                                       2
                                       ϕ
                                       −
                                       π
                                    
                                    
                                       3
                                    
                                 
                                 
                                 .
                              
                           
                         On the Neumann boundary 
                           
                              
                                 Γ
                              
                              
                                 N
                              
                           
                        , the exact heat flux 
                           g
                           =
                           ∂
                           
                              
                                 u
                              
                              
                                 ̄
                              
                           
                           /
                           ∂
                           n
                         and on the Dirichlet boundary 
                           
                              
                                 Γ
                              
                              
                                 D
                              
                           
                        , homogeneous boundary conditions are applied. The definition of the boundary value problem is illustrated in Fig. 10
                        .

The domain is modelled by two NURBS patches resulting in a 
                           
                              
                                 C
                              
                              
                                 0
                              
                           
                        -continuous line, dashed in Fig. 10. Note that the L-shaped geometry could also be modelled by a 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                        -continuous basis. But as already shown by Vuong  [17], who used hierarchical 
                           B
                        -splines to adaptively refine the mesh, the continuity of the approximation does not influence the convergence rates, neither for uniform nor for local refinement if the marking parameter 
                           α
                         is adjusted accordingly. Only an offset between the convergence curves can be found which implies that a 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                        -continuous basis provides a better overall approximation. Our investigations have shown the same behaviour for the use of TH
                           B
                        -splines.

The geometry of the problem leads to a singularity at the re-entrant corner. In this case classical convergence theory does not hold and the order of convergence with respect to the total number of degrees of freedom 
                           
                              (42)
                              
                                 k
                                 =
                                 −
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                 min
                                 
                                    (
                                    p
                                    ,
                                    
                                       
                                          π
                                       
                                       
                                          2
                                          π
                                          −
                                          β
                                       
                                    
                                    )
                                 
                              
                           
                         is governed by the angle 
                           β
                         of the re-entrant corner  [31]. In the case of global 
                           h
                        -refinement this leads to a convergence rate of 
                           k
                           =
                           −
                           1
                           /
                           3
                           
                           
                           ∀
                           p
                         for the 
                           L
                        -shaped domain with 
                           β
                           =
                           90
                           °
                        .

The optimal order of convergence 
                           k
                           =
                           −
                           p
                           /
                           2
                         can be recovered by local mesh refinement in the vicinity of the singularity. To select the elements for refinement, quantile marking 
                           
                              (43)
                              
                                 θ
                                 =
                                 α
                                 -quantile
                                 
                                    (
                                    
                                       
                                          η
                                       
                                       
                                          e
                                       
                                    
                                    )
                                 
                                 
                                 with
                                 
                                 0
                                 <
                                 α
                                 <
                                 1
                              
                           
                         is used. That is, elements with an error exceeding the 
                           α
                        -quantile of element errors will be marked for refinement. For, e.g.  
                           α
                           =
                           0.8
                        , the 20% of elements with the largest element errors 
                           
                              
                                 η
                              
                              
                                 e
                              
                           
                         will be selected. With the analytic solution of Eq. (41) at hand, there is no need for an error estimator and the element errors 
                           
                              (44)
                              
                                 
                                    
                                       η
                                    
                                    
                                       e
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ‖
                                          
                                             (
                                             
                                                
                                                   u
                                                
                                                
                                                   ̄
                                                
                                             
                                             −
                                             u
                                             )
                                          
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             L
                                          
                                          
                                             2
                                          
                                       
                                       ;
                                       
                                          
                                             E
                                          
                                          
                                             e
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ‖
                                          ∇
                                          
                                             (
                                             
                                                
                                                   u
                                                
                                                
                                                   ̄
                                                
                                             
                                             −
                                             u
                                             )
                                          
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             L
                                          
                                          
                                             2
                                          
                                       
                                       ;
                                       
                                          
                                             E
                                          
                                          
                                             e
                                          
                                       
                                    
                                 
                                 
                              
                           
                         are computed in the 
                           
                              
                                 H
                              
                              
                                 1
                              
                           
                         norm. The domain error 
                           
                              
                                 η
                              
                              
                                 2
                              
                           
                           =
                           
                              
                                 ∑
                              
                              
                                 e
                              
                           
                           
                              
                                 η
                              
                              
                                 e
                              
                              
                                 2
                              
                           
                         is obtained as the sum over all elements.

The results presented below have been obtained for a quadratic and a cubic basis with an initial mesh of 32 elements, Fig. 11
                        (a), and 
                           
                              
                                 h
                              
                              
                                 
                                    max
                                 
                              
                           
                           =
                           6
                         adaptive refinement steps. The mesh refinement is controlled by quantile marking with 
                           α
                           =
                           0.8
                        . In Fig. 11(b) meshes for the quadratic basis are given. It can be seen that the corner singularity is well detected within the refinement process.


                        Fig. 12
                         shows a comparison of the convergence for adaptive local and global mesh refinement. While the convergence of uniform 
                           h
                        -refinement is governed by the singularity, i.e. the expected order of convergence of 
                           k
                           =
                           −
                           
                              
                                 1
                              
                              
                                 3
                              
                           
                         is found, optimal orders of convergence are achieved for the quadratic (
                           k
                           =
                           −
                           1
                        ) and the cubic basis (
                           k
                           =
                           −
                           1.5
                        ) in the case of adaptive local refinement. This implies that the approach generates well graded meshes in the vicinity of the corner singularity.

Moreover, condition numbers 
                           κ
                         are compared for global and local refinement for the cases of 
                           p
                           =
                           2
                         and 
                           p
                           =
                           3
                         in Fig. 13
                        . For comparison, the condition numbers for H
                           B
                        -splines according to  [17] are plotted as well. In Fig. 13, the condition number 
                           κ
                         is plotted over the total degree of freedom. For the quadratic basis both, the global and local, refinement procedures result in similar condition numbers. For the case 
                           p
                           =
                           3
                        , 
                           κ
                         increases significantly for H
                           B
                        -splines, whereas the condition number for TH
                           B
                        -splines remains on the same level as for global refinement. This confirms the hypothesis, that TH
                           B
                        -splines reduce the interaction of basis functions, and hence effectively improve the condition number compared to H
                           B
                        -splines.

As a second example, an infinite plate with a circular hole under uniaxial in-plane tension 
                           
                              
                                 σ
                              
                              
                                 0
                              
                           
                         according to Fig. 14
                        (a) is considered. The analytical solution is given by Timoshenko  [32] in polar coordinates 
                           
                              (
                              r
                              ,
                              ϕ
                              )
                           
                        
                        
                           
                              
                                 (45)
                                 
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                ̄
                                             
                                          
                                       
                                       
                                          r
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                0
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    
                                       [
                                       1
                                       −
                                       
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       +
                                       
                                          (
                                          1
                                          −
                                          4
                                          
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          +
                                          3
                                          
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      4
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      4
                                                   
                                                
                                             
                                          
                                          )
                                       
                                       cos
                                       
                                          (
                                          2
                                          φ
                                          )
                                       
                                       ]
                                    
                                 
                              
                              
                                 (46)
                                 
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                ̄
                                             
                                          
                                       
                                       
                                          φ
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                0
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    
                                       [
                                       1
                                       +
                                       
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       −
                                       
                                          (
                                          1
                                          +
                                          3
                                          
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      4
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      4
                                                   
                                                
                                             
                                          
                                          )
                                       
                                       cos
                                       
                                          (
                                          2
                                          φ
                                          )
                                       
                                       ]
                                    
                                 
                              
                              
                                 (47)
                                 
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                ̄
                                             
                                          
                                       
                                       
                                          r
                                          φ
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                0
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    
                                       (
                                       −
                                       1
                                       −
                                       2
                                       
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       +
                                       3
                                       
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                
                                                
                                                   4
                                                
                                             
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   4
                                                
                                             
                                          
                                       
                                       )
                                    
                                    sin
                                    
                                       (
                                       2
                                       φ
                                       )
                                    
                                 
                              
                           
                         where 
                           
                              
                                 r
                              
                              
                                 i
                              
                           
                           =
                           1
                           
                           
                              m
                           
                           
                              m
                           
                         is the radius of the hole. A numerical solution is conveniently obtained on the quarter of an annulus with Dirichlet boundaries to enforce the symmetry conditions, and a Neumann boundary 
                           
                              
                                 Γ
                              
                              
                                 N
                              
                           
                         at the outer radius to enforce the exact normal stress 
                           
                              
                                 
                                    σ
                                 
                              
                              
                                 ̄
                              
                           
                           
                              n
                           
                        . The uniaxial tensile stress 
                           
                              
                                 σ
                              
                              
                                 0
                              
                           
                           =
                           1
                           
                           
                              M
                           
                           
                              Pa
                           
                         is applied in the 
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                        -direction and material parameters 
                           E
                           =
                           
                              
                                 10
                              
                              
                                 5
                              
                           
                           
                           
                              Pa
                           
                         and 
                           ν
                           =
                           0.3
                         are used. The computational domain is modelled by a single 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                        -continuous NURBS patch with an outer radius 
                           
                              
                                 r
                              
                              
                                 o
                              
                           
                           =
                           8
                        .

The exact solution features a stress concentration at 
                           
                              (
                              x
                              ,
                              y
                              )
                           
                           =
                           
                              (
                              0
                              ,
                              1
                              )
                           
                         of 
                           
                              
                                 σ
                              
                              
                                 11
                              
                           
                           =
                           3
                           
                              
                                 σ
                              
                              
                                 0
                              
                           
                         as illustrated in Fig. 14(b). Due to the lack of a singularity, optimal convergence rates 
                           k
                           =
                           −
                           p
                           /
                           2
                         can be obtained by uniform 
                           h
                        -refinement. Local refinement does not improve this rate in the asymptotic limit  [11,18,29,30]. There is however a benefit of the adaptive refinement which increases with the locality of the stress concentration. That is, if the outer radius 
                           
                              
                                 r
                              
                              
                                 o
                              
                           
                         is larger, the stress concentration is more localised in the computational domain, cf. Fig. 14(a), and an improved convergence rate can be achieved in the pre-asymptotic region.

The problem has been solved using a quadratic and a cubic basis with an initial mesh of 16 elements, Fig. 15
                        (a), and 
                           
                              
                                 h
                              
                              
                                 
                                    max
                                 
                              
                           
                           =
                           6
                         adaptive refinement steps. Elements are selected for refinement using quantile marking with 
                           α
                           =
                           0.4
                        . The Bézier meshes for 
                           h
                           =
                           3
                         and 
                           h
                           =
                           5
                         are illustrated in Fig. 15(b). They show a local refinement of the mesh in the vicinity of the hole, i.e. a resolution of the stress gradients has been achieved.

The convergence in the 
                           
                              
                                 H
                              
                              
                                 1
                              
                           
                         norm is illustrated in Fig. 16
                         for the quadratic and cubic bases. In the case of local refinement, the convergence rate can be improved in the pre-asymptotic regime, e.g. the first four to five refinement steps, but approaches a convergence rate of 
                           k
                           =
                           −
                           p
                           /
                           2
                         in the asymptotic region. Hence, adaptive mesh refinement can be used to efficiently model localisation problems.

The final example addresses the phase-field modelling of brittle fracture. Different from standard sharp interface models, the discrete crack is smeared in terms of a crack density 
                           c
                         which is used as phase-field order parameter. It can be interpreted as a damage variable. The transition zone between the fully broken material (
                           c
                           =
                           1
                        ), and the undamaged material (
                           c
                           =
                           0
                        ) is characterised by an internal length scale 
                           
                              
                                 ℓ
                              
                              
                                 0
                              
                           
                         which is considered to be a material parameter.

By coupling the scalar phase field to a mechanical boundary value problem, the initiation and propagation of the crack are described by the evolution of the crack phase field and the cumbersome numerical tracking of the crack path is avoided, cf. Fig. 17
                        (a). However, the variability of the approach comes at the cost of highly refined meshes along the crack path that are required to properly resolve the transition zone. Hence, adaptive local refinement is essential for efficient computations.

The model is based on a variational formulation of the Griffith theory presented by e.g. Francfort and Marigo  [33]. The energy functional 
                           
                              (48)
                              
                                 Π
                                 
                                    (
                                    
                                       u
                                    
                                    ,
                                    c
                                    )
                                 
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       Ω
                                    
                                 
                                 ψ
                                 
                                    (
                                    
                                       ε
                                    
                                    
                                       (
                                       
                                          u
                                       
                                       )
                                    
                                    ,
                                    c
                                    )
                                 
                                 
                                 
                                    d
                                 
                                 V
                                 +
                                 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             c
                                          
                                       
                                    
                                    
                                       2
                                       
                                          
                                             ℓ
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∫
                                    
                                    
                                       Ω
                                    
                                 
                                 
                                    [
                                    
                                       
                                          c
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          ℓ
                                       
                                       
                                          0
                                       
                                    
                                    
                                       
                                          
                                             |
                                             ∇
                                             c
                                             |
                                          
                                       
                                       
                                          2
                                       
                                    
                                    ]
                                 
                                 
                                 
                                    d
                                 
                                 V
                              
                           
                         consists of the elastic energy in the (damaged) bulk material, and the fracture energy which is smeared across the transition zone of length 
                           
                              
                                 ℓ
                              
                              
                                 0
                              
                           
                        . This approach was further developed by Miehe et al.  [34,35] who proposed a tensile/compressive split of the elastic energy to prevent crack propagation under compressive loads and the introduction of a strain energy history function to avoid crack heeling. The approach leads to two fully coupled differential equations for the displacement field 
                           
                              u
                           
                         and the phase field 
                           c
                        . The quasi static solution can be found by using a staggered  [35] or monolithic  [36] solution scheme. A recent review of different formulations is presented in  [37] while a critical review of the solution procedures and the choice of boundary conditions can be found in  [38].

The solved model problem is illustrated in Fig. 17(b). It considers a square specimen that is notched on the left edge. The plate is clamped at the bottom edge while a given displacement is applied on the top edge. The initial notch is prescribed as a discrete crack in terms of a 
                           
                              
                                 C
                              
                              
                                 −
                                 1
                              
                           
                        -continuity line between two of the four patches. The Lamé parameters for the material are 
                           λ
                           =
                           121.15
                           
                           
                              k
                           
                           
                              N
                           
                           
                           
                              
                                 
                                    mm
                                 
                              
                              
                                 −
                                 2
                              
                           
                         and 
                           μ
                           =
                           80.77
                           
                           
                              k
                           
                           
                              N
                           
                           
                           
                              
                                 
                                    mm
                                 
                              
                              
                                 −
                                 2
                              
                           
                         and the phase field parameters are given by the material fracture toughness 
                           
                              
                                 G
                              
                              
                                 c
                              
                           
                           =
                           2.7
                           ×
                           1
                           
                              
                                 0
                              
                              
                                 −
                                 3
                              
                           
                           
                           
                              k
                           
                           
                              N
                           
                           
                           
                              
                                 
                                    mm
                                 
                              
                              
                                 −
                                 1
                              
                           
                         and the characteristic length 
                           
                              
                                 ℓ
                              
                              
                                 0
                              
                           
                           =
                           0.75
                           ×
                           1
                           
                              
                                 0
                              
                              
                                 −
                                 2
                              
                           
                           
                           
                              mm
                           
                        . These parameters are identical to the work of Miehe et al.  [35] which allows for a quantitative comparison. A staggered solution scheme is used with a displacement increment of 
                           Δ
                           u
                           =
                           1
                           
                              
                                 0
                              
                              
                                 −
                                 5
                              
                           
                           
                           
                              mm
                           
                         per time step. The initial mesh is pre-refined in the vicinity of the initial crack tip, Fig. 18
                        (a) (left). The threshold for the adaptive mesh refinement is set to 
                           c
                           =
                           0.5
                        , i.e. elements are marked for refinement if the phase field parameter at any quadrature point of the element falls below 0.5. The non-linear problem requires a mapping of the solution according to the algorithm presented in Section  3.3.2.

Below, a comparison between two solutions, one obtained on an adaptively refined mesh, and one computed on a uniformly pre-refined mesh is presented, Fig. 18. Both solutions produce the same crack pattern and it can be seen that the adaptive algorithm resolves the crack path. Moreover, the shape of the crack is identical to the numerical solution in  [35].

In addition to the qualitative agreement of the crack paths, the comparison of the force–displacement curve obtained with both solutions is identical, Fig. 19
                        (a). The adaptive approach significantly reduces the number of elements which improves the efficiency compared to uniform refinement, Fig. 19(b). It is observed from Fig. 19(c) that the computational time is cut by 
                           76
                           %
                        . Note also that knowledge on the expected crack path was used to generate the uniformly pre-refined mesh which is impossible for problems of arbitrary complexity.

@&#CONCLUSIONS@&#

In this contribution, Bézier extraction of truncated hierarchical 
                        B
                     -splines and the application of the approach to adaptive isogeometric analysis have been presented. The use of an element viewpoint and the application of Bézier extraction to a multi-level mesh facilitate the implementation into any existing finite element code. Moreover, standard procedures of adaptive finite element analysis are directly applicable.

While Bézier extraction provided a multi-level system of equations with independent levels, the communication between different levels of the hierarchy has been introduced in terms of a hierarchical subdivision operator for 
                        B
                     -splines and NURBS. It was shown that a simple matrix multiplication produces a hierarchical system of equations that is identical to the use of the truncated hierarchical basis. It is noted that the explicit truncation of the basis is avoided.

Numerical examples have shown that the adaptively refined meshes are well graded. Hence, optimal convergence rates are obtained. Additionally, the efficiency of the approach in terms of reduced computation time has been demonstrated for the phase-field modelling of brittle fracture.

In future works, the presented procedures will be extended to coarsening. Due to the element viewpoint, coarsening of the mesh is performed by the activation of appropriate elements and the generation of the hierarchical basis according to the approach presented above. However, attention has to be paid to the mapping of control variables and internal state variables.

@&#ACKNOWLEDGEMENTS@&#

The authors gratefully acknowledge support by the Deutsche Forschungsgemeinschaft in the Priority Program 1748 “Reliable simulation techniques in solid mechanics. Development of non-standard discretisation methods, mechanical and mathematical analysis” under the project KA3309/3-1.


                     
                        
                           
                        
                     
                     
                        
                           
                        
                     
                  

In this section an algorithm for the computation of the hierarchical subdivision operator is outlined. As mentioned in Section  3.2.2 this requires the computation of the basis function sets from Section  3.1.4 which will be explained as well. To make the algorithms more comprehensible, the degree of freedom per control point is set to one.

At first, different variables and arrays of the multi-level structure according to Section  3.1 have to be defined. A global basis function number (
                        g
                        F
                        I
                        D
                     ) is introduced by successively counting each basis function in the multi-level basis from 
                        g
                        F
                        I
                        D
                        =
                        0
                      to 
                        g
                        F
                        I
                        D
                        =
                        n
                        F
                        −
                        1
                     . Here, 
                        n
                        F
                      denotes the total number of basis functions. All basis function numbers 
                        g
                        F
                        I
                        D
                      that belong to a specific hierarchy level 
                        ℓ
                        =
                        0
                        ,
                        …
                        ,
                        L
                        −
                        1
                      are stored in arrays named 
                        
                           
                              FoL
                           
                           
                              ℓ
                           
                        
                     . A global element number (
                        g
                        E
                        I
                        D
                     ) is introduced by counting each element in the multi-level mesh from 
                        g
                        E
                        I
                        D
                        =
                        0
                      to 
                        g
                        E
                        I
                        D
                        =
                        n
                        E
                        −
                        1
                      where 
                        n
                        E
                      denotes the total number of elements. Remembering Section  3.1.4, each element is associated to 
                        
                           
                              
                                 (
                                 p
                                 +
                                 1
                                 )
                              
                           
                           
                              
                                 
                                    d
                                 
                                 
                                    P
                                 
                              
                           
                        
                      basis functions of the multi-level basis. A two-dimensional array 
                        KI
                      of size 
                        
                           [
                           n
                           E
                           ×
                           
                              
                                 
                                    (
                                    p
                                    +
                                    1
                                    )
                                 
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       P
                                    
                                 
                              
                           
                           ]
                        
                      contains the global numbers of these basis functions for each element. Hence, 
                        KI
                        
                           (
                           g
                           E
                           I
                           D
                           ,
                           :
                           )
                        
                      provides all global basis function numbers 
                        g
                        F
                        I
                        D
                      associated to element 
                        g
                        E
                        I
                        D
                     .

Furthermore, logical vectors 
                        ActiveElems
                      and 
                        ActiveChildren
                      of size 
                        
                           [
                           n
                           E
                           ×
                           1
                           ]
                        
                      are initialised with 
                        f
                        a
                        l
                        s
                        e
                     . According to Section  3.1.4, arbitrary elements from different refinement levels can be activated to cover the computational domain. If an element with given 
                        g
                        E
                        I
                        D
                      is active, 
                        ActiveElems
                        
                           (
                           g
                           E
                           I
                           D
                           )
                        
                      is set 
                        t
                        r
                        u
                        e
                     . Alternatively, if the children of this element are active the array element 
                        ActiveChild
                        
                           (
                           g
                           E
                           I
                           D
                           )
                        
                      is set 
                        t
                        r
                        u
                        e
                     .

With these information at hand, globally defined logical arrays 
                        Aplus
                     , 
                        Aminus
                     , and 
                        Aa
                     , containing the information of the basis function sets 
                        
                           
                              A
                           
                           
                              +
                           
                           
                              ℓ
                           
                        
                     , 
                        
                           
                              A
                           
                           
                              −
                           
                           
                              ℓ
                           
                        
                     , and 
                        
                           
                              A
                           
                           
                              a
                           
                           
                              ℓ
                           
                        
                      for 
                        ℓ
                        =
                        0
                        ,
                        …
                        ,
                        L
                        −
                        1
                     , can be computed by Algorithm 1: GetFunctionSets. As it can be seen, only the information if an element or its children are active is required.

In addition to the arrays defined above, the computation of the hierarchical subdivision operator requires the subdivision operator 
                        
                           
                              
                                 M
                              
                           
                           
                              ℓ
                              ,
                              ℓ
                              +
                              1
                           
                        
                      between adjacent levels 
                        ℓ
                      and 
                        ℓ
                        +
                        1
                     . Using an algorithm in  [28] as already mentioned in Section  3.1.3, the hierarchical subdivision operator 
                        
                           
                              
                                 M
                              
                           
                           
                              h
                           
                        
                      can be computed by Algorithm 2: GetM.

@&#REFERENCES@&#

