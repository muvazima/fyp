@&#MAIN-TITLE@&#Iso-level tool path planning for free-form surfaces

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A new and unified framework for optimizing tool path is proposed.


                        
                        
                           
                           Tool path is represented as the iso-level curves of a scalar function.


                        
                        
                           
                           Properties of tool path are encoded into that of the scalar function.


                        
                        
                           
                           Formulas for controlling the scalar function are derived.


                        
                        
                           
                           Optimal tool path regarding iso-scallop and smoothness is generated.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Iso-level tool path

Globally optimal

PDE

Iso-scallop

Smooth

@&#ABSTRACT@&#


               
               
                  The aim of tool path planning is to maximize the efficiency against some given precision criteria. In practice, scallop height should be kept constant to avoid unnecessary cutting, while the tool path should be smooth enough to maintain a high feed rate. However, iso-scallop and smoothness often conflict with each other. Existing methods smooth iso-scallop paths one-by-one, which make the final tool path far from being globally optimal. This paper proposes a new framework for tool path optimization. It views a family of iso-level curves of a scalar function defined over the surface as tool path so that desired tool path can be generated by finding the function that minimizes certain energy functional and different objectives can be considered simultaneously. We use the framework to plan globally optimal tool path with respect to iso-scallop and smoothness. The energy functionals for planning iso-scallop, smoothness, and optimal tool path are respectively derived, and the path topology is studied too. Experimental results are given to show effectiveness of the proposed methods.
               
            

@&#INTRODUCTION@&#

The terminology “tool path” refers to a specified trajectory along which machine tools move their ends (i.e., cutter and table) to form desired surfaces. The automatic generation of such trajectories are of central importance in modern CAD/CAM systems. There are two fundamental criteria, i.e., precision and efficiency, for automatic tool path generation. Precision means the error of approximating a surface with a family of curves, and approximating a curve with a family of segments or arcs. Efficiency concerns the time of machining along the tool path. The aim of tool path planning is to maximize the efficiency under the given precision criteria. In this paper, we propose a method, which can take these two criteria into consideration together, to generate globally optimal tool paths.

@&#RELATED WORKS@&#

For a given precision tolerance (i.e., the scallop height and chord deviation), the tool path is always supposed to be as smooth and short as possible. In this paper, the smoothness of tool path is measured by its curvature in the 3D space. If the tool path is smooth enough, there is less repeated acceleration/deceleration, which makes it possible to maintain a high feed rate. Meanwhile, the shorter the tool path is, the less time the machining takes. Theoretically, tool paths following the direction of maximum machining strip width are the shortest in total length, since they maximize material removal. But such strategy often leads to irregular tool paths which are neither direction/contour parallel nor spiral, as shown in  [1,2]. Therefore, in practice, a weaker condition that the tool path has no unnecessary (also called redundant) cutting is adopted. To achieve this, the scallop height should be kept constant along the path. Hence, tool paths with iso-scallop and smooth properties are preferable.

Last decade has seen a great deal of literature on tool path planning for free-form surfaces, such as iso-parametric method [3–5], iso-planar method [6–8], iso-scallop method [9–15], iso-phote method  [16] and C-space method  [17], to name a few. Surveys of much more work about tool path planning research can be found in  [18,19]. Since we aim at optimal tool paths with respect to iso-scallop and smoothness, we put special interest in the iso-scallop method, which means the height of the points at the scallop curves remains as high as a given value so that the tool path has no unnecessary cutting. Conventionally, constant scallop height is obtained by varying the offset magnitude along each path. A mathematical method for generating iso-scallop tool paths following such strategy was first proposed by Suresh et al. [9]. Afterwards methods to improve the computing efficiency  [10,13] and accuracy [11,12,15] were proposed. In 2007, Kim  [14] reformulated the iso-scallop tool path as geodesic parallel curves on the design surface by defining a new Riemannian metric.

Despite the non-redundance property, tool paths of constant scallop height tend to have sharp corners, as illustrated in Fig. 1
                        , which implies that smoothness and iso-scallop requirements often conflict with each other. And the tradeoff between them is a major concern in tool path planning. A widely adopted solution to this is post-processing: first a new path with constant scallop is generated by varying the offset magnitude along current path, then it is smoothed by replacing its corners with circular arcs  [20,21]. An alternative is to employ the level set method to offset the paths while keeping them smooth  [22]. Similar to the image segmentation method proposed by Paragios et al. [23], a curvature term can be added into the evolution equation so that points of higher curvature are offset less while those of lower curvature are offset more. However, on one hand, for a path subject to desired precision, the modification would introduce error. On the other hand, if the path is offset less than the desired tolerance to avoid such error, then hardly can we choose a proper offset magnitude since we usually do not have an overall picture of the tool path. For example, in  [22], because a curvature item is introduced into the normal velocity, it is still unknown how to choose a proper evolution step that determines the distance between neighboring paths. In fact, such local modification is in general unable to gain a globally optimal tool path, since it cannot take the ungenerated paths into account when operating on (or optimizing) one path. All previous offset based methods generate tool paths one-by-one, and thus inherit the drawback of non-optimality.

There also exist some efforts to generate smooth tool paths without considering the overlapping between neighbor machining strips (i.e., the iso-scallop condition). Generally, such methods are based on the Laplacian. For example, Bieterman and Sandstrom [24] proposed a Laplacian based contour parallel tool path generation method by selecting the level sets of a harmonic function defined over a pocket as the tool path. But how to choose the level sets for it still remains an open problem, namely there is no formula for path interval calculation so far. Similarly, Chuang and Yang  [25] combined the Laplacian method and the iso-parametric method to generate tool paths for pockets with complex topology, i.e., complex boundaries and islands. However, the smoothness of the tool path cannot be guaranteed through Laplacian energy as a small Laplacian value does not necessarily mean small curvature of the level set curves. And solving a Laplace equation over a surface can only generate a unique and uncontrollable scalar function (scaling has no impact on the shape of tool paths). Another drawback of the Laplacian based approach is the severe overlapping between machining strips of neighbor paths, especially for paths near the boundary, which results in too much redundant machining.

In this paper, we aim to plan optimal tool path regarding iso-scallop and smoothness. We propose a framework that is able to obtain a globally optimal tool path by considering several objectives together. The tool path is represented as a family of level set curves from a scalar function defined over the surface, and our method computes an optimal scalar function by solving a single optimization problem, instead of generating the curves one-by-one. We refer to the level sets as iso-level curves, and the proposed tool path planning method as the iso-level method, in order to be consistent with other terminologies in the literature such as iso-parametric, iso-planar, iso-scallop and iso-phote.

As the tool path is represented by the iso-level curves of some optimized scalar function, desired properties of the tool path are encoded into the properties of the scalar function. In this work, we give the details of how to control the scalar function so that the desired tool path, e.g., iso-scallop tool path, can be generated. We first propose an iso-scallop condition for the target function, which shapes two neighboring iso-level curves to be iso-scallop. Then we propose a smoothness objective. Finally we combine them together to form the objective energy functional so that its minimizer corresponds to an optimal tool path with respect to iso-scallop and smoothness. To the best of our knowledge, this paper is the first work where these formulas are given, through which the interval between iso-level curves and their smoothness can be controlled globally. The minimizer of the iso-scallop objective can not only be exploited to plan tool path of constant scallop, but also has an interesting machining meaning, namely, the level increment of two neighbor iso-level curves equals the square root of scallop height. In addition, the optimal scalar function can be reused to generate the tool path of different scallop height tolerances.

Compared with existing tool path generation methods, the proposed method solves the tool path planing problem in a global optimization manner. Besides, the proposed iso-level tool path planning method can free us from the tedious post-processing step for self-intersection and disjunction, which will be demonstrated in more detail in Section  2.4. In addition, since the scalar function is defined all over the surface, the model is completely covered by the iso-level curves, i.e., there are no regions that are not machined, as opposed to the offset based methods (illustrated in Fig. 1). Our optimization framework can also be easily extended to include other objectives, such as tool wear, machine kinematics and dynamics.

The remainder of this paper is organized as follows: Section  2 describes the optimization models for the iso-level method, including iso-scallop tool path generation (Section  2.1), smooth tool path generation (Section  2.2), and optimal tool path generation (Section  2.3), followed by a discussion on tool path topology (Section  2.4). In Section  3, we present the numerical solution to the optimization models. Section  4 summarizes the overall procedures for planning iso-level tool paths. Section  5 shows the experimental results. Finally, we conclude the whole paper in Section  6.

Consider a surface 
                        S
                      embedded in 
                        
                           
                              R
                           
                           
                              3
                           
                        
                      and a scalar function 
                        φ
                        :
                        S
                        →
                        R
                      defined over it. The curves on 
                        S
                      which correspond to a set of values 
                        
                           
                              
                                 {
                                 
                                    
                                       l
                                    
                                    
                                       i
                                    
                                 
                                 }
                              
                           
                           
                              i
                              =
                              1
                           
                           
                              n
                           
                        
                      bounded by the range of the scalar function are selected as tool path for the surface. There are two problems to concern when generating tool path following this strategy: the design of 
                        φ
                      and the mathematical method for determining 
                        
                           {
                           
                              
                                 l
                              
                              
                                 i
                              
                           
                           }
                        
                     . In this section, we describe our solution to them, and demonstrate how to plan iso-level tool paths.

In general, a tool path is discretized as a family of curves on the surface. Scallop refers to the remaining material that is generated when the cutter sweeps along two neighbor paths, which results in deviation between the machined surface and the design surface. Generally, we use the height from the points at the ridge of the scallop to the design surface to quantify such error, as illustrated in Fig. 2
                        (a). On one hand, the closer the two neighboring curves are, the lower the scallop height becomes. On the other hand, closer curves may lead to longer path and time to machine the whole surface. Therefore, the iso-scallop method generates tool paths with the scallop height as high as a specific tolerance in order to avoid redundant machining and achieves higher efficiency. The scallop height is determined by the interval between two neighbor paths and they are related by the following formula  [10]
                        
                           
                              (1)
                              
                                 h
                                 =
                                 
                                    
                                       
                                          
                                             κ
                                          
                                          
                                             s
                                          
                                       
                                       +
                                       
                                          
                                             κ
                                          
                                          
                                             c
                                          
                                       
                                    
                                    
                                       8
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    O
                                 
                                 
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          3
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           w
                         denotes the interval 
                           
                              
                                 p
                              
                              
                                 i
                              
                           
                           
                              
                                 p
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        , 
                           h
                         is the scallop height, 
                           
                              
                                 κ
                              
                              
                                 s
                              
                           
                         is the normal curvature along the direction normal to path 
                           
                              
                                 C
                              
                              
                                 i
                              
                           
                        , as shown in Fig. 2(b), and 
                           
                              
                                 κ
                              
                              
                                 c
                              
                           
                         is the curvature of the cutter.

Let 
                           
                              
                                 C
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 C
                              
                              
                                 i
                                 +
                                 1
                              
                           
                         be the iso-level curves 
                           
                              {
                              p
                              ∈
                              S
                              
                              |
                              
                              φ
                              
                                 (
                                 p
                                 )
                              
                              =
                              
                                 
                                    l
                                 
                                 
                                    i
                                 
                              
                              }
                           
                         and 
                           
                              {
                              p
                              ∈
                              S
                              
                              |
                              
                              φ
                              
                                 (
                                 p
                                 )
                              
                              =
                              
                                 
                                    l
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              }
                           
                        , respectively. Then appeal to Taylor’s theorem, we have 
                           
                              (2)
                              
                                 
                                    
                                       l
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       l
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          ∇
                                          φ
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    (
                                    
                                       
                                          p
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          p
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 +
                                 
                                    O
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ‖
                                             
                                                
                                                   p
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   p
                                                
                                                
                                                   i
                                                
                                             
                                             ‖
                                          
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         The gradient 
                           ∇
                           φ
                         is a vector in the tangent plane of the surface at point 
                           
                              
                                 p
                              
                              
                                 i
                              
                           
                        , and normal to the path. Therefore, the expression can be rewritten as 
                           
                              (3)
                              
                                 
                                    |
                                    
                                       
                                          l
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          l
                                       
                                       
                                          i
                                       
                                    
                                    |
                                 
                                 =
                                 
                                    ‖
                                    ∇
                                    φ
                                    ‖
                                 
                                 ⋅
                                 
                                    ‖
                                    
                                       
                                          p
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          p
                                       
                                       
                                          i
                                       
                                    
                                    ‖
                                 
                                 +
                                 
                                    O
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ‖
                                             
                                                
                                                   p
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   p
                                                
                                                
                                                   i
                                                
                                             
                                             ‖
                                          
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         Then 
                           
                              (4)
                              
                                 
                                    ‖
                                    ∇
                                    φ
                                    ‖
                                 
                                 =
                                 
                                    
                                       lim
                                    
                                    
                                       
                                          ‖
                                          
                                             
                                                p
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                p
                                             
                                             
                                                i
                                             
                                          
                                          ‖
                                       
                                       →
                                       0
                                    
                                 
                                 
                                    
                                       
                                          |
                                          
                                             
                                                l
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                l
                                             
                                             
                                                i
                                             
                                          
                                          |
                                       
                                    
                                    
                                       
                                          ‖
                                          
                                             
                                                p
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                p
                                             
                                             
                                                i
                                             
                                          
                                          ‖
                                       
                                    
                                 
                                 .
                              
                           
                         If the level increment 
                           
                              |
                              
                                 
                                    l
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              −
                              
                                 
                                    l
                                 
                                 
                                    i
                                 
                              
                              |
                           
                         of the scalar function is endowed with a machining meaning by letting it equal to the square root of scallop height, Eq. (4) will be 
                           
                              (5)
                              
                                 
                                    ‖
                                    ∇
                                    φ
                                    ‖
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   κ
                                                
                                                
                                                   s
                                                
                                             
                                             +
                                             
                                                
                                                   κ
                                                
                                                
                                                   c
                                                
                                             
                                          
                                          
                                             8
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                         and the scallop height between two neighbor iso-level curves of 
                           φ
                         will be constant and equal to the square of the increment. This can be easily verified by substituting Eq. (1) into Eq. (4).

Thus an iso-scallop tool path can be generated by finding a scalar function satisfying Eq. (5). And we obtain such 
                           φ
                         by solving a nonlinear least square problem
                           
                              (6)
                              
                                 
                                    
                                       min
                                    
                                    
                                       φ
                                    
                                 
                                 
                                 
                                 
                                    
                                       E
                                    
                                    
                                       w
                                    
                                 
                                 
                                    (
                                    φ
                                    )
                                 
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       S
                                    
                                 
                                 
                                    
                                       
                                          (
                                          
                                             ‖
                                             ∇
                                             φ
                                             ‖
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            κ
                                                         
                                                         
                                                            s
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            κ
                                                         
                                                         
                                                            c
                                                         
                                                      
                                                   
                                                   
                                                      8
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       2
                                    
                                 
                                 d
                                 S
                                 ,
                              
                           
                         where 
                           
                              
                                 κ
                              
                              
                                 c
                              
                           
                         is a user input and 
                           
                              
                                 κ
                              
                              
                                 s
                              
                           
                         is computed by 
                           
                              (7)
                              
                                 
                                    
                                       κ
                                    
                                    
                                       s
                                    
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                ∇
                                                φ
                                             
                                             
                                                
                                                   ‖
                                                   ∇
                                                   φ
                                                   ‖
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 T
                                 
                                    (
                                    
                                       
                                          ∇
                                          φ
                                       
                                       
                                          
                                             ‖
                                             ∇
                                             φ
                                             ‖
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         with 
                           T
                         denoting the curvature tensor (see  [26,27] for its definition and numerical computation).

Finally, the iso-level curves corresponding to level values 
                           
                              
                                 
                                    {
                                    i
                                    
                                       
                                          h
                                       
                                    
                                    }
                                 
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 n
                              
                           
                         are iso-scallop tool path with constant height 
                           h
                        , that is, level increments between neighboring iso-level curves all equal to 
                           
                              
                                 h
                              
                           
                        . Thus, a large 
                           
                              
                                 h
                              
                           
                         can generate a tool path for rough machining, and a small increment for finish machining. The novelty here is that they share the same scalar function. We refer to this as multiresolution property.

As explained in the introduction section, a smooth tool path is preferred as we can get a nearly constant feed rate along it. For a curve in 3D space, its curvature measures how much it bends at a given point. This is quantified by the norm of its second derivative with respect to arc-length parameter, which measures the rate at which the unit tangent turns along the curve  [26]. It is the very metric to measure the smoothness of the curve.

As the tool path is embedded on the design surface, its second derivative with respect to arc-length parameter can be decomposed into two components, one tangent to the surface and the other normal to the surface (see Fig. 3
                        )  [26]. The norms of these components are called the geodesic curvature and the normal curvature respectively, and they are related to the curve curvature by
                           
                              (8)
                              
                                 
                                    
                                       κ
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       κ
                                    
                                    
                                       g
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       κ
                                    
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         where 
                           κ
                         is the curve curvature, and 
                           
                              
                                 κ
                              
                              
                                 g
                              
                           
                           ,
                           
                              
                                 κ
                              
                              
                                 n
                              
                           
                         are the geodesic curvature and the normal curvature respectively.

For an iso-level curve 
                           ϕ
                           =
                           c
                           o
                           n
                           s
                           t
                        , its normal curvature can be computed by 
                           
                              (9)
                              
                                 
                                    
                                       κ
                                    
                                    
                                       n
                                    
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          n
                                          ×
                                          
                                             
                                                ∇
                                                φ
                                             
                                             
                                                
                                                   ‖
                                                   ∇
                                                   φ
                                                   ‖
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 T
                                 
                                    (
                                    n
                                    ×
                                    
                                       
                                          ∇
                                          φ
                                       
                                       
                                          
                                             ‖
                                             ∇
                                             φ
                                             ‖
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          A
                                          
                                             
                                                ∇
                                                φ
                                             
                                             
                                                
                                                   ‖
                                                   ∇
                                                   φ
                                                   ‖
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 T
                                 
                                    (
                                    A
                                    
                                       
                                          ∇
                                          φ
                                       
                                       
                                          
                                             ‖
                                             ∇
                                             φ
                                             ‖
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                ∇
                                                φ
                                             
                                             
                                                
                                                   ‖
                                                   ∇
                                                   φ
                                                   ‖
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ∇
                                          φ
                                       
                                       
                                          
                                             ‖
                                             ∇
                                             φ
                                             ‖
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           T
                         is the curvature tensor, 
                           n
                           =
                           
                              
                                 
                                    (
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          y
                                       
                                    
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          z
                                       
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                         is the unit normal vector of the surface, and 
                           
                              (10)
                              
                                 A
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             0
                                          
                                          
                                             −
                                             
                                                
                                                   n
                                                
                                                
                                                   z
                                                
                                             
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   y
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   z
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                             −
                                             
                                                
                                                   n
                                                
                                                
                                                   x
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   n
                                                
                                                
                                                   y
                                                
                                             
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   x
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                                 
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       A
                                    
                                    
                                       T
                                    
                                 
                                 T
                                 A
                                 .
                              
                           
                         The geodesic curvature can be computed by 
                           
                              (11)
                              
                                 
                                    
                                       κ
                                    
                                    
                                       g
                                    
                                 
                                 =
                                 
                                    div
                                 
                                 
                                    (
                                    
                                       
                                          ∇
                                          φ
                                       
                                       
                                          
                                             ‖
                                             ∇
                                             φ
                                             ‖
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              div
                           
                           
                              (
                              ⋅
                              )
                           
                         is the divergence operator. For a planar curve, its normal curvature is zero and we have 
                           
                              (12)
                              
                                 κ
                                 =
                                 
                                    
                                       κ
                                    
                                    
                                       g
                                    
                                 
                                 =
                                 
                                    div
                                 
                                 
                                    (
                                    
                                       
                                          ∇
                                          φ
                                       
                                       
                                          
                                             ‖
                                             ∇
                                             φ
                                             ‖
                                          
                                       
                                    
                                    )
                                 
                                 ≠
                                 
                                    div
                                 
                                 
                                    (
                                    ∇
                                    φ
                                    )
                                 
                                 =
                                 
                                    
                                       ∇
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    φ
                                    )
                                 
                                 .
                              
                           
                         Therefore, Laplacian cannot ensure smoothness of a tool path for pocket milling.

To guarantee the smoothness of all iso-level curves on surface 
                           S
                        , we define the smoothness energy as 
                           
                              (13)
                              
                                 
                                    
                                       
                                          
                                             
                                                E
                                             
                                             
                                                κ
                                             
                                          
                                          
                                             (
                                             φ
                                             )
                                          
                                          =
                                          
                                             
                                                ∫
                                             
                                             
                                                S
                                             
                                          
                                          
                                             
                                                κ
                                             
                                             
                                                2
                                             
                                          
                                          d
                                          S
                                          =
                                          
                                             
                                                ∫
                                             
                                             
                                                S
                                             
                                          
                                          
                                             
                                                κ
                                             
                                             
                                                g
                                             
                                             
                                                2
                                             
                                          
                                          d
                                          S
                                          +
                                          
                                             
                                                ∫
                                             
                                             
                                                S
                                             
                                          
                                          
                                             
                                                κ
                                             
                                             
                                                n
                                             
                                             
                                                2
                                             
                                          
                                          d
                                          S
                                          .
                                       
                                    
                                 
                              
                           
                        
                     

In Section  2.1, we employ the formula 
                           
                              |
                              
                                 
                                    l
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              −
                              
                                 
                                    l
                                 
                                 
                                    i
                                 
                              
                              |
                           
                           =
                           
                              
                                 h
                              
                           
                         to generate iso-level tool path. But for smooth tool path, the following strategy is exploited: first, a certain number of points are sampled from the iso-level curve 
                           
                              
                                 C
                              
                              
                                 i
                              
                           
                        ; Then the level increment 
                           
                              |
                              
                                 
                                    l
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              −
                              
                                 
                                    l
                                 
                                 
                                    i
                                 
                              
                              |
                           
                         is computed for each point with respect to a given scallop height 
                           h
                         using Eqs. (1) and (3); Finally, the smallest level increment is chosen to be the level increment between 
                           
                              
                                 C
                              
                              
                                 i
                              
                           
                         and its next path 
                           
                              
                                 C
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        . This results in level increments of different values as opposed to the iso-scallop method, while the scalar function remains unchanged, i.e., the multiresolution property still holds.

The width term equation (5) and the smoothness term equation (8) can control the interval between neighboring paths and smoothness of the paths respectively. Thus an optimal tool path in terms of iso-scallop and smoothness can be obtained by computing 
                           φ
                         through a nonlinear least square optimization which minimizes a linear combination of the two energy equations (6) and (13)
                        
                           
                              (14)
                              
                                 E
                                 
                                    (
                                    φ
                                    )
                                 
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       w
                                    
                                 
                                 
                                    (
                                    φ
                                    )
                                 
                                 +
                                 λ
                                 
                                    
                                       E
                                    
                                    
                                       κ
                                    
                                 
                                 
                                    (
                                    φ
                                    )
                                 
                                 ,
                              
                           
                         where 
                           λ
                         is a positive weight controlling the trade-off between the two terms. And in order to ensure the tool path is regular (i.e., either contour parallel or direction parallel), we introduce a hard constraint 
                           
                              ‖
                              ∇
                              φ
                              ‖
                           
                           >
                           0
                        . The impact of this constraint is demonstrated in Section  2.4. Then the optimization problem becomes 
                           
                              
                                 
                                    
                                       
                                          min
                                       
                                       
                                          φ
                                       
                                    
                                    
                                       
                                          ∫
                                       
                                       
                                          S
                                       
                                    
                                    
                                       
                                          
                                             (
                                             
                                                ‖
                                                ∇
                                                φ
                                                ‖
                                             
                                             −
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               κ
                                                            
                                                            
                                                               s
                                                            
                                                         
                                                         +
                                                         
                                                            
                                                               κ
                                                            
                                                            
                                                               c
                                                            
                                                         
                                                      
                                                      
                                                         8
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    λ
                                    
                                       (
                                       
                                          
                                             κ
                                          
                                          
                                             g
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             κ
                                          
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                    d
                                    S
                                 
                              
                              
                                 (15)
                                 
                                    s.t.
                                    
                                    
                                       ‖
                                       ∇
                                       φ
                                       ‖
                                    
                                    >
                                    0
                                    .
                                 
                              
                           
                        
                     

However, because of the smoothness energy, the optimization result may violate Eq. (5), and thus the formula 
                           
                              |
                              
                                 
                                    l
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              −
                              
                                 
                                    l
                                 
                                 
                                    i
                                 
                              
                              |
                           
                           =
                           
                              
                                 h
                              
                           
                         would be invalid. Therefore, we employ the method described in Section  2.2 to select iso-level curves with respect to a certain scallop height tolerance. Note that we can use the same scalar function for planning tool paths of different scallop height tolerances, which again shows the multiresolution property of our approach.

Since different machine tools have different feed rate capabilities, for those of good capability we can choose a lower weight on the smooth term. Thus the freedom of choosing weights 
                           λ
                         provides the possibility of applying the proposed method to various machine tools.

In this section, we will show that each iso-level curve generated by the proposed method is either a closed loop or a curve segment without self-intersection and disjunction. In addition, this kind of path topology can be exploited to quickly extract iso-level curves.


                        
                           Lemma 1
                           
                              For a given scalar function 
                              
                                 φ
                               
                              defined over a surface 
                              
                                 S
                              
                              , if the norm of its gradient does not vanish anywhere, the endpoints of iso-level curves (if they exist) are on the boundary.
                           


                        
                           Proof
                           For an interior point 
                                 p
                              , 
                                 
                                    ‖
                                    ∇
                                    φ
                                    ‖
                                 
                                 ≠
                                 0
                               implies that along the two directions 
                                 △
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 △
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                 
                               orthogonal to 
                                 ∇
                                 φ
                              , we have, in a small range, the following expression:
                                 
                                    (16)
                                    
                                       φ
                                       
                                          (
                                          p
                                          +
                                          △
                                          
                                             
                                                p
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       −
                                       φ
                                       
                                          (
                                          p
                                          )
                                       
                                       =
                                       
                                          
                                             
                                                (
                                                ∇
                                                φ
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       △
                                       
                                          
                                             p
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       0
                                       
                                       for
                                       
                                       i
                                       =
                                       1
                                       ,
                                       2
                                       .
                                    
                                 
                               Namely, each interior point has exactly two directions sharing the same level value with it. Therefore, the endpoints can only be on the boundary.□


                        
                           Lemma 2
                           
                              For the scalar function 
                              
                                 φ
                              
                              , its iso-level curves never intersect with each other and do not have self-intersections.
                           


                        
                           Proof
                           Since each point corresponds to a unique value, iso-level curves for different values do not intersect with each other. Generally, we have two types of self-intersections, as shown in Fig. 4
                              . The difference between them is that in case (b) the self-intersection is tangential. For case (a), the two curve segments have different tangent directions at the self-intersection point. It is well-known that the gradient direction at a point is orthogonal to the tangent direction of the iso-level curve. Thus the two different tangent directions at the self-intersection point results in a contradiction that there are two different gradient directions at that point. For case (b), we view the self-intersection as two iso-level curves that are of same level value and tangential at the intersection point and separate from each other in its neighborhood. But 
                                 
                                    ‖
                                    ∇
                                    φ
                                    ‖
                                 
                                 ≠
                                 0
                               along an iso-level curve implies that iso-level curves near it are of different level values, which again lead to a contradiction. □

Note that these properties are employed to extract each desired iso-level curve in the following sections so that traversal is not needed. As Lemmas 1 and 2 show, for any interior point of the surface, it has and only has two directions that share the same level value with the point. Accordingly, we can use a “Seed Growth” like algorithm to find the iso-level curves, namely, if we want to find the iso-level curve of a given level value, say 
                           l
                        , we can start from an initial edge on which there exists a point whose level value is 
                           l
                        , and then search through the edge’s adjacent triangles (if the point is a vertex of the mesh, i.e., the endpoint of the edge, the adjacent triangles are all the 1-ring triangles) to get exactly two edges containing level value 
                           l
                        , repeat this procedure and finally the initial point can grow to be an iso-level curve of interest. In addition, it follows immediately from Lemmas 1 and 2 that:
                           Proposition 1
                           
                              Each iso-level path generated by the proposed method is either contour parallel or direction parallel and free from self-intersection and disjunction.
                           

Numerically, the iso-level method described in the above section can be applied to any domain with a discrete gradient operator 
                        ∇
                     , divergence operator 
                        
                           div
                        
                        
                           (
                           ⋅
                           )
                        
                     , and curvature tensor 
                        T
                     . To solve the optimization models for free-from surfaces, the Finite Element Method (FEM) is employed, i.e., in this work, we focus on triangular meshes. However, this method can be easily extended to other domains, such as point clouds.

Assume that 
                        M
                        ⊂
                        
                           
                              R
                           
                           
                              3
                           
                        
                      is a compact triangulated surface with no degenerate triangles. Let 
                        
                           
                              N
                           
                           
                              1
                           
                        
                        
                           (
                           i
                           )
                        
                      be the 1-neighborhood of vertex 
                        
                           
                              v
                           
                           
                              i
                           
                        
                     , which is the index set for vertices connecting to 
                        
                           
                              v
                           
                           
                              i
                           
                        
                     . Let 
                        
                           
                              D
                           
                           
                              1
                           
                        
                        
                           (
                           i
                           )
                        
                      be the 1-disk of the vertex 
                        
                           
                              v
                           
                           
                              i
                           
                        
                     , which is the index set for triangles containing 
                        
                           
                              v
                           
                           
                              i
                           
                        
                     . The dual cell of a vertex 
                        
                           
                              v
                           
                           
                              i
                           
                        
                      is part of its 1-disk which is more near to 
                        
                           
                              v
                           
                           
                              i
                           
                        
                      than its 
                        
                           
                              N
                           
                           
                              1
                           
                        
                        
                           (
                           i
                           )
                        
                     . Fig. 5
                     (a) shows the dual cell 
                        
                           
                              C
                           
                           
                              i
                           
                        
                      for an interior vertex 
                        
                           
                              v
                           
                           
                              i
                           
                        
                     , while Fig. 5(b) shows the dual cell for a boundary vertex. A function 
                        φ
                      defined over the triangulated surface 
                        M
                      is considered to be a piecewise linear function, such that 
                        φ
                      reaches value 
                        
                           
                              φ
                           
                           
                              i
                           
                        
                      at vertex 
                        
                           
                              v
                           
                           
                              i
                           
                        
                      and is linear within each triangle. Based on these, the energies shown in Eqs. (6), (13) and (15) are computed by integrating the width term and smooth term over the whole mesh domain, while the mesh domain can be decomposed into a set of triangles or a set of dual cells. To compute the width term and the smooth term on a mesh, we need to discretize the gradient, the divergence, and the curvature tensor, which we will describe briefly, since they are basic in FEM.

The gradient of 
                        φ
                      over each triangle is constant as the function 
                        φ
                      is linear within the triangle. The gradient in a given triangle can be expressed as
                        
                           (17)
                           
                              ∇
                              φ
                              
                                 (
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                    
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    ∈
                                    
                                       
                                          Ω
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    φ
                                 
                                 
                                    j
                                 
                              
                              
                                 (
                                 
                                    
                                       N
                                    
                                    
                                       i
                                    
                                 
                                 ×
                                 
                                    
                                       e
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           
                              A
                           
                           
                              i
                           
                        
                      is the area of the face 
                        
                           
                              f
                           
                           
                              i
                           
                        
                     , 
                        
                           
                              N
                           
                           
                              i
                           
                        
                      is its unit normal, 
                        
                           
                              Ω
                           
                           
                              i
                           
                        
                      is the set of edge indices for face 
                        
                           
                              f
                           
                           
                              i
                           
                        
                     , 
                        
                           
                              e
                           
                           
                              j
                           
                        
                      is the 
                        j
                        −
                     th edge vector (oriented counter-clockwise), and 
                        
                           
                              φ
                           
                           
                              i
                           
                        
                      is the opposing value of 
                        φ
                      as shown in Fig. 6
                     .

According to the Stokes’ theorem, the integral of divergence over the dual cell is equal to the outward flux along the boundary of the dual cell. Thus the divergence operator associated with vertex 
                        
                           
                              v
                           
                           
                              i
                           
                        
                      is discretized by dividing the outward flux by the dual cell area
                        
                           (18)
                           
                              
                                 div
                              
                              
                                 (
                                 X
                                 )
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    ∈
                                    
                                       
                                          D
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       i
                                       )
                                    
                                 
                              
                              cot
                              
                                 
                                    θ
                                 
                                 
                                    j
                                 
                                 
                                    1
                                 
                              
                              
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ⋅
                                 
                                    
                                       X
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                              +
                              cot
                              
                                 
                                    θ
                                 
                                 
                                    j
                                 
                                 
                                    2
                                 
                              
                              
                                 (
                                 
                                    
                                       e
                                    
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ⋅
                                 
                                    
                                       X
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                              ,
                           
                        
                      where the sum is taken over the vertex’s incident triangles 
                        
                           
                              f
                           
                           
                              j
                           
                        
                      with a vector 
                        
                           
                              X
                           
                           
                              j
                           
                        
                     , 
                        
                           
                              e
                           
                           
                              j
                           
                           
                              1
                           
                        
                      and 
                        
                           
                              e
                           
                           
                              j
                           
                           
                              2
                           
                        
                      are the two edge vectors of triangle 
                        
                           
                              f
                           
                           
                              j
                           
                        
                      containing vertex 
                        
                           
                              v
                           
                           
                              i
                           
                        
                     , 
                        
                           
                              θ
                           
                           
                              j
                           
                           
                              1
                           
                        
                      and 
                        
                           
                              θ
                           
                           
                              j
                           
                           
                              2
                           
                        
                      are the opposing angles, and 
                        
                           
                              C
                           
                           
                              i
                           
                        
                      is the dual cell area for vertex 
                        
                           
                              v
                           
                           
                              i
                           
                        
                     . Accordingly, the geodesic curvature value of curve 
                        φ
                        =
                        c
                        o
                        n
                        s
                        t
                      associated with the vertex 
                        
                           
                              v
                           
                           
                              i
                           
                        
                      can be computed by 
                        
                           (19)
                           
                              
                                 
                                    κ
                                 
                                 
                                    g
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    ∈
                                    
                                       
                                          D
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       i
                                       )
                                    
                                 
                              
                              
                                 
                                    cot
                                    
                                       
                                          θ
                                       
                                       
                                          j
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             j
                                          
                                          
                                             2
                                          
                                       
                                       ⋅
                                       ∇
                                       φ
                                       
                                          (
                                          j
                                          )
                                       
                                       )
                                    
                                    +
                                    cot
                                    
                                       
                                          θ
                                       
                                       
                                          j
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             j
                                          
                                          
                                             2
                                          
                                       
                                       ⋅
                                       ∇
                                       φ
                                       
                                          (
                                          j
                                          )
                                       
                                       )
                                    
                                 
                                 
                                    
                                       ‖
                                       ∇
                                       φ
                                       
                                          (
                                          j
                                          )
                                       
                                       ‖
                                    
                                 
                              
                              .
                           
                        
                     
                  

The curvature tensor (second fundamental tensor) 
                        T
                      is defined in terms of the directional derivatives of the surface normal:
                        
                           (20)
                           
                              T
                              =
                              
                                 (
                                 
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                u
                                             
                                          
                                          n
                                       
                                       
                                          
                                             
                                                D
                                             
                                             
                                                v
                                             
                                          
                                          n
                                       
                                    
                                 
                                 )
                              
                              =
                              
                                 (
                                 
                                    
                                       
                                          
                                             
                                                ∂
                                                n
                                             
                                             
                                                ∂
                                                u
                                             
                                          
                                          ⋅
                                          u
                                       
                                       
                                          
                                             
                                                ∂
                                                n
                                             
                                             
                                                ∂
                                                v
                                             
                                          
                                          ⋅
                                          u
                                       
                                    
                                    
                                       
                                          
                                             
                                                ∂
                                                n
                                             
                                             
                                                ∂
                                                v
                                             
                                          
                                          ⋅
                                          u
                                       
                                       
                                          
                                             
                                                ∂
                                                n
                                             
                                             
                                                ∂
                                                v
                                             
                                          
                                          ⋅
                                          v
                                       
                                    
                                 
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           (
                           u
                           ,
                           v
                           )
                        
                      are the directions of an orthogonal coordinate system in the tangent frame (the sign convention used here yields positive curvatures for convex surfaces with outward-facing normals). Multiplying this tensor by any vector in the tangent plane gives the derivative of the normal in that direction. Although this definition holds only for smooth surfaces, we can approximate it in the discrete case using finite difference. In this work, the curvature tensor for each face is computed by the method in  [27].

Then the whole optimization model can be formulated as 
                        
                           
                              
                                 
                                    
                                       min
                                    
                                    
                                       φ
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       
                                          |
                                          F
                                          |
                                       
                                    
                                 
                                 
                                    
                                       A
                                    
                                    
                                       j
                                    
                                 
                                 
                                 
                                    
                                       
                                          (
                                          
                                             ‖
                                             ∇
                                             φ
                                             
                                                (
                                                j
                                                )
                                             
                                             ‖
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            κ
                                                         
                                                         
                                                            s
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            κ
                                                         
                                                         
                                                            c
                                                         
                                                      
                                                   
                                                   
                                                      8
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 λ
                                 
                                    (
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          
                                             |
                                             F
                                             |
                                          
                                       
                                    
                                    
                                       
                                          A
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   κ
                                                
                                                
                                                   n
                                                
                                                
                                                   j
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             |
                                             V
                                             |
                                          
                                       
                                    
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   κ
                                                
                                                
                                                   g
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                              
                           
                           
                              (21)
                              
                                 s.t.
                                 
                                 
                                    ‖
                                    ∇
                                    φ
                                    
                                       (
                                       j
                                       )
                                    
                                    ‖
                                 
                                 >
                                 0
                              
                           
                        
                      where 
                        
                           |
                           F
                           |
                        
                      is the number of faces and 
                        
                           |
                           V
                           |
                        
                      denotes the number of vertices. This is a well established nonlinear least square optimization problem with inequality constraints, which can be easily solved by the interior point method  [28–30]. The interior point solver requires the gradient of the target function and the constraint functions. The gradient calculation boils down to computing the gradient of 
                        ∇
                        φ
                      and 
                        ∇
                        φ
                        /
                        
                           ‖
                           ∇
                           φ
                           ‖
                        
                     , which we do as follows.

As demonstrated previously, the gradient of a piecewise linear scalar function within a given triangle 
                        
                           
                              f
                           
                           
                              k
                           
                        
                      is a linear combination of constant vectors 
                        
                           
                              N
                           
                           
                              k
                           
                        
                        ×
                        
                           
                              e
                           
                           
                              i
                           
                        
                     , and thus, the partial derivative of 
                        ∇
                        φ
                        
                           (
                           k
                           )
                        
                      with respect to 
                        
                           
                              φ
                           
                           
                              j
                           
                        
                      is 
                        
                           (22)
                           
                              
                                 
                                    ∂
                                 
                                 
                                    ∂
                                    
                                       
                                          φ
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              ∇
                              φ
                              
                                 (
                                 k
                                 )
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                    
                                       
                                          A
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                 
                                 
                                    ∂
                                    
                                       
                                          φ
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    ∈
                                    
                                       
                                          Ω
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    φ
                                 
                                 
                                    i
                                 
                              
                              
                                 (
                                 
                                    
                                       N
                                    
                                    
                                       k
                                    
                                 
                                 ×
                                 
                                    
                                       e
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                    
                                       
                                          A
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    ∈
                                    
                                       
                                          Ω
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    δ
                                 
                                 
                                    i
                                    j
                                 
                              
                              
                                 (
                                 
                                    
                                       N
                                    
                                    
                                       k
                                    
                                 
                                 ×
                                 
                                    
                                       e
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           
                              δ
                           
                           
                              i
                              j
                           
                        
                        =
                        
                           {
                           
                              
                                 
                                    1
                                 
                                 
                                    i
                                    =
                                    j
                                 
                              
                              
                                 
                                    0
                                 
                                 
                                    i
                                    ≠
                                    j
                                 
                              
                           
                        
                       is the Kronecker delta function.

As for the gradient of 
                        ∇
                        φ
                        /
                        
                           ‖
                           ∇
                           φ
                           ‖
                        
                     , it is 
                        
                           (23)
                           
                              
                                 
                                    ∂
                                 
                                 
                                    ∂
                                    
                                       
                                          φ
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       ∇
                                       φ
                                       
                                          (
                                          k
                                          )
                                       
                                    
                                    
                                       
                                          ‖
                                          ∇
                                          φ
                                          
                                             (
                                             k
                                             )
                                          
                                          ‖
                                       
                                    
                                 
                                 )
                              
                              =
                              
                                 
                                    
                                       (
                                       
                                          
                                             ∂
                                          
                                          
                                             ∂
                                             
                                                
                                                   φ
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                       ∇
                                       φ
                                       
                                          (
                                          k
                                          )
                                       
                                       )
                                    
                                    
                                       ‖
                                       ∇
                                       φ
                                       
                                          (
                                          k
                                          )
                                       
                                       ‖
                                    
                                    −
                                    ∇
                                    φ
                                    
                                       (
                                       k
                                       )
                                    
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   ∇
                                                   φ
                                                   
                                                      (
                                                      k
                                                      )
                                                   
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                ∂
                                             
                                             
                                                ∂
                                                
                                                   
                                                      φ
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          ∇
                                          φ
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                       
                                          
                                             ‖
                                             ∇
                                             φ
                                             
                                                (
                                                k
                                                )
                                             
                                             ‖
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ‖
                                             ∇
                                             φ
                                             
                                                (
                                                k
                                                )
                                             
                                             ‖
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

The final solution to the optimization problem equation (20) would be affected by the initial value. In this work, we initialize the tool path by paths from  [31].

Planning tool-path is to represent a surface with a series of curves against some error criteria (i.e., chord deviation and scallop height). We next summarize the overall process for generating such curves on a surface by the iso-level method as follows: 
                        
                           1.
                           Select an initial curve 
                                 
                                    
                                       C
                                    
                                    
                                       0
                                    
                                 
                               on the surface 
                                 S
                               and fix its level value to zero, i.e.,  
                                 
                                    
                                       l
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 0
                              . 
                                 
                                    
                                       C
                                    
                                    
                                       0
                                    
                                 
                               is a part of boundary for direction parallel tool path and the whole boundary for contour parallel tool path.

Find the solution to the models Eqs. (6), (13) and (15), including meshing and numerical optimization.

Select level values 
                                 
                                    
                                       
                                          {
                                          
                                             
                                                l
                                             
                                             
                                                i
                                             
                                          
                                          }
                                       
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       n
                                    
                                 
                              , where 
                                 
                                    
                                       l
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       φ
                                    
                                    
                                       m
                                       i
                                       n
                                    
                                 
                                 ,
                                 
                                 
                                 
                                    
                                       l
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    
                                       φ
                                    
                                    
                                       m
                                       a
                                       x
                                    
                                 
                              , with the method described in Section  2.1 for iso-scallop tool path and the method in Section  2.2 for smooth or optimal tool path. For direction parallel tool path the last tool path corresponds to 
                                 
                                    
                                       l
                                    
                                    
                                       n
                                    
                                 
                                 =
                                 
                                    
                                       φ
                                    
                                    
                                       m
                                       a
                                       x
                                    
                                 
                              , while for contour parallel tool path the last corresponds to 
                                 
                                    
                                       l
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                              . Then fastly extract iso-level curves on the triangular mesh based on the method described in Section  2.4.

Convert the iso-level curves on the mesh which actually are polygons to surface 
                                 S
                              . The vertices of an iso-level curve on the mesh are either vertices of the mesh or points on edges of the mesh. For the former case, the vertices are also on 
                                 S
                              . For the latter case, a vertex is first proportionally mapped to the parameter domain with respect to the two ends of the edge it is on and then find its corresponding point on the surface.

Greedily merge short segments of the polygons to approach the chord deviation tolerance as closely as possible. Then finally, these reduced iso-level curves (polygons) are the desired tool path.

@&#EXPERIMENTAL RESULTS@&#

In this section, the proposed tool path planning method is implemented on real data. A free-form surface and a human face are chosen to illustrate the effectiveness of it, as in Fig. 7
                     . The free-form surface is exploited to show the generation of direction parallel tool path. The human face was generated by a coordinate measuring machine. We utilize it to show the generation of contour parallel tool path.

To plan iso-level tool path, the first thing to do is to construct a proper scalar function over the surface. Since the Finite Element Method is employed to find the optimizer of the optimization models, meshing is needed. We choose the element to be triangular. Fig. 8
                     (a) shows the meshing results of the free-form surface and Fig. 9
                     (a) shows that of the human face. The optimal scalar functions are illustrated in Figs. 8(b), 9(b) by varying color. Fig. 8(b) shows the scalar function of the free-form surface for generating direction parallel tool path and Fig. 9(b) shows that of the human face for generating contour parallel tool path. And the varying from blue to red represents the rising of level value.

As the optimal scalar functions have been constructed for both surfaces, tool path that is optimal with respect to iso-scallop and smoothness can be generated. A ball-end cutter with radius 4 mm is chosen to show the path generation so that tool orientation does not matter. The limited scallop height is 1 mm and chord deviation is 0.01 mm. In order to clearly show tool paths, the error criterion (i.e., scallop height) is set to be much greater than those in real cases. Fig. 8(c) shows the optimal direction parallel paths on the free-form surface and Fig. 9(c) shows corresponding result of contour parallel tool path on the human face. Their weights are both 
                        λ
                        =
                        1
                     .

We next show some comparisons and analyses of the generated tool paths. According to the demonstration of  [32], the contour parallel tool path will be emphasized. Fig. 10
                      shows the tool paths from smooth to iso-scallop generated by the proposed method. Fig. 10(a) shows the smooth contour parallel tool path generated by the proposed method with 
                        λ
                        =
                        10
                     , Fig. 10(b) shows the optimal tool path with 
                        λ
                        =
                        1
                     , and Fig. 10(c) shows the iso-scallop tool path with 
                        λ
                        =
                        0
                     . As described in above sections, the iso-scallop condition equation (5) characterizes the overlapping between neighbor paths. Therefore, to analyze the overlapping of the generated tool paths, we conduct statistics on the relative deviation w.r.t. the iso-scallop condition along the paths. It is computed by
                        
                           (24)
                           
                              Δ
                              =
                              
                                 |
                                 
                                    
                                       
                                          ‖
                                          ∇
                                          φ
                                          ‖
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         κ
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         κ
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                                
                                                   8
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         κ
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         κ
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                                
                                                   8
                                                
                                             
                                          
                                       
                                    
                                 
                                 |
                              
                              =
                              
                                 |
                                 1
                                 −
                                 
                                    
                                       
                                          ‖
                                          ∇
                                          φ
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         κ
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         κ
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                                
                                                   8
                                                
                                             
                                          
                                       
                                    
                                 
                                 |
                              
                              .
                           
                        
                      And the statistics results are depicted in Fig. 10(d)–(f). As the figures show, for the iso-scallop tool path, the relative deviations are all less than 5%, and centered around 1%. For the optimal tool path, we could find the ratio moves to the greater side, as imagined, and there are a few points which are much greater than the rest. Most of these points are located in the corner parts of the tool path. And for the smooth tool path, its overlapping is much more obvious and there are about 2% of points whose ratio is greater than 10%. But the losing of iso-scallop condition brings smoothness to the tool paths, which is shown in Fig. 10(g)–(i). In conclusion, the optimal tool path tries to find a balance between the overlapping and smoothness. We also compare the optimal tool path with the Laplacian based one in Fig. 11
                     . Although the Laplacian based tool path is obviously smooth than the optimal one, from the overlapping analysis figures, i.e.,  Fig. 11(c), (d), we can find that it is much more severely overlapped for neighbor paths.

@&#CONCLUSION@&#

In this paper, a new framework of tool path planning is proposed. The novelty of our method is that it allows several objectives to be considered in a unified framework and thus making global optimization of tool paths possible. Moreover, the scalar function only has to be constructed once, then it can be utilized to generate tool paths for machining from rough to fine. The proposed framework is applied to find an optimal tool path that takes smoothness and iso-scallop requirements into consideration simultaneously. Eq. (5) for controlling interval between neighbor iso-level curves and Eq. (8) for measuring curvature of an iso-level curve are derived to lay a foundation for the formulation of optimization models.

It is likely that this theory has further potential in planning other optimal tool path, and the derived formulas can also be directly applied to level set based tool path planning methods, e.g.,  [22].

@&#ACKNOWLEDGMENTS@&#

The authors are grateful for the support provided by National Key Basic Research Project of China (No. 2011CB302400), National Natural Science Foundation of China (Nos. 61303148, and 50975495), Ph.D. Programs Foundation of Ministry of Education of China (No. 20133402120002), and Swiss National Science Foundation (No. 200021_137626).

@&#REFERENCES@&#

