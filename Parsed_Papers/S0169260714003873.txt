@&#MAIN-TITLE@&#Adaptive marker-free registration using a multiple point strategy for real-time and robust endoscope electromagnetic navigation

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           We proposed an adaptive mark-free registration method for aligning electromagnetic trackers and pre-operative images.


                        
                        
                           
                           An endoscope center calibration on the basis of a 2D-printed model was presented.


                        
                        
                           
                           A multiple point strategy was proposed to address an assumption of moving endoscopes along the centerline of the intraluminal organ.


                        
                        
                           
                           The registration error was significantly reduced from 7.58 to 4.71mm under dynamic phantom validation.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Marker-free registration

Endoscope 3-D motion tracking

Electromagnetically navigated endoscopy

Bronchoscope navigation

Electromagnetic tracker

@&#ABSTRACT@&#


               
               
                  Registration of pre-clinical images to physical space is indispensable for computer-assisted endoscopic interventions in operating rooms. Electromagnetically navigated endoscopic interventions are increasingly performed at current diagnoses and treatments. Such interventions use an electromagnetic tracker with a miniature sensor that is usually attached at an endoscope distal tip to real time track endoscope movements in a pre-clinical image space. Spatial alignment between the electromagnetic tracker (or sensor) and pre-clinical images must be performed to navigate the endoscope to target regions. This paper proposes an adaptive marker-free registration method that uses a multiple point selection strategy. This method seeks to address an assumption that the endoscope is operated along the centerline of an intraluminal organ which is easily violated during interventions. We introduce an adaptive strategy that generates multiple points in terms of sensor measurements and endoscope tip center calibration. From these generated points, we adaptively choose the optimal point, which is the closest to its assigned the centerline of the hollow organ, to perform registration. The experimental results demonstrate that our proposed adaptive strategy significantly reduced the target registration error from 5.32 to 2.59 mm in static phantoms validation, as well as from at least 7.58mm to 4.71mm in dynamic phantom validation compared to current available methods.
               
            

@&#INTRODUCTION@&#

Electromagnetic tracking (ET) systems are increasingly used for computer-assisted interventions in medical communities [1]. They can track surgical devices or tools in real time and conveniently locate devices or tools at suspicious regions in the body to assist physicians to perform interventions (e.g., tumor resection or tissue biopsies). In operating rooms, physicians expect an augmented-reality (AR) environment, which can provide a fusion of pre- and intra-operative images to guide operations and directly visualize where surgical tools are located in the body [1–3]. To obtain AR environments, surgical tool three-dimensional (3-D) motion tracking must be performed. It seeks to locate surgical tools in a spatial reference system, e.g., pre-clinical 3-D computed tomography (CT) or magnetic resonance (MR) volume. An ET system with a magnetic field generator and position sensors is popularly used for surgical tool 3-D motion tracking. Therefore, during ET-involved navigation, an unavoidable problem is to spatially register and temporally synchronize the ET and CT coordinate systems.

As one of most performed minimally- or non-invasive procedures, endoscopy is widely introduced for medical purposes of diagnosing and treating different diseases, e.g., bronchoscopy for bronchus and lung cancers and colonoscopy for rectum and colon cancers. It usually uses an endoscope with video cameras integrated at its distal tip to directly insert and visually inspect the interior of hollow organs or cavities of the body. Since the endoscope itself provides only two-dimensional (2-D) endoscopic video sequences, it challenges physicians to locate the endoscope's six-degree-freedom (6DoF) position and orientation in the 3-D CT volume space. Video-based navigation techniques, e.g., a commercialized system – Apollo (VIDA Diagnostics, USA), are commonly introduced for the endoscope location [4,5,3,6]. Moreover, electromagnetically navigated endoscopy, which uses an ET system to track endoscope movements, is employed to address such a challenge in operating rooms [7–9], e.g., a commercially available superDimension navigation system (superDimension Inc., USA), in which the diagnostic accuracy has been reported about 59–74% without sensitivity to tumor size [10–13]. During the electromagnetic endoscope navigation, an ET position sensor is usually attached at the endoscope distal tip to measure endoscope movements. To transform these ET sensor measurements to the CT volume, the spatial alignment between the ET system and CT volume must be determined.

This paper focuses on solving the spatial alignment of ET and CT; particularly, we propose an adaptive marker-free registration method to compute the spatial transformation of the ET and CT (ET—CT) coordinate systems. The rest of this paper is organized as follows. Section 2 shows the motivation or purpose of this work. The adaptive marker-free registration approach is detailed in Section 3. Experimental setups are described in Section 4. Section 5 investigates experimental results from different methods, followed by discussion in Section 6, before concluding this work in Section 7.

@&#MOTIVATION@&#

The primary purpose is to accurately determine the endoscope position and orientation in the CT images during endoscope electromagnetic navigation. This requires to accurately estimate the ET–CT spatial transformation before navigation.

Currently several methods have been discussed to compute the ET–CT transformation in the literature. Schwarz et al. [14] introduced a marker-based registration. They manually chose among five and seven anatomic markers at the bronchial bifurcations to establish the ET–CT alignment and reported the registration accuracy about 5.7mm under a patient movement compensation mechanism that utilized three ET sensors attached to patient thoraxes. Without using anatomical markers, Klein et al. [15] maximized the percentage of ET sensor measurements inside the CT airway volume to determine the ET–CT transformation. Unfortunately, such a method depends heavily on its initial estimate of the ET–CT alignment in maximization. It possibly fails to converge to an optimal solution during optimization. Based on the centerlines of the airway trees, Deguchi et al. [16] proposed a marker-free method that minimizes the distance between the sensor measurements and bronchial centerlines to obtain the ET–CT transformation. They assumed that the endoscope is operated along the centerlines of the bronchi. However, surgeons may easily break such an hypothesis in endoscopic examinations or interventions.

In general, marker-free registration approaches are promising for endoscope electromagnetic navigation since they are easily performed in operating rooms without manually choosing any anatomical markers in the body. The motivation of this work is to diminish the assumption of moving endoscopes along the centerlines of hollow organs (e.g., airway trees and nose) in the body, since such an assumption implies that the closer to the centerlines of operating the endoscope, the more accurate ET–CT transformation can be obtained. Our basic idea is to generate multiple positions or points around the endoscope shaft on the basis of each electromagnetic sensor measurement (position and orientation); points closest to the centerlines are selected for registration. We call such a procedure as a multiple point strategy that was proved to be very effective to estimate the ET–CT alignment. The preliminary work of this paper was orally presented at a conference [17].

The contributions of this paper are clarified as follows. First, an adaptive marker-free registration method was proposed to handle the patient-to-model registration problem for constructing ET-involved endoscope navigation systems. Adaptive here means that our proposed method uses the multiple point strategy to select points closest to the centerlines in registration, significantly diminishing the above assumption. Next, the multiple point strategy, which uses ET sensor orientation fully and integrates endoscope tip center calibration (shaft structure) information, was originally introduced in this work. Finally, we believe that our proposed method is applicable to other endoscopic interventions that involve patient-to-model registration, e.g., nose sinus or colon endoscope navigation.

This section describes our adaptive marker-free registration method. Basically, it is comprised of several steps: (1) CT image segmentation and initialization of optimization, (2) endoscope center calibration, (3) multiple point strategy for selecting optimal points, and (4) optimization for determining the ET–CT transformation. Each step is detailed as follows.

Due to the hollow organ's centerlines that are used in our method, we first segment CT images to obtain these centerlines (Fig. 1
                        ) that are described by 
                           C
                           =
                           
                              
                                 {
                                 
                                    
                                       
                                          c
                                       
                                    
                                    k
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          c
                                       
                                    
                                    k
                                    s
                                 
                                 ,
                                 
                                    
                                       
                                          c
                                       
                                    
                                    k
                                    e
                                 
                                 )
                                 }
                              
                              
                                 k
                                 =
                                 1
                              
                              K
                           
                        , where each centerline c
                        
                           k
                         has its start and end points, 
                           
                              
                                 
                                    c
                                 
                              
                              k
                              s
                           
                         and 
                           
                              
                                 
                                    c
                                 
                              
                              k
                              e
                           
                        , and K is the number of extracted centerlines [18].

We must initialize ET–CT transformation 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                         before estimating it during optimization. We use three centerlines to perform such an initialization. The carina position q
                        
                           ct
                        , which is easily selected from CT images, is located around the end point of the trachea centerline c
                        
                           t
                         or the start points of the left and right primary bronchus centerlines c
                        
                           l
                         and c
                        
                           r
                        : 
                           
                              
                                 
                                    q
                                 
                              
                              ct
                           
                           =
                           
                              
                                 
                                    c
                                 
                              
                              t
                              e
                           
                           =
                           
                              
                                 
                                    c
                                 
                              
                              l
                              s
                           
                           =
                           
                              
                                 
                                    c
                                 
                              
                              r
                              s
                           
                        . We locate the endoscope with an attached ET sensor at the carina of the trachea during navigation and obtain sensor measurement m
                        
                           et
                        
                        =(p
                        
                           et
                        , r
                        
                           et
                        ), where p
                        
                           et
                         is the sensor position and r
                        
                           et
                         denotes the sensor orientation with 
                           
                              
                                 
                                    s
                                 
                              
                              et
                              x
                           
                        , 
                           
                              
                                 
                                    s
                                 
                              
                              et
                              y
                           
                        , and 
                           
                              
                                 
                                    s
                                 
                              
                              et
                              z
                           
                         in the three directions of x-, y-, and z-axes: 
                           
                              
                                 
                                    r
                                 
                              
                              et
                           
                           =
                           (
                           
                              
                                 
                                    s
                                 
                              
                              et
                              x
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              et
                              y
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              et
                              z
                           
                           )
                        . Hence initial transformation 
                           
                              
                                 T
                                 et
                                 0
                              
                              
                              
                              ct
                           
                         before optimization can be calculated by:


                        
                           
                              (1)
                              
                                 
                                    
                                       
                                          T
                                          et
                                          0
                                       
                                    
                                    
                                    
                                    ct
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            r
                                                         
                                                      
                                                      ct
                                                   
                                                      
                                                
                                                
                                                   
                                                      
                                                         
                                                            q
                                                         
                                                      
                                                      ct
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                      T
                                                   
                                                      
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               r
                                                            
                                                         
                                                         et
                                                      
                                                         
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         et
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                         
                                                         T
                                                      
                                                         
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 ,
                              
                           
                        where orientation r
                        
                           ct
                         includes three directions of 
                           
                              
                                 
                                    s
                                 
                              
                              ct
                              x
                           
                        , 
                           
                              
                                 
                                    s
                                 
                              
                              ct
                              y
                           
                        , and 
                           
                              
                                 
                                    s
                                 
                              
                              ct
                              z
                           
                         and these directional vectors are computed by:


                        
                           
                              (2)
                              
                                 
                                    
                                       
                                          s
                                       
                                    
                                    ct
                                    z
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                          
                                          t
                                          e
                                       
                                       −
                                       
                                          
                                             
                                                c
                                             
                                          
                                          t
                                          s
                                       
                                    
                                    
                                       |
                                       |
                                       
                                          
                                             
                                                c
                                             
                                          
                                          t
                                          e
                                       
                                       −
                                       
                                          
                                             
                                                c
                                             
                                          
                                          t
                                          s
                                       
                                       |
                                       |
                                    
                                 
                                 ,
                                    
                                 
                                    
                                       
                                          s
                                       
                                    
                                    ct
                                    y
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                          
                                          l
                                          e
                                       
                                       −
                                       
                                          
                                             
                                                c
                                             
                                          
                                          l
                                          s
                                       
                                    
                                    
                                       |
                                       |
                                       
                                          
                                             
                                                c
                                             
                                          
                                          l
                                          e
                                       
                                       −
                                       
                                          
                                             
                                                c
                                             
                                          
                                          l
                                          s
                                       
                                       |
                                       |
                                    
                                 
                                 ×
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                          
                                          r
                                          e
                                       
                                       −
                                       
                                          
                                             
                                                c
                                             
                                          
                                          r
                                          s
                                       
                                    
                                    
                                       |
                                       |
                                       
                                          
                                             
                                                c
                                             
                                          
                                          r
                                          e
                                       
                                       −
                                       
                                          
                                             
                                                c
                                             
                                          
                                          r
                                          s
                                       
                                       |
                                       |
                                    
                                 
                                 ,
                              
                           
                        and 
                           
                              
                                 
                                    s
                                 
                              
                              ct
                              x
                           
                           =
                           
                              
                                 
                                    s
                                 
                              
                              ct
                              y
                           
                           ×
                           
                              
                                 
                                    s
                                 
                              
                              ct
                              z
                           
                        , where symbol × denotes the cross product.

Eq. (2) indicates that our initialization involves the rough orientation information. Our proposed algorithm on the basis of such an initialization of the ET–CT transformation usually succeeds to converge. The speed of convergence depends on the accuracy of the initialization.

To generate multiple points, we must determine the relationship between the ET sensor and the center of the endoscope tip transversal plane. To calibrate this relationship, we build a model and insert the endoscope tip with an integrated ET sensor into this model and spin the rotatable cuboid (Fig. 2
                        ). Note that the endoscope is rotated along its centers and endoscopes with different diameters require different sizes of calibration models.

We acquire three measurements of the ET sensor after spinning the rotatable cuboid every 120° and represent these measurements by: 
                           
                              
                                 
                                    m
                                 
                              
                              a
                           
                           =
                           (
                           
                              
                                 
                                    p
                                 
                              
                              a
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              a
                              x
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              a
                              y
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              a
                              z
                           
                           )
                        , 
                           
                              
                                 
                                    m
                                 
                              
                              b
                           
                           =
                           (
                           
                              
                                 
                                    p
                                 
                              
                              b
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              b
                              x
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              b
                              y
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              b
                              z
                           
                           )
                        , and 
                           
                              
                                 
                                    m
                                 
                              
                              c
                           
                           =
                           (
                           
                              
                                 
                                    p
                                 
                              
                              c
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              c
                              x
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              c
                              y
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              c
                              z
                           
                           )
                        . Actually, we moved the rotatable cuboid and acquired about 100 sensor outputs at each position and determined positions p
                        
                           a
                        , p
                        
                           b
                        , and p
                        
                           c
                         by the average of these sensor outputs. Since these average positions, 
                           
                              
                                 
                                    p
                                 
                              
                              a
                           
                           =
                           
                              
                                 (
                                 
                                    p
                                    a
                                    x
                                 
                                 ,
                                 
                                    p
                                    a
                                    y
                                 
                                 ,
                                 
                                    p
                                    a
                                    z
                                 
                                 )
                              
                              T
                           
                        , 
                           
                              
                                 
                                    p
                                 
                              
                              b
                           
                           =
                           
                              
                                 (
                                 
                                    p
                                    b
                                    x
                                 
                                 ,
                                 
                                    p
                                    b
                                    y
                                 
                                 ,
                                 
                                    p
                                    b
                                    z
                                 
                                 )
                              
                              T
                           
                        , and 
                           
                              
                                 
                                    p
                                 
                              
                              c
                           
                           =
                           
                              
                                 (
                                 
                                    p
                                    c
                                    x
                                 
                                 ,
                                 
                                    p
                                    c
                                    y
                                 
                                 ,
                                 
                                    p
                                    c
                                    z
                                 
                                 )
                              
                              T
                           
                        , should be on one circle plane centered at point p
                        
                           o
                        , we have:


                        
                           
                              (3)
                              
                                 |
                                 |
                                 
                                    
                                       
                                          p
                                       
                                    
                                    o
                                 
                                 −
                                 
                                    
                                       
                                          p
                                       
                                    
                                    a
                                 
                                 |
                                 |
                                 =
                                 |
                                 |
                                 
                                    
                                       
                                          p
                                       
                                    
                                    o
                                 
                                 −
                                 
                                    
                                       
                                          p
                                       
                                    
                                    b
                                 
                                 |
                                 |
                                 =
                                 |
                                 |
                                 
                                    
                                       
                                          p
                                       
                                    
                                    o
                                 
                                 −
                                 
                                    
                                       
                                          p
                                       
                                    
                                    c
                                 
                                 |
                                 |
                                 ,
                              
                           
                        by solving this equation, we obtain center point p
                        
                           o
                        . Since the spatial relationship between the ET sensor and the endoscope tip center was relatively fixed, it can move point p
                        
                           a
                         with typical spatial distance (δ
                        
                           x
                        , δ
                        
                           y
                        , δ
                        
                           z
                        ) along the ET sensor orientation 
                           (
                           
                              
                                 
                                    s
                                 
                              
                              a
                              x
                           
                        , 
                           
                              
                                 
                                    s
                                 
                              
                              a
                              y
                           
                        , 
                           
                              
                                 
                                    s
                                 
                              
                              a
                              z
                           
                           )
                         to the endoscope tip center 
                           
                              
                                 
                                    p
                                 
                              
                              o
                           
                           =
                           
                              
                                 (
                                 
                                    p
                                    o
                                    x
                                 
                                 ,
                                 
                                    p
                                    o
                                    y
                                 
                                 ,
                                 
                                    p
                                    o
                                    z
                                 
                                 )
                              
                              T
                           
                        :


                        
                           
                              (4)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                                  o
                                                                  x
                                                               
                                                               −
                                                               
                                                                  p
                                                                  a
                                                                  x
                                                               
                                                            
                                                            ︷
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            o
                                                         
                                                         −
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            a
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      p
                                                      o
                                                      y
                                                   
                                                   −
                                                   
                                                      p
                                                      a
                                                      y
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      p
                                                      o
                                                      z
                                                   
                                                   −
                                                   
                                                      p
                                                      a
                                                      z
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  s
                                                                  a
                                                                  
                                                                     x
                                                                     ,
                                                                     1
                                                                  
                                                               
                                                            
                                                            ︷
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  s
                                                               
                                                            
                                                            a
                                                            x
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  s
                                                                  a
                                                                  
                                                                     y
                                                                     ,
                                                                     1
                                                                  
                                                               
                                                            
                                                            ︷
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  s
                                                               
                                                            
                                                            a
                                                            y
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  s
                                                                  a
                                                                  
                                                                     z
                                                                     ,
                                                                     1
                                                                  
                                                               
                                                            
                                                            ︷
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  s
                                                               
                                                            
                                                            a
                                                            z
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      s
                                                      a
                                                      
                                                         x
                                                         ,
                                                         2
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      a
                                                      
                                                         y
                                                         ,
                                                         2
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      a
                                                      
                                                         z
                                                         ,
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      s
                                                      a
                                                      
                                                         x
                                                         ,
                                                         3
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      a
                                                      
                                                         y
                                                         ,
                                                         3
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      a
                                                      
                                                         z
                                                         ,
                                                         3
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      δ
                                                      x
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      δ
                                                      y
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      δ
                                                      z
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

By solving Eq. (4), we determine spatial relationship (δ
                        
                           x
                        , δ
                        
                           y
                        , δ
                        
                           z
                        ) between the ET sensor and the endoscope tip center.

Based on spatial distance (δ
                        
                           x
                        , δ
                        
                           y
                        , δ
                        
                           z
                        ) and the sensor orientation, endoscope tip center position 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    ˆ
                                 
                              
                              i
                           
                        , which corresponds to measurement 
                           
                              
                                 
                                    m
                                 
                              
                              i
                           
                           =
                           (
                           
                              
                                 
                                    p
                                 
                              
                              i
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              i
                              x
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              i
                              y
                           
                           ,
                           
                              
                                 
                                    s
                                 
                              
                              i
                              z
                           
                           )
                         at time i, is computed by:


                        
                           
                              (5)
                              
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          ˆ
                                       
                                    
                                    i
                                 
                                 =
                                 
                                    
                                       
                                          p
                                       
                                    
                                    i
                                 
                                 +
                                 
                                    δ
                                    x
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            s
                                                            i
                                                            
                                                               x
                                                               ,
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            s
                                                            i
                                                            
                                                               x
                                                               ,
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            s
                                                            i
                                                            
                                                               x
                                                               ,
                                                               3
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       ︸
                                    
                                    
                                       
                                          
                                             
                                                s
                                             
                                          
                                          i
                                          x
                                       
                                    
                                 
                                 +
                                 
                                    δ
                                    y
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            s
                                                            i
                                                            
                                                               y
                                                               ,
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            s
                                                            i
                                                            
                                                               y
                                                               ,
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            s
                                                            i
                                                            
                                                               y
                                                               ,
                                                               3
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       ︸
                                    
                                    
                                       
                                          
                                             
                                                s
                                             
                                          
                                          i
                                          y
                                       
                                    
                                 
                                 +
                                 
                                    δ
                                    z
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            s
                                                            i
                                                            
                                                               z
                                                               ,
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            s
                                                            i
                                                            
                                                               z
                                                               ,
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            s
                                                            i
                                                            
                                                               z
                                                               ,
                                                               3
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       ︸
                                    
                                    
                                       
                                          
                                             
                                                s
                                             
                                          
                                          i
                                          z
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Using calibrated endoscope tip center position 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    ˆ
                                 
                              
                              i
                           
                         and sensor measured point or position p
                        
                           i
                        , we generate multiple points for marker-free registration, as discussed as follows.

After obtaining 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    ˆ
                                 
                              
                              i
                           
                         and current measured point p
                        
                           i
                        , we generate multiple points. Our basic idea is to divide the endoscope tip circumference into eight equal parts and generate candidate points 
                           {
                           
                              
                                 
                                    p
                                 
                              
                              i
                              1
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              2
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              3
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              4
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              5
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              6
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              7
                           
                           }
                        , as shown in Fig. 3
                        .

Based on Euclidean geometry, we first compute the position of points 
                           
                              
                                 
                                    p
                                 
                              
                              i
                              4
                           
                        , 
                           
                              
                                 
                                    p
                                 
                              
                              i
                              2
                           
                        , and 
                           
                              
                                 
                                    p
                                 
                              
                              i
                              6
                           
                         by (
                           r
                           =
                           |
                           |
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    ˆ
                                 
                              
                              i
                           
                           −
                           
                              
                                 
                                    p
                                 
                              
                              i
                           
                           |
                           |
                        ):


                        
                           
                              (6)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      i
                                                      4
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            ˆ
                                                         
                                                      
                                                      i
                                                   
                                                   +
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            ˆ
                                                         
                                                      
                                                      i
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      i
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      i
                                                      2
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            ˆ
                                                         
                                                      
                                                      i
                                                   
                                                   +
                                                   r
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           ˆ
                                                                        
                                                                     
                                                                     i
                                                                  
                                                                  −
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              
                                                                                 
                                                                                    
                                                                                       p
                                                                                    
                                                                                 
                                                                                 ˆ
                                                                              
                                                                           
                                                                           i
                                                                        
                                                                        −
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            ×
                                                            
                                                               
                                                                  
                                                                     s
                                                                  
                                                               
                                                               i
                                                               z
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      i
                                                      6
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            ˆ
                                                         
                                                      
                                                      i
                                                   
                                                   −
                                                   r
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           ˆ
                                                                        
                                                                     
                                                                     i
                                                                  
                                                                  −
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                  
                                                               
                                                               
                                                                  |
                                                                  |
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           ˆ
                                                                        
                                                                     
                                                                     i
                                                                  
                                                                  −
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                  
                                                                  |
                                                                  |
                                                               
                                                            
                                                            ×
                                                            
                                                               
                                                                  
                                                                     s
                                                                  
                                                               
                                                               i
                                                               z
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Therefore, the position of the other four points, 
                           
                              
                                 
                                    p
                                 
                              
                              i
                              1
                           
                        , 
                           
                              
                                 
                                    p
                                 
                              
                              i
                              3
                           
                        , 
                           
                              
                                 
                                    p
                                 
                              
                              i
                              5
                           
                        , and 
                           
                              
                                 
                                    p
                                 
                              
                              i
                              7
                           
                         is determined by (symbol × means the cross product):


                        
                           
                              (7)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      i
                                                      1
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            ˆ
                                                         
                                                      
                                                      i
                                                   
                                                   −
                                                   r
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                     2
                                                                  
                                                                  −
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           i
                                                                           2
                                                                        
                                                                        −
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            ×
                                                            
                                                               
                                                                  
                                                                     s
                                                                  
                                                               
                                                               i
                                                               z
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      i
                                                      3
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            ˆ
                                                         
                                                      
                                                      i
                                                   
                                                   −
                                                   r
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                     6
                                                                  
                                                                  −
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           i
                                                                           6
                                                                        
                                                                        −
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            ×
                                                            
                                                               
                                                                  
                                                                     s
                                                                  
                                                               
                                                               i
                                                               z
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      i
                                                      5
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            ˆ
                                                         
                                                      
                                                      i
                                                   
                                                   +
                                                   r
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                     2
                                                                  
                                                                  −
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           i
                                                                           2
                                                                        
                                                                        −
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            ×
                                                            
                                                               
                                                                  
                                                                     s
                                                                  
                                                               
                                                               i
                                                               z
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      i
                                                      7
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            ˆ
                                                         
                                                      
                                                      i
                                                   
                                                   +
                                                   r
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                     6
                                                                  
                                                                  −
                                                                  
                                                                     
                                                                        
                                                                           p
                                                                        
                                                                     
                                                                     i
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           i
                                                                           6
                                                                        
                                                                        −
                                                                        
                                                                           
                                                                              
                                                                                 p
                                                                              
                                                                           
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            ×
                                                            
                                                               
                                                                  
                                                                     s
                                                                  
                                                               
                                                               i
                                                               z
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

To solve Eqs. (6) and (7), we assume that the ET sensor and endoscope tip center are in the same plane of rotation.

Finally, nine points 
                           Ω
                           =
                           {
                           
                              
                                 
                                    p
                                 
                              
                              i
                           
                           ,
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    ˆ
                                 
                              
                              i
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              1
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              2
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              3
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              4
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              5
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              6
                           
                           ,
                           
                              
                                 
                                    p
                                 
                              
                              i
                              7
                           
                           }
                         are obtained in the ET coordinate system. We select the optimal one from set Ω to compute spatial alignment 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                        .

We transform ET point p
                        
                           i
                         to CT point 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                           
                              
                                 
                                    p
                                 
                              
                              i
                           
                         and assign closest centerline
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                    
                                    ˆ
                                 
                              
                              k
                           
                         to 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                           
                              
                                 
                                    p
                                 
                              
                              i
                           
                         by minimizing the distance between point 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                           
                              
                                 
                                    p
                                 
                              
                              i
                           
                         and centerlines 
                           C
                        .


                        
                           
                              (8)
                              
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                          
                                          ˆ
                                       
                                    
                                    k
                                 
                                 =
                                 arg
                                 
                                    min
                                    
                                       
                                          
                                             
                                                c
                                             
                                          
                                          k
                                       
                                       ∈
                                       C
                                    
                                 
                                 d
                                 (
                                 
                                    
                                       T
                                       et
                                    
                                    
                                    
                                    ct
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    i
                                 
                                 ,
                                 
                                    
                                       
                                          c
                                       
                                    
                                    k
                                 
                                 )
                                 ,
                              
                           
                        where distance 
                           d
                           (
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                           
                              
                                 
                                    p
                                 
                              
                              i
                           
                           ,
                           
                              
                                 
                                    c
                                 
                              
                              k
                           
                           )
                         from point 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                           
                              
                                 
                                    p
                                 
                              
                              i
                           
                         to centerline c
                        
                           k
                         is calculate by Fig. 3(c):
                           
                              (9)
                              
                                 d
                                 (
                                 
                                    
                                       T
                                       et
                                    
                                    
                                    
                                    ct
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    i
                                 
                                 ,
                                 
                                    
                                       
                                          c
                                       
                                    
                                    k
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   |
                                                   |
                                                   
                                                      
                                                         T
                                                         et
                                                      
                                                      
                                                      
                                                      ct
                                                   
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      i
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            c
                                                         
                                                      
                                                      k
                                                      s
                                                   
                                                   |
                                                   |
                                                
                                                
                                                   γ
                                                   <
                                                   0
                                                
                                             
                                             
                                                
                                                   |
                                                   |
                                                   
                                                      
                                                         T
                                                         et
                                                      
                                                      
                                                      
                                                      ct
                                                   
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      i
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            c
                                                         
                                                      
                                                      k
                                                      e
                                                   
                                                   |
                                                   |
                                                
                                                
                                                   γ
                                                   >
                                                   
                                                      l
                                                      k
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         |
                                                         |
                                                         
                                                            
                                                               T
                                                               et
                                                            
                                                            
                                                            
                                                            ct
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            i
                                                         
                                                         −
                                                         
                                                            
                                                               
                                                                  c
                                                               
                                                            
                                                            k
                                                            s
                                                         
                                                         |
                                                         
                                                            |
                                                            2
                                                         
                                                         −
                                                         
                                                            γ
                                                            2
                                                         
                                                      
                                                   
                                                
                                                
                                                   otherwise
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where the centerline length 
                           
                              l
                              k
                           
                           =
                           |
                           |
                           
                              
                                 
                                    c
                                 
                              
                              k
                              e
                           
                           −
                           
                              
                                 
                                    c
                                 
                              
                              k
                              s
                           
                           |
                           |
                         and γ denotes the length of vector 
                           (
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                           
                              
                                 
                                    p
                                 
                              
                              i
                           
                           −
                           
                              
                                 
                                    c
                                 
                              
                              k
                              s
                           
                           )
                         that is projected on centerline c
                        
                           k
                         and is computed by:


                        
                           
                              (10)
                              
                                 γ
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   T
                                                   et
                                                
                                                
                                                
                                                ct
                                             
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                i
                                             
                                             −
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                k
                                                s
                                             
                                             ,
                                                
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                k
                                                e
                                             
                                             −
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                k
                                                s
                                             
                                          
                                       
                                    
                                    
                                       |
                                       |
                                       
                                          
                                             
                                                c
                                             
                                          
                                          k
                                          e
                                       
                                       −
                                       
                                          
                                             
                                                c
                                             
                                          
                                          k
                                          s
                                       
                                       |
                                       |
                                    
                                 
                                 ,
                              
                           
                        where γ
                        <0 and γ
                        >
                        l
                        
                           k
                         mean that projected point q
                        
                           i
                         is on the parent and child centerlines of centerline c
                        
                           k
                        , respectively; otherwise, it is on centerline c
                        
                           k
                        , and 
                           
                              ,
                           
                         denotes the dot product.

Note that during the minimization (Eq. (8)), we may obtain several closest centerlines 
                           
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                          
                                          ˆ
                                       
                                    
                                    
                                       k
                                       ,
                                       j
                                    
                                 
                                 }
                              
                              
                                 j
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 3
                                 ,
                                 …
                              
                           
                         that have the same closest distance to CT point 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                           
                              
                                 
                                    p
                                 
                              
                              i
                           
                        . We compute the angle between sensor z-direction 
                           
                              
                                 
                                    s
                                 
                              
                              i
                              z
                           
                         and centerline direction 
                           (
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                    
                                    ˆ
                                 
                              
                              
                                 k
                                 ,
                                 j
                              
                              e
                           
                           −
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                    
                                    ˆ
                                 
                              
                              
                                 k
                                 ,
                                 j
                              
                              s
                           
                           )
                           |
                           |
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                    
                                    ˆ
                                 
                              
                              
                                 k
                                 ,
                                 j
                              
                              e
                           
                           −
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                    
                                    ˆ
                                 
                              
                              
                                 k
                                 ,
                                 j
                              
                              s
                           
                           |
                           
                              |
                              
                                 −
                                 1
                              
                           
                         to determine optimal centerline
                           
                              
                                 
                                    
                                       
                                          c
                                          ˜
                                       
                                    
                                 
                              
                              j
                           
                        :


                        
                           
                              (11)
                              
                                 
                                    
                                       
                                          
                                             
                                                c
                                                ˜
                                             
                                          
                                       
                                    
                                    j
                                 
                                 =
                                 arg
                                 
                                    min
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                ˆ
                                             
                                          
                                          
                                             k
                                             ,
                                             j
                                          
                                       
                                       }
                                    
                                 
                                 arccos
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               c
                                                            
                                                         
                                                         ˆ
                                                      
                                                   
                                                   
                                                      k
                                                      ,
                                                      j
                                                   
                                                   e
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            
                                                               c
                                                            
                                                         
                                                         ˆ
                                                      
                                                   
                                                   
                                                      k
                                                      ,
                                                      j
                                                   
                                                   s
                                                
                                             
                                             
                                                |
                                                |
                                                
                                                   
                                                      
                                                         
                                                            
                                                               c
                                                            
                                                         
                                                         ˆ
                                                      
                                                   
                                                   
                                                      k
                                                      ,
                                                      j
                                                   
                                                   e
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            
                                                               c
                                                            
                                                         
                                                         ˆ
                                                      
                                                   
                                                   
                                                      k
                                                      ,
                                                      j
                                                   
                                                   s
                                                
                                                |
                                                |
                                             
                                          
                                          ,
                                             
                                          
                                             
                                                
                                                   
                                                      T
                                                      et
                                                   
                                                   
                                                   
                                                   ct
                                                
                                                
                                                   
                                                      
                                                         s
                                                      
                                                   
                                                   i
                                                   z
                                                
                                             
                                             
                                                |
                                                |
                                                
                                                   
                                                      T
                                                      et
                                                   
                                                   
                                                   
                                                   ct
                                                
                                                
                                                   
                                                      
                                                         s
                                                      
                                                   
                                                   i
                                                   z
                                                
                                                |
                                                |
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

After obtaining optimal centerline 
                           
                              
                                 
                                    
                                       
                                          c
                                          ˜
                                       
                                    
                                 
                              
                              k
                           
                        , we select optimal point 
                           
                              
                                 
                                    
                                       
                                          p
                                          ˜
                                       
                                    
                                 
                              
                              i
                           
                         from set Ω in terms of distance 
                           d
                           (
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    ˆ
                                 
                              
                              i
                           
                           ,
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                    
                                    ˆ
                                 
                              
                              k
                           
                           )
                        :


                        
                           
                              (12)
                              
                                 
                                    
                                       
                                          
                                             
                                                p
                                                ˜
                                             
                                          
                                       
                                    
                                    i
                                 
                                 =
                                 arg
                                 
                                    min
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                ˆ
                                             
                                          
                                          i
                                       
                                       ∈
                                       Ω
                                    
                                 
                                 d
                                 (
                                 
                                    
                                       T
                                       et
                                    
                                    
                                    
                                    ct
                                 
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          ˆ
                                       
                                    
                                    i
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             
                                                c
                                                ˜
                                             
                                          
                                       
                                    
                                    j
                                 
                                 )
                                 .
                              
                           
                        
                     

Note that 
                           
                              
                                 
                                    
                                       
                                          p
                                          ˜
                                       
                                    
                                 
                              
                              i
                           
                         is the output of our multiple point strategy.

After determining optimal centerline 
                           
                              
                                 
                                    
                                       
                                          c
                                          ˜
                                       
                                    
                                 
                              
                              j
                           
                         and point 
                           
                              
                                 
                                    
                                       
                                          p
                                          ˜
                                       
                                    
                                 
                              
                              i
                           
                         at time i, we project point 
                           
                              
                                 
                                    
                                       
                                          p
                                          ˜
                                       
                                    
                                 
                              
                              i
                           
                         on centerline 
                           
                              
                                 
                                    
                                       
                                          c
                                          ˜
                                       
                                    
                                 
                              
                              j
                           
                         and compute projected point q
                        
                           i
                         by (Fig. 3(c)):


                        
                           
                              (13)
                              
                                 
                                    
                                       
                                          q
                                       
                                    
                                    i
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                c
                                                ˜
                                             
                                          
                                       
                                    
                                    j
                                    s
                                 
                                 +
                                 
                                    
                                       
                                          
                                             
                                                
                                                   T
                                                   et
                                                
                                                
                                                
                                                ct
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                            ˜
                                                         
                                                      
                                                   
                                                
                                                i
                                             
                                             −
                                             
                                                
                                                   
                                                      
                                                         
                                                            c
                                                            ˜
                                                         
                                                      
                                                   
                                                
                                                j
                                                s
                                             
                                             ,
                                                
                                             
                                                
                                                   
                                                      
                                                         
                                                            c
                                                            ˜
                                                         
                                                      
                                                   
                                                
                                                j
                                                e
                                             
                                             −
                                             
                                                
                                                   
                                                      
                                                         
                                                            c
                                                            ˜
                                                         
                                                      
                                                   
                                                
                                                j
                                                s
                                             
                                          
                                       
                                    
                                    
                                       |
                                       |
                                       
                                          
                                             
                                                
                                                   
                                                      c
                                                      ˜
                                                   
                                                
                                             
                                          
                                          j
                                          e
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   
                                                      c
                                                      ˜
                                                   
                                                
                                             
                                          
                                          j
                                          s
                                       
                                       |
                                       |
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      c
                                                      ˜
                                                   
                                                
                                             
                                          
                                          j
                                          e
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   
                                                      c
                                                      ˜
                                                   
                                                
                                             
                                          
                                          j
                                          s
                                       
                                       )
                                    
                                    
                                       |
                                       |
                                       
                                          
                                             
                                                
                                                   
                                                      c
                                                      ˜
                                                   
                                                
                                             
                                          
                                          j
                                          e
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   
                                                      c
                                                      ˜
                                                   
                                                
                                             
                                          
                                          j
                                          s
                                       
                                       |
                                       |
                                    
                                 
                                 .
                              
                           
                        
                     

For M sensor measurements, we use Eqs. (6)–(13) and obtain point set 
                           M
                           =
                           
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                m
                                                ˜
                                             
                                          
                                       
                                    
                                    i
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             
                                                p
                                                ˜
                                             
                                          
                                       
                                    
                                    i
                                 
                                 ,
                                 
                                    
                                       
                                          s
                                       
                                    
                                    i
                                    x
                                 
                                 ,
                                 
                                    
                                       
                                          s
                                       
                                    
                                    i
                                    y
                                 
                                 ,
                                 
                                    
                                       
                                          s
                                       
                                    
                                    i
                                    z
                                 
                                 )
                                 }
                              
                              
                                 i
                                 =
                                 1
                              
                              M
                           
                         and projected point set 
                           Q
                           =
                           
                              
                                 {
                                 
                                    
                                       
                                          q
                                       
                                    
                                    i
                                 
                                 }
                              
                              
                                 i
                                 =
                                 1
                              
                              M
                           
                        .

Based on two point sets 
                           M
                         and 
                           Q
                        , we run an optimizer to estimate spatial transformation 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                        . However, an objective function must be defined in this optimization. Since an endoscope is assumed to manipulate along the centerlines, it is natural to define objective function 
                           
                              D
                              i
                           
                         with respect to the distance between transformed point 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                           
                              
                                 
                                    
                                       
                                          p
                                          ˜
                                       
                                    
                                 
                              
                              i
                           
                         and projected point q
                        
                           i
                         and radius ϕ
                        
                           j
                         of optimal centerline 
                           
                              
                                 
                                    
                                       
                                          c
                                          ˜
                                       
                                    
                                 
                              
                              j
                           
                        :


                        
                           
                              (14)
                              
                                 
                                    D
                                    i
                                 
                                 =
                                 
                                    
                                       |
                                       |
                                       
                                          
                                             T
                                             et
                                          
                                          
                                          
                                          ct
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                      ˜
                                                   
                                                
                                             
                                          
                                          i
                                       
                                       −
                                       
                                          
                                             
                                                q
                                             
                                          
                                          i
                                       
                                       |
                                       |
                                    
                                    
                                       
                                          ϕ
                                          j
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

This equation also implies that the point closer to the centerline, the more accurate estimation 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                         can be obtained.

Eventually, 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                         is determined by minimizing the distance between selected point set 
                           M
                           =
                           
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                m
                                                ˜
                                             
                                          
                                       
                                    
                                    i
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             
                                                p
                                                ˜
                                             
                                          
                                       
                                    
                                    i
                                 
                                 ,
                                 
                                    
                                       
                                          s
                                       
                                    
                                    i
                                    x
                                 
                                 ,
                                 
                                    
                                       
                                          s
                                       
                                    
                                    i
                                    y
                                 
                                 ,
                                 
                                    
                                       
                                          s
                                       
                                    
                                    i
                                    z
                                 
                                 )
                                 }
                              
                              
                                 i
                                 =
                                 1
                              
                              M
                           
                         and projected point set 
                           Q
                           =
                           
                              
                                 {
                                 
                                    
                                       
                                          q
                                       
                                    
                                    i
                                 
                                 }
                              
                              
                                 i
                                 =
                                 1
                              
                              M
                           
                         (M is the number of total ET sensor measurements):


                        
                           
                              (15)
                              
                                 
                                    
                                       
                                          
                                             T
                                             ˜
                                          
                                       
                                       et
                                    
                                    
                                    
                                    ct
                                 
                                 =
                                 arg
                                 
                                    min
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      m
                                                      ˜
                                                   
                                                
                                             
                                          
                                          i
                                       
                                       ∈
                                       M
                                       ,
                                       
                                          
                                             
                                                q
                                             
                                          
                                          i
                                       
                                       ∈
                                       Q
                                    
                                 
                                 
                                    ∑
                                    i
                                 
                                 
                                    D
                                    i
                                 
                                 .
                              
                           
                        
                     

The above equation that formulates a minimization procedure was solved by the Powell approach [19] in our implementation.

Our adaptive marker-free registration approach to estimate ET–CT transformation 
                           
                              
                                 T
                                 et
                              
                              
                              
                              ct
                           
                         is summarized in Algorithm 1.


                        
                           
                              
                           
                        
                     

@&#EXPERIMENTS@&#

We evaluate our adaptive marker-free registration approach on static and dynamic phantoms and use different types of endoscopes and ET systems in our experiments.

We built a static phantom that cannot simulate respiratory motion to validate our proposed registration method. The CT volume of this static phantom was 512×512×611 voxels with resolution of 0.892
                     mm
                     ×0.692
                     mm
                     ×0.5mm. During this static phantom validation, we use an endobronchial ultrasound (EBUS) endoscope (BF TYPE US260F-OL8, Olympus, Tokyo) and an ET system (AURORA, Northern Digital Inc., Waterloo, Canada) (Fig. 4
                     (a)). The radius of this EBUS endoscope and an AURORA sensor was about 3.5mm and 0.4mm. We attached the AURORA sensor at the EBUS endoscope tip.

We also experimentally constructed a dynamic phantom that can simulate respiratory motion with a breath rate range of 0∼10 per minute and a motion domain of 0–24mm. The phantom CT acquisition parameters were 512×512 pixels, 1021 slices, a 0.68mm reconstruction pitch, and 0.5mm thick slices. One drawback of our dynamic phantom must be noted; its breath rates are somewhat unrealistic, compared to human breath rates of 14–30. Our previous work showed more details about constructing our dynamic phantom [20]. During this dynamic phantom validation, we used a 3-D Guidance medSAFE tracker (Ascension Technology Corporation, USA) as our ET system with an electromagnetic field generator and sensors (1.5mm, 6DoF) and an endoscope (BF Type 200, Olympus, Tokyo) (Fig. 4(b)). The tip diameter of this endoscope was 5.7mm.

For a lateral comparison, we investigate several currently available methods: (1) Kein et al. [15], an in-volume maximization algorithm that maximizes the percentage of ET sensor measurements inside the airway volume, (2) Deguchi et al. [16], an approach that minimizes the distance between ET sensor measurements and centerlines of the airway trees, and (3) our method, as presented in Section 3. To fairly compare the second method and ours, we also set M
                     0
                     =200 and M
                     Δ
                     =20 in our method, as discussed in previous work [16].

To investigate tracking performance of these different approaches, we compute fiducial registration error f
                     
                        e
                      using markers that were placed on our phantoms:


                     
                        
                           (16)
                           
                              
                                 f
                                 e
                              
                              =
                              
                                 1
                                 N
                              
                              
                                 ∑
                                 
                                    n
                                    =
                                    1
                                 
                                 N
                              
                              |
                              |
                              
                                 
                                    
                                       q
                                    
                                 
                                 n
                                 ct
                              
                              −
                              
                                 
                                    
                                       
                                          T
                                          ˜
                                       
                                    
                                    et
                                 
                                 
                                 
                                 ct
                              
                              
                                 
                                    
                                       p
                                    
                                 
                                 n
                                 et
                              
                              |
                              |
                              ,
                           
                        
                     where 
                        
                           
                              
                                 q
                              
                           
                           n
                           ct
                        
                      denotes one marker's position that is manually determined from the CT volume, 
                        
                           
                              
                                 p
                              
                           
                           n
                           et
                        
                      is a measured marker's position using an ET sensor, and 
                        
                           
                              
                                 
                                    T
                                    ˜
                                 
                              
                              et
                           
                           
                           
                           ct
                        
                      is the final estimate after W iterations in one experiment.

We also evaluate target tracking error of each ET sensor measurement. We performed marker-based registration to obtain ET–CT spatial transformation 
                        
                           
                              T
                              et
                              *
                           
                           
                           
                           ct
                        
                     , which was assumed to be highly accurate since its fiducial registration error was about 0.8mm in our experiments. We calculate target tracking error (relative error) t
                     
                        e
                      by:


                     
                        
                           (17)
                           
                              
                                 t
                                 e
                              
                              =
                              
                                 1
                                 M
                              
                              
                                 ∑
                                 
                                    i
                                    =
                                    1
                                 
                                 M
                              
                              |
                              |
                              
                                 
                                    T
                                    et
                                    *
                                 
                                 
                                 
                                 ct
                              
                              
                                 
                                    
                                       p
                                    
                                 
                                 i
                              
                              −
                              
                                 
                                    
                                       
                                          T
                                          ˜
                                       
                                    
                                    et
                                 
                                 
                                 
                                 ct
                              
                              
                                 
                                    
                                       p
                                    
                                 
                                 i
                              
                              |
                              |
                              ,
                           
                        
                     where p
                     
                        i
                      is one measured position and 
                        
                           
                              
                                 
                                    T
                                    ˜
                                 
                              
                              et
                           
                           
                           
                           ct
                        
                      is the final estimate after W iterations in one experiment.

Additionally, we compute the distance between transformed and projected points, 
                        
                           
                              
                                 
                                    T
                                    ˜
                                 
                              
                              et
                           
                           
                           
                           ct
                        
                        
                           
                              
                                 
                                    
                                       p
                                       ˜
                                    
                                 
                              
                           
                           i
                        
                      and q
                     
                        i
                     , of selected point 
                        
                           
                              
                                 
                                    
                                       p
                                       ˜
                                    
                                 
                              
                           
                           i
                        
                      of each ET measurement p
                     
                        i
                      using ET–CT transformation 
                        
                           
                              
                                 
                                    T
                                    ˜
                                 
                              
                              et
                           
                           
                           
                           ct
                        
                      (Eq. 9). This indicates whether selected point 
                        
                           
                              
                                 
                                    
                                       p
                                       ˜
                                    
                                 
                              
                           
                           i
                        
                      is closer to centerlines than p
                     
                        i
                      after transforming it to the CT volume.

@&#RESULTS@&#

We performed 15 experiments using static and dynamic phantoms, respectively, to validate our proposed method.


                        Table 1
                         quantitatively summarizes fiducial registration errors, distances between optimal selected points and assigned centerlines, target tracking errors using different methods. The average fiducial registration and target tracking errors were significantly reduced from at least 7.36mm and 5.32mm to 4.27mm and 2.59mm, respectively. The average distance also was diminished from 5.34mm to 2.53mm.


                        Fig. 5
                         plots the fiducial registration error, distance between transformed points and centerlines, and target tracking error by using different methods that were evaluated on 15 experiments during static phantom validation. Fig. 6
                         visualizes the distance from transformed points of using different methods to assigned centerlines. Obviously, selecting optimal points and transforming them to CT on the basis of our multiple point strategy is closer to assigned centerlines than other approaches. Fig. 7
                         displays endoscope positions that were estimated by different approaches. Our method still outperforms others.

During dynamic phantom validation, the average fiducial registration and target tracking errors were increased from 4.27mm and 2.59mm (errors in static phantom validation) to 5.80mm and 4.71mm due to simulated respiratory motion. Tables 1 and 2
                         compare the experimental results of using methods of Klein et al. [15], Deguchi et al. [16], and ours. The average distance also was increased from 2.53mm (distance in static phantom validation) to 4.61mm. However, our proposed method still performs much better than other two approaches (Table 2). Based on the non-parametric statistical hypothesis Wilcoxon signed-rank test, we also computed p-values for the fiducial registration error, the distance, and the target tracking error of using the different methods (Tables 1 and 2). Because these p-values were large, the null hypothesis cannot be rejected.


                        Fig. 8
                         compares the fiducial registration error, distance between transformed points and centerlines, and target tracking error from different approaches that were evaluated on 15 experiments during dynamic phantom validation. Fig. 9
                        (a) and (b) plot endoscope positions of using method of Deguchi et al. [16] and our proposed method against marker-based position estimations. The position estimates of our method are closer to marker-based positions than Deguchi et al. [16]. This implies that our estimates are more accurate than others. Fig. 9(c) and (d) illustrate tracking results that were interpreted to virtual rendering images. We use CT images and estimated endoscope positions (tracking results) and perform volume rendering to generate virtual images. We inspect whether virtual rendering images resembles video images. The virtual rendering images of using our method were more similar than others (Fig. 9(c) and (d)), which implies ours still outperforms other approaches.

@&#DISCUSSION@&#

In general, our proposed method to establish the ET–CT spatial alignment outperforms previous methods. Both fiducial registration and target tracking accuracies were significantly improved during static and dynamic phantom validations. We attribute this improvement to our multiple point strategy.

We designed a model and printed it in 3D to calibrate the spatial relationship between the endoscope center and the ET sensor. Based on this calibrated spatial relationship and each ET sensor measurement (position and orientation), we generate multiple positions or points and select optimal points closest to assigned centerlines. Our strategy fully uses ET sensor measured orientation information in three-direction and adaptively choose the closest points. The adaptivity of our method enables optimal points to be used in minimization, significantly diminishing the assumption of manipulating endoscope along the centerlines of body cavities. Also note that the aim of this work is to reduce the assumption of moving the endoscope along the organ's centerline to improve the ET–CT registration and synchronization. We believe that this assumption was successfully diminished, i.e., the distance between the sensor position after transformed to CT and the bronchial centerlines was much reduced, as shown in our experimental results, e.g., Tables 1 and 2, Fig. 5(b), and Fig. 8(b).

However, our method to align the ET system and the CT volume for endoscope electromagnetic navigation provides limited tracking accuracy, i.e., we still need to further improve the target tracking error of using our method, particularly during dynamic phantom validation. Several potential limitations are clarified as follows. First, patient movements, particularly respiratory motion, usually deteriorates the tracking accuracy, since they might cause inaccurate sensor measurements that may not exactly correspond to the current endoscope position. One future work is to compensate respiratory motion for accurate endoscope tracking. Next, ET systems unavoidably involve static and jitter errors. The static or inherent error of ET systems was about 0.88–1.4mm that were reported in the ET system's specification. The jitter or dynamic error, which remains influenced by the magnetic field distortion of ET systems, is difficult to be corrected. In our future work, we address these errors by a state space model to further improve the tracking accuracy during endoscope electromagnetic navigation. Also note that our proposed method is a rigid registration procedure, i.e., no matter how accurate the ET–CT spatial transformation is determined, the tracking accuracy of using our method limits to respiratory motion and magnetic field distortion, particularly endoscope electromagnetic navigation itself is a noisy, dynamic, and uncertain procedure. Additionally, the endoscope center calibration possibly introduces the registration error that was mainly caused by the ET system's inaccuracy, i.e., the inaccurate measurement of the ET sensor due to static and jitter errors.

Finally, we clarify that our method provides real-time endoscope electromagnetic navigation. The computation of the spatial ET–CT transformation usually takes about 36–54s when using two or three thousands of ET sensor measurements in our proposed approach. Once the ET–CT spatial alignment is determined, we temporally track endoscopes in real time since endoscope position and orientation parameters can be computed by multiplying each ET sensor measurement by the estimated ET–CT spatial transformation matrix.

@&#CONCLUSIONS@&#

This work proposed an adaptive fiducial-free registration approach to establish the ET–CT spatial alignment for real-time electromagnetically navigated endoscopy. We introduced a multiple point strategy to select optimal points based on ET sensor measured position and orientation information and a procedure of endoscope center calibration to tackle an assumption that an endoscope is operated along the hollow organ's centerlines during endoscopic interventions. Compared to previous methods, the current tracking accuracy of using our proposed adaptive registration approach was significantly improved from at least 5.32 to 2.59mm in static phantoms validation, as well as from at least 7.58mm to 4.71mm in dynamic phantom validation. Future work also includes validation on clinical datasets and application of our proposed method to other flexible registration cases.

The authors declare that they have no conflict of interest.

@&#ACKNOWLEDGMENTS@&#

This work was funded by JSPS Kakenhi “Modality-seamless navigation for endoscopic diagnosis and surgery assistance based on multi-modality image fusion” (25242047) and JSPS Bilateral International Collaboration Grant.

@&#REFERENCES@&#

