@&#MAIN-TITLE@&#An automated planning engine for biopharmaceutical production

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We introduce an optimization-based production planning tool for biotechnology industry.


                        
                        
                           
                           It captures the constraints imposed by the regulatory approvals of processes and facilities.


                        
                        
                           
                           It captures the outcomes of quality testing and processing options, facility capacities.


                        
                        
                           
                           It generates capacity feasible batch processing schedules for each production facility.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Biopharmaceutical production

@&#ABSTRACT@&#


               
               
                  We introduce an optimization-based production planning tool for the biotechnology industry. The industry’s planning problem is unusually challenging because the entire production process is regulated by multiple external agencies – such as the US Food and Drug Administration – representing countries where the biopharmaceutical is to be sold. The model is structured to precisely capture the constraints imposed by current and projected regulatory approvals of processes and facilities, as well as capturing the outcomes of quality testing and processing options, facility capacities and initial status of work-in-process. The result is a supply chain “Planning Engine” that generates capacity-feasible batch processing schedules for each production facility within the biomanufacturing supply chain and an availability schedule for finished product against a known set of demands and regulations. Developing the formulation based on distinct time grids tailored for each facility, planning problems with more than 27,000 boolean variables, more than 130,000 linear variables and more than 80,000 constraints are automatically formulated and solved within a few hours. The Planning Engine’s development and implementation at Bayer Healthcare’s Berkeley, CA manufacturing site is described.
               
            

@&#INTRODUCTION@&#

The biopharmaceutical supply chain presents a unique challenge to production planners. Large-scale biotechnology manufacture (‘bioproduction’) requires exceptionally stringent levels of cleanliness, quality control mechanisms that actively track hundreds of process parameters, and the ability to control all of these parameters with an imperfect knowledge of the response of the target biological material. In addition, many of the processes by which biological products are produced are relatively new and, as a result, products are often highly variable in output quality (Shah, 2004).

The nascent nature of recombinant technologies and the gravity of current treatment targets for chronic and life-threatening illnesses leads to stringent regulation. The key difficulty in large-scale manufacture of protein-based pharmaceuticals is the production of sufficient quantities of the target protein at very low levels of contamination. As a result, the Food and Drug Administration (FDA) and foreign regulatory authorities typically require licensure of the entire process surrounding the production of biotechnology products. This means that any changes to plant, equipment or process specifications must be certified in each country or region in which it is sold, a process which may take up to 3years for major projects.

This issue is exacerbated by the fact that biopharmaceutical medicines typically have a longer lifespan in the market than non-recombinant drug formulations (such as antibiotics). There are typically a portfolio of patents and protection mechanisms employed not just around the drug itself, but around the mechanisms used to produce, purify and preserve the drug. The dual effect of process-based patent protection and stringent regulation around manufacture is that the standard twenty-year patent protection on new drugs is considerably lengthened. With a longer product lifespan and regulation around the production process, it becomes necessary for production and plant improvements to be incorporated into the regulatory approval process. This key issue has not been addressed by current literature in the process optimization industry.

An additional issue facing the biopharmaceutical industry is one of provisioning sufficient capacity (in aggregate terms as well as in terms of product-specific capacity) to meet projected demand over the next 10–20years. One author notes that the number of pending products for monoclonal antibody drugs (a subset of biotechnology pharmaceuticals) alone will stretch current and projected manufacturing capacities (Robinson, 2002). As such there is a strong need for process improvement to deliver higher yields and lower cycle times, thus generating more product throughput. At prices as high as $4000 per milligram of final product (200 times the price of gold), there is considerable incentive for biotechnology companies to improve processes.

However, process improvements must be approved separately in each region of the world in which product is sold. Regulatory agencies are typically highly risk-adverse and differ in their approaches and requirements, despite some efforts at harmonization (Jordan, 1992) (Vogel, 1998). Separate submissions and sometimes full-scale clinical trials must be conducted in each and every market, a complex and time-consuming process. Moreover, approvals are received at different times from the different agencies.

The length of time and the expense associated with gaining regulatory approvals have a number of effects on the production of biopharmaceuticals. First, process improvements are typically approached with a high degree of caution, thus limiting the potential for technological and process improvements to deliver higher yields. This is due largely to the fact that unlicensed material must be isolated and tracked through the facility at successive processing stages. Second, the licensure process is different for every country. It could be the case, for example, that a material fermented using a new process is certified in the United States but not in Canada, whereas the same material produced using a universally licensed fermentation process but a new purification process may be certified in Canada but not the United States.

The combinatorial effect of each change in the supply chain creates a number of final and intermediate product ‘variants,’ each of which may be certified in a certain subset of regions. As a result, matching supply to demand is often difficult, as planners must regularly inspect each batch production record manually to ensure that it is (or will be) certified when the product becomes a finished good. This often requires examining every intermediate batch sourced at every preceding production stage, which (because of blending in successive processes) may include hundreds of constituent batches.

Researchers and the FDA alike have recognized that supply chain optimization and supporting technologies should be adapted to effectively manage this change process while ensuring quality and reliability of supply. The FDA’s new ‘process analytical technology’ initiative (PAT) is designed to promote certain technological advances such as supply chain optimization by the pharmaceutical industry. The specific goals of this initiative are to:
                           
                              (1) encourage the early adoption of new technological advances by the pharmaceutical industry
                           
                           
                              (2) base regulatory review and inspection policies on state-of-the-art pharmaceutical science
                           
                           
                              (3) facilitate industry application of modern quality management systems
                           
                           
                              (4) use risk-based approaches that focus both industry and agency attention on critical areas
                           
                           
                              (5) incorporate enhanced quality system approaches into the agency’s business processes
                           
                           (http://www.fda.gov/cder/gmp/gmp2004/manufSciWP.pdf)
                        
                     

Supply chain optimization will aid in meeting these goals in a timely manner. Specifically in regard to (4), it is necessary for advances in process management to incorporate the results of quality control and test outcomes as well as process parameters directly into production planning, as these factors are at present typically neglected or poorly analyzed in the planning process, with consequent production inefficiencies.

Current supply chain methodology developed for the discrete parts industry such as MRP (Manufacturing Resources Planning) systems are ill-suited to biopharmaceutical manufacture because it is impractical or perhaps impossible to reflect the regulatory constraints discussed above in the bill of materials and routing input data. Current MRP engines are unable to optimize supply chain performance in biotechnology manufacture because multiple, concurrent process and equipment changes become certified in different regions at different times. The complicated licensure of processes generates a multitude of different product ‘variants’ at each stage of production, only some of which are certified in a given region at a specific time.

Current approaches in the biomanufacturing area focus on the high marginal value of the medicine produced, generating large quantities of source material but only packaging what is required by the customer. Customer demand is typically translated to production schedules in the final stages of manufacturing as a “pull” process, but the primary manufacturing stage (fermentation) features long cycle times and process variability which make it difficult to ensure supply chain responsiveness (Shah, 2005). This creates a kind of “bullwhip” effect on bioproduction where planners are either constantly responding to emergencies or forced to carry massive inventories of intermediate product.

One approach extensively used in the semiconductor industry shows promise for addressing the issue of optimally reacting to process improvement and certification delays. “Bin splits” (i.e., quality-based grading) of products at several process stages are common in the semiconductor industry, whereby each bin defines a specific range of performance (Leachman, 1993, 2001). While the distribution of performance quality is a characteristic of the production process, the bin split distribution can be influenced by the choice of testing options (e.g., skipping some tests for high-quality characteristics.) The resulting bins of output of one stage are then allocated to follow-on intermediate or final products. It can be prudent to allocate high-grade bins to low-grade demands when demand for low-grade items is relatively high, thereby minimizing total production requirements. Research in this area combined linear programming and MRP concepts in a computationally tractable manner to enable semiconductor manufacturers to optimally meet final demand while accounting for quality issues. This approach has been successfully implemented in a number of semiconductor companies, with dramatic improvements in on-time delivery (Leachman, Benson, Raar, & Liu, 1996).

The bin splits and bin allocations in the semiconductor industry exhibit some parallels to the generation of product variants in the biotechnology industry. In both industries, planners are concerned with meeting final demand while accounting for intermediate ‘flavors’ of product which may restrict the type of demand which can be satisfied. For semiconductors, the bin splits are a probabilistic result of both processing decisions (which facility, which testing procedure) as well as outcomes characteristic of the production process. Product variants in the biotechnology industry are a result of routing decisions in the supply chain (i.e., processing options) as well as probabilistic quality outcomes for the selected processing option. But there are differences. Changing regulations in the latter industry result in abrupt and major shifts in the product structure of the planning problem, while bin splits in the former industry tend to evolve gradually.

We base our approach in this paper in part on the framework established in the semiconductor planning research referenced above.

The Bioproduction Planning Problem (BPP) is concerned with producing sufficient but not excessive finished goods to meet final demand while meeting all country-specific regulatory requirements on product, process, equipment, facilities and raw materials. A solution to the bioproduction planning problem ensures that demand targets can be met while maximizing production efficiency and usage of available resources. The dynamics of regulation and the consequent abrupt creation or elimination of product ‘variants’ hinders planners’ ability to avoid production shortages or excess supplies. In this context, a tool to optimally react to process changes and to delays in certification of the changes may enable innovation in the space.


                        Fig. 1
                         outlines the four main processes in the production of biopharmaceuticals. Firstly, expression of the active biological ingredient is achieved using one of a number of alternative techniques, with fermentation being the most prevalent. Fermentation is done by taking a small amount of material with the target drug from a cell bank and using this to inoculate a growth medium. After the optimal concentration of material has been reached, the material is harvested and purified. While the specific purification method varies by product, it normally comprises filtration of the source material, followed by chromatography to select the specific target proteins desired. Next, the product is bulked: agents are added to buffer and stabilize the material at varying product strengths (termed potencies) dictated by market requirements. Lastly, the product is put into a final container and freeze dried (lyophilized) to remove water and other solvents. This final product is relatively stable and can be stored (either refrigerated or at room temperature) for longer time periods. At the final stage, material is labeled and packaged into country-specific containers and shipped to retail distributors or directly to the consumers.

After certain key production steps, it is common to blast-freeze the intermediate product and store until all quality tests and documentation checks are done before the intermediate product is released for further processing. This also allows strategic flexibility in allocating intermediate product. The allowed shelf life for such blast-frozen intermediates varies based on original validation and licensing.


                        Fig. 2
                         provides additional detail of the planning problem. Triangles represent inventory points; boxes indicate processes. Note that each process stage comprises a number of sub-processes – most notably quality control, which typically takes longer than the production process itself. In the Planning Problem, we define three intermediate products (raw product, purified material, and final container) and three process stages (purification, FFD, and packaging) used to create Finished Goods material meeting customer demand. Inventory points are defined wherever there is intermediate storage of material, i.e. wherever inventory is frozen between process stages.

Product variants, and their associated inventory types are generated whenever an intermediate product undergoes a process that is not qualified for sale in one or more regions of the world. Qualification is typically dependent on the facilities used during the production process, as well as on the parameters of quality resulting from that production process. Product variants are thus generated reflecting both processing decisions made on the product and also quality outcomes from each stage of production.

Biomanufacturing processes are typically reductive, i.e. the fermentation process generates a large amount of material which is refined/combined in future processing stages. As such, blending product variants (i.e. material with different processing histories) is required at each stage of production. Blended material is considered to inherit the processing histories of each input variant – so resulting product variants and routes need to consider all the characteristics of the input material from which it was blended. Note that if material is blended from product variants A and B, and A is licensed in a region while B is not, the resulting blend (‘A&B’) is not licensed in the region.

Processing decisions create inventory types based on how that decision is regulated in each country. For example, each facility must be individually licensed to produce a particular final product for sale in a particular region of the world. One process decision is defined for each stage of the production process that may affect sales of the product in the various regions. Processing options denote the various choices for one process decision. Exactly one processing option must be chosen for each process decision.

For example, one process decision might be the facility used for purification. Processing options would include each possible choice of facility, with one facility chosen for production. We follow the logic that an inventory type is created if and only if the material has a different processing history from all other inventory types.

Material at each stage of production undergoes testing and quality control. (See Fig. 2.) Regulation also exists over these activities, in particular on the range of valid test results which are accepted. Different regions may allow different ranges, creating different inventory types as a result of the quality outcomes for production batches. Given a statistical distribution of test results for actual output material, product variants may result even when all facilities are licensed in all regions.

The technique for tracking multiple process decisions and quality outcomes under regulation at each stage is essentially combinatorial in nature. At each processing step, a unique inventory type is created for each possible combination of process decisions, quality outcomes and input product variants. Thus, if there are two raw material product variants and there are two process decisions at purification, each with three process options, then there are a total of 18 purified material inventory types. Fig. 3
                            shows a simplified partial diagram illustrating the inventory types created in two stages of production. Note that some potential inventory types are not legal, i.e. the decisions made in previous production steps may constrain the processing options which are available in later steps. In addition, some inventory types at finished goods cannot be sold in some regions (based on regulatory restrictions). Also note that the biotechnology manufacturing process requires a complete history to be maintained about all process decisions made, i.e. the process is not Markovian at each processing stage.

An important consequence of the process regulations is that the number of product variants is dynamic, e.g. a new process option may become licensed by the regulatory authority for a particular region before the end of the planning horizon. In this case, constraints are required limiting this inventory type from being sold in that region until the projected time of licensing.

We follow the approach of Leachman et al. in formulating BPP as an event-based model, where the possible epochs for scheduling batch releases are restricted to integer multiples of the production processing times in each of the stages (Dessouky & Leachman, 1994, 1997). As will be discussed, this assumption dramatically reduces the computational difficulties associated with employing a formulation involving a single, uniform time grid structure typical in most approaches to production planning problems. This approach is suitable for the BPP for two reasons. First, it is typically forbidden for two production batches to be simultaneously resident in a processing facility. This is due to the issue of quality control and the possibility of cross-contamination of batches. Even with quality control efforts made at each stage of the production process, it is not known with certainty that a batch is not contaminated. The event-based formulation obviates the need for explicit constraints enforcing this requirement. The chosen time grids conveniently space batches exactly one production cycle time apart, or integer multiples thereof.

Second, the overall process cycle time at each stage is dominated by the time required to perform post-process quality testing on each batch; the processing time (the production portion of the stage cycle time, i.e., when the batch is resident within the manufacturing facility) is small by comparison. Thus, the restriction that this model makes – that a batch may be delayed from starting for as long as one facility processing interval (in the case the facility was idled) – does not significantly affect the total cycle time of a batch from raw material to finished goods. Typical times for facility processing are measured in days, for example purification takes 2 or 3days, while quality control at this stage takes 3–4weeks.


                           Fig. 4
                            illustrates an example of a time grid formulation for two stages of the production process. Two purification facilities (A and B) have time grids of two days and three days respectively. On day 0, purification facility is processing batch B, which is sent to quality control on day 1. On day 5 this batch is released, where it waits for the next available time slot on the FFD facility (day 8). Batch A starts on purification facility A on day 2, is sent to quality control on day 4, and is released on day 8.5. This batch then waits for the next available FFD slot on day 12. (Note that for reasons of space the quality control times are not to scale in this example.)

Time grids are defined for each facility, initialized to reflect current work in process. For example, if there is a batch in process that will leave the facility on day two, then the first possible epoch for starting a new batch in the facility is set to be day two. In addition, this model readily accommodates planned periods where a facility will be unavailable due to maintenance or cleaning – both important considerations – by simply defining the time grid for the facility to reflect these gaps.

The restricted possibilities for batch start times are not as restrictive towards efficient response to given demands as one might initially believe. In solutions to the model, busy facilities are scheduled for continuous processing work, one batch right after another, synchronized with the initial work-in-process. Facilities not required to be run continuously will have their idle times grouped into multiples of the process time. If there is not enough capacity to idle the facility for one process cycle without impairing on-time response to the demands for finished goods, it will be scheduled to run continuously until it becomes feasible for it to be idle for one process cycle. Again, new production in such a facility is scheduled to be synchronized with current work in process.

We make the following assumptions:
                           
                              •
                              
                                 Distinct product variants are defined precisely reflecting the regulatory restrictions on where an intermediate or final product can be sold. Each of these product variants takes the same processing and testing time in each facility.


                                 There is no changeover period required when sequencing batches of different product variants into a facility.


                                 Intermediate product to be fed into a process step can be blended from multiple batches processed through the previous stage. Blending is used to aggregate material between process stages, as each stage of production creates a more concentrated product. Blending is assumed to be linear in output and product only can be blended according to certain predefined criteria.


                                 Continuous amounts of intermediate product can be blended. Typically material is stored in small bags, i.e., in reality discrete units of product must be blended. However the bags are small enough at each processing stage that it is a reasonable approximation to assume continuous blending quantities. In the case of Bayer, over 200 bags of raw product comprise one purification batch, and about 20 bags of purified material comprise one filling and freeze-drying batch.


                                 A single facility can process only one batch at a time. To preclude any possibility of cross-contamination, only one batch is allowed in a facility at a time.


                                 Yield loss is assumed to be constant across batches. Actual process yields exhibit a small variation, in the range of two or three percent. Typically the process yield improves slightly each year. There also is a reject rate for each stage, and, while small, is a more significant source of variability. We develop plans based on constant average reject rates. The risks associated with this assumption are mitigated by requirements for intermediate-product safety stocks maintained within the model.


                                 Processing cycle time is a pre-specified constant for each processing facility. Each batch requires a cycle time independent of the product variant, depending only on the processing facility. While minor time variations may exist amongst the different product variants, this is reasonable planning approximation.


                                 Quality Control cycle time is a pre-specified constant for a specific variant and facility. The time required to validate a batch can take a varying amount of time depending on the exact combination of input material and processing decisions made. However this time is assumed to be constant for planning purposes. To mitigate the uncertainty of QC cycle times, the cycle time parameters in the model are set to reflect a high percentile of the historical statistics for the test and inspection procedures. The intermediate-product safety stock requirements incorporated into the model also mitigate these risks.


                                 There is unlimited intermediate storage between process stages. The cost of product storage is modest compared to the lost revenue if insufficient product is made available; it would be surprising if a bioproduction supply chain were storage-constrained.


                           Processing stage: A series of manufacturing and testing steps performed on a batch that maintains integrity and identity through the series of steps. The stages under consideration are Purification, Filling and Freeze Drying (FFD), and Packaging.


                           Inventory point: Before and after each processing stage are inventory points where output batches from the previous stage may be mixed and allocated to form batches input to the next stage. The inventory points under consideration are raw product (before purification), purified material (between purification and FFD), final container (between FFD and packaging), and finished goods (after Packaging). Batches at each inventory point are classified into inventory types discussed below.


                           Inventory type: A classification of input lots awaiting input to the next processing stage. Inventory types are distinguished only to the extent of where the resulting product may be sold, i.e., we aggregate inventory items that have identical sales opportunities. In the case of finished goods, an inventory type is a demand type, i.e., a particular product sold in a particular region.


                           Wire: A transformation of a valid combination of inventory types blended into a batch input to a processing stage resulting in a specific output inventory type of that stage. There are Purification wires, Filling and Freeze Drying (FFD) wires, and Packaging wires. (The nomenclature reflects a graphical depiction of the product-process structure termed the wiring diagram.) We present a formulation for BPP for the case where each wire has a single output type. It is relatively straightforward to extend the formulation to the case where some wires have distributions of possible output product types depending on quality outcomes (similar to bin splits in semiconductor manufacturing).


                           Route: A valid facility and processing option for a wire. There are Purification routes, FFD routes and Packaging routes. A route specifies a choice of facility for the wire. Data associated with a route include processing and quality-testing cycle times, quantity yields and reject rates. These data may vary by batch-start epoch.


                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             Indices and Sets of Indices
                                          
                                       
                                       
                                          
                                             t
                                          
                                          Continuous time index, t
                                             ⩽
                                             T, where 0 is the start and T is the end of the planning horizon
                                       
                                       
                                          
                                             j
                                          
                                          Inventory point j
                                             =1, … , 4 corresponding to intermediate products (1, 2, 3) and finished goods (4)
                                          
                                       
                                       
                                          
                                             i
                                          
                                          Processing stage i
                                             =0, … , 3 corresponding to fermentation, purification, FFD, and packaging
                                       
                                       
                                          
                                             v
                                          
                                          Index for product variant
                                       
                                       
                                          
                                             w
                                          
                                          Index for processing wire. A wire corresponds to the execution of a single processing stage using specific input products to generate specific output products
                                       
                                       
                                          
                                             m
                                          
                                          Index for input product to a processing wire
                                       
                                       
                                          
                                             n
                                          
                                          Index for output product from a processing wire
                                       
                                       
                                          
                                             f
                                          
                                          Index for processing facility
                                       
                                       
                                          
                                             r
                                          
                                          Index for processing route. A processing route specifies a selection of a processing facility f and all processing options for a given wire w
                                          
                                       
                                       
                                          
                                             q
                                          
                                          Index for safety stock requirement
                                       
                                       
                                          
                                             rε m
                                          
                                          Denotes route r uses product m as input
                                       
                                       
                                          
                                             Si
                                             (t)
                                          Set of valid wires at processing stage i at time t
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         m
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   t
                                                   )
                                                
                                             
                                          
                                          Set of valid wires using product variant m as input at processing stage i at time t
                                          
                                       
                                       
                                          
                                             Qi
                                             
                                          
                                          Set of safety stock requirements at processing stage i
                                          
                                       
                                       
                                          
                                             Vj
                                             
                                          
                                          Set of valid product variants at inventory point j
                                          
                                       
                                       
                                          
                                             Fi
                                             
                                          
                                          Set of processing facilities at processing stage i
                                          
                                       
                                       
                                          
                                             Hq
                                             
                                          
                                          Set of product variants m which can satisfy safety stock requirement q
                                          
                                       
                                       
                                          
                                             Ri
                                             
                                          
                                          Set of valid routes for processing stage i
                                          
                                       
                                       
                                          
                                             
                                          
                                       
                                       
                                          
                                             Variables
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   t
                                                   )
                                                
                                             
                                          
                                          Binary indicator of whether a batch on route r of stage i is started at time t
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         Z
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   t
                                                   )
                                                
                                             
                                          
                                          Quantity of material started on route r of stage i at time t
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         Y
                                                      
                                                      
                                                         mw
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   t
                                                   )
                                                
                                             
                                          
                                          Quantity of material of inventory type m allocated to wire w of stage i at time t (defined only for valid combinations)
                                       
                                       
                                          
                                             bm
                                             (t)
                                          Quantity of finished goods type m backordered at time t
                                          
                                       
                                       
                                          
                                             
                                          
                                       
                                       
                                          
                                             Parameters
                                          
                                       
                                       
                                          
                                             αr
                                             
                                          
                                          Yield of process on route r, i.e. the loss of raw recombinant protein material due to the production process
                                       
                                       
                                          
                                             βr
                                             
                                          
                                          Reject rate of process on route r, i.e. the percentage of batches which are rejected either in production, or in QC testing
                                       
                                       
                                          
                                             δr
                                             
                                          
                                          Conversion factor for route r, i.e. the number of units of output material produced from one unit of input material
                                       
                                       
                                          
                                             γ
                                          
                                          Assumed discount rate, γ
                                             ∊(0,∞)
                                       
                                       
                                          
                                             cr
                                             
                                          
                                          Total cycle time (including both facility cycle time and quality control and quality assurance time) required for a batch passed through route r
                                          
                                       
                                       
                                          
                                             lr
                                             
                                          
                                          Lower bound on batch size at processing facility f on route r
                                          
                                       
                                       
                                          
                                             ur
                                             
                                          
                                          Upper bound on batch size at processing facility f on route r
                                          
                                       
                                       
                                          
                                             θ
                                          
                                          Start quantity of purification material (fixed) per batch
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         I
                                                      
                                                      
                                                         m
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          Initial quantity of inventory “released” (i.e., authorized) for follow-on use at inventory point j of variety m
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         m
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   (
                                                   t
                                                   )
                                                
                                             
                                          
                                          Cumulative supply of inventory at inventory point j of product variety m projected to be released for follow-on use at time t from current work-in-process (WIP).
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         q
                                                      
                                                   
                                                
                                             
                                          
                                          Minimum safety stock level for safety stock requirement q
                                          
                                       
                                       
                                          
                                             Dm
                                             (t)
                                          Cumulative demand for product variant m at time t
                                       
                                       
                                          
                                             Tf
                                             
                                          
                                          Time grid representing possible epochs for batch starts in facility f, typically following multiples of the facility cycle time ω but with gaps allowing for planned shutdowns or other constraints
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          Time grid representing possible epochs for batch starts for a specific route r at a process step i
                                             =0, … , 2 (inherited from the relevant Tf
                                             )
                                       
                                       
                                          
                                             Tm
                                             
                                          
                                          Time grid representing possible epochs at which demand is due for a finished goods product variety m
                                             ∊
                                             V
                                             3
                                          
                                       
                                    
                                 
                              
                           
                        


                              
                                 
                                    
                                       Minimize
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                m
                                                ∈
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      4
                                                   
                                                
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                t
                                                ∈
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      m
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             b
                                          
                                          
                                             m
                                          
                                       
                                       (
                                       t
                                       )
                                       +
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                3
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                t
                                                ∈
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      r
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             1
                                          
                                          
                                             
                                                
                                                   (
                                                   1
                                                   +
                                                   γ
                                                   )
                                                
                                                
                                                   t
                                                
                                             
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       t
                                       )
                                    
                                 
                              We frame the objective as a minimization problem which aims firstly to minimize the number of product-unit-epochs of backordering, thereby pursuing a plan that meets demands as much as is feasible. Secondly, the objective minimizes the discounted number of batch starts which are performed (γ is the assumed discount rate). That is, the second term is a penalty term for batches which are started earlier in the planning horizon than necessary, i.e., we have the objective of starting a batch only when required. This term prevents the model from deciding to process a batch through to finished goods before it is needed, thereby precluding recourse to change inventory allocation at a later planning epoch. Most production planning formulations address our second objective using inventory holding costs; in lieu of the traditional approach, we choose to minimize discounted batch starts in order to economize the size of the time grids in the model (and hence the number of variables).

Note that one batch start fulfills thousands of units of demands, so that our primary concern in the objective function is avoiding backorders, and a secondary concern is avoiding early production. In effect, there is no trade-off between backorders and batch starts; both are minimized. The particular value of the discount rate is arbitrary and not that important; any reasonable interest rate will lead to the same solution. The overall objective value does not have economic meaning; it simply serves to lead us to a production plan with the desired properties.


                              
                                 
                                    (1)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                τ
                                                ⩽
                                                t
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                w
                                                ∈
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                
                                                (
                                                τ
                                                )
                                             
                                          
                                       
                                       
                                          
                                             Y
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ¯
                                                
                                             
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       τ
                                       )
                                       ⩽
                                       
                                          
                                             W
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       t
                                       )
                                       +
                                       
                                          
                                             I
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                       ∀
                                       
                                          
                                             m
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             V
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (2)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                m
                                                ∈
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             Y
                                          
                                          
                                             m
                                             
                                                
                                                   w
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       t
                                       )
                                       =
                                       θ
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       t
                                       )
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                       ∀
                                       
                                          
                                             w
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       t
                                       )
                                    
                                 
                              
                              
                                 
                                    (3)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       t
                                       )
                                       ⩽
                                       1
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             T
                                          
                                          
                                             
                                                
                                                   f
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             f
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             F
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (4)
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             q
                                          
                                       
                                       ⩽
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      q
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      W
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                
                                                (
                                                t
                                                )
                                                +
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         τ
                                                         ⩽
                                                         t
                                                      
                                                   
                                                
                                                
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         w
                                                         ∈
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               
                                                                  
                                                                     m
                                                                  
                                                                  
                                                                     ¯
                                                                  
                                                               
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                         (
                                                         τ
                                                         )
                                                      
                                                   
                                                
                                                
                                                   
                                                      Y
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                      w
                                                   
                                                   
                                                      1
                                                   
                                                
                                                (
                                                τ
                                                )
                                             
                                          
                                       
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      q
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             r
                                          
                                       
                                       ,
                                       
                                       q
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                              Constraint (1) states that for each raw product variety 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          ¯
                                       
                                    
                                 
                              , only inventory available at each time epoch t can be allocated to a purification batch start made at t. Exactly θ units of material must be allocated to each batch start, as this is the required running capacity of purification columns (2). If several routes share the same facility, only one batch can be released at a single time epoch for each facility (3). Finally, a minimum of λq
                               units of safety stock must be reserved at each epoch and not allocated to production (4).


                              
                                 
                                    (5)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                τ
                                                ⩽
                                                t
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                s
                                                ∈
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                (
                                                τ
                                                )
                                             
                                          
                                       
                                       
                                          
                                             Y
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                             s
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       τ
                                       )
                                       ⩽
                                       
                                          
                                             I
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             W
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       t
                                       )
                                       +
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                τ
                                                +
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      r
                                                   
                                                
                                                ⩽
                                                t
                                             
                                          
                                       
                                       θ
                                       
                                          
                                             α
                                          
                                          
                                             r
                                          
                                       
                                       (
                                       1
                                       -
                                       
                                          
                                             β
                                          
                                          
                                             r
                                          
                                       
                                       )
                                       
                                          
                                             δ
                                          
                                          
                                             r
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       τ
                                       )
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                       
                                       ∀
                                       
                                          
                                             n
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (6)
                                    
                                       
                                          
                                             l
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       t
                                       )
                                       ⩽
                                       
                                          
                                             Z
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       t
                                       )
                                       ⩽
                                       
                                          
                                             u
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       t
                                       )
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             T
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                       ∀
                                       
                                          
                                             r
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             R
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (7)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       t
                                       )
                                       ⩽
                                       1
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             T
                                          
                                          
                                             
                                                
                                                   f
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             f
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             F
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (8)
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             q
                                          
                                       
                                       ⩽
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      q
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      W
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                (
                                                t
                                                )
                                                +
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         r
                                                         ∈
                                                         
                                                            
                                                               n
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         τ
                                                         +
                                                         
                                                            
                                                               c
                                                            
                                                            
                                                               r
                                                            
                                                         
                                                         ⩽
                                                         t
                                                      
                                                   
                                                
                                                θ
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      r
                                                   
                                                
                                                (
                                                1
                                                -
                                                
                                                   
                                                      β
                                                   
                                                   
                                                      r
                                                   
                                                
                                                )
                                                
                                                   
                                                      δ
                                                   
                                                   
                                                      r
                                                   
                                                
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      r
                                                   
                                                   
                                                      1
                                                   
                                                
                                                (
                                                τ
                                                )
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         τ
                                                         ⩽
                                                         t
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         s
                                                         ∈
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               
                                                                  
                                                                     n
                                                                  
                                                                  
                                                                     ¯
                                                                  
                                                               
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         (
                                                         τ
                                                         )
                                                      
                                                   
                                                
                                                
                                                   
                                                      Y
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                      s
                                                   
                                                   
                                                      2
                                                   
                                                
                                                (
                                                τ
                                                )
                                             
                                          
                                       
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      q
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                       q
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (9)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                ∈
                                                s
                                             
                                          
                                       
                                       
                                          
                                             Y
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                             s
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       t
                                       )
                                       =
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                r
                                                ∈
                                                s
                                             
                                          
                                       
                                       
                                          
                                             Z
                                          
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       t
                                       )
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                r
                                                ∈
                                                s
                                             
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                       ∀
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       t
                                       )
                                    
                                 
                              Constraint (5) states that the cumulative amount of material allocated to FFD starts must be less than the initial amount of product variety 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ¯
                                       
                                    
                                 
                               at time zero, WIP currently in production, plus purification production of product variety 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ¯
                                       
                                    
                                 
                               at each time period. The amount of material 
                                 
                                    
                                       
                                          Z
                                       
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                    (
                                    t
                                    )
                                 
                               starting production on each route r at each time epoch t is bounded by upper and lower quantities (l, u) reflecting freeze-drying machine characteristics (6 and 9). If several routes share the same facility, only one batch can be released at a single time epoch for each facility (7). Finally, a minimum of λq
                               units of safety stock must be available at each epoch, not allocated to production (8).


                              
                                 
                                    (10)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                τ
                                                ⩽
                                                t
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                s
                                                ∈
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      3
                                                   
                                                
                                                (
                                                τ
                                                )
                                             
                                          
                                       
                                       
                                          
                                             Y
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                             s
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       τ
                                       )
                                       ⩽
                                       
                                          
                                             I
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       +
                                       
                                          
                                             W
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       t
                                       )
                                       +
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                τ
                                                +
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      r
                                                   
                                                
                                                ⩽
                                                t
                                             
                                          
                                       
                                       
                                          
                                             α
                                          
                                          
                                             r
                                          
                                       
                                       (
                                       1
                                       -
                                       
                                          
                                             β
                                          
                                          
                                             r
                                          
                                       
                                       )
                                       
                                          
                                             δ
                                          
                                          
                                             r
                                          
                                       
                                       
                                          
                                             Z
                                          
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       τ
                                       )
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             r
                                          
                                          
                                             3
                                          
                                       
                                       ,
                                       
                                       ∀
                                       
                                          
                                             n
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             V
                                          
                                          
                                             3
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (11)
                                    
                                       
                                          
                                             l
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       t
                                       )
                                       ⩽
                                       
                                          
                                             Z
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       t
                                       )
                                       ⩽
                                       
                                          
                                             u
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       t
                                       )
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             T
                                          
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       ,
                                       
                                       ∀
                                       
                                          
                                             r
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             R
                                          
                                          
                                             3
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (12)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             X
                                          
                                          
                                             r
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       t
                                       )
                                       ⩽
                                       1
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             T
                                          
                                          
                                             
                                                
                                                   f
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             f
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             F
                                          
                                          
                                             3
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (13)
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             q
                                          
                                       
                                       ⩽
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      q
                                                   
                                                   
                                                      3
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      W
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      3
                                                   
                                                
                                                (
                                                t
                                                )
                                                +
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      3
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         r
                                                         ∈
                                                         
                                                            
                                                               n
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         τ
                                                         +
                                                         
                                                            
                                                               c
                                                            
                                                            
                                                               r
                                                            
                                                         
                                                         ⩽
                                                         t
                                                      
                                                   
                                                
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      r
                                                   
                                                
                                                (
                                                1
                                                -
                                                
                                                   
                                                      β
                                                   
                                                   
                                                      r
                                                   
                                                
                                                )
                                                
                                                   
                                                      δ
                                                   
                                                   
                                                      r
                                                   
                                                
                                                
                                                   
                                                      Z
                                                   
                                                   
                                                      r
                                                   
                                                   
                                                      2
                                                   
                                                
                                                (
                                                τ
                                                )
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         τ
                                                         ⩽
                                                         t
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         s
                                                         ∈
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               
                                                                  
                                                                     n
                                                                  
                                                                  
                                                                     ¯
                                                                  
                                                               
                                                            
                                                            
                                                               3
                                                            
                                                         
                                                         (
                                                         τ
                                                         )
                                                      
                                                   
                                                
                                                
                                                   
                                                      Y
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                      s
                                                   
                                                   
                                                      3
                                                   
                                                
                                                (
                                                τ
                                                )
                                             
                                          
                                       
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      q
                                                   
                                                   
                                                      3
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             r
                                          
                                          
                                             3
                                          
                                       
                                       ,
                                       
                                       q
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             3
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (14)
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                ∈
                                                s
                                             
                                          
                                       
                                       
                                          
                                             Y
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                             s
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       t
                                       )
                                       =
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                r
                                                ∈
                                                s
                                             
                                          
                                       
                                       
                                          
                                             Z
                                          
                                          
                                             r
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       t
                                       )
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             
                                                ∪
                                             
                                             
                                                r
                                                ∈
                                                s
                                             
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             r
                                          
                                          
                                             3
                                          
                                       
                                       ,
                                       
                                       ∀
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       t
                                       )
                                    
                                 
                              Constraint (10) states that the cumulative amount of material allocated to FFD starts must be less than the initial amount of product 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ¯
                                       
                                    
                                 
                               at time zero, WIP currently in production, plus FFD output of product variant 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ¯
                                       
                                    
                                 
                               at each time epoch. The amount of material 
                                 
                                    
                                       
                                          Z
                                       
                                       
                                          r
                                       
                                       
                                          3
                                       
                                    
                                    (
                                    t
                                    )
                                 
                               starting production on each route r at each time epoch t is bounded by upper and lower quantities (l, u) reflecting the capacities of the packaging facilities (11) and (14). If several routes share the same facility, only one batch can be released at a single time period for each facility (12). Finally, a minimum of λq
                               units of safety stock must be available at each epoch, not allocated to production (13).


                              
                                 
                                    (15)
                                    
                                       
                                          
                                             I
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             4
                                          
                                       
                                       +
                                       
                                          
                                             W
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             4
                                          
                                       
                                       (
                                       t
                                       )
                                       +
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                r
                                                ∈
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                τ
                                                +
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      r
                                                   
                                                
                                                ⩽
                                                t
                                             
                                          
                                       
                                       
                                          
                                             α
                                          
                                          
                                             r
                                          
                                       
                                       (
                                       1
                                       -
                                       
                                          
                                             β
                                          
                                          
                                             r
                                          
                                       
                                       )
                                       
                                          
                                             δ
                                          
                                          
                                             r
                                          
                                       
                                       
                                          
                                             Z
                                          
                                          
                                             r
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       τ
                                       )
                                       -
                                       
                                          
                                             b
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       (
                                       t
                                       )
                                       ⩾
                                       
                                          
                                             D
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       (
                                       t
                                       )
                                       
                                       
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             T
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       ,
                                       
                                       ∀
                                       
                                          
                                             n
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             V
                                          
                                          
                                             4
                                          
                                       
                                    
                                 
                              Constraint (15) states that cumulative demand at each demand epoch for product 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ¯
                                       
                                    
                                 
                               must be met either by initial inventory, projected output from WIP, new production, or by backordering.


                              
                                 
                                    
                                       
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   t
                                                   )
                                                   ⩾
                                                   0
                                                   ,
                                                   
                                                   
                                                   binary
                                                   
                                                   ∀
                                                   r
                                                   ∈
                                                   
                                                      
                                                         R
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                   ∀
                                                   t
                                                   ∈
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                   i
                                                   =
                                                   1
                                                   ,
                                                   2
                                                   ,
                                                   3
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         Y
                                                      
                                                      
                                                         mw
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   t
                                                   )
                                                   ⩾
                                                   0
                                                   
                                                   
                                                   ∀
                                                   w
                                                   ,
                                                   
                                                   ∀
                                                   m
                                                   ∈
                                                   w
                                                   ,
                                                   
                                                   ∀
                                                   t
                                                   ∈
                                                   
                                                      
                                                         
                                                            ∪
                                                         
                                                         
                                                            r
                                                            ∈
                                                            w
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                   i
                                                   =
                                                   1
                                                   ,
                                                   2
                                                   ,
                                                   3
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         Z
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   t
                                                   )
                                                   ⩾
                                                   0
                                                   
                                                   
                                                   ∀
                                                   r
                                                   ∈
                                                   
                                                      
                                                         R
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                   ∀
                                                   t
                                                   ∈
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                   i
                                                   =
                                                   2
                                                   ,
                                                   3
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The time grid formulation adapted from Leachman et al. restricts the domain for batch starts to a discrete time grid Tf
                            based on the cycle time of the particular facility f. This contrasts with previous approaches to time discretization such as Hackman and Leachman (1989), Pinto and Grossman (1998), Kondili, Pantelides, and Sargent (1993), Gaglioppa et al. (2008), Kopanosa, Méndezb, and Puigjaner (2010) and Stefanssona, Sigmarsdottirb, Jenssonb, and Shahc (2011). Under these approaches, the BPP formulation would include a large number of stage-dependent variables for each inventory type m, resulting in a very large number of possible combinations of products to be considered. These formulations are practical only for much smaller problems than the one we consider.

Product mixing, i.e., or blending of batches of different inventory types, occurs at each stage of the problem and is represented by wires w which define valid combinations of mixes, and associated allocation variables Y. As discussed above, one issue in BPP concerns the mixing of product which is licensed in all regions, with material that is restricted in one or more regions. The output material can only be sold in regions within the intersection of licensed regions for input materials, because the licensed material is considered to be ‘contaminated’ by unlicensed material.

The formulation presented above inherently precludes unwise material mixing because it is based on a wiring diagram defined so as to account for the complete history of batch characteristics in establishing the unique identifier for each inventory type m. (Refer to Section 2.2, Enumeration of Product Varieties, for additional details.)

Process characteristics, i.e., yield αr
                           , reject rate βr
                            and conversion factor δr
                           , as well as certain stage parameters, i.e., release cycle time cr
                            and upper and lower capacities (ur
                           , lr
                           ) need to reflect the history of processing decisions performed on the material as reflected in the inventory type m as well as the type of material being produced n. This is a requirement in BPP for a number of reasons.

First, processing decisions made in early stages of the manufacturing process have considerable impact on the processing characteristics of later stages. For example, in the fermentation process cells are cultured from a single master working cell bank. This cell bank provides the source material which is scaled up in later stages of production, but cell banks can only provide a limited amount of material after which another cell bank is needed. Changing cell banks happens infrequently but this change is likely to have an effect on product quality at every stage of production, even though this processing decision is made in the first stage (fermentation).

Second, distinct inventory types m and n have differences in process procedures or equipment. These differences are likely to engender different processing characteristics such as better yields or lower reject rates. Thus the model enables planners to incorporate the projected impact of process improvements into production plans.

Third, biotechnology manufacture is subject to high variability in quality due partly to the inherent process variability when dealing with biologics, but partly to the combinatorial effect of process changes. The level of detail in the model allows the incorporation of empirical information about past throughput rates and other quality information, allowing planners to make more sophisticated and robust estimates of key processing parameters.

In this model, information about processing characteristics is specific to the route variable r, rather than being based solely on the incoming material type. Such characteristics include the cycle time of quality control as well as yields, reject rates and conversion factors. Planned or projected process improvements can be incorporated into the model by making these parameters vary by epoch. For example, if planners expect that the current cycle time of 30days at QA will be improved to 25days in 6months, the release cycle time cr
                            parameters for batch starts at the various epochs can be set so as to reflect this assumption.

One of the central issues for BPP is the requirement to carry large safety stocks to hedge against production failures. Most biotechnology companies produce life-preserving medicines that imply very high backordering costs, since patients may die if they do not have continuous access to treatment. Failures to meet end-customer demand are to be avoided if at all possible.

As such, regulatory agencies typically mandate large safety stocks of finished goods material in cases where patients may be at risk – up to 180days of material may be mandated. Most biotech companies also carry significant safety stocks at earlier intermediate production stages because of the (relatively) high probability of batch failures. As such it is typically not possible to operate biomanufacturing plants in a truly ‘lean’ manner.

Safety stocks are represented in BPP by means of a number of constraints, each involving a number of inventory types Hq
                           . At each epoch, each constraint q enforces a minimum stock level λq
                            on the sum of available material for all inventory types in a set Hq
                           . This constraint allows, for example, a generic safety stock to be imposed on all material at a process stage but also allows safety stocks for individual processes undergoing approval. This allows planners to specify a higher safety stock level for new processes, for example a new master working cell bank which might have higher inherent process variability than an existing cell bank with well-understood performance characteristics. This is a powerful feature of our model that offers sophisticated control on production planning scenarios for the planners.

The BPP model of Section 2 is embedded in what we term a Planning Engine, a database and optimization application for biotechnology supply chain planning implemented at Bayer Healthcare’s Berkeley, CA manufacturing site. This facility is – like many biomanufacturing facilities – dedicated to the production of a single product type: Kogenate, a recombinant Factor VIII drug used in the treatment of hemophilia. The goal of Bayer’s project to develop and implement the Planning Engine was to provide the means to routinely generate short- and medium-term schedules and plans for each production area that would enable the company to optimally utilize existing capacity while manufacturing the correct batch types to meet demand. For medium-term planning, Bayer needed a tool for their global supply chain group which would enable them to plan production batches to meet worldwide demand over a one-year or longer planning horizon.

Of critical concern to the company were the impacts of regulations on product supply. While the calculations of an existing MRP system provided gross mass-balance calculations of material requirements to meet demand, these calculations did not take into account restrictions on allocations of products due to regulation. Given that over 80% of the product produced at the Berkeley plant was subject to some kind of regulatory constraints on market suitability, the MRP output was inevitably inconsistent with what supply chain planners and schedulers knew was required. As a result, Bayer planners had to undertake a time-consuming manual planning process analyzing each and every batch for the processing decisions made about that batch, in order to determine where the batch could be sold. This was a significant workload, hindering the ability of the supply chain planning group to react promptly to changes in in the timing of regulatory approvals, unfavorable outcomes of quality testing, facility outages, increased demands or decreased raw material supplies.

This issue was compounded by the dynamics of the constraints. As some plant changes were being approved by some regions, additional changes were being introduced that placed material under new restrictions. Approval timelines were continually changing as the various regulatory agencies delayed (or advanced) their approvals for Bayer’s submissions. The cumulative effect of these factors was to make it exceedingly difficult to wisely and swiftly re-plan the supply chain in the face of such turbulence in the input data.

The solution was to develop a centralized, automated planning system replacing multiple Excel-based manual planning efforts. The vision of the project was to integrate all the required information on existing inventories and work-in-process characteristics, regulatory approval timelines, and global product supply and demand data through a single unified interface to the Planning Engine, which would provide planners with a set of optimal plans based on the model presented in Section 2. It would facilitate ‘what-if’ analyses of any number of different scenarios confronting the Bayer planners. The tool would provide a means for Bayer to react optimally to regulatory issues and unforeseen changes in demand or supply in a shortened timeframe of hours rather than days or weeks.

The Planning Engine data structures are built on an enterprise-class Oracle database. This database stores:
                           
                              •
                              
                                 Batch information: Current batches in work-in-process or inventory, and their batch characteristics


                                 Scenarios: ‘what-if’ analyses as well as the current state of the supply chain


                                 Regulatory restrictions and projected approval dates


                                 Planning parameters: Cycle times, yields, reject rates, safety stock levels, capacities, planning horizon and other planning parameters


                                 Demand and supply data: demand data by region and product type for the planning horizon, and supply of raw product via fermentation campaigns


                                 Production plans (engine output): optimal batch starts, product mixes, and planning run statistics

The Planning Engine is designed to accept raw input data from a number of disparate databases across the Bayer site, and parse this information into a set of tables which summarizes the current state of inventory and production. A three-tier approach is utilized for storing batch information. Raw product data is uploaded to the Planning Engine database on a nightly basis. This includes current WIP and inventory, process orders currently being executed, historical stock movements and QA and testing information on each batch (refer to Fig. 5
                            for details).

This information is then parsed for consistency and checked for data errors or missing data. Batches, inventory, or facilities with errors are excluded from the planning process. The result is a set of inventory and production data which is known to be consistent and accurate.

As discussed above, proper allocation of a batch requires knowledge of all regulatory constraints affecting it. This includes all the constituent batches of the batch – the batch ‘genealogy’. These characteristics change over time as existing processing options are approved and new processing options come under scrutiny.

The data schema of the Planning Engine is designed to accommodate such changes by dynamically mapping raw data to parsed batch characteristics (refer to Fig. 4 – ‘Logic layer’). Multiple database sources and database tables are used to develop the batch characteristics for the Planning Engine at run time. The mapping is provided by supply chain users rather than being hard-coded into the system, thereby facilitating the incorporation of future information requirements.

While the focus for the Planning Engine is on those batch characteristics which are not approved in every region, other batch characteristics may provide additional information which can be used to define the processing characteristics of a batch. The interface enables options for data requirements on each characteristic: the data could be (a) required, (b) required only once the batch has been released from quality control and can be used for production, or (c) not specifically required. This allows planners flexibility in importing characteristics to the model without waiting for completeness of data.

The Planning Engine is based around the generation and optimization of scenarios. Each scenario is considered to be a unique ‘what-if’ state of the world, which can reflect business objectives, beliefs about future events or reactions to current issues. Each scenario stored in the Planning Engine is based on an existing scenario (a ‘parent’) but may include differences in regulatory constraints and approval dates, current inventory levels, production characteristics, safety stock levels, facility schedules, demand levels, and system defaults. Scenarios can be added at will by supply chain staff to reflect business needs.

A master scenario is used to define the current ‘best estimate’ of the state of the production, as compared to various ‘what-if’ scenarios. This master scenario is the default production scenario which is considered by Planning Engine users, and is re-optimized automatically to provide latest production data on a nightly basis.

By default, all scenarios use the latest daily updates of production and inventory data which are downloaded on a nightly basis to generate a rolling production forecast of user defined length. End-users can archive scenario information so that it can maintain an accurate record of the state of events on a certain date. Scenario archiving maintains a separate copy of production and inventory data and the state of regulatory affairs, as well as the optimal production schedule, on a certain date.

Finally, a technique called scenario cascading is used to update scenario information. Since scenarios are often related to one another, they are stored in terms of a scenario tree. Fig. 6
                            shows an example of this tree. Changes to any parent scenario, such as ‘FFD shutdown’ affect not just that scenario but any of its children (‘High Demand’ and ‘Expected Demand’).

Bayer’s approach to planning under regulatory restrictions is to produce a set of rules termed ‘product holds’ that restrict the sales of batches with certain characteristics to one or more markets. Each product hold typically includes a date from which the rule applies, a date from which the rule is no longer active (i.e. when the restriction will be lifted), the rule itself (which may affect one or more batch characteristics), and one or more finished goods inventory types which are affected. Each of these rules varies over time, and the combination of all of these rules defines the valid combinations of inventory types which need to be considered.

The approach taken was to allow users to input the data listed above via the Planning Engine User Interface, and then to use these data to generate a list of valid paths through the system. The set of valid paths, termed the wiring diagram, lists every combination of valid batch characteristics with a finished goods product, with a date range during which this set of batch characteristics can be sold as a finished goods product. These data sets can then be used to quickly generate the set of valid combinations of intermediate products m, wires w and routes r.

Demand data provides a set of demands for finished goods products, which are used to drive both production and to define the wiring diagram presented in Section 3.1.4. The demand input to the Planning Engine is the outcome of what Bayer terms its S&OP (Sales and Operational Planning) process. Demand is typically specified at the end of each month, but the data structures in the BPP model allow any demand date to be entered. Demand which cannot be met in a period is backordered incurring a cost b per unit per period (which is much greater than the cost of production).

Bayer facility in Berkeley utilizes continuous perfusion technology for fermentation (as opposed to batch fermentation). A module was designed to automate the process of planning fermentation campaigns. Raw (fermented) material is drawn each day of this campaign, but the operating characteristics of the fermenter – inoculation, ramp-up, and the growth impurities – mean that each day varying quantities of material are available to the downstream supply chain.

The Planning Engine incorporates a module capturing the key aspects of fermenter scale-up and operating parameters to automate the process of campaign planning. This model produces a set of standardized outputs for a new campaign, but allowed planners to track the progress of campaigns and alter the outputs on a weekly basis to re-calibrate for actual fermenter performance. The actual-to-date and projected output of the fermenter then becomes input data for the planning model described in Section 2.

One of the key issues for supply chain planners was the integration of the Planning Engine with the existing MRP tools used onsite. The Planning Engine design is based around managing only what we term the ‘central supply chain’, i.e., processed materials which eventually become the finished goods sold to customers. The manufacture of biopharmaceuticals is distinct from the general process manufacturing industry in that there is one product in each stage of production (refer Fig. 2) rather than a number of constituent ingredients which must all be considered. Complexity arises from the variants or ‘flavors’ of product discussed in Section 2. These product variants were not addressed well by Bayer’s MRP tools which assume fixed recipes for production and tacitly assume an unchanging regulatory environment.

A natural delineation of responsibilities in Bayer’s case is to use the Planning Engine for planning inventory in the central supply chain while utilizing existing MRP tools for all other items, such as chemicals and other consumables used in production. The Planning Engine database therefore stores the set of manufacturing part numbers which are considered to be within the scope of the central supply chain. The interface allows supply chain planners to add new material numbers as may be required.

The Planning Engine also aligns the batch starts with confirmed planned orders and open process orders in the MRP system, thereby precluding any conflict between near-term batch starts proposed by the Planning Engine and process orders already established in MRP.

The Planning Engine is interfaced to the CPLEX commercial optimization software licensed from ILOG (CPLEX Optimization, 1995). Planning problems are solved only up to the first feasible integer solution with an optimality gap of one percent or less. To date we have employed only relatively modest software and hardware resources (CPLEX Version 9.0, Intel Pentium IV CPU with 2.0GB of RAM).


                     Table 1
                      shows the number of routes, wires, variables and constraints on Bayer data as the planning horizon is extended from 182 to 395days. (PUR corresponds to purification, PKG to packaging stages.) Note that a large set of additional wires corresponding to additional processing options become active between 243 and 274days into the horizon. This increases the dimensions of the problem by a factor of three (see Table 2
                     ).

The overall run-time of the Planning Engine may be decomposed into steps for writing the input data, setting up the facility time grids and formulating the model, and solving the model. Fig. 2 shows times required in seconds to perform these three steps. Also shown are statistics on the numbers of variables and constraints in the model. The problem size does not grow linearly with the time horizon because of new facilities coming on line in later phases of the planning horizon, and the anticipated regulatory constraints on those facilities.

As can be seen, a 395-day horizon resulted in a problem with more than 27,000 boolean variables, more than 130,000 linear variables and more than 80,000 constraints, yet total formulation and solution time is less than three hours. That is, the Bayer planning problems result in extremely large formulations of the model in Section 2 that are surprisingly easy to solve. We believe this is primarily due to our judicious choice of distinct batch-start-epoch time grids for each facility, leading to the unitary capacity constraints (3), (7), and (12). When solving the linear programming relaxation of the model, variables tend to be pivoted up to capacity, i.e., an amount exactly equal to one batch. Solutions to the relaxation of the model therefore tend to be strongly integer in the batch-start variables, reducing the effort required to branch and find integer solutions to the original model. Another important contributor to the relatively short solution time is the ability to direct the branching search in CPLEX. For facilities anticipated to have high utilization, we direct branching to first explore values equal to unity for the Boolean start variables for routes using that facility.

In actual practice, Bayer Planners make multiple planning calculations daily, developing plans for varying assumptions about important parameters such as dates for projected regulatory approvals. Typically, a 365-day horizon is adopted in planning scenarios.

The initial success of the optimization-based Planning Engine at Bayer prompted plans for further research and development. Improvements in user interfaces, on-line help and increased integration with other Bayer systems are underway at the time of this writing. The formulation of Section 2 is not generalized to admit multiple quality outcomes of a single process route. This generalization is desired and is being pursued. This increases the problem dimensions, and so improved computer hardware resources likely will be required. Efforts to improve the optimization speed also are desired to cope with the growing size of the planning problem.

A general line of follow-on research concerns how to address the risks and uncertainties in biopharmaceutical manufacturing. The general aim is as follows: How does one most efficiently develop production plans providing a high, pre-specified confidence level for demand satisfaction at least manufacturing cost? Some parameters describing uncertainties are continuous, e.g., cycle times and yields. In particular, plans need to be robust against QC/QA cycle time distributions that may have very long tails. See Fig. 7
                      for an example distribution. We seek to determine how to set safety stock and cycle time parameters used to generate production plans so as to best cope with such uncertainty.

Other uncertain planning parameters are discrete, e.g., probabilities of batch or campaign rejection, and possibilities for delays in regulatory approvals. In particular, one-month or two-month delays in securing regulatory approval can cause major changes to the problem’s wiring diagram and major changes in required production. This suggests that scenario analysis is required to cope with such uncertain, high-impact discrete parameters.

@&#ACKNOWLEDGMENTS@&#

This research was supported by a grant to the University of California at Berkeley from Bayer Healthcare. The leadership of Messrs. Thomas Panzer and Prasad Saraph in the Bayer Planning Engine project is gratefully acknowledged by the authors. This research was partially supported by National Science Foundation [Grants CMMI 1068862 and CMMI 1265671]; and the National Science Foundation of China [Grant 71332005].

@&#REFERENCES@&#

