@&#MAIN-TITLE@&#Soft computing approach to 3D lung nodule segmentation in CT

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           We propose a multistage algorithm for 3D lung nodule segmentation.


                        
                        
                           
                           Soft computing: evolutionary computation and fuzzy connectedness is employed.


                        
                        
                           
                           The system is designed to extract various types of lung nodules.


                        
                        
                           
                           Two LIDC datasets with over 500 nodules have been employed for evaluation.


                        
                        
                           
                           A comprehensive efficiency analysis with original metrics has been proposed.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Computer-aided diagnosis

Lung nodule

Segmentation

Soft computing

Fuzzy connectedness

Evolutionary computation

@&#ABSTRACT@&#


               
               
                  This paper presents a novel, multilevel approach to the segmentation of various types of pulmonary nodules in computed tomography studies. It is based on two branches of computational intelligence: the fuzzy connectedness (FC) and the evolutionary computation. First, the image and auxiliary data are prepared for the 3D FC analysis during the first stage of an algorithm – the masks generation. Its main goal is to process some specific types of nodules connected to the pleura or vessels. It consists of some basic image processing operations as well as dedicated routines for the specific cases of nodules. The evolutionary computation is performed on the image and seed points in order to shorten the FC analysis and improve its accuracy. After the FC application, the remaining vessels are removed during the postprocessing stage. The method has been validated using the first dataset of studies acquired and described by the Lung Image Database Consortium (LIDC) and by its latest release – the LIDC–IDRI (Image Database Resource Initiative) database.
               
            

@&#INTRODUCTION@&#

Lung nodules are sometimes assessed routinely in clinical practice. The diagnosis is usually based on computed tomography (CT) data. Although many studies have already been published, the delineation remains still a difficult task for the radiologist. Since the lung nodule delineation is time consuming and highly dependent on the observer experience, an application software for automatic measurement is desired.

Since 1980s many attempts have been done to develop a system for the lung nodules (LN) detection, segmentation, and measurement. As the appearance of particular types of nodules in CT scans may vary depending on their type, malignancy, size, shape, solidity, density, and location, the segmentation and especially detection tasks are challenging and demand advanced, often multilevel methodologies, handling particular problems.

Early works by Kostis, Reeves et al. present effective, geometrically driven ways to separate the nodules attached to the pleura by either common surface or a thin tail, as parts of wider methodologies [1,2]. One approach is the morphological processing with structuring elements of changing size, leading to the removal of nodule-attached structures [1]. The other one implements template functions [2]. Then, adaptive thresholding and geometric constraints are employed to delineate the nodule. A more effective approach dedicated to the juxtapleural nodules based on a cutting plane roughly inserted in between the nodule and pleura and iteratively moved into an optimal location [2]. It might be noticed that a rule-based inference system is used there to estimate and track the growth of a nodule in subsequent CT studies.

The use of specific geometrical constraints is a common feature in pulmonary nodules’ segmentation methodologies. Okada et al. rely on an ellipsoid model of a nodule, as a specific type of a “blob”-like structure object to be segmented [3]. A robust anisotropic Gaussian fitting produces a probabilistic model. At the second stage, the nodule is extracted from the background by means of a likelihood ratio test with spatial and intensity constraints. The morphological operations play a crucial role in the work of Kuhnigk et al., where the basic region growing segmentation is followed by procedures leading to the separation of chest wall and vasculature via the assumption of the nodule convex shape and adaptive optimal erosion strength determination using a distance transformation [4]. Way et al. incorporated 3D active contours to establish the nodule surface [5]. It is done within the manually selected Volume of Interest (VOI), preprocessed by the k-means clustering. A dimensionality reduction has been employed by Wang et al., as the VOI around the nodule is transformed into a 2D image by a spiral-scanning technique [6]. As a result, the nodule surface becomes a curve, detected using a graph search via dynamic programming, and finally back-transformed into a volumetric space. A supervised segmentation methodology, based on multithreshold image representation and geodesic distance between nodule voxels preceded by anisotropic diffusive filtering has been proposed by Diciotti et al. [7,8]. Lu et al. employ the interactive edge-driven methodology using the Live-Wire algorithm [9,10]. Chen et al. [11] applied the integrated active contour model driven by fuzzy speed function and shape-intensity joint Bhattacharya distance in order to extract and separate nodules from attached vessels. A genetic algorithm has been introduced by de Carvalho Filho et al. [12] for nodule model generation. Individuals׳ genotypes refer to shape and texture features extracted from candidate nodules obtained via quality threshold clustering segmentation. The model is validated and classified using support vector machine (SVM).

The methodology similar to ours in terms of the fuzzy connectedness-based region growing approach has been proposed by Dehmeshki et al. [13]. Based on manually indicated seed point, the local segmentation along with morphological corrections yields binary masks, subjected to the fuzzy connectedness analysis and, furthermore, sphericity-oriented region growing. Kubota et al. focused on the effectiveness of nontrivial nodule cases segmentation (especially low-density, juxtapleural and vascularized) [14]. Their approach takes advantage of the nodule convexity assumption and employs the distance transformation to extract the nodule core and subsequently its surface, separated from attached structures. The evaluation is based on the LIDC first dataset employed as well as a testing set in our work, moreover, it contains a detailed analysis and comparison of previously published LIDC-tested methodologies. Their segmentation overlap measure s
                     0 (Jaccard index), ranging from 0.51 to 0.66, achieves 0.69 in [14]. This analysis is extended in Section 3.

Practically all “state of the art” papers mentioned above focus on the nodule segmentation problem rather than on an automated detection. It is more effective and less time consuming to obtain a seed or VOI in the form of a “point click”, than to rely on automatically indicated nodule candidates. Several studies have focused on pulmonary nodule automated detection [15–19], yet the detection rate remains not applicable in clinical practice, as the developed methods still feature high false positive rate, that ranges between 4.4 and 10.3fpps (false positives per study); Wiemker et al. reported a less-than-1fpps value with the nodule size being at least 4mm [16,17].

In this study, we introduce an approach that requires a “point click” to identify and mark each nodule. The selected voxel serves as a seed point for the 3D delineation procedure developed in this study. Our method combines the segmentation based on a multilevel approach with additional problem dependent procedures that separate the lung nodule from other structures of similar density attached to it, i.e. pleural wall or vessels. The non-solid low-density nodules are also taken into consideration and segmented. The methodology is based on a fuzzy connectedness approach with a soft computing stage incorporated in order to multiply the number of seeds and make the analysis more robust. The innovative approach to the 3D lung nodule segmentation discussed in this paper might be found in: (1) heuristic multiplication of seed points for a fuzzy connectedness analysis, (2) employment of a specific evolutionary computation into volumetric image processing, (3) modification of the relative fuzzy connectedness approach in terms of efficient algorithm termination with multiple background seed points. Moreover, a multipath workflow enables various types of nodules (well circumscribed, vascularized, pleura-connected, and low-density lesions) to be processed. The evaluation is based on 23 nodules from the first LIDC dataset and 551 cases included in the LIDC–IDRI database.

The paper is organized as follows. Section 2 introduces the methodology and shows examples of its implementation. Section 3 offers the evaluation results matching the detection rate obtained by various combinations of the processing phases. Section 4 contributes the main conclusion of the study.

@&#METHOD@&#

Several phases have been developed in order to yield the lung nodule separated from other tissue (Fig. 1
                     ). First, the binary mask generation is performed with functions related to some predefined types of nodules. Then, two sets of seed points are automatically generated and distributed throughout the mask. Next, the FC-based contextual analysis takes place. Finally, the false positive vascular structure is removed during the postprocessing stage.

Input data for the automated part of the method consist of two seed points per each nodule: one inside the nodule object: 
                        o
                        =
                        (
                        
                           
                              o
                           
                           
                              x
                           
                        
                        ,
                        
                           
                              o
                           
                           
                              y
                           
                        
                        ,
                        
                           
                              o
                           
                           
                              z
                           
                        
                        )
                     , the other one inside the lung parenchyma: 
                        b
                        =
                        (
                        
                           
                              b
                           
                           
                              x
                           
                        
                        ,
                        
                           
                              b
                           
                           
                              y
                           
                        
                        ,
                        
                           
                              b
                           
                           
                              z
                           
                        
                        )
                     . Note, that o should be indicated manually, yet b might easily be found automatically as a low density point within the lungs. Although several nodules might be marked this way, each one is processed independently, with its own o and b seeds. The o
                     
                        z
                     th slice containing both seeds is called a seed slice.

The masks generation stage stands for the first, “rough” segmentation phase. Its goal is to separate the nodule and pleura by creating two binary masks:
                           
                              •
                              
                                 M
                                 
                                    n
                                  – nodule mask, offers a primary segmentation result,


                                 M
                                 
                                    a
                                  – background mask, that marks the lung neighborhood.

Depending on the nodule type [1], the separation is performed following a multipath scheme (Fig. 2
                        ). Some nodules are easy to extract, as they do not adhere to the pleura or their vasculature is visible in CT scans (type I, well circumscribed nodule). If the connected vessel of a similar to the lung nodule intensity is noticeable, then the nodule is called vascularized (type II); in this case, however, the segmentation is mainly performed at the postprocessing stage. Any link between the nodule and the pleural wall requires a cutoff function for a thin pleura tail (type III – pleural tail) or a slice-by slice lung edge reconstruction when the common edge length is comparable with the nodule size (type IV – juxtapleural nodule). A detailed presentation of the processing steps is given below.

The CT volume I is first binarized using the Otsu thresholding [20], yielding a binary volume I
                           
                              Otsu
                           . The Otsu thresholding is an initial processing tool that enables rough distinction between the nodule and surrounding regions and guides further analysis. There are two classes in I
                           
                              Otsu
                           : “white” object, and “black” background. The former contains mediastinum, diaphragm, bones, skin, pleura, vasculature etc.; the latter – lung parenchyma, airways, the patient background. In rare cases, when the pulmonary nodule region does not belong to the object (
                              
                                 
                                    I
                                 
                                 
                                    Otsu
                                 
                              
                              (
                              o
                              )
                              =
                              0
                           ), further preprocessing operations are not performed and the nodule is considered as a low-density (non-solid) nodule (first right branch in Fig. 2). M
                           
                              n
                            becomes empty and M
                           
                              a
                            corresponds to the connected component l
                           
                              a
                            within I
                           
                              Otsu
                            with the largest number of voxels; the segmentation relies on the fuzzy connectedness analysis only (Section 2.3). Otherwise (
                              
                                 
                                    I
                                 
                                 
                                    Otsu
                                 
                              
                              (
                              o
                              )
                              =
                              1
                           ), the thresholded volume is subjected to a connectivity analysis.

Connectivity analysis enables, if possible, separation of the nodule object from other tissues. It is performed on I
                           
                              Otsu
                            in two steps:
                              
                                 1.
                                 First, in 3D mode: if the 3D, 26-connected component indicated by a seed point o is distinct from component with the largest number of voxels, containing bone and soft tissue (including pleura) regions surrounding the lungs (Fig. 3a), then the separation is completed. Such a case denotes well-circumscribed or vascularized nodule.

If the 3D connectivity analysis fails, then the nodule is somehow connected to pleura (type III or IV) and a slice-by-slice separation is indispensable. It is done on each slice, starting from the seed slice, in both directions. The 2D connectivity analysis uses a concept similar to the 3D approach, yet with 8-connected components. Each successful separation of a 2D nodule object from the “lungs-background” component of the largest area completes the masks generation stage for the current slice. This happens often in many slices of pleural tail nodule cases (Fig. 3b). Otherwise, the tail-breaking is required (Fig. 3b, arrow-indicated slices).

Separation is based on morphological operations [21]. First, erosion is performed on a binary slice (Fig. 4
                           a), with a small disk (2-mm in diameter) as a structuring element. If the connection is thin and the nodule region is large enough to “survive” the erosion, then at least two 8-connected components remain (Fig. 4b). If so, then the proper one is chosen as a nodule candidate. It is then dilated to restore the eroded regions (Fig. 4c) and corrected to join possible small groups of pixels, that may “levitate” around an object as a result of the erosion–dilation combination (Fig. 4d). That establishes the current slice of M
                           
                              n
                            and M
                           
                              a
                            (Fig. 4e). If the separation is unsuccessful, the nodule is treated as juxtapleural and passed to the final separation step.

A 5×5cm region of interest (ROI) is extracted from the current slice of I
                           
                              Otsu
                           , around the expected nodule location (Fig. 5
                           a). Its inner boundary stands for the lung edge, with natural convexity interfered by the nodule shape (Fig. 5b, white line). The ROI-boundary pixels are connected by a chord (Fig. 5b, gray line). The chord is successively thicken towards the edge by appending a single line (note arrows in Fig. 5b). An auxiliary accumulator image A is used to reconstruct the healthy lung edge. It is initiated with zeros with the exception of lung edge pixels, assigned to ones. The chord is successively thickened towards the edge by appending a single line (note arrows in Fig. 5b). Movement direction is determined by the central point for the nodule object. Each thickening influences the accumulator image A, by tracking the 8-connected objects present in an intersection of the lung edge and the thickened chord:
                              
                                 •
                                 if there are two objects, what correspond to the starting position in a left case of Fig. 5b, then each object is adjacent to one of the edge endings; no modifications are made in A;

if there are more than two such objects (e.g. a starting position in a right case of Fig. 5b), then all pixels of all objects not connected to the ROI boundaries have their accumulated values in A incremented by 1; that indicates all local deformations of the lung edge, particularly caused by the nodule;

if there is only one object in an intersection, then the entire edge is covered by a thick chord and the thickening algorithm terminates with no changes made in A.

If there is no lesion at the inner edge, the entire separation stage terminates at current slice.

Whenever a nonempty slice of M
                           
                              n
                            (except seed slice o
                           
                              z
                           ) results from the masks generation algorithm, a central point is indicated. First, the distance transformation (DT) [22,23] is computed using the Euclidean measure. Then, a point with a maximum DT value is taken as the center of the best fitting circle. That ensures that its projection onto adjacent slices indicates the nodule.

Before the fuzzy connectedness analysis is employed to delineate the nodule more precisely, additional procedures are launched to improve the performance. As mentioned above, two seed points indicate the object and its background, respectively. The relative fuzzy connectedness analysis is, however, more valuable if it uses more seed points, being reliable representatives of both regions. An attempt to select them in an automatic manner is made. Both algorithms are described below.

The idea of background seed points selection relies on an analysis of successive slices, starting from the seed slice, in the Z-direction. At the beginning, the seed point b is included into an empty set B; then, two values are determined: r
                           
                              ob
                            (the Euclidean distance between seeds o, b) and Φ
                           
                              ob
                            (the angle between the segment 
                              
                                 
                                    ob
                                 
                                 
                                    ¯
                                 
                              
                            and X-axis).

The procedure of the seed points search on the current slice involves a star-like structure with rays originating in the central point (Section 2.1) and oriented in 8 basic directions (Fig. 6
                           ). Each direction along such rays is searched for a point, satisfying the following criteria (ith ray is skipped with no seed point if a slice boundary or a 
                              3
                              ·
                              
                                 
                                    r
                                 
                                 
                                    ob
                                 
                              
                            distance is reached). Point d along the ray is accepted as a background seed if:
                              
                                 •
                                 mean intensity of d and its successor falls below 
                                       I
                                       (
                                       b
                                       )
                                     (“background intensity” test), or

mean intensity of d and its successor falls below 
                                       [
                                       I
                                       (
                                       b
                                       )
                                       +
                                       0.2
                                       (
                                       I
                                       (
                                       o
                                       )
                                       −
                                       I
                                       (
                                       b
                                       )
                                       )
                                       ]
                                     and 
                                       I
                                       (
                                       d
                                       )
                                     is lower than the successor׳s intensity (“deep-enough local minimum” test).

Every seed-based segmentation procedure yields better results when supplied with more than just one seed point. One way to provide more seeds is to pass into the procedure the entire binary mask obtained at earlier segmentation stages [24,25]. This requires, however, that the mask cannot include any false positive voxels. In our approach an evolutionary algorithm has been employed in order to search for additional seed points (Fig. 7
                           ). The algorithm is launched more than once, each time resulting in a single new seed point 
                              
                                 
                                    o
                                 
                                 
                                    i
                                 
                              
                            inserted into the set O (initially containing the seed o). When the algorithm does not succeed in two consecutive trials (there is no seed point candidate), the automatic object seed points’ selection terminates.

The evolutionary algorithm is described below:
                              
                                 
                                    
                                       •
                                    
                                 
                                 
                                    Individual: voxel p with chromosome constructed by concatenating its spatial coordinates 
                                       (
                                       
                                          
                                             p
                                          
                                          
                                             x
                                          
                                       
                                       ,
                                       
                                          
                                             p
                                          
                                          
                                             y
                                          
                                       
                                       ,
                                       
                                          
                                             p
                                          
                                          
                                             z
                                          
                                       
                                       )
                                    .


                                    Population size 
                                    μ:
                                       
                                          (1)
                                          
                                             μ
                                             =
                                             min
                                             {
                                             max
                                             {
                                             20
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   max
                                                
                                             
                                             }
                                             ,
                                             60
                                             }
                                             ,
                                          
                                       
                                    where 
                                       
                                          (2)
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   max
                                                
                                             
                                             =
                                             max
                                             {
                                             
                                                
                                                   r
                                                
                                                
                                                   ob
                                                
                                             
                                             ,
                                             
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         B
                                                      
                                                   
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                             2
                                             
                                                
                                                   r
                                                
                                                
                                                   min
                                                
                                             
                                             }
                                             ;
                                          
                                       
                                    
                                    
                                       
                                          (3)
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   min
                                                
                                             
                                             =
                                             min
                                             {
                                             max
                                             {
                                             5
                                             ,
                                             
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         B
                                                         5
                                                         %
                                                      
                                                   
                                                
                                                
                                                   ¯
                                                
                                             
                                             }
                                             ,
                                             15
                                             }
                                             ;
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   B
                                                
                                             
                                          
                                          
                                             ¯
                                          
                                       
                                     is the mean distance between seed o and all background seeds 
                                       
                                          
                                             b
                                          
                                          
                                             i
                                          
                                       
                                       ∈
                                       B
                                    ; 
                                       
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   B
                                                   5
                                                   %
                                                
                                             
                                          
                                          
                                             ¯
                                          
                                       
                                     is the mean distance between seed o and 5% of background seeds 
                                       
                                          
                                             b
                                          
                                          
                                             i
                                          
                                       
                                       ∈
                                       B
                                     closest to o.


                                    Initiation: genotypes (coordinates) of individuals are drawn from normal distributions with means located at coordinates of seed o and with 
                                       σ
                                       =
                                       0.5
                                       
                                          
                                             r
                                          
                                          
                                             max
                                          
                                       
                                    ; as the new seeds 
                                       
                                          
                                             o
                                          
                                          
                                             i
                                          
                                       
                                     appear in O, some parts of newly initiated populations are drawn around them as well.


                                    Selection: rank selection is used with elitist strategy (elite size equals to ca. 10% of μ).


                                    Genetic operators: three-parent, two-point crossover is employed, along with real-valued mutation, involving addition of random value, taken from normal distribution with zero mean and 
                                       σ
                                       =
                                       0.1
                                       
                                          
                                             r
                                          
                                          
                                             min
                                          
                                       
                                    .


                                    Fitness function:
                                       
                                          (4)
                                          
                                             fit
                                             (
                                             p
                                             )
                                             =
                                             
                                                
                                                   ∏
                                                
                                                
                                                   i
                                                   =
                                                   0
                                                
                                                
                                                   4
                                                
                                             
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                
                                             
                                             (
                                             p
                                             )
                                             ,
                                          
                                       
                                    with fitness components f
                                    
                                       i
                                     defined as
                                       
                                          (a)
                                          
                                             Nodule mask component f
                                             0:
                                                
                                                   (5)
                                                   
                                                      
                                                         
                                                            f
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                      (
                                                      p
                                                      )
                                                      =
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  1
                                                               
                                                               
                                                                  ⇔
                                                               
                                                               
                                                                  
                                                                     
                                                                        M
                                                                     
                                                                     
                                                                        n
                                                                     
                                                                  
                                                                  (
                                                                  p
                                                                  )
                                                                  =
                                                                  1
                                                               
                                                            
                                                            
                                                               
                                                                  0
                                                               
                                                               
                                                                  ⇔
                                                               
                                                               
                                                                  
                                                                     
                                                                        M
                                                                     
                                                                     
                                                                        n
                                                                     
                                                                  
                                                                  (
                                                                  p
                                                                  )
                                                                  =
                                                                  0
                                                                  .
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             Being the only binary fitness component, f
                                             0 disqualifies voxels outside the nodule mask from further analysis.


                                             Distance component f
                                             1: If the Euclidean distance between p and any of 
                                                
                                                   
                                                      o
                                                   
                                                   
                                                      i
                                                   
                                                
                                              in O is smaller than r
                                             
                                                min
                                             , then 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      1
                                                   
                                                
                                                =
                                                0.0
                                             . Otherwise, it decreases exponentially from 1.0 for r
                                             
                                                min
                                              to 0.0:
                                                
                                                   (6)
                                                   
                                                      
                                                         
                                                            f
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      (
                                                      p
                                                      )
                                                      =
                                                      
                                                         
                                                            e
                                                         
                                                         
                                                            −
                                                            (
                                                            d
                                                            (
                                                            p
                                                            ,
                                                            
                                                               
                                                                  o
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  n
                                                               
                                                            
                                                            )
                                                            −
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  min
                                                               
                                                            
                                                            )
                                                            /
                                                            2
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  min
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                   
                                                
                                             with 
                                                d
                                                (
                                                ·
                                                )
                                              denoting the Euclidean distance between two points, and 
                                                
                                                   
                                                      o
                                                   
                                                   
                                                      i
                                                      ,
                                                      n
                                                   
                                                
                                              being the seed point located nearest to p. This mechanism prevents from spatial clustering of seed points.


                                             Intensity component f
                                             
                                                2
                                              favoring individuals with intensities similar to 
                                                I
                                                (
                                                o
                                                )
                                             , is defined as
                                                
                                                   (7)
                                                   
                                                      
                                                         
                                                            f
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      (
                                                      p
                                                      )
                                                      =
                                                      
                                                         
                                                            e
                                                         
                                                         
                                                            −
                                                            
                                                               
                                                                  (
                                                                  I
                                                                  (
                                                                  p
                                                                  )
                                                                  −
                                                                  I
                                                                  (
                                                                  o
                                                                  )
                                                                  )
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                            /
                                                            
                                                               
                                                                  [
                                                                  0.1
                                                                  ·
                                                                  (
                                                                  I
                                                                  (
                                                                  o
                                                                  )
                                                                  −
                                                                  I
                                                                  (
                                                                  b
                                                                  )
                                                                  )
                                                                  ]
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                      
                                                      .
                                                   
                                                
                                             
                                          


                                             Intensity profile component f
                                             
                                                3
                                              is used to evaluate object homogeneity. p is connected to o and p׳s nearest seed point 
                                                
                                                   
                                                      o
                                                   
                                                   
                                                      i
                                                   
                                                
                                              (if exists) by a line segment. Intensities of virtual voxels on such profiles are interpolated. Then, a measure is calculated per each profile as a product of two features, both determined using Gaussian functions depending on two parameters: (1) intensity magnitude along a profile, (2) sum of absolute differences between each two adjacent points along a profile. Finally, the maximum of these measures for both profiles is assigned to 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      3
                                                   
                                                
                                                (
                                                p
                                                )
                                             . The intensity profile component is a good edge detector and avoids “sowing” points in similar-intensity regions, separated from the nodule (e.g. vessels or pleura).


                                             Neighborhood component f
                                             
                                                4
                                             : The seeds should not be located at object boundaries. Therefore, the fitness of such voxels is suppressed using f
                                             4, led by measures of their 26-neighborhood homogeneity and mean intensity with reference to 
                                                I
                                                (
                                                o
                                                )
                                             :
                                                
                                                   (8)
                                                   
                                                      
                                                         
                                                            f
                                                         
                                                         
                                                            4
                                                         
                                                      
                                                      (
                                                      p
                                                      )
                                                      =
                                                      
                                                         
                                                            e
                                                         
                                                         
                                                            −
                                                            
                                                               
                                                                  (
                                                                  
                                                                     
                                                                        I
                                                                        (
                                                                        
                                                                           
                                                                              N
                                                                           
                                                                           
                                                                              27
                                                                           
                                                                        
                                                                        (
                                                                        p
                                                                        )
                                                                        )
                                                                     
                                                                     
                                                                        ¯
                                                                     
                                                                  
                                                                  −
                                                                  I
                                                                  (
                                                                  o
                                                                  )
                                                                  )
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                            +
                                                            Δ
                                                            I
                                                            
                                                               
                                                                  (
                                                                  
                                                                     
                                                                        N
                                                                     
                                                                     
                                                                        27
                                                                     
                                                                  
                                                                  (
                                                                  p
                                                                  )
                                                                  )
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                            /
                                                            
                                                               
                                                                  [
                                                                  0.1
                                                                  ·
                                                                  (
                                                                  I
                                                                  (
                                                                  o
                                                                  )
                                                                  −
                                                                  I
                                                                  (
                                                                  b
                                                                  )
                                                                  )
                                                                  ]
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                   
                                                
                                             where 
                                                
                                                   
                                                      I
                                                      (
                                                      
                                                         
                                                            N
                                                         
                                                         
                                                            27
                                                         
                                                      
                                                      (
                                                      p
                                                      )
                                                      )
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                              is the mean intensity, and 
                                                Δ
                                                I
                                                (
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      27
                                                   
                                                
                                                (
                                                p
                                                )
                                                )
                                              is the intensity amplitude, both within 26-neighborhood of p.


                                    Fig. 8
                                     shows the evaluation of 3 sample individuals, according to the above rules. Assume that there is no seed point in O, but o. Assume also that all 3 individuals are located at the o
                                    
                                       z
                                    th (seed) slice. c
                                    1 does not belong to the nodule mask, therefore the f
                                    0 component damps 
                                       fit
                                       (
                                       
                                          
                                             c
                                          
                                          
                                             1
                                          
                                       
                                       )
                                     to zero and excludes c
                                    1 from further consideration (
                                       
                                          
                                             f
                                          
                                          
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             f
                                          
                                          
                                             4
                                          
                                       
                                     values are shown just for information here). c
                                    2 belongs to the vessel and is marked in M
                                    
                                       n
                                    , but all real-valued fitness components vote against it; in particular, note the changes along intensity profile 
                                       o
                                       −
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                    . Finally, c
                                    3 appears to be a good seed point candidate. Due to a nearby location of the nodule boundary, the fitness function of the latest is, however, reduced by the neighborhood component.


                                    Number of generations 
                                    N
                                    
                                       g
                                    : the single run of an algorithm terminates when an individual with fitness exceeding predefined value of fit
                                    
                                       min
                                     is found; the winning point is inserted into O. As the generation number increases, the value of fit
                                    
                                       min
                                     decreases from 1.0 to some steady-state value, depending on the 
                                       [
                                       I
                                       (
                                       o
                                       )
                                       −
                                       I
                                       (
                                       b
                                       )
                                       ]
                                     value (usually 
                                       0.4
                                       −
                                       0.6
                                    ). N
                                    
                                       g
                                     cannot exceed 50.

All relations, equations, and values described above have been assessed experimentally to meet the following initial goals of an algorithm: (1) generation of a limited number of well representative object seed points, (2) uniform distribution of seeds over the whole region, (3) low computational complexity, and (4) high level of adaptability, referring to most of its parameters and results. The number of new seed points 
                              
                                 
                                    o
                                 
                                 
                                    i
                                 
                              
                            depends on the size of the nodule region, and during the experiments varied from 0 (none point selected) to 38 for the largest nodules.

Binary masks determined in Section 2.1 for specific regions and sets O, B of seed points constitute the starting point for the robust segmentation stage, based on the fuzzy connectedness approach (FC). As a segmentation method, FC belongs to the region growing techniques family [26,27]. In many cases FC is treated as part of a wider methodology, mostly used for fine segmentation. In general, the idea of fuzzy connectedness relies on performing soft computations in digital spaces [28]. The fuzzy connectedness K describes the relation between a pair of spels (pixels/voxels) c, d in terms of a membership function 
                           
                              
                                 μ
                              
                              
                                 κ
                              
                           
                           (
                           c
                           ,
                           d
                           )
                           ∈
                           [
                           0
                           ,
                           1
                           ]
                        . Its value is based on fuzzy affinity κ relations between topologically adjacent spels, assembled using graph search algorithms. In this study we use the canonic affinity function 
                           
                              
                                 μ
                              
                              
                                 κ
                              
                           
                           (
                           c
                           ,
                           d
                           )
                        , being a superposition of Gaussian curves, with both weights set to 0.5 [26,27].

To perform an FC-based image segmentation, the fuzzy connectivity scene C
                        
                           o
                         is computed for each spel c, as
                           
                              (9)
                              
                                 
                                    
                                       C
                                    
                                    
                                       o
                                    
                                 
                                 (
                                 c
                                 )
                                 =
                                 
                                    
                                       μ
                                    
                                    
                                       K
                                    
                                 
                                 (
                                 o
                                 ,
                                 c
                                 )
                                 ,
                              
                           
                        where o is the object seed point, with its connectivity 
                           
                              
                                 C
                              
                              
                                 o
                              
                           
                           (
                           o
                           )
                           =
                           
                              
                                 μ
                              
                              
                                 K
                              
                           
                           (
                           o
                           ,
                           o
                           )
                           =
                           1
                        . Computation of C
                        
                           o
                         according to (9) has been originally performed using the dynamic programming approach [26,29], but Dijkstra׳s algorithm [30] has proven to be faster in general in solving the shortest path problem. In many applications there are more object seed points available for the FC analysis [31,32] (including the study described in this paper). In such cases, the fuzzy connectivity scene C
                        
                           O
                         for a set 
                           O
                           =
                           {
                           
                              
                                 o
                              
                              
                                 i
                              
                           
                           }
                         is a fuzzy union:
                           
                              (10)
                              
                                 
                                    
                                       C
                                    
                                    
                                       O
                                    
                                 
                                 (
                                 c
                                 )
                                 =
                                 
                                    
                                       ⋃
                                    
                                    
                                       
                                          
                                             o
                                          
                                          
                                             i
                                          
                                       
                                       ∈
                                       O
                                    
                                 
                                 
                                    
                                       C
                                    
                                    
                                       
                                          
                                             o
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 (
                                 c
                                 )
                                 =
                                 
                                    
                                       max
                                    
                                    
                                       
                                          
                                             o
                                          
                                          
                                             i
                                          
                                       
                                       ∈
                                       O
                                    
                                 
                                 {
                                 
                                    
                                       μ
                                    
                                    
                                       K
                                    
                                 
                                 (
                                 
                                    
                                       o
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 c
                                 )
                                 }
                                 .
                              
                           
                        The final segmentation of an object might be done by binarization of C
                        
                           O
                         with a threshold θ.

Many modified FC-based segmentation approaches have been developed, considering appearance of two or more objects to be segmented [31,33,34]. In the case of two objects (relative fuzzy connectedness – RFC), one is treated as an object, while the second – as a background, each with its own seed point (points). The fuzzy object is determined here in a rivalry mode. Since the RFC analysis applied to big datasets like CT volumes is highly time-consuming, any optimization concept is welcome. One of them is to crop the VOI from the entire data, on the basis of the knowledge about possible size of the segmented object (i.e. nodule). Another limitation introduced here into the FC analysis results from the binary mask M
                        
                           a
                        . The analysis cannot be done inside M
                        
                           a
                        , as it would certainly “leak” into unwanted regions, described in Section 2.1. Therefore, Dijkstra׳s search operates only on voxels with M
                        
                           a
                        =0.

We also propose a new modification for the RFC implementation. Its main idea is to avoid calculation of the second scene C
                        
                           B
                         for background, as well as to limit calculation of C
                        
                           O
                         to indispensable minimum. It has been proven [33], that for each background spel c:
                           
                              (11)
                              
                                 
                                    
                                       μ
                                    
                                    
                                       K
                                    
                                 
                                 (
                                 o
                                 ,
                                 c
                                 )
                                 ≤
                                 
                                    
                                       μ
                                    
                                    
                                       K
                                    
                                 
                                 (
                                 o
                                 ,
                                 b
                                 )
                                 ⇒
                                 
                                    
                                       C
                                    
                                    
                                       o
                                    
                                 
                                 (
                                 c
                                 )
                                 ≤
                                 
                                    
                                       C
                                    
                                    
                                       o
                                    
                                 
                                 (
                                 b
                                 )
                                 .
                              
                           
                        Let us assume that 
                           O
                           =
                           {
                           o
                           }
                        . An important property of Dijkstra׳s algorithm for calculating C
                        
                           o
                         is that in each iteration a spel c with the highest value of 
                           
                              
                                 C
                              
                              
                                 o
                              
                           
                           (
                           c
                           )
                         is taken from the queue into analysis. Its 
                           
                              
                                 C
                              
                              
                                 o
                              
                           
                           (
                           c
                           )
                         value is final, as no better path may lead into it through unexplored regions of an image. Therefore, a fuzzy connectivity scene for an object is built starting from the seed point, and then the exploration proceeds into less and less-connected areas. According to (11), if a background seed point b is finally taken into analysis, the search procedure can terminate, as none of the following spels have higher connectivity with o than b. Therefore, our proposition is to calculate C
                        
                           o
                         until it reaches b, terminate the algorithm, and include into an object all spels c such, that:
                           
                              (12)
                              
                                 
                                    
                                       μ
                                    
                                    
                                       K
                                    
                                 
                                 (
                                 o
                                 ,
                                 c
                                 )
                                 >
                                 
                                    
                                       μ
                                    
                                    
                                       K
                                    
                                 
                                 (
                                 o
                                 ,
                                 b
                                 )
                                 ⇒
                                 
                                    
                                       C
                                    
                                    
                                       o
                                    
                                 
                                 (
                                 c
                                 )
                                 >
                                 
                                    
                                       C
                                    
                                    
                                       o
                                    
                                 
                                 (
                                 b
                                 )
                                 .
                              
                           
                        Such concept is also applicable if:
                           
                              1.
                              Many object seed points 
                                    
                                       
                                          o
                                       
                                       
                                          i
                                       
                                    
                                  are prepared for the analysis – Eq. (10) applies.

Many background seed points 
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                  are prepared for analysis. In such case, Dijkstra׳s search terminates when the first seed 
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                    ∈
                                    B
                                  is reached. Its connectivity value 
                                    
                                       
                                          C
                                       
                                       
                                          O
                                       
                                    
                                    (
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                    )
                                  establishes the threshold to produce the binary volume 
                                    
                                       
                                          I
                                       
                                       
                                          
                                             
                                                C
                                             
                                             
                                                O
                                             
                                          
                                       
                                    
                                 :
                                    
                                       (13)
                                       
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      O
                                                   
                                                
                                             
                                          
                                          (
                                          c
                                          )
                                          =
                                          {
                                          
                                             
                                                
                                                   
                                                      1
                                                      ⇔
                                                   
                                                   
                                                      
                                                         
                                                            C
                                                         
                                                         
                                                            O
                                                         
                                                      
                                                      (
                                                      c
                                                      )
                                                      >
                                                      
                                                         
                                                            C
                                                         
                                                         
                                                            O
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            b
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      otherwise
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 In other words, the threshold is adaptively determined as the largest fuzzy connectedness between any of the object seed points and any of the background seed points. A single background seed point system shows some weaknesses, being highly sensitive to b location, and often leading to oversegmentation. To illustrate the reason note, that it is likely, that not all points fulfilling (12) should in fact be the object points if b has been indicated far from the object boundary. It means, that 
                                    
                                       
                                          C
                                       
                                       
                                          o
                                       
                                    
                                    (
                                    b
                                    )
                                  is not a proper threshold approximation and the cutoff should occur earlier, at higher value of 
                                    
                                       
                                          μ
                                       
                                       
                                          K
                                       
                                    
                                 . That is why the algorithm described in Section 2.2.1 has been employed to a close neighborhood of the object in order to produce more reliable background seed points.

The modified RFC approach with sets O and B of seed points provides fast robust segmentation of nodules, being especially useful when low-density nodules occur. Finally, its outcome is added to the nodule mask M
                        
                           n
                        :
                           
                              (14)
                              
                                 
                                    
                                       I
                                    
                                    
                                       
                                          
                                             M
                                          
                                          
                                             n
                                          
                                       
                                       ,
                                       
                                          
                                             C
                                          
                                          
                                             O
                                          
                                       
                                    
                                 
                                 (
                                 c
                                 )
                                 =
                                 
                                    
                                       M
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 c
                                 )
                                 ∪
                                 
                                    
                                       I
                                    
                                    
                                       
                                          
                                             C
                                          
                                          
                                             O
                                          
                                       
                                    
                                 
                                 (
                                 c
                                 )
                                 .
                              
                           
                        
                     

Segmentation of a vascularized nodule results in an extraction of the nodule attached to the vessel (Fig. 9
                        a). The diameter of vessel is small compared to the nodule size. Mathematical morphology and shape analysis [35] have been employed to correct the outcome.

First, holes in 
                           
                              
                                 I
                              
                              
                                 
                                    
                                       M
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                    
                                       C
                                    
                                    
                                       O
                                    
                                 
                              
                           
                         
                        (14) are morphologically filled, yielding a binary volume I
                        
                           fh
                        , subjected then to a 3D morphological opening, to produce a binary volume I
                        
                           op
                         (Fig. 10
                        ). The structuring element is a sphere with a diameter greater than the maximum expected vessel diameter (4mm value has been assessed). The erosion step of the opening operation erases vessels, whereas the dilation restores misread mass regions. As the opening operation is inextensive, some nodule voxels might be removed and considered as false negatives (Fig. 9b). To avoid it, a second postprocessing, “shape analysis” path is performed on a differential volume 
                           (
                           
                              
                                 I
                              
                              
                                 fh
                              
                           
                           −
                           
                              
                                 I
                              
                              
                                 op
                              
                           
                           )
                        . Using the distance transformation of I
                        
                           fh
                         (Fig. 10), all such 26-connected components (Fig. 9b) are analyzed and accepted or rejected on the basis of their shape, size, adjacency and distance to a nodule core in I
                        
                           op
                        . Three conditions are examined:
                           
                              •
                              a component of volume smaller than a predefined value (not more than 5mm3) is entirely included into the nodule object;

if a distance between any component׳s voxel and the nodule core in I
                                 
                                    op
                                  does not exceed a predefined value, it is entirely included into the nodule object; a fraction (e.g. a half) of the nodule core best fitting sphere radius is taken as the threshold;

otherwise, a component is temporarily appended to the nodule core and such object is examined in terms of shape and distance transformation values in order to leave all voxels located close enough to the core.

Resulting volume I
                        
                           sa
                         is subjected to a 3D morphological closing to finally smooth the nodule shape (Fig. 9c).

@&#EXPERIMENTAL RESULTS@&#

Quality assessment of computerized segmentation is usually based on a comparison between these segmentations and a gold standard. That shows nodules manually delineated by human observers and thus includes a subjective factor in their generation. Consequently, inter- and intra-observer discrepancy may be larger than the differences between computerized and expert-labeled images. The methodology development and initial evaluation are based on the first LIDC dataset. For final evaluation, 551 cases from the LIDC–IDRI dataset have been employed.

In this study the database of 23 thoracic CT studies (each containing a single nodule), provided by the Lung Image Database Consortium (LIDC) has been employed [36,37]. It has already been used in various studies on lung nodule segmentation [7,38,14,39,3,1,4,6,40,5]. Series contain nodules of multiple types. Each nodule has been delineated by six radiologists; each radiologist did it in several blinded or unblinded trials. As a result, each nodule has been described by a voxel probability map M
                        
                           pr
                        : if all radiologists in every attempt assigned a voxel c as a nodule tissue, then 
                           
                              
                                 M
                              
                              
                                 pr
                              
                           
                           (
                           c
                           )
                           =
                           100
                           %
                        . Such voxels might be treated as parts of unquestionable nodule core. Otherwise, if c has never been referred to as a nodule voxel, then 
                           
                              
                                 M
                              
                              
                                 pr
                              
                           
                           (
                           c
                           )
                           =
                           0
                           %
                         (certainly a non-nodule voxel). In other cases, if during N delineations c has been indicated k times as a nodule tissue, then 
                           
                              
                                 M
                              
                              
                                 pr
                              
                           
                           =
                           k
                           /
                           N
                           ·
                           100
                           %
                        .

Three main evaluation measures have been defined:
                           
                              •
                              
                                 TPR
                                 100 – true positive rate – consistency with nodule core voxels c (
                                    
                                       
                                          M
                                       
                                       
                                          pr
                                       
                                    
                                    (
                                    c
                                    )
                                    =
                                    100
                                    %
                                    )
                                 .


                                 TPR
                                 50 – true positive rate – consistency with nodule voxels c with 50%-reliability (
                                    
                                       
                                          M
                                       
                                       
                                          pr
                                       
                                    
                                    (
                                    c
                                    )
                                    ≥
                                    50
                                    %
                                    )
                                 .


                                 
                                    
                                       
                                          FDR
                                       
                                       
                                          
                                             
                                                0
                                             
                                             
                                                +
                                             
                                          
                                       
                                    
                                  – number of certainly non-nodule voxels c (
                                    
                                       
                                          M
                                       
                                       
                                          pr
                                       
                                    
                                    (
                                    c
                                    )
                                    =
                                    0
                                    %
                                 ) assigned to a nodule by the described algorithm, divided by a total number of nodule voxels in segmentation outcome: a false discovery rate for over 0%-certain nodule regions.

First two of the above measures are referred to as sensitivities, specified for a chosen level of nodule reliability within the reference probability map. As such, they are a part of continuous measure of sensitivity TPR
                        
                           r
                        , defined in accordance to reliability level 
                           r
                           ∈
                           (
                           0
                           ,
                           100
                           ]
                        :
                           
                              (15)
                              
                                 
                                    
                                       TPR
                                    
                                    
                                       r
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             TP
                                          
                                          
                                             r
                                          
                                       
                                    
                                    
                                       
                                          
                                             TP
                                          
                                          
                                             r
                                          
                                       
                                       +
                                       
                                          
                                             FN
                                          
                                          
                                             r
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 TP
                              
                              
                                 r
                              
                           
                           ,
                           
                              
                                 FN
                              
                              
                                 r
                              
                           
                         are numbers of true positive and false negative voxels, respectively, when the hard reference standard G
                        
                           r
                         is determined by thresholding the probability map at r:
                           
                              (16)
                              
                                 
                                    
                                       G
                                    
                                    
                                       r
                                    
                                 
                                 (
                                 c
                                 )
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             1
                                             ⇔
                                          
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   pr
                                                
                                             
                                             (
                                             c
                                             )
                                             ≥
                                             r
                                             ,
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             otherwise
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Similarly, 
                           
                              
                                 FDR
                              
                              
                                 
                                    
                                       0
                                    
                                    
                                       +
                                    
                                 
                              
                           
                         can also be interpreted as a special case of the false discovery rate FDR
                        
                           r
                         chart, defined as follows:
                           
                              (17)
                              
                                 
                                    
                                       FDR
                                    
                                    
                                       r
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             FP
                                          
                                          
                                             r
                                          
                                       
                                    
                                    
                                       
                                          
                                             FP
                                          
                                          
                                             r
                                          
                                       
                                       +
                                       
                                          
                                             TP
                                          
                                          
                                             r
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        with FP
                        
                           r
                         being the number of false positives with the reference standard G
                        
                           r
                         
                        (16) and r is the smallest positive quantity available.

For evaluation, three versions of the algorithm have been tested (Fig. 1). The Mask version includes the rough segmentation procedure (Section 2.1) and postprocessing functions (Section 2.4) only. The RFC-OB version is based on the modified relative fuzzy connectedness with automatic selection of sets O, B of seed points, yet without applying Eq. (14): only 
                           
                              
                                 I
                              
                              
                                 
                                    
                                       C
                                    
                                    
                                       O
                                    
                                 
                              
                           
                         
                        (13) is passed to postprocessing. Finally, the MRFC-OB algorithm employs (14) to combine results of rough and robust segmentation stages.

The true positive detection rate and the false detection rate for various probability levels are shown in Figs. 11 and 12
                        
                        , respectively. The solid black curve reflects a performance of the initial mask generation combined with fuzzy connectedness that relies on automatically generated seed points by a soft computing approach (MRFC-OB). The dashed curve presents the performance of the fuzzy connectedness – fine segmentation – module only (RFC-OB). The dash-dotted curve indicates the performance of the mask generation – rough segmentation – module (Mask).

Mean values of measures taken from Figs. 11 and 12 are shown in Table 1
                        . During the evaluation, 5 different pairs of seed points o, b have been indicated within each study: 5 persons have investigated each nodule, selected a slice and indicated 2 points o, b on it. That led to 5 independent results of the Mask method. Both methods involving a heuristic object seed points selection (MRFC-OB, RFC-OB) have been run 5 times per each pair of seed points, to produce 25 results per study.

Desirable value for TPR
                        100 is 100%. Similarly, ground false detection rate 
                           
                              
                                 FDR
                              
                              
                                 
                                    
                                       0
                                    
                                    
                                       +
                                    
                                 
                              
                           
                         should not exceed 0%. Both these measures indicate MRFC-OB as of the best performance with detection rate of 99.94% and 0.49%, respectively. Fusion of the first (masks generation) and second (FC analysis) stage reduces the possibility of losing important (incl. core) nodule regions. On the other hand, the unwanted “segmentation leaks” into vasculature are reduced by preparing a more compact object for postprocessing.

The analysis of 
                           
                              
                                 TPR
                              
                              
                                 r
                              
                           
                           ,
                           
                              
                                 FDR
                              
                              
                                 r
                              
                           
                         curves is more interesting, as their shape (excluding the mentioned above boundary conditions) is not obviously definable; the same concerns the TPR
                        50 level. If the r=50% isoline within M
                        
                           pr
                         could be taken as a reliable nodule contour, then the segmentation method should achieve a high value of TPR
                        50 as well (close to 100%). As the TPR
                        
                           r
                         function is by definition monotonically increasing, all reliability r values between 50 and 100% should produce high TPR
                        
                           r
                         values. TPR
                        
                           r
                         for 
                           r
                           <
                           50
                           %
                         should, however, move away from 100%, and visibly decrease, as r moves down towards 0%. The solid line for MRFC-OB in Fig. 11 ensures the above assumptions best, with TPR
                        50 at 91.13%. Confrontation of resulting nodule contours and M
                        
                           pr
                         isolines plotted on corresponding CT slices, rather confirms the above observation: as 
                           r
                           =
                           100
                           %
                         refers to the nodule core (note that there are some cases without 100%-certain zones), r=50% delineates practically the entire nodule. There are some inaccuracies around the 50% value, as the multi-attempt delineation process is inaccurate (or fuzzy) itself: some voxels with lower reliability might be considered as nodule parts; some with higher reliability might look like being outside the nodule. Fig. 13
                         shows three studies with such comparison. In most cases the resulting green contour practically overlaps the red outline, corresponding to a 50% reliability r.

Similar analysis can be performed for the false detection curve FDR
                        
                           r
                        . Being also monotonically increasing, it should not grow too much until reliability r reaches 50% mark, as voxels with 
                           r
                           <
                           50
                           %
                         are rather considered to be non-nodule. Recall that less than 0.5% of voxels recognized as nodule by the MRFC-OB method are improperly detected. The same measure reaches 10.92% for r=49% – this quantum might be considered as a level of excess over the half-certainty nodule isoline. Such amount seems to be reasonable according to previous discussion on the gold standard inaccuracy.

The LIDC first dataset used for the evaluation has been employed by Diciotti et al. [7]. The authors have chosen 12 out of 23 cases of solid nodules of types I and II (well-circumscribed and vascularized) and reported 
                           83.3
                           %
                         efficiency (10 out of 12 cases delineated properly, based on a global opinion of the radiologist); no attempt has been made to define and quantify voxel-related and probability map-based measures.

In order to compare our results with other studies, a Jaccard index s
                        0 has been implemented, since it has been employed by various authors as a segmentation overlap measure. It is defined as a number of common voxels for the segmentation result H and the probability map M
                        
                           pr
                         thresholded at r=50% to produce a hard reference standard G, here defined as 
                           
                              
                                 G
                              
                              
                                 50
                                 %
                              
                           
                         
                        (16), divided by the number of all nonzero voxels in any of the above volumes:
                           
                              (18)
                              
                                 
                                    
                                       s
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 
                                    
                                       |
                                       G
                                       ∩
                                       H
                                       |
                                    
                                    
                                       |
                                       G
                                       ∪
                                       H
                                       |
                                    
                                 
                                 .
                              
                           
                        Kubota et al. [14] report a mean value of 0.69 for s
                        0; they also compared their work to few previous LIDC database-tested methods, where the s
                        0 value varied from 0.51 to 0.66 [39,3,1,4,6,40,5].

The mean value of s
                        0 reached 
                           0.60
                           ±
                           0.16
                         for the preferred method MRFC-OB. Fig. 14
                         presents the chart of s
                        0 as a function of reliability r, used to produce the reference standard G (G
                        
                           r
                        ) for all three variants of the method. Its analysis shows a significantly better result obtained for reference standards G
                        
                           r
                         with lower reliabilities r: 
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                           (
                           r
                           )
                           >
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                           (
                           50
                           %
                           )
                         for 
                           r
                           ∈
                           [
                           10
                           ,
                           49
                           ]
                           [
                           %
                           ]
                        , 
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                           (
                           r
                           )
                           ≥
                           0.69
                         for 
                           r
                           ∈
                           [
                           22
                           ,
                           49
                           ]
                           [
                           %
                           ]
                        , with a maximum value of 0.6974 for 
                           r
                           =
                           44
                           %
                        . Similar analysis by Way et al. showed a maximum value of s
                        0=0.63 for 
                           r
                           =
                           40
                           %
                         compared to 
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                           =
                           0.55
                         for r=50% [5]. A rapid fall of the Jaccard index value while crossing the 50% mark is due to the significant decrease of the number of reference standard voxels, which influences mainly the numerator of (18); therefore, the methods’ effectiveness measured by s
                        0 is the highest just below r=50%. Fig. 14 shows another interesting feature of the RFC-OB method. Maximum of 
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                           (
                           r
                           )
                           =
                           0.6150
                         appears right at r=50%, which at that point makes it more efficient than the MRFC-OB variant.

The evaluation involving graphical analysis of certain metrics with respect to the reliability r has not been present in previous studies, therefore it can be considered as original. The Jaccard index s
                        0 has been discussed earlier, yet a continuous chart (Fig. 14) is our proposition.


                        Table 2
                         contains a time consumption analysis of MRFC-OB and Mask methods, as well as 3 various modes used to evaluate the influence of the seed points selection algorithms:
                           
                              •
                              
                                 MRFC-O, where automatic detection of background seed points has not been applied, and fuzzy connectedness analysis relies on a set O of object seed points and a single point b only.


                                 MRFC-B, where automatic detection of object seed points has not been applied, and fuzzy connectedness analysis relies on a set B of background seed points and a single point o only.


                                 MRFC, where automatic detection of seed points has not been applied, and fuzzy connectedness analysis relies on single points o, b only.

The MRFC-OB method shows the best balance between true and false positive matches; remaining FC-based variants indicate rather an oversegmentation mechanism – each system based on a single background seed point shows an unacceptable FDR value. Table 2 shows also a trade off between high TPR and low FDR, depending on a presence of the object seed points selection algorithm: an 
                           
                              
                                 FDR
                              
                              
                                 
                                    
                                       0
                                    
                                    
                                       +
                                    
                                 
                              
                           
                         has fallen below 1% only for the MRFC-OB method, as a result of slightly smaller TPR values. Note that virtual time profit gained by omitting the seed points selection algorithms leads into much longer fuzzy connectedness analysis, which makes t
                        2 over 3 times greater. In the worse case scenario (single MRFC run for study no. 18) 
                           
                              
                                 t
                              
                              
                                 2
                              
                           
                           =
                           282.64
                           
                           s
                         is cut to a mean value of 
                           
                              
                                 t
                              
                              
                                 2
                              
                           
                           =
                           31.59
                           
                           s
                         for 5 corresponding runs of MRFC-OB.

The number of automatically generated seed points 
                           
                              
                                 o
                              
                              
                                 i
                              
                           
                           ∈
                           O
                           ,
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           ∈
                           B
                         in MRFC-OB depends mainly on the nodule size. The mean total number of object seed points (including seed o) obtained during evaluation is 4.59, but in 16 out of 23 cases no seed point has been added to O in any attempt. The mean total number of background seed points is 208.93.

The second experiment has been performed on a new LIDC–IDRI (Image Database Resource Initiative) database [41,37], containing 1018 helical thoracic CT studies with multiple pulmonary nodules. The database stands for the current stage of LIDC benchmark development. Annotation methodology has been simplified referring to the previous idea. Each nodule is assigned with one of two labels: “nodule 
                           <
                           3
                           
                           mm
                        ” or “nodule 
                           ≥
                           3
                           
                           mm
                        ”. In the latter case, a delineation process takes place. After a series of blinded and unblinded reviews, a final information is put into the xml file with 4 delineations made by 4 radiologists. That leads to a 5-level probability map M
                        
                           pr
                         enabling the statistical analysis.

In recent years the LIDC–IDRI database has been employed mostly by computer-aided detection algorithms [42,12,43], by studies on intra- and interobserver variability during development of such a huge database [44,45] or studies on textural features of pulmonary nodules appearance in CT [46]. Some reports on segmentation have been provided [8,11] (some of them using also a second generation LIDC database from 2007 [47]). Diciotti et al. [8] notified an 88.5% accuracy of small nodule segmentation in terms of the expert evaluation, without further numerical details. Chen et al. [11] have chosen 16 vascularized nodules for testing and reported true positive ratio at 88.89%, false positive ratio at 10.19% with Jaccard index at 0.90 (it is unsure whether the LIDC annotations have been used as a gold standard). No comprehensive analysis on a larger set of nodules has been noticed so far.

In this study we have chosen a set of 551 various nodules, all recognized “nodule 
                           ≥
                           3
                           
                           mm
                        ” by each expert and having a “core” region (at least one voxel c with 
                           
                              
                                 M
                              
                              
                                 pr
                              
                           
                           =
                           100
                           %
                        ). We have tested our 3 basic methodologies (MRFC-OB, RFC-OB, Mask) using a single pair of reliable seed points 
                           o
                           ,
                           b
                         per nodule. No manual marking process occurred here: the object seed o has been selected automatically as a central point for the nodule core region (
                           
                              
                                 M
                              
                              
                                 pr
                              
                           
                           =
                           100
                           %
                        ); the background seed b has been chosen as the less dense pixel from the assumed nodule proximity. That simulates manual marking process over a number of cases.


                        Table 3
                         presents the evaluation results, while Figs. 15–17
                        
                        
                         show the mean TPR
                        
                           r
                        , FDR
                        
                           r
                         and 
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                           (
                           r
                           )
                         charts, respectively. The Jaccard index at r=50% achieves 0.69 using the MRFC-OB method, similar to the previous database. The same mark is reached using the Mask variant at r=75%, mainly due to a relatively small number of false positives at that point. Worse results of TPR
                        100, TPR
                        50 and 
                           
                              
                                 FDR
                              
                              
                                 
                                    
                                       0
                                    
                                    
                                       +
                                    
                                 
                              
                           
                         might be explained by the difference between probability maps describing cases from both datasets. With only 4 positive levels of probability, each nodule is less likely to be covered by at least one expert׳s contour, as well as more likely to belong to the nodule core: these lead into more restrictive evaluation procedure. Moreover, the mean 
                           
                              
                                 FDR
                              
                              
                                 
                                    
                                       0
                                    
                                    
                                       +
                                    
                                 
                              
                           
                         value is enhanced by small nodules, where even a 1–2mm oversegmentation produces high level of relative false detection ratio measure. Fig. 18
                         shows several nodules extracted by the MRFC-OB method.

@&#CONCLUSION@&#

An efficient and fast methodology for segmenting pulmonary nodules is described in this paper. Conventional methods, based on intensity analysis and morphological operations, have been enriched by employing soft computing algorithms. On one hand, specific mode of the relative fuzzy connectedness analysis is employed. On the other hand, an evolutionary computation application is incorporated into a traditional image processing segmentation method, pointing voxels with required features. Image analysis still seems to be fully opened for computational intelligence ideas.

Experimental validation of the method is based on LIDC databases, with “gold standard” in a form of voxel probability map. Measures that take advantage of such information show high efficiency of the method described: practically 100% correct detection in the case of nodule core regions with false detection rate under 5‰ for any indicated nodule voxels in the case of the canonic LIDC first dataset. Moreover, the true positive rate at half-certainty nodule level exceeds 91%. The Jaccard index obtained at the latter reliability level achieves 0.60, with a maximum of 0.70 at the 44% reliability level. Another experiment, employing 551 nodules from the LIDC–IDRI database evaluates the methodology on the basis of a larger number of cases and confirms the method׳s performance. Analysis of the voxel-reliability driven true positive and false detection rate curves is also discussed.

Note that selection of seed points does not have to be the only user interaction. A specific computer-aided diagnosis [48] workstation has been developed, enabling verification and possible correction of segmentation results. Such approach is the more justified, the less time is required to perform the automated part of an algorithm, what has been achieved by the described methodology.

None declared.

@&#ACKNOWLEDGMENT@&#

This work is partially supported by the Polish National Science Centre Grant no. DEC-2012/05/B/ST7/02136.

@&#REFERENCES@&#

