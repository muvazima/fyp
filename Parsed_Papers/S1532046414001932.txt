@&#MAIN-TITLE@&#Evaluation of matched control algorithms in EHR-based phenotyping studies: A case study of inflammatory bowel disease comorbidities

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Appropriate control selection is essential to the success of population studies.


                        
                        
                           
                           Heterogeneous populations in observational data require novel matching methods.


                        
                        
                           
                           In EHR studies, matching by healthcare utilization improves comorbidity detection.


                        
                        
                           
                           Controls matched to inflammatory bowel disease patients identified likely comorbidity.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

EHR

Controls

Matching

Comorbidity

Inflammatory bowel disease

@&#ABSTRACT@&#


               
               
                  The success of many population studies is determined by proper matching of cases to controls. Some of the confounding and bias that afflict electronic health record (EHR)-based observational studies may be reduced by creating effective methods for finding adequate controls. We implemented a method to match case and control populations to compensate for sparse and unequal data collection practices common in EHR data. We did this by matching the healthcare utilization of patients after observing that more complete data was collected on high healthcare utilization patients vs. low healthcare utilization patients. In our results, we show that many of the anomalous differences in population comparisons are mitigated using this matching method compared to other traditional age and gender-based matching. As an example, the comparison of the disease associations of ulcerative colitis and Crohn’s disease show differences that are not present when the controls are chosen in a random or even a matched age/gender/race algorithm. In conclusion, the use of healthcare utilization-based matching algorithms to find adequate controls greatly enhanced the accuracy of results in EHR studies. Full source code and documentation of the control matching methods is available at https://community.i2b2.org/wiki/display/conmat/.
               
            

@&#INTRODUCTION@&#

In the United States, electronic health record (EHR) adoption has increased dramatically in recent years. In 2012, 44% of hospitals reported having an operational EHR, up from 8.8% in 2008 [1]. The growth of EHRs has created large longitudinal data sets that enable a variety of population studies. EHRs have been shown to provide important strengths over other data sources, including large, diverse populations representing real-world patterns of disease and treatment with a wide variety of data types [2–4]. Investigators have leveraged these data sources for testing targeted hypothesis of drug-adverse effect associations [5–7] and comparing effectiveness of established therapies [8]. More recently, researchers have also aimed to identify novel genetic associations to EHR-derived phenotypes [9]. In these studies, institutions establish a biorepository of discarded blood samples which are linked to EHR data. DNA is extracted from collected samples and used to conduct genotype–phenotype association studies [3,10,11].

Many of these EHR-based observational studies employ a case-control design where a case population of patients with a disease are identified and a set of control patients are used for statistical comparisons. The validity of theses designs are quite sensitive to the methods used to select a comparison group. In an optimal scenario, selected controls should represent the population of individuals who would have been identified and included as cases had they also developed the disease used to define the cases [13]. One limitation of the EHR-based data sources, however, is data may be sparse and unequally collected across patient populations. This effect is determined, in part by the health status of the patient, since patients who are very ill and have been seen for longer periods of time have more information in the EHR than healthier people. This effect introduces a serious ascertainment bias [12,13] that may adversely impact the proper interpretation of EHR-based studies. For example, a case patient with a history of chronic disease X is much more likely to have recorded comorbidities or other potential study outcome than a control patient selected based on the absence of that chronic disease who may have had few encounters with the healthcare system due to lack of a recorded disease.

Thus the primary aim of a control matching algorithm relying on EHR data should be to find proper controls in the context of a heterogeneous patient population and inconsistent data collection that may confound results [14]. However, many case-control studies relying on EHR or insurance claims data only employ traditional methods to match based on patient age and gender [5]. Furthermore, the authors have been unable to identify methods for matching controls specifically targeted to EHR data in the published literature.

In this work we aim to investigate varying control matching approaches to improve the selection of controls in the EHR of a large health system. Cases are matched to 4 control groups of varying complexity ranging from randomly selected matches to matching based on a combination of demographic and healthcare utilization features. We evaluate our control matching methods by analyzing the comorbidity profile of two diseases related to inflammatory bowel disease (IBD): ulcerative colitis (UC) and Crohn’s disease (CD) using a reference standard created by a subject matter expert as well as by comparing distribution of comorbidities when comparing the cases against each control group. The detailed methods and source code of the matching algorithms evaluated in this work are made publicly available as open source software implemented on the Informatics for Integrating Biology and the Bedside (i2b2) platform.

The Partners HealthCare electronic health record (EHR) includes sociodemographic data, billing codes, laboratory results, problem lists, medications, vital signs, procedure reports and narrative notes from Massachusetts General Hospital (MGH) and Brigham and Women’s Hospital (BWH), as well as from community and specialty hospitals that are part of the Partners HealthCare system in Boston (Massachusetts, USA). All patients with at least one ICD-9 diagnosis code between January 1998 and April 2012 at MGH or BWH were selected for inclusion in a data set (referred to as a data ‘mart’), yielding 2.8million patients drawn from about 5million unique patients in the Partners system. The data mart consists of all electronic records for the study patients and can be managed with the i2b2 server software (i2b2 v1.6, Boston, MA, USA) [15,16]. The Partners Institutional Review Board approved all aspects of this study.

EHR phenotyping algorithms for Crohn’s disease (CD) and ulcerative colitis (UC) developed by Ananthakrishnan using the same data source were utilized to evaluate the matching algorithms in this study [17]. A sample of 1200 patients’ charts with a diagnoses of CD (ICD-9 555.∗) or UC (ICD-9 556.∗) were reviewed by a clinical expert to determine true disease status. Using the chart review results as a training dataset, a classification model for UC and CD was developed using coded data as well as structured elements derived from narrative notes through natural language processing (NLP). The CD and UC algorithms predicted cases with a fixed specificity of 97%, yielding a sensitivity of 69% and a positive predictive value of 98% for CD and a sensitivity of 79% and a positive predictive value of 97% for UC. The trained models were applied to the full population yielding 5506 patients with CD and 5522 patients with UC.

A set of 2,688,958 patients without a diagnosis of UC or CD in their medical record were selected for inclusion into a control pool. Each matching algorithm will randomly match case patients to patients selected from the control pool using the specified matching criteria.

For each patient in the case and control pool sets we extracted 3 demographic variables: age (A), gender (G), and race (R). In addition, 3 variables of healthcare utilization in the study period were calculated: number of facts (N), year of the first encounter in the healthcare system (F) and year of most recent encounter in the healthcare system (L). The number of facts refers to number of distinct encounters with the medical system and is a measure of health care utilization. For example, an office visit, a medication prescription, and a diagnosis code each contribute 1 fact. Gender and race groups were treated as categorical variables and matched exactly to control patients. Age was grouped into bins of decades of life (e.g. 0–9, 10–19). Healthcare utilization variables N, F and L were treated as continuous variables and divided into 8 quantile bins of uniform distribution (Table 1
                        ).

Each case patient was then matched to one patient in the control pool (1:1) using 3 different paired matching algorithms: age, race and gender (AGR), number of health “facts” and first and most recent observation (NFL); and all matching factors (AGRNFL). For each matching process, patients selected from the control pool were only matched to one case patient (1:1 matching) without replacement into control pool. Each case-control matched pair was then assigned a pair identifier for the matching analysis. Where there were insufficient controls to match all factors, the non-categorical matching factors were relaxed iteratively until an appropriate control is found. Since the control sampling uses a greedy algorithm – cases matched first are more likely to find an exact matched control – the order in which the cases were matched was also randomized.

For illustration, a hypothetical case patient that is 85years old, male, of Asian descent, with an observation period of 2001–2008 and 390 healthcare facts who is unable to find a control with the exact parameters would iteratively relax the matching parameters as follows: the age bin is relaxed downward one decile bin in an attempt to find a control aged 70–79 with other exact matching parameter bins. If none is found, the age bin is relaxed upward to find a control aged 90–99 with other exact parameter bins. Bins are only adjusted by 1 in either direction. If still no control is found, the number of facts bin is relaxed down one bin and then up one bin in the same way. The parameters are relaxed in this way until a control is found. If no control is found the case patient is discarded from the analysis. While a user can configure the algorithm to assign which parameters to relax, in which order and the number of bins to relax, for this paper we relax only the continuous parameters in the order A, N, F, L. Maximum adjustment of 1bin is used.

A detailed diagram of the matching protocol is described in the flowchart included in Fig. 1
                        . In addition, full source code and documentation for implementing the control matching methods in the i2b2 framework is available at https://community.i2b2.org/wiki/display/conmat/. The documentation contains additional details on methods utilized in this paper.

As an additional control, we randomly sampled patients from the control pool without any matching on factors. In this group, control patients were unmatched to the cases (random). As a sensitivity analysis and for additional comparisons patients were also matched by each factor alone.

A disease grouping file developed as part of the PheWAS research was downloaded in May 2013 [18]. PheWAS groupings are manually curated disease categories that generally follow the 3-digit code groupings within the ICD9 code system itself but modified to include semantically related groups. For example, all hypertension codes (401–405) are grouped together as one PheWAS grouping. For the purposes of this study, we pruned the PheWAS groups to exclude comorbidities with a frequency of less than 5 patients in either the cases or the matched controls were excluded from the analysis due to limited power to detect a true association. A total of 806 PheWAS groups were selected for inclusion in the analysis.

The magnitude of the association between the IBD-related diagnosis and a given comorbidity is based on the relative risk (RR) between the disease and comorbidity calculated by constructing 2×2 contingency tables for each PheWAS group. Statistical significance and 95% confidence intervals were calculated using the chi-squared test [19].

In order to evaluate each matching algorithms’ ability to discern clinically meaningful comorbidity association, a board-certified gastroenterologist (ANA) reviewed the full list of PheWAS disease groupings to indicate whether there existed prior literature demonstrating an association between the diagnosis and IBD in general. Identified comorbidities may have included associations due to IBD-related treatments to account for problems such as infections that are not directly associated with IBD, but could be associated with the immunosuppression medications taken for IBD. The resulting list was used as a reference set to empirically compare the results of our case-control analyses across the disease spectrum.

Each control set was compared to UC or CD case sets based on the matching parameters as well as selected common comorbidities in the general population. In addition, the distributions of all comorbidity relative risks (RR) were visualized and compared across control sets. The distributions of comorbidities reaching statistical significance by Bonferroni-adjusted p-value for each control set were also reported. The ability of each case-control experiment to detect likely comorbidity associations was evaluated by transforming the estimated RR and associated standard error into a binary indicator depending on whether the 95% confidence interval for the RR excluded or included unity. The transformed binary classifier was compared to the expert-derived reference and the sensitivity (SE), specificity (SP) and positive predictive value (PPV) was computed on the basis of statistical significance at alpha=0.05 and alpha=0.000062 (equal to Bonferroni correction for multiple comparisons across all 806 comorbidities).

@&#RESULTS@&#

The matching algorithm effectively matched controls to case patients using the matching factors described. Table 2
                     
                      compares the UC and CD case patients to the Random, AGR, NFL and AGRNFL matched controls on the basis of the demographic and healthcare utilization variables defined for matching. Notably, the patients not matched on NFL had far fewer encounters in the healthcare system. Even without matching, the gender distributions across the control sets generally matched the cases suggesting gender may not need to be included as a matching factor for UC and CD.


                     Table 3
                     
                      provides relative risk associations between UC and CD and selected comorbidities. In general, controls not matched on utilization factors had significant positive associations across all of the selected comorbidities whereas the AGRNFL and NFL matched sets had many fewer significant at alpha=0.05. Figs. 2 and 3
                     
                      plot the distributions of the significant comorbidities using the Random, AGR, NFL, and AGRNFL algorithms. The curves further indicate that a far greater number of associations are detected when controls are matched only on demographic (AGR) factors. Overall, the curves show the surprising tendency that when using only random or demographic based matching nearly all comorbidities are positively associated with UC and CD. Using the utilization corrected matches (NFL), the associations are far fewer and more evenly distributed between positive and negative associations. Indeed, there is a nominal decrease of negative associations when matching by all combined parameter AGRNFL when compared to matching on healthcare utilization parameters NFL without demographic parameters AGR.

The empirical assessment of comorbidity associations identified using a binary transformed RR emphasized the overall contributions of N, F, and L on the performance of each classifier (Table 4
                     ). For CD, the AGRNFL matching algorithm performed well with a specificity of 92.9% (95% CI: 90.1–95.0%), a sensitivity of 33.1% (95% CI: 25.1–42.1%) and a PPV of 56.0 (95% CI: 44.8–67.2%). In contrast, the AGR algorithm was far more sensitive at the expense of accuracy with a specificity of 54.6% (95% CI: 47.8–59.4%), a sensitivity of 78.8% (95% CI: 70.1–85.6%) and a PPV of 32.2 (95% CI 26.8–37.6%). Matched controls for UC performed similarly: the AGRNFL matching algorithm yielded a specificity of 92.0% (95% CI: 89.1–94.2%), a sensitivity of 29.9% (95% CI: 22.3–38.8%) and a PPV of 50.0 (95% CI: 38.8–61.2%). The AGR algorithm was again more sensitive with a specificity of 38.1% (95% CI: 33.6–42.9%), a sensitivity of 86.1% (95% CI: 78.1–91.6%) and a PPV of 26.8% (95% CI: 22.2–31.3%). Additional results evaluating matching based each factor alone is included in the supplemental materials (Tables S1–S4).

@&#DISCUSSION@&#

This study presents the result of a systematic, empirical evaluation of case-control matching algorithms using varying number of demographic and healthcare utilization factors. Our efforts assessed the validity of matching patients based on their overall usage of the healthcare system (and consequentially the documentation of their disease state) as evidenced by the ability to detect likely disease comorbidities defined by an expert-derived reference standard. We have demonstrated that matching patients on the number of diagnoses, procedures and medications has a significant effect on specificity and positive predictive value of detecting likely disease associations. Matching by both demographic and utilization factors improves the precision of association detection by nearly 75% compared to an unmatched control patients or controls matched by demographics alone.

As in most case-control studies, we want matched controls to be comparable to the cases without themselves having the study disease or risk factors known to be associated with the outcome. We want them to be a representative sample of the population that produced the cases to ensure that the distribution of exposure is the same between the two groups. We want to take into account criteria, such as age, gender and race that are often strong confounders of disease. Using the number of facts as a proxy for healthcare utilization, as we do in this method, is another way to promote comparability between the cases and controls. This is especially important when using hospital-based populations for selecting the cases and controls. When the hospital population is heterogeneous, as can occur in tertiary referral hospitals, it is difficult to ensure that the patients have the same exposure to opportunities for recording their disease state, leading to selection bias or confounding. Unfortunately, we do not have the consistent data collection for each patient that is common in clinical trials. This leads to an ascertainment bias that is inherent in every EHR-based observational study. We partially account for the heterogeneity of our population on this axis by matching on healthcare utilization. We use a variety of kinds of data to determine this metric (number of diagnoses, procedures and medications), which tend to minimize errors that might occur if one particular variable were unknowingly associated with the exposure.

Several limitations in our approach bear mentioning. First, the case-control design as performed may have inherent limits for detecting comorbidity associations. The matching process, though it can be very effective in controlling for confounding variables, requires effort to identify the correct confounders and to ensure that the method is applied correctly to achieve meaningful results. In addition, in contrast to a stratified analysis, a factor that has been matched on cannot be examined in terms of how it affects the outcome. Other potential problems could be that for some disease types there may be insufficient controls to match to cases and that matching on many variables may be statistically inefficient if we are not careful about which variables upon which to match.

Our approach for comparing the performance of matched controls also has drawbacks. While the reference standard was derived by clinical expert based on literature there may be some disagreement among gastroenterologists about true associations. However, as part of the goal of a PheWAS approach is to detect novel associations and patterns our aim was not to create a gold standard but to compare the ability of each matching algorithm to identify clinically meaningful associations that would be useful to a typical investigator hoping to leverage this data to advance understanding of a particular disease using EHR data from an active health system.

In addition, the results may vary across different disease types. For example, acute diseases or less well-defined phenotypes may perform differently. Nevertheless, we believe the methods described will be effective in detecting novel associations that can be validated with more traditional hypothesis-driven investigation.

Finally, the philosophical question of what constitutes an optimal control population is an ongoing one. Using hospital populations for matching may lead to selection of a number of sick controls that may introduce unknown confounders. Indeed, attempts to identify truly healthy controls with similar utilization distributions have identified less than 2% of the population [20].

The number of diagnoses, medications, and procedures is a crude indicator of both healthcare utilization and the completeness of recording of the disease state of the patient. Clearly, patient overall “sickness” is also being introduced as a comparator which can lead to deleterious matching effects. The presence of negative associations after NFL matching may be largely the result of this effect. If a patient with a serious disease is matched to a patient with an equally serious but different disease, the overall incident of alternative serious diseases will increase. We speculate that using more sophisticated measures of healthcare utilization, such as the clinic type, provider specialty, insurance type (as a proxy for socio economic status), and inpatient vs. outpatient status, will improve our ability to match like patients without introducing this effect.

In conclusion, the use of healthcare utilization factors to find adequate controls greatly enhanced the accuracy and utility of disease associated states found in the medical record. In this work, we present an implementation of a case-control matching algorithm using variables that can be easily derived in most EHR data sources and demonstrate the positive effect of finding controls with similar frequencies of the number of recorded diagnoses, medications, and procedures and their temporal distributions. Our work can be generalizable to a broad range of analyses using EHR data sources to detect novel disease associations. These matching methods developed may also be leveraged to detect drug–disease associations or identify and validate drug adverse effects.

@&#ACKNOWLEDGMENT@&#

We acknowledge Griffin Weber, MD for fruitful discussions related to this work.

Supplementary data associated with this article can be found, in the online version, at http://dx.doi.org/10.1016/j.jbi.2014.08.012.


                     
                        
                           Supplementary data 1
                           
                        
                     
                  

@&#REFERENCES@&#

