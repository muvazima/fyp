@&#MAIN-TITLE@&#Automatic balancing of 3D models

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We revisit a number of 3D print technologies and discuss their characteristics.


                        
                        
                           
                           We present an automatic, optimization based method for balancing 3D models.


                        
                        
                           
                           The balance is improved by creating internal cavities and by rotating the model.


                        
                        
                           
                           We pay special attention to make FDM printed models stand.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Rationalization

3D printing

Shape and topology optimization

Deformable Simplicial Complex method

@&#ABSTRACT@&#


               
               
                  3D printing technologies allow for more diverse shapes than are possible with molds and the cost of making just one single object is negligible compared to traditional production methods. However, not all shapes are suitable for 3D print. One of the remaining costs is therefore human time spent on analyzing and editing a shape in order to ensure that it is fit for production. In this paper, we seek to automate one of these analysis and editing tasks, namely improving the balance of a model to ensure that it stands. The presented method is based on solving an optimization problem. This problem is solved by creating cavities of air and distributing dense materials inside the model. Consequently, the surface is not deformed. However, printing materials with significantly different densities is often not possible and adding cavities of air is often not enough to make the model balance. Consequently, in these cases, we will apply a rotation of the object which only deforms the shape a little near the base. No user input is required but it is possible to specify manufacturing constraints related to specific 3D print technologies. Several models have successfully been balanced and printed using both polyjet and fused deposition modeling printers.
               
            

@&#INTRODUCTION@&#

Injection molding has been one of the important pillars of mass production throughout the twentieth century, continuing to this day. It is a method that allows us to create vast numbers of plastic parts each of which takes mere fractions of a second to produce. Nevertheless, recent years have seen a growing excitement around a number of other fabrication technologies referred to as additive manufacturing, or simply 3D print. While these processes are very different, they tend to share the common trait that they are far slower than molding when many objects are to be made but much faster at producing a single object since no mold is needed. Another important advantage of 3D print is that we are generally quite unconstrained when it comes to what shapes that can be produced, the main restriction being on the size of the object. This is in stark contrast to objects produced using a mold since we have to be able to extract the object from the mold. Thus, as the speed of 3D printing increases, we are likely to face a future with much more variety in the shapes of manufactured objects.

Because of the variety of shapes and the low cost of producing few objects, the time consuming part shifts from manufacturing to modeling, and from producing the object to designing the object. Furthermore, it is often desired that the designed model has suitable geometric characteristics. Recent years have seen quite a few examples of work related to the aspect of making a 3D shape suitable for fabrication, a process known as rationalization in architecture. In this paper, we are specifically concerned with automatically ensuring that objects are balanced and thus able to stand without support after production.

We make the following contributions. 
                        
                           1.
                           We revisit a number of 3D print technologies and discuss their characteristics and affordances and how these pertain to the problem of producing objects that are balanced.

We present an automatic, optimization based method for balancing 3D models. The 3D model is embedded in an adaptive tetrahedral mesh. The balance is then improved by creating internal cavities and by rotating the model around its base. Apart from rotation the exterior of the model is not changed.

While this method may be used to balance 3D objects regardless of the production method, we pay special attention to fused deposition modeling (FDM). FDM is a common, cheap technology with characteristics that would confound a method that did not take these characteristics into account.

Prévost et al.  [1] proposed a technique with the same capabilities as the presented method. However, it differs in nearly all particulars. With the presented method, cavities are generated by relabeling tetrahedra and moving internal surface nodes rather than labeling fixed cuboid voxels. Furthermore, Prévost et al. allow the user to equip the model with deformation handles used to perform automatic, affine transformations of parts of the model. While this strategy appears effective, it can make quite noticeable changes to the shape compared to a rotation around the base of the model which we propose.

The majority of 3D printing or additive manufacturing (AM) technologies operate by sequentially accumulating thin parallel layers of material in a vertical direction. As noted above, this provides great freedom in terms of 3D shape complexity. However, each different mechanism for realizing 3D printing involves quite different capabilities and constraints. These constraints are highly relevant to any algorithm which will attempt to alter a shape to satisfy some fabrication goal. Hence, we will review some properties relevant to the problem of making a shape stand.

The simplest case is when the model is printed completely solid. In this case, to balance a shape without deforming it our only recourse is to leave internal cavities. With printing technologies such as laser sintering (SLS), powder-bed, or stereolithography (SLA), printed support material will be trapped in any internal voids, and so escape holes (in some cases of considerable size) must be inserted into the model surface, or the model must be printed in parts and assembled. Each strategy is tedious and becomes increasingly intractable as the internal cavities grow in complexity.

A more complicated case is fused-deposition modeling (FDM), in which a thin stream of thermoplastic is extruded from a moving print head. This is the most common type of 3D printer today, in part because FDM has been rapidly commoditized in consumer hardware (Makerbot, RepRap, etc.). When using FDM, we have three types of regions (see Fig. 1
                     ): 
                        
                           1.
                           Shell: exterior and interior surfaces are printed solid.

Infill: the interior is printed with a sparse pattern.

Cavity: internal cavities may be empty, or may contain support structure.

Clearly, to balance a 3D object, it is critical to take the difference in density between infill and cavity into account. Further compounding this issue is that internal cavities are also surrounding by solid shells, so adding a cavity can actually result in a local increase in density. This complicates both the analysis and optimization, and the previous work has not taken this variable density into account  [1].

@&#METHOD@&#

In the following, we formulate the goal of balancing a 3D model, while making as few changes to the surface as possible, as an optimization problem. Consequently, the method is fully automatic. We will apply two optimization strategies. The first optimization strategy, hollowing (Section  3.1), creates cavities filled with a lighter or heavier material, for example air or copper inside a plastic model. Hollowing can also be used to simulate the infill and support structures created by FDM printers. Furthermore, it improves balance and does not deform the surface of the model. However, most 3D printers can only print in one material, or multiple materials with approximately the same density, and often cavities of air is not enough to make the model stand. Consequently, in these cases, a rotation around the base of the model will be applied (Section  3.2). The same rotation is applied to all surface nodes except the nodes which touch the ground. Therefore, the only deformation of the model will be close to the ground.

We assume that the initial 3D model is represented by a triangle surface mesh. Then, both the inside and the outside of the model are discretized into tetrahedral elements using TetGen  [2]. Here, the tetrahedra do not overlap and each point in the domain is either inside or on the boundary between tetrahedra. Consequently, the mesh, illustrated in Fig. 2
                     , is a simplicial complex. Furthermore, each tetrahedron has an associated material. The surface is then represented by the faces shared by two tetrahedra labeled with different materials. Therefore, the original and unchanged triangle mesh is embedded as a sub-complex in the tetrahedral mesh.

To be able to introduce cavities and deform a 3D model while maintaining its tetrahedral mesh representation, we will use the Deformable Simplicial Complex (DSC) method  [3]. The DSC method is a Lagrangian method for deformable surfaces, i.e. surface vertices are moved directly to deform the model. It then performs local updates to the tetrahedral mesh, moving, introducing, removing and reconnecting non-surface vertices to improve the quality. Thereby, the DSC method allows surfaces to deform while maintaining a sound tetrahedral mesh, even if topology changes occur, e.g. if two surfaces collide. Furthermore, the tetrahedra can be labeled with any number of labels which we will use to represent multiple materials. We also make use of the possibility to change the surface in discrete steps by relabeling tetrahedra. In 2D, the DSC method has previously been used for topology optimization  [4], but minimizing compliance instead of improving balance.

To be able to model the balance of the shape, we need the contact surface between the model and the ground. We call this the support surface and it consists of a set of faces 
                        
                           
                              F
                           
                           
                              s
                           
                        
                      on the surface of the model. The ground is represented by a plane spanned by the 
                        x
                     - and 
                        z
                     -axis such that the faces on the bottom of the shape coincide with this plane (see Fig. 2). We will then define the support point 
                        
                           s
                        
                      as 
                        
                           (1)
                           
                              
                                 s
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          f
                                          ∈
                                          
                                             
                                                F
                                             
                                             
                                                s
                                             
                                          
                                       
                                    
                                    
                                       
                                          A
                                       
                                       
                                          f
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    f
                                    ∈
                                    
                                       
                                          F
                                       
                                       
                                          s
                                       
                                    
                                 
                              
                              
                                 
                                    A
                                 
                                 
                                    f
                                 
                              
                              ⋅
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    f
                                 
                              
                           
                        
                      where 
                        
                           
                              A
                           
                           
                              f
                           
                        
                      is the area and 
                        
                           
                              
                                 c
                              
                           
                           
                              f
                           
                        
                      is the center of face 
                        f
                     . The support point always lies inside the convex hull of the support surface. This means that the model is guaranteed to stand if the center of gravity is directly above the support point. Consequently, we choose the horizontal squared distance between the center of gravity 
                        
                           c
                        
                        =
                        
                           
                              
                                 [
                                 
                                    
                                       c
                                    
                                    
                                       x
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       y
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       z
                                    
                                 
                                 ]
                              
                           
                           
                              T
                           
                        
                      and 
                        
                           s
                        
                        =
                        
                           
                              
                                 [
                                 
                                    
                                       s
                                    
                                    
                                       x
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       y
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       z
                                    
                                 
                                 ]
                              
                           
                           
                              T
                           
                        
                      as the objective function: 
                        
                           (2)
                           
                              f
                              
                                 (
                                 
                                    ρ
                                 
                                 ,
                                 
                                    p
                                 
                                 )
                              
                              =
                              
                                 
                                    
                                       (
                                       
                                          
                                             c
                                          
                                          
                                             x
                                          
                                       
                                       
                                          (
                                          
                                             ρ
                                          
                                          ,
                                          
                                             p
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             s
                                          
                                          
                                             x
                                          
                                       
                                       )
                                    
                                 
                                 
                                    2
                                 
                              
                              +
                              
                                 
                                    
                                       (
                                       
                                          
                                             c
                                          
                                          
                                             z
                                          
                                       
                                       
                                          (
                                          
                                             ρ
                                          
                                          ,
                                          
                                             p
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             s
                                          
                                          
                                             z
                                          
                                       
                                       )
                                    
                                 
                                 
                                    2
                                 
                              
                              .
                           
                        
                      Here, the center of gravity is 
                        
                           (3)
                           
                              
                                 c
                              
                              
                                 (
                                 
                                    ρ
                                 
                                 ,
                                 
                                    p
                                 
                                 )
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          e
                                       
                                    
                                    
                                       
                                          ρ
                                       
                                       
                                          e
                                       
                                    
                                    ⋅
                                    
                                       
                                          V
                                       
                                       
                                          e
                                       
                                    
                                    
                                       (
                                       
                                          p
                                       
                                       )
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    e
                                 
                              
                              
                                 
                                    ρ
                                 
                                 
                                    e
                                 
                              
                              ⋅
                              
                                 
                                    V
                                 
                                 
                                    e
                                 
                              
                              
                                 (
                                 
                                    p
                                 
                                 )
                              
                              ⋅
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    e
                                 
                              
                              
                                 (
                                 
                                    p
                                 
                                 )
                              
                           
                        
                      where 
                        
                           
                              V
                           
                           
                              e
                           
                        
                      is the volume and 
                        
                           
                              
                                 c
                              
                           
                           
                              e
                           
                        
                      is the barycenter of element 
                        e
                     . The center of gravity is both a function of the densities of the tetrahedral elements 
                        
                           ρ
                        
                        =
                        
                           
                              
                                 [
                                 …
                                 ,
                                 
                                    
                                       ρ
                                    
                                    
                                       e
                                    
                                 
                                 ,
                                 …
                                 ]
                              
                           
                           
                              T
                           
                        
                      and the positions of the nodes on the surfaces between two materials 
                        
                           p
                        
                        =
                        
                           
                              
                                 [
                                 …
                                 ,
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 …
                                 ]
                              
                           
                           
                              T
                           
                        
                     . We will change both the materials and surface positions to minimize the objective function.

Hollowing creates cavities filled with other materials than the material of the outer shell (Fig. 3
                        ). Furthermore, it does not change the shape of the model. This is ensured by applying a global constraint which enforces a minimum thickness of the outer shell of 
                           
                              
                                 T
                              
                              
                                 ∗
                              
                           
                        : 
                           
                              (4)
                              
                                 g
                                 
                                    (
                                    
                                       ρ
                                    
                                    ,
                                    
                                       p
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 max
                                 
                                    
                                       
                                          (
                                          
                                             
                                                T
                                             
                                             
                                                ∗
                                             
                                          
                                          −
                                          
                                             
                                                t
                                             
                                             
                                                n
                                             
                                          
                                          
                                             (
                                             
                                                ρ
                                             
                                             ,
                                             
                                                p
                                             
                                             )
                                          
                                          ,
                                          0
                                          )
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ≤
                                 0
                                 .
                              
                           
                         Here, 
                           
                              
                                 t
                              
                              
                                 n
                              
                           
                           
                              (
                              
                                 ρ
                              
                              ,
                              
                                 p
                              
                              )
                           
                         is the thickness of the shell at surface node 
                           n
                        . Note that 
                           g
                           
                              (
                              
                                 ρ
                              
                              ,
                              
                                 p
                              
                              )
                           
                         is one time differentiable w.r.t. each variable in 
                           
                              p
                           
                        . Hollowing consists of a material optimization step followed by a shape optimization step. These two steps are then iterated until changes are small.

The material optimization step determines the optimal material densities 
                           
                              
                                 
                                    ρ
                                 
                              
                              
                                 ∗
                              
                           
                           =
                           
                              
                                 
                                    [
                                    …
                                    ,
                                    
                                       
                                          ρ
                                       
                                       
                                          e
                                       
                                       
                                          ∗
                                       
                                    
                                    ,
                                    …
                                    ]
                                 
                              
                              
                                 T
                              
                           
                         for all tetrahedral elements such that the objective function in Eq. (2) is minimized subject to the constraint in Eq. (4). To determine 
                           
                              
                                 
                                    ρ
                                 
                              
                              
                                 ∗
                              
                           
                        , we estimate the change in the objective function when the material in element 
                           e
                         is changed from the current material with density 
                           
                              
                                 ρ
                              
                              
                                 e
                              
                           
                         to material 
                           m
                         with density 
                           
                              
                                 ρ
                              
                              
                                 m
                              
                           
                        . To efficiently compute these discrete derivatives of the objective function, we will use the approximation 
                           
                              (5)
                              
                                 f
                                 
                                    (
                                    
                                       
                                          
                                             ρ
                                          
                                       
                                       
                                          e
                                       
                                       
                                          m
                                       
                                    
                                    ,
                                    
                                       p
                                    
                                    )
                                 
                                 −
                                 f
                                 
                                    (
                                    
                                       ρ
                                    
                                    ,
                                    
                                       p
                                    
                                    )
                                 
                                 ≈
                                 
                                    
                                       ∂
                                       f
                                       
                                          (
                                          
                                             ρ
                                          
                                          ,
                                          
                                             p
                                          
                                          )
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             ρ
                                          
                                          
                                             e
                                          
                                       
                                    
                                 
                                 ⋅
                                 
                                    (
                                    
                                       
                                          ρ
                                       
                                       
                                          m
                                       
                                    
                                    −
                                    
                                       
                                          ρ
                                       
                                       
                                          e
                                       
                                    
                                    )
                                 
                              
                           
                         where 
                           
                              
                                 
                                    ρ
                                 
                              
                              
                                 e
                              
                              
                                 m
                              
                           
                         equals 
                           
                              ρ
                           
                         with 
                           
                              
                                 ρ
                              
                              
                                 e
                              
                           
                         replaced by 
                           
                              
                                 ρ
                              
                              
                                 m
                              
                           
                        . Then, among the 
                           
                              
                                 N
                              
                              
                                 m
                              
                           
                         predefined material densities 
                           
                              
                                 ρ
                              
                              
                                 m
                              
                           
                           ∈
                           
                              {
                              
                                 
                                    ρ
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    ρ
                                 
                                 
                                    
                                       
                                          N
                                       
                                       
                                          m
                                       
                                    
                                 
                              
                              }
                           
                         which satisfies 
                           
                              (6)
                              
                                 g
                                 
                                    (
                                    
                                       
                                          
                                             ρ
                                          
                                       
                                       
                                          e
                                       
                                       
                                          m
                                       
                                    
                                    ,
                                    
                                       p
                                    
                                    )
                                 
                                 −
                                 g
                                 
                                    (
                                    
                                       ρ
                                    
                                    ,
                                    
                                       p
                                    
                                    )
                                 
                                 ≤
                                 0
                              
                           
                         we find 
                           
                              (7)
                              
                                 
                                    
                                       ρ
                                    
                                    
                                       e
                                    
                                    
                                       ∗
                                    
                                 
                                 =
                                 
                                    
                                       arg
                                       min
                                    
                                    
                                       
                                          
                                             ρ
                                          
                                          
                                             m
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∂
                                       f
                                       
                                          (
                                          
                                             ρ
                                          
                                          ,
                                          
                                             p
                                          
                                          )
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             ρ
                                          
                                          
                                             e
                                          
                                       
                                    
                                 
                                 ⋅
                                 
                                    (
                                    
                                       
                                          ρ
                                       
                                       
                                          m
                                       
                                    
                                    −
                                    
                                       
                                          ρ
                                       
                                       
                                          e
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         When 
                           
                              
                                 
                                    ρ
                                 
                              
                              
                                 ∗
                              
                           
                         has been determined, the material in element 
                           e
                         is changed to the material with density 
                           
                              
                                 ρ
                              
                              
                                 e
                              
                              
                                 ∗
                              
                           
                         by relabeling the element using the DSC method. Note that the positions of the surface nodes 
                           
                              p
                           
                         are kept fixed during this step.

The shape optimization step first determines improved positions 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ∗
                              
                           
                           =
                           
                              
                                 
                                    [
                                    …
                                    ,
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          n
                                       
                                       
                                          ∗
                                       
                                    
                                    ,
                                    …
                                    ]
                                 
                              
                              
                                 T
                              
                           
                         for all internal surface nodes such that the objective function is minimized subject to the shell thickness constraint in Eq. (4). Notice that the outer surface nodes are not a part of the optimization variables 
                           
                              p
                           
                         in this step. Consequently, only the shape of the internal cavities is deformed. To determine 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ∗
                              
                           
                        , we first realize that changing the position of a surface node in the tangent directions will not change the shape much. Consequently, to reduce the number of optimization variables, we associate one design variable 
                           
                              
                                 x
                              
                              
                                 n
                              
                           
                         with each surface node 
                           n
                        . This variable is related to the position by 
                           
                              (8)
                              
                                 
                                    p
                                 
                                 
                                    (
                                    
                                       x
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          [
                                          …
                                          ,
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                n
                                             
                                          
                                          +
                                          
                                             
                                                x
                                             
                                             
                                                n
                                             
                                          
                                          ⋅
                                          
                                             
                                                
                                                   n
                                                
                                             
                                             
                                                n
                                             
                                          
                                          ,
                                          …
                                          ]
                                       
                                    
                                    
                                       T
                                    
                                 
                              
                           
                         where 
                           
                              
                                 
                                    n
                                 
                              
                              
                                 n
                              
                           
                         is the normal of node 
                           n
                         and 
                           
                              x
                           
                           =
                           
                              
                                 
                                    [
                                    …
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          n
                                       
                                    
                                    ,
                                    …
                                    ]
                                 
                              
                              
                                 T
                              
                           
                        . To determine 
                           
                              
                                 
                                    x
                                 
                              
                              
                                 ∗
                              
                           
                           =
                           
                              
                                 
                                    [
                                    …
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          n
                                       
                                       
                                          ∗
                                       
                                    
                                    ,
                                    …
                                    ]
                                 
                              
                              
                                 T
                              
                           
                         and thereby 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ∗
                              
                           
                           =
                           
                              p
                           
                           
                              (
                              
                                 
                                    
                                       x
                                    
                                 
                                 
                                    ∗
                                 
                              
                              )
                           
                        , we solve the smooth optimization problem 
                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                ∗
                                             
                                          
                                          =
                                          
                                             
                                                arg
                                                min
                                             
                                             
                                                
                                                   x
                                                
                                             
                                          
                                       
                                       
                                          :
                                          f
                                          
                                             (
                                             
                                                ρ
                                             
                                             ,
                                             
                                                p
                                             
                                             
                                                (
                                                
                                                   x
                                                
                                                )
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          subject to
                                       
                                       
                                          :
                                          g
                                          
                                             (
                                             
                                                ρ
                                             
                                             ,
                                             
                                                p
                                             
                                             
                                                (
                                                
                                                   x
                                                
                                                )
                                             
                                             )
                                          
                                          ≤
                                          0
                                       
                                    
                                    
                                       
                                       
                                          :
                                          
                                             x
                                          
                                          ∈
                                          
                                             [
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                
                                                   
                                                      min
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                
                                                   
                                                      max
                                                   
                                                
                                             
                                             ]
                                          
                                       
                                    
                                 
                              
                           
                         where the material densities 
                           
                              ρ
                           
                         are fixed. Furthermore, the design variables are constrained such that the tetrahedra will not degenerate when solving the optimization problem. However, as a consequence, the deformations can only be small. This is remedied by repeating this and the material optimization step. We choose the gradient-based optimization algorithm method of moving asymptotes (MMA)  [5] to solve the optimization problem in Eq. (9). Then, when 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ∗
                              
                           
                           =
                           
                              p
                           
                           
                              (
                              
                                 
                                    
                                       x
                                    
                                 
                                 
                                    ∗
                                 
                              
                              )
                           
                         is computed, each surface node 
                           n
                         is moved from the current position 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 n
                              
                           
                         to 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 n
                              
                              
                                 ∗
                              
                           
                         by the DSC method, i.e. without ruining the simplicial complex.

In addition to hollowing, we will apply a rotation of the model except at the support surface such that the objective function is minimized (Fig. 4
                        ). This will introduce an undesired deformation at the base of the model. However, this problem is greatly mitigated by the fact that we rotate around the support point. Consequently, the surface movement is smallest near the support. Furthermore, an initial hollowing often means that only a very small angle of rotation is needed.

Rotation consists of repeating a rotation optimization step. This step determines an improved position 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ∗
                              
                           
                           =
                           
                              
                                 
                                    [
                                    …
                                    ,
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          n
                                       
                                       
                                          ∗
                                       
                                    
                                    ,
                                    …
                                    ]
                                 
                              
                              
                                 T
                              
                           
                         for all surface nodes except those that are touching the ground. We will make a change of variable such that 
                           
                              (10)
                              
                                 
                                    p
                                 
                                 
                                    (
                                    ϕ
                                    ,
                                    θ
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          [
                                          …
                                          ,
                                          
                                             s
                                          
                                          +
                                          
                                             R
                                          
                                          
                                             (
                                             ϕ
                                             ,
                                             θ
                                             )
                                          
                                          ⋅
                                          
                                             (
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   n
                                                
                                             
                                             −
                                             
                                                s
                                             
                                             )
                                          
                                          ,
                                          …
                                          ]
                                       
                                    
                                    
                                       T
                                    
                                 
                                 .
                              
                           
                         Here, 
                           ϕ
                         and 
                           θ
                         are the rotation angles around the 
                           x
                        - and 
                           z
                        -axis respectively and 
                           
                              R
                           
                           
                              (
                              ϕ
                              ,
                              θ
                              )
                           
                         is a 3×3 rotation matrix. The improved positions 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ∗
                              
                           
                           =
                           
                              p
                           
                           
                              (
                              
                                 
                                    ϕ
                                 
                                 
                                    ∗
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    ∗
                                 
                              
                              )
                           
                         are then found by solving the smooth optimization problem
                           
                              (11)
                              
                                 
                                    
                                       
                                          
                                             
                                                ϕ
                                             
                                             
                                                ∗
                                             
                                          
                                          ,
                                          
                                             
                                                θ
                                             
                                             
                                                ∗
                                             
                                          
                                          =
                                          
                                             
                                                arg
                                                min
                                             
                                             
                                                ϕ
                                                ,
                                                θ
                                             
                                          
                                       
                                       
                                          :
                                          f
                                          
                                             (
                                             
                                                ρ
                                             
                                             ,
                                             
                                                p
                                             
                                             
                                                (
                                                ϕ
                                                ,
                                                θ
                                                )
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          subject to
                                       
                                       
                                          :
                                          ϕ
                                          ∈
                                          
                                             [
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   
                                                      min
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   
                                                      max
                                                   
                                                
                                             
                                             ]
                                          
                                       
                                    
                                    
                                       
                                       
                                          :
                                          θ
                                          ∈
                                          
                                             [
                                             
                                                
                                                   θ
                                                
                                                
                                                   
                                                      min
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                
                                                   
                                                      max
                                                   
                                                
                                             
                                             ]
                                          
                                          .
                                       
                                    
                                 
                              
                           
                         Again, the densities 
                           
                              ρ
                           
                         are fixed and the optimization variables 
                           ϕ
                         and 
                           θ
                         are constrained such that tetrahedra does not become degenerate when solving Eq. (11). The optimization problem is solved using MMA  [5] before moving each surface node 
                           n
                         from the current position 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 n
                              
                           
                         to 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 n
                              
                              
                                 ∗
                              
                           
                         by the DSC method. Surface nodes which move below the ground plane are clamped to the ground plane while any discretization problems are handled by the DSC method.

@&#EXPERIMENTS@&#

In this section we conduct a series of experiments using different printing technologies. We focused on three models: a deformed version of the standard kitten model, a variant of the well-known Armadillo model where we attached a larger head, and a model consisting of five connected spheres. In each case the model was sized to be initially 60 mm in the vertical direction. Each model was initially unbalanced, regardless of printing technology, and we use a 
                        
                           
                              T
                           
                           
                              ∗
                           
                        
                        =
                        1
                        
                        
                           mm
                        
                      shell thickness in all optimizations.

To test solid/air configurations, we used a Stratasys Connex 260 printer. This printer fills internal cavities with a flexible support material which must be removed using a water-jet system. The support was removed by slicing the models with planar cuts that intersected the cavities, and then glued them back together after cleaning. In addition, we used a Stratasys Mojo printer. Here, the support material was dissolved in a water-based solution. This eliminates the need for assembling; instead, it requires holes in the model for the solution to enter the cavities. These holes are created in the model before printing but after optimization.


                     The kitten model (Fig. 5
                     ) was successfully balanced via internal cavities of air generated with our hollowing strategy. Balancing via rotation was also successful though it introduces large deformations to the base of the model. As expected based on the results of the optimization, the prints are very stable.


                     The armadillo–dog model (Fig. 6
                     ) could not be balanced strictly by creating cavities of air. However, a combination of cavities and rotation was successful. As expected, a rotation-only strategy was also effective but less rotation, and thereby less deformation of the feet is necessary if preceded by hollowing.


                     The five-spheres model (Fig. 7
                     ) was similar in that air cavities were insufficient due to the very small support surface. The combination of cavities and rotation was successful, as was the rotation-only case (Fig. 4).

To test our variable-density optimization, we used a Makerbot Replicator 2 FDM-style 3D printer, with standard Makerbot PLA filament. As previously discussed, use of this printer is complicated by the fact that the model does not have uniform density, and interior cavities may contain support structures. The printing software permits us to specify the infill density and the density of support structures as global values. However, since the Makerbot uses a single print material, these settings are only suggestions to the algorithm that generates the tool path. To validate the relationship between the infill density parameter and the resulting density of the infill structure, we performed an experiment in which we printed a 
                        40
                        
                        
                           
                              
                                 mm
                              
                           
                           
                              3
                           
                        
                      half-cube (sliced diagonally). By comparing to a hollow print, we could observe the following relationships between infill parameter and physical infill density 5%/7%, 10%/12%, 20%/22% for three test cases. Based on these results we assume that the infill parameter is an adequate estimate of infill density and use it in the optimization. For the support structures, the actual toolpath is highly context-dependent. The filament pattern depends not only on the cavity shape, but also alignment with an underlying grid. Furthermore, to save material and make the support easier to break away, the software randomly skips layers in the support structure. The result is extremely complicated to analyze without actually generating the infill toolpath, which was intractable to include in our optimization. Hence, we assume that the specified support density parameter is a worst-case value and use it directly in the optimization as the density of cavities of air. We could also disable support structures entirely; however, this introduces a risk of print failure.

We performed extensive experimentation on the kitten model (Fig. 8
                     ), varying both the infill and cavity density. At zero cavity density, we could successfully balance the kitten even at 10% infill. At 5% cavity density, infill had to be increased to 30%, and even at that point the actual print was on the edge of being unbalanced. At 10% cavity density, we had to increase infill to 50% before we could achieve balance in the printed result.


                     The five-spheres model (Fig. 7) did not allow for balancing with non-zero cavity density using hollowing. However if we included rotation, we could easily achieve balance with 10% cavity and 25% infill density and with zero cavity and 25% infill density.

@&#CONCLUSION@&#

We have presented and illustrated an automatic method for deforming a 3D model to ensure it will stand when manufactured using a 3D printer. Our method embeds the original model directly in an adaptive tetrahedral mesh. Consequently, the shape of the model is not deformed at initialization and neither when the method creates cavities of lighter and heavier materials inside the model using hollowing. Furthermore, the ability to take multiple materials into account in the hollowing process makes it possible to simulate the infill and support structures of the popular FDM type of 3D printers. Unfortunately, hollowing is often not sufficient to make a model stand and for FDM type printers the issue is generally worse. Therefore, deformation of the outer surface of the model is often essential as previously reported  [1]. Our approach has been to rotate around the base of the model. Fortunately, the needed rotations are often small, especially when hollowing has already been applied. Therefore, the rotation strategy has proven to be quite effective, despite its simplicity. Furthermore, the objective function is convex, the method iteratively approaches an optimum and the rotation step is unconstrained. Hence, we claim that the optimization will always converge and, as a consequence, the method is able to balance any 3D model. This claim is supported by the presented test cases; however, it has not been proven.

Should any kind of change to the exterior surface be undesired, the future may bring us some more options. In particular, we hope it will be possible to print in materials with significantly different densities. Three examples are presented in Fig. 9
                      where cavities of glass, copper and gold respectively are created inside a plastic model in addition to cavities of air.

A limitation of our method is that we do not model the support structures inside a model intended for FDM print accurately. One extension that could allow for fully void cavities inside FDM prints would be to control the shape of the upper portions of the cavities. If all surfaces on the cavity boundary satisfied the overhang draft angle constraint, then no support would be needed to print them. Alternatively, cavities with flat tops could be printed without support using the bridging capabilities of FDM printing, in which the print head moves rapidly to lay down a horizontal scaffold on which to print additional layers.

@&#ACKNOWLEDGMENT@&#

The authors appreciate the support from the Villum Foundation through the grant: “NextTop”.

@&#REFERENCES@&#

