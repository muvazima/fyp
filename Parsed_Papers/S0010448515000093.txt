@&#MAIN-TITLE@&#Shape reconstruction from a normal map in terms of uniform bi-quadratic B-spline surfaces

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           The mathematical formulation of our method is simple.


                        
                        
                           
                           The computation is not only accurate but also fast.


                        
                        
                           
                           Less memory is required to store the data.


                        
                        
                           
                           Aesthetic surfaces are generated via direct editing of normal vectors.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Surface from gradients

Normal map

Uniform B-spline

Photometric stereo

Differential geometry

Editing of normal map

@&#ABSTRACT@&#


               Graphical abstract
               
                  
                     
                        
                           
                        
                     
                  
               
            


                        
                           
                              (14)
                              
                                 
                                    [
                                    
                                       
                                          
                                             −
                                             
                                                
                                                   27
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   33
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   3
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             
                                                
                                                   9
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   11
                                                
                                                
                                                   64
                                                
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   9
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             
                                                
                                                   11
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   256
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   27
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             
                                                
                                                   9
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   9
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   33
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   11
                                                
                                                
                                                   64
                                                
                                             
                                          
                                          
                                             
                                                
                                                   11
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   3
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   256
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   9
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   11
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   1
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   9
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   11
                                                
                                                
                                                   64
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   1
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   27
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             
                                                
                                                   33
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   3
                                                
                                                
                                                   256
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   3
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   33
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   11
                                                
                                                
                                                   64
                                                
                                             
                                          
                                          
                                             
                                                
                                                   11
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   27
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             
                                                
                                                   9
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   9
                                                
                                                
                                                   256
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   3
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   33
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   27
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   11
                                                
                                                
                                                   64
                                                
                                             
                                          
                                          
                                             
                                                
                                                   9
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             
                                                
                                                   11
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   9
                                                
                                                
                                                   256
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   9
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   9
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   27
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   11
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   11
                                                
                                                
                                                   64
                                                
                                             
                                          
                                          
                                             
                                                
                                                   33
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   1
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   1
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   3
                                                
                                                
                                                   256
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   1
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   11
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   9
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   1
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   11
                                                
                                                
                                                   64
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   9
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   3
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             
                                                
                                                   33
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   27
                                                
                                                
                                                   256
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   1
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   1
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   3
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   11
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   11
                                                
                                                
                                                   64
                                                
                                             
                                          
                                          
                                             
                                                
                                                   33
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   9
                                                
                                                
                                                   256
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   9
                                                
                                                
                                                   128
                                                
                                             
                                          
                                          
                                             
                                                
                                                   27
                                                
                                                
                                                   256
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   00
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   01
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   02
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   10
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   11
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   12
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   20
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   21
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   22
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             −
                                             
                                                
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         00
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         00
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         00
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         00
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         10
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         10
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         10
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         10
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         01
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         01
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         01
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         01
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         11
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         11
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         11
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         11
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                              
                           
                        
                     

@&#INTRODUCTION@&#

​ This study is motivated by two modern technological needs namely, the recovery of the height field function of an object from its surface normal vectors obtained by photometric stereo techniques, and the introduction of new design methodology of streamlined aesthetic surfaces through the direct editing of normal vectors.

Photometric stereo techniques, which were introduced by Woodham  [1,2], recover surface normals of an object on a per-pixel basis from a set of images captured from a fixed viewpoint under various lighting directions (see Figs. 1 and 12
                     ). In other words, photometric stereo estimates shape information in the form of surface orientation. Recently, Johnson et al.  [3] developed a system for capturing microscopic surface geometry using photometric stereo technique. When only one image is used for the reconstruction, it is known as shape from shading  [4]. A good survey of photometric stereo is given in  [5].

The estimated surface normals are stored as an RGB image known as a normal map, where the RGB components correspond to the 
                        x
                        ,
                        y
                        ,
                        z
                      components of the surface normal as shown in Fig. 1(b). There are two major steps in photometric stereo techniques: normal reconstruction from images, and the height field function 
                        z
                        =
                        f
                        
                           (
                           x
                           ,
                           y
                           )
                        
                      recovery from normals. In this paper we focus on the latter problem, i.e. the height field function recovery.

The essential problem in designing a propeller blade from the hydrodynamics perspective is to find a so-called camber surface which carries a prescribed load distribution such that the kinematic boundary condition 
                        
                           V
                        
                        ⋅
                        
                           N
                        
                        =
                        0
                      is satisfied on that surface in the presence of a given flow, where 
                        
                           V
                        
                      is the flow velocity vector and 
                        
                           N
                        
                      is the surface normal vector  [6]. Meanwhile free-form surfaces used in the bodies of aircrafts, high-speed trains, and automobiles have to satisfy aerodynamic functionality as well as attractive shape requirements. Although it is not easy to specify the airflow directions at the grid points, we can at least determine the tangent plane of the surface where the airflow lies at each grid point via specifying the normal vector. If the existing designs of streamlined aesthetic surfaces are available from previous designs, in whole or part, we are able to generate new designs through the direct editing of normal vectors of the input surface. In other words, we extract unit normal vectors at the grid points of the input surface, and modify them to generate a new design by computing the height field function.

In this paper, we introduce a novel method to reconstruct the explicit surface of an object in terms of a 
                        
                           
                              C
                           
                           
                              1
                           
                        
                      continuous B-spline function above the 
                        x
                        y
                     -plane based on the normal map of the object as illustrated in Fig. 1(c) and (d). B-splines have become the de facto industry standard  [7] for representing geometric information in the CAD/CAM/CAE fields. Once objects are represented in a B-spline form, they can be used in a number of downstream applications, including numerically controlled (NC) machining  [8], isogeometric analysis  [9], and surface interrogation  [8].

Our mathematical formulation for explicit surface reconstruction is based on differential geometry and geometric modeling techniques. It is a well-known fact in differential geometry that any regular surface can be locally approximated in the neighborhood of a point by a quadratic height function  [10,11]. Meanwhile the normal map generated by the photometric stereo technique stores a surface normal at each pixel, and this map is arranged over a uniform two-dimensional grid. Hence, it is natural to represent a unit segment of the height field function of an object by a graph of uniform bi-quadratic B-spline functions. Although in this study we restrict the degree of the uniform B-spline to be bi-quadratic, it can be easily extended to higher degree surfaces.

In summary, the proposed method has the following advantages over existing methods: 
                        
                           •
                           The mathematical formulation involves only first-order derivatives of polynomial functions, and is conceptually simple.

The computation is fast and accurate.

The output is a 
                                 
                                    
                                       C
                                    
                                    
                                       1
                                    
                                 
                               continuous uniform bi-quadratic B-spline surface, which requires less memory to store, and can be used for a number of downstream applications, including NC machining, isogeometric analysis, and surface interrogation.

@&#RELATED WORK@&#

In this section, our literature review focuses only on studies on the recovery of the height field function from the input normal map; it is not our intent to conduct a literature review on photometric stereo methods. Matsushita et al.  [5] provide an excellent review of previous work on photometric stereo. Readers should refer to the references therein.

The most intuitive way to recover the height function 
                        z
                        =
                        h
                        
                           (
                           x
                           ,
                           y
                           )
                        
                      is to integrate the infinitesimal changes in 
                        z
                     , i.e., 
                        δ
                        z
                        =
                        p
                        δ
                        x
                        +
                        q
                        δ
                        y
                     , along a curve from a start to an end point, where 
                        p
                      and 
                        q
                      are the given estimates of the gradient. However, when the given surface normals are noisy, the integration may depend on the path taken  [12].

Horn and Brooks  [4] found the height 
                        z
                      by solving the Poisson equation. The Poisson equation is derived by applying the Euler–Lagrange equation to the error functional 
                        
                           (1)
                           
                              
                                 
                                    ∬
                                 
                                 
                                    Ω
                                 
                              
                              
                                 {
                                 
                                    
                                       
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                x
                                             
                                          
                                          −
                                          p
                                          )
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                y
                                             
                                          
                                          −
                                          q
                                          )
                                       
                                    
                                    
                                       2
                                    
                                 
                                 }
                              
                              d
                              x
                              
                              d
                              y
                              ,
                           
                        
                      leading to 
                        
                           (2)
                           
                              
                                 
                                    ∇
                                 
                                 
                                    2
                                 
                              
                              z
                              =
                              
                                 
                                    p
                                 
                                 
                                    x
                                 
                              
                              +
                              
                                 
                                    q
                                 
                                 
                                    y
                                 
                              
                              ,
                           
                        
                      where subscripts 
                        x
                      and 
                        y
                      denote partial differentiation. An iterative method is used to solve the Poisson equation (2) at each grid point.

Frankot and Chellappa  [13] extended the iterative method of Horn and Brooks  [4] by applying the integrability projection constraint using Fourier basis functions, and this led to faster convergence with less error. The integrability is defined by 
                        
                           
                              z
                           
                           
                              x
                              y
                           
                        
                        
                           (
                           x
                           ,
                           y
                           )
                        
                        =
                        
                           
                              z
                           
                           
                              y
                              x
                           
                        
                        
                           (
                           x
                           ,
                           y
                           )
                        
                     . As a result, the surface height at any point is independent of the order of differentiation. Although normal vectors consist of only first-order derivatives of 
                        z
                     , the formulation of these methods involves second-order partial derivatives. This is inefficient and, as we shall see in Section  3, unnecessary for our formulation. In  [14], a direct analytical solution based on the Poisson equation was proposed, and Kovesi  [15] used localized wavelet basis functions (referred to as shapelets) rather than the Fourier basis functions in the method of Frankot and Chellappa  [13].

Agrawal et al.  [16] proposed a purely algebraic approach to enforcing integrability in a discrete domain, which can be formulated as solving a linear system over the image. Agrawal et al.  [17] presented a broader framework in which several approaches are generalized by the same objective function. They represented a continuum of surface reconstructions of a given non-integrable gradient field based on the degree of anisotropy in assigning weights to the gradients during the integration. Binary weights are used to obtain a 
                        α
                     -surface, where 
                        α
                      allows for a trade-off between smoothness and robustness, whereas continuous weights are used for 
                        M
                     -estimator and Regularization, and an affine transformation of the gradients is used for Diffusion. They concluded that the Diffusion method and 
                        α
                     -surface give consistently better feature-preserving reconstructions.

Nehab et al.  [18] presented a hybrid algorithm that produces a surface that optimally conforms to given surface positions and normals. The positions are measured by two cameras capturing synchronized images while a projector flashes random stripes at the object. The normal vectors are acquired from pictures taken by one of the cameras under the illumination of five different calibrated light sources. First, the normals are improved using the positions, and then the geometry is optimized to conform to both the corrected normals and the measured positions.

Harker and O’Leary  [19] formulated the reconstruction of a discrete surface whose gradients are equal to the measured gradients in a least squares sense. The solution is shown to satisfy the Lyapunov equation.

Wu et al.  [20] introduced an interactive system for reconstructing surface normals from a single image. A novel shape from shading algorithm is used to reconstruct high frequency components of the surface normal. Then, the low-frequency components of the normal are corrected using a so-called rotation palette technique. They reconstructed the height field of the object by minimizing the error 
                        E
                        =
                        
                           
                              Σ
                           
                           
                              i
                              ,
                              j
                           
                        
                        
                           
                              
                                 (
                                 
                                    (
                                    
                                       
                                          h
                                       
                                       
                                          i
                                       
                                    
                                    −
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                    )
                                 
                                 −
                                 
                                    
                                       q
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 )
                              
                           
                           
                              2
                           
                        
                     , where 
                        
                           
                              h
                           
                           
                              i
                           
                        
                      and 
                        
                           
                              h
                           
                           
                              j
                           
                        
                      are the heights at the first-order neighboring pair pixels 
                        i
                      and 
                        j
                     . The relative height 
                        
                           
                              q
                           
                           
                              i
                              j
                           
                        
                      between 
                        i
                      and 
                        j
                      is obtained by fitting an osculating circular arc (OCA) between the two projected normals onto a vertical plane. The method is stable even if the 
                        z
                     -component of the estimated normal is small. However, the osculating circular arc model overlooks the fact that any regular surface can be approximated in the neighborhood of a point by a quadratic height function of the form 
                        z
                        =
                        a
                        
                           
                              x
                           
                           
                              2
                           
                        
                        +
                        b
                        x
                        y
                        +
                        c
                        
                           
                              y
                           
                           
                              2
                           
                        
                        [10] and not by osculating circular arcs.

Wu et al.  [21] captured a dense set of input images using a digital video camera while a hand-held spotlight was being moved around the object and a small spherical mirror. They simplified the optimization problem into a two-step Expectation–Maximization approach. First, the weight of each observation is alternately optimized with the normal and albedo at each pixel, and then the surface integrabilities and discontinuities are alternately optimized in surface reconstruction using the optimized normals and by employing Markov Random Fields.

Balzer and Mörwald  [22] solve Poisson’s equation (2) using isogeometric analysis  [9], a variant of finite element analysis that operates on B-spline patches. Although the output of the computation are B-spline patches, their formulation relies on the second-order partial differential equations, which is inefficient and unnecessary, as normal vectors consist of only first-order derivatives.

Ng et al.  [23] employ Gaussian kernel basis functions to reconstruct continuous surface. However, the reconstruction based on Gaussian kernel basis functions is not compatible with the current CAD/CAM systems, thus its output is a triangular mesh. Furthermore, they are conceptually more complex and computationally slower than the reconstruction based on B-spline basis functions.

In summary, our method is conceptually simpler than the Poisson equation based formulation. Moreover, our method generates a 
                        
                           
                              C
                           
                           
                              1
                           
                        
                      continuous height function, above 
                        x
                        y
                     -plane, while most of the other methods compute heights only at discrete grid points. Furthermore, our method is computationally faster and requires less memory to store data than existing methods. This is because our method represents four pixels by a single B-spline patch, whereas existing methods formulate the linear system for each pixel.

Let us first define the uniform grid points with unit length spanning from −1 to 
                           M
                           +
                           1
                         and −1 to 
                           N
                           +
                           1
                         in the 
                           u
                         and 
                           v
                         directions, respectively, where 
                           M
                         and 
                           N
                         are even integers. We assume that each image consists of 
                           M
                           ×
                           N
                         pixels, and its corresponding parameter space is 
                           
                              (
                              u
                              ,
                              v
                              )
                           
                           ∈
                           
                              [
                              0
                              ,
                              M
                              ]
                           
                           ×
                           
                              [
                              0
                              ,
                              N
                              ]
                           
                        . We further assume that the photometric stereo technique recovers the surface normals (surface orientations) of an object at the center of each image pixel, as shown in Fig. 2
                        . Our reconstruction strategy is to formulate a system of linear equations by equating the four normal vectors of every 2×2 pixel block shown in Fig. 2(a) with the corresponding surface normals of the uniform bi-quadratic B-spline patch (see Fig. 2(b)). We assume that the height function 
                           z
                           =
                           h
                           
                              (
                              u
                              ,
                              v
                              )
                           
                         of the object corresponding to the four pixels can be expressed as 
                           
                              (3)
                              
                                 z
                                 =
                                 h
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       0
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       h
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                    
                                 
                                 
                                    (
                                    v
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 N
                              
                              
                                 0
                              
                           
                           
                              (
                              t
                              )
                           
                           ,
                           
                              
                                 N
                              
                              
                                 1
                              
                           
                           
                              (
                              t
                              )
                           
                           ,
                           
                              
                                 N
                              
                              
                                 2
                              
                           
                           
                              (
                              t
                              )
                           
                         are the uniform quadratic B-spline basis functions defined over the knots 
                           
                              [
                              −
                              4
                              ,
                              −
                              2
                              ,
                              0
                              ,
                              2
                              ,
                              4
                              ,
                              6
                              ]
                           
                         restricted to the interval 
                           
                              [
                              0
                              ,
                              2
                              ]
                           
                        . The quadratic basis functions, depicted in Fig. 3
                        , are given by 
                           
                              (4)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   0
                                                
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                             −
                                             
                                                
                                                   t
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   8
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   t
                                                
                                                
                                                   2
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   4
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   8
                                                
                                             
                                          
                                       
                                    
                                    }
                                 
                                 ,
                                 
                                 0
                                 ≤
                                 t
                                 ≤
                                 2
                                 ,
                              
                           
                         where we note that 
                           
                              
                                 N
                              
                              
                                 0
                              
                           
                           
                              (
                              t
                              )
                           
                           +
                           
                              
                                 N
                              
                              
                                 1
                              
                           
                           
                              (
                              t
                              )
                           
                           +
                           
                              
                                 N
                              
                              
                                 2
                              
                           
                           
                              (
                              t
                              )
                           
                           =
                           1
                        . According to Prautzsch et al.  [24], parameters 
                           u
                         and 
                           v
                         can be expressed by linear combinations of degree 
                           n
                         B-spline functions 
                           
                              
                                 N
                              
                              
                                 i
                              
                              
                                 n
                              
                           
                           
                              (
                              t
                              )
                           
                         over any knot sequence as 
                           
                              (5)
                              
                                 t
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       γ
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                    
                                    
                                       n
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 γ
                              
                              
                                 i
                              
                           
                           =
                           
                              (
                              
                                 
                                    t
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              +
                              ⋯
                              +
                              
                                 
                                    t
                                 
                                 
                                    i
                                    +
                                    n
                                 
                              
                              )
                           
                           /
                           n
                        . The 
                           
                              
                                 γ
                              
                              
                                 i
                              
                           
                         are the so-called Greville abscissae  [24]. In our case, 
                           n
                           =
                           2
                         and the knots are 
                           
                              [
                              −
                              4
                              ,
                              −
                              2
                              ,
                              0
                              ,
                              2
                              ,
                              4
                              ,
                              6
                              ]
                           
                        , and hence the Greville abscissae are evaluated as 
                           
                              
                                 γ
                              
                              
                                 0
                              
                           
                           =
                           −
                           1
                           ,
                           
                              
                                 γ
                              
                              
                                 1
                              
                           
                           =
                           1
                        , and 
                           
                              
                                 γ
                              
                              
                                 2
                              
                           
                           =
                           3
                        . For brevity, we use 
                           
                              
                                 N
                              
                              
                                 i
                              
                           
                           
                              (
                              t
                              )
                           
                         instead of 
                           
                              
                                 N
                              
                              
                                 i
                              
                              
                                 2
                              
                           
                           
                              (
                              t
                              )
                           
                        . Knowing that the basis functions sum to 1, we can express parameters 
                           u
                         and 
                           v
                         as follows: 
                           
                              
                                 (6)
                                 
                                    u
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          γ
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          γ
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          j
                                       
                                    
                                    
                                       (
                                       v
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          γ
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                       
                                          N
                                       
                                       
                                          j
                                       
                                    
                                    
                                       (
                                       v
                                       )
                                    
                                    ,
                                 
                              
                              
                                 (7)
                                 
                                    v
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          γ
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          j
                                       
                                    
                                    
                                       (
                                       v
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          γ
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          j
                                       
                                    
                                    
                                       (
                                       v
                                       )
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          γ
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                       
                                          N
                                       
                                       
                                          j
                                       
                                    
                                    
                                       (
                                       v
                                       )
                                    
                                    .
                                 
                              
                           
                         The height function 
                           z
                           =
                           h
                           
                              (
                              u
                              ,
                              v
                              )
                           
                         can be converted into a parametric form 
                           
                              r
                           
                           
                              (
                              u
                              ,
                              v
                              )
                           
                           =
                           
                              (
                              u
                              ,
                              v
                              ,
                              h
                              
                                 (
                                 u
                                 ,
                                 v
                                 )
                              
                              )
                           
                        . By combining (3), (6), and (7), we are able to represent the height field function 
                           h
                           
                              (
                              u
                              ,
                              v
                              )
                           
                         in terms of a uniform bi-quadratic B-spline patch 
                           
                              (8)
                              
                                 
                                    r
                                 
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       0
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                    
                                 
                                 
                                    (
                                    v
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 
                                    P
                                 
                              
                              
                                 i
                                 j
                              
                           
                           =
                           
                              
                                 
                                    (
                                    
                                       
                                          γ
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          γ
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                    
                                       
                                          h
                                       
                                       
                                          i
                                          j
                                       
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                         are the control points. The four corner points 
                           
                              r
                           
                           
                              (
                              0
                              ,
                              0
                              )
                           
                           ,
                           
                              r
                           
                           
                              (
                              2
                              ,
                              0
                              )
                           
                           ,
                           
                              r
                           
                           
                              (
                              0
                              ,
                              2
                              )
                           
                           ,
                           
                              r
                           
                           
                              (
                              2
                              ,
                              2
                              )
                           
                         of the B-spline patch are evaluated using (8) as 
                           
                              r
                           
                           
                              (
                              0
                              ,
                              0
                              )
                           
                           =
                           
                              
                                 
                                    (
                                    0
                                    ,
                                    0
                                    ,
                                    
                                       (
                                       
                                          
                                             h
                                          
                                          
                                             00
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             01
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             10
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             11
                                          
                                       
                                       )
                                    
                                    /
                                    4
                                    )
                                 
                              
                              
                                 T
                              
                           
                           ,
                           
                              r
                           
                           
                              (
                              2
                              ,
                              0
                              )
                           
                           =
                           
                              
                                 
                                    (
                                    2
                                    ,
                                    0
                                    ,
                                    
                                       (
                                       
                                          
                                             h
                                          
                                          
                                             10
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             11
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             20
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             21
                                          
                                       
                                       )
                                    
                                    /
                                    4
                                    )
                                 
                              
                              
                                 T
                              
                           
                           ,
                           
                              r
                           
                           
                              (
                              0
                              ,
                              2
                              )
                           
                           =
                           
                              
                                 
                                    (
                                    0
                                    ,
                                    2
                                    ,
                                    
                                       (
                                       
                                          
                                             h
                                          
                                          
                                             01
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             02
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             11
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             12
                                          
                                       
                                       )
                                    
                                    /
                                    4
                                    )
                                 
                              
                              
                                 T
                              
                           
                           ,
                           
                              r
                           
                           
                              (
                              2
                              ,
                              2
                              )
                           
                           =
                           
                              
                                 
                                    (
                                    2
                                    ,
                                    2
                                    ,
                                    
                                       (
                                       
                                          
                                             h
                                          
                                          
                                             11
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             12
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             21
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             22
                                          
                                       
                                       )
                                    
                                    /
                                    4
                                    )
                                 
                              
                              
                                 T
                              
                           
                        . Accordingly, the orthogonal projection of the B-spline patch onto the 
                           u
                           v
                        -plane coincides with these four pixels as shown in Fig. 2(b).

It is straightforward to evaluate the first-order partial derivatives of 
                           
                              r
                           
                           
                              (
                              u
                              ,
                              v
                              )
                           
                         with respect to 
                           u
                         and 
                           v
                        
                        
                           
                              (9)
                              
                                 
                                    
                                       
                                          r
                                       
                                    
                                    
                                       u
                                    
                                 
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          1
                                          ,
                                          0
                                          ,
                                          
                                             
                                                h
                                             
                                             
                                                u
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          r
                                       
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          0
                                          ,
                                          1
                                          ,
                                          
                                             
                                                h
                                             
                                             
                                                v
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ,
                              
                           
                         thus, the surface normal is computed by 
                           
                              (10)
                              
                                 
                                    N
                                 
                                 =
                                 
                                    
                                       
                                          r
                                       
                                    
                                    
                                       u
                                    
                                 
                                 ×
                                 
                                    
                                       
                                          r
                                       
                                    
                                    
                                       v
                                    
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          −
                                          
                                             
                                                h
                                             
                                             
                                                u
                                             
                                          
                                          ,
                                          −
                                          
                                             
                                                h
                                             
                                             
                                                v
                                             
                                          
                                          ,
                                          1
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 .
                              
                           
                         Substituting (3) into (10) yields 
                           
                              (11)
                              
                                 
                                    N
                                 
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          −
                                          
                                             
                                                h
                                             
                                             
                                                u
                                             
                                          
                                          
                                             (
                                             u
                                             ,
                                             v
                                             )
                                          
                                          ,
                                          −
                                          
                                             
                                                h
                                             
                                             
                                                v
                                             
                                          
                                          
                                             (
                                             u
                                             ,
                                             v
                                             )
                                          
                                          ,
                                          1
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             −
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   0
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   =
                                                   0
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   h
                                                
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         N
                                                      
                                                      
                                                         ̇
                                                      
                                                   
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                (
                                                u
                                                )
                                             
                                             
                                                
                                                   N
                                                
                                                
                                                   j
                                                
                                             
                                             
                                                (
                                                v
                                                )
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   0
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   =
                                                   0
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   h
                                                
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                
                                                   N
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                (
                                                u
                                                )
                                             
                                             
                                                
                                                   
                                                      
                                                         N
                                                      
                                                      
                                                         ̇
                                                      
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             
                                                (
                                                v
                                                )
                                             
                                          
                                       
                                       
                                          
                                             1
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              (12)
                              
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       0
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 −
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       t
                                    
                                    
                                       4
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 −
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    
                                       t
                                    
                                    
                                       4
                                    
                                 
                                 .
                              
                           
                         If we denote the given surface normals at the center of pixel 
                           
                              (
                              I
                              ,
                              J
                              )
                           
                         by 
                           
                              
                                 
                                    N
                                 
                              
                              
                                 I
                                 J
                              
                           
                           =
                           
                              
                                 
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          I
                                          J
                                       
                                    
                                    ,
                                    
                                       
                                          b
                                       
                                       
                                          I
                                          J
                                       
                                    
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          I
                                          J
                                       
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                         and assume that 
                           
                              
                                 c
                              
                              
                                 I
                                 J
                              
                           
                           ≠
                           0
                        , the four normal vectors related to each B-spline patch can be rewritten as follows (see Fig. 2(a)): 
                           
                              (13)
                              
                                 
                                    
                                       
                                          N
                                       
                                    
                                    
                                       I
                                       J
                                    
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      I
                                                      J
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      I
                                                      J
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      I
                                                      J
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      I
                                                      J
                                                   
                                                
                                             
                                          
                                          ,
                                          1
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ,
                                 
                                 I
                                 =
                                 0
                                 ,
                                 1
                                 ,
                                 
                                 J
                                 =
                                 0
                                 ,
                                 1
                                 .
                              
                           
                         By comparing (11) and (13), and recognizing that the centers of the four pixels are located at 
                           
                              (
                              u
                              ,
                              v
                              )
                           
                           =
                           
                              (
                              
                                 
                                    1
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    1
                                 
                                 
                                    2
                                 
                              
                              )
                           
                           ,
                           
                              (
                              
                                 
                                    3
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    1
                                 
                                 
                                    2
                                 
                              
                              )
                           
                           ,
                           
                           
                              (
                              
                                 
                                    1
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    3
                                 
                                 
                                    2
                                 
                              
                              )
                           
                           ,
                           
                              (
                              
                                 
                                    3
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    3
                                 
                                 
                                    2
                                 
                              
                              )
                           
                        , we obtain the 8×9 linear system (14) ​as given in Box I
                         with unknowns 
                           
                              
                                 h
                              
                              
                                 i
                                 j
                              
                           
                           ,
                           
                           i
                           =
                           0
                           ,
                           …
                           ,
                           2
                           ,
                           
                           j
                           =
                           0
                           ,
                           …
                           ,
                           2
                        . This is an underdetermined linear system consisting of 8 equations with 9 unknowns. However, if there are 8 pixels, as shown in Fig. 4
                        , the linear system becomes an overdetermined system, having 16 equations with 12 unknowns. In this case, we are able to solve the linear system in a least squares sense. In general, for 
                           M
                           ×
                           N
                         pixels, there are 
                           2
                           M
                           N
                         equations with 
                           
                              (
                              
                                 
                                    M
                                 
                                 
                                    2
                                 
                              
                              +
                              2
                              )
                           
                           
                              (
                              
                                 
                                    N
                                 
                                 
                                    2
                                 
                              
                              +
                              2
                              )
                           
                         unknowns. Accordingly, if 
                           M
                           ≥
                           4
                         and 
                           N
                           ≥
                           2
                         (or 
                           M
                           ≥
                           2
                         and 
                           N
                           ≥
                           4
                        ), the number of equations will always be greater than the number of unknowns. Let us denote the overdetermined system by 
                           
                              (15)
                              
                                 
                                    A
                                 
                                 
                                    h
                                 
                                 =
                                 
                                    b
                                 
                                 ,
                              
                           
                         so the normal equation is given by 
                           
                              
                                 
                                    A
                                 
                              
                              
                                 T
                              
                           
                           
                              A
                           
                           
                              h
                           
                           =
                           
                              
                                 
                                    A
                                 
                              
                              
                                 T
                              
                           
                           
                              b
                           
                        .

The estimated normal map of an object given by photometric stereo does not provide scaling, nor does it give any reference positions. Accordingly, there are an infinite number of solutions to the normal equations. It is easy to find that the sum of the column vectors 
                           
                              
                                 
                                    a
                                 
                              
                              
                                 i
                              
                           
                           ,
                           
                           i
                           =
                           0
                           ,
                           …
                           ,
                           
                              (
                              
                                 
                                    M
                                 
                                 
                                    2
                                 
                              
                              +
                              2
                              )
                           
                           
                              (
                              
                                 
                                    N
                                 
                                 
                                    2
                                 
                              
                              +
                              2
                              )
                           
                           −
                           1
                         of matrix 
                           
                              A
                           
                         is zero, i.e., 
                           
                              
                                 ∑
                              
                              
                                 i
                              
                           
                           
                              
                                 
                                    a
                                 
                              
                              
                                 i
                              
                           
                           =
                           
                              0
                           
                        . Therefore, the sum of the column vectors of the symmetric matrix 
                           
                              
                                 
                                    A
                                 
                              
                              
                                 T
                              
                           
                           
                              A
                           
                         is also zero. This implies that the column vectors of 
                           
                              
                                 
                                    A
                                 
                              
                              
                                 T
                              
                           
                           
                              A
                           
                         are not independent, and hence 
                           
                              
                                 
                                    A
                                 
                              
                              
                                 T
                              
                           
                           
                              A
                           
                         is singular. This can be resolved by imposing a positional boundary condition. In practice, we add 
                           h
                           
                              (
                              0
                              ,
                              0
                              )
                           
                           =
                           
                              
                                 z
                              
                              
                                 0
                              
                           
                        , i.e., 
                           
                              
                                 h
                              
                              
                                 00
                              
                           
                           +
                           
                              
                                 h
                              
                              
                                 01
                              
                           
                           +
                           
                              
                                 h
                              
                              
                                 10
                              
                           
                           +
                           
                              
                                 h
                              
                              
                                 11
                              
                           
                           =
                           4
                           
                              
                                 z
                              
                              
                                 0
                              
                           
                        , to matrix 
                           
                              A
                           
                        .

Up to this point, the scale effect has not been considered in the formulation. Pixel intervals are set to a unit length in both directions. In order to scale the resulting surface, we simply multiply the odd and even elements of vector 
                           
                              b
                           
                         on the right-hand side of (15), by 
                           
                              Δ
                           
                           x
                         and 
                           
                              Δ
                           
                           y
                        , respectively, where 
                           
                              (
                              
                                 Δ
                              
                              x
                              ,
                              
                                 Δ
                              
                              y
                              )
                           
                         is the size of the pixel in the real world.

In formulating (13), we assumed 
                           
                              
                                 c
                              
                              
                                 I
                                 J
                              
                           
                           ≠
                           0
                        . However, there are cases when 
                           
                              
                                 c
                              
                              
                                 I
                                 J
                              
                           
                         is nearly or equal to zero, i.e.  
                           
                              |
                              
                                 
                                    c
                                 
                                 
                                    I
                                    J
                                 
                              
                              |
                           
                           <
                           
                              
                                 ϵ
                              
                              
                                 d
                              
                           
                         where 
                           
                              
                                 ϵ
                              
                              
                                 d
                              
                           
                         is a prescribed tolerance. In such cases, we still have the following relation: 
                           
                              (16)
                              
                                 −
                                 
                                    
                                       h
                                    
                                    
                                       u
                                    
                                 
                                 :
                                 −
                                 
                                    
                                       h
                                    
                                    
                                       v
                                    
                                 
                                 =
                                 
                                    
                                       a
                                    
                                    
                                       I
                                       J
                                    
                                 
                                 :
                                 
                                    
                                       b
                                    
                                    
                                       I
                                       J
                                    
                                 
                                 ,
                              
                           
                         or more precisely 
                           
                              
                                 
                                    
                                       
                                          b
                                       
                                       
                                          I
                                          J
                                       
                                    
                                    
                                       (
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             0
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             0
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             h
                                          
                                          
                                             i
                                             j
                                          
                                       
                                       
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   ̇
                                                
                                             
                                          
                                          
                                             i
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             N
                                          
                                          
                                             j
                                          
                                       
                                       
                                          (
                                          v
                                          )
                                       
                                       )
                                    
                                 
                              
                              
                                 (17)
                                 
                                    −
                                    
                                       
                                          a
                                       
                                       
                                          I
                                          J
                                       
                                    
                                    
                                       (
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             0
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             0
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             h
                                          
                                          
                                             i
                                             j
                                          
                                       
                                       
                                          
                                             N
                                          
                                          
                                             i
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   ̇
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       
                                          (
                                          v
                                          )
                                       
                                       )
                                    
                                    =
                                    0
                                    .
                                 
                              
                           
                         Since only one equation is generated per pixel instead of two, the use of this equation must be limited so that the linear system remains overdetermined.

In general, when 
                           
                              
                                 c
                              
                              
                                 I
                                 J
                              
                           
                           ≠
                           0
                        , the resulting B-spline surface is smooth, without any unwanted wiggles. On the other hand, when 
                           
                              
                                 c
                              
                              
                                 I
                                 J
                              
                           
                         is nearly or equal to zero in some regions, the reconstructed surface often involves unwanted artifacts. The semi-sphere shown in Fig. 6(a) has 
                           
                              
                                 c
                              
                              
                                 I
                                 J
                              
                           
                           =
                           0
                         along the great circle at the bottom, yielding unwanted wiggles. In formulating the semi-sphere model, we have used (17) along the great circle. A close-up view of these wiggles is depicted in Fig. 6(b). In order to prevent such artifacts, we introduce a smoothing term that enforces the fairness of the approximating surface  [25]. The fairness function is often related to a thin-plate energy 
                           
                              (18)
                              
                                 
                                    
                                       E
                                    
                                    
                                       p
                                    
                                 
                                 =
                                 ∬
                                 
                                    (
                                    
                                       
                                          κ
                                       
                                       
                                          1
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          κ
                                       
                                       
                                          2
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                                 d
                                 u
                                 
                                 d
                                 v
                                 ,
                              
                           
                         where 
                           
                              
                                 κ
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 κ
                              
                              
                                 2
                              
                           
                         are the principal curvatures of the surface. This is a highly nonlinear function and involves time-consuming numerical computation. We employ a simplified version of the thin-plate energy, a quadratic function in the second-order partial derivatives of the surface  [25], given by 
                           
                              (19)
                              
                                 
                                    
                                       E
                                    
                                    
                                       p
                                    
                                 
                                 =
                                 ∬
                                 
                                    (
                                    
                                       
                                          
                                             r
                                          
                                       
                                       
                                          u
                                          u
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    2
                                    
                                       
                                          
                                             r
                                          
                                       
                                       
                                          u
                                          v
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             r
                                          
                                       
                                       
                                          v
                                          v
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                                 d
                                 u
                                 
                                 d
                                 v
                                 .
                              
                           
                         Therefore, the objective function is quadratic in the control points of the surface, and the condition for its minimum is the vanishing of the partial derivatives of 
                           
                              
                                 E
                              
                              
                                 p
                              
                           
                         with respect to the control points. This results in the system of linear equations 
                           
                              (20)
                              
                                 
                                    [
                                    
                                       
                                          
                                             A
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       A
                                    
                                    +
                                    λ
                                    
                                       
                                          
                                             A
                                          
                                       
                                       
                                          
                                             fair
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    h
                                 
                                 =
                                 
                                    
                                       
                                          A
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    b
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 
                                    A
                                 
                              
                              
                                 
                                    fair
                                 
                              
                           
                         is a so-called energy matrix  [25], 
                           
                              h
                           
                         is the 
                           z
                        -component of the unknown 
                           
                              (
                              
                                 
                                    M
                                 
                                 
                                    2
                                 
                              
                              +
                              2
                              )
                           
                           
                              (
                              
                                 
                                    N
                                 
                                 
                                    2
                                 
                              
                              +
                              2
                              )
                           
                         control points, and 
                           λ
                         is a user-defined parameter that weighs the importance of the fairing factor. The formulation of existing methods has a per-pixel basis, giving a matrix size proportional to 
                           M
                           N
                        , whereas our formulation is proportional to 
                           M
                           N
                           /
                           4
                        . The evaluation of 
                           
                              
                                 
                                    A
                                 
                              
                              
                                 
                                    fair
                                 
                              
                           
                         involves integrating the product of uniform B-spline functions. This is a simple operation, as they are merely polynomials. The linear system (20) is a sparse symmetric positive definite matrix, visualized in Fig. 5
                        , that can be solved efficiently using a Cholesky factorization of sparse direct solvers  [26]. The bandwidth of the matrix is 
                           4
                           ×
                           
                              (
                              
                                 
                                    M
                                 
                                 
                                    2
                                 
                              
                              +
                              2
                              )
                           
                           +
                           5
                        . Fig. 6
                        (c) illustrates the reconstructed semi-sphere with 
                           λ
                           =
                           10
                           ,
                           
                              
                                 ϵ
                              
                              
                                 d
                              
                           
                           =
                           1
                           
                              
                                 0
                              
                              
                                 −
                                 6
                              
                           
                         and no such artifacts. A close-up view of the smoothly faired surface together with its control points is shown in Fig. 6(d). In order to compare our method, we also reconstructed the semi-sphere using the Osculating circular arc (OCA) method  [20], which is formulated to generate less distortion along the object boundaries, as shown in Fig. 6(e). The ground truth surface is depicted in Fig. 6(f).


                        Table 1
                         lists the maximum height, the output data size, and the computation time for the reconstruction of the semi-sphere by our method with or without fairing and by the OCA method  [20]. Although the uniform knot vectors may not be necessary in the output data, we include those for compatibility with a CAD representation. If we exclude the knot vectors, the data size reduces to 0.455 MB. We used a PC with a Core i7-990X 3.47-GHz processor and 24-GB RAM. The superiority of our method can be clearly seen from the table.

We provide a way to assess the accuracy of the positions and normals of the reconstructed surface using a synthetic surface. The wave-like surface 
                           z
                           =
                           0.2
                           sin
                           
                              (
                              5
                              π
                              u
                              )
                           
                           cos
                           
                              (
                              4
                              π
                              v
                              )
                           
                         shown in Fig. 7
                        (a) is used as the ground truth. The normals of the wave-like surface at the center of the uniform grid points in the 
                           u
                           –
                           v
                         coordinates are used as the input data (see Fig. 7(b)). The positions and the normals of the reconstructed B-spline surface at the center of uniform grid points are compared with the ground truth surface. The position errors are defined as the minimum distances to the ground truth surface, while the normal errors are defined as the angular deviations (in degrees) with respect to the ground truth normals. The accuracy of the reconstructed surface depends on the number of pixels used for the reconstruction. In other words, the accuracy depends on the differences between the normal vectors of neighboring pixels. We measure the variation of normals at each pixel 
                           
                              (
                              I
                              ,
                              J
                              )
                           
                         by computing the maximum angular difference between the pixel 
                           
                              (
                              I
                              ,
                              J
                              )
                           
                         and the surrounding ring of eight pixels. Fig. 8
                         shows histograms of the normal variations of the input wave-like surface as well as color-coded error maps of the position and angle errors of the output of our method relative to the ground truth of the synthetic wave-like surface. Position errors are normalized with respect to the diagonal of the bounding box of the model. Three pixel sizes are employed in the experiments: (a) 120×120, (b) 60×60, and (c) 30×30.

As demonstrated by Fig. 8 and Table 2
                        , both position and angle errors are small so long as the maximum angular difference between each pixel 
                           
                              (
                              I
                              ,
                              J
                              )
                           
                         and the first surrounding ring of pixels is within approximately 30°. On the other hand as the angular difference becomes larger, both position and angle errors grow. These observations imply that regions involving large angular differences between neighboring pixels, such as sharp features or vertical walls, will have larger errors. Nevertheless, sharp features and vertical walls can be reconstructed accurately by our method as long as the normal data are dense so that angular differences between neighboring pixels are relatively small.


                        Fig. 9
                         shows the reconstructed wave-like surface based on the data for 
                           M
                           =
                           N
                           =
                           30
                         data. Fig. 9(a) illustrates the mesh surface generated by the per-pixel basis method, while Fig. 9(b) depicts the B-spline surface generated by our method. The effectiveness of the 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                         continuity is clearly seen in the results of the B-spline based method.

In this section, we compare our method with existing methods by using the benchmark data. We also apply our method to the real-world data obtained with the photometric stereo technique. The input to our system is a normal map of an object. We assume that the dense normal map is generated by an accurate measurement system, such as in  [27] (see Fig. 12). Moreover various non-Lambertian corruptions such as specularities, shadows, and image noise are compensated by a robust photometric stereo method  [28]. Furthermore, we assume that the normal map includes only the surface orientation that is visible from the camera. In other words, reconstruction of vertical walls is not of interest in the present study.

We compare the computational results of our method with those of various surface-from-gradients methods by using the benchmark dataset called Mozart (
                           M
                           =
                           N
                           =
                           256
                        ), which is available from the project website  [17]. The various methods include Poisson solver   [14], Fourier basis   [13], Regularization   [17], 
                           M
                        -estimator   [17], Diffusion   [17], and OCA   [20]. MATLAB source codes for all of these methods, except the last one, are obtainable from the project website  [17].

Since the benchmark dataset contains only height field data, the unit surface normals are calculated from the height field data at uniform grid points by using the central difference formula resulting in an approximation with accuracy 
                           O
                           
                              (
                              
                                 
                                    h
                                 
                                 
                                    2
                                 
                              
                              )
                           
                           [29]. We reconstruct the surface from the calculated normal vectors and compare it with the surfaces computed by the various methods described above.

The results for Mozart are presented in Fig. 10
                        . Since the benchmark data are given in the form of height field data at grid points, we evaluate the position errors in terms of differences in heights, and the normal errors in terms of the central differences between the reconstructed surface and the ground truth surface. In our computation, we use 
                           λ
                           =
                           0.25
                        , and 
                           
                              
                                 ϵ
                              
                              
                                 d
                              
                           
                           =
                           1
                           
                              
                                 0
                              
                              
                                 −
                                 6
                              
                           
                        . As depicted in Fig. 10(a), Fig. 11
                        (a) and (b) the original Mozart data are surrounded by vertical walls. Moreover there are data missing in several regions. Therefore, it is a challenging dataset. The mean position errors and the mean normal errors are summarized in Table 3
                        . Among the seven methods, the B-spline method produces the minimum height error, and it produces the third smallest mean angle error (ranking just behind the M-estimator and the OCA method). However, if we exclude the normal errors arising from 13% of the data corresponding to the problematic regions, which are shown in Fig. 11(c), then the B-spline method also produces the minimum mean normal error (see Table 4
                        ).

In this section, we show several complex reconstruction results obtained using our algorithm on real-world normal maps generated by the photometric stereo system discussed in  [27] (see Fig. 12
                        ). We also compensate various non-Lambertian corruptions such as specularities, shadows, and image noise by the robust photometric stereo method  [28]. Fig. 1 shows a metal pendant of “Saint George killing the dragon” with 21-mm diameter and 1-mm thickness. The top and bottom rows in Fig. 13
                         show two different portions (86×62 mm and 57×42 mm) within an Aztec calendar made of plaster. The final results in Fig. 14
                         show the Japanese 500 yen coin. We also compare the computational time with the OCA method. Table 5
                         lists the input data sizes, number of control points, and run times.

Our method can produce a high-quality reconstruction of complex objects with 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                         continuous B-spline surface including high-frequency spatial features. Despite the present academic implementation, our method is able to reconstruct complex examples within a reasonable time.

We compare the performance of our method with the Gaussian kernel approach  [23] whose source code and executable of the system can be downloaded at www.cs.ust.hk/~pang. We examine the accuracy of the model generated by our method and that of the Gaussian kernel approach by comparing them with the laser-scanned point cloud. The metal pendant of “Saint George killing the dragon” is laser-scanned, and then noise and outliers of the scanned data points are removed using the Point Cloud Library  [30].

After the compensation of the normal map of the pendant using the method by Ikehata et al.  [28], the recovery of the height field function is conducted by the Gaussian kernel approach and our method using 500×500 pixel data. A smaller size data is used for comparison, since the Gaussian kernel approach is computationally slow as listed in Table 6
                        . The reconstructed B-spline model consists of 252×252 control points, whereas the Gaussian kernel model outputs a triangular mesh with 250,000 vertices. Since the laser-scanned point cloud and the surface-from-gradients-based models are generated in different coordinate systems, the rigid-body translations and rotations must be applied iteratively to the surface-from-gradients-based models in order to bring the models into closest correspondence with the laser-scanned point cloud. This iterative procedure is called localization  [31]. Once the localization is applied between the laser-scanned point cloud and the two surface-from-gradients-based models, the distance between them are computed. Table 6 shows that both the maximum distance error as well as the mean distance error, which are normalized with respect to the diagonal of the bounding box of the model, are almost identical. Accordingly, we can say that our method is about as accurate as the Gaussian kernel approach, however, its computational speed is much faster than the Gaussian kernel approach, moreover, it requires less memory to store and it is 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                         continuous.

Editing a normal map rather than editing a height map directly will reduce the risk of introducing unnecessary artifacts, because least squares minimization during reconstruction tends to smooth out errors uniformly across the function. In this section, we introduce a novel method to generate streamlined aesthetic surfaces through the direct editing of normal vectors. We assume that the existing designs of streamlined aesthetic surfaces are available from previous designs. There is a research by Yu et al.  [32] for editing a mesh surface by manipulating its gradient field. They solve the least squares system formulated by discretizing the Poisson equation with Dirichlet boundary conditions. However, to the best of our knowledge, the research on editing a B-spline surface through its gradient field has not done before.


                     Fig. 16(a) depicts an automobile surface from previous design, which satisfies aerodynamic functionality as well as attractive shape requirements. The cross direction of the vehicle is parallel to the 
                        x
                     -axis (see the red line in Fig. 16(c)), the longitudinal direction is parallel to the 
                        y
                     -axis (see the blue line in Fig. 16(c)), and the vertical direction is parallel to the 
                        z
                     -axis. We directly edit the normal map (needle map), and recover the shape of the new design in terms of uniform bi-quadratic B-spline surfaces. Although it is not easy to specify the airflow velocity vector at the grid points, we can determine the tangent plane of the surface where the airflow velocity vector lies at each grid point via specifying the normal vector.

The basic idea of this new design methodology is to design streamlined aesthetic surfaces in the gradient vector field instead of the position vector field. Let us consider a normal vector in the 
                        x
                        z
                     -plane as shown in Fig. 15
                     (a). If we increase the 
                        x
                     -component as in (b), the slope of the surface becomes steeper, while if we decrease the 
                        x
                     -component as in (c), the slope of the surface becomes gentler. Keeping these principles in mind, we are able to produce new designs by working in the gradient vector field of the input surface. We propose two basic methods to produce new designs, namely the global modification method and the local modification method. Combination of these two methods is also possible.

First we set the scale factors for 
                           x
                           ,
                           y
                        , and 
                           z
                         components of the normal vector, and multiply them to each corresponding component of the entire surface normal vectors of the input surface. Then we normalize all the normal vectors and apply our reconstruction method to generate the new design. Fig. 16
                        (b) illustrates the reconstructed streamlined aesthetic surface when the 
                           x
                        -component scale factor is 1.4, the 
                           y
                        -component is 0.6, and the 
                           z
                        -component is 1.0. We can confirm from Fig. 16(e) and (f) that the slope of the vehicle in 
                           x
                        -direction becomes steeper when the 
                           x
                        -component of the normal vector is increased, while from (g) and (h) we can observe that the slope of the vehicle in 
                           y
                        -direction becomes gentler when the 
                           y
                        -component of the normal vector is decreased.

Local editing of normal vectors is also an effective way to generate a new design as illustrated in Fig. 18. In this example the normal vectors 
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    x
                                 
                              
                              ,
                              
                                 
                                    n
                                 
                                 
                                    y
                                 
                              
                              ,
                              
                                 
                                    n
                                 
                                 
                                    z
                                 
                              
                              )
                           
                         are edited as follows: 
                           
                              1.
                              Divide the 
                                    x
                                    y
                                 -plane into three regions as shown in Fig. 17
                                 (a) where the two parabolas are given by 
                                    
                                       
                                          
                                             
                                                y
                                             
                                             
                                                1
                                             
                                          
                                          =
                                          −
                                          0.042
                                          
                                             
                                                
                                                   (
                                                   x
                                                   −
                                                   50
                                                   )
                                                
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          210
                                          ,
                                          
                                          
                                             
                                                y
                                             
                                             
                                                2
                                             
                                          
                                          =
                                          −
                                          0.084
                                          
                                             
                                                
                                                   (
                                                   x
                                                   −
                                                   50
                                                   )
                                                
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          210
                                          .
                                       
                                    
                                 
                              

For normals in region 1, we set 
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                    
                                    =
                                    0.5
                                    p
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          y
                                       
                                    
                                    =
                                    0.5
                                    p
                                    
                                       
                                          n
                                       
                                       
                                          y
                                       
                                    
                                 , where 
                                    p
                                    =
                                    
                                       
                                          y
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                1
                                             
                                          
                                       
                                       
                                          l
                                       
                                    
                                 .

For normals in region 2, we set 
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                    
                                    =
                                    3
                                    
                                       (
                                       1
                                       −
                                       p
                                       )
                                    
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          y
                                       
                                    
                                    =
                                    4
                                    
                                       (
                                       1
                                       −
                                       p
                                       )
                                    
                                    
                                       
                                          n
                                       
                                       
                                          y
                                       
                                    
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          z
                                       
                                    
                                    =
                                    5
                                    
                                       (
                                       1
                                       −
                                       p
                                       )
                                    
                                    
                                       
                                          n
                                       
                                       
                                          z
                                       
                                    
                                    +
                                    5
                                    p
                                 , where 
                                    p
                                    =
                                    
                                       
                                          y
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                2
                                             
                                          
                                       
                                       
                                          h
                                       
                                    
                                 .

For normals in region 3, we set 
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                    
                                    =
                                    2.0
                                    
                                       
                                          n
                                       
                                       
                                          x
                                       
                                    
                                 .

Normalize 
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             x
                                          
                                       
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             y
                                          
                                       
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             z
                                          
                                       
                                       )
                                    
                                 .


                        Fig. 17(b) and (c) show the original and the locally modified normal maps. Fig. 18
                        . (a)–(c) illustrate the locally modified surface with three different views, while (d)–(f) depict the corresponding views of the original surface.

@&#CONCLUSIONS@&#

We have introduced a novel method to reconstruct a surface of an object from its surface normal vectors. This study is motivated by photometric stereo techniques, and the introduction of new design methodology of streamlined aesthetic surfaces through the direct editing of normal vectors. An explicit reconstruction is performed in terms of a 
                        
                           
                              C
                           
                           
                              1
                           
                        
                      continuous uniform bi-quadratic B-spline function on the 
                        x
                        y
                     -plane from a normal map of the object. The advantages of our reconstruction method can be summarized as follows: The mathematical formulation of our method is simple in that it involves only first-order derivatives of polynomial functions. The computation is not only accurate but also fast, and less memory is required to store the data. Since the output representations are in B-spline form, they can be used in a number of downstream applications, including NC machining, isogeometric analysis, and surface interrogation.

Our method still has a number of limitations that require further research. One limitation is that if the input normal map includes regions with large angular differences between neighboring pixels (e.g., angles larger than 60°), the gradient of the resulting surface may be less accurate in those regions. A second limitation concerns the handling of vertical or nearly vertical walls. Although we can handle these cases to some degree by using Eq. (17) and the fairing method to prevent wiggles, the threshold of 
                        
                           
                              c
                           
                           
                              I
                              J
                           
                        
                      and the fairing factor 
                        λ
                      are determined heuristically.

We have provided an outline of the concept of our algorithm, and we have applied the algorithm to several cases. However, there are many rooms for extensions, and we will list a few of them. 
                        
                           •
                           We plan to investigate the usage of higher degree B-spline functions.

We hope to develop a user friendly interface for editing the normal map (needle map).

Another interesting topic is the extension from uniform B-spline to NURBS.

@&#ACKNOWLEDGMENTS@&#

We would like to express our sincere gratitude to Takayuki Ukawa, Kenichiro Machida, Yuji Kobashi for their constructive discussions.

Supplementary material related to this article can be found online at http://dx.doi.org/10.1016/j.cad.2015.01.005.

The following is the Supplementary material related to this article. 
                        
                           Video S1
                           
                              Close-up views of the reconstructed B-spline surfaces.
                           
                           
                        
                     
                  

@&#REFERENCES@&#

