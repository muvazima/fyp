@&#MAIN-TITLE@&#Basic behavioral models for software product lines: Expressiveness and testing pre-orders

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Comparing three fundamental models of Software Product Lines.


                        
                        
                           
                           Proving modal transition systems less expressive than product line labeled transition systems.


                        
                        
                           
                           Proving product line labeled transition systems less expressive than featured transition systems.


                        
                        
                           
                           Using Abramsky's test expressions to characterize product derivation.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Software product lines

Formal specification

Behavioral specification

Labeled transition systems

Featured transition systems

Modal transition systems

Calculus of communicating systems (CCS)

Product line CCS (PL-CCS)

@&#ABSTRACT@&#


               
               
                  In order to provide a rigorous foundation for Software Product Lines (SPLs), several fundamental approaches have been proposed to their formal behavioral modeling. In this paper, we provide a structured overview of those formalisms based on labeled transition systems and compare their expressiveness in terms of the set of products they can specify. Moreover, we define the notion of tests for each of these formalisms and show that our notions of testing precisely capture product derivation, i.e., all valid products will pass the set of test cases of the product line and each invalid product fails at least one test case of the product line.
               
            

@&#INTRODUCTION@&#

@&#MOTIVATION@&#

Software product lines (SPLs) are becoming increasingly popular as efficient means for mass production and mass customization of software. Hence, establishing formal foundations for specification and verification of SPLs can benefit a large community and can have substantial impact. In the last few years, many researchers have spent substantial effort in extending various formalisms and their associated reasoning techniques to the SPL settings, of which [1–5] provide a comprehensive overview.

In this paper, we put some structure to the body of knowledge regarding some of the most fundamental extensions of behavioral models for SPLs, namely, those based on labeled transition systems, such as those proposed or studied in [6–19]. These basic models can serve as semantic models for extensions of higher level models such as domain specific languages (DSLs), or those based on the Unified Modeling Language (UML) state or sequence diagrams. Hence, bringing more structure into the body of knowledge about these fundamental computational models can help the language designers of higher level language to make the right choice when defining the semantics of their language.

The structure proposed in this paper is twofold: first we compare the expressive power of these fundamental models and second, we explore the extensional and intensional notions of testing equivalence (pre-orders) for each of them. Some of the expressiveness results reported in the present paper are hinted at in the literature, but to our knowledge, have never been formalized and proven before. Regarding the testing equivalences, the extensional notions of testing defined in this paper – for the models proposed in [14,15,17] – are novel. They are of course based on and slight extensions of well-known notions of tests for labeled transition systems (e.g., of [20–22] and particularly that of [23]).

In order to illustrate the different approaches, we use the following simple example originally due to Asirelli et al. [7] and further elaborated by Classen [2]. 
                           Example 1
                           We model a product line for vending machines, which accept one-Euro coins (1e) exclusively for the European market and one-Dollar coins (1d) exclusively for the American market. A user has a choice of adding sugar or no sugar, after which she is allowed to choose a beverage among coffee, tea, or cappuccino. Furthermore, the following constraints hold on each product:
                                 
                                    1.
                                    Coffee must be offered by each and every variant of this product line.

Cappuccino is served only by the European machines and whenever cappuccino is served, a ring-tone must ring.

Tea is an optional feature for both markets.

The objects of study in this paper are three popular models of computation that are used in the literature to model SPLs. Namely, we study modal transition systems [24], product line labeled transition systems [17], and featured transition systems [15]. The contributions of this paper are as follows:
                           
                              •
                              Firstly, we formally show that the class of modal transition systems are strictly less expressive than the class of product line labeled transition systems, which are in-turn strictly less expressive than the class of featured transition systems.

Secondly, we show how the test expressions of Abramsky [23] can be used to characterize product derivation for each of the above models of software product line.

The rest of this paper is organized as follows. In Section 2, we present an overview of the product-line formalisms studied in this paper and recall or define their intuitive notion of derived products. In Section 3, we compare the expressiveness of formalisms by comparing their set of definable products. In Section 4, we define the extensional notions of test for the formalisms and prove that they coincide with their intensional counter-parts. The paper is concluded in Section 5 with a summary of the results and some directions of our ongoing research.

@&#OVERVIEW@&#

Conventional formal models such as labeled transition systems (LTSs) can be used to specify the behavior of systems at a high level of abstraction. Namely, LTSs specify how a system execution evolves on an abstract machine in terms of transitions that are labeled with the information that is received/made available through each execution step from/to the outside world. However, in order to formally specify a software product line, one needs specific (semantic) notions to refer to variation points, distinguish different features and refer to their possible interactions. Below, we give an overview of several alternatives proposed as fundamental behavioral models of software product lines.

As the first alternative, Fischbein et al. [6] argue that modal transition systems (MTSs) [24] are adequate extensions of LTSs to model a software product line: MTSs partition the transitions into may and must transitions and hence, each MTS has an associated set of possible implementations. Subsequently, several researchers [7–9,12,13] adopted modal transition system as a formal model to perform rigorous analysis of software product lines. Several pieces of work [7–9] addressed the issue of deriving valid products from a given MTS by model checking against formulae expressed in a deontic logic called Modal-Hennessy–Milner-Logic (MHML). Others [13,12] developed an interface theory and a testing theory for software product lines.

Classen et al. [14,15] took a different route by annotating LTSs with features of a feature diagram. Intuitively, a feature diagram specifies, by means of a graphical notation, the set of valid products by specifying constraints on the presence of features. The result of annotating LTSs with features is called a featured transition system (FTS). Furthermore, an LTL-model checking algorithm in the context of featured transition system was given in [15]. Cordy et al. [16] extended the earlier work [14,15] by incorporating non-boolean features and multi-features in a high-level specification language called TVL⁎. Also, an algorithm was given to construct an FTS from a behavioral specification written in TVL⁎.

As another alternative, Gruler et al. [17] extended Milner's CCS [25] into a process calculus called PL-CCS. The extension involves introducing the “binary variant” ⊕ operator to represent the alternative features of a product line. Like MTSs, the validity of products is asserted by model checking formulae specified in a multi-valued modal mu-calculus, originally due to [26]. The semantics of the logic specifies, for each PL-CCS process, the set of configurations that satisfy the logical formula.

In addition, there are also other alternatives for specifying the behavior of SPLs that fall beyond the scope of the present paper. For example, there are proposals based on re-using existing process algebras with data (see, e.g., [27–29]) or extending Petri Nets with features (see, e.g., [30,31]). In order to perform a formal comparison of expressiveness, we confine ourselves to models that are based on LTSs (e.g., those models that specify a set of products captured by an LTS) and hence, the other approaches mentioned in this paragraph are not considered any further. Also, there are extensions of higher-level formalisms such as UML that are not considered in this paper, since they either lack formal semantics or their semantics can be expressed in the more fundamental formalisms such as those studied in this paper.

In Fig. 1
                        , we summarize the different extensions of LTSs for the behavioral modeling of SPLs. In this figure, the solid arrows show the possibility of transforming a model from one formalism into another. In [12], the authors gave a semantics for a restrictive notion of FTS in terms of an MTS. One of the two main contributions of this paper is to complete this picture, and hence generalize the result of [12], by presenting (or showing the impossibility of) encodings among PL-CCS, MTSs and FTSs. This is represented by the dashed arrow in Fig. 1. In the remainder of this section, MTSs are surveyed in Section 2.2 and FTSs are reviewed in Section 2.3. In Section 2.4, we survey process-algebraic approaches to SPL specification.

Modal transition systems extend labeled transition systems by distinguishing two different sorts of transitions, namely, may and must transitions. May transitions, as their name suggests, may (or may not) be present in the implementation behavior, while must transitions are always present. As a sanity condition, it is required that all must transitions also have a corresponding may transition. The following definition formalizes these concepts. 
                              Definition 1
                              A modal transition system (MTS) [24] is a quadruple 
                                    (
                                    P
                                    ,
                                    A
                                    ,
                                    
                                       
                                          
                                             →
                                             
                                          
                                       
                                       
                                          ◊
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             →
                                             
                                          
                                       
                                       
                                          □
                                       
                                    
                                    )
                                 , where 
                                    P
                                  is a set of states or processes, A is a set of actions, 
                                    
                                       
                                          
                                             →
                                             
                                          
                                       
                                       
                                          ◊
                                       
                                    
                                    ⊆
                                    P
                                    ×
                                    A
                                    ×
                                    P
                                  is the so-called may transition relation, and 
                                    
                                       
                                          
                                             →
                                             
                                          
                                       
                                       
                                          □
                                       
                                    
                                    ⊆
                                    
                                       
                                          
                                             →
                                             
                                          
                                       
                                       
                                          ◊
                                       
                                    
                                  is the so-called must transition relation.

An MTS can only describe the behavior of optional and mandatory features of a product line in terms of may and must transition relations, respectively. An MTS specifies a unique LTS when 
                              
                                 
                                    
                                       →
                                       
                                    
                                 
                                 
                                    □
                                 
                              
                              =
                              
                                 
                                    
                                       →
                                       
                                    
                                 
                                 
                                    ◊
                                 
                              
                           , i.e., when all transitions are must transitions, and vice versa, an LTS can be interpreted as an MTS by interpreting ordinary transitions as must transitions. Throughout the rest of this section, we fix the letters 
                              P
                              ,
                              
                                 
                                    P
                                 
                                 
                                    ′
                                 
                              
                              ,
                              Q
                              ,
                              
                                 
                                    Q
                                 
                                 
                                    ′
                                 
                              
                            to denote the states of an MTS, whereas, 
                              p
                              ,
                              
                                 
                                    p
                                 
                                 
                                    ′
                                 
                              
                              ,
                              q
                              ,
                              
                                 
                                    q
                                 
                                 
                                    ′
                                 
                              
                            are used to denote the states of an LTS. 
                              Example 2
                              Consider the informal description given in Example 1. The MTS shown in Fig. 2
                                 (a) (due to [7]), formally specifies this product line. In this MTS, solid arrows denote must transitions and dashed arrows denote may transitions. (For must transitions we dispense with drawing the corresponding may transitions and tacitly assume their presence.)

A key notion within the theory of MTS is modal refinement [24], which allows for deriving products (MTSs with fewer may and more must transitions) from product lines, or testing conformance of products to product lines. Informally, if P refines Q then all must transitions of P are simulated by Q, while all may transitions of Q are simulated by P. Another intuition shared by modal refinement relation is that some of the may transitions of P can be either transformed into must transitions of Q or blocked by Q, whenever P refines Q. 
                              Definition 2
                              A binary relation 
                                    R
                                    ⊆
                                    P
                                    ×
                                    P
                                  is a modal refinement 
                                 [24] relation if and only if the following transfer properties are satisfied.
                                    
                                       1.
                                       
                                          
                                             
                                                
                                                   ∀
                                                
                                                
                                                   P
                                                   ,
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   Q
                                                   ∈
                                                   P
                                                   ,
                                                   a
                                                   ∈
                                                   A
                                                
                                             
                                             
                                             (
                                             P
                                             R
                                             Q
                                             ∧
                                             P
                                             
                                                
                                                   
                                                      →
                                                      a
                                                   
                                                
                                                
                                                   □
                                                
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   ′
                                                
                                             
                                             )
                                             ⟹
                                             
                                             
                                                
                                                   ∃
                                                
                                                
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ∈
                                                   P
                                                
                                             
                                             
                                             Q
                                             
                                                
                                                   
                                                      →
                                                      a
                                                   
                                                
                                                
                                                   □
                                                
                                             
                                             
                                                
                                                   Q
                                                
                                                
                                                   ′
                                                
                                             
                                             ∧
                                             
                                                
                                                   P
                                                
                                                
                                                   ′
                                                
                                             
                                             R
                                             
                                                
                                                   Q
                                                
                                                
                                                   ′
                                                
                                             
                                          .


                                          
                                             
                                                
                                                   ∀
                                                
                                                
                                                   P
                                                   ,
                                                   Q
                                                   ,
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ∈
                                                   P
                                                   ,
                                                   a
                                                   ∈
                                                   A
                                                
                                             
                                             
                                             (
                                             P
                                             R
                                             Q
                                             ∧
                                             Q
                                             
                                                
                                                   
                                                      →
                                                      a
                                                   
                                                
                                                
                                                   ◊
                                                
                                             
                                             
                                                
                                                   Q
                                                
                                                
                                                   ′
                                                
                                             
                                             )
                                             ⟹
                                             
                                             
                                                
                                                   ∃
                                                
                                                
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ∈
                                                   P
                                                
                                             
                                             
                                             P
                                             
                                                
                                                   
                                                      →
                                                      a
                                                   
                                                
                                                
                                                   ◊
                                                
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   ′
                                                
                                             
                                             ∧
                                             
                                                
                                                   P
                                                
                                                
                                                   ′
                                                
                                             
                                             R
                                             
                                                
                                                   Q
                                                
                                                
                                                   ′
                                                
                                             
                                          .

Consider the product line MTS specified in Example 2. The LTS shown in Fig. 2(b) specifies a product which serves only coffee and is customized for the American market. It is not hard to see that the LTS shown in Fig. 2(b) refines the MTS of Fig. 2(a) by transforming certain may transitions into must transitions, or prohibiting them.

In [14], the authors pointed out that the derived products from an MTS may be invalid (and counter-intuitive) due to the inherent lack of expressiveness in MTSs for specifying feature constraints. In common practice, feature diagrams [32] have been used to model such constraints using a graphical notation. A feature diagram represents all the products of an SPL in terms of features that are arranged hierarchically. Usually, feature diagrams are represented by a directed acyclic graph, of which each node is a feature. There are different kinds of edges between a parent (feature) and its children (sub-features), namely, the ones representing the mandatory sub-features, and the others representing the optional sub-features. Furthermore, a feature diagram also specifies three additional constraints over features that may span over different levels of abstraction:
                              
                                 1.
                                 Alternative relationship, i.e., the designated sub-features can never be simultaneously present in any product.

Exclude relationship, i.e., different features at different levels of hierarchy can never be simultaneously present in any product.

Require relationship, i.e., if a feature is present in a product, the related feature should also be present in the same product.

For more information and a formal treatment of the syntax and the semantics of feature diagrams, we refer to [32]. 
                              Example 4
                              Consider the feature diagram shown in Fig. 3
                                 , which formalizes the features and feature constraints of Example 1 
                                 [7]. In this diagram every machine must consists of the features coin (o), and beverage (b) and may comprise an optional feature ring-tone (r). The coin feature is further decomposed into two alternative features euro (e) and dollar (d). Furthermore, Fig. 3 also specifies that cappuccino (p) requires ring-tone (r) denoted by a uni-directional dashed line and cappuccino is absent in the machine that takes dollars represented by bidirectional dashed line.

A feature diagram only specifies the structural aspects of variability in an SPL. To formally analyze the behavior of an SPL in [15], the transitions of a labeled transition system are annotated with logical constraints on the presence or absence of features; the features used in such logical constraints are assumed to be already specified in a feature diagram.

Let 
                              B
                              =
                              {
                              ⊤
                              ,
                              ⊥
                              }
                            be the set of Boolean constants and let 
                              B
                              (
                              F
                              )
                            be the set of all propositional formulae generated by interpreting the elements of the set F as propositional variables. For instance, in the context of Example 4, the formula 
                              e
                              ∧
                              ¬
                              d
                            asserts the presence of euro coin and the absence of dollar coin payment features. We let 
                              ϕ
                              ,
                              
                                 
                                    ϕ
                                 
                                 
                                    ′
                                 
                              
                            range over the set 
                              B
                              (
                              F
                              )
                           . 
                              Definition 3
                              A featured transition system (FTS) is a quintuple 
                                    (
                                    P
                                    ,
                                    A
                                    ,
                                    F
                                    ,
                                    →
                                    ,
                                    Λ
                                    )
                                 , where
                                    
                                       1.
                                       
                                          
                                             P
                                           is the set of states,


                                          A is the set of actions,


                                          F is a set of features,


                                          
                                             →
                                             ⊆
                                             S
                                             ×
                                             A
                                             ×
                                             B
                                             (
                                             F
                                             )
                                             ×
                                             S
                                           is the transition relation satisfying the following condition:
                                             
                                                
                                                   
                                                      
                                                         ∀
                                                      
                                                      
                                                         P
                                                         ,
                                                         a
                                                         ,
                                                         
                                                            
                                                               P
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         ,
                                                         ϕ
                                                         ,
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                   
                                                   (
                                                   (
                                                   P
                                                   ,
                                                   a
                                                   ,
                                                   ϕ
                                                   ,
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                   ∈
                                                   →
                                                   
                                                   ∧
                                                   
                                                   (
                                                   P
                                                   ,
                                                   a
                                                   ,
                                                   
                                                      
                                                         ϕ
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                   ∈
                                                   →
                                                   )
                                                   ⟹
                                                   ϕ
                                                   =
                                                   
                                                      
                                                         ϕ
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                
                                             
                                          
                                       


                                          
                                             Λ
                                             ⊆
                                             {
                                             λ
                                             :
                                             F
                                             →
                                             B
                                             }
                                           is a set of product configurations.

Just like in the case of MTSs, we reserve the symbols 
                              P
                              ,
                              
                                 
                                    P
                                 
                                 
                                    ′
                                 
                              
                              ,
                              Q
                              ,
                              
                                 
                                    Q
                                 
                                 
                                    ′
                                 
                              
                            to denote the states of an FTSs. Furthermore, we write 
                              P
                              
                                 
                                    
                                       →
                                       a
                                    
                                 
                                 
                                    ϕ
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    ′
                                 
                              
                            to denote an element 
                              (
                              P
                              ,
                              a
                              ,
                              ϕ
                              ,
                              
                                 
                                    Q
                                 
                                 
                                    ′
                                 
                              
                              )
                              ∈
                              →
                           . 
                              Example 5
                              Consider the MTS in Fig. 2(a); we obtain an FTS by discarding the distinction between may and must transitions and instead, annotating every transition with a formula over features given in Fig. 3. In the following table, we give the propositional formula associated with every transition of the vending machine example.
                                    
                                       
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                            
                                                            
                                                               
                                                                  Transitions
                                                                  Features
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                        
                                                                        
                                                                           →
                                                                           
                                                                              1e
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              2
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     e
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                        
                                                                        
                                                                           →
                                                                           
                                                                              1d
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              2
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     d
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              2
                                                                           
                                                                        
                                                                        
                                                                           →
                                                                           
                                                                              coffee
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              5
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     c
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              2
                                                                           
                                                                        
                                                                        
                                                                           →
                                                                           
                                                                              tea
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              6
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     t
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                            
                                                            
                                                               
                                                                  Transitions
                                                                  Features
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              2
                                                                           
                                                                        
                                                                        
                                                                           →
                                                                           
                                                                              cappuccino
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              7
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     p
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              12
                                                                           
                                                                        
                                                                        
                                                                           →
                                                                           
                                                                              
                                                                                 ring
                                                                              
                                                                              
                                                                              a
                                                                              
                                                                              
                                                                                 tone
                                                                              
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              13
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        p
                                                                        ⇒
                                                                        r
                                                                     
                                                                  
                                                               
                                                               
                                                                  Remaining transitions
                                                                  
                                                                     m
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

Lastly, the set of product configurations of the vending machine is the following set of 10 products specified by the feature diagram of Example 4 
                                 [9]:
                                    
                                       
                                          Λ
                                          =
                                          {
                                          {
                                          m
                                          ,
                                          o
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          e
                                          }
                                          ,
                                          {
                                          m
                                          ,
                                          o
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          e
                                          ,
                                          r
                                          }
                                          ,
                                          {
                                          m
                                          ,
                                          o
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          e
                                          ,
                                          t
                                          }
                                          ,
                                          {
                                          m
                                          ,
                                          o
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          e
                                          ,
                                          t
                                          ,
                                          r
                                          }
                                          ,
                                          {
                                          m
                                          ,
                                          o
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          e
                                          ,
                                          p
                                          ,
                                          r
                                          }
                                          ,
                                          {
                                          m
                                          ,
                                          o
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          d
                                          }
                                          ,
                                          {
                                          m
                                          ,
                                          o
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          d
                                          ,
                                          r
                                          }
                                          ,
                                          {
                                          m
                                          ,
                                          o
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          d
                                          ,
                                          t
                                          }
                                          ,
                                          {
                                          m
                                          ,
                                          o
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          d
                                          ,
                                          t
                                          ,
                                          r
                                          }
                                          ,
                                          {
                                          m
                                          ,
                                          o
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          e
                                          ,
                                          p
                                          ,
                                          r
                                          ,
                                          t
                                          }
                                          }
                                          .
                                       
                                    
                                 
                              

In [15] a class of operators 
                              
                                 
                                    Δ
                                 
                                 
                                    λ
                                 
                              
                              (
                              _
                              )
                           , each parameterized by product configurations 
                              λ
                              ∈
                              Λ
                           , is introduced to project an FTS into various LTSs, thereby obtaining different products from a product line. Roughly, the operation 
                              
                                 
                                    Δ
                                 
                                 
                                    λ
                                 
                              
                              (
                              _
                              )
                            prunes away those transitions from a product line whose feature constraints are not satisfied by the product configuration λ. 
                              Definition 4
                              Given a feature specification P (i.e., a state in an FTS), a set of selected features 
                                    λ
                                    ∈
                                    Λ
                                  induces a state 
                                    
                                       
                                          Δ
                                       
                                       
                                          λ
                                       
                                    
                                    (
                                    P
                                    )
                                  in an LTS defined by the following operational rule:
                                    
                                       
                                          
                                             
                                                λ
                                                ⊨
                                                ϕ
                                                
                                                P
                                                
                                                   
                                                      
                                                         →
                                                         a
                                                      
                                                   
                                                   
                                                      ϕ
                                                   
                                                
                                                Q
                                             
                                             
                                                
                                                   
                                                      Δ
                                                   
                                                   
                                                      λ
                                                   
                                                
                                                (
                                                P
                                                )
                                                
                                                   →
                                                   a
                                                
                                                
                                                   
                                                      Δ
                                                   
                                                   
                                                      λ
                                                   
                                                
                                                (
                                                Q
                                                )
                                             
                                          
                                          .
                                       
                                    
                                 
                              

It was argued in [14,15] that FTSs are better suited to model a software product line than a modal transition system. The crucial difference between the two is that all the may transitions in an MTS are independently optional, while in an FTS, one can make a finer distinction among them by annotating them with more complex boolean formulae pertaining to different types of feature constraints. In other words, the choice among transitions in an FTS depends on the product configuration, whereas the choice among may transitions in an MTS is nondeterministic [15]. 
                              Example 6
                              Consider the FTS given in Example 5 and the LTS given in Fig. 2(b) with the addition of transition 
                                    1
                                    
                                       →
                                       
                                          1e
                                       
                                    
                                    2
                                 . The latter is not a valid product of the former and cannot be derived from Definition 4. Note that there exists no valid set of features or product configuration 
                                    λ
                                    ∈
                                    Λ
                                  such that 
                                    λ
                                    (
                                    e
                                    )
                                    =
                                    λ
                                    (
                                    d
                                    )
                                    =
                                    ⊤
                                 . This is due to the semantics of the feature diagram depicted in Fig. 3, which specifies that 
                                    e
                                    ,
                                    d
                                  are alternative features. As a result, the transition relation defined in Definition 4 can never have a choice between the actions 
                                    
                                       1e
                                    
                                    ,
                                    
                                       1d
                                    
                                 .

Although the above example suggests that the class of FTSs is expressive enough to specify the different inter-feature relationships, the notion of deriving valid products (Definition 4) by an FTS is syntactical in nature (e.g., compared to the notion of deriving valid products by an MTS). This syntax-driven notion of valid product derivation is too rigid for any semantic analysis such as testing. In particular, we note that Definition 4 is not even closed under strong bisimulation (see [33] for a formal definition). Next, we present a notion of deriving valid products from an FTS which generalizes Definition 4. 
                              Definition 5
                              Given an FTS 
                                    (
                                    P
                                    ,
                                    A
                                    ,
                                    F
                                    ,
                                    →
                                    ,
                                    Λ
                                    )
                                 , an LTS 
                                    (
                                    P
                                    ,
                                    A
                                    ,
                                    →
                                    )
                                 , and a product 
                                    λ
                                    ∈
                                    Λ
                                 . A family of binary relations 
                                    
                                       
                                          R
                                       
                                       
                                          λ
                                       
                                    
                                    ⊆
                                    P
                                    ×
                                    P
                                  (parameterized by product configurations) are called product-derivation relations if and only if the following transfer properties are satisfied.
                                    
                                       1.
                                       
                                          
                                             
                                                
                                                   ∀
                                                
                                                
                                                   P
                                                   ,
                                                   Q
                                                   ,
                                                   a
                                                   ,
                                                   p
                                                   ,
                                                   ϕ
                                                
                                             
                                             
                                             (
                                             P
                                             
                                                
                                                   R
                                                
                                                
                                                   λ
                                                
                                             
                                             p
                                             ∧
                                             P
                                             
                                                
                                                   
                                                      →
                                                      a
                                                   
                                                
                                                
                                                   ϕ
                                                
                                             
                                             Q
                                             ∧
                                             λ
                                             ⊨
                                             ϕ
                                             )
                                             
                                             ⇒
                                             
                                             
                                                
                                                   ∃
                                                
                                                
                                                   q
                                                
                                             
                                             
                                             p
                                             
                                                →
                                                a
                                             
                                             q
                                             ∧
                                             Q
                                             
                                                
                                                   R
                                                
                                                
                                                   λ
                                                
                                             
                                             q
                                          ;


                                          
                                             
                                                
                                                   ∀
                                                
                                                
                                                   P
                                                   ,
                                                   a
                                                   ,
                                                   p
                                                   ,
                                                   q
                                                
                                             
                                             
                                             (
                                             P
                                             
                                                
                                                   R
                                                
                                                
                                                   λ
                                                
                                             
                                             p
                                             ∧
                                             p
                                             
                                                →
                                                a
                                             
                                             q
                                             )
                                             
                                             ⇒
                                             
                                             
                                                
                                                   ∃
                                                
                                                
                                                   Q
                                                   ,
                                                   ϕ
                                                
                                             
                                             
                                             P
                                             
                                                
                                                   
                                                      →
                                                      a
                                                   
                                                
                                                
                                                   ϕ
                                                
                                             
                                             Q
                                             ∧
                                             λ
                                             ⊨
                                             ϕ
                                             ∧
                                             Q
                                             
                                                
                                                   R
                                                
                                                
                                                   λ
                                                
                                             
                                             q
                                          .

We end this section on FTSs by highlighting two intuitive properties of the product derivation relation. 
                              Lemma 1
                              
                                 For any given feature specification P and the derived product 
                                 
                                    
                                       
                                          Δ
                                       
                                       
                                          λ
                                       
                                    
                                    (
                                    P
                                    )
                                 
                                 , we have 
                                 
                                    P
                                    
                                       
                                          ⊢
                                       
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          Δ
                                       
                                       
                                          λ
                                       
                                    
                                    (
                                    P
                                    )
                                 
                                 .
                              


                                 Given any feature specification P and a derived product p with 
                                 
                                    P
                                    
                                       
                                          ⊢
                                       
                                       
                                          λ
                                       
                                    
                                    p
                                 
                                 , for some product configuration λ. If q is strongly bisimilar (in the sense of Park 
                                 
                                    [33]
                                 
                                 ) to p, then 
                                 
                                    P
                                    
                                       
                                          ⊢
                                       
                                       
                                          λ
                                       
                                    
                                    q
                                 
                                 .
                              

Gruler et al. [17] extended Milner's Calculus of Communicating Systems (CCS) [25] into PL-CCS by introducing the “binary variant” operator ⊕ to represent the alternative relationship in feature diagrams. 
                           Definition 6
                           Let 
                                 A
                                 =
                                 Σ
                                 ∪
                                 
                                    
                                       Σ
                                    
                                    
                                       ¯
                                    
                                 
                                 ∪
                                 {
                                 τ
                                 }
                               be the alphabet, where 
                                 
                                    
                                       Σ
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       a
                                    
                                    
                                       ¯
                                    
                                 
                                 |
                                 a
                                 ∈
                                 Σ
                                 }
                              . The syntax of PL-CCS terms e is defined by the grammar 
                                 
                                    Nil
                                 
                                 |
                                 α
                                 .
                                 e
                                 |
                                 e
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       ′
                                    
                                 
                                 |
                                 e
                                 ⊕
                                 
                                    
                                       e
                                    
                                    
                                       ′
                                    
                                 
                                 |
                                 e
                                 ∥
                                 
                                    
                                       e
                                    
                                    
                                       ′
                                    
                                 
                                 |
                                 e
                                 [
                                 f
                                 ]
                                 |
                                 e
                                 ∖
                                 L
                              , where Nil is the deadlocking process, for each 
                                 α
                                 ∈
                                 A
                              , 
                                 α
                                 .
                                 _
                               denotes action prefixing, 
                                 _
                                 +
                                 _
                               denotes non-deterministic choice, 
                                 _
                                 ⊕
                                 _
                               denotes binary variant, 
                                 _
                                 ∥
                                 _
                               denotes parallel composition, for each 
                                 f
                                 :
                                 A
                                 →
                                 A
                              , 
                                 _
                                 [
                                 f
                                 ]
                               denotes renaming by means of f, and for each 
                                 L
                                 ⊆
                                 A
                              , 
                                 _
                                 ∖
                                 L
                               denotes the restriction operator (blocking (co)actions in L). In addition, one may define recursive processes by means of process identifiers and equations.

At the first sight, the variant operator ⊕ is reminiscent of the ordinary alternative composition operator + from CCS; however, they are substantially different, as the binary variant operator remembers the chosen alternative. For example, consider process terms 
                           s
                           =
                           a
                           .
                           (
                           b
                           .
                           s
                           +
                           c
                           .
                           s
                           )
                         and 
                           t
                           =
                           a
                           .
                           (
                           b
                           .
                           t
                           ⊕
                           c
                           .
                           t
                           )
                        . Intuitively, the recursive process s keeps on making a choice between b and c upon performing a; whereas in t the choice is made at the first iteration after performing the action a and it is recorded for and respected in all future iterations, i.e., the process behaves deterministically once the choice between “features” b and c is made once and for all.

As syntactic sugar, a unary operator 
                           〈
                           _
                           〉
                        , called the optional operator, was also introduced to represent the optional features of a feature diagram. It can be defined in PL-CCS as 
                           〈
                           P
                           〉
                           =
                           P
                           ⊕
                           
                              Nil
                           
                        . 
                           Example 7
                           The following process definition specifies the vending machine product line in PL-CCS.
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             1
                                          
                                       
                                       =
                                       
                                          1e
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             2
                                          
                                       
                                       ⊕
                                       
                                          1d
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             2
                                          
                                       
                                       
                                       
                                          
                                             s
                                          
                                          
                                             7
                                          
                                       
                                       =
                                       
                                          pour sugar
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             8
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             2
                                          
                                       
                                       =
                                       
                                          sugar
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             3
                                          
                                       
                                       +
                                       
                                          no sugar
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             4
                                          
                                       
                                       
                                       
                                          
                                             s
                                          
                                          
                                             8
                                          
                                       
                                       =
                                       
                                          pour coffee
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             11
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             3
                                          
                                       
                                       =
                                       
                                          coffee
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             5
                                          
                                       
                                       +
                                       〈
                                       
                                          tea
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             6
                                          
                                       
                                       +
                                       
                                          cappuccino
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             7
                                          
                                       
                                       〉
                                       
                                       
                                          
                                             s
                                          
                                          
                                             9
                                          
                                       
                                       =
                                       
                                          pour tea
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             12
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             4
                                          
                                       
                                       =
                                       
                                          coffee
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             10
                                          
                                       
                                       +
                                       〈
                                       
                                          tea
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             9
                                          
                                       
                                       +
                                       
                                          cappuccino
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             8
                                          
                                       
                                       〉
                                       
                                       
                                          
                                             s
                                          
                                          
                                             10
                                          
                                       
                                       =
                                       
                                          pour coffee
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             12
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             5
                                          
                                       
                                       =
                                       
                                          pour sugar
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             10
                                          
                                       
                                       
                                       
                                          
                                             s
                                          
                                          
                                             12
                                          
                                       
                                       =
                                       
                                          ring tone
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             13
                                          
                                       
                                       +
                                       
                                          skip
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             13
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             6
                                          
                                       
                                       =
                                       
                                          pour sugar
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             9
                                          
                                       
                                       
                                       
                                          
                                             s
                                          
                                          
                                             13
                                          
                                       
                                       =
                                       
                                          take cup
                                       
                                       .
                                       
                                          
                                             s
                                          
                                          
                                             1
                                          
                                       
                                       .
                                    
                                 
                              
                           

The semantics of a PL-CCS term is defined in terms of product line labeled transition systems [17], recalled below, using a structural operational semantics. Roughly, the states and the transition relations of a product line labeled transition system are enriched with configuration vectors (i.e., functions of type 
                           
                              
                                 {
                                 L
                                 ,
                                 R
                                 ,
                                 ?
                                 }
                              
                              
                                 I
                              
                           
                         with I being an index set) that records the selection made in past about the alternative features. 
                           Definition 7
                           Let 
                                 
                                    
                                       {
                                       L
                                       ,
                                       R
                                       ,
                                       ?
                                       }
                                    
                                    
                                       I
                                    
                                 
                               denote the set of all total functions from an index set I to the set 
                                 {
                                 L
                                 ,
                                 R
                                 ,
                                 ?
                                 }
                              . A product line labeled transition system (PL-LTS) is a quadruple 
                                 (
                                 P
                                 ×
                                 
                                    
                                       {
                                       L
                                       ,
                                       R
                                       ,
                                       ?
                                       }
                                    
                                    
                                       I
                                    
                                 
                                 ,
                                 A
                                 ,
                                 I
                                 ,
                                 →
                                 )
                               consisting of a set of states 
                                 P
                                 ×
                                 
                                    
                                       {
                                       L
                                       ,
                                       R
                                       ,
                                       ?
                                       }
                                    
                                    
                                       I
                                    
                                 
                              , a set of actions A, and a transition relation 
                                 →
                                 ⊆
                                 (
                                 P
                                 ×
                                 
                                    
                                       {
                                       L
                                       ,
                                       R
                                       ,
                                       ?
                                       }
                                    
                                    
                                       I
                                    
                                 
                                 )
                                 ×
                                 (
                                 A
                                 ×
                                 
                                    
                                       {
                                       L
                                       ,
                                       R
                                       ,
                                       ?
                                       }
                                    
                                    
                                       I
                                    
                                 
                                 )
                                 ×
                                 (
                                 P
                                 ×
                                 
                                    
                                       {
                                       L
                                       ,
                                       R
                                       ,
                                       ?
                                       }
                                    
                                    
                                       I
                                    
                                 
                                 )
                               satisfying the following restrictions:
                                 
                                    1.
                                    
                                       
                                          
                                             
                                                ∀
                                             
                                             
                                                P
                                                ,
                                                ν
                                                ,
                                                a
                                                ,
                                                Q
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ″
                                                   
                                                
                                             
                                          
                                          
                                          (
                                          P
                                          ,
                                          ν
                                          )
                                          
                                             →
                                             
                                                a
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          (
                                          Q
                                          ,
                                          
                                             
                                                ν
                                             
                                             
                                                ″
                                             
                                          
                                          )
                                          ⟹
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          
                                             
                                                ν
                                             
                                             
                                                ″
                                             
                                          
                                       .


                                       
                                          
                                             
                                                ∀
                                             
                                             
                                                P
                                                ,
                                                ν
                                                ,
                                                a
                                                ,
                                                Q
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                          (
                                          (
                                          P
                                          ,
                                          ν
                                          )
                                          
                                             →
                                             
                                                a
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          (
                                          Q
                                          ,
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          ∧
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          ≠
                                          ν
                                          )
                                          ⟹
                                          
                                             
                                                ∃
                                             
                                             
                                                i
                                             
                                          
                                          
                                          
                                             (
                                             
                                                
                                                   ν
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             i
                                             )
                                             ≠
                                             ν
                                             (
                                             i
                                             )
                                             ∧
                                             
                                                
                                                   ∀
                                                
                                                
                                                   j
                                                   ≠
                                                   i
                                                
                                             
                                             
                                             
                                                
                                                   ν
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             j
                                             )
                                             =
                                             ν
                                             (
                                             j
                                             )
                                             )
                                          
                                       .


                                       
                                          
                                             
                                                ∀
                                             
                                             
                                                P
                                                ,
                                                ν
                                                ,
                                                a
                                                ,
                                                Q
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ,
                                                i
                                             
                                          
                                          
                                          (
                                          P
                                          ,
                                          ν
                                          )
                                          
                                             →
                                             
                                                a
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          (
                                          Q
                                          ,
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          ∧
                                          ν
                                          (
                                          i
                                          )
                                          ≠
                                          ?
                                          ⟹
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          (
                                          i
                                          )
                                          =
                                          ν
                                          (
                                          i
                                          )
                                       .

Notice that, as a consequence of item 2 in Definition 7, for any transition 
                           (
                           P
                           ,
                           ν
                           )
                           
                              →
                              
                                 a
                                 ,
                                 
                                    
                                       ν
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           (
                           Q
                           ,
                           
                              
                                 ν
                              
                              
                                 ′
                              
                           
                           )
                        , if 
                           v
                           ≠
                           
                              
                                 v
                              
                              
                                 ′
                              
                           
                        , we can find a unique 
                           i
                           ∈
                           I
                         such that 
                           
                              
                                 ν
                              
                              
                                 ′
                              
                           
                           (
                           i
                           )
                           ≠
                           ν
                           (
                           i
                           )
                           ∧
                           
                              
                                 ∀
                              
                              
                                 j
                                 ≠
                                 i
                              
                           
                           
                           
                              
                                 ν
                              
                              
                                 ′
                              
                           
                           (
                           j
                           )
                           =
                           ν
                           (
                           j
                           )
                        . Furthermore, it should also be noted that Conditions 1, 2, and 3 follow from the operational rules given by Gruler et al. to a PL-CCS term in [17].

Now in order to define when an LTS is a valid product of a given PL-LTS, we need the following notion of ordering on configurations and configuration vectors. 
                           Definition 8
                           The ordering relation ⊑ on the set 
                                 {
                                 L
                                 ,
                                 R
                                 ,
                                 ?
                                 }
                               is defined in the following way:
                                 
                                    
                                       ⊑
                                       =
                                       {
                                       (
                                       ?
                                       ,
                                       ?
                                       )
                                       ,
                                       (
                                       L
                                       ,
                                       L
                                       )
                                       ,
                                       (
                                       R
                                       ,
                                       R
                                       )
                                       ,
                                       (
                                       ?
                                       ,
                                       L
                                       )
                                       ,
                                       (
                                       ?
                                       ,
                                       R
                                       )
                                       }
                                       .
                                    
                                 
                               We lift this ordering relation to the level of configuration vectors by letting 
                                 ν
                                 ⊑
                                 
                                    
                                       ν
                                    
                                    
                                       ′
                                    
                                 
                                 ⇔
                                 
                                    
                                       ∀
                                    
                                    
                                       i
                                       ∈
                                       I
                                    
                                 
                                 
                                 ν
                                 (
                                 i
                                 )
                                 ⊑
                                 
                                    
                                       ν
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 i
                                 )
                              , for any 
                                 ν
                                 ,
                                 
                                    
                                       ν
                                    
                                    
                                       ′
                                    
                                 
                                 ∈
                                 
                                    
                                       {
                                       L
                                       ,
                                       R
                                       ,
                                       ?
                                       }
                                    
                                    
                                       I
                                    
                                 
                              .

We end this section on PL-CCS by proposing a definition of product-derivation relations in a similar vein to Definition 5. 
                           Definition 9
                           Let 
                                 (
                                 P
                                 ×
                                 
                                    
                                       {
                                       L
                                       ,
                                       R
                                       ,
                                       ?
                                       }
                                    
                                    
                                       I
                                    
                                 
                                 ,
                                 A
                                 ,
                                 →
                                 )
                               be a PL-LTS and let 
                                 (
                                 P
                                 ,
                                 A
                                 ,
                                 →
                                 )
                               be an LTS. A family of binary relations 
                                 
                                    
                                       R
                                    
                                    
                                       θ
                                    
                                 
                                 ⊆
                                 (
                                 P
                                 ×
                                 
                                    
                                       {
                                       L
                                       ,
                                       R
                                       ,
                                       ?
                                       }
                                    
                                    
                                       I
                                    
                                 
                                 )
                                 ×
                                 P
                               (parameterized by every product configuration 
                                 θ
                                 ∈
                                 
                                    
                                       {
                                       L
                                       ,
                                       R
                                       }
                                    
                                    
                                       I
                                    
                                 
                              ) is a family of product-derivation relations if and only if the following transfer properties are satisfied:
                                 
                                    1.
                                    
                                       
                                          
                                             
                                                ∀
                                             
                                             
                                                P
                                                ,
                                                Q
                                                ,
                                                a
                                                ,
                                                ν
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ,
                                                p
                                             
                                          
                                          
                                          (
                                          (
                                          P
                                          ,
                                          ν
                                          )
                                          
                                             
                                                R
                                             
                                             
                                                θ
                                             
                                          
                                          p
                                          ∧
                                          (
                                          P
                                          ,
                                          ν
                                          )
                                          
                                             
                                                
                                                   →
                                                   a
                                                
                                             
                                             
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          (
                                          Q
                                          ,
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          ∧
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          ⊑
                                          θ
                                          )
                                          
                                          ⇒
                                          
                                          
                                             
                                                ∃
                                             
                                             
                                                q
                                             
                                          
                                          
                                          p
                                          
                                             →
                                             a
                                          
                                          q
                                          ∧
                                          (
                                          Q
                                          ,
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          
                                             
                                                R
                                             
                                             
                                                θ
                                             
                                          
                                          q
                                       ,


                                       
                                          
                                             
                                                ∀
                                             
                                             
                                                P
                                                ,
                                                a
                                                ,
                                                ν
                                                ,
                                                p
                                                ,
                                                q
                                             
                                          
                                          
                                          (
                                          (
                                          P
                                          ,
                                          ν
                                          )
                                          
                                             
                                                R
                                             
                                             
                                                θ
                                             
                                          
                                          p
                                          ∧
                                          p
                                          
                                             →
                                             a
                                          
                                          q
                                          )
                                          
                                          ⇒
                                          
                                          
                                             
                                                ∃
                                             
                                             
                                                Q
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                          (
                                          P
                                          ,
                                          ν
                                          )
                                          
                                             
                                                
                                                   →
                                                   a
                                                
                                             
                                             
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          (
                                          Q
                                          ,
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          ∧
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          ⊑
                                          θ
                                          ∧
                                          (
                                          Q
                                          ,
                                          
                                             
                                                ν
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          
                                             
                                                R
                                             
                                             
                                                θ
                                             
                                          
                                          q
                                       .

The goal of this section is to formally compare the expressiveness of the three product line formalisms as outlined in the previous section. Before we do so, let us bring all the three formalisms under one single definition of a product line structure. Intuitively, a product line structure consists of a product line specification and a semantic function 
                        〚
                        
                        〛
                      that maps a specification into a set of implementations (valid products) modeled as LTSs. 
                        Definition 10
                        Let 
                              (
                              P
                              ,
                              A
                              ,
                              →
                              )
                            be an LTS. A product line structure is a tuple 
                              M
                              =
                              (
                              M
                              ,
                              〚
                              
                              〛
                              )
                           , where 
                              M
                            is the class of all intended product line models or specifications (in our case: MTSs, FTSs, and PL-LTSs) and 
                              〚
                              
                              〛
                              :
                              M
                              →
                              
                                 
                                    2
                                 
                                 
                                    P
                                 
                              
                            is the semantic function mapping a product line specification to a set of LTSs.

An encoding 
                           
                              E
                              :
                              M
                              →
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                            from a product line structure 
                              M
                              =
                              (
                              M
                              ,
                              〚
                              
                              〛
                              )
                            into a product line structure 
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                              =
                              (
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    〚
                                    
                                    〛
                                 
                                 
                                    ′
                                 
                              
                              )
                            is a function 
                              E
                              :
                              M
                              →
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                            satisfying the correctness criterion 
                              〚
                              
                              〛
                              =
                              E
                              ∘
                              
                                 
                                    〚
                                    
                                    〛
                                 
                                 
                                    ′
                                 
                              
                           .

We say that the product line structure 
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                            is at-least as expressive as 
                           M if and only if there exists an encoding 
                              E
                              :
                              M
                              →
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                           .

Furthermore, we say that the product line structure 
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                            is less expressive than 
                           M, if and only if M is at-least as expressive as 
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                           , and 
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                            is not at-least as expressive as M, i.e., there does not exist any encoding 
                              E
                              :
                              M
                              →
                              
                                 
                                    M
                                 
                                 
                                    ′
                                 
                              
                           .

In the remainder of this section, we explore the expressiveness among the classes of MTSs, FTSs, and PL-LTSs. In order to do this, we start with relating the two less expressive models, i.e., MTSs and PL-LTSs, to each other, and then move up in the lattice of expressiveness. Note that the “at-least as expressive as” relation is transitive (by the composition of the encoding functions) and hence, we can use the transitivity to relate the least (i.e., MTSs) and the greatest (i.e., FTSs) points in the lattice, once we relate the middle-point (i.e., PL-LTSs) to each of them.

The following two theorems relate the expressiveness of PL-LTSs and MTSs. 
                        Theorem 1
                        
                           The class of PL-LTSs is at-least as expressive as the class of MTSs.
                        

Consider the MTS 
                              (
                              P
                              ,
                              A
                              ,
                              
                                 
                                    
                                       →
                                       
                                    
                                 
                                 
                                    ◊
                                 
                              
                              ,
                              
                                 
                                    
                                       →
                                       
                                    
                                 
                                 
                                    □
                                 
                              
                              )
                            and some 
                              P
                              ∈
                              P
                           . Let 
                              ↠
                              ⊆
                              P
                              ×
                              
                                 
                                    A
                                 
                                 
                                    ⁎
                                 
                              
                              ×
                              P
                            be the reachability relation defined as follows: 
                              
                                 
                                 
                                    P
                                    
                                       ↠
                                       ε
                                    
                                    P
                                 
                              
                              
                              
                                 
                                    P
                                    
                                       ↠
                                       s
                                    
                                    
                                       
                                          P
                                       
                                       
                                          ′
                                       
                                    
                                    
                                    
                                       
                                          P
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       
                                          
                                             →
                                             a
                                          
                                       
                                       
                                          ◊
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          ″
                                       
                                    
                                 
                                 
                                    P
                                    
                                       ↠
                                       
                                          s
                                          a
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          ″
                                       
                                    
                                 
                              
                           . Let 
                              
                                 tr
                              
                              (
                              P
                              )
                            be the set of traces generated by P, i.e., 
                              
                                 tr
                              
                              (
                              P
                              )
                              =
                              {
                              s
                              |
                              
                                 
                                    ∃
                                 
                                 
                                    Q
                                 
                              
                              
                              P
                              
                                 ↠
                                 s
                              
                              Q
                              }
                           . For state P, we define a family of transition relations parameterized by the traces of P as follows: 
                              
                                 
                                    Q
                                    
                                       
                                          
                                             →
                                             a
                                          
                                       
                                       
                                          ◊
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          ′
                                       
                                    
                                    
                                    s
                                    ∈
                                    
                                       tr
                                    
                                    (
                                    P
                                    )
                                 
                                 
                                    Q
                                    
                                       
                                          
                                             →
                                             a
                                          
                                       
                                       
                                          s
                                          ,
                                          P
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           . We drop the subscript P from the family of transition relations whenever it is clear from the context.

Next, we construct a PL-LTS whose configuration vectors are functions of type
                              
                                 
                                    
                                       tr
                                    
                                    (
                                    P
                                    )
                                    →
                                    
                                       (
                                       
                                          ⋃
                                          
                                             s
                                             ∈
                                             
                                                tr
                                             
                                             (
                                             P
                                             )
                                          
                                       
                                       
                                          
                                             
                                                →
                                                
                                             
                                          
                                          
                                             s
                                          
                                       
                                       
                                       →
                                       
                                       {
                                       L
                                       ,
                                       R
                                       ,
                                       ?
                                       }
                                       )
                                    
                                    .
                                 
                              
                            The transition relation between the states of PL-LTS is defined as the smallest relation satisfying:
                              
                                 
                              
                           
                        

where 
                              Q
                              
                                 
                                    
                                       →
                                       a
                                    
                                 
                                 
                                    ◊
                                    ∖
                                    □
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    ′
                                 
                              
                              ⇔
                              Q
                              
                                 
                                    
                                       →
                                       a
                                    
                                 
                                 
                                    ◊
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    ′
                                 
                              
                              ∧
                              (
                              Q
                              ,
                              a
                              ,
                              
                                 
                                    Q
                                 
                                 
                                    ′
                                 
                              
                              )
                              ∉
                              
                              
                                 
                                    
                                       →
                                       
                                    
                                 
                                 
                                    □
                                 
                              
                            and the expression 
                              
                                 
                                    ν
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    =
                                 
                                 
                                    s
                                 
                              
                              ν
                              ↑
                              {
                              (
                              Q
                              ,
                              a
                              ,
                              
                                 
                                    Q
                                 
                                 
                                    ′
                                 
                              
                              )
                              ↦
                              X
                              }
                            (for 
                              X
                              ∈
                              {
                              L
                              ,
                              R
                              }
                           ) is defined in the following way:
                              
                                 
                                    
                                       
                                          ν
                                       
                                       
                                          ′
                                       
                                    
                                    (
                                    s
                                    )
                                    (
                                    
                                       
                                          Q
                                       
                                       
                                          ¯
                                       
                                    
                                    
                                       
                                          
                                             →
                                             
                                                
                                                   a
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                X
                                             
                                             
                                                if
                                                
                                                s
                                                =
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ∧
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                =
                                                Q
                                                ∧
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                =
                                                a
                                                ∧
                                                
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                =
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ν
                                                (
                                                s
                                                )
                                                (
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                
                                                   
                                                      
                                                         →
                                                         
                                                            
                                                               a
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                             
                                             
                                                otherwise
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        

We fix 
                              E
                              (
                              P
                              )
                              =
                              (
                              P
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              )
                           , where 
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              (
                              s
                              )
                              (
                              Q
                              
                                 
                                    
                                       →
                                       a
                                    
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    ′
                                 
                              
                              )
                              =
                              ?
                            for 
                              s
                              ,
                              
                                 
                                    s
                                 
                                 
                                    ′
                                 
                              
                              ∈
                              
                                 tr
                              
                              (
                              P
                              )
                           . Furthermore, we let the symbols 
                              θ
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    ′
                                 
                              
                            range over the total configuration vectors, i.e., the functions of type 
                              
                                 tr
                              
                              (
                              P
                              )
                              →
                              
                                 (
                                 
                                    
                                       ⋃
                                    
                                    
                                       s
                                       ∈
                                       
                                          tr
                                       
                                       (
                                       P
                                       )
                                    
                                 
                                 
                                    
                                       
                                          →
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 
                                 →
                                 
                                 {
                                 L
                                 ,
                                 R
                                 }
                                 )
                              
                           . Now we are in the position to show that 
                              〚
                              P
                              〛
                              =
                              
                                 
                                    〚
                                    E
                                    (
                                    P
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                           , where 
                              〚
                              P
                              〛
                              =
                              {
                              p
                              |
                              P
                              ⪯
                              p
                              }
                            and 
                              
                                 
                                    〚
                                    E
                                    (
                                    P
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                              =
                              {
                              p
                              |
                              
                                 
                                    ∃
                                 
                                 
                                    θ
                                 
                              
                              
                              E
                              (
                              P
                              )
                              
                                 
                                    ⊢
                                 
                                 
                                    θ
                                 
                              
                              p
                              }
                           . We divide the proof obligation into two obligations: 
                              
                                 
                                    〚
                                    E
                                    (
                                    P
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                              ⊆
                              〚
                              P
                              〛
                            and 
                              〚
                              P
                              〛
                              ⊆
                              
                                 
                                    〚
                                    E
                                    (
                                    P
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                           , which we prove below.

(
                              
                                 
                                    〚
                                    E
                                    (
                                    P
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                              ⊆
                              〚
                              P
                              〛
                           ). Let p be a state in an LTS such that 
                              P
                              
                                 
                                    ⊢
                                 
                                 
                                    θ
                                 
                              
                              p
                           , for some θ. Define a relation 
                              Q
                              R
                              q
                              ⇔
                              
                                 
                                    ∃
                                 
                                 
                                    ν
                                    ,
                                    s
                                 
                              
                              
                              (
                              Q
                              ,
                              ν
                              )
                              
                                 
                                    ⊢
                                 
                                 
                                    θ
                                 
                              
                              q
                              ∧
                              ν
                              ⊑
                              θ
                              ∧
                              P
                              
                                 ↠
                                 s
                              
                              Q
                              ∧
                              p
                              
                                 ↠
                                 s
                              
                              q
                           . Next, we show that 
                              R
                            is a modal refinement relation.
                              
                                 1.
                                 Let 
                                       Q
                                       
                                          
                                             
                                                →
                                                a
                                             
                                          
                                          
                                             □
                                          
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                     and 
                                       Q
                                       R
                                       q
                                    . Then, 
                                       (
                                       Q
                                       ,
                                       ν
                                       )
                                       R
                                       q
                                       ∧
                                       ν
                                       ⊑
                                       θ
                                       ∧
                                       P
                                       
                                          ↠
                                          s
                                       
                                       Q
                                       ∧
                                       p
                                       
                                          ↠
                                          s
                                       
                                       q
                                    , for some 
                                       ν
                                       ,
                                       s
                                    . Clearly, 
                                       s
                                       a
                                       ∈
                                       
                                          tr
                                       
                                       (
                                       P
                                       )
                                    . Let 
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          
                                             =
                                          
                                          
                                             s
                                             a
                                          
                                       
                                       ν
                                       ↑
                                       {
                                       (
                                       Q
                                       ,
                                       a
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       ↦
                                       θ
                                       (
                                       s
                                       a
                                       )
                                       (
                                       Q
                                       
                                          
                                             
                                                →
                                                a
                                             
                                          
                                          
                                             s
                                             a
                                          
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       }
                                    . Note that 
                                       θ
                                       (
                                       s
                                       a
                                       )
                                       (
                                       Q
                                       
                                          
                                             
                                                →
                                                a
                                             
                                          
                                          
                                             s
                                             a
                                          
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                     can be either L or R. Then, we find 
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       ⊑
                                       θ
                                    . Now from the transfer property of 
                                       
                                          
                                             ⊢
                                          
                                          
                                             θ
                                          
                                       
                                     we find a 
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                     such that 
                                       q
                                       
                                          →
                                          a
                                       
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       ∧
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       
                                          
                                             ⊢
                                          
                                          
                                             θ
                                          
                                       
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                    . Hence, 
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       R
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                    .

Let 
                                       q
                                       
                                          →
                                          a
                                       
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                     and 
                                       Q
                                       R
                                       q
                                    . Trivial.

(
                              〚
                              P
                              〛
                              ⊆
                              
                                 
                                    〚
                                    E
                                    (
                                    P
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                           ). Let p be some state in an LTS such that 
                              P
                              ⪯
                              p
                           . Let 
                              
                                 
                                    tr
                                 
                                 
                                    m
                                 
                              
                              (
                              p
                              )
                            denote the set of maximal traces from the state p. (Note that a maximal trace is either an infinite trace or a finite trace that leads to a deadlock state.) For every maximal trace 
                              s
                              ∈
                              
                                 
                                    tr
                                 
                                 
                                    m
                                 
                              
                              (
                              p
                              )
                           , we know that there is a unique execution e starting from 
                              
                                 
                                    [
                                    p
                                    ]
                                 
                                 
                                    ↔
                                 
                              
                            such that 
                              dom
                              (
                              e
                              )
                              =
                              s
                           , where 
                              
                                 
                                    [
                                    p
                                    ]
                                 
                                 
                                    ↔
                                 
                              
                            is the transition system modulo strong bisimulation defined in the standard way.
                              2
                           
                           
                              2
                              An execution e starting from 
                                    
                                       
                                          [
                                          p
                                          ]
                                       
                                       
                                          ↔
                                       
                                    
                                  is a function 
                                    e
                                    :
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    |
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    ⪯
                                    s
                                    }
                                    →
                                    
                                       
                                          2
                                       
                                       
                                          P
                                       
                                    
                                  (for any 
                                    s
                                    ∈
                                    
                                       tr
                                    
                                    (
                                    p
                                    )
                                 ) such that 
                                    e
                                    (
                                    ε
                                    )
                                    =
                                    
                                       
                                          [
                                          p
                                          ]
                                       
                                       
                                          ↔
                                       
                                    
                                  and 
                                    e
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    
                                       →
                                       a
                                    
                                    e
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    a
                                    )
                                    ⇔
                                    
                                       
                                          ∃
                                       
                                       
                                          q
                                          ,
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    
                                    q
                                    ∈
                                    e
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    ∧
                                    
                                       
                                          q
                                       
                                       
                                          ′
                                       
                                    
                                    ∈
                                    e
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    a
                                    )
                                    ∧
                                    q
                                    
                                       →
                                       a
                                    
                                    
                                       
                                          q
                                       
                                       
                                          ′
                                       
                                    
                                 , for every 
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    ⪯
                                    s
                                 . Here ⪯ is the prefix relation between any two words.
                            Therefore, for any maximal trace 
                              s
                              ∈
                              
                                 
                                    tr
                                 
                                 
                                    m
                                 
                              
                              (
                              p
                              )
                           , we denote the corresponding unique execution by 
                              
                                 
                                    e
                                 
                                 
                                    s
                                 
                              
                           . Define total configuration vectors 
                              
                                 
                                    θ
                                 
                                 
                                    p
                                 
                              
                            (for every 
                              P
                              ⪯
                              p
                           ) in the following way:
                              
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          p
                                       
                                    
                                    (
                                    s
                                    )
                                    (
                                    Q
                                    
                                       
                                          
                                             →
                                             a
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                L
                                             
                                             
                                                if
                                                
                                                s
                                                ∈
                                                
                                                   
                                                      tr
                                                   
                                                   
                                                      m
                                                   
                                                
                                                (
                                                p
                                                )
                                                ∧
                                                s
                                                =
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ∧
                                                
                                                   
                                                      ∃
                                                   
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ″
                                                         
                                                      
                                                      ⪯
                                                      s
                                                   
                                                
                                                
                                                Q
                                                ⪯
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      s
                                                   
                                                
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ″
                                                   
                                                
                                                )
                                                ∧
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ⪯
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      s
                                                   
                                                
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ″
                                                   
                                                
                                                a
                                                )
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                otherwise
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                            where 
                              Q
                              ⪯
                              X
                            is defined as 
                              
                                 
                                    ∀
                                 
                                 
                                    q
                                 
                              
                              
                              q
                              ∈
                              X
                              ⟹
                              Q
                              ⪯
                              q
                           . Next, we define a relation 
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                            as follows:
                              
                                 
                                    (
                                    Q
                                    ,
                                    ν
                                    )
                                    
                                       
                                          R
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    q
                                    
                                    ⇔
                                    
                                    ν
                                    ⊑
                                    
                                       
                                          θ
                                       
                                       
                                          p
                                       
                                    
                                    ∧
                                    
                                       
                                          ∃
                                       
                                       
                                          s
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    
                                    s
                                    ∈
                                    
                                       
                                          tr
                                       
                                       
                                          m
                                       
                                    
                                    (
                                    p
                                    )
                                    ∧
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    ⪯
                                    s
                                    ∧
                                    P
                                    
                                       ↠
                                       
                                          
                                             s
                                          
                                          
                                             ′
                                          
                                       
                                    
                                    Q
                                    ∧
                                    Q
                                    ⪯
                                    
                                       
                                          e
                                       
                                       
                                          s
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    ∧
                                    q
                                    ∈
                                    
                                       
                                          e
                                       
                                       
                                          s
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    .
                                 
                              
                            Next, we show that 
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                            is a product derivation relation.
                              
                                 1.
                                 Let 
                                       (
                                       Q
                                       ,
                                       ν
                                       )
                                       
                                          →
                                          
                                             a
                                             ,
                                             
                                                
                                                   ν
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    , 
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       ⊑
                                       
                                          
                                             θ
                                          
                                          
                                             p
                                          
                                       
                                    , and 
                                       (
                                       Q
                                       ,
                                       ν
                                       )
                                       
                                          
                                             R
                                          
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       q
                                    . Then, from the construction of 
                                       
                                          
                                             R
                                          
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                     we have 
                                       ν
                                       ⊑
                                       
                                          
                                             θ
                                          
                                          
                                             p
                                          
                                       
                                       ∧
                                       s
                                       ∈
                                       
                                          
                                             tr
                                          
                                          
                                             m
                                          
                                       
                                       (
                                       p
                                       )
                                       ∧
                                       P
                                       
                                          ↠
                                          
                                             
                                                s
                                             
                                             
                                                ′
                                             
                                          
                                       
                                       Q
                                       ∧
                                       Q
                                       ⪯
                                       
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       ∧
                                       q
                                       ∈
                                       
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    , for some 
                                       s
                                       ∈
                                       
                                          
                                             tr
                                          
                                          
                                             m
                                          
                                       
                                       (
                                       p
                                       )
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             ′
                                          
                                       
                                       ⪯
                                       s
                                    .
                                       
                                          (a)
                                          Let 
                                                Q
                                                
                                                   
                                                      
                                                         →
                                                         a
                                                      
                                                   
                                                   
                                                      □
                                                   
                                                
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             . Then, 
                                                Q
                                                ⪯
                                                q
                                              (because 
                                                Q
                                                ⪯
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      s
                                                   
                                                
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                                ∧
                                                q
                                                ∈
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      s
                                                   
                                                
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                             ) and from the transfer property of modal refinement we find 
                                                q
                                                
                                                   →
                                                   a
                                                
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ∧
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ⪯
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             , for some 
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             . Thus, there is a maximal trace 
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      tr
                                                   
                                                   
                                                      m
                                                   
                                                
                                                (
                                                p
                                                )
                                              such that 
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                a
                                                ⪯
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             , 
                                                q
                                                ∈
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                             , and 
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                a
                                                )
                                             . Hence, due to the construction of 
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            p
                                                         
                                                      
                                                   
                                                
                                             , we get 
                                                (
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            p
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             .

Let 
                                                Q
                                                
                                                   
                                                      
                                                         →
                                                         a
                                                      
                                                   
                                                   
                                                      ◊
                                                      ∖
                                                      □
                                                   
                                                
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             . Then, 
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                
                                                   
                                                      =
                                                   
                                                   
                                                      s
                                                   
                                                
                                                ν
                                                ↑
                                                {
                                                {
                                                }
                                                (
                                                Q
                                                ,
                                                a
                                                ,
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                                ↦
                                                L
                                                }
                                             . But 
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ⊑
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      p
                                                   
                                                
                                             , so 
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      p
                                                   
                                                
                                                (
                                                s
                                                )
                                                (
                                                Q
                                                
                                                   
                                                      
                                                         →
                                                         a
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                                =
                                                L
                                             . Due to the definition of 
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      p
                                                   
                                                
                                             , we find 
                                                q
                                                
                                                   →
                                                   a
                                                
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ,
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      s
                                                   
                                                
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                a
                                                )
                                                ,
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ⪯
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      s
                                                   
                                                
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                a
                                                )
                                             , for some 
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             . Thus, by the construction of 
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            p
                                                         
                                                      
                                                   
                                                
                                             , we have 
                                                (
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            p
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             .

Let 
                                       q
                                       
                                          →
                                          a
                                       
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                     and 
                                       (
                                       Q
                                       ,
                                       ν
                                       )
                                       
                                          
                                             R
                                          
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       q
                                    . Then, from the construction of 
                                       
                                          
                                             R
                                          
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                     we have 
                                       ν
                                       ⊑
                                       
                                          
                                             θ
                                          
                                          
                                             p
                                          
                                       
                                       ∧
                                       s
                                       ∈
                                       
                                          
                                             tr
                                          
                                          
                                             m
                                          
                                       
                                       (
                                       p
                                       )
                                       ∧
                                       P
                                       
                                          ↠
                                          
                                             
                                                s
                                             
                                             
                                                ′
                                             
                                          
                                       
                                       Q
                                       ∧
                                       Q
                                       ⪯
                                       
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       ∧
                                       q
                                       ∈
                                       
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    , for some 
                                       s
                                       ∈
                                       
                                          
                                             tr
                                          
                                          
                                             m
                                          
                                       
                                       (
                                       p
                                       )
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             ′
                                          
                                       
                                       ⪯
                                       s
                                    . By using the fact 
                                       Q
                                       ⪯
                                       q
                                     and the transfer property of a modal refinement relation, we find 
                                       Q
                                       
                                          
                                             
                                                →
                                                a
                                             
                                          
                                          
                                             ◊
                                          
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       ∧
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       ⪯
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                    , for some 
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                    . Furthermore, since q is reachable from p and 
                                       q
                                       
                                          →
                                          a
                                       
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                    , so there is a maximal trace 
                                       
                                          
                                             s
                                          
                                          
                                             ¯
                                          
                                       
                                       ∈
                                       
                                          
                                             tr
                                          
                                          
                                             m
                                          
                                       
                                       (
                                       p
                                       )
                                     such that 
                                       
                                          
                                             e
                                          
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       (
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       =
                                       q
                                     and 
                                       
                                          
                                             e
                                          
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       (
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             ′
                                          
                                       
                                       a
                                       )
                                       =
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                     (for some 
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             ′
                                          
                                       
                                       ⪯
                                       
                                          
                                             s
                                          
                                          
                                             ¯
                                          
                                       
                                    ). So let 
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          
                                             =
                                          
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       ν
                                       ↑
                                       (
                                       Q
                                       ,
                                       a
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       ↦
                                       L
                                     and thus 
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       ⊑
                                       
                                          
                                             θ
                                          
                                          
                                             p
                                          
                                       
                                    . Moreover, we find 
                                       (
                                       Q
                                       ,
                                       ν
                                       )
                                       
                                          →
                                          
                                             a
                                             ,
                                             
                                                
                                                   ν
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    . Thus, by the construction of 
                                       
                                          
                                             R
                                          
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                    , we have 
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       
                                          
                                             R
                                          
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                    .


                           The class of MTSs is less expressive than the class of PL-LTSs.
                        

Due to Theorem 1, we know that PL-LTS is at least as expressive as MTS. It hence remains to prove that MTS is not at least as expressive as PL-LTS, which we show by means of the example depicted in Fig. 4
                           .

We prove by contradiction that the PL-LTS depicted in Fig. 4 (left), where 
                              P
                              =
                              a
                              .
                              
                                 Nil
                              
                              ⊕
                              b
                              .
                              
                                 Nil
                              
                            cannot be encoded using any sound encoding (satisfying Definition 11) to an MTS. To show this, observe the transition systems of the derived LTSs p and q drawn in Fig. 4 under 
                              θ
                              =
                              L
                            and 
                              
                                 
                                    θ
                                 
                                 
                                    ′
                                 
                              
                              =
                              R
                           .

Suppose there is an encoding E satisfying Definition 11. Clearly, 
                              (
                              P
                              ,
                              ?
                              )
                              
                                 
                                    ⊢
                                 
                                 
                                    θ
                                 
                              
                              p
                            and 
                              (
                              P
                              ,
                              ?
                              )
                              
                                 
                                    ⊢
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              q
                           . Then by correctness of E we have 
                              E
                              (
                              P
                              ,
                              ?
                              )
                              ⪯
                              p
                            and 
                              E
                              (
                              P
                              ,
                              ?
                              )
                              ⪯
                              q
                           . Thus, we can derive the following transitions (for some modal states 
                              
                                 
                                    P
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    b
                                 
                              
                           ) from the transfer property of modal refinement:
                              
                                 
                                    E
                                    (
                                    P
                                    ,
                                    ?
                                    )
                                    
                                       
                                          
                                             →
                                             a
                                          
                                       
                                       
                                          ◊
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          a
                                       
                                    
                                    
                                    E
                                    (
                                    P
                                    ,
                                    ?
                                    )
                                    
                                       
                                          
                                             →
                                             b
                                          
                                       
                                       
                                          ◊
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          b
                                       
                                    
                                    .
                                 
                              
                            Therefore, there exists a state r of the following form: 
                              r
                              
                                 →
                                 a
                              
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                            and 
                              r
                              
                                 →
                                 b
                              
                              
                                 
                                    r
                                 
                                 
                                    ″
                                 
                              
                            (for some 
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    ″
                                 
                              
                           ) such that 
                              E
                              (
                              P
                              )
                              ⪯
                              r
                           . And by correctness of E we get 
                              (
                              P
                              ,
                              ?
                              )
                              
                                 
                                    ⊢
                                 
                                 
                                    θ
                                 
                              
                              r
                            or 
                              (
                              P
                              ,
                              ?
                              )
                              
                                 
                                    ⊢
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              r
                           . However, 
                              (
                              P
                              ,
                              ?
                              )
                              
                                 
                                    ⊬
                                 
                                 
                                    θ
                                 
                              
                              r
                            and 
                              (
                              P
                              ,
                              ?
                              )
                              
                                 
                                    ⊬
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              r
                           .  □

Now that we have related the expressiveness of PL-LTSs and MTSs, we move to the other end of the spectrum, namely to the comparison of PL-LTSs and FTSs, which is achieved by means of the following two theorems. 
                        Theorem 3
                        
                           The class of FTSs is at-least as expressive as the class of PL-LTSs.
                        

Let 
                              (
                              P
                              ×
                              
                                 
                                    {
                                    L
                                    ,
                                    R
                                    ,
                                    ?
                                    }
                                 
                                 
                                    I
                                 
                              
                              ,
                              A
                              ,
                              →
                              )
                            be a PL-LTS. The corresponding FTS is denoted by 
                              (
                              P
                              ×
                              
                                 
                                    {
                                    L
                                    ,
                                    R
                                    ,
                                    ?
                                    }
                                 
                                 
                                    I
                                 
                              
                              ,
                              A
                              ,
                              F
                              ,
                              
                                 
                                    →
                                 
                                 
                                    ′
                                 
                              
                              ,
                              Λ
                              )
                           , where:
                              
                                 •
                                 
                                    
                                       F
                                       =
                                       
                                          
                                             ⋃
                                          
                                          
                                             i
                                             ∈
                                             I
                                          
                                       
                                       {
                                       
                                          
                                             L
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             R
                                          
                                          
                                             i
                                          
                                       
                                       }
                                    .


                                    
                                       Λ
                                       =
                                       
                                          
                                             ⋀
                                          
                                          
                                             i
                                             ∈
                                             I
                                          
                                       
                                       ¬
                                       (
                                       
                                          
                                             L
                                          
                                          
                                             i
                                          
                                       
                                       ∧
                                       
                                          
                                             R
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    .

The transition relation 
                                       
                                          
                                             →
                                          
                                          
                                             ′
                                          
                                       
                                     is defined in the following way:
                                       
                                          
                                             
                                                
                                                   (
                                                   P
                                                   ,
                                                   ν
                                                   )
                                                   
                                                      →
                                                      
                                                         a
                                                         ,
                                                         ν
                                                      
                                                   
                                                   (
                                                   Q
                                                   ,
                                                   ν
                                                   )
                                                
                                                
                                                   (
                                                   P
                                                   ,
                                                   ν
                                                   )
                                                   
                                                      
                                                         
                                                            →
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      
                                                         a
                                                         ,
                                                         ⊤
                                                      
                                                   
                                                   (
                                                   Q
                                                   ,
                                                   ν
                                                   )
                                                
                                             
                                             
                                             
                                                
                                                   (
                                                   P
                                                   ,
                                                   ν
                                                   )
                                                   
                                                      →
                                                      
                                                         a
                                                         ,
                                                         
                                                            
                                                               ν
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                   (
                                                   Q
                                                   ,
                                                   
                                                      
                                                         ν
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                   
                                                   ϕ
                                                   =
                                                   
                                                      
                                                         ν
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         i
                                                         )
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   
                                                   Ξ
                                                   (
                                                   i
                                                   ,
                                                   ν
                                                   ,
                                                   
                                                      
                                                         ν
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                                
                                                   (
                                                   P
                                                   ,
                                                   ν
                                                   )
                                                   
                                                      
                                                         
                                                            →
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      
                                                         a
                                                         ,
                                                         ϕ
                                                      
                                                   
                                                   (
                                                   Q
                                                   ,
                                                   
                                                      
                                                         ν
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                
                                             
                                             ,
                                          
                                       
                                     where 
                                       Ξ
                                       (
                                       i
                                       ,
                                       ν
                                       ,
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       ⇔
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       (
                                       i
                                       )
                                       ≠
                                       ν
                                       (
                                       i
                                       )
                                       ∧
                                       
                                          
                                             ∀
                                          
                                          
                                             j
                                             ≠
                                             i
                                          
                                       
                                       
                                       
                                          
                                             ν
                                          
                                          
                                             ′
                                          
                                       
                                       (
                                       j
                                       )
                                       =
                                       ν
                                       (
                                       j
                                       )
                                    .

(
                              〚
                              (
                              P
                              ,
                              ν
                              )
                              〛
                              ⊆
                              
                                 
                                    〚
                                    (
                                    P
                                    ,
                                    ν
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                           ): Let 
                              p
                              ∈
                              〚
                              (
                              P
                              ,
                              ν
                              )
                              〛
                           . Then 
                              (
                              P
                              ,
                              ν
                              )
                              
                                 
                                    ⊢
                                 
                                 
                                    θ
                                 
                              
                              p
                           , for some 
                              θ
                              ∈
                              
                                 
                                    {
                                    L
                                    ,
                                    R
                                    }
                                 
                                 
                                    I
                                 
                              
                           . Define a configuration 
                              
                                 
                                    λ
                                 
                                 
                                    θ
                                 
                              
                              ∈
                              Λ
                            as follows: 
                              
                                 
                                    λ
                                 
                                 
                                    θ
                                 
                              
                              (
                              
                                 
                                    L
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              ⊤
                              ⇔
                              θ
                              (
                              i
                              )
                              =
                              L
                            and 
                              
                                 
                                    λ
                                 
                                 
                                    θ
                                 
                              
                              (
                              
                                 
                                    R
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              ⊤
                              ⇔
                              θ
                              (
                              i
                              )
                              =
                              R
                           . Furthermore, consider the following relation 
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          λ
                                       
                                       
                                          θ
                                       
                                    
                                 
                              
                            such that 
                              (
                              Q
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    ′
                                 
                              
                              )
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          λ
                                       
                                       
                                          θ
                                       
                                    
                                 
                              
                              q
                              ⇔
                              (
                              Q
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    ′
                                 
                              
                              )
                              
                                 
                                    ⊢
                                 
                                 
                                    θ
                                 
                              
                              q
                           . It is straightforward to show that 
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          λ
                                       
                                       
                                          θ
                                       
                                    
                                 
                              
                            is a product derivation relation.

(
                              
                                 
                                    〚
                                    (
                                    P
                                    ,
                                    ν
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                              ⊆
                              〚
                              (
                              P
                              ,
                              ν
                              )
                              〛
                           ): Let 
                              p
                              ∈
                              
                                 
                                    〚
                                    (
                                    P
                                    ,
                                    ν
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                           . Then 
                              P
                              
                                 
                                    ⊢
                                 
                                 
                                    λ
                                 
                              
                              p
                            for some 
                              λ
                              ∈
                              Λ
                           . Let 
                              θ
                              ∈
                              
                                 
                                    {
                                    L
                                    ,
                                    R
                                    }
                                 
                                 
                                    I
                                 
                              
                            be a configuration vector defined as 
                              
                                 
                                    θ
                                 
                                 
                                    λ
                                 
                              
                              (
                              i
                              )
                              =
                              L
                              ⇔
                              λ
                              (
                              
                                 
                                    L
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              ⊤
                            and 
                              
                                 
                                    θ
                                 
                                 
                                    λ
                                 
                              
                              (
                              i
                              )
                              =
                              R
                              ⇔
                              λ
                              (
                              
                                 
                                    R
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              ⊤
                           . Define a relation 
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          λ
                                       
                                    
                                 
                              
                            such that 
                              (
                              Q
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    ′
                                 
                              
                              )
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          λ
                                       
                                    
                                 
                              
                              q
                              ⇔
                              (
                              Q
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    ′
                                 
                              
                              )
                              
                                 
                                    ⊢
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          λ
                                       
                                    
                                 
                              
                              q
                           . It is straightforward to verify that 
                              
                                 
                                    R
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          λ
                                       
                                    
                                 
                              
                            is a product derivation relation for PL-LTS. □


                           The class of PL-LTSs is less expressive than the class of FTSs.
                        

Due to Theorem 3, we know that FTSs are at least as expressive as PL-LTSs. It remains to show that PL-LTSs are not at-least as expressive as FTSs.

Consider the FTS as shown in Fig. 5
                           , where 
                              
                                 
                                    f
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    b
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    c
                                 
                              
                            are three distinct features and the set of valid products Λ is defined as the smallest set of functions satisfying the following constraint:
                              
                                 
                                    
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             a
                                          
                                       
                                       ⟹
                                       (
                                       ¬
                                       
                                          
                                             f
                                          
                                          
                                             b
                                          
                                       
                                       ∧
                                       ¬
                                       
                                          
                                             f
                                          
                                          
                                             c
                                          
                                       
                                       )
                                       )
                                    
                                    
                                    ∧
                                    
                                    
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             b
                                          
                                       
                                       ⟹
                                       (
                                       ¬
                                       
                                          
                                             f
                                          
                                          
                                             a
                                          
                                       
                                       ∧
                                       ¬
                                       
                                          
                                             f
                                          
                                          
                                             c
                                          
                                       
                                       )
                                       )
                                    
                                    
                                    ∧
                                    
                                    
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             c
                                          
                                       
                                       ⟹
                                       (
                                       ¬
                                       
                                          
                                             f
                                          
                                          
                                             a
                                          
                                       
                                       ∧
                                       ¬
                                       
                                          
                                             f
                                          
                                          
                                             b
                                          
                                       
                                       )
                                       )
                                    
                                    .
                                 
                              
                           
                        

Through a proof by contradiction, we show that there is no encoding E that can transform the FTS P in the correct way. Suppose otherwise there is an encoding E of P into an PL-LTS whose configuration vectors are of type 
                              
                                 
                                    {
                                    L
                                    ,
                                    R
                                    ,
                                    ?
                                    }
                                 
                                 
                                    I
                                 
                              
                            (for some index set I) such that 
                              〚
                              P
                              〛
                              =
                              
                                 
                                    〚
                                    E
                                    (
                                    P
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                           , where 
                              〚
                              P
                              〛
                              =
                              {
                              p
                              |
                              
                                 
                                    ∃
                                 
                                 
                                    λ
                                    ∈
                                    Λ
                                 
                              
                              
                              P
                              
                                 
                                    ⊢
                                 
                                 
                                    λ
                                 
                              
                              p
                              }
                           , 
                              E
                              (
                              P
                              )
                              =
                              (
                              Q
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              )
                            (for some state Q and configuration vector 
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              ∈
                              
                                 
                                    {
                                    L
                                    ,
                                    R
                                    ,
                                    ?
                                    }
                                 
                                 
                                    I
                                 
                              
                            in an PL-LTS), and 
                              
                                 
                                    〚
                                    E
                                    (
                                    P
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                              =
                              {
                              p
                              |
                              
                                 
                                    ∃
                                 
                                 
                                    θ
                                    ∈
                                    
                                       
                                          {
                                          L
                                          ,
                                          R
                                          }
                                       
                                       
                                          I
                                       
                                    
                                 
                              
                              (
                              Q
                              ,
                              ν
                              )
                              
                                 
                                    ⊢
                                 
                                 
                                    θ
                                 
                              
                              p
                              }
                           .

Clearly, the transition systems 
                              (
                              {
                              
                                 
                                    p
                                 
                                 
                                    x
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              }
                              ,
                              {
                              x
                              }
                              ,
                              {
                              (
                              
                                 
                                    p
                                 
                                 
                                    x
                                 
                              
                              ,
                              x
                              ,
                              
                                 
                                    p
                                 
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              )
                              }
                            (for 
                              x
                              ∈
                              {
                              a
                              ,
                              b
                              ,
                              c
                              }
                           ) are three valid products of the given FTS P, i.e., 
                              {
                              
                                 
                                    p
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    b
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    c
                                 
                              
                              }
                              ⊆
                              〚
                              P
                              〛
                           . So from the correctness requirement of E we have 
                              {
                              
                                 
                                    p
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    b
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    c
                                 
                              
                              }
                              ⊆
                              
                                 
                                    〚
                                    E
                                    (
                                    P
                                    )
                                    〛
                                 
                                 
                                    ′
                                 
                              
                           . Let 
                              
                                 
                                    θ
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    b
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                              
                            be the corresponding total configuration vectors that derives the products 
                              
                                 
                                    p
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    b
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    c
                                 
                              
                           , respectively. Thus, for every 
                              x
                              ∈
                              {
                              a
                              ,
                              b
                              ,
                              c
                              }
                            we have 
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    x
                                 
                              
                           . Furthermore, from the transfer property of product derivation we find 
                              (
                              Q
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              )
                              
                                 →
                                 
                                    x
                                    ,
                                    
                                       
                                          ν
                                       
                                       
                                          x
                                       
                                    
                                 
                              
                              (
                              
                                 
                                    Q
                                 
                                 
                                    x
                                 
                              
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    x
                                 
                              
                              )
                            such that 
                              
                                 
                                    ν
                                 
                                 
                                    x
                                 
                              
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    x
                                 
                              
                           , for 
                              x
                              ∈
                              {
                              a
                              ,
                              b
                              ,
                              c
                              }
                           . Clearly, 
                              
                                 
                                    ν
                                 
                                 
                                    x
                                 
                              
                              ≠
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                            (for any 
                              x
                              ∈
                              {
                              a
                              ,
                              b
                              ,
                              c
                              }
                           ) because otherwise we can derive a transition system which contains choices of 
                              a
                              ,
                              b
                            or 
                              b
                              ,
                              c
                            or 
                              a
                              ,
                              c
                           . For instance, if 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              =
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                            then the transfer property of product derivation ensures that 
                              
                                 
                                    ∃
                                 
                                 
                                    q
                                 
                              
                              
                              
                                 
                                    p
                                 
                                 
                                    b
                                 
                              
                              
                                 →
                                 a
                              
                              q
                            because 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              =
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    b
                                 
                              
                           . Therefore, let 
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                              ,
                              
                                 
                                    i
                                 
                                 
                                    c
                                 
                              
                              ∈
                              I
                            be the unique elements such that for every 
                              x
                              ∈
                              {
                              a
                              ,
                              b
                              ,
                              c
                              }
                            we have 
                              
                                 
                                    ν
                                 
                                 
                                    x
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    x
                                 
                              
                              )
                              ≠
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    x
                                 
                              
                              )
                              ∧
                              
                                 
                                    ∀
                                 
                                 
                                    i
                                    ≠
                                    
                                       
                                          i
                                       
                                       
                                          x
                                       
                                    
                                 
                              
                              
                              
                                 
                                    ν
                                 
                                 
                                    x
                                 
                              
                              (
                              i
                              )
                              =
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              (
                              i
                              )
                            (recall Condition (7)(2)).

Next, we show that if 
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              ≠
                              
                                 
                                    i
                                 
                                 
                                    c
                                 
                              
                              ∧
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                              ≠
                              
                                 
                                    i
                                 
                                 
                                    c
                                 
                              
                              ∧
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              ≠
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                            then we can derive a product which has a choice between 
                              a
                              ,
                              c
                           . Since 
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                            are the only elements whose values are changed by 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    b
                                 
                              
                           , so from Condition (7)(3) we have 
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              =
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                              )
                              =
                              ?
                           . Define a function 
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                            as follows:
                              
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          c
                                       
                                       
                                          ′
                                       
                                    
                                    (
                                    i
                                    )
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      c
                                                   
                                                
                                                (
                                                i
                                                )
                                             
                                             
                                                if
                                                
                                                i
                                                ≠
                                                
                                                   
                                                      i
                                                   
                                                   
                                                      a
                                                   
                                                
                                                ∧
                                                i
                                                ≠
                                                
                                                   
                                                      i
                                                   
                                                   
                                                      b
                                                   
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      a
                                                   
                                                
                                                (
                                                i
                                                )
                                             
                                             
                                                if
                                                
                                                i
                                                =
                                                
                                                   
                                                      i
                                                   
                                                   
                                                      a
                                                   
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                if
                                                
                                                i
                                                =
                                                
                                                   
                                                      i
                                                   
                                                   
                                                      b
                                                   
                                                
                                                ∧
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      b
                                                   
                                                
                                                (
                                                
                                                   
                                                      i
                                                   
                                                   
                                                      b
                                                   
                                                
                                                )
                                                =
                                                L
                                                ,
                                             
                                          
                                          
                                             
                                                L
                                             
                                             
                                                if
                                                
                                                i
                                                =
                                                
                                                   
                                                      i
                                                   
                                                   
                                                      b
                                                   
                                                
                                                ∧
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      b
                                                   
                                                
                                                (
                                                
                                                   
                                                      i
                                                   
                                                   
                                                      b
                                                   
                                                
                                                )
                                                =
                                                R
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                            Next, we show that 
                              
                                 
                                    ν
                                 
                                 
                                    c
                                 
                              
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                           . If 
                              i
                              ≠
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              ∧
                              i
                              ≠
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                            then clearly 
                              
                                 
                                    ν
                                 
                                 
                                    c
                                 
                              
                              (
                              i
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              (
                              i
                              )
                            because 
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              (
                              i
                              )
                              =
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                              
                              (
                              i
                              )
                           . If 
                              i
                              =
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                            or 
                              i
                              =
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                            then 
                              
                                 
                                    ν
                                 
                                 
                                    c
                                 
                              
                              (
                              i
                              )
                              =
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              (
                              i
                              )
                              =
                              ?
                           . Thus, 
                              
                                 
                                    ν
                                 
                                 
                                    c
                                 
                              
                              (
                              i
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              (
                              i
                              )
                           . Thus, 
                              
                                 
                                    ν
                                 
                                 
                                    c
                                 
                              
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                           .

Next, we show that 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                           . If 
                              i
                              ≠
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              ∧
                              i
                              ≠
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                            then 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              i
                              )
                              =
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              (
                              i
                              )
                           . Thus, 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              i
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              (
                              i
                              )
                            because 
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              (
                              i
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                              
                              (
                              i
                              )
                              ∧
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                              
                              (
                              i
                              )
                              =
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              (
                              i
                              )
                           . If 
                              i
                              ≠
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              ∧
                              i
                              =
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                            then 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              i
                              )
                              =
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              (
                              i
                              )
                              =
                              ?
                           . Thus, 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              i
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              (
                              i
                              )
                           . Lastly, if 
                              i
                              =
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                            then 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              i
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              (
                              i
                              )
                            because 
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              (
                              i
                              )
                              =
                              
                                 
                                    θ
                                 
                                 
                                    a
                                 
                              
                              (
                              i
                              )
                           . Thus, 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                           . As a result, we can derive a product that contains a choice between 
                              a
                              ,
                              c
                            by using 
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                           ; however, such a product is clearly not a valid product of the given FTS P as it violates the condition Λ.

On the other hand, if 
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              =
                              
                                 
                                    i
                                 
                                 
                                    c
                                 
                              
                            then we show that using 
                              
                                 
                                    θ
                                 
                                 
                                    b
                                 
                              
                            we can derive a product which has a choice between either 
                              a
                              ,
                              b
                            or 
                              b
                              ,
                              c
                           . It suffices to show that 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    b
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                            or 
                              
                                 
                                    ν
                                 
                                 
                                    c
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    b
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                            because for every 
                              i
                              ≠
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                            we have 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              i
                              )
                              =
                              
                                 
                                    ν
                                 
                                 
                                    c
                                 
                              
                              (
                              i
                              )
                              =
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              (
                              i
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    b
                                 
                              
                              (
                              i
                              )
                           . We claim that 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              ≠
                              ?
                           . Suppose otherwise 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              =
                              ?
                           . Then, since 
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              =
                              
                                 
                                    i
                                 
                                 
                                    c
                                 
                              
                            we find 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                              
                           . As a result, from the transfer property of 
                              
                                 
                                    ⊢
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          c
                                       
                                    
                                 
                              
                            there must be a q such that 
                              
                                 
                                    p
                                 
                                 
                                    c
                                 
                              
                              
                                 →
                                 a
                              
                              q
                            otherwise 
                              E
                              (
                              P
                              )
                              
                                 
                                    ⊬
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          c
                                       
                                    
                                 
                              
                              
                                 
                                    p
                                 
                                 
                                    c
                                 
                              
                           . Thus, 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              ≠
                              ?
                           . Likewise, we can prove that 
                              
                                 
                                    ν
                                 
                                 
                                    c
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              ≠
                              ?
                           . Thus, 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    c
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              ∈
                              {
                              L
                              ,
                              R
                              }
                           . And since 
                              
                                 
                                    θ
                                 
                                 
                                    b
                                 
                              
                            is a function whose co-domain is the set 
                              {
                              L
                              ,
                              R
                              }
                            we have either 
                              
                                 
                                    ν
                                 
                                 
                                    a
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    b
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                            or 
                              
                                 
                                    ν
                                 
                                 
                                    c
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                              ⊑
                              
                                 
                                    θ
                                 
                                 
                                    b
                                 
                              
                              (
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              )
                           . Hence, we can derive a product that contains a choice between either 
                              a
                              ,
                              b
                            or 
                              b
                              ,
                              c
                            by using 
                              
                                 
                                    θ
                                 
                                 
                                    b
                                 
                              
                           ; however, such a product is clearly not a valid product of the given FTS P as it violates the condition Λ. Likewise, if 
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                              =
                              
                                 
                                    i
                                 
                                 
                                    c
                                 
                              
                            (or 
                              
                                 
                                    i
                                 
                                 
                                    a
                                 
                              
                              =
                              
                                 
                                    i
                                 
                                 
                                    b
                                 
                              
                           ) then we can show that using 
                              
                                 
                                    θ
                                 
                                 
                                    a
                                 
                              
                            (
                              
                                 
                                    θ
                                 
                                 
                                    c
                                 
                              
                           ) we can derive a product which has a choice between either 
                              a
                              ,
                              b
                            (
                              a
                              ,
                              c
                           ) or 
                              a
                              ,
                              c
                            (
                              b
                              ,
                              c
                           ). □

We can hence summarize the results of this section by the following diagram:
                        
                           
                              MTSs
                              
                              ⟶
                              
                              PL-LTSs
                              
                              ⟶
                              
                              FTSs
                              ,
                           
                        
                      where the arrow ⟶ indicates the “less-expressive-than” relation, i.e., the existence of an encoding from one product line structure into another and the lack of encoding in the other directions. In other words, the class of MTSs (FTSs) is the least (most) expressive product line structure considered in this paper. The fact that MTSs are less expressive than FTSs follows from the transitivity of the “less-expressive-than” relation; to emphasize this fact, we give the evidence of the lack of encoding from FTSs to MTSs in the following example. 
                        Example 8
                        Consider the FTS drawn (left) in Fig. 6
                            with the set of features 
                              F
                              =
                              {
                              f
                              ,
                              
                                 
                                    f
                                 
                                 
                                    ′
                                 
                              
                              }
                            and the set of valid product configuration 
                              Λ
                              =
                              {
                              λ
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    ′
                                 
                              
                              }
                            with 
                              λ
                              (
                              f
                              )
                              =
                              ⊤
                              ,
                              λ
                              (
                              
                                 
                                    f
                                 
                                 
                                    ′
                                 
                              
                              )
                              =
                              ⊥
                            and 
                              
                                 
                                    λ
                                 
                                 
                                    ′
                                 
                              
                              (
                              f
                              )
                              =
                              ⊥
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    ′
                                 
                              
                              (
                              
                                 
                                    f
                                 
                                 
                                    ′
                                 
                              
                              )
                              =
                              ⊤
                           . The transition systems of the derived processes P and Q under λ and 
                              
                                 
                                    λ
                                 
                                 
                                    ′
                                 
                              
                           , respectively, are drawn in Fig. 6. Now by contradiction we show that there is no encoding E satisfying Definition 11.

Suppose there is an encoding E satisfying Definition 11. Clearly, 
                              P
                              
                                 
                                    ⊢
                                 
                                 
                                    λ
                                 
                              
                              p
                            and 
                              P
                              
                                 
                                    ⊢
                                 
                                 
                                    
                                       
                                          λ
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              q
                           . Then by correctness of E we have 
                              E
                              (
                              P
                              )
                              ⪯
                              p
                            and 
                              E
                              (
                              P
                              )
                              ⪯
                              q
                           . Thus, we can derive the following transitions (for some modal states 
                              
                                 
                                    P
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    b
                                 
                              
                           ) from the transfer property of modal refinement:
                              
                                 
                                    E
                                    (
                                    P
                                    )
                                    
                                       
                                          
                                             →
                                             a
                                          
                                       
                                       
                                          ◊
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          a
                                       
                                    
                                    
                                    E
                                    (
                                    P
                                    )
                                    
                                       
                                          
                                             →
                                             b
                                          
                                       
                                       
                                          ◊
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          b
                                       
                                    
                                    .
                                 
                              
                            Therefore, there exists a state r of the following form: 
                              r
                              
                                 →
                                 a
                              
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                            and 
                              r
                              
                                 →
                                 b
                              
                              
                                 
                                    r
                                 
                                 
                                    ″
                                 
                              
                            (for some 
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    ″
                                 
                              
                           ) such that 
                              E
                              (
                              P
                              )
                              ⪯
                              r
                           . And by correctness of E we get 
                              P
                              
                                 
                                    ⊢
                                 
                                 
                                    λ
                                 
                              
                              r
                            or 
                              P
                              
                                 
                                    ⊢
                                 
                                 
                                    
                                       
                                          λ
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              r
                           . However, 
                              P
                              
                                 
                                    ⊬
                                 
                                 
                                    λ
                                 
                              
                              r
                            and 
                              P
                              
                                 
                                    ⊬
                                 
                                 
                                    
                                       
                                          λ
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              r
                           .

In Section 2, we reviewed three different notions of product derivations based on a particular product line structure. These notions are intensional in nature, i.e., they require the products to be modeled completely as LTSs, and moreover, their models must be available in their entirety during testing. This assumption is rather unrealistic for practical systems. In practice, one needs an extensional notion of testing that can be used to generate a test-suite from a product-line specification (e.g., an MTS) in an offline or on-the-fly manner, in order to test a black-box implementation. Based on the foundational studies carried out in [22,21,20], such notions have been developed and extensively studied for various LTS-based formalisms [22,34]; however, we are not aware of any such notion for MTSs, PL-LTSs, and FTSs (the only exceptions being our recent work [35,36], as well as the recent work by Devroey et al. [37,38]). In the remainder of this section, we adopt the testing framework of [23] and adapt its notion of test to MTSs, PL-LTSs, and FTSs to characterize the corresponding product derivation relation for the respective product-line structure.

The notions elaborated in this section lay the theoretical connection between the intensional (trace-based comparison) and the extensional (test-case execution) notions of conformance. In order to turn this theory into a practical testing scheme, some degrees of unboundedness have to be tamed: firstly, a fault-model (regarding the implementation) [39], a notion of coverage [37], or a test-selection algorithm [40] has to be adopted to choose a finite set of test cases. Moreover, some assumptions about valid products and the interaction of their features (combined with the aforementioned methods or a bound on the maximum length of test-cases) can be used to select a finite set of incremental test-suites for various products [35,36].

Consider a set of test expressions T, ranged over by t, generated by the following grammar [23]
                        
                           3
                        
                        
                           3
                           Throughout this section, we assume that the product line structure under investigation is image finite.
                        :
                           
                              
                                 t
                                 :
                                 :
                                 =
                                 
                                 
                                    SUCC
                                 
                                 |
                                 
                                    FAIL
                                 
                                 |
                                 a
                                 t
                                 |
                                 
                                    
                                       a
                                    
                                    
                                       ˜
                                    
                                 
                                 t
                                 |
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                                 ∧
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 |
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                                 ∨
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 |
                                 ∀
                                 t
                                 |
                                 ∃
                                 t
                                 .
                              
                           
                         Intuitively, 
                           SUCC
                         and 
                           FAIL
                         denote the successful and the failed tests, respectively, i.e., for every MTS the test 
                           SUCC
                         (
                           FAIL
                        ) will always pass (fail). The expression at tests the existence of a must-transition labeled a and then examines the sub-test t. Furthermore, if an MTS refuses to perform the must-transition a, the verdict for this test is fail. The expression 
                           
                              
                                 a
                              
                              
                                 ˜
                              
                           
                           t
                         tests the existence of a may-transition labeled a and then examines the sub-test t. Furthermore, if an MTS refuses to perform the may-transition a, then the verdict for this test is success (pass). The tests of the form 
                           
                              
                                 t
                              
                              
                                 1
                              
                           
                           ∧
                           
                              
                                 t
                              
                              
                                 2
                              
                           
                         and 
                           
                              
                                 t
                              
                              
                                 1
                              
                           
                           ∨
                           
                              
                                 t
                              
                              
                                 2
                              
                           
                         represent testing different copies of a machine using the sub-tests and subsequently, combining the results [20]. The tests of the form ∀t and ∃t represent global testing by, respectively, quantifying universally and existentially over runs of sub-test t.

Given a modal specification P and an implementation p (modeled as an LTS), the main idea is to assert indirectly whether the implementation p is a valid product of the specification P, i.e., whether they are related by a modal refinement relation. (Throughout this section, we use P to denote a state of a modal specification and p to denote the state of an LTS implementation.) For this purpose, we need a concept of interaction between a test case and a state in an MTS (and an LTS). To this end, we recall the notion of experiment expression E 
                        [23], generated by the following grammars:
                           
                              
                                 E
                                 :
                                 :
                                 =
                                 
                                 ⊤
                                 
                                 |
                                 
                                 ⊥
                                 
                                 |
                                 
                                 (
                                 t
                                 ∥
                                 P
                                 )
                                 
                                 |
                                 
                                 
                                    
                                       E
                                    
                                    
                                       1
                                    
                                 
                                 ∧
                                 
                                    
                                       E
                                    
                                    
                                       2
                                    
                                 
                                 
                                 |
                                 
                                 
                                    
                                       E
                                    
                                    
                                       1
                                    
                                 
                                 ∨
                                 
                                    
                                       E
                                    
                                    
                                       2
                                    
                                 
                                 
                                 |
                                 
                                 ∀
                                 E
                                 
                                 |
                                 
                                 ∃
                                 E
                                 .
                              
                           
                        
                        
                           
                              
                                 E
                                 :
                                 :
                                 =
                                 
                                 ⊤
                                 
                                 |
                                 
                                 ⊥
                                 
                                 |
                                 
                                 (
                                 t
                                 ∥
                                 p
                                 )
                                 
                                 |
                                 
                                 
                                    
                                       E
                                    
                                    
                                       1
                                    
                                 
                                 ∧
                                 
                                    
                                       E
                                    
                                    
                                       2
                                    
                                 
                                 
                                 |
                                 
                                 
                                    
                                       E
                                    
                                    
                                       1
                                    
                                 
                                 ∨
                                 
                                    
                                       E
                                    
                                    
                                       2
                                    
                                 
                                 
                                 |
                                 
                                 ∀
                                 E
                                 
                                 |
                                 
                                 ∃
                                 E
                                 .
                              
                           
                         
                        Fig. 7
                         provides the operational interpretation of experiment expressions over an MTS. Note that only the rules of the expressions 
                           a
                           t
                           ∥
                           P
                         and 
                           
                              
                                 a
                              
                              
                                 ˜
                              
                           
                           t
                           ∥
                           P
                         (i.e., rules 3–6) are modified with respect to the original rules presented in [23], while the rest of the operational rules are quoted verbatim for the sake of completeness. In particular, we define a transition relation → between any two experiment expressions as the smallest relation satisfying the rules of Fig. 7. Note that we do not need a separate set of rules to specify the experiment expressions interacting with an LTS, because they can also be derived from the rules of Fig. 7 by considering the transitions of LTS as both may and must transitions.

Once we have a transition system whose states are experiment expressions interacting with either a specification or an implementation, we can use this structure to define the set of results of evaluating a test on a process. The outcome of a single test is either successful or unsuccessful, which can be modeled as a two-point domain 
                           O
                           =
                           ⊥
                           ≤
                           ⊤
                        . However, due to nondeterminism, sets of outcomes are required to get the results of all possible runs (cf. [23]). These outcomes are modeled using a set of truth values (or more precisely, using the Plotkin powerdomain 
                           P
                           [
                           O
                           ]
                           =
                           {
                           ⊥
                           }
                           ⊑
                           {
                           ⊥
                           ,
                           ⊤
                           }
                           ⊑
                           {
                           ⊤
                           }
                        ). The semantics of the operators 
                           ∧
                           ,
                           ∨
                           ,
                           ∀
                           ,
                           ∃
                         over the Plotkin powerdomain 
                           P
                           [
                           O
                           ]
                         can be found in [23]. In addition, given an MTS 
                           (
                           P
                           ,
                           A
                           ,
                           
                              
                                 
                                    →
                                    
                                 
                              
                              
                                 ◊
                              
                           
                           ,
                           
                              
                                 
                                    →
                                    
                                 
                              
                              
                                 □
                              
                           
                           )
                        , we define the function 
                           O
                           :
                           T
                           ×
                           P
                           →
                           P
                           [
                           O
                           ]
                         in the following way:
                           
                              
                                 O
                                 (
                                 t
                                 ,
                                 P
                                 )
                                 =
                                 {
                                 ⊤
                                 |
                                 (
                                 t
                                 ∥
                                 P
                                 )
                                 ↠
                                 ⊤
                                 }
                                 ∪
                                 {
                                 ⊥
                                 |
                                 (
                                 t
                                 ∥
                                 P
                                 )
                                 ↠
                                 ⊥
                                 }
                                 ,
                              
                           
                         where ↠ is the reflexive and transitive closure of the transition relation → defined in Fig. 7. Similar to the operational semantics, we re-use the same notation to denote the result of executing a test expression of a test on an LTS, i.e., for an LTS 
                           (
                           P
                           ,
                           A
                           ,
                           →
                           )
                        , we write 
                           O
                           (
                           t
                           ,
                           p
                           )
                         to denote the results of executing test t on p.

The following property is immediate from the rules of Fig. 7 (in particular, rules 19 and 23) on experiment expressions. 
                           Lemma 3
                           
                              Let P be a modal specification. Then, for any test expression t we have
                              
                                 
                                    
                                       O
                                       (
                                       ∀
                                       t
                                       ,
                                       P
                                       )
                                       =
                                       ∀
                                       O
                                       (
                                       t
                                       ,
                                       P
                                       )
                                       
                                       
                                          and
                                       
                                       
                                       O
                                       (
                                       ∃
                                       t
                                       ,
                                       P
                                       )
                                       =
                                       ∃
                                       O
                                       (
                                       t
                                       ,
                                       P
                                       )
                                       .
                                    
                                 
                              
                           

Before we turn our attention to the characterization of modal refinement as a testing pre-order, we first give a semantic preserving transformation 
                           
                              
                                 〚
                                 〛
                              
                              
                                 A
                              
                           
                         (Lemma 4) that transforms an HML formulae (interpreted over MTSs due to [41]) into the set of tests T. We will use this transformation in the proof of Theorem 5 to establish a link between testing pre-order ⊑ and the modal refinement relation ⪯.

Consider the set of all HML formulae Φ generated by the following grammar:
                           
                              
                                 φ
                                 :
                                 :
                                 =
                                 
                                 ⊥
                                 |
                                 ⊤
                                 |
                                 〈
                                 a
                                 〉
                                 φ
                                 |
                                 [
                                 a
                                 ]
                                 φ
                                 |
                                 φ
                                 ∧
                                 
                                    
                                       φ
                                    
                                    
                                       ′
                                    
                                 
                                 |
                                 φ
                                 ∨
                                 
                                    
                                       φ
                                    
                                    
                                       ′
                                    
                                 
                                 .
                              
                           
                         The semantics of 
                           ⊥
                           ,
                           ⊤
                           ,
                           ∧
                           ,
                           ∨
                         is standard, while the nonstandard semantics of 
                           〈
                           a
                           〉
                           φ
                           ,
                           [
                           a
                           ]
                           φ
                         is given as follows [41]:
                           
                              1.
                              
                                 
                                    P
                                    ⊨
                                    〈
                                    a
                                    〉
                                    φ
                                    
                                    ⇔
                                    
                                    
                                       
                                          ∃
                                       
                                       
                                          
                                             
                                                P
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    
                                    P
                                    
                                       
                                          
                                             →
                                             a
                                          
                                       
                                       
                                          □
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          ′
                                       
                                    
                                    ∧
                                    
                                       
                                          P
                                       
                                       
                                          ′
                                       
                                    
                                    ⊨
                                    φ
                                 .


                                 
                                    P
                                    ⊨
                                    [
                                    a
                                    ]
                                    φ
                                    
                                    ⇔
                                    
                                    
                                       
                                          ∀
                                       
                                       
                                          
                                             
                                                P
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    
                                    P
                                    
                                       
                                          
                                             →
                                             a
                                          
                                       
                                       
                                          ◊
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          ′
                                       
                                    
                                    ⇒
                                    
                                       
                                          P
                                       
                                       
                                          ′
                                       
                                    
                                    ⊨
                                    φ
                                 .

Following [23], we give a transformation 
                           
                              
                                 〚
                                 _
                                 〛
                              
                              
                                 A
                              
                           
                           :
                           Φ
                           →
                           T
                         of HML formulae to the set of test expressions.
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                〚
                                                ⊤
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          
                                       
                                       
                                          =
                                          
                                       
                                       
                                          
                                             SUCC
                                          
                                          ,
                                          
                                          
                                       
                                       
                                          
                                             
                                                〚
                                                ⊥
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          
                                       
                                       
                                          =
                                          
                                       
                                       
                                          
                                             FAIL
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             
                                                〚
                                                φ
                                                ∧
                                                
                                                   
                                                      φ
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          
                                       
                                       
                                          =
                                          
                                       
                                       
                                          
                                             
                                                〚
                                                φ
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          ∧
                                          
                                             
                                                〚
                                                
                                                   
                                                      φ
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          ,
                                          
                                          
                                       
                                       
                                          
                                             
                                                〚
                                                φ
                                                ∨
                                                
                                                   
                                                      φ
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          
                                       
                                       
                                          =
                                          
                                       
                                       
                                          
                                             
                                                〚
                                                φ
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          ∨
                                          
                                             
                                                〚
                                                
                                                   
                                                      φ
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             
                                                〚
                                                [
                                                a
                                                ]
                                                φ
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          
                                       
                                       
                                          =
                                          
                                       
                                       
                                          ∀
                                          
                                             
                                                a
                                             
                                             
                                                ˜
                                             
                                          
                                          
                                             
                                                〚
                                                φ
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          ,
                                          
                                          
                                       
                                       
                                          
                                             
                                                〚
                                                〈
                                                a
                                                〉
                                                φ
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          
                                       
                                       
                                          =
                                          
                                       
                                       
                                          ∃
                                          a
                                          
                                             
                                                〚
                                                φ
                                                〛
                                             
                                             
                                                A
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     

By setting the above technical machinery, we now prove that an MTS satisfies a HML formula φ if and only if it passes the test 
                           
                              
                                 〚
                                 φ
                                 〛
                              
                              
                                 A
                              
                           
                        . 
                           Lemma 4
                           
                              Let P and p be a state in an MTS and an LTS, respectively. Then, for any 
                              
                                 φ
                                 ∈
                                 Φ
                               
                              we have
                              
                                 
                                    
                                       P
                                       ⊨
                                       φ
                                       
                                       ⇔
                                       
                                       O
                                       (
                                       
                                          
                                             〚
                                             φ
                                             〛
                                          
                                          
                                             A
                                          
                                       
                                       ,
                                       P
                                       )
                                       =
                                       {
                                       ⊤
                                       }
                                       
                                       
                                          and
                                       
                                       
                                       p
                                       ⊨
                                       φ
                                       
                                       ⇔
                                       
                                       O
                                       (
                                       
                                          
                                             〚
                                             φ
                                             〛
                                          
                                          
                                             A
                                          
                                       
                                       ,
                                       p
                                       )
                                       =
                                       {
                                       ⊤
                                       }
                                       .
                                    
                                 
                              
                           

The proof is by induction on φ; the cases for 
                                 ⊥
                                 ,
                                 ⊤
                                 ,
                                 ∧
                                 ,
                                 ∨
                               are straightforward.
                                 
                                    1.
                                    Let 
                                          φ
                                          =
                                          [
                                          a
                                          ]
                                          
                                             
                                                φ
                                             
                                             
                                                ′
                                             
                                          
                                        and 
                                          P
                                          ⊨
                                          φ
                                       . Then,
                                          
                                             
                                                
                                                   
                                                      ∀
                                                   
                                                   
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                   
                                                
                                                
                                                P
                                                
                                                   
                                                      
                                                         →
                                                         a
                                                      
                                                   
                                                   
                                                      ◊
                                                   
                                                
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ⇒
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ⊨
                                                
                                                   
                                                      φ
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ⇔
                                                
                                                   
                                                      ∀
                                                   
                                                   
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                   
                                                
                                                
                                                P
                                                
                                                   
                                                      
                                                         →
                                                         a
                                                      
                                                   
                                                   
                                                      ◊
                                                   
                                                
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ⇒
                                                O
                                                (
                                                
                                                   
                                                      〚
                                                      
                                                         
                                                            φ
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      〛
                                                   
                                                   
                                                      A
                                                   
                                                
                                                ,
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                                =
                                                {
                                                ⊤
                                                }
                                                
                                                
                                                (Induction hypothesis)
                                             
                                          
                                       
                                       
                                          
                                             
                                                ⇔
                                                O
                                                (
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                                
                                                   
                                                      〚
                                                      
                                                         
                                                            φ
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      〛
                                                   
                                                   
                                                      A
                                                   
                                                
                                                ,
                                                P
                                                )
                                                =
                                                {
                                                ⊤
                                                }
                                                
                                                
                                                (
                                                Rule 5 and Definition of
                                                
                                                O
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                ⇔
                                                ∀
                                                O
                                                (
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                                
                                                   
                                                      〚
                                                      
                                                         
                                                            φ
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      〛
                                                   
                                                   
                                                      A
                                                   
                                                
                                                ,
                                                P
                                                )
                                                =
                                                {
                                                ⊤
                                                }
                                                
                                                
                                                (
                                                Truth-table [23]:
                                                
                                                ∀
                                                {
                                                ⊤
                                                }
                                                =
                                                {
                                                ⊤
                                                }
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                ⇔
                                                O
                                                (
                                                ∀
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                                
                                                   
                                                      〚
                                                      
                                                         
                                                            φ
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      〛
                                                   
                                                   
                                                      A
                                                   
                                                
                                                ,
                                                P
                                                )
                                                =
                                                {
                                                ⊤
                                                }
                                                
                                                
                                                (
                                                
                                                   Lemma 3:
                                                
                                                O
                                                (
                                                ∀
                                                t
                                                ,
                                                p
                                                )
                                                =
                                                ∀
                                                O
                                                (
                                                t
                                                ,
                                                P
                                                )
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                ⇔
                                                O
                                                (
                                                
                                                   
                                                      〚
                                                      [
                                                      a
                                                      ]
                                                      
                                                         
                                                            φ
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      〛
                                                   
                                                   
                                                      A
                                                   
                                                
                                                ,
                                                P
                                                )
                                                =
                                                {
                                                ⊤
                                                }
                                                .
                                             
                                          
                                       
                                    

Let 
                                          φ
                                          =
                                          〈
                                          a
                                          〉
                                          
                                             
                                                φ
                                             
                                             
                                                ′
                                             
                                          
                                        and 
                                          P
                                          ⊨
                                          φ
                                       . Then,
                                          
                                             
                                                
                                                   
                                                      ∃
                                                   
                                                   
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                   
                                                
                                                
                                                P
                                                
                                                   
                                                      
                                                         →
                                                         a
                                                      
                                                   
                                                   
                                                      □
                                                   
                                                
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ∧
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ⊨
                                                
                                                   
                                                      φ
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ⇔
                                                
                                                   
                                                      ∃
                                                   
                                                   
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                   
                                                
                                                
                                                P
                                                
                                                   
                                                      
                                                         →
                                                         a
                                                      
                                                   
                                                   
                                                      □
                                                   
                                                
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ∧
                                                O
                                                (
                                                
                                                   
                                                      〚
                                                      
                                                         
                                                            φ
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      〛
                                                   
                                                   
                                                      A
                                                   
                                                
                                                ,
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                                =
                                                {
                                                ⊤
                                                }
                                                
                                                
                                                (
                                                Induction hypothesis
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                ⇔
                                                ⊤
                                                ∈
                                                O
                                                (
                                                a
                                                
                                                   
                                                      〚
                                                      
                                                         
                                                            φ
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      〛
                                                   
                                                   
                                                      A
                                                   
                                                
                                                ,
                                                P
                                                )
                                                
                                                
                                                (
                                                Rule 5 and Definition of
                                                
                                                O
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                ⇔
                                                ∃
                                                O
                                                (
                                                a
                                                
                                                   
                                                      〚
                                                      
                                                         
                                                            φ
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      〛
                                                   
                                                   
                                                      A
                                                   
                                                
                                                ,
                                                P
                                                )
                                                =
                                                {
                                                ⊤
                                                }
                                                
                                                
                                                (
                                                Truth table [23]:
                                                
                                                ∃
                                                {
                                                ⊥
                                                ,
                                                ⊤
                                                }
                                                =
                                                {
                                                ⊤
                                                }
                                                
                                                and
                                                
                                                ∃
                                                {
                                                ⊤
                                                }
                                                =
                                                {
                                                ⊤
                                                }
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                ⇔
                                                O
                                                (
                                                ∃
                                                a
                                                
                                                   
                                                      〚
                                                      
                                                         
                                                            φ
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      〛
                                                   
                                                   
                                                      A
                                                   
                                                
                                                ,
                                                P
                                                )
                                                =
                                                {
                                                ⊤
                                                }
                                                
                                                
                                                (
                                                
                                                   Lemma 3:
                                                
                                                ∃
                                                O
                                                (
                                                t
                                                ,
                                                p
                                                )
                                                =
                                                O
                                                (
                                                ∃
                                                t
                                                ,
                                                p
                                                )
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                ⇔
                                                O
                                                (
                                                
                                                   
                                                      〚
                                                      〈
                                                      a
                                                      〉
                                                      
                                                         
                                                            φ
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      〛
                                                   
                                                   
                                                      A
                                                   
                                                
                                                ,
                                                P
                                                )
                                                =
                                                {
                                                ⊤
                                                }
                                                .
                                             
                                          
                                         □

The following theorem is the first attempt towards characterization; namely, it shows that if the observations obtained from test-cases on an implementation are all allowed by the product line, then the implementation is a valid product (a modal refinement) of the product line. 
                           Theorem 5
                           
                              Let P and p be states in an MTS and an LTS, respectively. Then,
                              
                                 
                                    
                                       
                                          
                                             ∀
                                          
                                          
                                             t
                                             ∈
                                             T
                                          
                                       
                                       
                                       O
                                       (
                                       t
                                       ,
                                       P
                                       )
                                       ⊑
                                       O
                                       (
                                       t
                                       ,
                                       p
                                       )
                                       
                                       ⇒
                                       
                                       P
                                       ⪯
                                       p
                                       .
                                    
                                 
                              
                           

Suppose 
                                 
                                    
                                       ∀
                                    
                                    
                                       t
                                       ∈
                                       T
                                    
                                 
                                 
                                 O
                                 (
                                 t
                                 ,
                                 P
                                 )
                                 ⊑
                                 O
                                 (
                                 t
                                 ,
                                 p
                                 )
                              . In lieu of the modal characterization given by Boudol and Larsen [41, Theorem 3.1], we show that 
                                 p
                                 ⊨
                                 φ
                               whenever 
                                 P
                                 ⊨
                                 φ
                              , for any 
                                 φ
                                 ∈
                                 Φ
                              . Suppose 
                                 P
                                 ⊨
                                 φ
                              . Then, from Lemma 4 we know that 
                                 O
                                 (
                                 
                                    
                                       〚
                                       φ
                                       〛
                                    
                                    
                                       A
                                    
                                 
                                 ,
                                 P
                                 )
                                 =
                                 {
                                 ⊤
                                 }
                              . Since the element 
                                 {
                                 ⊤
                                 }
                               is the maximum in the Plotkin powerdomain 
                                 P
                                 [
                                 O
                                 ]
                               and 
                                 O
                                 (
                                 
                                    
                                       〚
                                       φ
                                       〛
                                    
                                    
                                       A
                                    
                                 
                                 ,
                                 P
                                 )
                                 ⊑
                                 O
                                 (
                                 
                                    
                                       〚
                                       φ
                                       〛
                                    
                                    
                                       A
                                    
                                 
                                 ,
                                 p
                                 )
                               we know that 
                                 O
                                 (
                                 
                                    
                                       〚
                                       φ
                                       〛
                                    
                                    
                                       A
                                    
                                 
                                 ,
                                 p
                                 )
                                 =
                                 {
                                 ⊤
                                 }
                              . From Lemma 4, we conclude that 
                                 p
                                 ⊨
                                 ϕ
                              .  □

To see why the converse of Theorem 5 does not hold, consider the states P and p given in Fig. 8
                        , where dashed transitions denote may transitions and solid transitions denote must transitions. The dotted lines show the witnessing refinement relation between P and p; thus, 
                           P
                           ⪯
                           p
                        . Consider the test 
                           t
                           =
                           
                              
                                 a
                              
                              
                                 ˜
                              
                           
                           b
                           
                              SUCC
                           
                        . Clearly, 
                           O
                           (
                           t
                           ,
                           P
                           )
                           =
                           {
                           ⊥
                           ,
                           ⊤
                           }
                         and 
                           O
                           (
                           t
                           ,
                           p
                           )
                           =
                           {
                           ⊥
                           }
                        . However, 
                           {
                           ⊥
                           ,
                           ⊤
                           }
                           ⋢
                           {
                           ⊥
                           }
                        .

Thus, in order to obtain a full characterization of modal refinement, we need to restrict ourselves to the set of test expressions 
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           ⊆
                           T
                         generated by the grammar given below. 
                           Corollary 1
                           
                              Let P and p be states in an MTS and an LTS, respectively. Let 
                              
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 ⊆
                                 T
                               
                              be the set of tests generated by the following grammar:
                              
                                 
                                    
                                       t
                                       :
                                       :
                                       =
                                       
                                          SUCC
                                       
                                       |
                                       
                                          FAIL
                                       
                                       |
                                       ∃
                                       a
                                       t
                                       |
                                       ∀
                                       
                                          
                                             a
                                          
                                          
                                             ˜
                                          
                                       
                                       t
                                       |
                                       
                                          
                                             t
                                          
                                          
                                             1
                                          
                                       
                                       ∧
                                       
                                          
                                             t
                                          
                                          
                                             2
                                          
                                       
                                       |
                                       
                                          
                                             t
                                          
                                          
                                             1
                                          
                                       
                                       ∨
                                       
                                          
                                             t
                                          
                                          
                                             2
                                          
                                       
                                       .
                                    
                                 
                               
                              Then, 
                              
                                 
                                    
                                       ∀
                                    
                                    
                                       t
                                       ∈
                                       
                                          
                                             T
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 
                                 O
                                 (
                                 t
                                 ,
                                 P
                                 )
                                 ⊑
                                 O
                                 (
                                 t
                                 ,
                                 p
                                 )
                                 
                                 ⇔
                                 
                                 P
                                 ⪯
                                 p
                              
                              .
                           

It follows also from Corollary 1 that if an LTS is not a valid product of an MTS, i.e., 
                           P
                           ⪯̸
                           p
                        , then it is sufficient to find a test 
                           t
                           ∈
                           T
                         such that 
                           O
                           (
                           t
                           ,
                           P
                           )
                           ⋢
                           O
                           (
                           t
                           ,
                           p
                           )
                        . Moreover, for such an invalid product there always exists a test-case, which tells it apart from the product line. 
                           Example 9
                           Recall the MTS given in Fig. 2(a) and represent it by P. Consider an LTS given in Fig. 9
                               and represent it by p.

Observe that by adopting the test 
                                 t
                                 =
                                 ∃
                                 
                                    1d
                                 
                                 
                                 
                                    sugar
                                 
                                 
                                 
                                    coffee
                                 
                                 
                                 
                                    pour sugar
                                 
                                 
                                 
                                    pour coffee
                                 
                                 
                                 
                                    SUCC
                                 
                               we can show that p is not a valid product of P because 
                                 O
                                 (
                                 t
                                 ,
                                 P
                                 )
                                 =
                                 {
                                 ⊤
                                 }
                               and 
                                 O
                                 (
                                 t
                                 ,
                                 p
                                 )
                                 =
                                 {
                                 ⊥
                                 }
                              . Thus 
                                 {
                                 ⊤
                                 }
                                 ⋢
                                 {
                                 ⊥
                                 }
                              ; hence, 
                                 P
                                 ⪯̸
                                 p
                              .

Similar to the case of MTSs, we are not aware of any extensional notion of testing for FTSs and PL-LTSs (the product-derivation relation of the latter is similar to the product-derivation relation of FTSs). To fill in this gap, we modify the testing framework of MTS (given in the previous section) and show how to characterize our notion of product derivation of an FTS (PL-LTS) by a testing equivalence.

Recall the set of tests T generated from the grammar given in the previous subsection. We give now an interpretation of a test 
                           t
                           ∈
                           T
                         over an FTS 
                           (
                           P
                           ,
                           A
                           ,
                           F
                           ,
                           →
                           ,
                           Λ
                           )
                        . It should not be surprising that only the semantics of the tests of the form at and 
                           
                              
                                 a
                              
                              
                                 ˜
                              
                           
                           t
                         needs to be modified, while the semantics of the remaining operators (from Fig. 7) remains unchanged. Formally, we first define a family of transition relations, parameterized by product configurations, by modifying rules 3–6 in the following way.
                           
                              
                           
                        
                     

Second, we define the family of observation functions (parameterized by the product configurations) which essentially evaluates an experiment expression interacting with a specification modeled as an FTS.
                           
                              
                                 
                                    
                                       O
                                    
                                    
                                       λ
                                    
                                 
                                 (
                                 t
                                 ,
                                 P
                                 )
                                 =
                                 {
                                 ⊤
                                 |
                                 (
                                 t
                                 ∥
                                 P
                                 )
                                 
                                    ↠
                                    λ
                                 
                                 ⊤
                                 }
                                 ∪
                                 {
                                 ⊥
                                 |
                                 (
                                 t
                                 ∥
                                 P
                                 )
                                 
                                    ↠
                                    λ
                                 
                                 ⊥
                                 }
                                 .
                              
                           
                         In a similar vein, we also give an interpretation of a test 
                           t
                           ∈
                           T
                         over a PL-LTS 
                           (
                           P
                           ×
                           
                              
                                 {
                                 L
                                 ,
                                 R
                                 ,
                                 ?
                                 }
                              
                              
                                 I
                              
                           
                           ,
                           A
                           ,
                           →
                           )
                        , where only rules 3–6 are modified and the remaining operational rules of the operators (except 
                           a
                           t
                           ,
                           
                              
                                 a
                              
                              
                                 ˜
                              
                           
                           t
                        ) are unchanged.
                           
                              
                           
                        
                     

Lastly, we define a function 
                           
                              
                                 O
                              
                              
                                 θ
                              
                           
                           :
                           T
                           ×
                           (
                           P
                           ×
                           
                              
                                 {
                                 L
                                 ,
                                 R
                                 ,
                                 ?
                                 }
                              
                              
                                 I
                              
                           
                           )
                           →
                           P
                           [
                           O
                           ]
                        , parametrized by configuration vectors, as follows:
                           
                              
                                 
                                    
                                       O
                                    
                                    
                                       θ
                                    
                                 
                                 (
                                 t
                                 ,
                                 P
                                 ,
                                 ν
                                 )
                                 =
                                 {
                                 ⊤
                                 |
                                 t
                                 ∥
                                 (
                                 P
                                 ,
                                 ν
                                 )
                                 
                                    ↠
                                    θ
                                 
                                 ⊤
                                 }
                                 ∪
                                 {
                                 ⊥
                                 |
                                 t
                                 ∥
                                 (
                                 P
                                 ,
                                 ν
                                 )
                                 
                                    ↠
                                    θ
                                 
                                 ⊥
                                 }
                                 .
                              
                           
                        
                     

Just like in the case of MTSs, we have the following lemma. 
                           Lemma 5
                           
                              Let P be a state in an FTS and let λ be a product configuration. Then, for any test expression t we have
                              
                                 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             λ
                                          
                                       
                                       (
                                       ∀
                                       t
                                       ,
                                       P
                                       )
                                       =
                                       ∀
                                       
                                          
                                             O
                                          
                                          
                                             λ
                                          
                                       
                                       (
                                       t
                                       ,
                                       P
                                       )
                                       
                                       
                                          and
                                       
                                       
                                       
                                          
                                             O
                                          
                                          
                                             λ
                                          
                                       
                                       (
                                       ∃
                                       t
                                       ,
                                       P
                                       )
                                       =
                                       ∃
                                       
                                          
                                             O
                                          
                                          
                                             λ
                                          
                                       
                                       (
                                       t
                                       ,
                                       P
                                       )
                                       .
                                    
                                 
                              
                           

Next, we give the main result of this subsection; namely that our notion of test-cases is both sound and complete for the generalized notion product derivation. 
                           Theorem 6
                           
                              Let P be an FTS specification, p be state in an LTS, and λ be a product. Then,
                              
                                 
                                    
                                       P
                                       
                                          
                                             ⊢
                                          
                                          
                                             λ
                                          
                                       
                                       p
                                       
                                       ⇔
                                       
                                       
                                          
                                             ∀
                                          
                                          
                                             t
                                             ∈
                                             T
                                          
                                       
                                       
                                       
                                          
                                             O
                                          
                                          
                                             λ
                                          
                                       
                                       (
                                       t
                                       ,
                                       P
                                       )
                                       =
                                       O
                                       (
                                       t
                                       ,
                                       p
                                       )
                                       .
                                    
                                 
                              
                           

(⇐) Suppose otherwise, 
                                 P
                                 
                                    
                                       ⊬
                                    
                                    
                                       λ
                                    
                                 
                                 p
                               and for all tests t, we have 
                                 
                                    
                                       O
                                    
                                    
                                       λ
                                    
                                 
                                 (
                                 t
                                 ,
                                 P
                                 )
                                 =
                                 O
                                 (
                                 t
                                 ,
                                 p
                                 )
                              . Then we distinguish the following cases:
                                 
                                    1.
                                    Either, there exists 
                                          a
                                          ,
                                          Q
                                        such that 
                                          P
                                          
                                             
                                                
                                                   →
                                                   a
                                                
                                             
                                             
                                                ϕ
                                             
                                          
                                          Q
                                          ,
                                          λ
                                          ⊨
                                          ϕ
                                       , and for all q, if 
                                          p
                                          
                                             →
                                             a
                                          
                                          q
                                        then 
                                          Q
                                          
                                             
                                                ⊬
                                             
                                             
                                                λ
                                             
                                          
                                          q
                                       . Let 
                                          p
                                          (
                                          a
                                          )
                                          =
                                          {
                                          q
                                          |
                                          p
                                          
                                             →
                                             a
                                          
                                          q
                                          }
                                       . Due to image finiteness assumption we know that the set 
                                          p
                                          (
                                          a
                                          )
                                        is finite. We identify the following cases:
                                          
                                             (a)
                                             Suppose 
                                                   p
                                                   (
                                                   a
                                                   )
                                                   =
                                                   ∅
                                                . Then,
                                                   
                                                      
                                                         ⊤
                                                         ∈
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         a
                                                         
                                                            SUCC
                                                         
                                                         ,
                                                         P
                                                         )
                                                         
                                                         
                                                         (
                                                         ∵
                                                         P
                                                         
                                                            →
                                                            
                                                               a
                                                               ,
                                                               ϕ
                                                            
                                                         
                                                         Q
                                                         ∧
                                                         λ
                                                         ⊨
                                                         ϕ
                                                         )
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ⇒
                                                         ∃
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         a
                                                         
                                                            SUCC
                                                         
                                                         ,
                                                         P
                                                         )
                                                         =
                                                         {
                                                         ⊤
                                                         }
                                                         
                                                         
                                                         (
                                                         Truth table of
                                                         
                                                         ∃
                                                         )
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ⇒
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         ∃
                                                         a
                                                         
                                                            SUCC
                                                         
                                                         ,
                                                         P
                                                         )
                                                         =
                                                         {
                                                         ⊤
                                                         }
                                                         
                                                         
                                                         (
                                                         
                                                            Lemma 5:
                                                         
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         ∃
                                                         t
                                                         ,
                                                         s
                                                         )
                                                         =
                                                         ∃
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         t
                                                         ,
                                                         s
                                                         )
                                                         )
                                                         .
                                                      
                                                   
                                                 But, 
                                                   O
                                                   (
                                                   a
                                                   
                                                      SUCC
                                                   
                                                   ,
                                                   p
                                                   )
                                                   =
                                                   {
                                                   ⊥
                                                   }
                                                ; thus,
                                                   
                                                      
                                                         O
                                                         (
                                                         a
                                                         
                                                            SUCC
                                                         
                                                         ,
                                                         p
                                                         )
                                                         =
                                                         ∃
                                                         O
                                                         (
                                                         a
                                                         
                                                            SUCC
                                                         
                                                         ,
                                                         p
                                                         )
                                                         =
                                                         O
                                                         (
                                                         ∃
                                                         a
                                                         
                                                            SUCC
                                                         
                                                         ,
                                                         p
                                                         )
                                                         =
                                                         {
                                                         ⊥
                                                         }
                                                         .
                                                      
                                                   
                                                 Hence, a contradiction follows.

Suppose 
                                                   p
                                                   (
                                                   a
                                                   )
                                                   =
                                                   {
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   ⋯
                                                   ,
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                   }
                                                . Then, by induction hypothesis there exists sub-tests 
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   ⋯
                                                   ,
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                 such that 
                                                   
                                                      
                                                         O
                                                      
                                                      
                                                         λ
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   Q
                                                   )
                                                   ≠
                                                   O
                                                   (
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                .
                                                   
                                                      i.
                                                      Either, 
                                                            
                                                               
                                                                  O
                                                               
                                                               
                                                                  λ
                                                               
                                                            
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            Q
                                                            )
                                                            =
                                                            {
                                                            ⊤
                                                            }
                                                            ∧
                                                            O
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  q
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                            =
                                                            {
                                                            ⊥
                                                            }
                                                         . Let 
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            =
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                            ∧
                                                            ⋯
                                                            ∧
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  n
                                                               
                                                            
                                                         . Consequently,
                                                            
                                                               
                                                                  ⊤
                                                                  ∈
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  P
                                                                  )
                                                                  
                                                                  
                                                                  (
                                                                  ∵
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  ,
                                                                  Q
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  ∃
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  P
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  Truth table of
                                                                  
                                                                  ∃
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  ∃
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  P
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  
                                                                     Lemma 5:
                                                                  
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  ∃
                                                                  t
                                                                  ,
                                                                  P
                                                                  )
                                                                  =
                                                                  ∃
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  t
                                                                  ,
                                                                  P
                                                                  )
                                                                  )
                                                                  .
                                                               
                                                            
                                                          But,
                                                            
                                                               
                                                                  O
                                                                  (
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  ∵
                                                                  O
                                                                  (
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        q
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  ∃
                                                                  O
                                                                  (
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  Truth table:
                                                                  
                                                                  ∃
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  O
                                                                  (
                                                                  ∃
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  O
                                                                  (
                                                                  ∃
                                                                  t
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  ∃
                                                                  O
                                                                  (
                                                                  t
                                                                  ,
                                                                  p
                                                                  )
                                                                  
                                                                  
                                                                     [23]
                                                                  
                                                                  )
                                                                  .
                                                               
                                                            
                                                          Hence, a contradiction.

Or, 
                                                            
                                                               
                                                                  O
                                                               
                                                               
                                                                  λ
                                                               
                                                            
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            Q
                                                            )
                                                            =
                                                            {
                                                            ⊥
                                                            }
                                                            ∧
                                                            O
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  q
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                            =
                                                            {
                                                            ⊤
                                                            }
                                                         . Let 
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            =
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                            ∨
                                                            ⋯
                                                            ∨
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  n
                                                               
                                                            
                                                         . Consequently,
                                                            
                                                               
                                                                  ⊥
                                                                  ∈
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  Q
                                                                  )
                                                                  
                                                                  
                                                                  (
                                                                  ∵
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  ,
                                                                  Q
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  ∀
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  Q
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  Truth table of
                                                                  
                                                                  ∀
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  ∀
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  Q
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  
                                                                     Lemma 5:
                                                                  
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  ∀
                                                                  t
                                                                  ,
                                                                  Q
                                                                  )
                                                                  =
                                                                  ∀
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  t
                                                                  ,
                                                                  Q
                                                                  )
                                                                  )
                                                                  .
                                                               
                                                            
                                                          Furthermore,
                                                            
                                                               
                                                                  O
                                                                  (
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  since
                                                                  
                                                                  O
                                                                  (
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        q
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  ∀
                                                                  O
                                                                  (
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  ∀
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  O
                                                                  (
                                                                  ∀
                                                                  a
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  .
                                                               
                                                            
                                                          Hence, a contradiction.

Or, there exists 
                                          a
                                          ,
                                          q
                                        such that 
                                          p
                                          
                                             →
                                             a
                                          
                                          q
                                        and for all 
                                          Q
                                          ,
                                          ϕ
                                       , if 
                                          P
                                          
                                             
                                                
                                                   →
                                                   a
                                                
                                             
                                             
                                                ϕ
                                             
                                          
                                          Q
                                          ∧
                                          λ
                                          ⊨
                                          ϕ
                                       , then 
                                          Q
                                          
                                             
                                                ⊬
                                             
                                             
                                                λ
                                             
                                          
                                          q
                                       . Due to image finiteness assumption, we know that the set 
                                          P
                                          (
                                          a
                                          )
                                          =
                                          {
                                          Q
                                          |
                                          
                                             
                                                ∃
                                             
                                             
                                                ϕ
                                             
                                          
                                          
                                          P
                                          
                                             
                                                
                                                   →
                                                   a
                                                
                                             
                                             
                                                ϕ
                                             
                                          
                                          Q
                                          ∧
                                          λ
                                          ⊨
                                          ϕ
                                          }
                                        is finite.
                                          
                                             (a)
                                             Suppose 
                                                   P
                                                   (
                                                   a
                                                   )
                                                   =
                                                   ∅
                                                . Then,
                                                   
                                                      
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         
                                                            
                                                               a
                                                            
                                                            
                                                               ˜
                                                            
                                                         
                                                         
                                                            FAIL
                                                         
                                                         ,
                                                         P
                                                         )
                                                         =
                                                         {
                                                         ⊤
                                                         }
                                                         
                                                         
                                                         (
                                                         ∵
                                                         P
                                                         (
                                                         a
                                                         )
                                                         =
                                                         ∅
                                                         )
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ⇒
                                                         ∀
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         
                                                            
                                                               a
                                                            
                                                            
                                                               ˜
                                                            
                                                         
                                                         
                                                            FAIL
                                                         
                                                         ,
                                                         P
                                                         )
                                                         =
                                                         {
                                                         ⊤
                                                         }
                                                         
                                                         
                                                         (
                                                         Truth table:
                                                         
                                                         ∀
                                                         {
                                                         ⊤
                                                         }
                                                         =
                                                         {
                                                         ⊤
                                                         }
                                                         )
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ⇒
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         ∀
                                                         
                                                            
                                                               a
                                                            
                                                            
                                                               ˜
                                                            
                                                         
                                                         
                                                            FAIL
                                                         
                                                         ,
                                                         P
                                                         )
                                                         =
                                                         {
                                                         ⊤
                                                         }
                                                         
                                                         
                                                         (
                                                         
                                                            Lemma 5:
                                                         
                                                         ∀
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         t
                                                         ,
                                                         P
                                                         )
                                                         =
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         ∀
                                                         t
                                                         ,
                                                         P
                                                         )
                                                         )
                                                         .
                                                      
                                                   
                                                 But, 
                                                   O
                                                   (
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         ˜
                                                      
                                                   
                                                   
                                                      FAIL
                                                   
                                                   ,
                                                   p
                                                   )
                                                   =
                                                   {
                                                   ⊥
                                                   }
                                                 (since 
                                                   p
                                                   
                                                      →
                                                      a
                                                   
                                                   q
                                                   ,
                                                   O
                                                   (
                                                   
                                                      FAIL
                                                   
                                                   ,
                                                   q
                                                   )
                                                   =
                                                   {
                                                   ⊥
                                                   }
                                                ). Thus, 
                                                   O
                                                   (
                                                   ∀
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         ˜
                                                      
                                                   
                                                   ,
                                                   p
                                                   )
                                                   =
                                                   ∀
                                                   O
                                                   (
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         ˜
                                                      
                                                   
                                                   
                                                      FAIL
                                                   
                                                   ,
                                                   p
                                                   )
                                                   =
                                                   {
                                                   ⊥
                                                   }
                                                , which is a contradiction.

Suppose 
                                                   P
                                                   (
                                                   a
                                                   )
                                                   =
                                                   {
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   ⋯
                                                   ,
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                   }
                                                . Then, by induction hypothesis there exists sub-tests 
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   ⋯
                                                   ,
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                 such that 
                                                   
                                                      
                                                         O
                                                      
                                                      
                                                         λ
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   ≠
                                                   O
                                                   (
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   q
                                                   )
                                                .
                                                   
                                                      i.
                                                      Either 
                                                            
                                                               
                                                                  O
                                                               
                                                               
                                                                  λ
                                                               
                                                            
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  Q
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                            =
                                                            {
                                                            ⊤
                                                            }
                                                          and 
                                                            O
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            q
                                                            )
                                                            =
                                                            {
                                                            ⊥
                                                            }
                                                         . Let 
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            =
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                            ∨
                                                            ⋯
                                                            ∨
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  n
                                                               
                                                            
                                                         . Then, from truth table of ∨ we have 
                                                            
                                                               
                                                                  O
                                                               
                                                               
                                                                  λ
                                                               
                                                            
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  Q
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                            =
                                                            {
                                                            ⊤
                                                            }
                                                         . Consequently,
                                                            
                                                               
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  P
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  ∵
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        Q
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  ∀
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  P
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  Truth table:
                                                                  
                                                                  ∀
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  ∀
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  P
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  
                                                                     Lemma 5:
                                                                  
                                                                  ∀
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  t
                                                                  ,
                                                                  P
                                                                  )
                                                                  =
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  ∀
                                                                  t
                                                                  ,
                                                                  P
                                                                  )
                                                                  )
                                                                  .
                                                               
                                                            
                                                          Furthermore, 
                                                            O
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            ,
                                                            q
                                                            )
                                                            =
                                                            O
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                            ,
                                                            q
                                                            )
                                                            ∨
                                                            ⋯
                                                            ∨
                                                            O
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  n
                                                               
                                                            
                                                            ,
                                                            q
                                                            )
                                                            =
                                                            {
                                                            ⊥
                                                            }
                                                         . Thus,
                                                            
                                                               
                                                                  ⊥
                                                                  ∈
                                                                  O
                                                                  (
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  ∀
                                                                  O
                                                                  (
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  Truth table of
                                                                  
                                                                  ∀
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  O
                                                                  (
                                                                  ∀
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  ∀
                                                                  O
                                                                  (
                                                                  t
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  O
                                                                  (
                                                                  ∀
                                                                  t
                                                                  ,
                                                                  p
                                                                  )
                                                                  
                                                                  
                                                                     [23]
                                                                  
                                                                  )
                                                                  .
                                                               
                                                            
                                                          Hence, a contradiction.

Or 
                                                            
                                                               
                                                                  O
                                                               
                                                               
                                                                  λ
                                                               
                                                            
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  Q
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                            =
                                                            {
                                                            ⊥
                                                            }
                                                          and 
                                                            O
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  q
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            )
                                                            =
                                                            {
                                                            ⊤
                                                            }
                                                         . Let 
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            =
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                            ∧
                                                            ⋯
                                                            ∧
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  n
                                                               
                                                            
                                                         . Then, 
                                                            
                                                               
                                                                  O
                                                               
                                                               
                                                                  λ
                                                               
                                                            
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  Q
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                            =
                                                            {
                                                            ⊥
                                                            }
                                                         . Consequently,
                                                            
                                                               
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  P
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  since
                                                                  
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        Q
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  ∃
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  P
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  ∃
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  
                                                                     
                                                                        O
                                                                     
                                                                     
                                                                        λ
                                                                     
                                                                  
                                                                  (
                                                                  ∃
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  P
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊥
                                                                  }
                                                                  .
                                                               
                                                            
                                                          Furthermore, 
                                                            O
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            ,
                                                            q
                                                            )
                                                            =
                                                            O
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                            ,
                                                            q
                                                            )
                                                            ∧
                                                            ⋯
                                                            ∧
                                                            O
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  n
                                                               
                                                            
                                                            ,
                                                            q
                                                            )
                                                            =
                                                            {
                                                            ⊤
                                                            }
                                                         . Thus,
                                                            
                                                               
                                                                  ⊤
                                                                  ∈
                                                                  O
                                                                  (
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  
                                                                  
                                                                  (
                                                                  since
                                                                  
                                                                  O
                                                                  (
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  q
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  ∃
                                                                  O
                                                                  (
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  Truth table of
                                                                  
                                                                  ∃
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⇒
                                                                  O
                                                                  (
                                                                  ∃
                                                                  
                                                                     
                                                                        a
                                                                     
                                                                     
                                                                        ˜
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  {
                                                                  ⊤
                                                                  }
                                                                  
                                                                  
                                                                  (
                                                                  ∃
                                                                  O
                                                                  (
                                                                  t
                                                                  ,
                                                                  p
                                                                  )
                                                                  =
                                                                  O
                                                                  (
                                                                  ∃
                                                                  t
                                                                  ,
                                                                  p
                                                                  )
                                                                  
                                                                  
                                                                     [23]
                                                                  
                                                                  )
                                                                  .
                                                               
                                                            
                                                          Hence, a contradiction follows.

Let 
                                          t
                                          =
                                          a
                                          
                                             
                                                t
                                             
                                             
                                                ′
                                             
                                          
                                       .
                                          
                                             (a)
                                             Let 
                                                   ⊤
                                                   ∈
                                                   
                                                      
                                                         O
                                                      
                                                      
                                                         λ
                                                      
                                                   
                                                   (
                                                   a
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   P
                                                   )
                                                . Then,
                                                   
                                                      
                                                         P
                                                         
                                                            
                                                               
                                                                  →
                                                                  a
                                                               
                                                            
                                                            
                                                               ϕ
                                                            
                                                         
                                                         Q
                                                         ∧
                                                         λ
                                                         ⊨
                                                         ϕ
                                                         ∧
                                                         ⊤
                                                         ∈
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         ,
                                                         Q
                                                         )
                                                         
                                                         
                                                         for some
                                                         
                                                         ϕ
                                                         ,
                                                         Q
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ⇒
                                                         p
                                                         
                                                            →
                                                            a
                                                         
                                                         q
                                                         
                                                         
                                                         (
                                                         ∵
                                                         P
                                                         
                                                            
                                                               ⊢
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         p
                                                         )
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ⇒
                                                         ⊤
                                                         ∈
                                                         
                                                            
                                                               O
                                                            
                                                            
                                                               λ
                                                            
                                                         
                                                         (
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         ,
                                                         Q
                                                         )
                                                         ⇒
                                                         ⊤
                                                         ∈
                                                         O
                                                         (
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         ,
                                                         q
                                                         )
                                                         
                                                         
                                                         (Induction hypothesis)
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ⇒
                                                         ⊤
                                                         ∈
                                                         O
                                                         (
                                                         a
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         ,
                                                         p
                                                         )
                                                         .
                                                      
                                                   
                                                
                                             

Let 
                                                   ⊥
                                                   ∈
                                                   
                                                      
                                                         O
                                                      
                                                      
                                                         λ
                                                      
                                                   
                                                   (
                                                   a
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   P
                                                   )
                                                . Then we have the following cases:
                                                   
                                                      i.
                                                      Either 
                                                            P
                                                            
                                                               
                                                                  
                                                                     →
                                                                     a
                                                                  
                                                               
                                                               
                                                                  ϕ
                                                               
                                                            
                                                            Q
                                                            ∧
                                                            λ
                                                            ⊨
                                                            ϕ
                                                            ∧
                                                            ⊥
                                                            ∈
                                                            
                                                               
                                                                  O
                                                               
                                                               
                                                                  λ
                                                               
                                                            
                                                            (
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            ,
                                                            Q
                                                            )
                                                         , for some 
                                                            Q
                                                            ,
                                                            ϕ
                                                         . Similar to Case (a).

Or, 
                                                            
                                                               
                                                                  ∄
                                                               
                                                               
                                                                  Q
                                                                  ,
                                                                  ϕ
                                                               
                                                            
                                                            
                                                            P
                                                            
                                                               
                                                                  
                                                                     →
                                                                     a
                                                                  
                                                               
                                                               
                                                                  ϕ
                                                               
                                                            
                                                            Q
                                                            ∧
                                                            λ
                                                            ⊨
                                                            ϕ
                                                         . Then, 
                                                            
                                                               
                                                                  O
                                                               
                                                               
                                                                  λ
                                                               
                                                            
                                                            (
                                                            a
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            ,
                                                            P
                                                            )
                                                            =
                                                            {
                                                            ⊥
                                                            }
                                                         . Suppose otherwise, 
                                                            ⊤
                                                            ∈
                                                            O
                                                            (
                                                            a
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            ,
                                                            p
                                                            )
                                                         . Then, 
                                                            
                                                               
                                                                  ∃
                                                               
                                                               
                                                                  q
                                                               
                                                            
                                                            
                                                            p
                                                            
                                                               →
                                                               a
                                                            
                                                            q
                                                         . But, 
                                                            P
                                                            
                                                               
                                                                  ⊢
                                                               
                                                               
                                                                  λ
                                                               
                                                            
                                                            p
                                                         . Thus, 
                                                            
                                                               
                                                                  ∃
                                                               
                                                               
                                                                  Q
                                                                  ,
                                                                  ϕ
                                                               
                                                            
                                                            
                                                            P
                                                            
                                                               
                                                                  
                                                                     →
                                                                     a
                                                                  
                                                               
                                                               
                                                                  ϕ
                                                               
                                                            
                                                            Q
                                                            ∧
                                                            λ
                                                            ⊨
                                                            ϕ
                                                         , which is a contradiction.

Let 
                                                   ⊤
                                                   ∈
                                                   O
                                                   (
                                                   a
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   p
                                                   )
                                                . Similar to Case (a).

Let 
                                                   ⊥
                                                   ∈
                                                   O
                                                   (
                                                   a
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   p
                                                   )
                                                . Similar to Case (b).

Let 
                                          t
                                          =
                                          
                                             
                                                a
                                             
                                             
                                                ˜
                                             
                                          
                                          
                                             
                                                t
                                             
                                             
                                                ′
                                             
                                          
                                       . Similar to the Case (1).

Furthermore, it follows from Lemma 1 that the notion of test cases remains sound and complete for the traditional notion of product derivation. 
                           Theorem 7
                           
                              Let 
                              
                                 (
                                 P
                                 ,
                                 ν
                                 )
                               
                              be a state in a PL-LTS, p be state in an LTS, and θ be a configuration vector. Then,
                              
                                 
                                    
                                       (
                                       P
                                       ,
                                       ν
                                       )
                                       
                                          
                                             ⊢
                                          
                                          
                                             θ
                                          
                                       
                                       p
                                       
                                       ⇔
                                       
                                       
                                          
                                             ∀
                                          
                                          
                                             t
                                             ∈
                                             T
                                          
                                       
                                       
                                       
                                          
                                             O
                                          
                                          
                                             θ
                                          
                                       
                                       (
                                       t
                                       ,
                                       P
                                       ,
                                       ν
                                       )
                                       =
                                       O
                                       (
                                       t
                                       ,
                                       p
                                       )
                                       .
                                    
                                 
                              
                           

Similar to the proof of Theorem 6.  □

@&#CONCLUSIONS@&#

In this paper, we studied three fundamental behavioral models for software product lines, namely, modal transition systems, featured transition systems, and product-line labeled transition systems. In particular, we studied the expressiveness of these models by comparing their sets of definable products, which are assumed to be expressible as labeled transition systems. We have shown that modal transition systems are the least expressive of all three, featured transition systems are the most expressive, and product-line labeled transition systems are strictly in between the two. Then we moved to define extensional notions of product derivation and adapted the notion of tests by Abramsky to this end. We proved that the intensional notions of product derivation coincide with the extensional notions defined in this paper for each and every formalism.

Compositionality (pre-congruence) is well-studied for modal refinement in the context of MTSs [24]. However, this problem is understudied for FTSs and this is a high priority item in our future-research agenda. We envisage that using the divide and congruence approach of [42,43] could provide a solution in this regard (see [44] for our initial attempt in this direction). Another important topic in this area is defining a closed and finite notion of test-cases that can detect all faults, given a fault model (e.g., similar to the W-Method in FSM-based testing [39]). A third area of research, which builds upon the previously-mentioned topic, is to define an incremental procedure for testing different products of a product line.

A few other proposals for transition-system-based specifications of SPLs have been proposed that deserve further investigation. In [10,11], (Generalized) Extended Modal Transition Systems (GEMTSs) have been introduced in order to specify SPLs. These are variants of disjunctive normal forms [45]. We conjecture that this formalism is strictly in between MTSs and FTSs in terms of expressiveness. Also, in [19], a multi-modal semantics for “Variant Process Algebra” has been introduced, which we conjecture, is as expressive as featured transition systems. We leave proving these conjectures, as well as devising the appropriate extensional notion of testing for GEMTSs for future work.

@&#REFERENCES@&#

