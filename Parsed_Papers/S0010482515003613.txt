@&#MAIN-TITLE@&#Visualization of boundaries in CT volumetric data sets using dynamic 
                  M
                  −
                  |
                  ∇
                  f
                  |
                histogram

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           We build a generalized boundary model contaminated by noise.


                        
                        
                           
                           We prove boundary middle value has a good statistical property in our boundary model.


                        
                        
                           
                           A dynamic 
                                 M
                                 −
                                 |
                                 ∇
                                 f
                                 |
                               histogram is established with a novel strategy of boundary extraction to avoid misclassification.


                        
                        
                           
                           A complete application is designed to implement our boundary visualization method.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Direct volume rendering

Multi-dimensional transfer function

Volume visualization

3-D CT volume

Boundary extraction

@&#ABSTRACT@&#


               
               
                  Direct volume rendering is widely used for three-dimensional medical data visualization such as computed tomography and magnetic resonance imaging. Distinct visualization of boundaries is able to provide valuable and insightful information in many medical applications. However, it is conventionally challenging to detect boundaries reliably due to limitations of the transfer function design. Meanwhile, the interactive strategy is complicated for new users or even experts. In this paper, we build a generalized boundary model contaminated by noise and prove boundary middle value (M) has a good statistical property. Based on the model we propose a user-friendly strategy for the boundary extraction and transfer function design, using M, boundary height 
                        (
                        Δ
                        h
                        )
                     , and gradient magnitude 
                        (
                        |
                        ∇
                        f
                        |
                        )
                     . In fact, it is a dynamic iterative process. First, potential boundaries are sorted orderly from high to low according to the value of their height. Then, users iteratively extract the boundary with the highest value of 
                        Δ
                        h
                      in a newly defined domain, where different boundaries are transformed to disjoint vertical bars using 
                        M
                        −
                        |
                        ∇
                        f
                        |
                      histogram. In this case, the chance of misclassification among different boundaries decreases.
               
            

@&#INTRODUCTION@&#

Direct volume rendering is a widely used visualization technique to demonstrate the internal structures of volume data sets. To generate a meaningful visualization, transfer functions (TFs) should be designed to map data properties (e.g. scalar value, gradient) to optical properties (e.g. color, opacity). Color is used to generate a visual distinction between different data properties. Opacity determines the visual degree for each voxel of the volume data.

Since data properties may be changing with different applications, designing an ad hoc TF is quite necessary to make the structures of interest visible and distinguishable. The most commonly used 1-dimensional (1-D) transfer function maps scalar value to color and opacity based on the histogram of scalar value occurrences. Users need to select the materials of interest and set color and opacity by trial-and-error method.

The visualization of boundaries of 3-dimensional (3-D) computed tomography (CT) data has a wide range of applications and great significance for disease diagnosis and screening [1–3]. In order to highlight boundaries, gradient magnitude 
                        (
                        |
                        ∇
                        f
                        |
                        )
                      has been adopted as a data property [4,5]. Adding 
                        |
                        ∇
                        f
                        |
                      as an independent dimension to the 1-D TF of scalar value, the 2-dimensional (2-D) 
                        f
                        −
                        |
                        ∇
                        f
                        |
                      histogram [6] has been proposed to facilitate boundary extractions. Boundaries in 
                        f
                        −
                        |
                        ∇
                        f
                        |
                      histogram are represented as arches, enabling users to extract different boundaries and design TFs for individual boundaries. Nevertheless, it is difficult to extract arches, especially considering the overlapping among arches. Low/high (LH) histogram [7], therefore, has been introduced to overcome the drawback by using the low and high intensities of materials around the boundary as two key data properties. In LH histogram, boundaries are expressed as points (without noise), lines and regions (with noise and bias), making the implementation of boundary extractions much easier.

As is known to all, boundaries represented in 2-D histograms are often extracted interactively, while the strategies are too complicated for new users or even experts to follow. For instance, in 
                        f
                        −
                        |
                        ∇
                        f
                        |
                      histogram users have to precisely pick out each arch by widgets. In LH histogram, users have to pick out each targeted region manually. Under the situation that the noise and overlapping is large, arches with smaller size are apt to be hidden by larger ones in 
                        f
                        −
                        |
                        ∇
                        f
                        |
                      histogram and different targeted regions tend to merge in LH histogram. Thus, it is a tedious or even impossible task for users via trial-and-error process.

Misclassification among different boundaries, to some extent, can be avoided by carefully choosing arches and regions in 
                        f
                        −
                        |
                        ∇
                        f
                        |
                      and LH histograms respectively. However, as the number of boundaries increases, the effect of misclassification will accumulate gradually. This will likely have a negative impact on the subsequent arches/regions selection. When the effect reaches a certain level, it is impossible for users to pick out the remaining boundaries with high quality. They have to extract boundaries using the original histogram from the very beginning.

In this paper, on one hand, we build a generalized boundary model contaminated by noise. On the other hand, based on the model we propose a novel multidimensional TF design method using boundary middle value (M), boundary height 
                        (
                        Δ
                        h
                        )
                      and gradient magnitude 
                        (
                        |
                        ∇
                        f
                        |
                        )
                      as data properties. Unlike traditional histograms presenting all boundary information once, the proposed method employs dynamic 
                        M
                        −
                        |
                        ∇
                        f
                        |
                      histogram and presents only one or a few boundaries at each step. A simple and iterative strategy of boundary extraction is also developed. We first sort different boundaries according to the values of their heights 
                        (
                        Δ
                        h
                        )
                      from high to low. Users control the 
                        Δ
                        h
                      value until a vertical bar occurs in 
                        M
                        −
                        |
                        ∇
                        f
                        |
                      histogram, then pick out the boundary represented by the bar in 
                        M
                        −
                        |
                        ∇
                        f
                        |
                      histogram. Boundaries are extracted one by one until the 
                        Δ
                        h
                      value reaches 0. The misclassification among different boundaries can be reduced with the help of boundary ordering and the one-by-one extraction strategy. Besides, region elimination and region growing are further adopted to enhance the quality of rendering.

There are two main contributions. First, we establish a two-material boundary model contaminated by noise and prove that M has a good statistical property in this model. Second, we propose a novel 3-D TF in a newly defined domain, using boundary middle value (M), boundary height 
                        (
                        Δ
                        h
                        )
                      and gradient magnitude 
                        (
                        |
                        ∇
                        f
                        |
                        )
                     . Based on the dynamic 
                        M
                        −
                        |
                        ∇
                        f
                        |
                      histogram, we propose an iterative boundary extraction method.

In the following section, we describe a variety of related methods. In Section 3, we build a generalized boundary model contaminated by noise. Based on the model we describe the construction and properties of the dynamic 
                        M
                        −
                        |
                        ∇
                        f
                        |
                      histogram, as well as refining techniques. In Section 4, we show several examples using our method and the traditional 
                        f
                        −
                        |
                        ∇
                        f
                        |
                      and LH histograms, and make a comparison. In Section 5, we present the conclusion and future work.

@&#BACKGROUND@&#

In this section, we present a more detailed description of some important work on the design of transfer functions. As the aim of this paper is to visualize boundaries, we give a special attention to the relevant methods in literature. Transfer function, which maps data properties to optical properties, is of crucial importance to volume visualizations. According to the type of the extracted data properties, designs of TFs can be roughly divided into two categories, data-driven and graph-driven.

Data-driven methods mainly focus on statistical features by means of histograms. The most widely used 1-D TF aims to map scalar value to opacity properties. However, it is inappropriate to employ the 1-D TF for the boundary visualization because the scalar values of the boundary vary greatly. In order to highlight boundaries, gradient magnitude 
                           (
                           |
                           ∇
                           f
                           |
                           )
                         is added as a data property. Levoy [4] and Drebin et al. [5] put forward a 1-D TF to display different boundaries using gradient features. Later, Kindlmann and Durkin [6] proposed a 2-D 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram to enhance boundaries with the horizontal axis representing scalar values and the vertical axis representing gradient magnitude. The arches in the histogram represent boundaries among different materials. Although 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram improves the selection of the boundaries, there still exists a drawback. The overlapping regions caused by the intersections of the arches lead to ambiguities in the classification of boundaries. Kniss [8,9] added second derivative into 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram to select only the peaks of the arches to obtain much better rendering results.

Unlike the aforementioned histograms using statistical features directly, LH histogram is based on the concept of the boundary model proposed by Nickoloff and Riley [10] and treats boundaries as the transition of two idealized homogeneous regions. Lum and Ma [11] proposed the early concept of LH. LH means the high intensity and low intensity of the homogeneous regions. Arches in 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram are transferred to straight lines in a 1-D histogram with the x-axis representing L and H for an easily recognition. Sereda et al. [7] compacted the arches to points and regions using LH histogram for a more convenient extraction of boundaries. Compared with the 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram, LH histogram represents boundaries more compactly. Serlie et al. [12] derived the relationship between 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         and LH histogram in a strict mathematic form based on the boundary model. One drawback of LH histogram is the time to establish the histogram. Praßni et al. [13] proposed a new way to efficiently construct LH histogram. Region selecting is a key issue to achieve automatic extraction of boundaries using LH histogram. Sereda et al. [14] used hierarchical clustering to automatically classify LH histogram to regions. Nguyen et al. [15] applied mean shift clustering to LH histogram and then used hierarchical clustering to group similar voxels.

Apart from visualizing boundaries using gradient information, curvature information [16,17] was also used to distinguish objects based on their shapes. Other statistical data properties such as mean value [18] and texture [19,20], were used in the designs of TFs to highlight the structures of interest. These local statistical properties may produce excellent results in specific applications.

Graph-driven methods mainly aim to visualize the local structures, which depend on topological analysis, such as skeletonization, region growing and level-set.

As a key concept for graph-driven methods, connectivity is the foundation of the skeletonization and region growing. Takahashi et al. [21] extracted topological structures of volume data sets, leading to a graph called a volume skeleton tree consisting of volumetric critical points and their connectivity. Ji et al. [22] segmented the 3-D teeth in cone beam computed tomography data by level-set. Volume data segmentation proposed by Gooya et al. [23] is based on manifold distance metrics with the features of scalar value, gradient and probabilistic measures.

Our proposed method mainly employs the gradient-based features and boundary model. Compared with the construction of LH histogram and 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram, the key improvement is that we build a generalized boundary model contaminated by noise and prove M has a good statistical property. Graph-driven method is employed to optimize the rendering result using region growing and region elimination based on local connectivity to reduce the misclassification, while LH histogram only uses region growing to fulfill the extracted boundaries without considering the misclassification between different boundaries.

Almost each TF design tends to provide a user-friendly interface for convenient interaction. Histogram methods of data-driven TF design provide various manipulation widgets for users based on objective statistical features [24–26]. Though these sophisticated widgets have been proposed, these widgets often do not provide simple strategies. To achieve precise operation, users should develop professional knowledge about the widgets and volume rendering. Recently, TFs with semantics [27,28] and sketch-based user interface [29,30] have been proposed to integrate intuitions into the TF design.

In this paper, we propose an interactive TF design method employing dynamic 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram. Users extract the vertical bars one by one with 
                           Δ
                           h
                         from high to low. This is a convenience interactive strategy even for non-experts with little domain knowledge.

@&#METHODS@&#

The classic two-material boundary (f) with 
                           L
                         representing the low intensity and 
                           H
                         representing the high intensity is modeled by a scaled step function 
                           (
                           u
                           (
                           x
                           ,
                           L
                           ,
                           H
                           )
                           )
                         convolved with 1-D Gaussian edge-spread-function (g) [12]. The edge locates at x=0. The model (Fig. 1
                        ) is shown to be excellent to describe the two-material boundary in CT data sets [31]. We introduce two new random variables 
                           M
                           ≜
                           (
                           L
                           +
                           H
                           )
                           /
                           2
                        , 
                           Δ
                           h
                           ≜
                           H
                           −
                           L
                        . In the classic boundary model, M and 
                           Δ
                           h
                         are constants. For a given boundary, M represents the middle value of the boundary and 
                           Δ
                           h
                         represents the height of the boundary.
                           
                              (1)
                              
                                 u
                                 (
                                 x
                                 ,
                                 L
                                 ,
                                 H
                                 )
                                 =
                                 L
                                 +
                                 (
                                 H
                                 −
                                 L
                                 )
                                 ×
                                 u
                                 (
                                 x
                                 )
                              
                           
                        
                        
                           
                              (2)
                              
                                 f
                                 (
                                 x
                                 ,
                                 σ
                                 )
                                 =
                                 u
                                 (
                                 x
                                 ,
                                 L
                                 ,
                                 H
                                 )
                                 ⁎
                                 g
                                 (
                                 x
                                 ,
                                 σ
                                 )
                                 =
                                 L
                                 +
                                 (
                                 H
                                 −
                                 L
                                 )
                                 ×
                                 
                                    
                                       1
                                    
                                    
                                       σ
                                       
                                          
                                             2
                                             π
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∫
                                    
                                    
                                       −
                                       ∞
                                    
                                    
                                       x
                                    
                                 
                                 exp
                                 (
                                 
                                    
                                       
                                          −
                                          
                                             
                                                η
                                             
                                             
                                                2
                                             
                                          
                                       
                                       
                                          2
                                          
                                             
                                                σ
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 )
                                 
                                 d
                                 η
                                 =
                                 L
                                 +
                                 (
                                 H
                                 −
                                 L
                                 )
                                 ×
                                 (
                                 
                                    
                                       
                                          1
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          1
                                       
                                       
                                          2
                                       
                                    
                                    erf
                                    (
                                    
                                       
                                          
                                             x
                                          
                                          
                                             σ
                                             
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 )
                              
                           
                        with 
                           
                              (3)
                              
                                 u
                                 (
                                 x
                                 )
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             x
                                             <
                                             0
                                          
                                       
                                       
                                          
                                             1
                                          
                                          
                                             x
                                             ≥
                                             0
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (4)
                              
                                 g
                                 (
                                 x
                                 ,
                                 σ
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       σ
                                       
                                          
                                             2
                                             π
                                          
                                       
                                    
                                 
                                 
                                 exp
                                 (
                                 
                                    
                                       
                                          −
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                          
                                       
                                       
                                          2
                                          
                                             
                                                σ
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (5)
                              
                                 erf
                                 (
                                 x
                                 )
                                 =
                                 
                                    
                                       2
                                    
                                    
                                       
                                          
                                             π
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       x
                                    
                                 
                                 exp
                                 (
                                 −
                                 
                                    
                                       η
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 
                                 d
                                 η
                              
                           
                        
                     

The classic boundary model does not consider the interference caused by noise. The major component of the noise of CT is shot noise which refers to the uncertainty of the intensity of X-ray due to its quantum origin [32]. Shot noise can be modeled by a Poisson distribution, which except at low intensity levels approximates a Gaussian distribution [33]. In general the noise of CT is modeled by a Gaussian distribution [34,35]. As the two-material boundary model contains the material and the boundary, we discuss the effects on the material and the boundary respectively when the model is contaminated by Gaussian noise.

We first consider the Gaussian noise of the materials, L and H obey normal distributions (Eq. (6)). Denote 
                              L
                              ~
                              N
                              (
                              
                                 
                                    L
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    σ
                                 
                                 
                                    l
                                 
                              
                              )
                           , and 
                              H
                              ~
                              N
                              (
                              
                                 
                                    H
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    σ
                                 
                                 
                                    h
                                 
                              
                              )
                            respectively. In Appendix A(a) and (b), we prove that 
                              M
                              ~
                              N
                              (
                              (
                              
                                 
                                    L
                                 
                                 
                                    0
                                 
                              
                              +
                              
                                 
                                    H
                                 
                                 
                                    0
                                 
                              
                              )
                              /
                              2
                              ,
                              2
                              ×
                              
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          l
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          σ
                                       
                                       
                                          h
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              )
                           , 
                              Δ
                              h
                              ~
                              N
                              (
                              (
                              
                                 
                                    H
                                 
                                 
                                    0
                                 
                              
                              −
                              
                                 
                                    L
                                 
                                 
                                    0
                                 
                              
                              )
                              ,
                              
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          l
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          σ
                                       
                                       
                                          h
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              )
                           :
                              
                                 (6)
                                 
                                    p
                                    (
                                    x
                                    )
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          σ
                                          
                                             
                                                2
                                                π
                                             
                                          
                                       
                                    
                                    
                                    exp
                                    (
                                    
                                       
                                          
                                             −
                                             
                                                
                                                   (
                                                   x
                                                   −
                                                   μ
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             2
                                             
                                                
                                                   σ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                              
                           where p(x) is the probability density at x, μ is the mean of the distribution, σ is its standard deviation.

As M and 
                              Δ
                              h
                            obey the normal distribution, the expectation (E) of each random variable is a constant.
                              
                                 (7)
                                 
                                    E
                                    (
                                    M
                                    )
                                    =
                                    
                                       
                                          (
                                          
                                             
                                                L
                                             
                                             
                                                0
                                             
                                          
                                          +
                                          
                                             
                                                H
                                             
                                             
                                                0
                                             
                                          
                                          )
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                           
                              
                                 (8)
                                 
                                    
                                    E
                                    (
                                    Δ
                                    h
                                    )
                                    =
                                    
                                       
                                          H
                                       
                                       
                                          0
                                       
                                    
                                    −
                                    
                                       
                                          L
                                       
                                       
                                          0
                                       
                                    
                                 
                              
                           
                        

Line search is the backbone of many optimizations, which is defined as:
                              
                                 (9)
                                 
                                    Min
                                    f
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          k
                                       
                                    
                                    +
                                    λ
                                    
                                       
                                          d
                                       
                                       
                                          k
                                       
                                    
                                    )
                                    s
                                    .
                                    t
                                    .
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      k
                                                   
                                                
                                                +
                                                λ
                                                
                                                   
                                                      d
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                          
                                          
                                             
                                                λ
                                                ∈
                                                [
                                                0
                                                ,
                                                +
                                                ∞
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

The goal is to find the appropriate λ to satisfy Eq. (9). In our boundary model, L and H can be regarded as the local maxima and minima along the boundary profile. Thus line search with the first-order derivative [36] is adopted to find L and H. The line search stops at 
                              x
                           , where 
                              ∇
                              f
                              (
                              x
                              −
                              ε
                              d
                              )
                              ⁎
                              ∇
                              f
                              (
                              x
                              +
                              ε
                              d
                              )
                              ≤
                              0
                           , where ε is a small real number. As L and H are not constants, it is unreliable to determine the initial point only by 
                              |
                              ∇
                              f
                              |
                              >
                              0
                           . The interference caused by noise should be eliminated. Assume in material L the intensities of two adjacent voxels are L
                           
                              l1 and L
                           
                              l2 and the distance between the two voxels is 1, we can get 
                              |
                              ∇
                              
                                 
                                    f
                                 
                                 
                                    l
                                 
                              
                              |
                              =
                              |
                              
                                 
                                    L
                                 
                                 
                                    l
                                    1
                                 
                              
                              −
                              
                                 
                                    L
                                 
                                 
                                    l
                                    2
                                 
                              
                              |
                           . As 
                              L
                              ~
                              N
                              (
                              
                                 
                                    L
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    σ
                                 
                                 
                                    l
                                 
                              
                              )
                           , the probability distribution of 
                              |
                              ∇
                              
                                 
                                    f
                                 
                                 
                                    l
                                 
                              
                              |
                            can be calculated using Eq. (10) (Appendix A(b) and (d)). Since the probability of 
                              |
                              ∇
                              
                                 
                                    f
                                 
                                 
                                    l
                                 
                              
                              |
                            in the range of 
                              [
                              0
                              ,
                              2
                              
                                 
                                    2
                                 
                              
                              
                                 
                                    σ
                                 
                                 
                                    l
                                 
                              
                              ]
                            is 0.954, 
                              |
                              ∇
                              f
                              |
                            of the initial point should satisfy the condition in Eq. (11): 
                              
                                 (10)
                                 
                                    p
                                    (
                                    |
                                    ∇
                                    
                                       
                                          f
                                       
                                       
                                          l
                                       
                                    
                                    |
                                    )
                                    =
                                    
                                       
                                          2
                                       
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                l
                                             
                                          
                                          
                                             
                                                4
                                                π
                                             
                                          
                                       
                                    
                                    exp
                                    (
                                    
                                       
                                          
                                             −
                                             
                                                
                                                   (
                                                   |
                                                   ∇
                                                   
                                                      
                                                         f
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   |
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             4
                                             
                                                
                                                   σ
                                                
                                                
                                                   l
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    )
                                    
                                    |
                                    ∇
                                    
                                       
                                          f
                                       
                                       
                                          l
                                       
                                    
                                    |
                                    ≥
                                    0
                                 
                              
                           
                           
                              
                                 (11)
                                 
                                    |
                                    ∇
                                    f
                                    |
                                    >
                                    max
                                    {
                                    
                                       
                                          σ
                                       
                                       
                                          l
                                       
                                    
                                    2
                                    
                                       
                                          2
                                       
                                    
                                    ,
                                    
                                       
                                          σ
                                       
                                       
                                          h
                                       
                                    
                                    2
                                    
                                       
                                          2
                                       
                                    
                                    }
                                 
                              
                           
                        

Then we consider the Gaussian noise to the boundary. Since line search with the first-order derivative is adopted as the searching method, we first calculate the first-order derivative of the noise, which can be represented by the first order difference of two random variables that obey the normal distribution. The gradient magnitude of the noise 
                              (
                              |
                              ∇
                              
                                 
                                    f
                                 
                                 
                                    noise
                                 
                              
                              |
                              )
                            obeys the probability distribution in Eq. (12) (Appendix A(d)). If the noise takes place on the boundary at location x
                           0, the line search is interfered in this manner: If 
                              |
                              ∇
                              
                                 
                                    f
                                 
                                 
                                    noise
                                 
                              
                              |
                              ≤
                              |
                              
                                 
                                    d
                                    (
                                    f
                                    )
                                 
                                 
                                    dx
                                 
                              
                              
                                 
                                    |
                                 
                                 
                                    x
                                    =
                                    
                                       
                                          x
                                       
                                       
                                          0
                                       
                                    
                                 
                              
                              |
                           , the line search is not disturbed by the noise (Fig. 2
                           (c) and (d)). If 
                              |
                              ∇
                              
                                 
                                    f
                                 
                                 
                                    noise
                                 
                              
                              |
                              >
                              |
                              
                                 
                                    d
                                    (
                                    f
                                    )
                                 
                                 
                                    dx
                                 
                              
                              
                                 
                                    |
                                 
                                 
                                    x
                                    =
                                    
                                       
                                          x
                                       
                                       
                                          0
                                       
                                    
                                 
                              
                              |
                           , the line search stops at point x
                           0 (Fig. 2(a) and (b)). Assume the stop points are 
                              x
                              =
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                            when searching L and 
                              x
                              =
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                            when searching H, 
                              M
                              =
                              
                                 
                                    (
                                    f
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    )
                                    +
                                    f
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    )
                                 
                                 
                                    2
                                 
                              
                           :
                              
                                 (12)
                                 
                                    p
                                    (
                                    |
                                    ∇
                                    
                                       
                                          f
                                       
                                       
                                          noise
                                       
                                    
                                    |
                                    )
                                    =
                                    
                                       
                                          2
                                       
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                n
                                             
                                          
                                          
                                             
                                                2
                                                π
                                             
                                          
                                       
                                    
                                    
                                    exp
                                    (
                                    
                                       
                                          
                                             −
                                             
                                                
                                                   (
                                                   |
                                                   ∇
                                                   
                                                      
                                                         f
                                                      
                                                      
                                                         noise
                                                      
                                                   
                                                   |
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             2
                                             
                                                
                                                   σ
                                                
                                                
                                                   n
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    )
                                    |
                                    ∇
                                    
                                       
                                          f
                                       
                                       
                                          noise
                                       
                                    
                                    |
                                    ≥
                                    0
                                 
                              
                           
                        

Based on the interference manner, we assume that the line search stops at 
                              |
                              ∇
                              
                                 
                                    f
                                 
                                 
                                    noise
                                 
                              
                              |
                              =
                              |
                              
                                 
                                    d
                                    (
                                    f
                                    )
                                 
                                 
                                    dx
                                 
                              
                              
                                 
                                    |
                                 
                                 
                                    x
                                    =
                                    
                                       
                                          x
                                       
                                       
                                          0
                                       
                                    
                                 
                              
                              |
                            for a straightforward calculation:
                              
                                 (13)
                                 
                                    {
                                    
                                       
                                          
                                             
                                                |
                                                ∇
                                                f
                                                |
                                                =
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      σ
                                                      
                                                         
                                                            2
                                                            π
                                                         
                                                      
                                                   
                                                
                                                (
                                                H
                                                −
                                                L
                                                )
                                                
                                                exp
                                                (
                                                
                                                   
                                                      
                                                         −
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               s
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                      
                                                         2
                                                         
                                                            
                                                               σ
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                |
                                                ∇
                                                f
                                                |
                                                =
                                                |
                                                ∇
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      noise
                                                   
                                                
                                                |
                                             
                                          
                                       
                                    
                                 
                              
                           where x
                           
                              s
                            is the stopping point along the boundary profile when searching the local maxima and minima.

It is obvious that 
                              p
                              (
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                              
                              )
                            is symmetrical about x
                           
                              s
                           =0. When 
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                              
                              ≤
                              0
                           , 
                              |
                              ∇
                              f
                              |
                              =
                              
                                 
                                    1
                                 
                                 
                                    σ
                                    
                                       
                                          2
                                          π
                                       
                                    
                                 
                              
                              (
                              H
                              −
                              L
                              )
                              exp
                              (
                              
                                 
                                    −
                                    
                                       
                                          x
                                       
                                       
                                          s
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    2
                                    
                                       
                                          σ
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              )
                            is monotonic increasing. Using the theorem in Appendix B, We can get:
                              
                                 (14)
                                 
                                    p
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          s
                                       
                                    
                                    )
                                    =
                                    p
                                    (
                                    |
                                    ∇
                                    f
                                    |
                                    )
                                    |
                                    
                                       
                                          
                                             d
                                             (
                                             |
                                             ∇
                                             f
                                             |
                                             )
                                          
                                          
                                             
                                                
                                                   dx
                                                
                                                
                                                   s
                                                
                                             
                                          
                                       
                                    
                                    |
                                    
                                    
                                       
                                          x
                                       
                                       
                                          s
                                       
                                    
                                    ≤
                                    0
                                 
                              
                           where 
                              p
                              (
                              |
                              ∇
                              f
                              |
                              )
                            is from Eq. (12). Eq. (13) is symmetrical about x
                           
                              s
                           =0. Then we can get the probability distribution of the stopping point x
                           
                              s
                            in Eq. (15). Fig. 3
                           (a) shows the functional digraph of the following equation:
                              
                                 (15)
                                 
                                    p
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          s
                                       
                                    
                                    )
                                    =
                                    p
                                    (
                                    |
                                    ∇
                                    f
                                    |
                                    )
                                    |
                                    
                                       
                                          d
                                          (
                                          |
                                          ∇
                                          f
                                          |
                                          )
                                       
                                       
                                          
                                             
                                                dx
                                             
                                             
                                                s
                                             
                                          
                                       
                                    
                                    |
                                    =
                                    ξ
                                    |
                                    
                                       
                                          x
                                       
                                       
                                          s
                                       
                                    
                                    |
                                    
                                    exp
                                    (
                                    
                                       −
                                       
                                          
                                             
                                                
                                                   (
                                                   ∇
                                                   f
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             2
                                             
                                                
                                                   σ
                                                
                                                
                                                   n
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   s
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             2
                                             
                                                
                                                   σ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                              
                           where ξ ensures that the whole integral of the probability distribution equals to 1.

As the term 
                              
                                 
                                    
                                       
                                          (
                                          ∇
                                          f
                                          )
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    2
                                    
                                       
                                          σ
                                       
                                       
                                          n
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                            is symmetrical about x
                           
                              s
                           =0 and its influence on 
                              p
                              (
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                              
                              )
                            is minor (Fig. 3(a)). We discard the term for a straightforward calculation:
                              
                                 (16)
                                 
                                    p
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          s
                                       
                                    
                                    )
                                    =
                                    ξ
                                    |
                                    
                                       
                                          x
                                       
                                       
                                          s
                                       
                                    
                                    |
                                    exp
                                    (
                                    
                                       −
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   s
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             2
                                             
                                                
                                                   σ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                              
                           Based on Eq. (16) and 
                              f
                              (
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                              
                              )
                            is monotonically increasing, we can get the probability distribution of 
                              y
                              =
                              f
                              (
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                              
                              )
                            (Fig. 3(b)). Without loss of generality, we assume 
                              H
                              −
                              L
                              =
                              1
                           :
                              
                                 (17)
                                 
                                    {
                                    
                                       
                                          
                                             
                                                p
                                                (
                                                y
                                                )
                                                =
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         dy
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      
                                                         ∫
                                                      
                                                      
                                                         −
                                                         ∞
                                                      
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               s
                                                            
                                                         
                                                      
                                                   
                                                   ξ
                                                   |
                                                   η
                                                   |
                                                   
                                                   exp
                                                   (
                                                   
                                                      −
                                                      
                                                         
                                                            
                                                               
                                                                  η
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                         
                                                            2
                                                            
                                                               
                                                                  σ
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                
                                                )
                                                
                                                d
                                                η
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      s
                                                   
                                                
                                                =
                                                σ
                                                
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      erf
                                                   
                                                   
                                                      −
                                                      1
                                                   
                                                
                                                (
                                                2
                                                y
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                           M can be indicated as 
                              M
                              =
                              
                                 
                                    
                                       
                                          y
                                       
                                       
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          y
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           , where y
                           1 and y
                           2 obey the probability distribution in Eq. (17). The probability distribution of M can be calculated using Eq. (18). As the form of Eq. (18) is complicated, we use numerical integration to get the functional digraph of the probability distribution of M (Fig. 3(c)). We can conclude that M exists in the range of 
                              [
                              
                                 
                                    L
                                    +
                                    H
                                 
                                 
                                    2
                                 
                              
                              −
                              ε
                              ,
                              
                                 
                                    L
                                    +
                                    H
                                 
                                 
                                    2
                                 
                              
                              +
                              ε
                              ]
                            with a large potential, where ε is a small real number:
                              
                                 (18)
                                 
                                    p
                                    (
                                    M
                                    )
                                    =
                                    
                                       
                                          ∫
                                       
                                       
                                          −
                                          ∞
                                       
                                       
                                          +
                                          ∞
                                       
                                    
                                    p
                                    (
                                    y
                                    )
                                    p
                                    (
                                    2
                                    M
                                    −
                                    y
                                    )
                                    
                                    dy
                                 
                              
                           For a given boundary 
                              f
                              (
                              L
                              ,
                              H
                              )
                           , we calculate the expectation of M. As the probability distribution of M is symmetrical about 
                              M
                              =
                              
                                 
                                    L
                                    +
                                    H
                                 
                                 
                                    2
                                 
                              
                           :
                              
                                 (19)
                                 
                                    E
                                    (
                                    M
                                    )
                                    =
                                    
                                       
                                          (
                                          L
                                          +
                                          H
                                          )
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                        

Combining Eqs. (7), (8) and (19), we can summarize under the situation that the noise of the material and the noise of the boundary are added simultaneously:
                              
                                 (20)
                                 
                                    E
                                    (
                                    M
                                    )
                                    =
                                    
                                       
                                          (
                                          
                                             
                                                L
                                             
                                             
                                                0
                                             
                                          
                                          +
                                          
                                             
                                                H
                                             
                                             
                                                0
                                             
                                          
                                          )
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                           
                              
                                 (21)
                                 
                                    E
                                    (
                                    Δ
                                    h
                                    )
                                    <
                                    
                                       
                                          H
                                       
                                       
                                          0
                                       
                                    
                                    −
                                    
                                       
                                          L
                                       
                                       
                                          0
                                       
                                    
                                 
                              
                           
                        

For a given boundary 
                           f
                           (
                           L
                           ,
                           H
                           )
                        , we have proved that M exists in the range 
                           [
                           
                              
                                 L
                                 +
                                 H
                              
                              
                                 2
                              
                           
                           −
                           ε
                           ,
                           
                              
                                 L
                                 +
                                 H
                              
                              
                                 2
                              
                           
                           +
                           ε
                           ]
                         with a large potential, where ε is a small real number. However, it is not suitable to extract the boundaries though cluster approaches immediately because of the existence of misclassification among different boundaries. Let the set of voxels of a extracted boundary be B. The misclassification is constituted by two aspects: one is the false identifications of other boundary elements (set T), the other is the miss of true boundary elements (set N). The true boundary set is 
                           B
                           −
                           T
                           +
                           N
                        . Considering the fact that if the boundary is contaminated by noise, the height detected by the line search is less than its real value. Based on this fact, the boundary with 
                           Δ
                           
                              
                                 h
                              
                              
                                 1
                              
                           
                         interferes the boundaries with the height less than 
                           Δ
                           
                              
                                 h
                              
                              
                                 1
                              
                           
                        , while the boundaries with the height less than 
                           Δ
                           
                              
                                 h
                              
                              
                                 1
                              
                           
                         cannot interfere the boundary with 
                           Δ
                           
                              
                                 h
                              
                              
                                 1
                              
                           
                        . That is to say, the boundary with the maximum 
                           Δ
                           h
                         can interfere other boundaries, while cannot be interfered by others. In other words, set T of the boundary with the maximum 
                           Δ
                           h
                         is an empty set. Thus we only need to consider set 
                           B
                           +
                           N
                         for the boundary with the maximum 
                           Δ
                           h
                        . In addition, if the boundary with the maximum 
                           Δ
                           h
                         can be extracted precisely, we can establish an iterative boundary extraction method according to 
                           Δ
                           h
                         from high to low without concerning set T. Since 
                           Δ
                           h
                         is a dynamic variable which cannot be adopted as a coordinate of a histogram, it is not intuitive to determine the value of 
                           Δ
                           h
                         and the range of M via the 1-D histogram of M. Thus we introduce 
                           |
                           ∇
                           f
                           |
                         as a coordinate besides M, because 
                           |
                           ∇
                           f
                           |
                         is an inherent property to represent a boundary. We establish a dynamic 2-D 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram with the horizontal coordinate representing M and the vertical coordinate representing 
                           |
                           ∇
                           f
                           |
                        . The form of a given boundary is a vertical bar in 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram. 
                           Δ
                           h
                         is used to control the histogram. With 
                           Δ
                           h
                         from high to low, boundaries emerge in 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram orderly as the height of the boundaries.

Considering the misclassification of the boundary with the maximum 
                           Δ
                           h
                         extracted by 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram, the aim is to rehabilitate set 
                           N
                           +
                           B
                         which refers to the true boundary set. As the whole boundary elements form an integral 3-D surface, we take set B as seed points and use region growing on the conjugate direction of 
                           ∇
                           f
                         to enable B towards 
                           N
                           +
                           B
                        .

In region growing, some labeled voxels are chosen as initial seed points. From these seed voxels, the region is growing by iteratively adding the neighbors of already labeled voxels. In each iteration, a neighbor is chosen when it is similar to the already labeled voxel. In general, similarity measure is introduced to measure the similarity of the voxels. As our region growing aims to extract all the boundary elements of the current boundary, we introduce two similarity measures to enable the region growing to take place on the current boundary. These two measures depend on the assumption that the whole boundary elements form an integral 3-D surface. One similarity function measures the scalar value in Eq. (22). The other measures the gradient magnitude in Eq. (23). Fig. 4
                         shows an example of our region growing method. The blue boundary forms an integral after the region growing:
                           
                              (22)
                              
                                 |
                                 
                                    
                                       
                                          f
                                          (
                                          x
                                          )
                                          −
                                          f
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                          
                                          )
                                       
                                       
                                          f
                                          (
                                          x
                                          )
                                       
                                    
                                 
                                 |
                                 <
                                 δ
                              
                           
                        where f(x) is the scalar value of the labeled voxel, 
                           f
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           )
                         is the scalar value of the neighbor, δ is a small real number near to 0:
                           
                              (23)
                              
                                 |
                                 
                                    
                                       
                                          |
                                          ∇
                                          f
                                          (
                                          x
                                          )
                                          |
                                          −
                                          |
                                          ∇
                                          f
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                          
                                          )
                                          |
                                       
                                       
                                          |
                                          ∇
                                          f
                                          (
                                          x
                                          )
                                          |
                                       
                                    
                                 
                                 |
                                 <
                                 ε
                              
                           
                        where 
                           |
                           ∇
                           f
                           (
                           x
                           )
                           |
                         is the gradient magnitude of the labeled voxel, 
                           |
                           ∇
                           f
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           )
                           |
                         is the gradient magnitude of the neighbor, ε is a small real number near to 0.

As N is an abstract set, there exists no approach to precisely determine B after region growing equals to 
                           B
                           +
                           N
                        . Considering the worst case: a slight difference exists between B and 
                           B
                           +
                           N
                         for all boundaries, cumulative error occurs in the form of isolate regions since iterative method is adopted. As the isolate regions can be directly eliminated by image morphology, we use region elimination on the conjugate direction of 
                           ∇
                           f
                         (Fig. 5
                        ) to remove the cumulative error.


                        Fig. 6
                         gives an example of the boundary extraction based on the dynamic 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram. With 
                           Δ
                           h
                         from high to low, different bars emerge in the 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram orderly as their heights. Different bars represent different boundaries. It is convenient for users to obtain the horizontal coordinate range of each vertical bar via clustering methods or even the intuition of users when the histogram with scale. 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram can be recognized as a 1-D histogram more than a 2-D one.

We establish a 3-D TF based on 
                           Δ
                           h
                         and 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram. While controlling 
                           Δ
                           h
                         from high to low and extracting bars in 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram, users design TFs by assigning the extracted boundaries color and opacity. Color is used for the visual grouping. Users can interactively design the color of the boundaries by their intuitive feelings. Since the TF of the opacity is abstract for non-experts, we design the mathematical expression of TF for the opacity with a parameter controlled by users interactively (Eq. (22)). As 
                           |
                           ∇
                           f
                           |
                         obtains its maxima at the edge point in our boundary model, the expression is designed to emphasize the voxels close to the edge point:
                           
                              (24)
                              
                                 TF
                                 (
                                 α
                                 )
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             
                                                |
                                                ∇
                                                f
                                                |
                                             
                                             
                                                |
                                                ∇
                                                f
                                                
                                                   
                                                      |
                                                   
                                                   
                                                      max
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       λ
                                    
                                 
                                 
                                 λ
                                 ≥
                                 1
                              
                           
                        where α is the opacity, λ is controlled by the users.

@&#RESULTS@&#

We demonstrate our method in two steps. In the first step, we compare our interactive method with 
                        f
                        −
                        |
                        ∇
                        f
                        |
                      histogram and LH histogram. In the second step, our method is tested with medical data sets to demonstrate rendering quality. The data sets are obtained from the volume library http://schorsch.efi.fh-nuernberg.de/data/volume/.


                        Fig. 7
                         shows the user interface of our interactive TF design. There are two steps to design the TF of a 3-D data set. The first step is finding the appropriate value of 
                           Δ
                           h
                         according to 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram. 
                           Δ
                           h
                         decreases from its maximum until one bar appears in 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram. We design a widget that can automatically determine the appropriate 
                           Δ
                           h
                         for each boundary based on the half-interval search algorithm. The second step is extracting the boundary represented by the bar and assigning color and opacity to the boundary. The TF of all boundaries is designed in an iterative way until 
                           Δ
                           h
                         descends to 0, which is straightforward to be manipulated by users. The software package can be obtained at https://github.com/lilu630/Dynamic-middle-gradient-histogram.git.


                        Fig. 8
                         shows the five iterative steps to extract all the boundaries in the data set of the tooth sized 
                           256
                           ⁎
                           256
                           ⁎
                           161
                        . With 
                           Δ
                           h
                         from high to low, the vertical bars are extracted one by one without mutual interference. On one hand, the extraction of the bar can be easily understood and manipulated by non-experts. On the other hand, the process of extracting all boundaries is an iteration of extracting one boundary no matter how many boundaries are in the data set, which means non-experts can design the TF of all boundaries without concerning the number of the boundaries.


                        Fig. 9
                         shows the comparison of the interactive methods of 
                           f
                           −
                           |
                           ∇
                           f
                           |
                        , LH and 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram. In 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram (Fig. 9(a)) the boundaries are represented as arches. It is difficult to determine which boundary the intersection regions of arches belong. Users have to pick out part of an arch to avoid it. If the rendering result is unsatisfactory, users have to deal with the intersected regions via trial-and-error process. In LH histogram (Fig. 9(b)), the boundaries are represented as regions. Some of them are interconnecting; therefore, careful separation is needed. In 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram (Fig. 9(c)) when 
                           Δ
                           h
                         is set to 0, the boundaries are represented as vertical bars, and each bar is disjoint with another. On one hand, 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram is more concise to represent boundaries. On the other hand, there is a fixed strategy to extract all boundaries using 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram. Fig. 10
                         shows selections in 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram and the corresponding coloring of arches in 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram and points and regions in LH histogram.

As our TF design method is a dynamic one, we record the entire process of TF design as videos. The videos can be watched at http://home.ustc.edu.cn/%7Elilu630/MF-Hist/.


                        Fig. 11
                         shows the comparison of the visualizations of a CT head using 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram, LH histogram, 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram, 1-D histogram and region grow method, with the size of 
                           256
                           ⁎
                           256
                           ⁎
                           256
                        . The main difficulties of the boundary visualization lie in the spatial closeness and the amount of the boundaries. Fortunately, there exists little noise in the data set. The TF design manner of 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram and LH histogram is a trial-and-error process even with the help of widgets. Users have to fine-tune the widgets carefully to avoid misclassification without other technical supports. Thus, the trial-and-error process is tedious for non-experts that are lack of domain knowledge about the histograms. Fig. 11(d) shows the visualization using 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram. The shape of the boundaries is complete, but there are misclassification regions. The shin is rendered in blue and green. Fig. 11(f) shows the visualization using LH histogram. The shape is not complete, especially the blue skin. Fig. 11(b) shows the visualization using 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram. The boundaries are more complete and with less misclassification regions. In addition, users have to try all the regions in 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram and LH histogram to extract all boundaries. However, some boundaries may be ignored because of the limitation of the widgets and the noise. It is difficult to precisely determine the number of the boundaries by 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram and LH histogram. Compared with 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram and LH histogram, the boundary extraction process using 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram is an iterative way without concerning the number of the boundaries. 1-D histogram (Fig. 11(g)) and region grow method (Fig. 11(h)) mainly aim to extract the structures in the volume. In this instance, the main difference between our method and these two methods is that our method renders the boundary of the skins, while 1-D histogram and region grow method render the whole skins and muscles.


                        Fig. 12
                         shows the rendering results of Chapel Hill CT Head, with the size of 
                           256
                           ⁎
                           256
                           ⁎
                           113
                        . It is more sophisticated than the example discussed above. The difficulties lie mainly in two aspects. Firstly, the head is divided into skin, bone and meningeal. Each of the three materials is close in spatial. Moreover, the ranges of 
                           |
                           ∇
                           f
                           |
                         of the skin and the meningeal are the same. Secondly, the scalar values of the two boards on the back of the head are approximately equal to the skins and the two boards are so close that they may be classified as the same board.


                        Fig. 12 gives the comparison between the visualizations of the Chapel Hill CT Head using 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram, LH histogram, 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram 1-D histogram and region growing method. The misclassification using 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram is shown clearly (Fig. 12(d)). The head is a mixed color of red, yellow and green because of the closeness of the skin, bone and meningeal. When compared with the rendering results generated by LH histogram (Fig. 12(f)) with 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram (Fig. 12(b)), the boundaries generated by 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram are more complete overall. The notable difference is the blue board. The blue board of (b) is pure blue, while the blue board of (f) mixes with yellow. In Fig. 12(c) and (e), LH histogram cannot provide meaningful information, and in 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram other arches are hidden in the two obvious arches. It is difficult to determine the amount and the precise locations of the regions in the two histograms.


                        Fig. 13
                         shows the rendering results of foot, with the size of 
                           256
                           ⁎
                           256
                           ⁎
                           256
                        . The scalar values of the bones and the muscles fluctuate greatly. The rendering results aiming to visualize the structures (Fig. 13(g) and (h)) show better results. In Fig. 13(c) and (e), 
                           f
                           −
                           |
                           ∇
                           f
                           |
                         histogram does not show any arches and LH histogram does not provide meaningful information. The rendering results are gotten by trail-and-error process without a clear purpose. Fig. 13(b) shows the rendering result using our method. In 
                           M
                           −
                           |
                           ∇
                           f
                           |
                         histogram, there are a clear distinction between the boundary of the bones and the boundary of the joints. The joints are rendered in a different color from the bones, which is the main difference from other methods.

@&#CONCLUSIONS AND FUTURE WORK@&#

In this paper, on one hand, we propose a generalized boundary model contaminated by noise and prove M has a good statistical property. On the other hand, we propose an interactive TF design method employing dynamic 
                        M
                        −
                        |
                        ∇
                        f
                        |
                      histogram. Users extract the vertical bars one by one with 
                        Δ
                        h
                      from high to low. This is a convenience interactive strategy. However, there exist several limitations, which can be overcome to improve the quality of visualizations.

First, we employ the C++ container of queue to implement the region growing and region elimination on CPU. This serial implementation leads to the non-real time interaction. In the future, the serial implementation can be replaced by a parallel implementation using CUDA.

Second, although we add noise to the boundary, the visualization is not satisfactory when a strong bias occurs in the data set. In the future, two methods can be applied to improve the rendering quality.

Multi-scale local extremum search method may be a solution of the instability of the traditional line search. The noise in large scale can be eliminated easily, while the locations of the boundaries are blurred. It is a challenge to balance the pros and cons of the multi-scale extremum search method.

Local inherent properties employed in this work are scalar value and gradient. There are other properties such as curvature, texture, etc. How to select and combine these properties is worth a further investigation. Recently, deep learning method brings a new understanding of these properties. Farabet et al. [37] employed ConvNets to extract the properties and label scene for a 2-D image. This inspires us to employ deep learning method in the visualization of 3-D data set in our future work.

None declared.

@&#ACKNOWLEDGMENTS@&#

This project was supported by National Natural Science Foundation of China (Grant nos. 61172037, 60871087, 81571760 and 61501164).

Let 
                        X
                        ~
                        N
                        (
                        
                           
                              μ
                           
                           
                              x
                           
                        
                        ,
                        
                           
                              σ
                           
                           
                              x
                           
                        
                        )
                      and 
                        Y
                        ~
                        N
                        (
                        
                           
                              μ
                           
                           
                              y
                           
                        
                        ,
                        
                           
                              σ
                           
                           
                              y
                           
                        
                        )
                     , X and Y are independent of each other. Denote 
                        Z
                        =
                        X
                        +
                        Y
                     , 
                        W
                        =
                        X
                        −
                        Y
                     , 
                        S
                        =
                        
                           
                              X
                           
                           
                              2
                           
                        
                     , 
                        R
                        =
                        |
                        X
                        |
                     :
                        
                           (a)
                           
                              
                                 Z
                                 ~
                                 N
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       x
                                    
                                 
                                 +
                                 
                                    
                                       μ
                                    
                                    
                                       y
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             σ
                                          
                                          
                                             y
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                              .


                              
                                 W
                                 ~
                                 N
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       x
                                    
                                 
                                 −
                                 
                                    
                                       μ
                                    
                                    
                                       y
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             σ
                                          
                                          
                                             y
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                              .


                              
                                 S
                                 ~
                                 N
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       x
                                    
                                 
                                 ,
                                 2
                                 
                                    
                                       σ
                                    
                                    
                                       x
                                    
                                 
                                 )
                              .


                              
                                 R
                                 ~
                                 2
                                 N
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       x
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       x
                                    
                                 
                                 )
                                 ,
                                 R
                                 ≥
                                 0
                              .

(a) Let p
                           
                              z
                           (z) be the probability distribution of Z:
                              
                                 (A.1)
                                 
                                    
                                       
                                          p
                                       
                                       
                                          z
                                       
                                    
                                    (
                                    z
                                    )
                                    =
                                    
                                       
                                          ∫
                                       
                                       
                                          −
                                          ∞
                                       
                                       
                                          +
                                          ∞
                                       
                                    
                                    
                                       
                                          p
                                       
                                       
                                          x
                                       
                                    
                                    (
                                    x
                                    )
                                    
                                       
                                          p
                                       
                                       
                                          y
                                       
                                    
                                    (
                                    z
                                    −
                                    x
                                    )
                                    
                                    dx
                                 
                              
                           where p
                           
                              x
                            and p
                           
                              y
                            are the probability distributions of X and Y respectively.
                              
                                 (A.2)
                                 
                                    
                                       
                                          p
                                       
                                       
                                          x
                                       
                                    
                                    (
                                    x
                                    )
                                    
                                       
                                          p
                                       
                                       
                                          y
                                       
                                    
                                    (
                                    z
                                    −
                                    x
                                    )
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          2
                                          π
                                          
                                             
                                                σ
                                             
                                             
                                                x
                                             
                                          
                                          
                                             
                                                σ
                                             
                                             
                                                y
                                             
                                          
                                       
                                    
                                    exp
                                    {
                                    
                                       −
                                       
                                          
                                             1
                                          
                                          
                                             2
                                          
                                       
                                       [
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         x
                                                         −
                                                         
                                                            
                                                               μ
                                                            
                                                            
                                                               x
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               σ
                                                            
                                                            
                                                               x
                                                            
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         z
                                                         −
                                                         x
                                                         −
                                                         
                                                            
                                                               μ
                                                            
                                                            
                                                               y
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               σ
                                                            
                                                            
                                                               y
                                                            
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                             
                                                2
                                             
                                          
                                       
                                       ]
                                    
                                    }
                                 
                              
                           
                        

Bring Eqs. (A.1) to (A.2):
                        
                           (A.3)
                           
                              
                                 
                                    p
                                 
                                 
                                    z
                                 
                              
                              (
                              z
                              )
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          2
                                          π
                                          (
                                          
                                             
                                                σ
                                             
                                             
                                                x
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                σ
                                             
                                             
                                                y
                                             
                                             
                                                2
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                              exp
                              (
                              
                                 
                                    
                                       −
                                       
                                          
                                             (
                                             z
                                             −
                                             
                                                
                                                   μ
                                                
                                                
                                                   x
                                                
                                             
                                             −
                                             
                                                
                                                   μ
                                                
                                                
                                                   y
                                                
                                             
                                             )
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       2
                                       (
                                       
                                          
                                             σ
                                          
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             σ
                                          
                                          
                                             y
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                 
                              
                              )
                           
                        
                     
                  

(b) We can use the same method of Z to calculate the probability distribution of W.

(c) Let 
                        P
                        (
                        S
                        ≤
                        s
                        )
                      be the probability of 
                        S
                        ≤
                        s
                     , where s is an arbitrary real number:
                        
                           (A.4)
                           
                              P
                              (
                              S
                              ≤
                              s
                              )
                              =
                              P
                              (
                              X
                              ≤
                              2
                              s
                              )
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          x
                                       
                                    
                                    
                                       
                                          2
                                          π
                                       
                                    
                                 
                              
                              
                                 
                                    ∫
                                 
                                 
                                    −
                                    ∞
                                 
                                 
                                    2
                                    s
                                 
                              
                              exp
                              {
                              
                                 −
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             σ
                                          
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       (
                                       x
                                       −
                                       
                                          
                                             μ
                                          
                                          
                                             x
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                              
                              }
                              
                              dx
                           
                        
                     So we can get the probability distribution of S: 
                        
                           (A.5)
                           
                              
                                 
                                    p
                                 
                                 
                                    s
                                 
                              
                              (
                              s
                              )
                              =
                              
                                 
                                    d
                                    (
                                    P
                                    (
                                    S
                                    ≤
                                    s
                                    )
                                    )
                                 
                                 
                                    ds
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                    
                                       
                                          σ
                                       
                                       
                                          x
                                       
                                    
                                    
                                       
                                          2
                                          π
                                       
                                    
                                 
                              
                              exp
                              {
                              
                                 −
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             (
                                             2
                                             
                                                
                                                   σ
                                                
                                                
                                                   x
                                                
                                             
                                             )
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          s
                                          −
                                          
                                             
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      x
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                              
                              }
                           
                        
                     
                  

(d) Let 
                        P
                        (
                        R
                        ≤
                        r
                        )
                      be the probability of 
                        R
                        ≤
                        r
                     , where r is an arbitrary real number:
                        
                           (A.6)
                           
                              P
                              (
                              R
                              ≤
                              r
                              )
                              =
                              P
                              (
                              −
                              r
                              ≤
                              X
                              ≤
                              r
                              )
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          x
                                       
                                    
                                    
                                       
                                          2
                                          π
                                       
                                    
                                 
                              
                              
                                 
                                    ∫
                                 
                                 
                                    −
                                    r
                                 
                                 
                                    r
                                 
                              
                              exp
                              {
                              
                                 −
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             σ
                                          
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       (
                                       x
                                       −
                                       
                                          
                                             u
                                          
                                          
                                             x
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                              
                              }
                              
                              dx
                           
                        
                     So we can get the probability distribution of R:
                        
                           (A.7)
                           
                              
                                 
                                    p
                                 
                                 
                                    r
                                 
                              
                              (
                              r
                              )
                              =
                              
                                 
                                    d
                                    (
                                    P
                                    (
                                    R
                                    ≤
                                    r
                                    )
                                    )
                                 
                                 
                                    dr
                                 
                              
                              =
                              
                                 
                                    2
                                 
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          x
                                       
                                    
                                    
                                       
                                          2
                                          π
                                       
                                    
                                 
                              
                              exp
                              {
                              
                                 −
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       
                                          
                                             σ
                                          
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       (
                                       x
                                       −
                                       
                                          
                                             u
                                          
                                          
                                             x
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                              
                              }
                           
                        
                     
                  

Let X be a random variable and p(x) be the probability density function of X. In the range of 
                        (
                        a
                        ,
                        b
                        )
                        (
                        −
                        ∞
                        ≤
                        a
                        <
                        b
                        ≤
                        +
                        ∞
                        )
                     , p(x) satisfies 
                        P
                        (
                        a
                        <
                        X
                        <
                        b
                        )
                        =
                        1
                     , where P(x) is the probability function. Let 
                        Y
                        =
                        f
                        (
                        x
                        )
                      be a monotonic and continuous function in 
                        (
                        a
                        ,
                        b
                        )
                     . g(y) is the inverse function of f(x) and 
                        
                           
                              g
                           
                           
                              
                                 
                                 
                                    ′
                                 
                              
                           
                        
                        (
                        y
                        )
                      exists in 
                        (
                        α
                        ,
                        β
                        )
                      which is the existence interval of g(y). Let
                        
                           (B. 1)
                           
                              q
                              (
                              y
                              )
                              =
                              {
                              
                                 
                                    
                                       
                                          p
                                          (
                                          g
                                          (
                                          y
                                          )
                                          )
                                          |
                                          
                                             
                                                g
                                             
                                             
                                                ′
                                             
                                          
                                          (
                                          y
                                          )
                                          |
                                       
                                       
                                          y
                                          ∈
                                          (
                                          α
                                          ,
                                          β
                                          )
                                       
                                    
                                    
                                       
                                          0
                                       
                                       
                                          others
                                       
                                    
                                 
                              
                           
                        
                     
                     q(y) is the probability density function of Y.
                        Proof
                        Without loss of generality, let f(x) be a monotone increasing function. For 
                              u
                              ∈
                              (
                              a
                              ,
                              b
                              )
                           :
                              
                                 (B. 2)
                                 
                                    P
                                    (
                                    Y
                                    ≤
                                    u
                                    )
                                    =
                                    P
                                    (
                                    f
                                    (
                                    X
                                    )
                                    ≤
                                    u
                                    )
                                    =
                                    P
                                    (
                                    X
                                    ≤
                                    g
                                    (
                                    u
                                    )
                                    )
                                    =
                                    
                                       
                                          ∫
                                       
                                       
                                          a
                                       
                                       
                                          g
                                          (
                                          u
                                          )
                                       
                                    
                                    p
                                    (
                                    x
                                    )
                                    
                                    dx
                                 
                              
                           
                        

Let 
                        x
                        =
                        g
                        (
                        y
                        )
                     :
                        
                           (B. 3)
                           
                              P
                              (
                              Y
                              ≤
                              u
                              )
                              =
                              
                                 
                                    ∫
                                 
                                 
                                    a
                                 
                                 
                                    u
                                 
                              
                              p
                              (
                              g
                              (
                              y
                              )
                              )
                              |
                              
                                 
                                    g
                                 
                                 
                                    ′
                                 
                              
                              (
                              y
                              )
                              |
                              
                              dy
                              =
                              
                                 
                                    ∫
                                 
                                 
                                    a
                                 
                                 
                                    u
                                 
                              
                              q
                              (
                              y
                              )
                              
                              dy
                           
                        
                     when 
                        u
                        ≤
                        α
                     , 
                        P
                        (
                        Y
                        ≤
                        u
                        )
                        =
                        0
                     , when 
                        u
                        ≥
                        β
                     , 
                        P
                        (
                        Y
                        ≤
                        u
                        )
                        =
                        1
                     .

@&#REFERENCES@&#

